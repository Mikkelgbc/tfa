<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Module 9 Data visualization using ggplot | Tools for Analytics (TFA)</title>
  <meta name="description" content="Course notes for the ‘Tools for Analytics’ course (R part)" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Module 9 Data visualization using ggplot | Tools for Analytics (TFA)" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://bss-osca.github.io/tfa/" />
  <meta property="og:image" content="https://bss-osca.github.io/tfa/assets/logo.png" />
  <meta property="og:description" content="Course notes for the ‘Tools for Analytics’ course (R part)" />
  <meta name="github-repo" content="bss-osca/tfa" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Module 9 Data visualization using ggplot | Tools for Analytics (TFA)" />
  
  <meta name="twitter:description" content="Course notes for the ‘Tools for Analytics’ course (R part)" />
  <meta name="twitter:image" content="https://bss-osca.github.io/tfa/assets/logo.png" />

<meta name="author" content="Lars Relund Nielsen" />


<meta name="date" content="2020-10-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon" />
<link rel="prev" href="sec-transform.html"/>
<link rel="next" href="sec-maps.html"/>
<script src="libs/header-attrs-2.4/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/font-awesome-5.3.1/css/all.min.css" rel="stylesheet" />
<link href="libs/font-awesome-5.3.1/css/v4-shims.min.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.15/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<html>
<head>
<script>
  $(document).ready(function() {

  // Section anchors
  $('.section h1, .section h2, .section h3, .section h4, .section h5').each(function() {
    anchor = '#' + $(this).parent().attr('id');
    $(this).addClass("hasAnchor").prepend('<a href="' + anchor + '" class="anchor"></a>');
  });
});
</script>
<script src="https://hypothes.is/embed.js" async></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</head>
</html>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="img/logo.png"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#how-this-book-is-organized"><i class="fa fa-check"></i><b>1.1</b> How this book is organized</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#ack"><i class="fa fa-check"></i><b>1.2</b> Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I Getting started</b></span></li>
<li class="chapter" data-level="2" data-path="sec-install.html"><a href="sec-install.html"><i class="fa fa-check"></i><b>2</b> Install R and RStudio</a>
<ul>
<li class="chapter" data-level="2.1" data-path="sec-install.html"><a href="sec-install.html#lo-install"><i class="fa fa-check"></i><b>2.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="2.2" data-path="sec-install.html"><a href="sec-install.html#install-r"><i class="fa fa-check"></i><b>2.2</b> Install R and RStudio</a></li>
<li class="chapter" data-level="2.3" data-path="sec-install.html"><a href="sec-install.html#test-your-installation"><i class="fa fa-check"></i><b>2.3</b> Test your installation</a></li>
<li class="chapter" data-level="2.4" data-path="sec-install.html"><a href="sec-install.html#add-on-packages"><i class="fa fa-check"></i><b>2.4</b> Add-on packages</a></li>
<li class="chapter" data-level="2.5" data-path="sec-install.html"><a href="sec-install.html#lp-install"><i class="fa fa-check"></i><b>2.5</b> Different learning paths</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sec-r-basics.html"><a href="sec-r-basics.html"><i class="fa fa-check"></i><b>3</b> R basics and workflows</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sec-r-basics.html"><a href="sec-r-basics.html#lo-r-basics"><i class="fa fa-check"></i><b>3.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="3.2" data-path="sec-r-basics.html"><a href="sec-r-basics.html#working-with-r-at-the-command-line-in-rstudio"><i class="fa fa-check"></i><b>3.2</b> Working with R at the command line in RStudio</a></li>
<li class="chapter" data-level="3.3" data-path="sec-r-basics.html"><a href="sec-r-basics.html#your-first-datacamp-course"><i class="fa fa-check"></i><b>3.3</b> Your first DataCamp course</a></li>
<li class="chapter" data-level="3.4" data-path="sec-r-basics.html"><a href="sec-r-basics.html#pipes"><i class="fa fa-check"></i><b>3.4</b> Pipes</a></li>
<li class="chapter" data-level="3.5" data-path="sec-r-basics.html"><a href="sec-r-basics.html#rprojs"><i class="fa fa-check"></i><b>3.5</b> RStudio projects</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="sec-r-basics.html"><a href="sec-r-basics.html#storing-your-code-in-a-script-file"><i class="fa fa-check"></i><b>3.5.1</b> Storing your code in a script file</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="sec-r-basics.html"><a href="sec-r-basics.html#global-options"><i class="fa fa-check"></i><b>3.6</b> Global options</a></li>
<li class="chapter" data-level="3.7" data-path="sec-r-basics.html"><a href="sec-r-basics.html#working-directory"><i class="fa fa-check"></i><b>3.7</b> Working directory</a></li>
<li class="chapter" data-level="3.8" data-path="sec-r-basics.html"><a href="sec-r-basics.html#lp-r-basics"><i class="fa fa-check"></i><b>3.8</b> Different learning paths</a></li>
<li class="chapter" data-level="3.9" data-path="sec-r-basics.html"><a href="sec-r-basics.html#rc-r-basics"><i class="fa fa-check"></i><b>3.9</b> Recap</a></li>
<li class="chapter" data-level="3.10" data-path="sec-r-basics.html"><a href="sec-r-basics.html#ex-r-basics"><i class="fa fa-check"></i><b>3.10</b> Exercises</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-group-work"><i class="fa fa-check"></i><b>3.10.1</b> Exercise (group work)</a></li>
<li class="chapter" data-level="3.10.2" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-install-packages"><i class="fa fa-check"></i><b>3.10.2</b> Exercise (install packages)</a></li>
<li class="chapter" data-level="3.10.3" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-piping"><i class="fa fa-check"></i><b>3.10.3</b> Exercise (piping)</a></li>
<li class="chapter" data-level="3.10.4" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-working-dir"><i class="fa fa-check"></i><b>3.10.4</b> Exercise (working dir)</a></li>
<li class="chapter" data-level="3.10.5" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-vectors"><i class="fa fa-check"></i><b>3.10.5</b> Exercise (vectors)</a></li>
<li class="chapter" data-level="3.10.6" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-matrices"><i class="fa fa-check"></i><b>3.10.6</b> Exercise (matrices)</a></li>
<li class="chapter" data-level="3.10.7" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-data-frames"><i class="fa fa-check"></i><b>3.10.7</b> Exercise (data frames)</a></li>
<li class="chapter" data-level="3.10.8" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-lists"><i class="fa fa-check"></i><b>3.10.8</b> Exercise (lists)</a></li>
<li class="chapter" data-level="3.10.9" data-path="sec-r-basics.html"><a href="sec-r-basics.html#ex-strings"><i class="fa fa-check"></i><b>3.10.9</b> Exercise (string management)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Programming in R</b></span></li>
<li class="chapter" data-level="4" data-path="sec-loops.html"><a href="sec-loops.html"><i class="fa fa-check"></i><b>4</b> Loops and conditionals</a>
<ul>
<li class="chapter" data-level="4.1" data-path="sec-loops.html"><a href="sec-loops.html#lo-loops"><i class="fa fa-check"></i><b>4.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="4.2" data-path="sec-loops.html"><a href="sec-loops.html#conditionals-and-control-flow"><i class="fa fa-check"></i><b>4.2</b> Conditionals and control flow</a></li>
<li class="chapter" data-level="4.3" data-path="sec-loops.html"><a href="sec-loops.html#loops"><i class="fa fa-check"></i><b>4.3</b> Loops</a></li>
<li class="chapter" data-level="4.4" data-path="sec-loops.html"><a href="sec-loops.html#lp-loops"><i class="fa fa-check"></i><b>4.4</b> Different learning paths</a></li>
<li class="chapter" data-level="4.5" data-path="sec-loops.html"><a href="sec-loops.html#rc-loops"><i class="fa fa-check"></i><b>4.5</b> Recap</a></li>
<li class="chapter" data-level="4.6" data-path="sec-loops.html"><a href="sec-loops.html#ex-loops"><i class="fa fa-check"></i><b>4.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="sec-loops.html"><a href="sec-loops.html#exercise-conditional-expressions"><i class="fa fa-check"></i><b>4.6.1</b> Exercise (conditional expressions)</a></li>
<li class="chapter" data-level="4.6.2" data-path="sec-loops.html"><a href="sec-loops.html#exercise-loops"><i class="fa fa-check"></i><b>4.6.2</b> Exercise (loops)</a></li>
<li class="chapter" data-level="4.6.3" data-path="sec-loops.html"><a href="sec-loops.html#ex-dist"><i class="fa fa-check"></i><b>4.6.3</b> Exercise (calculating distances)</a></li>
<li class="chapter" data-level="4.6.4" data-path="sec-loops.html"><a href="sec-loops.html#exercise-expand_grid"><i class="fa fa-check"></i><b>4.6.4</b> Exercise (<code>expand_grid</code>)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sec-functions.html"><a href="sec-functions.html"><i class="fa fa-check"></i><b>5</b> Functions</a>
<ul>
<li class="chapter" data-level="5.1" data-path="sec-functions.html"><a href="sec-functions.html#lo-functions"><i class="fa fa-check"></i><b>5.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="5.2" data-path="sec-functions.html"><a href="sec-functions.html#datacamp-course"><i class="fa fa-check"></i><b>5.2</b> DataCamp course</a></li>
<li class="chapter" data-level="5.3" data-path="sec-functions.html"><a href="sec-functions.html#functions-returning-multiple-objects"><i class="fa fa-check"></i><b>5.3</b> Functions returning multiple objects</a></li>
<li class="chapter" data-level="5.4" data-path="sec-functions.html"><a href="sec-functions.html#the-...-argument"><i class="fa fa-check"></i><b>5.4</b> The <code>...</code> argument</a></li>
<li class="chapter" data-level="5.5" data-path="sec-functions.html"><a href="sec-functions.html#documenting-your-functions"><i class="fa fa-check"></i><b>5.5</b> Documenting your functions</a></li>
<li class="chapter" data-level="5.6" data-path="sec-functions.html"><a href="sec-functions.html#lp-functions"><i class="fa fa-check"></i><b>5.6</b> Different learning paths</a></li>
<li class="chapter" data-level="5.7" data-path="sec-functions.html"><a href="sec-functions.html#rc-functions"><i class="fa fa-check"></i><b>5.7</b> Recap</a></li>
<li class="chapter" data-level="5.8" data-path="sec-functions.html"><a href="sec-functions.html#ex-functions"><i class="fa fa-check"></i><b>5.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="sec-functions.html"><a href="sec-functions.html#exercise-defining-functions"><i class="fa fa-check"></i><b>5.8.1</b> Exercise (defining functions)</a></li>
<li class="chapter" data-level="5.8.2" data-path="sec-functions.html"><a href="sec-functions.html#exercise-scope"><i class="fa fa-check"></i><b>5.8.2</b> Exercise (scope)</a></li>
<li class="chapter" data-level="5.8.3" data-path="sec-functions.html"><a href="sec-functions.html#exercise-job-sequencing"><i class="fa fa-check"></i><b>5.8.3</b> Exercise (job sequencing)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III IO, tidy and transform</b></span></li>
<li class="chapter" data-level="6" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html"><i class="fa fa-check"></i><b>6</b> Introduction to tidyverse and R Markdown</a>
<ul>
<li class="chapter" data-level="6.1" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#lo-tidy-intro"><i class="fa fa-check"></i><b>6.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="6.2" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#the-tidyverse-package"><i class="fa fa-check"></i><b>6.2</b> The tidyverse package</a></li>
<li class="chapter" data-level="6.3" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#writing-reproducible-reports"><i class="fa fa-check"></i><b>6.3</b> Writing reproducible reports</a></li>
<li class="chapter" data-level="6.4" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#tibbles"><i class="fa fa-check"></i><b>6.4</b> Tibbles</a></li>
<li class="chapter" data-level="6.5" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#lp-tidy-intro"><i class="fa fa-check"></i><b>6.5</b> Different learning paths</a></li>
<li class="chapter" data-level="6.6" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#rc-tidy-intro"><i class="fa fa-check"></i><b>6.6</b> Recap</a></li>
<li class="chapter" data-level="6.7" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#ex-tidy-intro"><i class="fa fa-check"></i><b>6.7</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#exercise-your-first-r-markdown-exercise"><i class="fa fa-check"></i><b>6.7.1</b> Exercise (your first R Markdown exercise)</a></li>
<li class="chapter" data-level="6.7.2" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#exercise-tibbles"><i class="fa fa-check"></i><b>6.7.2</b> Exercise (tibbles)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="sec-io.html"><a href="sec-io.html"><i class="fa fa-check"></i><b>7</b> Importing and exporting data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="sec-io.html"><a href="sec-io.html#lo-io"><i class="fa fa-check"></i><b>7.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="7.2" data-path="sec-io.html"><a href="sec-io.html#csv-files"><i class="fa fa-check"></i><b>7.2</b> CSV files</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="sec-io.html"><a href="sec-io.html#reading-a-csv-file"><i class="fa fa-check"></i><b>7.2.1</b> Reading a CSV file</a></li>
<li class="chapter" data-level="7.2.2" data-path="sec-io.html"><a href="sec-io.html#writing-to-csv-files"><i class="fa fa-check"></i><b>7.2.2</b> Writing to CSV files</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="sec-io.html"><a href="sec-io.html#excel"><i class="fa fa-check"></i><b>7.3</b> Excel</a></li>
<li class="chapter" data-level="7.4" data-path="sec-io.html"><a href="sec-io.html#google-sheets"><i class="fa fa-check"></i><b>7.4</b> Google Sheets</a></li>
<li class="chapter" data-level="7.5" data-path="sec-io.html"><a href="sec-io.html#text-files"><i class="fa fa-check"></i><b>7.5</b> Text files</a></li>
<li class="chapter" data-level="7.6" data-path="sec-io.html"><a href="sec-io.html#rs-native-binary-format"><i class="fa fa-check"></i><b>7.6</b> R’s native binary format</a></li>
<li class="chapter" data-level="7.7" data-path="sec-io.html"><a href="sec-io.html#json"><i class="fa fa-check"></i><b>7.7</b> Json</a></li>
<li class="chapter" data-level="7.8" data-path="sec-io.html"><a href="sec-io.html#lp-io"><i class="fa fa-check"></i><b>7.8</b> Different learning paths</a></li>
<li class="chapter" data-level="7.9" data-path="sec-io.html"><a href="sec-io.html#rc-io"><i class="fa fa-check"></i><b>7.9</b> Recap</a></li>
<li class="chapter" data-level="7.10" data-path="sec-io.html"><a href="sec-io.html#ex-io"><i class="fa fa-check"></i><b>7.10</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.10.1" data-path="sec-io.html"><a href="sec-io.html#exercise-statistikbanken"><i class="fa fa-check"></i><b>7.10.1</b> Exercise (Statistikbanken)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="sec-transform.html"><a href="sec-transform.html"><i class="fa fa-check"></i><b>8</b> Transforming data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="sec-transform.html"><a href="sec-transform.html#lo-transform"><i class="fa fa-check"></i><b>8.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="8.2" data-path="sec-transform.html"><a href="sec-transform.html#working-with-data-in-the-tidyverse"><i class="fa fa-check"></i><b>8.2</b> Working with data in the tidyverse</a></li>
<li class="chapter" data-level="8.3" data-path="sec-transform.html"><a href="sec-transform.html#lp-transform"><i class="fa fa-check"></i><b>8.3</b> Different learning paths</a></li>
<li class="chapter" data-level="8.4" data-path="sec-transform.html"><a href="sec-transform.html#rc-transform"><i class="fa fa-check"></i><b>8.4</b> Recap</a></li>
<li class="chapter" data-level="8.5" data-path="sec-transform.html"><a href="sec-transform.html#ex-transform"><i class="fa fa-check"></i><b>8.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="sec-transform.html"><a href="sec-transform.html#ex-gapminder1"><i class="fa fa-check"></i><b>8.5.1</b> Exercise (gapminder)</a></li>
<li class="chapter" data-level="8.5.2" data-path="sec-transform.html"><a href="sec-transform.html#ex-babynames1"><i class="fa fa-check"></i><b>8.5.2</b> Exercise (babynames)</a></li>
<li class="chapter" data-level="8.5.3" data-path="sec-transform.html"><a href="sec-transform.html#ex-profit1"><i class="fa fa-check"></i><b>8.5.3</b> Exercise (profit)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Visualization</b></span></li>
<li class="chapter" data-level="9" data-path="sec-plot.html"><a href="sec-plot.html"><i class="fa fa-check"></i><b>9</b> Data visualization using ggplot</a>
<ul>
<li class="chapter" data-level="9.1" data-path="sec-plot.html"><a href="sec-plot.html#lo-plot"><i class="fa fa-check"></i><b>9.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="9.2" data-path="sec-plot.html"><a href="sec-plot.html#introduction-to-data-visualization"><i class="fa fa-check"></i><b>9.2</b> Introduction to data visualization</a></li>
<li class="chapter" data-level="9.3" data-path="sec-plot.html"><a href="sec-plot.html#section"><i class="fa fa-check"></i><b>9.3</b> ???</a></li>
<li class="chapter" data-level="9.4" data-path="sec-plot.html"><a href="sec-plot.html#lp-r-plot"><i class="fa fa-check"></i><b>9.4</b> Different learning paths</a></li>
<li class="chapter" data-level="9.5" data-path="sec-plot.html"><a href="sec-plot.html#rc-r-plot"><i class="fa fa-check"></i><b>9.5</b> Recap</a></li>
<li class="chapter" data-level="9.6" data-path="sec-plot.html"><a href="sec-plot.html#ex-r-plot"><i class="fa fa-check"></i><b>9.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="sec-plot.html"><a href="sec-plot.html#ex-gapminder2"><i class="fa fa-check"></i><b>9.6.1</b> Exercise (gapminder)</a></li>
<li class="chapter" data-level="9.6.2" data-path="sec-plot.html"><a href="sec-plot.html#ex-profit2"><i class="fa fa-check"></i><b>9.6.2</b> Exercise (profit)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="sec-maps.html"><a href="sec-maps.html"><i class="fa fa-check"></i><b>10</b> Spartial data and maps</a>
<ul>
<li class="chapter" data-level="10.1" data-path="sec-maps.html"><a href="sec-maps.html#lo-maps"><i class="fa fa-check"></i><b>10.1</b> Learning outcomes</a></li>
</ul></li>
<li class="part"><span><b>V R project in groups</b></span></li>
<li class="chapter" data-level="11" data-path="sec-project.html"><a href="sec-project.html"><i class="fa fa-check"></i><b>11</b> Mandatory R project</a>
<ul>
<li class="chapter" data-level="11.1" data-path="sec-project.html"><a href="sec-project.html#lo-project"><i class="fa fa-check"></i><b>11.1</b> Learning outcomes</a></li>
</ul></li>
<li class="part"><span><b>VI Extra</b></span></li>
<li class="chapter" data-level="12" data-path="sec-r-excel.html"><a href="sec-r-excel.html"><i class="fa fa-check"></i><b>12</b> Using R in Excel and Excel in R</a></li>
<li class="chapter" data-level="13" data-path="sec-opl.html"><a href="sec-opl.html"><i class="fa fa-check"></i><b>13</b> Run an OPL model from R</a></li>
<li class="chapter" data-level="14" data-path="sec-simulation.html"><a href="sec-simulation.html"><i class="fa fa-check"></i><b>14</b> Simulation in R</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="groups.html"><a href="groups.html"><i class="fa fa-check"></i><b>A</b> Working in groups</a>
<ul>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#r-project-structure"><i class="fa fa-check"></i>R project structure</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#using-git"><i class="fa fa-check"></i>Using Git together with GitHub</a>
<ul>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#register-a-free-github-account"><i class="fa fa-check"></i>Register a free GitHub account</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#install-git"><i class="fa fa-check"></i>Install Git</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#check-your-installation"><i class="fa fa-check"></i>Check your installation</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#setup-projects-using-git-and-github"><i class="fa fa-check"></i>Setup projects using Git and GitHub</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="annotate.html"><a href="annotate.html"><i class="fa fa-check"></i><b>B</b> Annotate the course notes</a></li>
<li class="chapter" data-level="C" data-path="help.html"><a href="help.html"><i class="fa fa-check"></i><b>C</b> Getting help</a>
<ul>
<li class="chapter" data-level="" data-path="help.html"><a href="help.html#study-café"><i class="fa fa-check"></i>Study café</a>
<ul>
<li class="chapter" data-level="" data-path="help.html"><a href="help.html#need-help---ask-a-question"><i class="fa fa-check"></i>Need help - ask a question</a></li>
<li class="chapter" data-level="" data-path="help.html"><a href="help.html#current-queue"><i class="fa fa-check"></i>Current queue</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="D" data-path="slides.html"><a href="slides.html"><i class="fa fa-check"></i><b>D</b> Slides</a></li>
<li class="chapter" data-level="E" data-path="lg-apdx.html"><a href="lg-apdx.html"><i class="fa fa-check"></i><b>E</b> Learning goals</a></li>
<li class="chapter" data-level="F" data-path="sec-ba.html"><a href="sec-ba.html"><i class="fa fa-check"></i><b>F</b> Business Analytics</a></li>
<li class="chapter" data-level="G" data-path="colophon.html"><a href="colophon.html"><i class="fa fa-check"></i><b>G</b> Colophon</a></li>
<li class="divider"></li>
<li><center>
  <a rel="license" href="./index.html#ack">
    License: CC BY-NC-SA<br>
    <i class = "fab fa-creative-commons fa-2x"></i>
    <i class = "fab fa-creative-commons-by fa-2x"></i>
    <i class = "fab fa-creative-commons-nc fa-2x"></i>
    <i class = "fab fa-creative-commons-sa fa-2x"></i>
  </a>
</li></center>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tools for Analytics (TFA)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sec-plot" class="section level1" number="9">
<h1><span class="header-section-number">Module 9</span> Data visualization using ggplot</h1>
<p>This module considers visualization of your data using the [ggplot2][tidyverse-ggplot2] package which is a part of [tidyverse][tidyverse-main-page]. R has several systems for making plots, but ggplot2 is one of the most elegant and most versatile. Using ggplot2 you can do more faster by learning one system and applying it in many places.</p>
<div id="lo-plot" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Learning outcomes</h2>
<p>By the end of this module, you are expected to:</p>
<ul>
<li>Know how to create basic plots using ggplot.</li>
<li>Formulate the ideas behind the grammar of graphics.</li>
<li>Explain the idea behind aesthetics such as color, fill and line type.</li>
<li>Add geometries to a plot such as a histogram, a scatter plot and a line.</li>
<li>Understand how themes can be used to modify the overall look of a plot.</li>
<li>Save plots as variables and different image files.</li>
</ul>
<!-- boxplots -->
<!-- barplots -->
<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->
</div>
<div id="introduction-to-data-visualization" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> Introduction to data visualization</h2>
<p>[ggplot2][tidyverse-ggplot2] is a plotting package that makes it simple to create complex plots from data in a data frame. It provides an interface for specifying what variables to plot, how they are displayed, and general visual properties. Hence only minimal changes are needed if the underlying data change or if we decide to change from a bar plot to a scatterplot.</p>
<p>The package implements the grammar of graphics, a coherent system for describing and building layered plots. A plot is built step by step by adding new layers. Adding layers in this fashion allows for extensive flexibility and customization of plots.</p>
<p>An excellent introduction to data visualization using [ggplot2][tidyverse-ggplot2] is given in the interactive DataCamp course [Introduction to data visualization with ggplot2][datacamp-r-ggplot2-intro]. Please complete the course before continuing.</p>
</div>
<div id="section" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> ???</h2>
<p>[datacamp-r-ggplot2-intermediate]</p>
<!-- In the examples above, we have seen some of the components that make up a plot: -->
<!-- • data and aesthetic mappings, -->
<!-- • geometric objects, -->
<!-- • scales, and -->
<!-- • facet specification. -->
<!-- We have also touched on two other components: -->
<!-- • statistical transformations, and -->
<!-- • the coordinate system. -->
<!-- Together, the data, mappings, statistical transformation, and geometric object form a layer. -->
<!-- A plot may have multiple layers, for example, when we overlay a scatterplot with a -->
<!-- smoothed line. -->
<!-- To be precise, the layered grammar defines the components of a plot as: -->
<!-- • a default dataset and set of mappings from variables to aesthetics, -->
<!-- • one or more layers, with each layer having one geometric object, one statistical transformation, one position adjustment, and optionally, one dataset and set of aesthetic -->
<!-- mappings, -->
<!-- • one scale for each aesthetic mapping used, -->
<!-- • a coordinate system, -->
<!-- • the facet specification. -->
<!-- These high-level components are quite similar to those of Wilkinson’s grammar, as -->
<!-- shown in Figure 4. In both grammars, the components are independent, meaning that we -->
<!-- DataCamp courses chapters in [datacamp-r-tidyverse]  -->
<!-- ## [Other sections] -->
</div>
<div id="lp-r-plot" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Different learning paths</h2>
<p>We are all different and you may like different learning styles compared to others. As a result you may prefer a different learning path than suggested. Here is a list of possible different learning paths that may be useful for you.</p>
<ul>
<li>A detailed introduction to visualization using ggplot2 is given in Chapters 22-29 in <span class="citation">Bryan (<a href="#ref-stat545" role="doc-biblioref">2017</a>)</span>.</li>
<li>A short introduction is given in <a href="https://r4ds.had.co.nz/data-visualisation.html">Chapter 3</a> in <span class="citation">Wickham (<a href="#ref-r4ds" role="doc-biblioref">2017</a>)</span>.</li>
<li>The ‘Data visualization with ggplot2’ cheatsheet is very useful. Find the newest version in RStudio <strong>Help &gt; Cheatsheets</strong>.</li>
<li>A good place to see examples are on the <a href="https://ggplot2.tidyverse.org/reference/index.html">main reference page</a>. Follow the link to the function of interest and have a look at the examples.</li>
</ul>
</div>
<div id="rc-r-plot" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> Recap</h2>
<p>[Summary of learning]</p>
</div>
<div id="ex-r-plot" class="section level2" number="9.6">
<h2><span class="header-section-number">9.6</span> Exercises</h2>
<p>Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck see the <a href="help.html#help">help page</a>. Solutions to each exercise can be seen by pressing the button at each question. Beware you will not learn by giving up to early. Put some effort into finding a solution!</p>
<div id="ex-gapminder2" class="section level3" number="9.6.1">
<h3><span class="header-section-number">9.6.1</span> Exercise (gapminder)</h3>
<p>Use the <em>exercise R markdown template</em> to solve this exercise (<strong>File &gt; New File &gt; R Markdown…</strong>, select <strong>From template</strong> and then <strong>TFA Exercise</strong>).</p>
<p>In this exercise, we will demonstrate how relatively simple ggplot2 code can create insightful and aesthetically pleasing plots. As motivation we will create plots that help us better understand trends in world health and economics.</p>
<!-- As we go through our case study, we will describe relevant general data visualization principles and learn concepts such as _faceting_, _time series plots_, _transformations_,  and _ridge plots_.   -->
<p><a href="https://en.wikipedia.org/wiki/Hans_Rosling">Hans Rosling</a> was the co-founder of the <a href="http://www.gapminder.org/">Gapminder Foundation</a>, an organization dedicated to educating the public by using data to dispel common myths about the so-called developing world. Hans Rosling conveyed actual data-based trends in a dramatic way of his own, using effective data visualization. Here we will try to answer two questions:</p>
<ul>
<li>Is it a fair characterization of today’s world to say it is divided into western rich nations and the developing world in Africa, Asia, and Latin America?</li>
<li>Has income inequality across countries worsened during the last 40 years?</li>
</ul>
<p>To answer these questions, we will be using the <code>gapminder</code> dataset provided in the dslabs package. This dataset was created using a number of spreadsheets available from the Gapminder Foundation. You can access the table like this:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="sec-plot.html#cb123-1" aria-hidden="true"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb123-2"><a href="sec-plot.html#cb123-2" aria-hidden="true"></a><span class="kw">library</span>(dslabs)</span>
<span id="cb123-3"><a href="sec-plot.html#cb123-3" aria-hidden="true"></a><span class="kw">data</span>(gapminder)</span>
<span id="cb123-4"><a href="sec-plot.html#cb123-4" aria-hidden="true"></a>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()</span>
<span id="cb123-5"><a href="sec-plot.html#cb123-5" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 10,545 x 9</span></span>
<span id="cb123-6"><a href="sec-plot.html#cb123-6" aria-hidden="true"></a><span class="co">#&gt;    country    year infant_mortality life_expectancy fertility population      gdp continent region  </span></span>
<span id="cb123-7"><a href="sec-plot.html#cb123-7" aria-hidden="true"></a><span class="co">#&gt;    &lt;fct&gt;     &lt;int&gt;            &lt;dbl&gt;           &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;     &lt;fct&gt;   </span></span>
<span id="cb123-8"><a href="sec-plot.html#cb123-8" aria-hidden="true"></a><span class="co">#&gt;  1 Albania    1960            115.             62.9      6.19    1636054 NA       Europe    Souther…</span></span>
<span id="cb123-9"><a href="sec-plot.html#cb123-9" aria-hidden="true"></a><span class="co">#&gt;  2 Algeria    1960            148.             47.5      7.65   11124892  1.38e10 Africa    Norther…</span></span>
<span id="cb123-10"><a href="sec-plot.html#cb123-10" aria-hidden="true"></a><span class="co">#&gt;  3 Angola     1960            208              36.0      7.32    5270844 NA       Africa    Middle …</span></span>
<span id="cb123-11"><a href="sec-plot.html#cb123-11" aria-hidden="true"></a><span class="co">#&gt;  4 Antigua …  1960             NA              63.0      4.43      54681 NA       Americas  Caribbe…</span></span>
<span id="cb123-12"><a href="sec-plot.html#cb123-12" aria-hidden="true"></a><span class="co">#&gt;  5 Argentina  1960             59.9            65.4      3.11   20619075  1.08e11 Americas  South A…</span></span>
<span id="cb123-13"><a href="sec-plot.html#cb123-13" aria-hidden="true"></a><span class="co">#&gt;  6 Armenia    1960             NA              66.9      4.55    1867396 NA       Asia      Western…</span></span>
<span id="cb123-14"><a href="sec-plot.html#cb123-14" aria-hidden="true"></a><span class="co">#&gt;  7 Aruba      1960             NA              65.7      4.82      54208 NA       Americas  Caribbe…</span></span>
<span id="cb123-15"><a href="sec-plot.html#cb123-15" aria-hidden="true"></a><span class="co">#&gt;  8 Australia  1960             20.3            70.9      3.45   10292328  9.67e10 Oceania   Austral…</span></span>
<span id="cb123-16"><a href="sec-plot.html#cb123-16" aria-hidden="true"></a><span class="co">#&gt;  9 Austria    1960             37.3            68.8      2.7     7065525  5.24e10 Europe    Western…</span></span>
<span id="cb123-17"><a href="sec-plot.html#cb123-17" aria-hidden="true"></a><span class="co">#&gt; 10 Azerbaij…  1960             NA              61.3      5.57    3897889 NA       Asia      Western…</span></span>
<span id="cb123-18"><a href="sec-plot.html#cb123-18" aria-hidden="true"></a><span class="co">#&gt; # … with 10,535 more rows</span></span></code></pre></div>
<p>We start by testing our knowledge regarding differences in child mortality across different countries. For each of the six pairs of countries below, which country do you think had the highest child mortality rates in 2015? Which pairs do you think are most similar?</p>
<ul>
<li>Sri Lanka or Turkey</li>
<li>Poland or South Korea</li>
<li>Malaysia or Russia</li>
<li>Pakistan or Vietnam</li>
<li>Thailand or South Africa</li>
</ul>
<p>When answering these questions without data, the non-European countries are typically picked as having higher child mortality rates: Sri Lanka over Turkey, South Korea over Poland, and Malaysia over Russia. It is also common to assume that countries considered to be part of the developing world: Pakistan, Vietnam, Thailand, and South Africa, have similarly high mortality rates.</p>
<p>To answer these questions <strong>with data</strong>, we can use <strong>dplyr</strong>. For example, for the first comparison we see that:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="sec-plot.html#cb124-1" aria-hidden="true"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb124-2"><a href="sec-plot.html#cb124-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2015</span> <span class="op">&amp;</span><span class="st"> </span>country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Sri Lanka&quot;</span>,<span class="st">&quot;Turkey&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb124-3"><a href="sec-plot.html#cb124-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(country, infant_mortality)</span>
<span id="cb124-4"><a href="sec-plot.html#cb124-4" aria-hidden="true"></a><span class="co">#&gt;     country infant_mortality</span></span>
<span id="cb124-5"><a href="sec-plot.html#cb124-5" aria-hidden="true"></a><span class="co">#&gt; 1 Sri Lanka              8.4</span></span>
<span id="cb124-6"><a href="sec-plot.html#cb124-6" aria-hidden="true"></a><span class="co">#&gt; 2    Turkey             11.6</span></span></code></pre></div>
<p>Turkey has the higher infant mortality rate.</p>
We can use this code on all comparisons and find the following:
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
infant mortality
</th>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
infant mortality
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Sri Lanka
</td>
<td style="text-align:right;">
8.4
</td>
<td style="text-align:left;">
Turkey
</td>
<td style="text-align:right;">
11.6
</td>
</tr>
<tr>
<td style="text-align:left;">
Poland
</td>
<td style="text-align:right;">
4.5
</td>
<td style="text-align:left;">
South Korea
</td>
<td style="text-align:right;">
2.9
</td>
</tr>
<tr>
<td style="text-align:left;">
Malaysia
</td>
<td style="text-align:right;">
6.0
</td>
<td style="text-align:left;">
Russia
</td>
<td style="text-align:right;">
8.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Pakistan
</td>
<td style="text-align:right;">
65.8
</td>
<td style="text-align:left;">
Vietnam
</td>
<td style="text-align:right;">
17.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Thailand
</td>
<td style="text-align:right;">
10.5
</td>
<td style="text-align:left;">
South Africa
</td>
<td style="text-align:right;">
33.6
</td>
</tr>
</tbody>
</table>
<p>We see that the European countries on this list have higher child mortality rates: Poland has a higher rate than South Korea, and Russia has a higher rate than Malaysia. We also see that Pakistan has a much higher rate than Vietnam, and South Africa has a much higher rate than Thailand. It turns out that when Hans Rosling gave this quiz to educated groups of people, the average score was less than 2.5 out of 5, worse than what they would have obtained had they guessed randomly. This implies that we are misinformed. We will try to use visualization to help us being more informed.</p>
<p><strong>The west vs the developing world</strong></p>
<p>There is a preconceived notion that the world is divided into two groups: the western world (Western Europe and North America), characterized by long life spans and small families, versus the developing world (Africa, Asia, and Latin America) characterized by short life spans and large families. But do the data support this dichotomous view?</p>
<p><div aria-labelledby="solution0-title" class="modal fade bs-example-modal-lg" id="solution0" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution0-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">filter(gapminder, year == 1962) %&gt;%
  ggplot( aes(fertility, life_expectancy, color = continent)) +
  geom_point()
</code></pre>

<p>Most points fall into two distinct categories: </p>

<ol>
<li>Life expectancy around 70 years and 3 or fewer children per family.</li>
<li>Life expectancy lower than 65 years and more than 5 children per family.</li>
<li>Countries are from the regions we expect.</li>
</ol>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution0">Solution</button>
<div aria-labelledby="solution1-title" class="modal fade bs-example-modal-lg" id="solution1" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution1-title">Hint</h4>
</div>
<div class="modal-body"><pre><code class="r">filter(gapminder, year == ___) %&gt;%
  ggplot( aes(___, ___, color = ___)) +
  geom_point()
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution1">Hint</button></p>
<ol style="list-style-type: decimal">
<li>Make a scatterplot of life expectancy versus fertility rates (average number of children per woman) in 1962. Use continent as color aesthetic.</li>
</ol>
<p><div aria-labelledby="solution2-title" class="modal fade bs-example-modal-lg" id="solution2" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution2-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">filter(gapminder, year %in% c(1962, 2012)) %&gt;%
  ggplot(aes(fertility, life_expectancy, col = continent)) +
  geom_point() +
  facet_grid(cols = vars(year))
</code></pre>

<p>This plot clearly shows that the majority of countries have moved from the <em>developing world</em> cluster to the <em>western world</em> one. In 2012, the western versus developing world view no longer makes sense. This is particularly clear when comparing Europe to Asia, the latter of which includes several countries that have made great improvements.</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution2">Solution</button>
<div aria-labelledby="solution3-title" class="modal fade bs-example-modal-lg" id="solution3" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution3-title">Hint</h4>
</div>
<div class="modal-body"><pre><code class="r">filter(gapminder, ___ %in% c(1962, 2012)) %&gt;%
  ggplot(aes(___, ___, col = ___)) +
  geom_point() +
  facet_grid(cols = vars(___))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution3">Hint</button></p>
<ol start="2" style="list-style-type: decimal">
<li><p>In 1962, “the West versus developing world” view was grounded in some reality. Is this still the case 50 years later?</p>
<p><em>Hint: we could easily plot the 2012 data in the same way we did for 1962. To make comparisons, side by side plots are preferable. In <strong>ggplot2</strong>, we can achieve this by <em>faceting</em> variables and making a plot for each year. That is, you must filter by years 1962 and 2012 and add the layer <code>facet_grid</code>, which automatically separates the plots.</em></p></li>
</ol>
<p><div aria-labelledby="solution4-title" class="modal fade bs-example-modal-lg" id="solution4" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution4-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">years &lt;- c(1962, 1970, 1980, 1990, 2000, 2012)
continents &lt;- c(&quot;Europe&quot;, &quot;Asia&quot;)
gapminder %&gt;% 
  filter(year %in% years &amp; continent %in% continents) %&gt;%
  ggplot( aes(fertility, life_expectancy, col = continent)) +
  geom_point() +
  facet_wrap(vars(year))
</code></pre>

<p>The plot clearly shows how most Asian countries have improved at a much faster rate than European ones.</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution4">Solution</button>
<div aria-labelledby="solution5-title" class="modal fade bs-example-modal-lg" id="solution5" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution5-title">Hint</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  filter(year %in% ___ &amp; continent %in% ___) %&gt;%
  ggplot(aes(___)) +
  geom_point() +
  facet_wrap(___)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution5">Hint</button></p>
<ol start="3" style="list-style-type: decimal">
<li><p>To explore the transformation through the years, make a plot for years 1962, 1970, 1980, 1990, 2000 and 2012 considering Europe and Asia. How has Asia transformed through the years compared to Europe?</p>
<p><em>Hint: since we consider many years, we will not want all the plots on the same row. Instead, we will want to use multiple rows and columns. The function <code>facet_wrap</code> permits us to do this by automatically wrapping the series of plots.</em></p></li>
</ol>
<div class="box">
<p><strong>Observation - scales</strong></p>
<p>The default choice of the range of the axes is important. When not using <code>facet</code>, this range is determined by the data shown in the plot. When using <code>facet</code>, this range is determined by the data shown in all plots and therefore kept fixed across plots. This makes comparisons across plots much easier. For example, in the above plot, we can see that life expectancy has increased and the fertility has decreased across most countries. We see this because the cloud of points moves. This is not the case if we adjust the scales:</p>
<p><img src="TFA_files/figure-html/unnamed-chunk-253-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>In the plot above, we have to pay special attention to the range to notice that the plot on the right has a larger life expectancy.</p>
</div>
<p><div aria-labelledby="solution6-title" class="modal fade bs-example-modal-lg" id="solution6" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution6-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  filter(continent == &quot;Asia&quot;) %&gt;%
  ggplot(aes(fertility, life_expectancy, col = year)) +
  geom_point()
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution6">Solution</button>
<div aria-labelledby="solution7-title" class="modal fade bs-example-modal-lg" id="solution7" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution7-title">Hint</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  filter(___) %&gt;%
  ggplot(aes(___)) +
  geom_point()
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution7">Hint</button></p>
<ol start="4" style="list-style-type: decimal">
<li>Illustrate the transformation for Asia using a single plot where use year as color aesthetic.</li>
</ol>
<p><strong>Time series plots</strong></p>
<p>The visualizations above effectively illustrate that data no longer supports the western versus developing world view. Once we see these plots, new questions emerge. For example, which countries are improving more and which ones less? Was the improvement constant during the last 50 years or was it more accelerated during certain periods? For a closer look that may help answer these questions, we introduce <em>time series plots</em>.</p>
<p>Time series plots have time in the x-axis and an outcome or measurement of interest on the y-axis. For example, here is a trend plot of United States fertility rates:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="sec-plot.html#cb125-1" aria-hidden="true"></a>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb125-2"><a href="sec-plot.html#cb125-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;United States&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb125-3"><a href="sec-plot.html#cb125-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, fertility)) <span class="op">+</span></span>
<span id="cb125-4"><a href="sec-plot.html#cb125-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="TFA_files/figure-html/fertility-time-series-plot-points-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>We see that the trend is not linear at all. Instead there is sharp drop during the 1960s and 1970s to below 2. Then the trend comes back to 2 and stabilizes during the 1990s.</p>
<p>When the points are regularly and densely spaced, as they are here, we create curves by joining the points with lines, to convey that these data are from a single series, here a country. To do this, we use the <code>geom_line</code> function instead of <code>geom_point</code>.</p>
<div aria-labelledby="solution8-title" class="modal fade bs-example-modal-lg" id="solution8" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution8-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  filter(country == &quot;United States&quot;) %&gt;% 
  ggplot(aes(year, fertility)) +
  geom_line()
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution8">Solution</button>
<ol start="5" style="list-style-type: decimal">
<li>Make a lineplot showing the time series of fertility versus year for United States.</li>
</ol>
<p><div aria-labelledby="solution9-title" class="modal fade bs-example-modal-lg" id="solution9" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution9-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">countries &lt;- c(&quot;South Korea&quot;, &quot;Germany&quot;)
gapminder %&gt;% filter(country %in% countries) %&gt;% 
  ggplot(aes(year, fertility, col = country)) +
  geom_line()
</code></pre>

<p>The plot clearly shows how South Korea&#39;s fertility rate dropped drastically during the 1960s and 1970s, and by 1990 had a similar rate to that of Germany.</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution9">Solution</button>
<div aria-labelledby="solution10-title" class="modal fade bs-example-modal-lg" id="solution10" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution10-title">Hint</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% filter(country %in% ___) %&gt;% 
  ggplot(aes(year, fertility, col = ___)) +
  geom_line()
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution10">Hint</button></p>
<ol start="6" style="list-style-type: decimal">
<li>Lineplots is particularly helpful when we look at more countries. Make a lineplot showing the time series of fertility versus year for South Korea and Germany. Use country as color aesthetic.</li>
</ol>
<div aria-labelledby="solution11-title" class="modal fade bs-example-modal-lg" id="solution11" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution11-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  filter(country %in% countries) %&gt;% 
  ggplot(aes(year, life_expectancy, col = country)) +
  geom_line()
</code></pre>

<p>The plot clearly shows how an improvement in life expectancy followed the drops in fertility rates. In 1960, Germans lived 15 years longer than South Koreans, although by 2010 the gap is completely closed. It exemplifies the improvement that many non-western countries have achieved in the last 40 years.</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution11">Solution</button>
<ol start="7" style="list-style-type: decimal">
<li>Make a lineplot showing the time series of life expectancy versus year for South Korea and Germany. Use country as color aesthetic.</li>
</ol>
<p><strong>Data transformations</strong></p>
<p>We now shift our attention to the second question related to the commonly held notion that wealth distribution across the world has become worse during the last decades. When general audiences are asked if poor countries have become poorer and rich countries become richer, the majority answers yes. By using stratification, histograms, smooth densities, and boxplots, we will be able to understand if this is in fact the case. First we learn how transformations can sometimes help provide more informative summaries and plots.</p>
<p>The <code>gapminder</code> data table includes a column with the countries’ gross domestic product (GDP). GDP measures the market value of goods and services produced by a country in a year. The GDP per person is often used as a rough summary of a country’s wealth. Here we divide this quantity by 365 to obtain the more interpretable measure <em>dollars per day</em>. Using current US dollars as a unit, a person surviving on an income of less than $2 a day is defined to be living in <em>absolute poverty</em>. We add this variable to the data table:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="sec-plot.html#cb126-1" aria-hidden="true"></a>gapminder &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb126-2"><a href="sec-plot.html#cb126-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dollars_per_day =</span> gdp<span class="op">/</span>population<span class="op">/</span><span class="dv">365</span>)</span></code></pre></div>
<p>The GDP values are adjusted for inflation and represent current US dollars, so these values are meant to be comparable across the years. Of course, these are country averages and within each country there is much variability. All the graphs and insights described below relate to country averages and not to individuals.</p>
<p>Here is a histogram of per day incomes from 1970:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="sec-plot.html#cb127-1" aria-hidden="true"></a>past_year &lt;-<span class="st"> </span><span class="dv">1970</span></span>
<span id="cb127-2"><a href="sec-plot.html#cb127-2" aria-hidden="true"></a>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb127-3"><a href="sec-plot.html#cb127-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span>past_year <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(gdp)) <span class="op">%&gt;%</span></span>
<span id="cb127-4"><a href="sec-plot.html#cb127-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(dollars_per_day)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb127-5"><a href="sec-plot.html#cb127-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="TFA_files/figure-html/dollars-per-day-distribution-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>We use the <code>color = "black"</code> argument to draw a boundary and clearly distinguish the bins.</p>
<p>In this plot, we see that for the majority of countries, averages are below $10 a day. However, the majority of the x-axis is dedicated to the 35 countries with averages above $10. So the plot is not very informative about countries with values below $10 a day.</p>
<p>It might be more informative to quickly be able to see how many countries have average daily incomes of about $1 (extremely poor), $2 (very poor), $4 (poor), $8 (middle), $16 (well off), $32 (rich), $64 (very rich) per day. These changes are multiplicative and log transformations convert multiplicative changes into additive ones: when using base 2, a doubling of a value turns into an increase by 1.</p>
<div aria-labelledby="solution12-title" class="modal fade bs-example-modal-lg" id="solution12" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution12-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  filter(year == past_year &amp; !is.na(gdp)) %&gt;%
  ggplot(aes(log2(dollars_per_day))) + 
  geom_histogram(binwidth = 1, color = &quot;black&quot;)
</code></pre>

<p>This provides a <em>close-up</em> of the mid to lower income countries.</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution12">Solution</button>
<ol start="8" style="list-style-type: decimal">
<li>Make a histogram of <code>log2(dollars_per_day)</code> from 1970.</li>
</ol>
<div class="box">
<p><strong>Observation - Which base?</strong></p>
<p>In the case above, we used base 2 in the log transformations. Other common choices are base <span class="math inline">\(\mathrm{e}\)</span> (the natural log) and base 10.</p>
<p>In general, we do not recommend using the natural log for data exploration and visualization. This is because while <span class="math inline">\(2^2, 2^3, 2^4, \dots\)</span> or <span class="math inline">\(10^2, 10^3, \dots\)</span> are easy to compute in our heads, the same is not true for <span class="math inline">\(\mathrm{e}^2, \mathrm{e}^3, \dots\)</span>, so the scale is not intuitive or easy to interpret.</p>
<p>In the dollars per day example, we used base 2 instead of base 10 because the resulting range is easier to interpret. The range of the values being plotted is 0.327, 48.885.</p>
<p>In base 10, this turns into a range that includes very few integers: just 0 and 1.
With base two, our range includes -2, -1, 0, 1, 2, 3, 4, and 5. It is easier to compute <span class="math inline">\(2^x\)</span> and <span class="math inline">\(10^x\)</span> when <span class="math inline">\(x\)</span> is an integer and between -10 and 10, so we prefer to have smaller integers in the scale. Another consequence of a limited range is that choosing the binwidth is more challenging. With log base 2, we know that a binwidth of 1 will translate to a bin with range <span class="math inline">\(x\)</span> to <span class="math inline">\(2x\)</span>.</p>
<p>For an example in which base 10 makes more sense, consider population sizes. A log base 10 is preferable since the range for these is:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="sec-plot.html#cb128-1" aria-hidden="true"></a><span class="kw">filter</span>(gapminder, year <span class="op">==</span><span class="st"> </span>past_year) <span class="op">%&gt;%</span></span>
<span id="cb128-2"><a href="sec-plot.html#cb128-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">min =</span> <span class="kw">min</span>(population), <span class="dt">max =</span> <span class="kw">max</span>(population))</span>
<span id="cb128-3"><a href="sec-plot.html#cb128-3" aria-hidden="true"></a><span class="co">#&gt;     min      max</span></span>
<span id="cb128-4"><a href="sec-plot.html#cb128-4" aria-hidden="true"></a><span class="co">#&gt; 1 46075 8.09e+08</span></span></code></pre></div>
<p>Here is the histogram of the transformed values:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="sec-plot.html#cb129-1" aria-hidden="true"></a>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb129-2"><a href="sec-plot.html#cb129-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span>past_year) <span class="op">%&gt;%</span></span>
<span id="cb129-3"><a href="sec-plot.html#cb129-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="kw">log10</span>(population))) <span class="op">+</span></span>
<span id="cb129-4"><a href="sec-plot.html#cb129-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="TFA_files/figure-html/population-histogram-log10-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>In the above, we quickly see that country populations range between ten thousand and ten billion.</p>
</div>
<p>There are two ways we can use log transformations in plots. We can log the values before plotting them or use log scales on the axes. Both approaches are useful and have different strengths. If we log the data, we can more easily interpret intermediate values in the scale. For example, if we see:</p>
<p><code>----1----x----2--------3----</code></p>
<p>for log transformed data, we know that the value of <span class="math inline">\(x\)</span> is about 1.5. If the scales are logged:</p>
<p><code>----1----x----10------100---</code></p>
<p>then, to determine <code>x</code>, we need to compute <span class="math inline">\(10^{1.5}\)</span>, which is not easy to do in our heads. The advantage of using logged scales is that we see the original values on the axes. However, the advantage of showing logged scales is that the original values are displayed in the plot, which are easier to interpret. For example, we would see “32 dollars a day” instead of “5 log base 2 dollars a day”.</p>
<div aria-labelledby="solution13-title" class="modal fade bs-example-modal-lg" id="solution13" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution13-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  filter(year == past_year &amp; !is.na(gdp)) %&gt;%
  ggplot(aes(dollars_per_day)) + 
  geom_histogram(binwidth = 1, color = &quot;black&quot;) +
  scale_x_continuous(trans = &quot;log2&quot;)
</code></pre>

<p>The plot from Q8 is the same except the values on the x-axis.</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution13">Solution</button>
<ol start="9" style="list-style-type: decimal">
<li><p>Make a histogram of <code>dollars_per_day</code> from 1970 using a log2 scale on the x-axis. Compare it to the plot from Question 8.</p>
<p><em>Hint: you can use the <code>scale_x_continuous</code> function with <code>trans = "log2"</code>.</em></p></li>
</ol>
<p>The histograms in Question 8 and 9 have two <em>bumps</em>: one at about 4 and another at about 32. In statistics these bumps are sometimes referred to as <em>modes</em>. The mode of a distribution is the value with the highest frequency. The mode of the normal distribution is the average. When a distribution, like the one above, doesn’t monotonically decrease from the mode, we call the locations where it goes up and down again <em>local modes</em> and say that the distribution has <em>multiple modes</em> indicating different distributions for different groups.</p>
<p>The histogram above suggests that the 1970 country income distribution has two modes: one at about 2 dollars per day (1 in the log 2 scale) and another at about 32 dollars per day (5 in the log 2 scale). However, the histogram does not show us if the two groups of countries are <em>west</em> versus the <em>rest</em>. Let us create the <code>group</code> column:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="sec-plot.html#cb130-1" aria-hidden="true"></a>gapminder &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb130-2"><a href="sec-plot.html#cb130-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">group =</span> <span class="kw">case_when</span>(</span>
<span id="cb130-3"><a href="sec-plot.html#cb130-3" aria-hidden="true"></a>    region <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Western Europe&quot;</span>, <span class="st">&quot;Northern Europe&quot;</span>,<span class="st">&quot;Southern Europe&quot;</span>, </span>
<span id="cb130-4"><a href="sec-plot.html#cb130-4" aria-hidden="true"></a>                  <span class="st">&quot;Northern America&quot;</span>, <span class="st">&quot;Australia and New Zealand&quot;</span>) <span class="op">~</span><span class="st"> &quot;West&quot;</span>,</span>
<span id="cb130-5"><a href="sec-plot.html#cb130-5" aria-hidden="true"></a>    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;Rest&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb130-6"><a href="sec-plot.html#cb130-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">as_tibble</span>()</span></code></pre></div>
<p><div aria-labelledby="solution14-title" class="modal fade bs-example-modal-lg" id="solution14" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution14-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  filter(year == past_year &amp; !is.na(gdp)) %&gt;%
  ggplot(aes(dollars_per_day)) + 
  geom_histogram(binwidth = 1, color = &quot;black&quot;) +
  facet_grid(cols = vars(group)) +
  scale_x_continuous(trans = &quot;log2&quot;)
</code></pre>

<p>The plot confirms the west vs the rest dichotomy.</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution14">Solution</button>
<div aria-labelledby="solution15-title" class="modal fade bs-example-modal-lg" id="solution15" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution15-title">Hint</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  filter(year == past_year &amp; !is.na(gdp)) %&gt;%
  ggplot(aes(dollars_per_day)) + 
  geom_histogram(binwidth = 1, color = &quot;black&quot;) +
  facet_grid(cols = ___) +
  scale_x_continuous(trans = &quot;log2&quot;)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution15">Hint</button></p>
<ol start="10" style="list-style-type: decimal">
<li>Make a histogram of <code>dollars_per_day</code> from 1970 using a log2 scale and <em>facet</em> it by group. Is there a <em>west</em> versus the <em>rest</em> dichotomy?</li>
</ol>
<p>The exploratory data analysis above has revealed two characteristics about average income distribution in 1970. Using a histogram, we found a bimodal distribution with the modes relating to poor and rich countries. We will try to visualize these summaries in one plot.</p>
<p><div aria-labelledby="solution16-title" class="modal fade bs-example-modal-lg" id="solution16" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution16-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  filter(year == past_year &amp; !is.na(gdp)) %&gt;%
  ggplot(aes(group, dollars_per_day)) +
  geom_boxplot() +
  scale_y_continuous(trans = &quot;log2&quot;) + 
  geom_point()
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution16">Solution</button>
<div aria-labelledby="solution17-title" class="modal fade bs-example-modal-lg" id="solution17" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution17-title">Hint</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  filter(year == past_year &amp; !is.na(gdp)) %&gt;%
  ggplot(aes(group, dollars_per_day)) +
  geom____() +
  scale_y_continuous(trans = &quot;log2&quot;) + 
  geom____()
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution17">Hint</button></p>
<ol start="11" style="list-style-type: decimal">
<li>Make a boxplot (<code>geom_boxplot</code>) of <code>dollars_per_day</code> (y-axis) versus <code>group</code> (x-axis) from 1970 using a log2 scale. Also add a the data using <code>geom_point()</code>.</li>
</ol>
<p>Data exploration clearly shows that in 1970 there was a “west versus the rest” dichotomy. But does this dichotomy persist? We first have to be a little careful here since there are more countries represented in 2010 than in 1970: the total counts are larger. One reason for this is that several countries were founded after 1970. For example, the Soviet Union divided into several countries during the 1990s. Another reason is that data was available for more countries in 2010. Hence we only have to consider the countries with data available for both years:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="sec-plot.html#cb131-1" aria-hidden="true"></a>past_year &lt;-<span class="st"> </span><span class="dv">1970</span></span>
<span id="cb131-2"><a href="sec-plot.html#cb131-2" aria-hidden="true"></a>present_year &lt;-<span class="st"> </span><span class="dv">2010</span></span>
<span id="cb131-3"><a href="sec-plot.html#cb131-3" aria-hidden="true"></a>years &lt;-<span class="st"> </span><span class="kw">c</span>(past_year, present_year)</span>
<span id="cb131-4"><a href="sec-plot.html#cb131-4" aria-hidden="true"></a>country_list_<span class="dv">1</span> &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-5"><a href="sec-plot.html#cb131-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span>past_year <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(dollars_per_day)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-6"><a href="sec-plot.html#cb131-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">pull</span>(country)</span>
<span id="cb131-7"><a href="sec-plot.html#cb131-7" aria-hidden="true"></a></span>
<span id="cb131-8"><a href="sec-plot.html#cb131-8" aria-hidden="true"></a>country_list_<span class="dv">2</span> &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-9"><a href="sec-plot.html#cb131-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span>present_year <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(dollars_per_day)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-10"><a href="sec-plot.html#cb131-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">pull</span>(country)</span>
<span id="cb131-11"><a href="sec-plot.html#cb131-11" aria-hidden="true"></a>      </span>
<span id="cb131-12"><a href="sec-plot.html#cb131-12" aria-hidden="true"></a>country_list &lt;-<span class="st"> </span><span class="kw">intersect</span>(country_list_<span class="dv">1</span>, country_list_<span class="dv">2</span>)</span></code></pre></div>
<p>We can now filter the rows by <code>years</code> and <code>country_list</code>.</p>
<p><div aria-labelledby="solution18-title" class="modal fade bs-example-modal-lg" id="solution18" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution18-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  filter(year %in% years &amp; country %in% country_list) %&gt;%
  ggplot(aes(dollars_per_day)) +
  geom_histogram(binwidth = 1, color = &quot;black&quot;) +
  scale_x_continuous(trans = &quot;log2&quot;) + 
  facet_grid(year ~ group)
</code></pre>

<p>The income gap between rich and poor countries has narrowed considerably during the last 40 years</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution18">Solution</button>
<div aria-labelledby="solution19-title" class="modal fade bs-example-modal-lg" id="solution19" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution19-title">Hint</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  filter(year %in% ___ &amp; country %in% ___) %&gt;%
  ggplot(aes(dollars_per_day)) +
  geom_histogram(binwidth = 1, color = &quot;black&quot;) +
  scale_x_continuous(trans = &quot;log2&quot;) + 
  facet_grid(___)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution19">Hint</button></p>
<ol start="12" style="list-style-type: decimal">
<li>Make a histogram of <code>dollars_per_day</code> from 1970 and 2010 using a log2 scale and <em>facet</em> it by group and year. Does the dichotomy persist?</li>
</ol>
<p><div aria-labelledby="solution20-title" class="modal fade bs-example-modal-lg" id="solution20" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution20-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  filter(year %in% years &amp; country %in% country_list) %&gt;%
  mutate(year = factor(year)) %&gt;%
  ggplot(aes(group, dollars_per_day, fill = year)) +
  geom_boxplot() +
  scale_y_continuous(trans = &quot;log2&quot;)
</code></pre>

<p>We now see that the rich countries have become a bit richer, but percentage-wise, the poor countries appear to have improved more. In particular, we see that the proportion of <em>developing</em> countries earning more than $16 a day increased substantially.</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution20">Solution</button>
<div aria-labelledby="solution21-title" class="modal fade bs-example-modal-lg" id="solution21" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution21-title">Hint</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  filter(year %in% years &amp; country %in% country_list) %&gt;%
  mutate(year = factor(___)) %&gt;%
  ggplot(aes(group, dollars_per_day, fill = ___)) +
  geom_boxplot() +
  scale_y_continuous(trans = &quot;log2&quot;)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution21">Hint</button></p>
<ol start="13" style="list-style-type: decimal">
<li><p>Make a boxplot of <code>dollars_per_day</code> versus <code>group</code> from 1970 and 2010 using a log2 scale. Use year as fill aesthetic.</p>
<p><em>Hint: you must convert year to a factor using <code>mutate(year = factor(year))</code>.</em></p></li>
</ol>
<p>The previous data exploration suggested that the income gap between rich and poor countries has narrowed considerably during the last 40 years.
We used a series of histograms and boxplots to see this. Let us now shift to density plots. Let’s start by noting that density plots for income distribution in 1970 and 2010 deliver the message that the gap is closing:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="sec-plot.html#cb132-1" aria-hidden="true"></a>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb132-2"><a href="sec-plot.html#cb132-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">%in%</span><span class="st"> </span>years <span class="op">&amp;</span><span class="st"> </span>country <span class="op">%in%</span><span class="st"> </span>country_list) <span class="op">%&gt;%</span></span>
<span id="cb132-3"><a href="sec-plot.html#cb132-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(dollars_per_day)) <span class="op">+</span></span>
<span id="cb132-4"><a href="sec-plot.html#cb132-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;grey&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb132-5"><a href="sec-plot.html#cb132-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">trans =</span> <span class="st">&quot;log2&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb132-6"><a href="sec-plot.html#cb132-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="dt">cols =</span> <span class="kw">vars</span>(year))</span></code></pre></div>
<p><img src="TFA_files/figure-html/income-smooth-density-by-year-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>In the 1970 plot, we see two clear modes: poor and rich countries. In 2010, it appears that some of the poor countries have shifted towards the right, closing the gap.</p>
<p>The next message we need to convey is that the reason for this change in distribution is that several poor countries became richer, rather than some rich countries becoming poorer. To do this, we can assign a color to the groups we identified during data exploration.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="sec-plot.html#cb133-1" aria-hidden="true"></a>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-2"><a href="sec-plot.html#cb133-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">%in%</span><span class="st"> </span>years <span class="op">&amp;</span><span class="st"> </span>country <span class="op">%in%</span><span class="st"> </span>country_list) <span class="op">%&gt;%</span></span>
<span id="cb133-3"><a href="sec-plot.html#cb133-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(dollars_per_day, <span class="dt">fill =</span> group)) <span class="op">+</span></span>
<span id="cb133-4"><a href="sec-plot.html#cb133-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">trans =</span> <span class="st">&quot;log2&quot;</span>) <span class="op">+</span></span>
<span id="cb133-5"><a href="sec-plot.html#cb133-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb133-6"><a href="sec-plot.html#cb133-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="dt">cols =</span> <span class="kw">vars</span>(year))</span></code></pre></div>
<p><img src="TFA_files/figure-html/income-smooth-density-by-year-west-v-developing-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Note the default is to have the area represented by each distribution add up to 1, regardless of the size of each group: the number of countries in the ‘west’ group is 21 and in the ‘rest’ group is 87. We may use count on the y-axis instead:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="sec-plot.html#cb134-1" aria-hidden="true"></a>p &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb134-2"><a href="sec-plot.html#cb134-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">%in%</span><span class="st"> </span>years <span class="op">&amp;</span><span class="st"> </span>country <span class="op">%in%</span><span class="st"> </span>country_list) <span class="op">%&gt;%</span></span>
<span id="cb134-3"><a href="sec-plot.html#cb134-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(dollars_per_day, <span class="dt">y =</span> ..count.., <span class="dt">fill =</span> group)) <span class="op">+</span></span>
<span id="cb134-4"><a href="sec-plot.html#cb134-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">trans =</span> <span class="st">&quot;log2&quot;</span>, <span class="dt">limit =</span> <span class="kw">c</span>(<span class="fl">0.125</span>, <span class="dv">300</span>)) <span class="op">+</span></span>
<span id="cb134-5"><a href="sec-plot.html#cb134-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="dt">cols =</span> <span class="kw">vars</span>(year))</span>
<span id="cb134-6"><a href="sec-plot.html#cb134-6" aria-hidden="true"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>) </span></code></pre></div>
<p><img src="TFA_files/figure-html/income-smooth-density-counts-1.png" width="672" style="display: block; margin: auto;" /></p>
<div aria-labelledby="solution22-title" class="modal fade bs-example-modal-lg" id="solution22" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution22-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">p + geom_density(alpha = 0.2, bw = 0.75)
</code></pre>

<p>This plot now shows that the developing world distribution is changing.</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution22">Solution</button>
<ol start="14" style="list-style-type: decimal">
<li>To get densities smoother, use <code>bw = 0.75</code> argument so that the same bandwidth is used in each density. Comment on the plot.</li>
</ol>
<p>As a final point, we note that in these distributions weigh every country the same. So if most of the population is improving, but living in a very large country, such as China, we might not appreciate this. We can actually weight the smooth densities using the <code>weight</code> mapping argument. First we modify the dataset:</p>
<p><div aria-labelledby="solution23-title" class="modal fade bs-example-modal-lg" id="solution23" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution23-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  ggplot(aes(dollars_per_day, fill = group, weight = weight)) +
  scale_x_continuous(trans = &quot;log2&quot;, limit = c(0.125, 300)) + 
  geom_density(alpha = 0.2, bw = 0.75) + 
  facet_grid(cols = vars(year))
</code></pre>

<p>We now see that the rich countries have become a bit richer, but percentage-wise, the poor countries appear to have improved more. In particular, we see that the proportion of <em>developing</em> countries earning more than $16 a day increased substantially.</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution23">Solution</button>
<div aria-labelledby="solution24-title" class="modal fade bs-example-modal-lg" id="solution24" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution24-title">Hint</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  ggplot(aes(dollars_per_day, fill = group, weight = ___)) +
  scale_x_continuous(trans = &quot;log2&quot;, limit = c(0.125, 300)) + 
  geom_density(alpha = 0.2, bw = 0.75) + 
  facet_grid(cols = vars(year))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution24">Hint</button></p>
<ol start="15" style="list-style-type: decimal">
<li>Modify the ggplot function with a weight argument and plot the density (with area equal 1).</li>
</ol>
</div>
<div id="ex-profit2" class="section level3" number="9.6.2">
<h3><span class="header-section-number">9.6.2</span> Exercise (profit)</h3>
<p>Use the <em>exercise R markdown template</em> to solve this exercise (<strong>File &gt; New File &gt; R Markdown…</strong>, select <strong>From template</strong> and then <strong>TFA Exercise</strong>).</p>
<p>Consider the dataset profit (provided by the tfa package) containing quarterly financial records for each costumer, product, etc.:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="sec-plot.html#cb135-1" aria-hidden="true"></a><span class="kw">library</span>(tfa)</span>
<span id="cb135-2"><a href="sec-plot.html#cb135-2" aria-hidden="true"></a><span class="kw">library</span>(skimr)</span>
<span id="cb135-3"><a href="sec-plot.html#cb135-3" aria-hidden="true"></a><span class="kw">glimpse</span>(profit)</span>
<span id="cb135-4"><a href="sec-plot.html#cb135-4" aria-hidden="true"></a><span class="co">#&gt; Rows: 24,546</span></span>
<span id="cb135-5"><a href="sec-plot.html#cb135-5" aria-hidden="true"></a><span class="co">#&gt; Columns: 12</span></span>
<span id="cb135-6"><a href="sec-plot.html#cb135-6" aria-hidden="true"></a><span class="co">#&gt; $ Quarter                 &lt;dbl&gt; 3, 1, 4, 1, 4, 3, 4, 3, 4, 1, 1, 3, 3, 3, 2, 2, 1, 2, 3, 2, 2, 2,…</span></span>
<span id="cb135-7"><a href="sec-plot.html#cb135-7" aria-hidden="true"></a><span class="co">#&gt; $ Channel                 &lt;chr&gt; &quot;ATM&quot;, &quot;ATM&quot;, &quot;ATM&quot;, &quot;ATM&quot;, &quot;ATM&quot;, &quot;BRH&quot;, &quot;BRH&quot;, &quot;ATM&quot;, &quot;BRH&quot;, &quot;B…</span></span>
<span id="cb135-8"><a href="sec-plot.html#cb135-8" aria-hidden="true"></a><span class="co">#&gt; $ `Customer ID`           &lt;chr&gt; &quot;FRT&quot;, &quot;MRT&quot;, &quot;PBI&quot;, &quot;PBI&quot;, &quot;MRT&quot;, &quot;MAM&quot;, &quot;PBI&quot;, &quot;FRT&quot;, &quot;PBI&quot;, &quot;P…</span></span>
<span id="cb135-9"><a href="sec-plot.html#cb135-9" aria-hidden="true"></a><span class="co">#&gt; $ Country                 &lt;chr&gt; &quot;USA&quot;, &quot;USA&quot;, &quot;USA&quot;, &quot;USA&quot;, &quot;USA&quot;, &quot;USA&quot;, &quot;USA&quot;, &quot;USA&quot;, &quot;USA&quot;, &quot;U…</span></span>
<span id="cb135-10"><a href="sec-plot.html#cb135-10" aria-hidden="true"></a><span class="co">#&gt; $ `Product Line`          &lt;chr&gt; &quot;Credit Products&quot;, &quot;Credit Products&quot;, &quot;Deposit Products&quot;, &quot;Deposi…</span></span>
<span id="cb135-11"><a href="sec-plot.html#cb135-11" aria-hidden="true"></a><span class="co">#&gt; $ Revenue                 &lt;dbl&gt; 6044, 4686, 6063, 4682, 6320, 2993, 3355, 5716, 3347, 2624, 3629,…</span></span>
<span id="cb135-12"><a href="sec-plot.html#cb135-12" aria-hidden="true"></a><span class="co">#&gt; $ `Product Cost`          &lt;dbl&gt; 3998, 3229, 7440, 6127, 7913, 1034, 4355, 5617, 4229, 1960, 4650,…</span></span>
<span id="cb135-13"><a href="sec-plot.html#cb135-13" aria-hidden="true"></a><span class="co">#&gt; $ `Customer Service Cost` &lt;dbl&gt; 413, 643, 1842, 1118, 1854, 242, 1027, 876, 425, 264, 700, 1482, …</span></span>
<span id="cb135-14"><a href="sec-plot.html#cb135-14" aria-hidden="true"></a><span class="co">#&gt; $ Profit                  &lt;dbl&gt; 1633, 814, -3219, -2563, -3447, 1717, -2027, -777, -1307, 400, -1…</span></span>
<span id="cb135-15"><a href="sec-plot.html#cb135-15" aria-hidden="true"></a><span class="co">#&gt; $ Profit_calc             &lt;dbl&gt; 1633, 814, -3219, -2563, -3447, 1717, -2027, -777, -1307, 400, -1…</span></span>
<span id="cb135-16"><a href="sec-plot.html#cb135-16" aria-hidden="true"></a><span class="co">#&gt; $ Diff                    &lt;dbl&gt; 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1,…</span></span>
<span id="cb135-17"><a href="sec-plot.html#cb135-17" aria-hidden="true"></a><span class="co">#&gt; $ ct_na                   &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span>
<span id="cb135-18"><a href="sec-plot.html#cb135-18" aria-hidden="true"></a><span class="kw">skim</span>(profit)</span></code></pre></div>
<table style="width: auto;" class="table table-condensed">
<caption>
<span id="tab:unnamed-chunk-278">Table 9.1: </span>Data summary
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
profit
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
24546
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
min
</th>
<th style="text-align:right;">
max
</th>
<th style="text-align:right;">
empty
</th>
<th style="text-align:right;">
n_unique
</th>
<th style="text-align:right;">
whitespace
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Channel
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Customer ID
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Country
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Product Line
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:left;">
hist
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Quarter
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
2.50
</td>
<td style="text-align:right;">
1.12
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
▇▇▁▇▇
</td>
</tr>
<tr>
<td style="text-align:left;">
Revenue
</td>
<td style="text-align:right;">
158
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:right;">
120.31
</td>
<td style="text-align:right;">
421.79
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
74
</td>
<td style="text-align:right;">
7540
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
Product Cost
</td>
<td style="text-align:right;">
61
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
100.04
</td>
<td style="text-align:right;">
375.58
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
68
</td>
<td style="text-align:right;">
9256
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
Customer Service Cost
</td>
<td style="text-align:right;">
96
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
17.41
</td>
<td style="text-align:right;">
67.50
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
1865
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
Profit
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
2.73
</td>
<td style="text-align:right;">
154.89
</td>
<td style="text-align:right;">
-4138
</td>
<td style="text-align:right;">
-7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
3663
</td>
<td style="text-align:left;">
▁▁▇▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
Profit_calc
</td>
<td style="text-align:right;">
312
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:right;">
2.71
</td>
<td style="text-align:right;">
155.31
</td>
<td style="text-align:right;">
-4138
</td>
<td style="text-align:right;">
-7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
3663
</td>
<td style="text-align:left;">
▁▁▇▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
Diff
</td>
<td style="text-align:right;">
312
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
0.47
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
▇▁▁▁▃
</td>
</tr>
<tr>
<td style="text-align:left;">
ct_na
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.11
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
</tbody>
</table>
<ol style="list-style-type: decimal">
<li>Make a barplot that shows the total profitability of the product lines. Use the following steps:
<ol style="list-style-type: lower-alpha">
<li>Convert all character columns to factor columns.
<div aria-labelledby="solution25-title" class="modal fade bs-example-modal-lg" id="solution25" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution25-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit &lt;- profit %&gt;%
  mutate(across(where(is.character), as.factor))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution25">Solution</button></li>
<li>Group by product line, calculate the total profit and plot profit for each product line.
<div aria-labelledby="solution26-title" class="modal fade bs-example-modal-lg" id="solution26" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution26-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit %&gt;% 
  group_by(`Product Line`) %&gt;% 
  summarise(Profit = sum(Profit)) %&gt;% 
  ggplot(aes(x = `Product Line`, y = Profit)) +
  geom_col()
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution26">Solution</button></li>
<li>Plot profit for each product line where product line is reordered based on total profit.
<div aria-labelledby="solution27-title" class="modal fade bs-example-modal-lg" id="solution27" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution27-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit %&gt;% 
  group_by(`Product Line`) %&gt;% 
  summarise(Profit = sum(Profit)) %&gt;% 
  ggplot(aes(x = reorder(`Product Line`, Profit), y = Profit)) +
  geom_col()
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution27">Solution</button></li>
<li>Add a title to the plot using <code>labs</code>.
<div aria-labelledby="solution28-title" class="modal fade bs-example-modal-lg" id="solution28" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution28-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit %&gt;% 
  group_by(`Product Line`) %&gt;% 
  summarise(Profit = sum(Profit)) %&gt;% 
  ggplot(aes(x = reorder(`Product Line`, Profit), y = Profit)) +
  geom_col() + 
  labs(title = &quot;Total profit for each product line&quot;)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution28">Solution</button></li>
<li>Rotate the x-axis labels 90 degrees (try Googling “ggplot2 rotate axis labels”).
<div aria-labelledby="solution29-title" class="modal fade bs-example-modal-lg" id="solution29" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution29-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit %&gt;% 
  group_by(`Product Line`) %&gt;% 
  summarise(Profit = sum(Profit)) %&gt;% 
  ggplot(aes(x = reorder(`Product Line`, Profit), y = Profit)) +
  geom_col() +
  labs(title = &quot;Total profit for each product line&quot;) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution29">Solution</button></li>
</ol>
Which product line is best and worst?</li>
</ol>
<div aria-labelledby="solution30-title" class="modal fade bs-example-modal-lg" id="solution30" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution30-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit %&gt;% 
  group_by(`Product Line`, Quarter) %&gt;% 
  summarise(Profit = sum(Profit)) %&gt;% 
  ggplot(aes(x = reorder(`Product Line`, Profit), y = Profit)) +
  geom_col() +
  facet_grid(cols = vars(Quarter)) +
  labs(title = &quot;Total profit for each product line&quot;) +  
  xlab(&quot;Product Line&quot;) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution30">Solution</button>
<ol start="2" style="list-style-type: decimal">
<li>Make a barplot that shows the total profitability of the product lines in each quarter. Are there details we have missed in Question 1?</li>
</ol>
<div aria-labelledby="solution31-title" class="modal fade bs-example-modal-lg" id="solution31" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution31-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit %&gt;% 
  ggplot(aes(y = Profit, x = reorder(`Product Line`, Profit))) +
  geom_boxplot() +
  labs(title = &quot;Profit for each product line&quot;) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution31">Solution</button>
<ol start="3" style="list-style-type: decimal">
<li>Make a boxplot of profitability of the product lines. Any insight?</li>
</ol>
<div aria-labelledby="solution32-title" class="modal fade bs-example-modal-lg" id="solution32" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution32-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit %&gt;% 
  group_by(`Customer ID`) %&gt;% 
  summarise(Profit = sum(Profit)) %&gt;% 
  ggplot(aes(x = reorder(`Customer ID`, Profit), y = Profit)) +
  geom_col() +
  labs(title = &quot;Mean profit for each product line&quot;) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution32">Solution</button>
<ol start="4" style="list-style-type: decimal">
<li>Make a barplot that shows the total profitability of the customers. Which customer is best and worst?</li>
</ol>
<div aria-labelledby="solution33-title" class="modal fade bs-example-modal-lg" id="solution33" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution33-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit %&gt;% 
  group_by(`Customer ID`) %&gt;% 
  summarise(Profit = mean(Profit)) %&gt;% 
  ggplot(aes(x = reorder(`Customer ID`, Profit), y = Profit)) +
  geom_col() +
  labs(title = &quot;Mean profit for each product line&quot;) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution33">Solution</button>
<ol start="5" style="list-style-type: decimal">
<li>Make a barplot that shows the mean profitability of the customers. Which customer is best and worst? Compare against Question 4 and discuss.</li>
</ol>
<p><div aria-labelledby="solution34-title" class="modal fade bs-example-modal-lg" id="solution34" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution34-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit %&gt;% 
  group_by(`Customer ID`) %&gt;% 
  summarise(Profit = mean(Profit)) %&gt;% 
  ggplot(aes(x = reorder(`Customer ID`, Profit), y = Profit)) +
  geom_col() +
  labs(title = &quot;Mean profit for each product line&quot;) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution34">Solution</button><img src="TFA_files/figure-html/unnamed-chunk-288-1.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>Make a plot illustrating number of transactions for each customer</li>
</ol>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="sec-plot.html#cb136-1" aria-hidden="true"></a>profit <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb136-2"><a href="sec-plot.html#cb136-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(<span class="st">`</span><span class="dt">Customer ID</span><span class="st">`</span>, Profit), <span class="dt">y =</span> Profit)) <span class="op">+</span></span>
<span id="cb136-3"><a href="sec-plot.html#cb136-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></span>
<span id="cb136-4"><a href="sec-plot.html#cb136-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Mean profit for each product line&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb136-5"><a href="sec-plot.html#cb136-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>, <span class="dt">hjust=</span><span class="dv">1</span>))</span>
<span id="cb136-6"><a href="sec-plot.html#cb136-6" aria-hidden="true"></a></span>
<span id="cb136-7"><a href="sec-plot.html#cb136-7" aria-hidden="true"></a></span>
<span id="cb136-8"><a href="sec-plot.html#cb136-8" aria-hidden="true"></a>profit <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb136-9"><a href="sec-plot.html#cb136-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(<span class="st">`</span><span class="dt">Customer ID</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb136-10"><a href="sec-plot.html#cb136-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">t_profit_cust_id =</span> <span class="kw">sum</span>(Profit),</span>
<span id="cb136-11"><a href="sec-plot.html#cb136-11" aria-hidden="true"></a>         <span class="st">`</span><span class="dt">Customer ID</span><span class="st">`</span> =<span class="st"> </span><span class="kw">reorder</span>(<span class="st">`</span><span class="dt">Customer ID</span><span class="st">`</span>, t_profit_cust_id)</span>
<span id="cb136-12"><a href="sec-plot.html#cb136-12" aria-hidden="true"></a>         ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb136-13"><a href="sec-plot.html#cb136-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Profit, <span class="dt">x =</span> <span class="st">`</span><span class="dt">Customer ID</span><span class="st">`</span>)) <span class="op">+</span></span>
<span id="cb136-14"><a href="sec-plot.html#cb136-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></span>
<span id="cb136-15"><a href="sec-plot.html#cb136-15" aria-hidden="true"></a><span class="st">  </span><span class="co"># facet_wrap(facets = vars(reorder(`Customer ID`, Profit))) + </span></span>
<span id="cb136-16"><a href="sec-plot.html#cb136-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Mean profit for each product line&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb136-17"><a href="sec-plot.html#cb136-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>, <span class="dt">hjust=</span><span class="dv">1</span>))</span></code></pre></div>
<p><img src="TFA_files/figure-html/unnamed-chunk-289-1.png" width="672" style="display: block; margin: auto;" /><img src="TFA_files/figure-html/unnamed-chunk-289-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>Density plot</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="sec-plot.html#cb137-1" aria-hidden="true"></a>profit <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb137-2"><a href="sec-plot.html#cb137-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(<span class="st">`</span><span class="dt">Customer ID</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb137-3"><a href="sec-plot.html#cb137-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Profit)) <span class="op">+</span></span>
<span id="cb137-4"><a href="sec-plot.html#cb137-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_density</span>() <span class="op">+</span></span>
<span id="cb137-5"><a href="sec-plot.html#cb137-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="dt">facets =</span> <span class="kw">vars</span>(<span class="kw">reorder</span>(<span class="st">`</span><span class="dt">Customer ID</span><span class="st">`</span>, Profit))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb137-6"><a href="sec-plot.html#cb137-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Mean profit for each product line&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb137-7"><a href="sec-plot.html#cb137-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>, <span class="dt">hjust=</span><span class="dv">1</span>))</span></code></pre></div>
<p><img src="TFA_files/figure-html/unnamed-chunk-290-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="sec-plot.html#cb138-1" aria-hidden="true"></a>profit <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb138-2"><a href="sec-plot.html#cb138-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Profit)) <span class="op">+</span></span>
<span id="cb138-3"><a href="sec-plot.html#cb138-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">10</span>) <span class="op">+</span></span>
<span id="cb138-4"><a href="sec-plot.html#cb138-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Mean profit for each product line&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb138-5"><a href="sec-plot.html#cb138-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>, <span class="dt">hjust=</span><span class="dv">1</span>))</span></code></pre></div>
<p><img src="TFA_files/figure-html/unnamed-chunk-291-1.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Make a plot that shows the total profitability of the product lines in each quarter.</li>
</ol>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="sec-plot.html#cb139-1" aria-hidden="true"></a>profit <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb139-2"><a href="sec-plot.html#cb139-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(Quarter, <span class="st">`</span><span class="dt">Product Line</span><span class="st">`</span>, Country) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb139-3"><a href="sec-plot.html#cb139-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Profit =</span> <span class="kw">mean</span>(Profit)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb139-4"><a href="sec-plot.html#cb139-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Product Line</span><span class="st">`</span>, <span class="dt">y =</span> Profit)) <span class="op">+</span></span>
<span id="cb139-5"><a href="sec-plot.html#cb139-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb139-6"><a href="sec-plot.html#cb139-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb139-7"><a href="sec-plot.html#cb139-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="dt">cols =</span> <span class="kw">vars</span>(Quarter), <span class="dt">rows =</span> <span class="kw">vars</span>(Country)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb139-8"><a href="sec-plot.html#cb139-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Mean profit for each product line&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb139-9"><a href="sec-plot.html#cb139-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>, <span class="dt">hjust=</span><span class="dv">1</span>))</span></code></pre></div>
<p><img src="TFA_files/figure-html/unnamed-chunk-292-1.png" width="672" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-stat545">
<p>Bryan, J. 2017. <em>STAT 545 - Data Wrangling, Exploration, and Analysis with R</em>. <a href="https://stat545.com/">https://stat545.com/</a>.</p>
</div>
<div id="ref-r4ds">
<p>Wickham, H. 2017. <em>R for Data Science</em>. O’Reilly. <a href="https://r4ds.had.co.nz/">https://r4ds.had.co.nz/</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sec-transform.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sec-maps.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/bss-osca/tfa/edit/master/book/plot-intro.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Module 8 Transforming data | Tools for Analytics (TFA)</title>
  <meta name="description" content="Course notes for the ‘Tools for Analytics’ course (R part)" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Module 8 Transforming data | Tools for Analytics (TFA)" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://bss-osca.github.io/tfa/" />
  <meta property="og:image" content="https://bss-osca.github.io/tfa/assets/logo.png" />
  <meta property="og:description" content="Course notes for the ‘Tools for Analytics’ course (R part)" />
  <meta name="github-repo" content="bss-osca/tfa" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Module 8 Transforming data | Tools for Analytics (TFA)" />
  
  <meta name="twitter:description" content="Course notes for the ‘Tools for Analytics’ course (R part)" />
  <meta name="twitter:image" content="https://bss-osca.github.io/tfa/assets/logo.png" />

<meta name="author" content="Lars Relund Nielsen" />


<meta name="date" content="2020-10-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon" />
<link rel="prev" href="sec-io.html"/>
<link rel="next" href="sec-plot.html"/>
<script src="libs/header-attrs-2.4/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/font-awesome-5.3.1/css/all.min.css" rel="stylesheet" />
<link href="libs/font-awesome-5.3.1/css/v4-shims.min.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.16/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<html>
<head>
<script>
  $(document).ready(function() {

  // Section anchors
  $('.section h1, .section h2, .section h3, .section h4, .section h5').each(function() {
    anchor = '#' + $(this).parent().attr('id');
    $(this).addClass("hasAnchor").prepend('<a href="' + anchor + '" class="anchor"></a>');
  });
});
</script>
<script src="https://hypothes.is/embed.js" async></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</head>
</html>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="img/logo.png"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#how-this-book-is-organized"><i class="fa fa-check"></i><b>1.1</b> How this book is organized</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#ack"><i class="fa fa-check"></i><b>1.2</b> Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I Getting started</b></span></li>
<li class="chapter" data-level="2" data-path="sec-install.html"><a href="sec-install.html"><i class="fa fa-check"></i><b>2</b> Install R and RStudio</a>
<ul>
<li class="chapter" data-level="2.1" data-path="sec-install.html"><a href="sec-install.html#lo-install"><i class="fa fa-check"></i><b>2.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="2.2" data-path="sec-install.html"><a href="sec-install.html#install-r"><i class="fa fa-check"></i><b>2.2</b> Install R and RStudio</a></li>
<li class="chapter" data-level="2.3" data-path="sec-install.html"><a href="sec-install.html#test-your-installation"><i class="fa fa-check"></i><b>2.3</b> Test your installation</a></li>
<li class="chapter" data-level="2.4" data-path="sec-install.html"><a href="sec-install.html#add-on-packages"><i class="fa fa-check"></i><b>2.4</b> Add-on packages</a></li>
<li class="chapter" data-level="2.5" data-path="sec-install.html"><a href="sec-install.html#lp-install"><i class="fa fa-check"></i><b>2.5</b> Different learning paths</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sec-r-basics.html"><a href="sec-r-basics.html"><i class="fa fa-check"></i><b>3</b> R basics and workflows</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sec-r-basics.html"><a href="sec-r-basics.html#lo-r-basics"><i class="fa fa-check"></i><b>3.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="3.2" data-path="sec-r-basics.html"><a href="sec-r-basics.html#working-with-r-at-the-command-line-in-rstudio"><i class="fa fa-check"></i><b>3.2</b> Working with R at the command line in RStudio</a></li>
<li class="chapter" data-level="3.3" data-path="sec-r-basics.html"><a href="sec-r-basics.html#your-first-datacamp-course"><i class="fa fa-check"></i><b>3.3</b> Your first DataCamp course</a></li>
<li class="chapter" data-level="3.4" data-path="sec-r-basics.html"><a href="sec-r-basics.html#pipes"><i class="fa fa-check"></i><b>3.4</b> Pipes</a></li>
<li class="chapter" data-level="3.5" data-path="sec-r-basics.html"><a href="sec-r-basics.html#rprojs"><i class="fa fa-check"></i><b>3.5</b> RStudio projects</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="sec-r-basics.html"><a href="sec-r-basics.html#storing-your-code-in-a-script-file"><i class="fa fa-check"></i><b>3.5.1</b> Storing your code in a script file</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="sec-r-basics.html"><a href="sec-r-basics.html#global-options"><i class="fa fa-check"></i><b>3.6</b> Global options</a></li>
<li class="chapter" data-level="3.7" data-path="sec-r-basics.html"><a href="sec-r-basics.html#working-directory"><i class="fa fa-check"></i><b>3.7</b> Working directory</a></li>
<li class="chapter" data-level="3.8" data-path="sec-r-basics.html"><a href="sec-r-basics.html#lp-r-basics"><i class="fa fa-check"></i><b>3.8</b> Different learning paths</a></li>
<li class="chapter" data-level="3.9" data-path="sec-r-basics.html"><a href="sec-r-basics.html#rc-r-basics"><i class="fa fa-check"></i><b>3.9</b> Recap</a></li>
<li class="chapter" data-level="3.10" data-path="sec-r-basics.html"><a href="sec-r-basics.html#ex-r-basics"><i class="fa fa-check"></i><b>3.10</b> Exercises</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-group-work"><i class="fa fa-check"></i><b>3.10.1</b> Exercise (group work)</a></li>
<li class="chapter" data-level="3.10.2" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-install-packages"><i class="fa fa-check"></i><b>3.10.2</b> Exercise (install packages)</a></li>
<li class="chapter" data-level="3.10.3" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-piping"><i class="fa fa-check"></i><b>3.10.3</b> Exercise (piping)</a></li>
<li class="chapter" data-level="3.10.4" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-working-dir"><i class="fa fa-check"></i><b>3.10.4</b> Exercise (working dir)</a></li>
<li class="chapter" data-level="3.10.5" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-vectors"><i class="fa fa-check"></i><b>3.10.5</b> Exercise (vectors)</a></li>
<li class="chapter" data-level="3.10.6" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-matrices"><i class="fa fa-check"></i><b>3.10.6</b> Exercise (matrices)</a></li>
<li class="chapter" data-level="3.10.7" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-data-frames"><i class="fa fa-check"></i><b>3.10.7</b> Exercise (data frames)</a></li>
<li class="chapter" data-level="3.10.8" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-lists"><i class="fa fa-check"></i><b>3.10.8</b> Exercise (lists)</a></li>
<li class="chapter" data-level="3.10.9" data-path="sec-r-basics.html"><a href="sec-r-basics.html#ex-strings"><i class="fa fa-check"></i><b>3.10.9</b> Exercise (string management)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Programming in R</b></span></li>
<li class="chapter" data-level="4" data-path="sec-loops.html"><a href="sec-loops.html"><i class="fa fa-check"></i><b>4</b> Loops and conditionals</a>
<ul>
<li class="chapter" data-level="4.1" data-path="sec-loops.html"><a href="sec-loops.html#lo-loops"><i class="fa fa-check"></i><b>4.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="4.2" data-path="sec-loops.html"><a href="sec-loops.html#conditionals-and-control-flow"><i class="fa fa-check"></i><b>4.2</b> Conditionals and control flow</a></li>
<li class="chapter" data-level="4.3" data-path="sec-loops.html"><a href="sec-loops.html#loops"><i class="fa fa-check"></i><b>4.3</b> Loops</a></li>
<li class="chapter" data-level="4.4" data-path="sec-loops.html"><a href="sec-loops.html#lp-loops"><i class="fa fa-check"></i><b>4.4</b> Different learning paths</a></li>
<li class="chapter" data-level="4.5" data-path="sec-loops.html"><a href="sec-loops.html#rc-loops"><i class="fa fa-check"></i><b>4.5</b> Recap</a></li>
<li class="chapter" data-level="4.6" data-path="sec-loops.html"><a href="sec-loops.html#ex-loops"><i class="fa fa-check"></i><b>4.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="sec-loops.html"><a href="sec-loops.html#exercise-conditional-expressions"><i class="fa fa-check"></i><b>4.6.1</b> Exercise (conditional expressions)</a></li>
<li class="chapter" data-level="4.6.2" data-path="sec-loops.html"><a href="sec-loops.html#exercise-loops"><i class="fa fa-check"></i><b>4.6.2</b> Exercise (loops)</a></li>
<li class="chapter" data-level="4.6.3" data-path="sec-loops.html"><a href="sec-loops.html#ex-dist"><i class="fa fa-check"></i><b>4.6.3</b> Exercise (calculating distances)</a></li>
<li class="chapter" data-level="4.6.4" data-path="sec-loops.html"><a href="sec-loops.html#exercise-expand_grid"><i class="fa fa-check"></i><b>4.6.4</b> Exercise (<code>expand_grid</code>)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sec-functions.html"><a href="sec-functions.html"><i class="fa fa-check"></i><b>5</b> Functions</a>
<ul>
<li class="chapter" data-level="5.1" data-path="sec-functions.html"><a href="sec-functions.html#lo-functions"><i class="fa fa-check"></i><b>5.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="5.2" data-path="sec-functions.html"><a href="sec-functions.html#datacamp-course"><i class="fa fa-check"></i><b>5.2</b> DataCamp course</a></li>
<li class="chapter" data-level="5.3" data-path="sec-functions.html"><a href="sec-functions.html#functions-returning-multiple-objects"><i class="fa fa-check"></i><b>5.3</b> Functions returning multiple objects</a></li>
<li class="chapter" data-level="5.4" data-path="sec-functions.html"><a href="sec-functions.html#the-...-argument"><i class="fa fa-check"></i><b>5.4</b> The <code>...</code> argument</a></li>
<li class="chapter" data-level="5.5" data-path="sec-functions.html"><a href="sec-functions.html#documenting-your-functions"><i class="fa fa-check"></i><b>5.5</b> Documenting your functions</a></li>
<li class="chapter" data-level="5.6" data-path="sec-functions.html"><a href="sec-functions.html#lp-functions"><i class="fa fa-check"></i><b>5.6</b> Different learning paths</a></li>
<li class="chapter" data-level="5.7" data-path="sec-functions.html"><a href="sec-functions.html#rc-functions"><i class="fa fa-check"></i><b>5.7</b> Recap</a></li>
<li class="chapter" data-level="5.8" data-path="sec-functions.html"><a href="sec-functions.html#ex-functions"><i class="fa fa-check"></i><b>5.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="sec-functions.html"><a href="sec-functions.html#exercise-defining-functions"><i class="fa fa-check"></i><b>5.8.1</b> Exercise (defining functions)</a></li>
<li class="chapter" data-level="5.8.2" data-path="sec-functions.html"><a href="sec-functions.html#exercise-scope"><i class="fa fa-check"></i><b>5.8.2</b> Exercise (scope)</a></li>
<li class="chapter" data-level="5.8.3" data-path="sec-functions.html"><a href="sec-functions.html#exercise-job-sequencing"><i class="fa fa-check"></i><b>5.8.3</b> Exercise (job sequencing)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III IO, tidy and transform</b></span></li>
<li class="chapter" data-level="6" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html"><i class="fa fa-check"></i><b>6</b> Introduction to tidyverse and R Markdown</a>
<ul>
<li class="chapter" data-level="6.1" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#lo-tidy-intro"><i class="fa fa-check"></i><b>6.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="6.2" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#the-tidyverse-package"><i class="fa fa-check"></i><b>6.2</b> The tidyverse package</a></li>
<li class="chapter" data-level="6.3" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#writing-reproducible-reports"><i class="fa fa-check"></i><b>6.3</b> Writing reproducible reports</a></li>
<li class="chapter" data-level="6.4" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#tibbles"><i class="fa fa-check"></i><b>6.4</b> Tibbles</a></li>
<li class="chapter" data-level="6.5" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#lp-tidy-intro"><i class="fa fa-check"></i><b>6.5</b> Different learning paths</a></li>
<li class="chapter" data-level="6.6" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#rc-tidy-intro"><i class="fa fa-check"></i><b>6.6</b> Recap</a></li>
<li class="chapter" data-level="6.7" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#ex-tidy-intro"><i class="fa fa-check"></i><b>6.7</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#exercise-your-first-r-markdown-exercise"><i class="fa fa-check"></i><b>6.7.1</b> Exercise (your first R Markdown exercise)</a></li>
<li class="chapter" data-level="6.7.2" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#exercise-tibbles"><i class="fa fa-check"></i><b>6.7.2</b> Exercise (tibbles)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="sec-io.html"><a href="sec-io.html"><i class="fa fa-check"></i><b>7</b> Importing and exporting data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="sec-io.html"><a href="sec-io.html#lo-io"><i class="fa fa-check"></i><b>7.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="7.2" data-path="sec-io.html"><a href="sec-io.html#csv-files"><i class="fa fa-check"></i><b>7.2</b> CSV files</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="sec-io.html"><a href="sec-io.html#reading-a-csv-file"><i class="fa fa-check"></i><b>7.2.1</b> Reading a CSV file</a></li>
<li class="chapter" data-level="7.2.2" data-path="sec-io.html"><a href="sec-io.html#writing-to-csv-files"><i class="fa fa-check"></i><b>7.2.2</b> Writing to CSV files</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="sec-io.html"><a href="sec-io.html#excel"><i class="fa fa-check"></i><b>7.3</b> Excel</a></li>
<li class="chapter" data-level="7.4" data-path="sec-io.html"><a href="sec-io.html#google-sheets"><i class="fa fa-check"></i><b>7.4</b> Google Sheets</a></li>
<li class="chapter" data-level="7.5" data-path="sec-io.html"><a href="sec-io.html#text-files"><i class="fa fa-check"></i><b>7.5</b> Text files</a></li>
<li class="chapter" data-level="7.6" data-path="sec-io.html"><a href="sec-io.html#rs-native-binary-format"><i class="fa fa-check"></i><b>7.6</b> R’s native binary format</a></li>
<li class="chapter" data-level="7.7" data-path="sec-io.html"><a href="sec-io.html#json"><i class="fa fa-check"></i><b>7.7</b> Json</a></li>
<li class="chapter" data-level="7.8" data-path="sec-io.html"><a href="sec-io.html#lp-io"><i class="fa fa-check"></i><b>7.8</b> Different learning paths</a></li>
<li class="chapter" data-level="7.9" data-path="sec-io.html"><a href="sec-io.html#rc-io"><i class="fa fa-check"></i><b>7.9</b> Recap</a></li>
<li class="chapter" data-level="7.10" data-path="sec-io.html"><a href="sec-io.html#ex-io"><i class="fa fa-check"></i><b>7.10</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.10.1" data-path="sec-io.html"><a href="sec-io.html#exercise-statistikbanken"><i class="fa fa-check"></i><b>7.10.1</b> Exercise (Statistikbanken)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="sec-transform.html"><a href="sec-transform.html"><i class="fa fa-check"></i><b>8</b> Transforming data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="sec-transform.html"><a href="sec-transform.html#lo-transform"><i class="fa fa-check"></i><b>8.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="8.2" data-path="sec-transform.html"><a href="sec-transform.html#working-with-data-in-the-tidyverse"><i class="fa fa-check"></i><b>8.2</b> Working with data in the tidyverse</a></li>
<li class="chapter" data-level="8.3" data-path="sec-transform.html"><a href="sec-transform.html#lp-transform"><i class="fa fa-check"></i><b>8.3</b> Different learning paths</a></li>
<li class="chapter" data-level="8.4" data-path="sec-transform.html"><a href="sec-transform.html#rc-transform"><i class="fa fa-check"></i><b>8.4</b> Recap</a></li>
<li class="chapter" data-level="8.5" data-path="sec-transform.html"><a href="sec-transform.html#ex-transform"><i class="fa fa-check"></i><b>8.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="sec-transform.html"><a href="sec-transform.html#ex-gapminder1"><i class="fa fa-check"></i><b>8.5.1</b> Exercise (gapminder)</a></li>
<li class="chapter" data-level="8.5.2" data-path="sec-transform.html"><a href="sec-transform.html#ex-babynames1"><i class="fa fa-check"></i><b>8.5.2</b> Exercise (babynames)</a></li>
<li class="chapter" data-level="8.5.3" data-path="sec-transform.html"><a href="sec-transform.html#ex-profit1"><i class="fa fa-check"></i><b>8.5.3</b> Exercise (profit)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Visualization</b></span></li>
<li class="chapter" data-level="9" data-path="sec-plot.html"><a href="sec-plot.html"><i class="fa fa-check"></i><b>9</b> Data visualization using ggplot</a>
<ul>
<li class="chapter" data-level="9.1" data-path="sec-plot.html"><a href="sec-plot.html#lo-plot"><i class="fa fa-check"></i><b>9.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="9.2" data-path="sec-plot.html"><a href="sec-plot.html#introduction-to-data-visualization"><i class="fa fa-check"></i><b>9.2</b> Introduction to data visualization</a></li>
<li class="chapter" data-level="9.3" data-path="sec-plot.html"><a href="sec-plot.html#lp-r-plot"><i class="fa fa-check"></i><b>9.3</b> Different learning paths</a></li>
<li class="chapter" data-level="9.4" data-path="sec-plot.html"><a href="sec-plot.html#rc-r-plot"><i class="fa fa-check"></i><b>9.4</b> Recap</a></li>
<li class="chapter" data-level="9.5" data-path="sec-plot.html"><a href="sec-plot.html#ex-r-plot"><i class="fa fa-check"></i><b>9.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="sec-plot.html"><a href="sec-plot.html#ex-gapminder2"><i class="fa fa-check"></i><b>9.5.1</b> Exercise (gapminder)</a></li>
<li class="chapter" data-level="9.5.2" data-path="sec-plot.html"><a href="sec-plot.html#ex-profit2"><i class="fa fa-check"></i><b>9.5.2</b> Exercise (profit)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="sec-maps.html"><a href="sec-maps.html"><i class="fa fa-check"></i><b>10</b> Spartial data and maps</a>
<ul>
<li class="chapter" data-level="10.1" data-path="sec-maps.html"><a href="sec-maps.html#lo-maps"><i class="fa fa-check"></i><b>10.1</b> Learning outcomes</a></li>
</ul></li>
<li class="part"><span><b>V R project in groups</b></span></li>
<li class="chapter" data-level="11" data-path="sec-project.html"><a href="sec-project.html"><i class="fa fa-check"></i><b>11</b> Mandatory R project</a>
<ul>
<li class="chapter" data-level="11.1" data-path="sec-project.html"><a href="sec-project.html#lo-project"><i class="fa fa-check"></i><b>11.1</b> Learning outcomes</a></li>
</ul></li>
<li class="part"><span><b>VI Extra</b></span></li>
<li class="chapter" data-level="12" data-path="sec-r-excel.html"><a href="sec-r-excel.html"><i class="fa fa-check"></i><b>12</b> Using R in Excel and Excel in R</a></li>
<li class="chapter" data-level="13" data-path="sec-opl.html"><a href="sec-opl.html"><i class="fa fa-check"></i><b>13</b> Run an OPL model from R</a></li>
<li class="chapter" data-level="14" data-path="sec-simulation.html"><a href="sec-simulation.html"><i class="fa fa-check"></i><b>14</b> Simulation in R</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="groups.html"><a href="groups.html"><i class="fa fa-check"></i><b>A</b> Working in groups</a>
<ul>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#r-project-structure"><i class="fa fa-check"></i>R project structure</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#using-git"><i class="fa fa-check"></i>Using Git together with GitHub</a>
<ul>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#register-a-free-github-account"><i class="fa fa-check"></i>Register a free GitHub account</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#install-git"><i class="fa fa-check"></i>Install Git</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#check-your-installation"><i class="fa fa-check"></i>Check your installation</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#setup-projects-using-git-and-github"><i class="fa fa-check"></i>Setup projects using Git and GitHub</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="annotate.html"><a href="annotate.html"><i class="fa fa-check"></i><b>B</b> Annotate the course notes</a></li>
<li class="chapter" data-level="C" data-path="help.html"><a href="help.html"><i class="fa fa-check"></i><b>C</b> Getting help</a>
<ul>
<li class="chapter" data-level="" data-path="help.html"><a href="help.html#study-café"><i class="fa fa-check"></i>Study café</a>
<ul>
<li class="chapter" data-level="" data-path="help.html"><a href="help.html#need-help---ask-a-question"><i class="fa fa-check"></i>Need help - ask a question</a></li>
<li class="chapter" data-level="" data-path="help.html"><a href="help.html#current-queue"><i class="fa fa-check"></i>Current queue</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="D" data-path="slides.html"><a href="slides.html"><i class="fa fa-check"></i><b>D</b> Slides</a></li>
<li class="chapter" data-level="E" data-path="lg-course.html"><a href="lg-course.html"><i class="fa fa-check"></i><b>E</b> Learning goals</a></li>
<li class="chapter" data-level="F" data-path="sec-ba.html"><a href="sec-ba.html"><i class="fa fa-check"></i><b>F</b> Business Analytics</a></li>
<li class="chapter" data-level="G" data-path="colophon.html"><a href="colophon.html"><i class="fa fa-check"></i><b>G</b> Colophon</a></li>
<li class="divider"></li>
<li><center>
  <a rel="license" href="./index.html#ack">
    License: CC BY-NC-SA<br>
    <i class = "fab fa-creative-commons fa-2x"></i>
    <i class = "fab fa-creative-commons-by fa-2x"></i>
    <i class = "fab fa-creative-commons-nc fa-2x"></i>
    <i class = "fab fa-creative-commons-sa fa-2x"></i>
  </a>
</li></center>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tools for Analytics (TFA)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sec-transform" class="section level1" number="8">
<h1><span class="header-section-number">Module 8</span> Transforming data</h1>
<p>In this module we consider transformation of data. In general raw data may be messy and need to be structured in a <strong>tidy</strong> way. Tidying your data means storing it in a structured form suitable for analysis. This is done using a tibble (data frame) where each column is a variable, and each row is an observation. Tidy data is important because the consistent structure lets you focus your struggle on questions about the data.</p>
<p>Given a raw data set the first step is to clean it and and transform it to a tidy format. Given tidy data, you next often need to <strong>transform</strong> it. Transformation includes narrowing in on observations of interest (e.g. only observations from a specific year or warehouse), creating new variables based on existing variables (like the cost of using the machine that day given idle time). Together, tidying and transforming are called <strong>wrangling</strong>, because it can be a hard process to get your data in the right form.</p>
<p>In this chapter you will learn how to work with tibbles using the <a href="https://dplyr.tidyverse.org/">dplyr package</a> which is a part of the <a href="https://www.tidyverse.org">tidyverse</a>.</p>
<div id="lo-transform" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Learning outcomes</h2>
<p>By the end of this module, you are expected to be able to:</p>
<ul>
<li>Describe what tidy and wangling is.</li>
<li>Apply the most common string functions</li>
<li>Apply tidy operations to data</li>
<li>Transform data</li>
<li>Clean data</li>
</ul>
<p>The learning outcomes relate to the <a href="lg-course.html#lg-course">overall learning goals</a> number 7, 11-14 and 18 of the course.</p>
<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->
</div>
<div id="working-with-data-in-the-tidyverse" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Working with data in the tidyverse</h2>
<p>An excellent introduction on how to transform data using the tidyverse is given in the interactive DataCamp course <a href="https://learn.datacamp.com/courses/data-manipulation-with-dplyr">Data Manipulation with dplyr</a>. Please complete the course before continuing.</p>
<!-- ## Tidy  -->
<!-- ## Wangling -->
<!-- https://learn.datacamp.com/projects/758 -->
<!-- https://learn.datacamp.com/courses/dealing-with-missing-data-in-r -->
<!-- https://learn.datacamp.com/courses/introduction-to-the-tidyverse -->
</div>
<div id="lp-transform" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Different learning paths</h2>
<p>We are all different and you may like different learning styles compared to others. You may prefer a different learning path than suggested. Here is a list of possible different learning paths that may be useful for you.</p>
<ul>
<li>Roger Peng provide a good video giving an <a href="https://www.youtube.com/watch?v=aywFompr1F4">Introduction to the dplyr R package</a>.</li>
<li><a href="https://bookdown.org/rdpeng/rprogdatascience/managing-data-frames-with-the-dplyr-package.html">Chapter 12</a> in <span class="citation">Peng (<a href="#ref-rdpeng" role="doc-biblioref">2018</a>)</span> provides a nice introduction to dplyr.</li>
<li>An alternative interactive DataCamp course is <a href="https://learn.datacamp.com/courses/working-with-data-in-the-tidyverse">Working with Data in the Tidyverse</a> which may be good to take if you need more training.</li>
<li>The ‘Data transformation with dplyr’ cheatsheet is very useful. Find the newest version in RStudio <strong>Help &gt; Cheatsheets</strong>.</li>
</ul>
</div>
<div id="rc-transform" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> Recap</h2>
<ul>
<li><p>We considers transformation tidy data where data are stored using a tibble (data frame) where each column is a variable, and each row is an observation/case.</p></li>
<li><p>Tidy data is important because the consistent structure lets you focus your struggle on questions about the data.</p></li>
<li><p>Transformation includes narrowing in on observations of interest (e.g. only observations from a specific year or warehouse), creating new variables based on existing variables (like the cost of using the machine that day given idle time).</p></li>
<li><p>Tidying and transforming are called wrangling, because it can be a hard process to get your data in the right form.</p></li>
<li><p>The package dplyr provide a consistent set of verbs that help you solve the most common data manipulation challenges:</p>
<ul>
<li>The <code>filter</code> function chooses rows (cases/observations) that meet a specific criteria.</li>
<li>The <code>select</code> function chooses columns (variables) based on their names.</li>
<li>The <code>arrange</code> function reorders the rows.</li>
<li>The <code>transmute</code> function adds/modify columns (variables) and drops existing ones.</li>
<li>The <code>mutate</code> function adds/modify columns (variables).</li>
<li>The <code>group_by</code> function group variables for groupwise operations.</li>
<li>The <code>ungroup</code> function remove the current grouping.</li>
<li>The <code>count</code> function count rows based on a grouping.</li>
<li>The <code>summarise</code> function reduces multiple values down to a single summary.</li>
<li>The <code>distinct</code> function selects unique/distinct rows.</li>
<li>The <code>pull</code> function can be use to extract columns as vectors (it is similar to $).</li>
</ul></li>
<li><p>Some nice to know functions to use inside e.g. <code>summarise</code> or <code>mutate</code> are</p>
<ul>
<li>The <code>n()</code> function count the number of rows in a group.</li>
<li>The <code>n_distinct</code> count the number of unique rows in a group.</li>
<li>The <code>first</code> function considers the first row in a group (remember to order it as needed).</li>
<li>The <code>slice_min</code> and <code>slice_max</code> functions selects rows with highest or lowest values of a variable.</li>
<li>The <code>across</code> function makes it easy to apply the same transformation to multiple columns.</li>
</ul></li>
<li><p>Use <code>print(n = Inf)</code> in a pipe to print all rows.</p></li>
<li><p>Use the pipe operator <code>%&gt;%</code> to connect operations.</p></li>
<li><p>Use functions <code>glimpse</code>, <code>tail</code>, <code>head</code>, <code>View</code> to have look at the data.</p></li>
<li><p>The <code>skim</code> function in the skimr package provides an approach to summary statistics.</p></li>
<li><p>Use <code>as.character</code>, <code>as.numeric</code>, etc. to convert data to a different type.</p></li>
<li><p>Use <code>nrow</code> and <code>ncol</code> functions to get the number of rows and columns of the data.</p></li>
</ul>
</div>
<div id="ex-transform" class="section level2" number="8.5">
<h2><span class="header-section-number">8.5</span> Exercises</h2>
<p>Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the <a href="help.html#help">help page</a>. Solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up to early. Put some effort into finding a solution!</p>
<div id="ex-gapminder1" class="section level3" number="8.5.1">
<h3><span class="header-section-number">8.5.1</span> Exercise (gapminder)</h3>
<p>Use the <em>exercise R markdown template</em> to solve this exercise (<strong>File &gt; New File &gt; R Markdown…</strong>, select <strong>From template</strong> and then <strong>TFA Exercise</strong>).</p>
<p>The gapminder data set provides values for life expectancy, GDP per capita, and population, every five years, from 1952 to 2007 for 142 countries. The data can be loaded using the gapminder package:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="sec-transform.html#cb215-1" aria-hidden="true"></a><span class="kw">library</span>(gapminder)</span>
<span id="cb215-2"><a href="sec-transform.html#cb215-2" aria-hidden="true"></a>gapminder</span>
<span id="cb215-3"><a href="sec-transform.html#cb215-3" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 1,704 x 6</span></span>
<span id="cb215-4"><a href="sec-transform.html#cb215-4" aria-hidden="true"></a><span class="co">#&gt;    country     continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb215-5"><a href="sec-transform.html#cb215-5" aria-hidden="true"></a><span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb215-6"><a href="sec-transform.html#cb215-6" aria-hidden="true"></a><span class="co">#&gt;  1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span id="cb215-7"><a href="sec-transform.html#cb215-7" aria-hidden="true"></a><span class="co">#&gt;  2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span id="cb215-8"><a href="sec-transform.html#cb215-8" aria-hidden="true"></a><span class="co">#&gt;  3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span id="cb215-9"><a href="sec-transform.html#cb215-9" aria-hidden="true"></a><span class="co">#&gt;  4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span id="cb215-10"><a href="sec-transform.html#cb215-10" aria-hidden="true"></a><span class="co">#&gt;  5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span id="cb215-11"><a href="sec-transform.html#cb215-11" aria-hidden="true"></a><span class="co">#&gt;  6 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span id="cb215-12"><a href="sec-transform.html#cb215-12" aria-hidden="true"></a><span class="co">#&gt;  7 Afghanistan Asia       1982    39.9 12881816      978.</span></span>
<span id="cb215-13"><a href="sec-transform.html#cb215-13" aria-hidden="true"></a><span class="co">#&gt;  8 Afghanistan Asia       1987    40.8 13867957      852.</span></span>
<span id="cb215-14"><a href="sec-transform.html#cb215-14" aria-hidden="true"></a><span class="co">#&gt;  9 Afghanistan Asia       1992    41.7 16317921      649.</span></span>
<span id="cb215-15"><a href="sec-transform.html#cb215-15" aria-hidden="true"></a><span class="co">#&gt; 10 Afghanistan Asia       1997    41.8 22227415      635.</span></span>
<span id="cb215-16"><a href="sec-transform.html#cb215-16" aria-hidden="true"></a><span class="co">#&gt; # … with 1,694 more rows</span></span></code></pre></div>
<p>Let us try to examine the data set (use pipes <code>%&gt;%</code> as much as possible).</p>
<div aria-labelledby="solution0-title" class="modal fade bs-example-modal-lg" id="solution0" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution0-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% glimpse()
gapminder %&gt;% summary()
gapminder %&gt;% tail()
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution0">Solution</button>
<ol class="example" style="list-style-type: decimal">
<li><p>Use <code>glimpse</code>, <code>summary</code> and <code>tail</code> to examine the data.</p></li>
<li><p>Use <code>count</code> to count the number of
<div aria-labelledby="solution1-title" class="modal fade bs-example-modal-lg" id="solution1" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution1-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  count(country) %&gt;% 
  nrow()
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution1">Solution</button></p>
<ol style="list-style-type: lower-alpha">
<li>countries,</li>
<li>continents,
<div aria-labelledby="solution2-title" class="modal fade bs-example-modal-lg" id="solution2" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution2-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  count(continent) %&gt;% 
  nrow()
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution2">Solution</button></li>
<li>countries per continent.
<div aria-labelledby="solution3-title" class="modal fade bs-example-modal-lg" id="solution3" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution3-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  count(continent, country) %&gt;% 
  count(continent)     # or
gapminder %&gt;% 
  distinct(continent, country) %&gt;% 
  count(continent)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution3">Solution</button></li>
</ol></li>
</ol>
<div aria-labelledby="solution4-title" class="modal fade bs-example-modal-lg" id="solution4" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution4-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  distinct(continent) %&gt;% 
  pull(continent) %&gt;% 
  as.character()
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution4">Solution</button>
<ol start="3" class="example" style="list-style-type: decimal">
<li><p>Retrieve a vector with all distinct continent values.</p></li>
<li><p>Subset rows to find:</p>
<ol style="list-style-type: lower-alpha">
<li>all rows with life expectancy less that 29 years,
<div aria-labelledby="solution5-title" class="modal fade bs-example-modal-lg" id="solution5" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution5-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  filter(lifeExp &lt; 29)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution5">Solution</button></li>
<li>all rows for Rwanda after year 1979,
<div aria-labelledby="solution6-title" class="modal fade bs-example-modal-lg" id="solution6" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution6-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  filter(country == &quot;Rwanda&quot;, year &gt; 1979)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution6">Solution</button></li>
<li>all rows for Rwanda, Afghanistan or France.
<div aria-labelledby="solution7-title" class="modal fade bs-example-modal-lg" id="solution7" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution7-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;%  
  filter(country %in% c(&quot;Rwanda&quot;, &quot;Afghanistan&quot;, &quot;France&quot;))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution7">Solution</button></li>
</ol></li>
<li><p>Select columns</p>
<ol style="list-style-type: lower-alpha">
<li>year and life expectancy,
<div aria-labelledby="solution8-title" class="modal fade bs-example-modal-lg" id="solution8" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution8-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  select(year, lifeExp)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution8">Solution</button></li>
<li>country and GDP per capita.
<div aria-labelledby="solution9-title" class="modal fade bs-example-modal-lg" id="solution9" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution9-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  select(country, gdpPercap)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution9">Solution</button></li>
</ol></li>
</ol>
<div aria-labelledby="solution10-title" class="modal fade bs-example-modal-lg" id="solution10" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution10-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
   filter((gdpPercap &gt; 40000 &amp; continent == &quot;Europe&quot;) | (gdpPercap &lt; 400 &amp; continent == &quot;Africa&quot;)) %&gt;% 
   # print(n=Inf) %&gt;%   # if want to see the intermediate results
   select(continent, country, gdpPercap) # %&gt;% print(n=Inf)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution10">Solution</button>
<ol start="6" class="example" style="list-style-type: decimal">
<li>Subset your data set to find all rows with GDP per capita greater than 40000 in Europe or with GDP per capita less than 500 in Africa.</li>
</ol>
<div aria-labelledby="solution11-title" class="modal fade bs-example-modal-lg" id="solution11" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution11-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;%
  mutate(gdp = pop * gdpPercap)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution11">Solution</button>
<ol start="7" class="example" style="list-style-type: decimal">
<li>Use <code>mutate</code> to calculate each country’s GDP (population times GDP per capita).</li>
</ol>
<p>In general GDP numbers are large and abstract. Let us try to calculate relative numbers.</p>
<div aria-labelledby="solution12-title" class="modal fade bs-example-modal-lg" id="solution12" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution12-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">mean_dk &lt;- gapminder %&gt;% 
  filter(country == &quot;Denmark&quot;) %&gt;% 
  pull(gdpPercap) %&gt;% 
  mean()
dat &lt;- gapminder %&gt;% 
  mutate(gdpPercapRel = gdpPercap/mean_dk)
dat %&gt;% 
  filter(country == &quot;Denmark&quot;) %&gt;% 
  select(country, year, gdpPercapRel)
summary(dat$gdpPercapRel)
</code></pre>

<p>The relative GDP per capita numbers are, in general, well below 1. We see that most of the countries covered by this dataset have substantially lower GDP per capita, relative to Denmark, across the entire time period.</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution12">Solution</button>
<ol start="8" class="example" style="list-style-type: decimal">
<li><p>Use <code>mutate</code> to calculate GDP per capita relative to mean GDP per capita in Denmark over the whole period (<code>gdpPercap</code> divided by the mean of Danish <code>gdpPercap</code>). Hint you first must calculate the mean of Danish <code>gdpPercap</code> and next use that to add a new column <code>gdpPercapRel</code>. Have a look at the calculated data for Denmark. Does the numbers seems reasonable? I perceive Denmark to be a “high GDP” country, so I predict that the distribution of <code>gdpPercapRel</code> is located below 1, possibly even well below. Check this intuition!</p></li>
<li><p>Use <code>arrange</code> to order</p>
<ol style="list-style-type: lower-alpha">
<li>data by year then country, as opposed to current by country then year,
<div aria-labelledby="solution13-title" class="modal fade bs-example-modal-lg" id="solution13" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution13-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  arrange(year, country)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution13">Solution</button></li>
<li>data from 2007, sorted on life expectancy,
<div aria-labelledby="solution14-title" class="modal fade bs-example-modal-lg" id="solution14" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution14-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;%
  filter(year == 2007) %&gt;%
  arrange(lifeExp)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution14">Solution</button></li>
<li>data from 2007, sorted on life expectancy in <strong>desc</strong>ending order. Hint: use <code>desc()</code> inside <code>arrange</code>.
<div aria-labelledby="solution15-title" class="modal fade bs-example-modal-lg" id="solution15" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution15-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;%
  filter(year == 2007) %&gt;%
  arrange(desc(lifeExp))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution15">Solution</button></li>
</ol></li>
<li><p>Use <code>select</code> to</p>
<ol style="list-style-type: lower-alpha">
<li>rename <code>year</code> to <code>yr</code> and keep all other columns (the select helper <code>everything</code> may be used),
<div aria-labelledby="solution16-title" class="modal fade bs-example-modal-lg" id="solution16" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution16-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  select(yr = year, everything())
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution16">Solution</button></li>
<li>remove <code>pop</code>
<div aria-labelledby="solution17-title" class="modal fade bs-example-modal-lg" id="solution17" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution17-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  select(-pop)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution17">Solution</button></li>
<li>reorder columns in order <code>year</code>, <code>pop</code>, … (remaining).
<div aria-labelledby="solution18-title" class="modal fade bs-example-modal-lg" id="solution18" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution18-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  select(year, pop, everything())
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution18">Solution</button></li>
</ol></li>
<li><p>Use <code>group_by</code> and <code>summarize</code> to find the</p>
<ol style="list-style-type: lower-alpha">
<li>number of observations per continent
<div aria-labelledby="solution19-title" class="modal fade bs-example-modal-lg" id="solution19" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution19-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  group_by(continent) %&gt;% 
  summarize(n = n())
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution19">Solution</button></li>
<li>number of countries per continent (use <code>n_distinct</code> inside <code>summarize</code> to count the number of distinct observations),
<div aria-labelledby="solution20-title" class="modal fade bs-example-modal-lg" id="solution20" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution20-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  group_by(continent) %&gt;% 
  summarize(n = n(), n_countries = n_distinct(country))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution20">Solution</button></li>
<li>average life expectancy by continent,
<div aria-labelledby="solution21-title" class="modal fade bs-example-modal-lg" id="solution21" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution21-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  group_by(continent) %&gt;% 
  summarize(avg_lifeExp = mean(lifeExp))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution21">Solution</button></li>
<li>minimum and maximum life expectancies seen by year in Asia
<div aria-labelledby="solution22-title" class="modal fade bs-example-modal-lg" id="solution22" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution22-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  filter(continent == &quot;Asia&quot;) %&gt;% 
  group_by(year) %&gt;% 
  summarize(min_lifeExp = min(lifeExp), max_lifeExp = max(lifeExp))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution22">Solution</button></li>
</ol></li>
</ol>
<div aria-labelledby="solution23-title" class="modal fade bs-example-modal-lg" id="solution23" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution23-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;% 
  group_by(country) %&gt;%                 # group by country
  select(country, year, lifeExp) %&gt;%    # select relevant columns
  arrange(year, .by_group = TRUE) %&gt;%   # make sure that data is sorted correct
  mutate(lifeExp_gain = lifeExp - first(lifeExp)) %&gt;%       
  filter(year &lt; 1963)                   # just for nice printing
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution23">Solution</button>
<ol start="12" class="example" style="list-style-type: decimal">
<li><p>Sometimes you don’t want to collapse the <span class="math inline">\(n\)</span> rows for each group into one row. That is, you don’t want to use <code>summarize</code> but <code>mutate</code> within your groups. Try to make a new variable that is the years of life expectancy gained (lost) relative to 1952, for each individual country. You code should look like this</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="sec-transform.html#cb216-1" aria-hidden="true"></a>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb216-2"><a href="sec-transform.html#cb216-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span><span class="st">                 </span><span class="co"># group by country</span></span>
<span id="cb216-3"><a href="sec-transform.html#cb216-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(country, year, lifeExp) <span class="op">%&gt;%</span><span class="st">    </span><span class="co"># select relevant columns</span></span>
<span id="cb216-4"><a href="sec-transform.html#cb216-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">arrange</span>(year, <span class="dt">.by_group =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># make sure that data is sorted correct</span></span>
<span id="cb216-5"><a href="sec-transform.html#cb216-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lifeExp_gain =</span> ___) <span class="op">%&gt;%</span><span class="st">        </span><span class="co"># define new variable</span></span>
<span id="cb216-6"><a href="sec-transform.html#cb216-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">&lt;</span><span class="st"> </span><span class="dv">1963</span>)                   <span class="co"># just for nice printing</span></span></code></pre></div>
<p>The <code>first</code> function may be helpful to extract the first value from a vector in each group.</p></li>
</ol>
<div aria-labelledby="solution24-title" class="modal fade bs-example-modal-lg" id="solution24" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution24-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">gapminder %&gt;%
  select(country, year, continent, lifeExp) %&gt;%     
  group_by(continent, country) %&gt;%                  
  mutate(le_delta = lifeExp - lag(lifeExp)) %&gt;%
  summarize(worst_le_delta = min(le_delta, na.rm = TRUE)) %&gt;%
  slice_min(worst_le_delta) %&gt;%
  arrange(worst_le_delta)
</code></pre>

<p>Mostly you are seeing what genocide looks like in dry statistics on average life expectancy.</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution24">Solution</button>
<ol start="13" class="example" style="list-style-type: decimal">
<li><p>Which country experienced the sharpest 5-year drop in life expectancy in each continent? Recall that the Gapminder data only has data every five years, e.g. for 1952, 1957, etc. So this really means looking at life expectancy changes between adjacent timepoints. Here the <code>lag</code> function is useful to select the value in the previous row. Your code should look like:</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="sec-transform.html#cb217-1" aria-hidden="true"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb217-2"><a href="sec-transform.html#cb217-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">select</span>(country, year, continent, lifeExp) <span class="op">%&gt;%</span><span class="st">             </span><span class="co"># select relevant columns</span></span>
<span id="cb217-3"><a href="sec-transform.html#cb217-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">group_by</span>(continent, country) <span class="op">%&gt;%</span><span class="st">                          </span><span class="co"># group</span></span>
<span id="cb217-4"><a href="sec-transform.html#cb217-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">le_delta =</span> ___) <span class="op">%&gt;%</span><span class="st">                                </span><span class="co"># within country, take (lifeExp in year i) - (lifeExp in year i - 1)</span></span>
<span id="cb217-5"><a href="sec-transform.html#cb217-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">worst_le_delta =</span> <span class="kw">min</span>(___, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st">    </span><span class="co"># find lowest value</span></span>
<span id="cb217-6"><a href="sec-transform.html#cb217-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">slice_min</span>(worst_le_delta) <span class="op">%&gt;%</span><span class="st">                             </span><span class="co"># find min in each continent</span></span>
<span id="cb217-7"><a href="sec-transform.html#cb217-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">arrange</span>(worst_le_delta)                                   <span class="co"># arrange </span></span></code></pre></div>
<p>Positive values of <code>le_delta</code> means lifeExp went up, negative means it went down. Break the code into pieces, starting at the top, and inspect the intermediate results. These commands are built up gradually, with lots of errors and refinements along the way.</p></li>
</ol>
</div>
<div id="ex-babynames1" class="section level3" number="8.5.2">
<h3><span class="header-section-number">8.5.2</span> Exercise (babynames)</h3>
<p>Use the <em>exercise R markdown template</em> to solve this exercise (<strong>File &gt; New File &gt; R Markdown…</strong>, select <strong>From template</strong> and then <strong>TFA Exercise</strong>).</p>
<p>The package babynames contains the dataset <code>babynames</code> provided by the USA social security administration. For each year from 1880 to 2017, the number of children of each sex given each name. All names with more than 5 uses are given (source: <a href="http://www.ssa.gov/oact/babynames/limits.html" class="uri">http://www.ssa.gov/oact/babynames/limits.html</a>).</p>
<p>Install it using</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="sec-transform.html#cb218-1" aria-hidden="true"></a><span class="kw">install.packages</span>(<span class="st">&quot;babynames&quot;</span>)</span></code></pre></div>
<p>We will use the skimr package to get an overview over <code>babynames</code>:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="sec-transform.html#cb219-1" aria-hidden="true"></a><span class="kw">library</span>(babynames)</span>
<span id="cb219-2"><a href="sec-transform.html#cb219-2" aria-hidden="true"></a><span class="kw">library</span>(skimr)</span>
<span id="cb219-3"><a href="sec-transform.html#cb219-3" aria-hidden="true"></a><span class="kw">skim</span>(babynames)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-259">Table 8.1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">babynames</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">1924665</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">5</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">3</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">sex</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">name</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">15</td>
<td align="right">0</td>
<td align="right">97310</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">year</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1975</td>
<td align="right">34</td>
<td align="right">1880</td>
<td align="right">1951</td>
<td align="right">1985</td>
<td align="right">2003</td>
<td align="right">2017.00</td>
<td align="left">▁▂▃▅▇</td>
</tr>
<tr class="even">
<td align="left">n</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">181</td>
<td align="right">1533</td>
<td align="right">5</td>
<td align="right">7</td>
<td align="right">12</td>
<td align="right">32</td>
<td align="right">99686.00</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">prop</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.08</td>
<td align="left">▇▁▁▁▁</td>
</tr>
</tbody>
</table>
<div aria-labelledby="solution25-title" class="modal fade bs-example-modal-lg" id="solution25" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution25-title">Solution</h4>
</div>
<div class="modal-body"><p>The last line only selects the <code>n</code> column.</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution25">Solution</button>
<ol style="list-style-type: decimal">
<li><p>Which of these is NOT a way to select the <code>name</code> and <code>n</code> columns together?</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="sec-transform.html#cb220-1" aria-hidden="true"></a><span class="kw">select</span>(babynames, <span class="op">-</span><span class="kw">c</span>(year, sex, prop))</span>
<span id="cb220-2"><a href="sec-transform.html#cb220-2" aria-hidden="true"></a><span class="kw">select</span>(babynames, name<span class="op">:</span>n)</span>
<span id="cb220-3"><a href="sec-transform.html#cb220-3" aria-hidden="true"></a><span class="kw">select</span>(babynames, <span class="kw">starts_with</span>(<span class="st">&quot;n&quot;</span>))</span>
<span id="cb220-4"><a href="sec-transform.html#cb220-4" aria-hidden="true"></a><span class="kw">select</span>(babynames, <span class="kw">ends_with</span>(<span class="st">&quot;n&quot;</span>))</span></code></pre></div></li>
<li><p>Use <code>filter</code> and the logical operators to find:
<div aria-labelledby="solution26-title" class="modal fade bs-example-modal-lg" id="solution26" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution26-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">babynames %&gt;% 
  filter(prop &gt;= 0.08)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution26">Solution</button></p>
<ol style="list-style-type: lower-alpha">
<li>All of the names where prop is greater than or equal to 0.08<br />
<div aria-labelledby="solution27-title" class="modal fade bs-example-modal-lg" id="solution27" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution27-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">babynames %&gt;% 
  filter(name == &quot;Sea&quot;)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution27">Solution</button></li>
<li>All of the children named “Sea”</li>
</ol></li>
<li><p>Use Boolean operators to return only the rows that contain:</p>
<ol style="list-style-type: lower-alpha">
<li><em>Boys</em> named Sue,
<div aria-labelledby="solution28-title" class="modal fade bs-example-modal-lg" id="solution28" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution28-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">babynames %&gt;% 
  filter(name == &quot;Sue&quot;, sex == &quot;M&quot;)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution28">Solution</button></li>
<li>Names that were used by exactly 5 or 6 children in 1880,
<div aria-labelledby="solution29-title" class="modal fade bs-example-modal-lg" id="solution29" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution29-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">babynames %&gt;% 
  filter(year == 1880, n == 5 | n == 6)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution29">Solution</button></li>
<li>Names that are one of Acura, Lexus, or Yugo.
<div aria-labelledby="solution30-title" class="modal fade bs-example-modal-lg" id="solution30" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution30-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">babynames %&gt;% 
  filter(name %in% c(&quot;Acura&quot;, &quot;Lexus&quot;, &quot;Yugo&quot;))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution30">Solution</button></li>
</ol></li>
</ol>
<div aria-labelledby="solution31-title" class="modal fade bs-example-modal-lg" id="solution31" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution31-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">min(babynames$n)
max(babynames$n)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution31">Solution</button>
<ol start="4" style="list-style-type: decimal">
<li>What is the smallest value of n? What is the largest?</li>
</ol>
<div aria-labelledby="solution32-title" class="modal fade bs-example-modal-lg" id="solution32" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution32-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">babynames %&gt;% 
  filter(sex == &quot;F&quot;, year == 2017) %&gt;% 
  select(name, n) %&gt;% 
  arrange(desc(n))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution32">Solution</button>
<ol start="5" style="list-style-type: decimal">
<li>Write a sequence of functions that filters babynames to just the girls that were born in 2017, then selects the <code>name</code> and <code>n</code> columns, then, arranges the results so that the most popular names are near the top.</li>
</ol>
<div aria-labelledby="solution33-title" class="modal fade bs-example-modal-lg" id="solution33" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution33-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">babynames %&gt;% 
  filter(sex == &quot;M&quot;, name == &quot;Lars&quot;)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution33">Solution</button>
<ol start="6" style="list-style-type: decimal">
<li>Trim <code>babynames</code> to just the rows that contain your <code>name</code> and your <code>sex</code>.</li>
</ol>
<p><div aria-labelledby="solution34-title" class="modal fade bs-example-modal-lg" id="solution34" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution34-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">babynames %&gt;% 
  filter(name == &quot;Khaleesi&quot;) %&gt;% 
  summarise(total = sum(n), first = min(year))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution34">Solution</button>
<div aria-labelledby="solution35-title" class="modal fade bs-example-modal-lg" id="solution35" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution35-title">Hint</h4>
</div>
<div class="modal-body"><pre><code class="r">babynames ___ 
  filter(____) ___
  ____(total = ___, first = ___)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution35">Hint</button></p>
<ol start="7" style="list-style-type: decimal">
<li>Extract the rows where <code>name == "Khaleesi"</code>. Then use <code>summarise()</code> to find the total number of children named Khaleesi and the first year Khaleesi appeared in the data.</li>
</ol>
<p><div aria-labelledby="solution36-title" class="modal fade bs-example-modal-lg" id="solution36" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution36-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">babynames %&gt;%
  group_by(name, sex) %&gt;% 
  summarize(total = sum(n)) %&gt;% 
  arrange(desc(total))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution36">Solution</button>
<div aria-labelledby="solution37-title" class="modal fade bs-example-modal-lg" id="solution37" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution37-title">Hint</h4>
</div>
<div class="modal-body"><pre><code class="r">babynames %&gt;%
  _______(name, sex) %&gt;% 
  _______(total = _____(n)) %&gt;% 
  _______(desc(_____))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution37">Hint</button></p>
<ol start="8" style="list-style-type: decimal">
<li>Use <code>group_by()</code>, <code>summarise()</code>, and <code>arrange()</code> to display the ten most popular names. Compute popularity as the <em>total</em> number of children of a single gender given a name.</li>
</ol>
<div aria-labelledby="solution38-title" class="modal fade bs-example-modal-lg" id="solution38" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution38-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">babynames %&gt;% 
  group_by(year) %&gt;% 
  summarise(total = sum(n))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution38">Solution</button>
<ol start="9" style="list-style-type: decimal">
<li>Use <code>group_by()</code> to calculate the total number of children born each year over time.</li>
</ol>
<p><div aria-labelledby="solution39-title" class="modal fade bs-example-modal-lg" id="solution39" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution39-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">babynames %&gt;% 
  group_by(year, sex) %&gt;% 
  mutate(rank = min_rank(desc(n))) %&gt;% 
  arrange(year, sex, desc(prop))
</code></pre>

<p>The same results if you use <code>n</code> since in the same order.</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution39">Solution</button>
<div aria-labelledby="solution40-title" class="modal fade bs-example-modal-lg" id="solution40" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution40-title">Hint</h4>
</div>
<div class="modal-body"><pre><code class="r">babynames %&gt;% 
  group_by(___, ___) %&gt;% 
  ___(rank = ___(desc(___))) %&gt;% 
  arrange(year, sex, desc(prop))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution40">Hint</button></p>
<ol start="10" style="list-style-type: decimal">
<li>Column <code>prop</code> denote the proportion given year and sex. Use <code>mutate()</code> and <code>min_rank()</code> to rank each row in babynames from <em>largest</em> <code>prop</code> to lowest <code>prop</code> given year and sex. What happens if you do the same using the <code>n</code> column?</li>
</ol>
<div aria-labelledby="solution41-title" class="modal fade bs-example-modal-lg" id="solution41" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution41-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">babynames %&gt;% 
  group_by(year, sex) %&gt;% 
  mutate(rank = min_rank(desc(n))) %&gt;% 
  filter(rank == 1, year &gt; 2009)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution41">Solution</button>
<ol start="11" style="list-style-type: decimal">
<li>Filter the results to find all names with <code>rank == 1</code> after 2009.</li>
</ol>
</div>
<div id="ex-profit1" class="section level3" number="8.5.3">
<h3><span class="header-section-number">8.5.3</span> Exercise (profit)</h3>
<p>Use the <em>exercise R markdown template</em> to solve this exercise (<strong>File &gt; New File &gt; R Markdown…</strong>, select <strong>From template</strong> and then <strong>TFA Exercise</strong>).</p>
<p>Consider the dataset profit containing quarterly financial records for each costumer, product, etc.:</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="sec-transform.html#cb221-1" aria-hidden="true"></a><span class="kw">library</span>(skimr)</span>
<span id="cb221-2"><a href="sec-transform.html#cb221-2" aria-hidden="true"></a>path &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata/profit_raw.csv&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;tfa&quot;</span>)</span>
<span id="cb221-3"><a href="sec-transform.html#cb221-3" aria-hidden="true"></a>profit &lt;-<span class="st"> </span><span class="kw">read_csv</span>(path)</span>
<span id="cb221-4"><a href="sec-transform.html#cb221-4" aria-hidden="true"></a><span class="kw">skim</span>(profit)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-278">Table 8.2: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">profit</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">24546</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">9</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">9</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Quarter</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">12</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Channel</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">10</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Customer ID</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">18</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Country</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">14</td>
<td align="right">0</td>
<td align="right">47</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Product Line</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">14</td>
<td align="right">25</td>
<td align="right">0</td>
<td align="right">6</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Revenue</td>
<td align="right">63</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">1210</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Product Cost</td>
<td align="right">61</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">1139</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Customer Service Cost</td>
<td align="right">10</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">464</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Profit</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">966</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>Note that it seems that the dataset need to be cleaned. All columns are strings (some should be numbers) and there seems to be missing values. You may start by having a view of the dataset using</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="sec-transform.html#cb222-1" aria-hidden="true"></a><span class="kw">View</span>(profit)</span></code></pre></div>
<p>First focus on column <code>Quarter</code> which currently has 12 distinct values</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="sec-transform.html#cb223-1" aria-hidden="true"></a>profit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(Quarter)</span>
<span id="cb223-2"><a href="sec-transform.html#cb223-2" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 12 x 1</span></span>
<span id="cb223-3"><a href="sec-transform.html#cb223-3" aria-hidden="true"></a><span class="co">#&gt;    Quarter</span></span>
<span id="cb223-4"><a href="sec-transform.html#cb223-4" aria-hidden="true"></a><span class="co">#&gt;    &lt;chr&gt;  </span></span>
<span id="cb223-5"><a href="sec-transform.html#cb223-5" aria-hidden="true"></a><span class="co">#&gt;  1 Q3     </span></span>
<span id="cb223-6"><a href="sec-transform.html#cb223-6" aria-hidden="true"></a><span class="co">#&gt;  2 1      </span></span>
<span id="cb223-7"><a href="sec-transform.html#cb223-7" aria-hidden="true"></a><span class="co">#&gt;  3 Q4     </span></span>
<span id="cb223-8"><a href="sec-transform.html#cb223-8" aria-hidden="true"></a><span class="co">#&gt;  4 Q1     </span></span>
<span id="cb223-9"><a href="sec-transform.html#cb223-9" aria-hidden="true"></a><span class="co">#&gt;  5 Q2     </span></span>
<span id="cb223-10"><a href="sec-transform.html#cb223-10" aria-hidden="true"></a><span class="co">#&gt;  6 2      </span></span>
<span id="cb223-11"><a href="sec-transform.html#cb223-11" aria-hidden="true"></a><span class="co">#&gt;  7 4      </span></span>
<span id="cb223-12"><a href="sec-transform.html#cb223-12" aria-hidden="true"></a><span class="co">#&gt;  8 q1     </span></span>
<span id="cb223-13"><a href="sec-transform.html#cb223-13" aria-hidden="true"></a><span class="co">#&gt;  9 q4     </span></span>
<span id="cb223-14"><a href="sec-transform.html#cb223-14" aria-hidden="true"></a><span class="co">#&gt; 10 q3     </span></span>
<span id="cb223-15"><a href="sec-transform.html#cb223-15" aria-hidden="true"></a><span class="co">#&gt; 11 q2     </span></span>
<span id="cb223-16"><a href="sec-transform.html#cb223-16" aria-hidden="true"></a><span class="co">#&gt; 12 3</span></span></code></pre></div>
<p>You would like it to be a numeric with values 1-4.</p>
<p><div aria-labelledby="solution42-title" class="modal fade bs-example-modal-lg" id="solution42" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution42-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit &lt;- profit %&gt;%  
  mutate(Quarter = str_remove(Quarter, &quot;q&quot;) %&gt;% str_remove(&quot;Q&quot;) %&gt;% as.numeric())
profit %&gt;% distinct(Quarter)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution42">Solution</button>
<div aria-labelledby="solution43-title" class="modal fade bs-example-modal-lg" id="solution43" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution43-title">Hint</h4>
</div>
<div class="modal-body"><pre><code class="r">profit &lt;- profit %&gt;%  
  mutate(Quarter = str_remove(___, &quot;q&quot;) %&gt;% str_remove(___) %&gt;% as.numeric())
profit %&gt;% distinct(Quarter)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution43">Hint</button></p>
<ol style="list-style-type: decimal">
<li>Use <code>mutate</code>, <code>str_remove</code> and <code>as.numeric</code> to convert the column to a numeric by removing all ‘q’ and ‘Q’ values.</li>
</ol>
<p>Let us look at the next columns</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="sec-transform.html#cb224-1" aria-hidden="true"></a>profit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(Channel) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>()</span>
<span id="cb224-2"><a href="sec-transform.html#cb224-2" aria-hidden="true"></a><span class="co">#&gt;  [1] &quot;ATM&quot; &quot;BRH&quot; &quot;INT&quot; &quot;MAL&quot; &quot;EML&quot; &quot;CCT&quot; &quot;TEL&quot; &quot;MOP&quot; &quot;DSA&quot; &quot;EVE&quot;</span></span>
<span id="cb224-3"><a href="sec-transform.html#cb224-3" aria-hidden="true"></a>profit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(<span class="st">`</span><span class="dt">Customer ID</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>()</span>
<span id="cb224-4"><a href="sec-transform.html#cb224-4" aria-hidden="true"></a><span class="co">#&gt;  [1] &quot;FRT&quot; &quot;MRT&quot; &quot;PBI&quot; &quot;MAM&quot; &quot;EBP&quot; &quot;RPB&quot; &quot;WEB&quot; &quot;WEM&quot; &quot;HEC&quot; &quot;STF&quot; &quot;IAS&quot; &quot;CRE&quot; &quot;INB&quot; &quot;CAM&quot; &quot;AGR&quot; &quot;SBE&quot;</span></span>
<span id="cb224-5"><a href="sec-transform.html#cb224-5" aria-hidden="true"></a><span class="co">#&gt; [17] &quot;AFF&quot; &quot;MFN&quot;</span></span>
<span id="cb224-6"><a href="sec-transform.html#cb224-6" aria-hidden="true"></a>profit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(Country) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>()</span>
<span id="cb224-7"><a href="sec-transform.html#cb224-7" aria-hidden="true"></a><span class="co">#&gt;  [1] &quot;USA&quot;            &quot;Canada&quot;         &quot;Great Britain&quot;  &quot;Finland&quot;        &quot;New Zealand&quot;   </span></span>
<span id="cb224-8"><a href="sec-transform.html#cb224-8" aria-hidden="true"></a><span class="co">#&gt;  [6] &quot;Brazil&quot;         &quot;Mexico&quot;         &quot;Germany&quot;        &quot;Puerto Rico&quot;    &quot;Hong Kong&quot;     </span></span>
<span id="cb224-9"><a href="sec-transform.html#cb224-9" aria-hidden="true"></a><span class="co">#&gt; [11] &quot;Japan&quot;          &quot;Columbia&quot;       &quot;Switzerland&quot;    &quot;Uruguay&quot;        &quot;Netherlands&quot;   </span></span>
<span id="cb224-10"><a href="sec-transform.html#cb224-10" aria-hidden="true"></a><span class="co">#&gt; [16] &quot;Korea&quot;          &quot;Venezuela&quot;      &quot;Panama&quot;         &quot;Sweden&quot;         &quot;China&quot;         </span></span>
<span id="cb224-11"><a href="sec-transform.html#cb224-11" aria-hidden="true"></a><span class="co">#&gt; [21] &quot;Guatemala&quot;      &quot;South Africa&quot;   &quot;Malaysia&quot;       &quot;Nigeria&quot;        &quot;Denmark&quot;       </span></span>
<span id="cb224-12"><a href="sec-transform.html#cb224-12" aria-hidden="true"></a><span class="co">#&gt; [26] &quot;France&quot;         &quot;India&quot;          &quot;Taiwan&quot;         &quot;Norway&quot;         &quot;Chile&quot;         </span></span>
<span id="cb224-13"><a href="sec-transform.html#cb224-13" aria-hidden="true"></a><span class="co">#&gt; [31] &quot;Indonesia&quot;      &quot;Ireland&quot;        &quot;Thailand&quot;       &quot;Peru&quot;           &quot;Spain&quot;         </span></span>
<span id="cb224-14"><a href="sec-transform.html#cb224-14" aria-hidden="true"></a><span class="co">#&gt; [36] &quot;Belgium&quot;        &quot;Poland&quot;         &quot;Ecuador&quot;        &quot;Costa Rica&quot;     &quot;Australia&quot;     </span></span>
<span id="cb224-15"><a href="sec-transform.html#cb224-15" aria-hidden="true"></a><span class="co">#&gt; [41] &quot;Israel&quot;         &quot;Guam&quot;           &quot;Oman&quot;           &quot;Singapore&quot;      &quot;Argentina&quot;     </span></span>
<span id="cb224-16"><a href="sec-transform.html#cb224-16" aria-hidden="true"></a><span class="co">#&gt; [46] &quot;Czechoslovakia&quot; &quot;Philippines&quot;</span></span>
<span id="cb224-17"><a href="sec-transform.html#cb224-17" aria-hidden="true"></a>profit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(<span class="st">`</span><span class="dt">Product Line</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>()</span>
<span id="cb224-18"><a href="sec-transform.html#cb224-18" aria-hidden="true"></a><span class="co">#&gt; [1] &quot;Credit Products&quot;           &quot;Deposit Products&quot;          &quot;Revolving Credit Products&quot;</span></span>
<span id="cb224-19"><a href="sec-transform.html#cb224-19" aria-hidden="true"></a><span class="co">#&gt; [4] &quot;Other Products&quot;            &quot;Third Party Products&quot;      &quot;Fee Based Products&quot;</span></span></code></pre></div>
<p>These seems to be okay. The last columns should be numbers. Let us consider <code>Revenue</code>.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="sec-transform.html#cb225-1" aria-hidden="true"></a>profit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(Revenue) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">100</span>)</span>
<span id="cb225-2"><a href="sec-transform.html#cb225-2" aria-hidden="true"></a><span class="co">#&gt;   [1] &quot;$ 6044&quot;  &quot;$ 4686&quot;  &quot;$ 6063&quot;  &quot;$ 4682&quot;  &quot;$ 6320&quot;  &quot;$ 2993&quot;  &quot;$ 3355&quot;  &quot;$ 5716&quot;  &quot;$ 3347&quot; </span></span>
<span id="cb225-3"><a href="sec-transform.html#cb225-3" aria-hidden="true"></a><span class="co">#&gt;  [10] &quot;$ 2624&quot;  &quot;$ 3629&quot;  &quot;$ 5612&quot;  &quot;$ 4618&quot;  &quot;$ 2080&quot;  &quot;$ 2788&quot;  &quot;$ 2829&quot;  &quot;$ 2898&quot;  &quot;$ 5232&quot; </span></span>
<span id="cb225-4"><a href="sec-transform.html#cb225-4" aria-hidden="true"></a><span class="co">#&gt;  [19] &quot;$ 2949&quot;  &quot;$ 5565&quot;  &quot;$ 2153&quot;  &quot;$ 3097&quot;  &quot;$ 1920&quot;  &quot;$ 4041&quot;  &quot;$ 5931&quot;  &quot;$ 1605&quot;  &quot;$ 2026&quot; </span></span>
<span id="cb225-5"><a href="sec-transform.html#cb225-5" aria-hidden="true"></a><span class="co">#&gt;  [28] &quot;$ 1687&quot;  &quot;$ 5075&quot;  &quot;$ 4223&quot;  &quot;$ 2456&quot;  &quot;$ 1924&quot;  &quot;$ 1578&quot;  &quot;$ 3235&quot;  &quot;$ 5123&quot;  &quot;$ 1560&quot; </span></span>
<span id="cb225-6"><a href="sec-transform.html#cb225-6" aria-hidden="true"></a><span class="co">#&gt;  [37] &quot;$ 1945&quot;  &quot;$ 6060&quot;  &quot;$ 1222&quot;  &quot;$ 1660&quot;  &quot;$ 3000&quot;  &quot;$ 2970&quot;  &quot;$ 1631&quot;  &quot;$ 1215&quot;  &quot;$ 1759&quot; </span></span>
<span id="cb225-7"><a href="sec-transform.html#cb225-7" aria-hidden="true"></a><span class="co">#&gt;  [46] &quot;$ 3285&quot;  &quot;$ 2048&quot;  &quot;$ 2173&quot;  &quot;$ 3353&quot;  &quot;$ 1162&quot;  &quot;$ 1232&quot;  &quot;$ 1561&quot;  &quot;$ 1123&quot;  &quot;$ 1794&quot; </span></span>
<span id="cb225-8"><a href="sec-transform.html#cb225-8" aria-hidden="true"></a><span class="co">#&gt;  [55] &quot;$ 1202&quot;  &quot;$ 1510&quot;  &quot;$ 4472&quot;  &quot;$ 2370&quot;  &quot;$ 2581&quot;  &quot;$ 2761&quot;  &quot;$ 6371&quot;  &quot;$ 1972&quot;  &quot;$ 1562&quot; </span></span>
<span id="cb225-9"><a href="sec-transform.html#cb225-9" aria-hidden="true"></a><span class="co">#&gt;  [64] &quot;$ 2742&quot;  &quot;$ 4598&quot;  &quot;$ 5322&quot;  &quot;$ 3411&quot;  NA        &quot;$ 1569&quot;  &quot;$ 2852&quot;  &quot;$ 1622&quot;  &quot;$ 2505&quot; </span></span>
<span id="cb225-10"><a href="sec-transform.html#cb225-10" aria-hidden="true"></a><span class="co">#&gt;  [73] &quot;$ 1596&quot;  &quot;$ 1447&quot;  &quot;$ 1690&quot;  &quot;$ 2448&quot;  &quot;$ 1593&quot;  &quot;$ 1876&quot;  &quot;$ 6591&quot;  &quot;$ 1611&quot;  &quot;$ 1254&quot; </span></span>
<span id="cb225-11"><a href="sec-transform.html#cb225-11" aria-hidden="true"></a><span class="co">#&gt;  [82] &quot;Unknown&quot; &quot;$ 842&quot;   &quot;$ 1529&quot;  &quot;$ 1439&quot;  &quot;$ 762&quot;   &quot;$ 1959&quot;  &quot;$ 4382&quot;  &quot;$ 1407&quot;  &quot;$ 909&quot;  </span></span>
<span id="cb225-12"><a href="sec-transform.html#cb225-12" aria-hidden="true"></a><span class="co">#&gt;  [91] &quot;$ 1549&quot;  &quot;$ 2161&quot;  &quot;$ 1331&quot;  &quot;$ 727&quot;   &quot;$ 1462&quot;  &quot;$ 1067&quot;  &quot;$ 833&quot;   &quot;$ 1675&quot;  &quot;$ 1524&quot; </span></span>
<span id="cb225-13"><a href="sec-transform.html#cb225-13" aria-hidden="true"></a><span class="co">#&gt; [100] &quot;$ 1285&quot;</span></span></code></pre></div>
<p>Most values start with a dollar sign. Let us have a look at the other ones:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="sec-transform.html#cb226-1" aria-hidden="true"></a>profit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">str_starts</span>(Revenue, <span class="kw">fixed</span>(<span class="st">&quot;$&quot;</span>))) </span>
<span id="cb226-2"><a href="sec-transform.html#cb226-2" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 95 x 9</span></span>
<span id="cb226-3"><a href="sec-transform.html#cb226-3" aria-hidden="true"></a><span class="co">#&gt;    Quarter Channel `Customer ID` Country `Product Line` Revenue `Product Cost` `Customer Servi…</span></span>
<span id="cb226-4"><a href="sec-transform.html#cb226-4" aria-hidden="true"></a><span class="co">#&gt;      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;         &lt;chr&gt;   &lt;chr&gt;          &lt;chr&gt;   &lt;chr&gt;          &lt;chr&gt;           </span></span>
<span id="cb226-5"><a href="sec-transform.html#cb226-5" aria-hidden="true"></a><span class="co">#&gt;  1       3 INT     MAM           USA     Deposit Produ… Unknown $ 1008         $ 246           </span></span>
<span id="cb226-6"><a href="sec-transform.html#cb226-6" aria-hidden="true"></a><span class="co">#&gt;  2       3 MAL     RPB           USA     Credit Produc… ?       $ 1420         $ 347           </span></span>
<span id="cb226-7"><a href="sec-transform.html#cb226-7" aria-hidden="true"></a><span class="co">#&gt;  3       1 MAL     WEM           Great … Other Products ?       $ 87           $ 19            </span></span>
<span id="cb226-8"><a href="sec-transform.html#cb226-8" aria-hidden="true"></a><span class="co">#&gt;  4       3 ATM     MFN           Germany Fee Based Pro… unknown $ 47           $ 6             </span></span>
<span id="cb226-9"><a href="sec-transform.html#cb226-9" aria-hidden="true"></a><span class="co">#&gt;  5       3 ATM     PBI           Costa … Third Party P… Unknown $ 51           $ 9             </span></span>
<span id="cb226-10"><a href="sec-transform.html#cb226-10" aria-hidden="true"></a><span class="co">#&gt;  6       1 ATM     PBI           Chile   Deposit Produ… Unknown $ 58           $ 7             </span></span>
<span id="cb226-11"><a href="sec-transform.html#cb226-11" aria-hidden="true"></a><span class="co">#&gt;  7       4 CCT     MRT           Great … Revolving Cre… ?       $ 27           $ 5             </span></span>
<span id="cb226-12"><a href="sec-transform.html#cb226-12" aria-hidden="true"></a><span class="co">#&gt;  8       4 ATM     MAM           Taiwan  Third Party P… unknown $ 55           $ 9             </span></span>
<span id="cb226-13"><a href="sec-transform.html#cb226-13" aria-hidden="true"></a><span class="co">#&gt;  9       4 MAL     WEB           Japan   Other Products unknown $ 40           $ 7             </span></span>
<span id="cb226-14"><a href="sec-transform.html#cb226-14" aria-hidden="true"></a><span class="co">#&gt; 10       2 CCT     MAM           Nether… Credit Produc… unknown $ 14           $ 3             </span></span>
<span id="cb226-15"><a href="sec-transform.html#cb226-15" aria-hidden="true"></a><span class="co">#&gt; # … with 85 more rows, and 1 more variable: Profit &lt;chr&gt;</span></span>
<span id="cb226-16"><a href="sec-transform.html#cb226-16" aria-hidden="true"></a>na_values &lt;-<span class="st"> </span>profit <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb226-17"><a href="sec-transform.html#cb226-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">str_starts</span>(Revenue, <span class="kw">fixed</span>(<span class="st">&quot;$&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb226-18"><a href="sec-transform.html#cb226-18" aria-hidden="true"></a><span class="st">  </span><span class="kw">distinct</span>(Revenue) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb226-19"><a href="sec-transform.html#cb226-19" aria-hidden="true"></a><span class="st">  </span><span class="kw">pull</span>(Revenue)</span>
<span id="cb226-20"><a href="sec-transform.html#cb226-20" aria-hidden="true"></a>na_values</span>
<span id="cb226-21"><a href="sec-transform.html#cb226-21" aria-hidden="true"></a><span class="co">#&gt; [1] &quot;Unknown&quot; &quot;?&quot;       &quot;unknown&quot;</span></span></code></pre></div>
<p>The expression is a bit complex. Let us break it up. Function <code>fixed</code> just return the fixed string ‘$’. This is necessary since the dollar sign have a special meaning in regular expressions (beyond the scope here). Function <code>str_starts</code> check if the string starts with a dollar sign. We use the logical negation (NOT) to find the complementary set.</p>
<p>Note that different strings have been used to indicate <code>NA</code> values (Unknown, ?, unknown). Let us first use a single value to indicate <code>NA</code> (a question mark):</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="sec-transform.html#cb227-1" aria-hidden="true"></a>profit &lt;-<span class="st"> </span>profit <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb227-2"><a href="sec-transform.html#cb227-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Revenue =</span> <span class="kw">str_replace_all</span>(Revenue, <span class="kw">c</span>(<span class="st">&quot;unknown&quot;</span> =<span class="st"> &quot;?&quot;</span>, <span class="st">&quot;Unknown&quot;</span> =<span class="st"> &quot;?&quot;</span>)))</span></code></pre></div>
<p>Next, we replace all <code>?</code> with <code>NA</code>:</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="sec-transform.html#cb228-1" aria-hidden="true"></a>profit &lt;-<span class="st"> </span>profit <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb228-2"><a href="sec-transform.html#cb228-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Revenue =</span> <span class="kw">na_if</span>(Revenue, <span class="st">&quot;?&quot;</span>))</span>
<span id="cb228-3"><a href="sec-transform.html#cb228-3" aria-hidden="true"></a>profit <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># check</span></span>
<span id="cb228-4"><a href="sec-transform.html#cb228-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">str_starts</span>(Revenue, <span class="kw">fixed</span>(<span class="st">&quot;$&quot;</span>))) </span>
<span id="cb228-5"><a href="sec-transform.html#cb228-5" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 0 x 9</span></span>
<span id="cb228-6"><a href="sec-transform.html#cb228-6" aria-hidden="true"></a><span class="co">#&gt; # … with 9 variables: Quarter &lt;dbl&gt;, Channel &lt;chr&gt;, `Customer ID` &lt;chr&gt;, Country &lt;chr&gt;, `Product</span></span>
<span id="cb228-7"><a href="sec-transform.html#cb228-7" aria-hidden="true"></a><span class="co">#&gt; #   Line` &lt;chr&gt;, Revenue &lt;chr&gt;, `Product Cost` &lt;chr&gt;, `Customer Service Cost` &lt;chr&gt;, Profit &lt;chr&gt;</span></span></code></pre></div>
<p>Finally, we remove all dollar signs:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="sec-transform.html#cb229-1" aria-hidden="true"></a>profit &lt;-<span class="st"> </span>profit <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb229-2"><a href="sec-transform.html#cb229-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Revenue =</span> <span class="kw">str_remove</span>(Revenue, <span class="kw">fixed</span>(<span class="st">&quot;$ &quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.numeric</span>())</span>
<span id="cb229-3"><a href="sec-transform.html#cb229-3" aria-hidden="true"></a>profit</span>
<span id="cb229-4"><a href="sec-transform.html#cb229-4" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 24,546 x 9</span></span>
<span id="cb229-5"><a href="sec-transform.html#cb229-5" aria-hidden="true"></a><span class="co">#&gt;    Quarter Channel `Customer ID` Country `Product Line` Revenue `Product Cost` `Customer Servi…</span></span>
<span id="cb229-6"><a href="sec-transform.html#cb229-6" aria-hidden="true"></a><span class="co">#&gt;      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;         &lt;chr&gt;   &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;           </span></span>
<span id="cb229-7"><a href="sec-transform.html#cb229-7" aria-hidden="true"></a><span class="co">#&gt;  1       3 ATM     FRT           USA     Credit Produc…    6044 $ 3998         $ 413           </span></span>
<span id="cb229-8"><a href="sec-transform.html#cb229-8" aria-hidden="true"></a><span class="co">#&gt;  2       1 ATM     MRT           USA     Credit Produc…    4686 $ 3229         $ 643           </span></span>
<span id="cb229-9"><a href="sec-transform.html#cb229-9" aria-hidden="true"></a><span class="co">#&gt;  3       4 ATM     PBI           USA     Deposit Produ…    6063 $ 7440         $ 1842          </span></span>
<span id="cb229-10"><a href="sec-transform.html#cb229-10" aria-hidden="true"></a><span class="co">#&gt;  4       1 ATM     PBI           USA     Deposit Produ…    4682 $ 6127         $ 1118          </span></span>
<span id="cb229-11"><a href="sec-transform.html#cb229-11" aria-hidden="true"></a><span class="co">#&gt;  5       4 ATM     MRT           USA     Deposit Produ…    6320 $ 7913         $ 1854          </span></span>
<span id="cb229-12"><a href="sec-transform.html#cb229-12" aria-hidden="true"></a><span class="co">#&gt;  6       3 BRH     MAM           USA     Deposit Produ…    2993 $ 1034         $ 242           </span></span>
<span id="cb229-13"><a href="sec-transform.html#cb229-13" aria-hidden="true"></a><span class="co">#&gt;  7       4 BRH     PBI           USA     Revolving Cre…    3355 $ 4355         $ 1027          </span></span>
<span id="cb229-14"><a href="sec-transform.html#cb229-14" aria-hidden="true"></a><span class="co">#&gt;  8       3 ATM     FRT           USA     Revolving Cre…    5716 $ 5617         $ 876           </span></span>
<span id="cb229-15"><a href="sec-transform.html#cb229-15" aria-hidden="true"></a><span class="co">#&gt;  9       4 BRH     PBI           USA     Deposit Produ…    3347 $ 4229         $ 425           </span></span>
<span id="cb229-16"><a href="sec-transform.html#cb229-16" aria-hidden="true"></a><span class="co">#&gt; 10       1 BRH     PBI           USA     Credit Produc…    2624 $ 1960         $ 264           </span></span>
<span id="cb229-17"><a href="sec-transform.html#cb229-17" aria-hidden="true"></a><span class="co">#&gt; # … with 24,536 more rows, and 1 more variable: Profit &lt;chr&gt;</span></span></code></pre></div>
<p>As one pipe:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="sec-transform.html#cb230-1" aria-hidden="true"></a>profit &lt;-<span class="st"> </span>profit <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb230-2"><a href="sec-transform.html#cb230-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Revenue =</span> <span class="kw">str_replace_all</span>(Revenue, <span class="kw">c</span>(<span class="st">&quot;unknown&quot;</span> =<span class="st"> &quot;?&quot;</span>, <span class="st">&quot;Unknown&quot;</span> =<span class="st"> &quot;?&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb230-3"><a href="sec-transform.html#cb230-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Revenue =</span> <span class="kw">na_if</span>(Revenue, <span class="st">&quot;?&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb230-4"><a href="sec-transform.html#cb230-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Revenue =</span> <span class="kw">str_remove</span>(Revenue, <span class="kw">fixed</span>(<span class="st">&quot;$ &quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.numeric</span>())</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Convert the remaining columns to numeric like shown for <code>Revenue</code> above.</li>
</ol>
<div aria-labelledby="solution44-title" class="modal fade bs-example-modal-lg" id="solution44" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution44-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit &lt;- read_csv(path)
profit &lt;- profit %&gt;% 
  mutate(across(Revenue:Profit, ~str_replace_all(.x, c(&quot;unknown&quot; = &quot;?&quot;, &quot;Unknown&quot; = &quot;?&quot;)) )) %&gt;% 
  mutate(across(Revenue:Profit, ~na_if(.x, &quot;?&quot;) )) %&gt;% 
  mutate(across(Revenue:Profit, ~str_remove(.x, fixed(&quot;$ &quot;)) %&gt;% as.numeric() )) 
profit
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution44">Solution</button>
<ol start="3" style="list-style-type: decimal">
<li>Use the <code>across</code> function to apply the operations in Question 2 for a set of columns. Hint: see the examples on the help page of <code>across</code>. The code should look like:
<code>r       profit &lt;- read_csv(path) %&gt;%          mutate(across(___:___, ~str_replace_all(.x, c("unknown" = "?", "Unknown" = "?")) )) %&gt;%          mutate(across(___:___, ~na_if(.x, "?") )) %&gt;%          mutate(across(___:___, ~str_remove(.x, fixed("$ ")) %&gt;% as.numeric() ))        profit</code></li>
</ol>
<div aria-labelledby="solution45-title" class="modal fade bs-example-modal-lg" id="solution45" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution45-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit &lt;- read_csv(path) %&gt;% 
  mutate(Quarter = str_remove(Quarter, &quot;q&quot;) %&gt;% str_remove(&quot;Q&quot;) %&gt;% as.numeric()) %&gt;% 
  mutate(across(Revenue:Profit, ~str_replace_all(.x, c(&quot;unknown&quot; = &quot;?&quot;, &quot;Unknown&quot; = &quot;?&quot;)) )) %&gt;% 
  mutate(across(Revenue:Profit, ~na_if(.x, &quot;?&quot;) )) %&gt;% 
  mutate(across(Revenue:Profit, ~str_remove(.x, fixed(&quot;$ &quot;)) %&gt;% as.numeric() )) 
skim(profit)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution45">Solution</button>
<ol start="4" style="list-style-type: decimal">
<li>Write one pipe that do all the cleaning</li>
</ol>
<div aria-labelledby="solution46-title" class="modal fade bs-example-modal-lg" id="solution46" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution46-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit &lt;- profit %&gt;% 
  mutate(Profit_calc = Revenue - `Product Cost` - `Customer Service Cost`, Diff = abs(Profit - Profit_calc)) %&gt;%  
  mutate(Profit = if_else(Diff &gt; 0 &amp; Diff &lt;= 1, Profit_calc, Profit, missing = Profit) ) 
profit %&gt;% filter(Diff == 1, is.na(Profit_calc))  # check
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution46">Solution</button>
<ol start="5" style="list-style-type: decimal">
<li>Validate that revenue - product costs - customer service cost equals profit. If you see small rounding errors (less than or equal 1) then recalculate the profit.</li>
</ol>
<div aria-labelledby="solution47-title" class="modal fade bs-example-modal-lg" id="solution47" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution47-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit &lt;- profit %&gt;% 
  rowwise() %&gt;% 
  mutate(c_na = sum(is.na(c_across(Revenue:Profit)))) %&gt;% 
  mutate(Revenue = if_else(is.na(Revenue) &amp; c_na == 1, Profit + `Product Cost` + `Customer Service Cost`, Revenue, Revenue),
         `Product Cost` = if_else(is.na(`Product Cost`) &amp; c_na == 1, - Profit + Revenue - `Customer Service Cost`, `Product Cost`), 
         `Customer Service Cost` = if_else(is.na(`Customer Service Cost`) &amp; c_na == 1, - Profit + Revenue - `Product Cost`, `Customer Service Cost`)) %&gt;% 
  select(Quarter:Profit)

# check - do numbers match
profit %&gt;% 
  mutate(Profit_calc = Revenue - `Product Cost` - `Customer Service Cost`, Diff = abs(Profit - Profit_calc)) %&gt;%  
  filter(Diff &gt; 0)

# check - find NA values
profit %&gt;% 
  rowwise() %&gt;% 
  mutate(c_na = sum(is.na(c_across(Revenue:Profit)))) %&gt;% filter(c_na &gt; 0)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution47">Solution</button>
<ol start="6" style="list-style-type: decimal">
<li><p>Recalculate values in columns <code>Revenue</code> - <code>Profit</code> if possible. Hint: recall that profit = revenue - product costs - customer service cost; that is, if a single value of these are missing then the value can be calculated using the other ones. To find the number of missing values (<code>NA</code>) you can create a new column counting the number of missing values:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="sec-transform.html#cb231-1" aria-hidden="true"></a>profit &lt;-<span class="st"> </span>profit <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb231-2"><a href="sec-transform.html#cb231-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb231-3"><a href="sec-transform.html#cb231-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ct_na =</span> <span class="kw">sum</span>(<span class="kw">is.na</span>(<span class="kw">c_across</span>(Revenue<span class="op">:</span>Profit)))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb231-4"><a href="sec-transform.html#cb231-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb231-5"><a href="sec-transform.html#cb231-5" aria-hidden="true"></a>profit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(ct_na <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb231-6"><a href="sec-transform.html#cb231-6" aria-hidden="true"></a><span class="co">#&gt; # A tibble: 312 x 12</span></span>
<span id="cb231-7"><a href="sec-transform.html#cb231-7" aria-hidden="true"></a><span class="co">#&gt;    Quarter Channel `Customer ID` Country `Product Line` Revenue `Product Cost` `Customer Servi…</span></span>
<span id="cb231-8"><a href="sec-transform.html#cb231-8" aria-hidden="true"></a><span class="co">#&gt;      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;         &lt;chr&gt;   &lt;chr&gt;            &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb231-9"><a href="sec-transform.html#cb231-9" aria-hidden="true"></a><span class="co">#&gt;  1       1 MAL     FRT           USA     Credit Produc…      NA           1579              244</span></span>
<span id="cb231-10"><a href="sec-transform.html#cb231-10" aria-hidden="true"></a><span class="co">#&gt;  2       2 ATM     EBP           USA     Revolving Cre…    3629           1705               NA</span></span>
<span id="cb231-11"><a href="sec-transform.html#cb231-11" aria-hidden="true"></a><span class="co">#&gt;  3       3 INT     MAM           USA     Deposit Produ…      NA           1008              246</span></span>
<span id="cb231-12"><a href="sec-transform.html#cb231-12" aria-hidden="true"></a><span class="co">#&gt;  4       4 ATM     CRE           USA     Deposit Produ…     833            357               NA</span></span>
<span id="cb231-13"><a href="sec-transform.html#cb231-13" aria-hidden="true"></a><span class="co">#&gt;  5       3 MAL     RPB           USA     Credit Produc…      NA           1420              347</span></span>
<span id="cb231-14"><a href="sec-transform.html#cb231-14" aria-hidden="true"></a><span class="co">#&gt;  6       3 MAL     WEB           USA     Other Products     252             NA               43</span></span>
<span id="cb231-15"><a href="sec-transform.html#cb231-15" aria-hidden="true"></a><span class="co">#&gt;  7       1 INT     WEM           USA     Other Products     371             NA              106</span></span>
<span id="cb231-16"><a href="sec-transform.html#cb231-16" aria-hidden="true"></a><span class="co">#&gt;  8       1 BRH     STF           USA     Revolving Cre…      NA            368               70</span></span>
<span id="cb231-17"><a href="sec-transform.html#cb231-17" aria-hidden="true"></a><span class="co">#&gt;  9       2 EML     INB           USA     Credit Produc…     408            441               NA</span></span>
<span id="cb231-18"><a href="sec-transform.html#cb231-18" aria-hidden="true"></a><span class="co">#&gt; 10       4 ATM     CAM           USA     Other Products      NA             83               10</span></span>
<span id="cb231-19"><a href="sec-transform.html#cb231-19" aria-hidden="true"></a><span class="co">#&gt; # … with 302 more rows, and 4 more variables: Profit &lt;dbl&gt;, Profit_calc &lt;dbl&gt;, Diff &lt;dbl&gt;,</span></span>
<span id="cb231-20"><a href="sec-transform.html#cb231-20" aria-hidden="true"></a><span class="co">#&gt; #   ct_na &lt;int&gt;</span></span></code></pre></div>
<pre><code> You can now recalculate values using a code like:</code></pre>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="sec-transform.html#cb233-1" aria-hidden="true"></a>profit &lt;-<span class="st"> </span>profit <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb233-2"><a href="sec-transform.html#cb233-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Revenue =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(Revenue) <span class="op">&amp;</span><span class="st"> </span>c_na <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, Profit <span class="op">+</span><span class="st"> `</span><span class="dt">Product Cost</span><span class="st">`</span> <span class="op">+</span><span class="st"> `</span><span class="dt">Customer Service Cost</span><span class="st">`</span>, Revenue, Revenue),</span>
<span id="cb233-3"><a href="sec-transform.html#cb233-3" aria-hidden="true"></a>         <span class="st">`</span><span class="dt">Product Cost</span><span class="st">`</span> =<span class="st"> </span><span class="kw">if_else</span>(___, ___, ___), </span>
<span id="cb233-4"><a href="sec-transform.html#cb233-4" aria-hidden="true"></a>         <span class="st">`</span><span class="dt">Customer Service Cost</span><span class="st">`</span> =<span class="st"> </span><span class="kw">if_else</span>(___, ___, ___))</span></code></pre></div>
<p>You can check you calculations using your code from Question 5.</p></li>
</ol>
<div aria-labelledby="solution48-title" class="modal fade bs-example-modal-lg" id="solution48" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution48-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit %&gt;% 
  group_by(Quarter) %&gt;% 
  slice_max(Profit, n = 2)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution48">Solution</button>
<ol start="7" style="list-style-type: decimal">
<li>Find the two best rows with highest profit in each quarter.</li>
</ol>
<div aria-labelledby="solution49-title" class="modal fade bs-example-modal-lg" id="solution49" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution49-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit %&gt;% 
  group_by(Quarter, `Customer ID`) %&gt;% 
  summarise(Profit = sum(Profit)) %&gt;% 
  slice_max(Profit, n = 2)
</code></pre>

<p>The results are not the same with group rows now.</p>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution49">Solution</button>
<ol start="8" style="list-style-type: decimal">
<li>Find the two best customers with highest profit in each quarter. Is the results the same as in Question 7?</li>
</ol>
<div aria-labelledby="solution50-title" class="modal fade bs-example-modal-lg" id="solution50" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution50-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit %&gt;% 
  group_by(`Product Line`) %&gt;% 
  summarise(Profit = sum(Profit)) %&gt;% 
  slice_max(Profit)
# ... repeat 

# Using a function
summarise_profit  &lt;- function(data, group_var, summarise_var) {
  data %&gt;%
    group_by(across({{ group_var }})) %&gt;% 
    summarise(across({{ summarise_var }}, sum)) %&gt;% 
    slice_max(Profit)
}
summarise_profit(profit, `Product Line`, Profit)
summarise_profit(profit, `Customer ID`, Profit)
# ... repeat

# Using purrr package to get a single tibble (if intested in the purrr package)
val &lt;- names(profit)[1:5]
max_profit &lt;- map_df(
  val, 
  ~{
      tmp &lt;- profit %&gt;% 
        group_by(.data[[.x]]) %&gt;% 
        summarise(Profit = sum(Profit), .groups = &quot;drop&quot;) %&gt;% 
        slice_max(Profit)
      tibble(by = .x, 
        best = as.character(tmp[[1,1]]),
        profit = tmp[[1,2]] 
      )
    } 
  )
max_profit
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution50">Solution</button>
<ol start="9" style="list-style-type: decimal">
<li>Find the product line, customer, channel, country and quarter with the highest profit.</li>
</ol>
<div aria-labelledby="solution51-title" class="modal fade bs-example-modal-lg" id="solution51" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution51-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit %&gt;% 
  group_by(`Customer ID`) %&gt;% 
  distinct(Country) %&gt;% 
  count(`Customer ID`)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution51">Solution</button>
<ol start="10" style="list-style-type: decimal">
<li>Is there rows with the same customer in different countries?</li>
</ol>
<div aria-labelledby="solution52-title" class="modal fade bs-example-modal-lg" id="solution52" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution52-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit %&gt;% 
  arrange(desc(Profit), desc(Revenue))
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution52">Solution</button>
<ol start="11" style="list-style-type: decimal">
<li>Sort the data decreasing with respect to profit and next revenue.</li>
</ol>
<div aria-labelledby="solution53-title" class="modal fade bs-example-modal-lg" id="solution53" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution53-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit %&gt;% 
  group_by(`Product Line`) %&gt;% 
  summarise(cost = sum(`Product Cost` + `Customer Service Cost`)) %&gt;% 
  # print() %&gt;%   # if want a peek before slicing 
  slice_max(cost)

profit %&gt;% 
  group_by(`Product Line`) %&gt;% 
  summarise(cost = sum(`Product Cost`)) %&gt;% 
  slice_min(cost)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution53">Solution</button>
<ol start="12" style="list-style-type: decimal">
<li>Which product line has the highest and lowest total cost?</li>
</ol>
<div aria-labelledby="solution54-title" class="modal fade bs-example-modal-lg" id="solution54" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
<h4 class="modal-title" id="solution54-title">Solution</h4>
</div>
<div class="modal-body"><pre><code class="r">profit %&gt;%
  mutate(cust_cost_new = `Customer Service Cost` * 1.05, 
         profit_new = Revenue - cust_cost_new - `Product Cost`) %&gt;% 
  group_by(`Product Line`) %&gt;% 
  summarise(cust_cost = sum(`Customer Service Cost`), profit = sum(Profit), 
            cust_cost_new = sum(cust_cost_new), profit_new = sum(profit_new),
            profit_decrease = profit_new - profit)
</code></pre>
</div>
<div class="modal-footer">
<button class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#solution54">Solution</button>
<ol start="13" style="list-style-type: decimal">
<li>Assume that customer service cost increase with 5%. How will that affect the profit for each product line?</li>
</ol>

</div>
</div>
</div>



<h3>References</h3>
<div id="refs" class="references">
<div id="ref-rdpeng">
<p>Peng, R. D. 2018. <em>R Programming for Data Science</em>. <a href="https://bookdown.org/rdpeng/rprogdatascience/">https://bookdown.org/rdpeng/rprogdatascience/</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sec-io.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sec-plot.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/bss-osca/tfa/edit/master/book/transform.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

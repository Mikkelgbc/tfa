<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Module 20 Spatial data and maps | Tools for Analytics (TFA)</title>
  <meta name="description" content="Course notes for the ‘Tools for Analytics’ course" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Module 20 Spatial data and maps | Tools for Analytics (TFA)" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://bss-osca.github.io/tfa/" />
  <meta property="og:image" content="https://bss-osca.github.io/tfa//assets/logo.png" />
  <meta property="og:description" content="Course notes for the ‘Tools for Analytics’ course" />
  <meta name="github-repo" content="bss-osca/tfa" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Module 20 Spatial data and maps | Tools for Analytics (TFA)" />
  
  <meta name="twitter:description" content="Course notes for the ‘Tools for Analytics’ course" />
  <meta name="twitter:image" content="https://bss-osca.github.io/tfa//assets/logo.png" />

<meta name="author" content="Lars Relund Nielsen" />


<meta name="date" content="2021-11-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon" />
<link rel="prev" href="mod-r-dist-fit.html"/>
<link rel="next" href="mod-r-excel.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
<link href="libs/font-awesome-5.3.1/css/all.min.css" rel="stylesheet" />
<link href="libs/font-awesome-5.3.1/css/v4-shims.min.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>
<link href="libs/minichart-0.2.2/minicharts.css" rel="stylesheet" />
<script src="libs/minichart-0.2.2/leaflet.minicharts.min.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.19/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<html>
<head>
<script>
  $(document).ready(function() {

  // Section anchors
  $('.section h1, .section h2, .section h3, .section h4, .section h5').each(function() {
    anchor = '#' + $(this).parent().attr('id');
    $(this).addClass("hasAnchor").prepend('<a href="' + anchor + '" class="anchor"></a>');
  });
});
</script>
<script src="https://hypothes.is/embed.js" async></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</head>
</html>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="img/logo.png"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction to the book</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#lo-intro"><i class="fa fa-check"></i><b>1.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#purpose"><i class="fa fa-check"></i><b>1.2</b> Purpose for the book</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#r-vs-vba"><i class="fa fa-check"></i><b>1.3</b> R vs Excel/VBA</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#computer"><i class="fa fa-check"></i><b>1.4</b> How a computer works</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#organization"><i class="fa fa-check"></i><b>1.5</b> How this book is organized</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#ack"><i class="fa fa-check"></i><b>1.6</b> Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I Getting started with VBA</b></span></li>
<li class="chapter" data-level="2" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html"><i class="fa fa-check"></i><b>2</b> An introduction to VBA</a><ul>
<li class="chapter" data-level="2.1" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#lo-vba-intro"><i class="fa fa-check"></i><b>2.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="2.2" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#vba-what"><i class="fa fa-check"></i><b>2.2</b> What is VBA</a></li>
<li class="chapter" data-level="2.3" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#vba-hello"><i class="fa fa-check"></i><b>2.3</b> Your first program</a></li>
<li class="chapter" data-level="2.4" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#vba-macro"><i class="fa fa-check"></i><b>2.4</b> The macro recorder</a></li>
<li class="chapter" data-level="2.5" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#a-short-overview"><i class="fa fa-check"></i><b>2.5</b> A short overview</a></li>
<li class="chapter" data-level="2.6" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#rc-vba-intro"><i class="fa fa-check"></i><b>2.6</b> Recap</a></li>
<li class="chapter" data-level="2.7" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-intro"><i class="fa fa-check"></i><b>2.7</b> Exercises</a><ul>
<li class="chapter" data-level="2.7.1" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-hello"><i class="fa fa-check"></i><b>2.7.1</b> Exercise - Hello</a></li>
<li class="chapter" data-level="2.7.2" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-macro"><i class="fa fa-check"></i><b>2.7.2</b> Exercise - Record a macro</a></li>
<li class="chapter" data-level="2.7.3" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-user-input"><i class="fa fa-check"></i><b>2.7.3</b> Exercise - User input</a></li>
<li class="chapter" data-level="2.7.4" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-max-min"><i class="fa fa-check"></i><b>2.7.4</b> Exercise - Max and min number</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Programming in VBA</b></span></li>
<li class="chapter" data-level="3" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html"><i class="fa fa-check"></i><b>3</b> Data types and variables</a><ul>
<li class="chapter" data-level="3.1" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#lo-vba-datatypes"><i class="fa fa-check"></i><b>3.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="3.2" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#vba-datatypes"><i class="fa fa-check"></i><b>3.2</b> Datatypes</a><ul>
<li class="chapter" data-level="3.2.1" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#collections"><i class="fa fa-check"></i><b>3.2.1</b> Collections</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#vba-code-structure"><i class="fa fa-check"></i><b>3.3</b> How do I structure my code?</a></li>
<li class="chapter" data-level="3.4" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#recap"><i class="fa fa-check"></i><b>3.4</b> Recap</a></li>
<li class="chapter" data-level="3.5" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-datatypes"><i class="fa fa-check"></i><b>3.5</b> Exercises</a><ul>
<li class="chapter" data-level="3.5.1" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-search-products"><i class="fa fa-check"></i><b>3.5.1</b> Exercise - Product search</a></li>
<li class="chapter" data-level="3.5.2" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-read-arrays"><i class="fa fa-check"></i><b>3.5.2</b> Exercise - Read arrays</a></li>
<li class="chapter" data-level="3.5.3" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-read-collections"><i class="fa fa-check"></i><b>3.5.3</b> Exercise - Read collections</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html"><i class="fa fa-check"></i><b>4</b> Procedures</a><ul>
<li class="chapter" data-level="4.1" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#lo-vba-procedures"><i class="fa fa-check"></i><b>4.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="4.2" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#vba-procedures"><i class="fa fa-check"></i><b>4.2</b> Procedures</a></li>
<li class="chapter" data-level="4.3" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#vba-debug"><i class="fa fa-check"></i><b>4.3</b> How do I debug my code?</a></li>
<li class="chapter" data-level="4.4" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#recap-1"><i class="fa fa-check"></i><b>4.4</b> Recap</a></li>
<li class="chapter" data-level="4.5" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#ex-vba-procedures"><i class="fa fa-check"></i><b>4.5</b> Exercises</a><ul>
<li class="chapter" data-level="4.5.1" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#ex-vba-subs"><i class="fa fa-check"></i><b>4.5.1</b> Exercise - Subs</a></li>
<li class="chapter" data-level="4.5.2" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#ex-vba-functions"><i class="fa fa-check"></i><b>4.5.2</b> Exercise - Functions</a></li>
<li class="chapter" data-level="4.5.3" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#ex-vba-worksheet-functions"><i class="fa fa-check"></i><b>4.5.3</b> Exercise - Worksheet functions</a></li>
<li class="chapter" data-level="4.5.4" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#ex-vba-byref"><i class="fa fa-check"></i><b>4.5.4</b> Exercise - <code>ByRef</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html"><i class="fa fa-check"></i><b>5</b> Loops and conditional statements</a><ul>
<li class="chapter" data-level="5.1" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#lo-vba-loops-cond"><i class="fa fa-check"></i><b>5.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="5.2" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#vba-cond"><i class="fa fa-check"></i><b>5.2</b> Conditional statements</a></li>
<li class="chapter" data-level="5.3" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#vba-loops"><i class="fa fa-check"></i><b>5.3</b> Loops</a></li>
<li class="chapter" data-level="5.4" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#recap-2"><i class="fa fa-check"></i><b>5.4</b> Recap</a></li>
<li class="chapter" data-level="5.5" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#ex-vba-loops-cond"><i class="fa fa-check"></i><b>5.5</b> Exercises</a><ul>
<li class="chapter" data-level="5.5.1" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#ex-vba-loops"><i class="fa fa-check"></i><b>5.5.1</b> Exercise - Loops</a></li>
<li class="chapter" data-level="5.5.2" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#ex-vba-flight"><i class="fa fa-check"></i><b>5.5.2</b> Exercise - Flight search</a></li>
<li class="chapter" data-level="5.5.3" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#ex-vba-job-seq"><i class="fa fa-check"></i><b>5.5.3</b> Exercise - Job sequencing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mod-vba-object-model.html"><a href="mod-vba-object-model.html"><i class="fa fa-check"></i><b>6</b> Object model</a><ul>
<li class="chapter" data-level="6.1" data-path="mod-vba-object-model.html"><a href="mod-vba-object-model.html#lo-vba-object-model"><i class="fa fa-check"></i><b>6.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="6.2" data-path="mod-vba-object-model.html"><a href="mod-vba-object-model.html#vba-object-model"><i class="fa fa-check"></i><b>6.2</b> Object model</a></li>
<li class="chapter" data-level="6.3" data-path="mod-vba-object-model.html"><a href="mod-vba-object-model.html#recap-3"><i class="fa fa-check"></i><b>6.3</b> Recap</a></li>
<li class="chapter" data-level="6.4" data-path="mod-vba-object-model.html"><a href="mod-vba-object-model.html#ex-vba-object-model"><i class="fa fa-check"></i><b>6.4</b> Exercises</a><ul>
<li class="chapter" data-level="6.4.1" data-path="mod-vba-object-model.html"><a href="mod-vba-object-model.html#ex-vba-worksheets"><i class="fa fa-check"></i><b>6.4.1</b> Exercise - Worksheets</a></li>
<li class="chapter" data-level="6.4.2" data-path="mod-vba-object-model.html"><a href="mod-vba-object-model.html#ex-vba-ranges"><i class="fa fa-check"></i><b>6.4.2</b> Exercise - Ranges</a></li>
<li class="chapter" data-level="6.4.3" data-path="mod-vba-object-model.html"><a href="mod-vba-object-model.html#ex-vba-collections"><i class="fa fa-check"></i><b>6.4.3</b> Exercise - Collections</a></li>
<li class="chapter" data-level="6.4.4" data-path="mod-vba-object-model.html"><a href="mod-vba-object-model.html#ex-vba-production-plan"><i class="fa fa-check"></i><b>6.4.4</b> Exercise - Production plan</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Extra topics in VBA</b></span></li>
<li class="chapter" data-level="7" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html"><i class="fa fa-check"></i><b>7</b> Generating random numbers</a><ul>
<li class="chapter" data-level="7.1" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#lo-vba-random-numbers"><i class="fa fa-check"></i><b>7.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="7.2" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#vba-random-numbers"><i class="fa fa-check"></i><b>7.2</b> Generating random numbers</a></li>
<li class="chapter" data-level="7.3" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#vba-simulation"><i class="fa fa-check"></i><b>7.3</b> Simulation</a></li>
<li class="chapter" data-level="7.4" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#recap-4"><i class="fa fa-check"></i><b>7.4</b> Recap</a></li>
<li class="chapter" data-level="7.5" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#ex-vba-random-numbers"><i class="fa fa-check"></i><b>7.5</b> Exercises</a><ul>
<li class="chapter" data-level="7.5.1" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#ex-vba-generate"><i class="fa fa-check"></i><b>7.5.1</b> Exercise - Generating random numbers</a></li>
<li class="chapter" data-level="7.5.2" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#ex-vba-tsp"><i class="fa fa-check"></i><b>7.5.2</b> Exercise - Traveling salesman problem</a></li>
<li class="chapter" data-level="7.5.3" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#ex-vba-bakery"><i class="fa fa-check"></i><b>7.5.3</b> Exercise - Dan’s bakery</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mod-vba-useful-procedures.html"><a href="mod-vba-useful-procedures.html"><i class="fa fa-check"></i><b>8</b> Useful VBA procedures</a></li>
<li class="chapter" data-level="9" data-path="mod-vba-other-topics.html"><a href="mod-vba-other-topics.html"><i class="fa fa-check"></i><b>9</b> Other topics</a></li>
<li class="part"><span><b>IV VBA project</b></span></li>
<li class="chapter" data-level="10" data-path="vba-project.html"><a href="vba-project.html"><i class="fa fa-check"></i><b>10</b> VBA project</a><ul>
<li class="chapter" data-level="10.1" data-path="vba-project.html"><a href="vba-project.html#lo-vba-project"><i class="fa fa-check"></i><b>10.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="10.2" data-path="vba-project.html"><a href="vba-project.html#vba-project-1"><i class="fa fa-check"></i><b>10.2</b> VBA project</a></li>
</ul></li>
<li class="part"><span><b>V Getting started with R</b></span></li>
<li class="chapter" data-level="11" data-path="mod-r-install.html"><a href="mod-r-install.html"><i class="fa fa-check"></i><b>11</b> Setting up R</a><ul>
<li class="chapter" data-level="11.1" data-path="mod-r-install.html"><a href="mod-r-install.html#lo-r-install"><i class="fa fa-check"></i><b>11.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="11.2" data-path="mod-r-install.html"><a href="mod-r-install.html#r-install"><i class="fa fa-check"></i><b>11.2</b> Install R and RStudio</a><ul>
<li class="chapter" data-level="11.2.1" data-path="mod-r-install.html"><a href="mod-r-install.html#test-your-installation"><i class="fa fa-check"></i><b>11.2.1</b> Test your installation</a></li>
<li class="chapter" data-level="11.2.2" data-path="mod-r-install.html"><a href="mod-r-install.html#add-on-packages"><i class="fa fa-check"></i><b>11.2.2</b> Add-on packages</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="mod-r-install.html"><a href="mod-r-install.html#r-cloud"><i class="fa fa-check"></i><b>11.3</b> Setup and test RStudio Cloud</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html"><i class="fa fa-check"></i><b>12</b> R basics and workflows</a><ul>
<li class="chapter" data-level="12.1" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#lo-r-workflow"><i class="fa fa-check"></i><b>12.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="12.2" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#working-with-r-at-the-command-line-in-rstudio"><i class="fa fa-check"></i><b>12.2</b> Working with R at the command line in RStudio</a></li>
<li class="chapter" data-level="12.3" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#your-first-datacamp-course"><i class="fa fa-check"></i><b>12.3</b> Your first DataCamp course</a></li>
<li class="chapter" data-level="12.4" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#pipes"><i class="fa fa-check"></i><b>12.4</b> Pipes</a></li>
<li class="chapter" data-level="12.5" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#rprojs"><i class="fa fa-check"></i><b>12.5</b> RStudio projects</a><ul>
<li class="chapter" data-level="12.5.1" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#storing-your-code-in-a-script-file"><i class="fa fa-check"></i><b>12.5.1</b> Storing your code in a script file</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#rc-r-workflow"><i class="fa fa-check"></i><b>12.6</b> Recap</a></li>
<li class="chapter" data-level="12.7" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#ex-r-workflow"><i class="fa fa-check"></i><b>12.7</b> Exercises</a><ul>
<li class="chapter" data-level="12.7.1" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#exercise-group-work"><i class="fa fa-check"></i><b>12.7.1</b> Exercise (group work)</a></li>
<li class="chapter" data-level="12.7.2" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#exercise-piping"><i class="fa fa-check"></i><b>12.7.2</b> Exercise (piping)</a></li>
<li class="chapter" data-level="12.7.3" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#exercise-working-dir"><i class="fa fa-check"></i><b>12.7.3</b> Exercise (working dir)</a></li>
<li class="chapter" data-level="12.7.4" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#exercise-vectors"><i class="fa fa-check"></i><b>12.7.4</b> Exercise (vectors)</a></li>
<li class="chapter" data-level="12.7.5" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#exercise-matrices"><i class="fa fa-check"></i><b>12.7.5</b> Exercise (matrices)</a></li>
<li class="chapter" data-level="12.7.6" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#exercise-data-frames"><i class="fa fa-check"></i><b>12.7.6</b> Exercise (data frames)</a></li>
<li class="chapter" data-level="12.7.7" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#exercise-lists"><i class="fa fa-check"></i><b>12.7.7</b> Exercise (lists)</a></li>
<li class="chapter" data-level="12.7.8" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#ex-strings"><i class="fa fa-check"></i><b>12.7.8</b> Exercise (string management)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VI Programming in R</b></span></li>
<li class="chapter" data-level="13" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html"><i class="fa fa-check"></i><b>13</b> Loops and conditionals</a><ul>
<li class="chapter" data-level="13.1" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html#lo-loops"><i class="fa fa-check"></i><b>13.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="13.2" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html#r-dc-loops-cond"><i class="fa fa-check"></i><b>13.2</b> Conditionals and control flow</a></li>
<li class="chapter" data-level="13.3" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html#r-loops"><i class="fa fa-check"></i><b>13.3</b> Loops</a></li>
<li class="chapter" data-level="13.4" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html#rc-r-loops-cond"><i class="fa fa-check"></i><b>13.4</b> Recap</a></li>
<li class="chapter" data-level="13.5" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html#ex-r-loops-cond"><i class="fa fa-check"></i><b>13.5</b> Exercises</a><ul>
<li class="chapter" data-level="13.5.1" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html#exercise-conditional-expressions"><i class="fa fa-check"></i><b>13.5.1</b> Exercise (conditional expressions)</a></li>
<li class="chapter" data-level="13.5.2" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html#exercise-loops"><i class="fa fa-check"></i><b>13.5.2</b> Exercise (loops)</a></li>
<li class="chapter" data-level="13.5.3" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html#ex-dist"><i class="fa fa-check"></i><b>13.5.3</b> Exercise (calculating distances)</a></li>
<li class="chapter" data-level="13.5.4" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html#exercise-expand_grid"><i class="fa fa-check"></i><b>13.5.4</b> Exercise (<code>expand_grid</code>)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="mod-r-functions.html"><a href="mod-r-functions.html"><i class="fa fa-check"></i><b>14</b> Functions</a><ul>
<li class="chapter" data-level="14.1" data-path="mod-r-functions.html"><a href="mod-r-functions.html#lo-r-functions"><i class="fa fa-check"></i><b>14.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="14.2" data-path="mod-r-functions.html"><a href="mod-r-functions.html#r-dc-functions"><i class="fa fa-check"></i><b>14.2</b> DataCamp course</a></li>
<li class="chapter" data-level="14.3" data-path="mod-r-functions.html"><a href="mod-r-functions.html#r-functions-extra"><i class="fa fa-check"></i><b>14.3</b> Functions returning multiple objects</a></li>
<li class="chapter" data-level="14.4" data-path="mod-r-functions.html"><a href="mod-r-functions.html#r-functions-arg"><i class="fa fa-check"></i><b>14.4</b> The <code>...</code> argument</a></li>
<li class="chapter" data-level="14.5" data-path="mod-r-functions.html"><a href="mod-r-functions.html#r-functions-doc"><i class="fa fa-check"></i><b>14.5</b> Documenting your functions</a></li>
<li class="chapter" data-level="14.6" data-path="mod-r-functions.html"><a href="mod-r-functions.html#rc-functions"><i class="fa fa-check"></i><b>14.6</b> Recap</a></li>
<li class="chapter" data-level="14.7" data-path="mod-r-functions.html"><a href="mod-r-functions.html#ex-r-functions"><i class="fa fa-check"></i><b>14.7</b> Exercises</a><ul>
<li class="chapter" data-level="14.7.1" data-path="mod-r-functions.html"><a href="mod-r-functions.html#exercise-defining-functions"><i class="fa fa-check"></i><b>14.7.1</b> Exercise (defining functions)</a></li>
<li class="chapter" data-level="14.7.2" data-path="mod-r-functions.html"><a href="mod-r-functions.html#exercise-scope"><i class="fa fa-check"></i><b>14.7.2</b> Exercise (scope)</a></li>
<li class="chapter" data-level="14.7.3" data-path="mod-r-functions.html"><a href="mod-r-functions.html#exercise-job-sequencing"><i class="fa fa-check"></i><b>14.7.3</b> Exercise (job sequencing)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VII IO, tidy and transform</b></span></li>
<li class="chapter" data-level="15" data-path="mod-r-tidyverse-intro.html"><a href="mod-r-tidyverse-intro.html"><i class="fa fa-check"></i><b>15</b> Introduction to tidyverse and RMarkdown</a><ul>
<li class="chapter" data-level="15.1" data-path="mod-r-tidyverse-intro.html"><a href="mod-r-tidyverse-intro.html#lo-tidyverse-intro"><i class="fa fa-check"></i><b>15.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="15.2" data-path="mod-r-tidyverse-intro.html"><a href="mod-r-tidyverse-intro.html#r-tidyverse-intro"><i class="fa fa-check"></i><b>15.2</b> The tidyverse package</a></li>
<li class="chapter" data-level="15.3" data-path="mod-r-tidyverse-intro.html"><a href="mod-r-tidyverse-intro.html#r-markdown-intro"><i class="fa fa-check"></i><b>15.3</b> Writing reproducible reports</a></li>
<li class="chapter" data-level="15.4" data-path="mod-r-tidyverse-intro.html"><a href="mod-r-tidyverse-intro.html#r-tibbles-intro"><i class="fa fa-check"></i><b>15.4</b> Tibbles</a></li>
<li class="chapter" data-level="15.5" data-path="mod-r-tidyverse-intro.html"><a href="mod-r-tidyverse-intro.html#rc-tidyverse-intro"><i class="fa fa-check"></i><b>15.5</b> Recap</a></li>
<li class="chapter" data-level="15.6" data-path="mod-r-tidyverse-intro.html"><a href="mod-r-tidyverse-intro.html#ex-tidyverse-intro"><i class="fa fa-check"></i><b>15.6</b> Exercises</a><ul>
<li class="chapter" data-level="15.6.1" data-path="mod-r-tidyverse-intro.html"><a href="mod-r-tidyverse-intro.html#exercise-your-first-rmarkdown-exercise"><i class="fa fa-check"></i><b>15.6.1</b> Exercise (your first RMarkdown exercise)</a></li>
<li class="chapter" data-level="15.6.2" data-path="mod-r-tidyverse-intro.html"><a href="mod-r-tidyverse-intro.html#exercise-tibbles"><i class="fa fa-check"></i><b>15.6.2</b> Exercise (tibbles)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="mod-r-io.html"><a href="mod-r-io.html"><i class="fa fa-check"></i><b>16</b> Importing and exporting data</a><ul>
<li class="chapter" data-level="16.1" data-path="mod-r-io.html"><a href="mod-r-io.html#lo-r-io"><i class="fa fa-check"></i><b>16.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="16.2" data-path="mod-r-io.html"><a href="mod-r-io.html#r-io-csv"><i class="fa fa-check"></i><b>16.2</b> CSV files</a><ul>
<li class="chapter" data-level="16.2.1" data-path="mod-r-io.html"><a href="mod-r-io.html#reading-a-csv-file"><i class="fa fa-check"></i><b>16.2.1</b> Reading a CSV file</a></li>
<li class="chapter" data-level="16.2.2" data-path="mod-r-io.html"><a href="mod-r-io.html#writing-to-csv-files"><i class="fa fa-check"></i><b>16.2.2</b> Writing to CSV files</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="mod-r-io.html"><a href="mod-r-io.html#r-io-excel"><i class="fa fa-check"></i><b>16.3</b> Excel</a></li>
<li class="chapter" data-level="16.4" data-path="mod-r-io.html"><a href="mod-r-io.html#r-io-google"><i class="fa fa-check"></i><b>16.4</b> Google Sheets</a></li>
<li class="chapter" data-level="16.5" data-path="mod-r-io.html"><a href="mod-r-io.html#r-io-text"><i class="fa fa-check"></i><b>16.5</b> Text files</a></li>
<li class="chapter" data-level="16.6" data-path="mod-r-io.html"><a href="mod-r-io.html#r-io-r"><i class="fa fa-check"></i><b>16.6</b> R’s native binary format</a></li>
<li class="chapter" data-level="16.7" data-path="mod-r-io.html"><a href="mod-r-io.html#r-io-json"><i class="fa fa-check"></i><b>16.7</b> Json</a></li>
<li class="chapter" data-level="16.8" data-path="mod-r-io.html"><a href="mod-r-io.html#rc-r-io"><i class="fa fa-check"></i><b>16.8</b> Recap</a></li>
<li class="chapter" data-level="16.9" data-path="mod-r-io.html"><a href="mod-r-io.html#ex-r-io"><i class="fa fa-check"></i><b>16.9</b> Exercises</a><ul>
<li class="chapter" data-level="16.9.1" data-path="mod-r-io.html"><a href="mod-r-io.html#exercise-statistikbanken"><i class="fa fa-check"></i><b>16.9.1</b> Exercise (Statistikbanken)</a></li>
<li class="chapter" data-level="16.9.2" data-path="mod-r-io.html"><a href="mod-r-io.html#exercise-tuples-in-opl"><i class="fa fa-check"></i><b>16.9.2</b> Exercise (tuples in OPL)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="mod-r-transform.html"><a href="mod-r-transform.html"><i class="fa fa-check"></i><b>17</b> Transforming data</a><ul>
<li class="chapter" data-level="17.1" data-path="mod-r-transform.html"><a href="mod-r-transform.html#lo-r-transform"><i class="fa fa-check"></i><b>17.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="17.2" data-path="mod-r-transform.html"><a href="mod-r-transform.html#r-transform-tidyverse"><i class="fa fa-check"></i><b>17.2</b> Working with data in the tidyverse</a></li>
<li class="chapter" data-level="17.3" data-path="mod-r-transform.html"><a href="mod-r-transform.html#r-transform-joins"><i class="fa fa-check"></i><b>17.3</b> Mutating joins</a></li>
<li class="chapter" data-level="17.4" data-path="mod-r-transform.html"><a href="mod-r-transform.html#rc-r-transform"><i class="fa fa-check"></i><b>17.4</b> Recap</a></li>
<li class="chapter" data-level="17.5" data-path="mod-r-transform.html"><a href="mod-r-transform.html#ex-r-transform"><i class="fa fa-check"></i><b>17.5</b> Exercises</a><ul>
<li class="chapter" data-level="17.5.1" data-path="mod-r-transform.html"><a href="mod-r-transform.html#ex-gapminder1"><i class="fa fa-check"></i><b>17.5.1</b> Exercise (gapminder)</a></li>
<li class="chapter" data-level="17.5.2" data-path="mod-r-transform.html"><a href="mod-r-transform.html#ex-babynames1"><i class="fa fa-check"></i><b>17.5.2</b> Exercise (babynames)</a></li>
<li class="chapter" data-level="17.5.3" data-path="mod-r-transform.html"><a href="mod-r-transform.html#ex-profit1"><i class="fa fa-check"></i><b>17.5.3</b> Exercise (profit)</a></li>
<li class="chapter" data-level="17.5.4" data-path="mod-r-transform.html"><a href="mod-r-transform.html#ex-fish"><i class="fa fa-check"></i><b>17.5.4</b> Exercise (fisheries)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VIII Visualization</b></span></li>
<li class="chapter" data-level="18" data-path="mod-r-plot.html"><a href="mod-r-plot.html"><i class="fa fa-check"></i><b>18</b> Data visualization using ggplot</a><ul>
<li class="chapter" data-level="18.1" data-path="mod-r-plot.html"><a href="mod-r-plot.html#lo-plot"><i class="fa fa-check"></i><b>18.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="18.2" data-path="mod-r-plot.html"><a href="mod-r-plot.html#r-plot-intro"><i class="fa fa-check"></i><b>18.2</b> Introduction to data visualization</a></li>
<li class="chapter" data-level="18.3" data-path="mod-r-plot.html"><a href="mod-r-plot.html#r-plot-multi"><i class="fa fa-check"></i><b>18.3</b> Combining plots into one using <em>patchwork</em></a></li>
<li class="chapter" data-level="18.4" data-path="mod-r-plot.html"><a href="mod-r-plot.html#r-plot-save"><i class="fa fa-check"></i><b>18.4</b> Saving graphics</a></li>
<li class="chapter" data-level="18.5" data-path="mod-r-plot.html"><a href="mod-r-plot.html#rc-r-plot"><i class="fa fa-check"></i><b>18.5</b> Recap</a></li>
<li class="chapter" data-level="18.6" data-path="mod-r-plot.html"><a href="mod-r-plot.html#ex-r-plot"><i class="fa fa-check"></i><b>18.6</b> Exercises</a><ul>
<li class="chapter" data-level="18.6.1" data-path="mod-r-plot.html"><a href="mod-r-plot.html#ex-gapminder2"><i class="fa fa-check"></i><b>18.6.1</b> Exercise (gapminder)</a></li>
<li class="chapter" data-level="18.6.2" data-path="mod-r-plot.html"><a href="mod-r-plot.html#ex-profit2"><i class="fa fa-check"></i><b>18.6.2</b> Exercise (profit)</a></li>
<li class="chapter" data-level="18.6.3" data-path="mod-r-plot.html"><a href="mod-r-plot.html#ex-covid19"><i class="fa fa-check"></i><b>18.6.3</b> Exercise (COVID-19)</a></li>
<li class="chapter" data-level="18.6.4" data-path="mod-r-plot.html"><a href="mod-r-plot.html#ex-lego"><i class="fa fa-check"></i><b>18.6.4</b> Exercise (Lego and sales)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IX Extra</b></span></li>
<li class="chapter" data-level="19" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html"><i class="fa fa-check"></i><b>19</b> Fitting probability distributions</a><ul>
<li class="chapter" data-level="19.1" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#lo-r-dist-fit"><i class="fa fa-check"></i><b>19.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="19.2" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#sec-r-dist-fit-intro"><i class="fa fa-check"></i><b>19.2</b> Introduction</a></li>
<li class="chapter" data-level="19.3" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#sec-r-dist-fit-cont"><i class="fa fa-check"></i><b>19.3</b> Fitting distributions to continuous data</a><ul>
<li class="chapter" data-level="19.3.1" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#example-breakdown-times"><i class="fa fa-check"></i><b>19.3.1</b> Example: breakdown times</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#sec-r-dist-fit-discrete"><i class="fa fa-check"></i><b>19.4</b> Fitting distributions to discrete data</a><ul>
<li class="chapter" data-level="19.4.1" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#example-sales-of-lottery-tickets"><i class="fa fa-check"></i><b>19.4.1</b> Example: sales of lottery tickets</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#sec-dist-fit-pois"><i class="fa fa-check"></i><b>19.5</b> The Poisson process</a></li>
<li class="chapter" data-level="19.6" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#rc-r-dist-fit"><i class="fa fa-check"></i><b>19.6</b> Recap</a></li>
<li class="chapter" data-level="19.7" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#ex-r-dist-fit"><i class="fa fa-check"></i><b>19.7</b> Exercises</a><ul>
<li class="chapter" data-level="19.7.1" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#exercise---call-center"><i class="fa fa-check"></i><b>19.7.1</b> Exercise - Call center</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="mod-r-maps.html"><a href="mod-r-maps.html"><i class="fa fa-check"></i><b>20</b> Spatial data and maps</a><ul>
<li class="chapter" data-level="20.1" data-path="mod-r-maps.html"><a href="mod-r-maps.html#lo-maps"><i class="fa fa-check"></i><b>20.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="20.2" data-path="mod-r-maps.html"><a href="mod-r-maps.html#sec-map-api-key"><i class="fa fa-check"></i><b>20.2</b> Services for obtatining spatial data</a></li>
<li class="chapter" data-level="20.3" data-path="mod-r-maps.html"><a href="mod-r-maps.html#calculating-distances"><i class="fa fa-check"></i><b>20.3</b> Calculating distances</a><ul>
<li class="chapter" data-level="20.3.1" data-path="mod-r-maps.html"><a href="mod-r-maps.html#using-google-maps"><i class="fa fa-check"></i><b>20.3.1</b> Using Google Maps</a></li>
<li class="chapter" data-level="20.3.2" data-path="mod-r-maps.html"><a href="mod-r-maps.html#using-bing-maps"><i class="fa fa-check"></i><b>20.3.2</b> Using Bing Maps</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="mod-r-maps.html"><a href="mod-r-maps.html#geocoding-and-reverse-geocoding"><i class="fa fa-check"></i><b>20.4</b> Geocoding and reverse geocoding</a><ul>
<li class="chapter" data-level="20.4.1" data-path="mod-r-maps.html"><a href="mod-r-maps.html#using-google-maps-1"><i class="fa fa-check"></i><b>20.4.1</b> Using Google maps</a></li>
<li class="chapter" data-level="20.4.2" data-path="mod-r-maps.html"><a href="mod-r-maps.html#use-bing-maps"><i class="fa fa-check"></i><b>20.4.2</b> Use Bing Maps</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="mod-r-maps.html"><a href="mod-r-maps.html#adding-markers-and-routes-to-a-map"><i class="fa fa-check"></i><b>20.5</b> Adding markers and routes to a map</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="mod-r-excel.html"><a href="mod-r-excel.html"><i class="fa fa-check"></i><b>21</b> Using R in Excel and Excel in R</a></li>
<li class="chapter" data-level="22" data-path="mod-r-opl.html"><a href="mod-r-opl.html"><i class="fa fa-check"></i><b>22</b> Run an OPL model from R</a></li>
<li class="chapter" data-level="23" data-path="mod-r-simulation.html"><a href="mod-r-simulation.html"><i class="fa fa-check"></i><b>23</b> Simulation in R</a></li>
<li class="part"><span><b>X R project</b></span></li>
<li class="chapter" data-level="24" data-path="mod-r-project.html"><a href="mod-r-project.html"><i class="fa fa-check"></i><b>24</b> Mandatory R project</a><ul>
<li class="chapter" data-level="24.1" data-path="mod-r-project.html"><a href="mod-r-project.html#lo-project"><i class="fa fa-check"></i><b>24.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="24.2" data-path="mod-r-project.html"><a href="mod-r-project.html#r-project"><i class="fa fa-check"></i><b>24.2</b> R project</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="groups.html"><a href="groups.html"><i class="fa fa-check"></i><b>A</b> Working in groups</a><ul>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#joint-r-project-structure"><i class="fa fa-check"></i>Joint R project structure</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#using-git"><i class="fa fa-check"></i>Using Git together with GitHub</a><ul>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#register-a-free-github-account"><i class="fa fa-check"></i>Register a free GitHub account</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#install-git"><i class="fa fa-check"></i>Install Git</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#check-your-installation"><i class="fa fa-check"></i>Check your installation</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#setup-projects-using-git-and-github"><i class="fa fa-check"></i>Setup projects using Git and GitHub</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="annotate.html"><a href="annotate.html"><i class="fa fa-check"></i><b>B</b> Annotate the course notes</a></li>
<li class="chapter" data-level="C" data-path="help.html"><a href="help.html"><i class="fa fa-check"></i><b>C</b> Getting help</a></li>
<li class="chapter" data-level="D" data-path="coding-convention.html"><a href="coding-convention.html"><i class="fa fa-check"></i><b>D</b> Coding/naming convention</a><ul>
<li class="chapter" data-level="D.1" data-path="coding-convention.html"><a href="coding-convention.html#commenting-your-code"><i class="fa fa-check"></i><b>D.1</b> Commenting your code</a></li>
</ul></li>
<li class="chapter" data-level="E" data-path="lg-course.html"><a href="lg-course.html"><i class="fa fa-check"></i><b>E</b> Learning goals</a></li>
<li class="chapter" data-level="F" data-path="sec:ba.html"><a href="sec:ba.html"><i class="fa fa-check"></i><b>F</b> Business Analytics</a></li>
<li class="chapter" data-level="G" data-path="colophon.html"><a href="colophon.html"><i class="fa fa-check"></i><b>G</b> Colophon</a></li>
<li class="divider"></li>
<li><center>
  <a rel="license" href="./index.html#ack">
    License: CC BY-NC-SA<br>
    <i class = "fab fa-creative-commons fa-2x"></i>
    <i class = "fab fa-creative-commons-by fa-2x"></i>
    <i class = "fab fa-creative-commons-nc fa-2x"></i>
    <i class = "fab fa-creative-commons-sa fa-2x"></i>
  </a>
</li></center>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tools for Analytics (TFA)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mod-r-maps" class="section level1">
<h1><span class="header-section-number">Module 20</span> Spatial data and maps</h1>
<p>Spatial data, also known as geospatial data, is a term used to describe any data related to or containing information about a specific location on a surface (often a map). We will consider <em>distance matrix</em> calculations for finding the shortest distance/travel time between a set of origins and destinations, <em>geocoding</em> which is the process of converting an address to geographic coordinates (latitude, longitude) and <em>reverse geocoding</em> which is the opposite process of converting a location as described by geographic coordinates (latitude, longitude) to a human-readable address or place name. Finally, we consider how to display spatial data on a map.</p>
<div id="lo-maps" class="section level2">
<h2><span class="header-section-number">20.1</span> Learning outcomes</h2>
<p>By the end of this module, you are expected to be able to:</p>
<ul>
<li>Calculate euclidean, manhattan, etc. distances.</li>
<li>Calculate a distance matrix, i.e. shortest paths between places using the Google and Bing API.</li>
<li>Geocode an address using the Google and Bing API.</li>
<li>Add markers and routes (lines) on a map.</li>
</ul>
<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->
</div>
<div id="sec-map-api-key" class="section level2">
<h2><span class="header-section-number">20.2</span> Services for obtatining spatial data</h2>
<p>Often you need to connect to a service using an API for obtaining spatial data. The most common is Google and Bing (Microsoft) and to use the services you need an API key. Another service is also <a href="https://developer.here.com/">Here</a>.</p>
<p>If you use Google Maps you can obtain an API key <a href="https://cloud.google.com/maps-platform/">here</a>. Modest to light use is free; however, you need a valid credit card. Note you must enable the APIs you intend to use. Google in fact has several services for geo-related solutions. For example, the Maps Static API provides map images, while the Geocoding API provides geocoding and reverse geocoding services. You need to enable the APIs before you use them. You will only need to do that once, and then they will be ready for you to use. Enabling the APIs just means clicking a few radio buttons on the Google Maps Platform web interface.</p>
<p>We will be using the <strong>ggmap</strong> package for Google services. You can add the API key using:</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="mod-r-maps.html#cb528-1"></a><span class="kw">library</span>(ggmap)</span>
<span id="cb528-2"><a href="mod-r-maps.html#cb528-2"></a><span class="kw">register_google</span>(<span class="dt">key =</span> <span class="st">&quot;[your key]&quot;</span>, <span class="dt">write =</span> <span class="ot">TRUE</span>)</span>
<span id="cb528-3"><a href="mod-r-maps.html#cb528-3"></a><span class="kw">Sys.getenv</span>(<span class="st">&quot;GGMAP_GOOGLE_API_KEY&quot;</span>)</span></code></pre></div>
<p>Note the key is stored in the environment object <code>GGMAP_GOOGLE_API_KEY</code>. Moreover, it is saved in the file <code>.Renviron</code> so that it is automatically reloaded when you restart R.</p>
<p>If you use Bing Maps you can obtain an API key <a href="https://www.bingmapsportal.com/">here</a>. No credit card is needed. You can add the API key using:</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="mod-r-maps.html#cb529-1"></a>usethis<span class="op">::</span><span class="kw">edit_r_environ</span>()  <span class="co"># opens the .Renviron file</span></span>
<span id="cb529-2"><a href="mod-r-maps.html#cb529-2"></a><span class="kw">Sys.setenv</span>(<span class="dt">BING_MAPS_API_KEY=</span>[your key]) <span class="co"># so you don&#39;t have to restart R</span></span></code></pre></div>
<p>Add the line <code>BING_MAPS_API_KEY=[your key]</code> and save the file.</p>
<p>Note your API keys is private and unique to you, so be careful not to share it online!</p>
</div>
<div id="calculating-distances" class="section level2">
<h2><span class="header-section-number">20.3</span> Calculating distances</h2>
<p>If you need to calculate euclidean, manhattan, etc. distances, you can use the <code>dist</code> R function:</p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="mod-r-maps.html#cb530-1"></a>coord &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>, <span class="dv">0</span>,<span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>, <span class="dv">1</span>,<span class="dv">1</span>), <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</span>
<span id="cb530-2"><a href="mod-r-maps.html#cb530-2"></a>coord</span>
<span id="cb530-3"><a href="mod-r-maps.html#cb530-3"></a><span class="co">#&gt;      [,1] [,2]</span></span>
<span id="cb530-4"><a href="mod-r-maps.html#cb530-4"></a><span class="co">#&gt; [1,]    0    0</span></span>
<span id="cb530-5"><a href="mod-r-maps.html#cb530-5"></a><span class="co">#&gt; [2,]    0    1</span></span>
<span id="cb530-6"><a href="mod-r-maps.html#cb530-6"></a><span class="co">#&gt; [3,]    1    0</span></span>
<span id="cb530-7"><a href="mod-r-maps.html#cb530-7"></a><span class="co">#&gt; [4,]    1    1</span></span>
<span id="cb530-8"><a href="mod-r-maps.html#cb530-8"></a><span class="kw">dist</span>(coord)</span>
<span id="cb530-9"><a href="mod-r-maps.html#cb530-9"></a><span class="co">#&gt;      1    2    3</span></span>
<span id="cb530-10"><a href="mod-r-maps.html#cb530-10"></a><span class="co">#&gt; 2 1.00          </span></span>
<span id="cb530-11"><a href="mod-r-maps.html#cb530-11"></a><span class="co">#&gt; 3 1.00 1.41     </span></span>
<span id="cb530-12"><a href="mod-r-maps.html#cb530-12"></a><span class="co">#&gt; 4 1.41 1.00 1.00</span></span>
<span id="cb530-13"><a href="mod-r-maps.html#cb530-13"></a><span class="kw">as.matrix</span>(<span class="kw">dist</span>(coord))</span>
<span id="cb530-14"><a href="mod-r-maps.html#cb530-14"></a><span class="co">#&gt;      1    2    3    4</span></span>
<span id="cb530-15"><a href="mod-r-maps.html#cb530-15"></a><span class="co">#&gt; 1 0.00 1.00 1.00 1.41</span></span>
<span id="cb530-16"><a href="mod-r-maps.html#cb530-16"></a><span class="co">#&gt; 2 1.00 0.00 1.41 1.00</span></span>
<span id="cb530-17"><a href="mod-r-maps.html#cb530-17"></a><span class="co">#&gt; 3 1.00 1.41 0.00 1.00</span></span>
<span id="cb530-18"><a href="mod-r-maps.html#cb530-18"></a><span class="co">#&gt; 4 1.41 1.00 1.00 0.00</span></span></code></pre></div>
<p>However, euclidean distances are often a poor approximation of shortest path lengths.</p>
<div id="using-google-maps" class="section level3">
<h3><span class="header-section-number">20.3.1</span> Using Google Maps</h3>
<p>Remember to have <a href="mod-r-maps.html#sec-map-api-key">set your API key</a> and activate the <em>Distance Matrix API</em> service on the Google Cloud Platform. We consider the following places:</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="mod-r-maps.html#cb531-1"></a><span class="kw">library</span>(ggmap)</span>
<span id="cb531-2"><a href="mod-r-maps.html#cb531-2"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb531-3"><a href="mod-r-maps.html#cb531-3"></a>dat &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tribble</span>(</span>
<span id="cb531-4"><a href="mod-r-maps.html#cb531-4"></a>      <span class="op">~</span>Id,              <span class="op">~</span>Shop,                                        <span class="op">~</span>Address,</span>
<span id="cb531-5"><a href="mod-r-maps.html#cb531-5"></a>       1L,    <span class="st">&quot;Bilka Esbjerg&quot;</span>,          <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>,</span>
<span id="cb531-6"><a href="mod-r-maps.html#cb531-6"></a>       2L,    <span class="st">&quot;Bilka Herning&quot;</span>,              <span class="st">&quot;Golfvej 5, 7400 Herning, Denmark&quot;</span>,</span>
<span id="cb531-7"><a href="mod-r-maps.html#cb531-7"></a>       3L,   <span class="st">&quot;Bilka Hillerød&quot;</span>,     <span class="st">&quot;Slotsarkaderne 26, 3400 Hillerød, Denmark&quot;</span>,</span>
<span id="cb531-8"><a href="mod-r-maps.html#cb531-8"></a>       4L,   <span class="st">&quot;Bilka Hjørring&quot;</span>,  <span class="st">&quot;A.F Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>,</span>
<span id="cb531-9"><a href="mod-r-maps.html#cb531-9"></a>       5L,  <span class="st">&quot;Bilka Holstebro&quot;</span>,         <span class="st">&quot;Nyholmvej 20, 7500 Holstebro, Denmark&quot;</span>,</span>
<span id="cb531-10"><a href="mod-r-maps.html#cb531-10"></a>      )</span>
<span id="cb531-11"><a href="mod-r-maps.html#cb531-11"></a>dat</span>
<span id="cb531-12"><a href="mod-r-maps.html#cb531-12"></a><span class="co">#&gt; # A tibble: 5 × 3</span></span>
<span id="cb531-13"><a href="mod-r-maps.html#cb531-13"></a><span class="co">#&gt;      Id Shop            Address                                     </span></span>
<span id="cb531-14"><a href="mod-r-maps.html#cb531-14"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;                                       </span></span>
<span id="cb531-15"><a href="mod-r-maps.html#cb531-15"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark        </span></span>
<span id="cb531-16"><a href="mod-r-maps.html#cb531-16"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark            </span></span>
<span id="cb531-17"><a href="mod-r-maps.html#cb531-17"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark   </span></span>
<span id="cb531-18"><a href="mod-r-maps.html#cb531-18"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark</span></span>
<span id="cb531-19"><a href="mod-r-maps.html#cb531-19"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark</span></span></code></pre></div>
<p>To calculate a distance matrix we use the <code>mapdist</code> function:</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="mod-r-maps.html#cb532-1"></a><span class="kw">mapdist</span>(<span class="dt">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb532-2"><a href="mod-r-maps.html#cb532-2"></a>        <span class="dt">to =</span> <span class="st">&quot;Golfvej 5, 7400 Herning, Denmark&quot;</span>)</span>
<span id="cb532-3"><a href="mod-r-maps.html#cb532-3"></a><span class="co">#&gt; # A tibble: 1 × 9</span></span>
<span id="cb532-4"><a href="mod-r-maps.html#cb532-4"></a><span class="co">#&gt;   from                                 to                  m    km miles seconds minutes hours mode </span></span>
<span id="cb532-5"><a href="mod-r-maps.html#cb532-5"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span id="cb532-6"><a href="mod-r-maps.html#cb532-6"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark Golfvej 5, 740… 85641  85.6  53.2    4443    74.0  1.23 driv…</span></span></code></pre></div>
<p>Note Google returns results for the fastest path between the two points. Let us try to define a function which calculate all the distances:</p>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="mod-r-maps.html#cb533-1"></a><span class="co">#&#39; Calculate the distance matrix in long format.</span></span>
<span id="cb533-2"><a href="mod-r-maps.html#cb533-2"></a><span class="co">#&#39;</span></span>
<span id="cb533-3"><a href="mod-r-maps.html#cb533-3"></a><span class="co">#&#39; @param address A vector of addresses.</span></span>
<span id="cb533-4"><a href="mod-r-maps.html#cb533-4"></a><span class="co">#&#39; @param mode Driving, bicycling, walking, or transit.</span></span>
<span id="cb533-5"><a href="mod-r-maps.html#cb533-5"></a><span class="co">#&#39; @param symmetric Use symmetric distances (half the number of queries).</span></span>
<span id="cb533-6"><a href="mod-r-maps.html#cb533-6"></a><span class="co">#&#39; @return A data frame with the results</span></span>
<span id="cb533-7"><a href="mod-r-maps.html#cb533-7"></a><span class="co">#&#39; @note The API returns results for the fastest route.  </span></span>
<span id="cb533-8"><a href="mod-r-maps.html#cb533-8"></a>goo_calc_distances &lt;-<span class="st"> </span><span class="cf">function</span>(address, <span class="dt">mode =</span> <span class="st">&quot;driving&quot;</span>, <span class="dt">symmetric =</span> <span class="ot">TRUE</span>) {</span>
<span id="cb533-9"><a href="mod-r-maps.html#cb533-9"></a>   datDist &lt;-<span class="st"> </span><span class="kw">expand_grid</span>(<span class="dt">id_from =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(address), <span class="dt">id_to =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(address))</span>
<span id="cb533-10"><a href="mod-r-maps.html#cb533-10"></a>   datDist &lt;-<span class="st"> </span>datDist <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(id_from <span class="op">!=</span><span class="st"> </span>id_to)</span>
<span id="cb533-11"><a href="mod-r-maps.html#cb533-11"></a>   <span class="cf">if</span> (symmetric) datDist &lt;-<span class="st"> </span>datDist <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(id_from <span class="op">&lt;</span><span class="st"> </span>id_to)</span>
<span id="cb533-12"><a href="mod-r-maps.html#cb533-12"></a>   datDist &lt;-<span class="st"> </span>datDist <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">from =</span> address[id_from], <span class="dt">to =</span> address[id_to])</span>
<span id="cb533-13"><a href="mod-r-maps.html#cb533-13"></a>   res &lt;-<span class="st"> </span><span class="kw">mapdist</span>(<span class="dt">from =</span> datDist <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(from), <span class="dt">to =</span> datDist <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(to), <span class="dt">mode =</span> mode)</span>
<span id="cb533-14"><a href="mod-r-maps.html#cb533-14"></a>   <span class="kw">return</span>(<span class="kw">left_join</span>(datDist, res, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;from&quot;</span>, <span class="st">&quot;to&quot;</span>)))</span>
<span id="cb533-15"><a href="mod-r-maps.html#cb533-15"></a>}</span>
<span id="cb533-16"><a href="mod-r-maps.html#cb533-16"></a>datDistGoo &lt;-<span class="st"> </span><span class="kw">goo_calc_distances</span>(dat<span class="op">$</span>Address)</span>
<span id="cb533-17"><a href="mod-r-maps.html#cb533-17"></a>datDistGoo</span>
<span id="cb533-18"><a href="mod-r-maps.html#cb533-18"></a><span class="co">#&gt; # A tibble: 10 × 11</span></span>
<span id="cb533-19"><a href="mod-r-maps.html#cb533-19"></a><span class="co">#&gt;    id_from id_to from               to                     m    km miles seconds minutes hours mode </span></span>
<span id="cb533-20"><a href="mod-r-maps.html#cb533-20"></a><span class="co">#&gt;      &lt;int&gt; &lt;int&gt; &lt;chr&gt;              &lt;chr&gt;              &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span id="cb533-21"><a href="mod-r-maps.html#cb533-21"></a><span class="co">#&gt;  1       1     2 Stormgade 157, 67… Golfvej 5, 7400 …  85641  85.6  53.2    4443    74.0 1.23  driv…</span></span>
<span id="cb533-22"><a href="mod-r-maps.html#cb533-22"></a><span class="co">#&gt;  2       1     3 Stormgade 157, 67… Slotsarkaderne 2… 321011 321.  199.    11706   195.  3.25  driv…</span></span>
<span id="cb533-23"><a href="mod-r-maps.html#cb533-23"></a><span class="co">#&gt;  3       1     4 Stormgade 157, 67… A.F Heidemannsve… 322068 322.  200.    11042   184.  3.07  driv…</span></span>
<span id="cb533-24"><a href="mod-r-maps.html#cb533-24"></a><span class="co">#&gt;  4       1     5 Stormgade 157, 67… Nyholmvej 20, 75… 102379 102.   63.6    5314    88.6 1.48  driv…</span></span>
<span id="cb533-25"><a href="mod-r-maps.html#cb533-25"></a><span class="co">#&gt;  5       2     3 Golfvej 5, 7400 H… Slotsarkaderne 2… 491564 492.  305.    17348   289.  4.82  driv…</span></span>
<span id="cb533-26"><a href="mod-r-maps.html#cb533-26"></a><span class="co">#&gt;  6       2     4 Golfvej 5, 7400 H… A.F Heidemannsve… 374853 375.  233.    13416   224.  3.73  driv…</span></span>
<span id="cb533-27"><a href="mod-r-maps.html#cb533-27"></a><span class="co">#&gt;  7       2     5 Golfvej 5, 7400 H… Nyholmvej 20, 75… 332579 333.  207.    11984   200.  3.33  driv…</span></span>
<span id="cb533-28"><a href="mod-r-maps.html#cb533-28"></a><span class="co">#&gt;  8       3     4 Slotsarkaderne 26… A.F Heidemannsve… 178200 178.  111.     7723   129.  2.15  driv…</span></span>
<span id="cb533-29"><a href="mod-r-maps.html#cb533-29"></a><span class="co">#&gt;  9       3     5 Slotsarkaderne 26… Nyholmvej 20, 75…  44030  44.0  27.4    1790    29.8 0.497 driv…</span></span>
<span id="cb533-30"><a href="mod-r-maps.html#cb533-30"></a><span class="co">#&gt; 10       4     5 A.F Heidemannsvej… Nyholmvej 20, 75… 181223 181.  113.     7669   128.  2.13  driv…</span></span></code></pre></div>
<p>Note that only the calculated distances are returned. If you want to have the whole distance matrix we define function:</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="mod-r-maps.html#cb534-1"></a><span class="co">#&#39; Convert the data frame returned from calling a `___calc_distances` function to a distance matrix.</span></span>
<span id="cb534-2"><a href="mod-r-maps.html#cb534-2"></a><span class="co">#&#39;</span></span>
<span id="cb534-3"><a href="mod-r-maps.html#cb534-3"></a><span class="co">#&#39; @param dat The data frame returned from calling `___calc_distances`.</span></span>
<span id="cb534-4"><a href="mod-r-maps.html#cb534-4"></a><span class="co">#&#39; @param value_col The column containing the distances.</span></span>
<span id="cb534-5"><a href="mod-r-maps.html#cb534-5"></a><span class="co">#&#39; @return The distance matrix</span></span>
<span id="cb534-6"><a href="mod-r-maps.html#cb534-6"></a>as_dist_matrix &lt;-<span class="st"> </span><span class="cf">function</span>(dat, value_col) {</span>
<span id="cb534-7"><a href="mod-r-maps.html#cb534-7"></a>   lgt &lt;-<span class="st"> </span><span class="kw">max</span>(dat<span class="op">$</span>id_from, dat<span class="op">$</span>id_to)</span>
<span id="cb534-8"><a href="mod-r-maps.html#cb534-8"></a>   distanceMat&lt;-<span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow=</span>lgt, <span class="dt">ncol =</span> lgt)</span>
<span id="cb534-9"><a href="mod-r-maps.html#cb534-9"></a>   <span class="kw">diag</span>(distanceMat) &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb534-10"><a href="mod-r-maps.html#cb534-10"></a>   <span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(dat), <span class="cf">function</span>(r) {</span>
<span id="cb534-11"><a href="mod-r-maps.html#cb534-11"></a>      distanceMat[dat<span class="op">$</span>id_from[r], dat<span class="op">$</span>id_to[r]] &lt;&lt;-<span class="st"> </span>dat[[value_col]][r]</span>
<span id="cb534-12"><a href="mod-r-maps.html#cb534-12"></a>   })</span>
<span id="cb534-13"><a href="mod-r-maps.html#cb534-13"></a>   idx &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">is.na</span>(distanceMat), <span class="dt">arr.ind =</span> <span class="ot">TRUE</span>)</span>
<span id="cb534-14"><a href="mod-r-maps.html#cb534-14"></a>   <span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(idx), <span class="cf">function</span>(r) {</span>
<span id="cb534-15"><a href="mod-r-maps.html#cb534-15"></a>      distanceMat[idx[r, <span class="st">&quot;row&quot;</span>], idx[r, <span class="st">&quot;col&quot;</span>]] &lt;&lt;-<span class="st"> </span>distanceMat[idx[r, <span class="st">&quot;col&quot;</span>], idx[r, <span class="st">&quot;row&quot;</span>]]</span>
<span id="cb534-16"><a href="mod-r-maps.html#cb534-16"></a>   })</span>
<span id="cb534-17"><a href="mod-r-maps.html#cb534-17"></a>   <span class="kw">return</span>(distanceMat)</span>
<span id="cb534-18"><a href="mod-r-maps.html#cb534-18"></a>}</span>
<span id="cb534-19"><a href="mod-r-maps.html#cb534-19"></a><span class="kw">as_dist_matrix</span>(datDistGoo, <span class="st">&quot;km&quot;</span>)  <span class="co"># distances in km</span></span>
<span id="cb534-20"><a href="mod-r-maps.html#cb534-20"></a><span class="co">#&gt;       [,1]  [,2] [,3] [,4] [,5]</span></span>
<span id="cb534-21"><a href="mod-r-maps.html#cb534-21"></a><span class="co">#&gt; [1,]   0.0  85.6  321  322  102</span></span>
<span id="cb534-22"><a href="mod-r-maps.html#cb534-22"></a><span class="co">#&gt; [2,]  85.6   0.0  492  375  333</span></span>
<span id="cb534-23"><a href="mod-r-maps.html#cb534-23"></a><span class="co">#&gt; [3,] 321.0 491.6    0  178   44</span></span>
<span id="cb534-24"><a href="mod-r-maps.html#cb534-24"></a><span class="co">#&gt; [4,] 322.1 374.9  178    0  181</span></span>
<span id="cb534-25"><a href="mod-r-maps.html#cb534-25"></a><span class="co">#&gt; [5,] 102.4 332.6   44  181    0</span></span>
<span id="cb534-26"><a href="mod-r-maps.html#cb534-26"></a><span class="kw">as_dist_matrix</span>(datDistGoo, <span class="st">&quot;seconds&quot;</span>)  <span class="co"># travel time in seconds </span></span>
<span id="cb534-27"><a href="mod-r-maps.html#cb534-27"></a><span class="co">#&gt;       [,1]  [,2]  [,3]  [,4]  [,5]</span></span>
<span id="cb534-28"><a href="mod-r-maps.html#cb534-28"></a><span class="co">#&gt; [1,]     0  4443 11706 11042  5314</span></span>
<span id="cb534-29"><a href="mod-r-maps.html#cb534-29"></a><span class="co">#&gt; [2,]  4443     0 17348 13416 11984</span></span>
<span id="cb534-30"><a href="mod-r-maps.html#cb534-30"></a><span class="co">#&gt; [3,] 11706 17348     0  7723  1790</span></span>
<span id="cb534-31"><a href="mod-r-maps.html#cb534-31"></a><span class="co">#&gt; [4,] 11042 13416  7723     0  7669</span></span>
<span id="cb534-32"><a href="mod-r-maps.html#cb534-32"></a><span class="co">#&gt; [5,]  5314 11984  1790  7669     0</span></span></code></pre></div>
</div>
<div id="using-bing-maps" class="section level3">
<h3><span class="header-section-number">20.3.2</span> Using Bing Maps</h3>
<p>Remember to have <a href="#mod-map-api-key">set your API key</a>. We first define a <code>bing_mapdist</code> function:</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="mod-r-maps.html#cb535-1"></a><span class="kw">library</span>(jsonlite)</span>
<span id="cb535-2"><a href="mod-r-maps.html#cb535-2"></a><span class="co">#&#39; Distance between two locations.</span></span>
<span id="cb535-3"><a href="mod-r-maps.html#cb535-3"></a><span class="co">#&#39;</span></span>
<span id="cb535-4"><a href="mod-r-maps.html#cb535-4"></a><span class="co">#&#39; @param from From address.</span></span>
<span id="cb535-5"><a href="mod-r-maps.html#cb535-5"></a><span class="co">#&#39; @param to To address.</span></span>
<span id="cb535-6"><a href="mod-r-maps.html#cb535-6"></a><span class="co">#&#39; @param mode Walking, driving or transit.</span></span>
<span id="cb535-7"><a href="mod-r-maps.html#cb535-7"></a><span class="co">#&#39; @param optimize Optimize either `distance` or `time`.</span></span>
<span id="cb535-8"><a href="mod-r-maps.html#cb535-8"></a><span class="co">#&#39; @return</span></span>
<span id="cb535-9"><a href="mod-r-maps.html#cb535-9"></a>bing_mapdist &lt;-<span class="st"> </span><span class="cf">function</span>(from, to, <span class="dt">mode =</span> <span class="st">&quot;driving&quot;</span>, <span class="dt">optimize =</span> <span class="st">&quot;time&quot;</span>) {</span>
<span id="cb535-10"><a href="mod-r-maps.html#cb535-10"></a>   <span class="cf">if</span> (<span class="kw">is.data.frame</span>(from)) {</span>
<span id="cb535-11"><a href="mod-r-maps.html#cb535-11"></a>     <span class="kw">stopifnot</span>(<span class="kw">all</span>(<span class="kw">c</span>(<span class="st">&quot;from&quot;</span>, <span class="st">&quot;to&quot;</span>) <span class="op">%in%</span><span class="st"> </span><span class="kw">names</span>(from)))</span>
<span id="cb535-12"><a href="mod-r-maps.html#cb535-12"></a>     from_to_df &lt;-<span class="st"> </span>from <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="st">&quot;from&quot;</span>, <span class="st">&quot;to&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()</span>
<span id="cb535-13"><a href="mod-r-maps.html#cb535-13"></a>   }</span>
<span id="cb535-14"><a href="mod-r-maps.html#cb535-14"></a>   <span class="cf">else</span> {</span>
<span id="cb535-15"><a href="mod-r-maps.html#cb535-15"></a>     from_to_df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">from =</span> from, <span class="dt">to =</span> to)</span>
<span id="cb535-16"><a href="mod-r-maps.html#cb535-16"></a>   }</span>
<span id="cb535-17"><a href="mod-r-maps.html#cb535-17"></a>   dat &lt;-<span class="st"> </span><span class="kw">map_dfr</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(from_to_df), <span class="cf">function</span>(r) {</span>
<span id="cb535-18"><a href="mod-r-maps.html#cb535-18"></a>      url &lt;-<span class="st"> </span></span>
<span id="cb535-19"><a href="mod-r-maps.html#cb535-19"></a><span class="st">         </span><span class="kw">str_c</span>(<span class="st">&quot;http://dev.virtualearth.net/REST/V1/Routes/&quot;</span>, mode, <span class="st">&quot;?wp.0=&quot;</span>, from_to_df<span class="op">$</span>from[r], <span class="st">&quot;&amp;wp.1=&quot;</span>, from_to_df<span class="op">$</span>to[r], </span>
<span id="cb535-20"><a href="mod-r-maps.html#cb535-20"></a>               <span class="st">&quot;&amp;optimize=&quot;</span>, optimize, <span class="st">&quot;&amp;ra=excludeItinerary&amp;rpo=None&amp;ig=false&amp;du=km&quot;</span>, </span>
<span id="cb535-21"><a href="mod-r-maps.html#cb535-21"></a>               <span class="st">&quot;&amp;avoid=minimizeTolls&amp;key=&quot;</span>, <span class="kw">Sys.getenv</span>(<span class="st">&quot;BING_MAPS_API_KEY&quot;</span>))</span>
<span id="cb535-22"><a href="mod-r-maps.html#cb535-22"></a>      url &lt;-<span class="st"> </span><span class="kw">URLencode</span>(url)</span>
<span id="cb535-23"><a href="mod-r-maps.html#cb535-23"></a>      lst &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(url)</span>
<span id="cb535-24"><a href="mod-r-maps.html#cb535-24"></a>      <span class="cf">if</span> (lst<span class="op">$</span>statusCode <span class="op">!=</span><span class="st"> </span><span class="dv">200</span>) <span class="kw">return</span>(<span class="kw">tibble</span>(<span class="dt">km =</span> <span class="ot">NA</span>, <span class="dt">seconds =</span> <span class="ot">NA</span>, <span class="dt">mode =</span> <span class="ot">NA</span>))</span>
<span id="cb535-25"><a href="mod-r-maps.html#cb535-25"></a>      df &lt;-<span class="st"> </span>lst<span class="op">$</span>resourceSets<span class="op">$</span>resources[[<span class="dv">1</span>]]</span>
<span id="cb535-26"><a href="mod-r-maps.html#cb535-26"></a>      <span class="kw">return</span>(<span class="kw">tibble</span>(<span class="dt">km =</span> df<span class="op">$</span>travelDistance, <span class="dt">seconds =</span> df<span class="op">$</span>travelDuration, <span class="dt">mode =</span> df<span class="op">$</span>travelMode))</span>
<span id="cb535-27"><a href="mod-r-maps.html#cb535-27"></a>   })</span>
<span id="cb535-28"><a href="mod-r-maps.html#cb535-28"></a>   <span class="kw">return</span>(<span class="kw">bind_cols</span>(from_to_df, dat))</span>
<span id="cb535-29"><a href="mod-r-maps.html#cb535-29"></a>}</span>
<span id="cb535-30"><a href="mod-r-maps.html#cb535-30"></a><span class="kw">bing_mapdist</span>(<span class="dt">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb535-31"><a href="mod-r-maps.html#cb535-31"></a>             <span class="dt">to =</span> <span class="st">&quot;A.F Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>)</span>
<span id="cb535-32"><a href="mod-r-maps.html#cb535-32"></a><span class="co">#&gt; # A tibble: 1 × 5</span></span>
<span id="cb535-33"><a href="mod-r-maps.html#cb535-33"></a><span class="co">#&gt;   from                                 to                                          km seconds mode  </span></span>
<span id="cb535-34"><a href="mod-r-maps.html#cb535-34"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;                                    &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt; </span></span>
<span id="cb535-35"><a href="mod-r-maps.html#cb535-35"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark A.F Heidemannsvej 20, 9800 Hjørring, De…  322.    9925 Drivi…</span></span>
<span id="cb535-36"><a href="mod-r-maps.html#cb535-36"></a><span class="kw">bing_mapdist</span>(<span class="dt">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb535-37"><a href="mod-r-maps.html#cb535-37"></a>             <span class="dt">to =</span> <span class="st">&quot;A.F Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>, </span>
<span id="cb535-38"><a href="mod-r-maps.html#cb535-38"></a>             <span class="dt">optimize =</span> <span class="st">&quot;distance&quot;</span>)</span>
<span id="cb535-39"><a href="mod-r-maps.html#cb535-39"></a><span class="co">#&gt; # A tibble: 1 × 5</span></span>
<span id="cb535-40"><a href="mod-r-maps.html#cb535-40"></a><span class="co">#&gt;   from                                 to                                          km seconds mode  </span></span>
<span id="cb535-41"><a href="mod-r-maps.html#cb535-41"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;                                    &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt; </span></span>
<span id="cb535-42"><a href="mod-r-maps.html#cb535-42"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark A.F Heidemannsvej 20, 9800 Hjørring, De…  257.   14073 Drivi…</span></span></code></pre></div>
<p>Note we here can get both the shortest and fastest path between two points. Next, we use the <code>bing_mapdist</code> function for calculating distances:</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="mod-r-maps.html#cb536-1"></a><span class="co">#&#39; Calculate the distance matrix in long format.</span></span>
<span id="cb536-2"><a href="mod-r-maps.html#cb536-2"></a><span class="co">#&#39;</span></span>
<span id="cb536-3"><a href="mod-r-maps.html#cb536-3"></a><span class="co">#&#39; @param address A vector of addresses.</span></span>
<span id="cb536-4"><a href="mod-r-maps.html#cb536-4"></a><span class="co">#&#39; @param symmetric Use symmetric distances (only half the number of queries).</span></span>
<span id="cb536-5"><a href="mod-r-maps.html#cb536-5"></a><span class="co">#&#39; @param ... Further parameters passed to `bing_mapdist`.</span></span>
<span id="cb536-6"><a href="mod-r-maps.html#cb536-6"></a><span class="co">#&#39; @return A data frame with the results</span></span>
<span id="cb536-7"><a href="mod-r-maps.html#cb536-7"></a><span class="co">#&#39; @note The API returns results for the fastest route.  </span></span>
<span id="cb536-8"><a href="mod-r-maps.html#cb536-8"></a>bing_calc_distances &lt;-<span class="st"> </span><span class="cf">function</span>(address, <span class="dt">symmetric =</span> <span class="ot">TRUE</span>, ...) {</span>
<span id="cb536-9"><a href="mod-r-maps.html#cb536-9"></a>   datDist &lt;-<span class="st"> </span><span class="kw">expand_grid</span>(<span class="dt">id_from =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(address), <span class="dt">id_to =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(address))</span>
<span id="cb536-10"><a href="mod-r-maps.html#cb536-10"></a>   datDist &lt;-<span class="st"> </span>datDist <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(id_from <span class="op">!=</span><span class="st"> </span>id_to)</span>
<span id="cb536-11"><a href="mod-r-maps.html#cb536-11"></a>   <span class="cf">if</span> (symmetric) datDist &lt;-<span class="st"> </span>datDist <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(id_from <span class="op">&lt;</span><span class="st"> </span>id_to)</span>
<span id="cb536-12"><a href="mod-r-maps.html#cb536-12"></a>   datDist &lt;-<span class="st"> </span>datDist <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">from =</span> address[id_from], <span class="dt">to =</span> address[id_to])</span>
<span id="cb536-13"><a href="mod-r-maps.html#cb536-13"></a>   res &lt;-<span class="st"> </span><span class="kw">bing_mapdist</span>(datDist <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(from, to), ...)</span>
<span id="cb536-14"><a href="mod-r-maps.html#cb536-14"></a>   <span class="kw">return</span>(<span class="kw">bind_cols</span>(datDist <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">select</span>(id_from, id_to), res))</span>
<span id="cb536-15"><a href="mod-r-maps.html#cb536-15"></a>}</span>
<span id="cb536-16"><a href="mod-r-maps.html#cb536-16"></a>datDistBing &lt;-<span class="st"> </span><span class="kw">bing_calc_distances</span>(dat<span class="op">$</span>Address)</span>
<span id="cb536-17"><a href="mod-r-maps.html#cb536-17"></a>datDistBing</span>
<span id="cb536-18"><a href="mod-r-maps.html#cb536-18"></a><span class="co">#&gt; # A tibble: 10 × 7</span></span>
<span id="cb536-19"><a href="mod-r-maps.html#cb536-19"></a><span class="co">#&gt;    id_from id_to from                                         to                    km seconds mode </span></span>
<span id="cb536-20"><a href="mod-r-maps.html#cb536-20"></a><span class="co">#&gt;      &lt;int&gt; &lt;int&gt; &lt;chr&gt;                                        &lt;chr&gt;              &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb536-21"><a href="mod-r-maps.html#cb536-21"></a><span class="co">#&gt;  1       1     2 Stormgade 157, 6715 Esbjerg, Denmark         Golfvej 5, 7400 H…  87.7    4594 Driv…</span></span>
<span id="cb536-22"><a href="mod-r-maps.html#cb536-22"></a><span class="co">#&gt;  2       1     3 Stormgade 157, 6715 Esbjerg, Denmark         Slotsarkaderne 26… 322.    10474 Driv…</span></span>
<span id="cb536-23"><a href="mod-r-maps.html#cb536-23"></a><span class="co">#&gt;  3       1     4 Stormgade 157, 6715 Esbjerg, Denmark         A.F Heidemannsvej… 322.     9925 Driv…</span></span>
<span id="cb536-24"><a href="mod-r-maps.html#cb536-24"></a><span class="co">#&gt;  4       1     5 Stormgade 157, 6715 Esbjerg, Denmark         Nyholmvej 20, 750… 123.     5780 Driv…</span></span>
<span id="cb536-25"><a href="mod-r-maps.html#cb536-25"></a><span class="co">#&gt;  5       2     3 Golfvej 5, 7400 Herning, Denmark             Slotsarkaderne 26… 334.    10691 Driv…</span></span>
<span id="cb536-26"><a href="mod-r-maps.html#cb536-26"></a><span class="co">#&gt;  6       2     4 Golfvej 5, 7400 Herning, Denmark             A.F Heidemannsvej… 187.     7919 Driv…</span></span>
<span id="cb536-27"><a href="mod-r-maps.html#cb536-27"></a><span class="co">#&gt;  7       2     5 Golfvej 5, 7400 Herning, Denmark             Nyholmvej 20, 750…  44.2    1738 Driv…</span></span>
<span id="cb536-28"><a href="mod-r-maps.html#cb536-28"></a><span class="co">#&gt;  8       3     4 Slotsarkaderne 26, 3400 Hillerød, Denmark    A.F Heidemannsvej… 397.    17176 Driv…</span></span>
<span id="cb536-29"><a href="mod-r-maps.html#cb536-29"></a><span class="co">#&gt;  9       3     5 Slotsarkaderne 26, 3400 Hillerød, Denmark    Nyholmvej 20, 750… 375.    12117 Driv…</span></span>
<span id="cb536-30"><a href="mod-r-maps.html#cb536-30"></a><span class="co">#&gt; 10       4     5 A.F Heidemannsvej 20, 9800 Hjørring, Denmark Nyholmvej 20, 750… 194.     8222 Driv…</span></span></code></pre></div>
<p>Note in general results from the API services are based on a set of assumptions and hence the results from different services may not be the same. You may use the different services to check if the distances are correct, by checking the results from different services:</p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="mod-r-maps.html#cb537-1"></a><span class="co"># Difference in minutes</span></span>
<span id="cb537-2"><a href="mod-r-maps.html#cb537-2"></a><span class="kw">abs</span>(<span class="kw">as_dist_matrix</span>(datDistGoo, <span class="st">&quot;seconds&quot;</span>) <span class="op">-</span><span class="st"> </span><span class="kw">as_dist_matrix</span>(datDistBing, <span class="st">&quot;seconds&quot;</span>))<span class="op">/</span><span class="dv">60</span></span>
<span id="cb537-3"><a href="mod-r-maps.html#cb537-3"></a><span class="co">#&gt;       [,1]   [,2]  [,3]   [,4]   [,5]</span></span>
<span id="cb537-4"><a href="mod-r-maps.html#cb537-4"></a><span class="co">#&gt; [1,]  0.00   2.52  20.5  18.62   7.77</span></span>
<span id="cb537-5"><a href="mod-r-maps.html#cb537-5"></a><span class="co">#&gt; [2,]  2.52   0.00 111.0  91.62 170.77</span></span>
<span id="cb537-6"><a href="mod-r-maps.html#cb537-6"></a><span class="co">#&gt; [3,] 20.53 110.95   0.0 157.55 172.12</span></span>
<span id="cb537-7"><a href="mod-r-maps.html#cb537-7"></a><span class="co">#&gt; [4,] 18.62  91.62 157.6   0.00   9.22</span></span>
<span id="cb537-8"><a href="mod-r-maps.html#cb537-8"></a><span class="co">#&gt; [5,]  7.77 170.77 172.1   9.22   0.00</span></span>
<span id="cb537-9"><a href="mod-r-maps.html#cb537-9"></a><span class="co"># Km from 1 to 3</span></span>
<span id="cb537-10"><a href="mod-r-maps.html#cb537-10"></a><span class="kw">mapdist</span>(<span class="dt">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb537-11"><a href="mod-r-maps.html#cb537-11"></a>        <span class="dt">to =</span> <span class="st">&quot;Slotsarkaderne 26, 3400 Hillerød, Denmark&quot;</span>)</span>
<span id="cb537-12"><a href="mod-r-maps.html#cb537-12"></a><span class="co">#&gt; # A tibble: 1 × 9</span></span>
<span id="cb537-13"><a href="mod-r-maps.html#cb537-13"></a><span class="co">#&gt;   from                                 to                  m    km miles seconds minutes hours mode </span></span>
<span id="cb537-14"><a href="mod-r-maps.html#cb537-14"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span id="cb537-15"><a href="mod-r-maps.html#cb537-15"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark Slotsarkadern… 321011  321.  199.   11706    195.  3.25 driv…</span></span>
<span id="cb537-16"><a href="mod-r-maps.html#cb537-16"></a><span class="kw">bing_mapdist</span>(<span class="dt">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb537-17"><a href="mod-r-maps.html#cb537-17"></a>        <span class="dt">to =</span> <span class="st">&quot;Slotsarkaderne 26, 3400 Hillerød, Denmark&quot;</span>)</span>
<span id="cb537-18"><a href="mod-r-maps.html#cb537-18"></a><span class="co">#&gt; # A tibble: 1 × 5</span></span>
<span id="cb537-19"><a href="mod-r-maps.html#cb537-19"></a><span class="co">#&gt;   from                                 to                                           km seconds mode </span></span>
<span id="cb537-20"><a href="mod-r-maps.html#cb537-20"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;                                     &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb537-21"><a href="mod-r-maps.html#cb537-21"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark Slotsarkaderne 26, 3400 Hillerød, Denmark  322.   10474 Driv…</span></span></code></pre></div>
</div>
</div>
<div id="geocoding-and-reverse-geocoding" class="section level2">
<h2><span class="header-section-number">20.4</span> Geocoding and reverse geocoding</h2>
<div id="using-google-maps-1" class="section level3">
<h3><span class="header-section-number">20.4.1</span> Using Google maps</h3>
<p>Remember to enable the <em>Geocoding API</em>. To get the coordinates of an address we use the <code>geocode</code> function:</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="mod-r-maps.html#cb538-1"></a><span class="kw">geocode</span>(<span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>)</span>
<span id="cb538-2"><a href="mod-r-maps.html#cb538-2"></a><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span id="cb538-3"><a href="mod-r-maps.html#cb538-3"></a><span class="co">#&gt;     lon   lat</span></span>
<span id="cb538-4"><a href="mod-r-maps.html#cb538-4"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb538-5"><a href="mod-r-maps.html#cb538-5"></a><span class="co">#&gt; 1  8.46  55.5</span></span></code></pre></div>
<p>We may use <code>mutate_geocode</code> to add the coordinates to a dataset:</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="mod-r-maps.html#cb539-1"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb539-2"><a href="mod-r-maps.html#cb539-2"></a><span class="st">  </span><span class="kw">mutate_geocode</span>(Address)</span>
<span id="cb539-3"><a href="mod-r-maps.html#cb539-3"></a>dat</span>
<span id="cb539-4"><a href="mod-r-maps.html#cb539-4"></a><span class="co">#&gt; # A tibble: 5 × 5</span></span>
<span id="cb539-5"><a href="mod-r-maps.html#cb539-5"></a><span class="co">#&gt;      Id Shop            Address                                        lon   lat</span></span>
<span id="cb539-6"><a href="mod-r-maps.html#cb539-6"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;                                        &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb539-7"><a href="mod-r-maps.html#cb539-7"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark          8.46  55.5</span></span>
<span id="cb539-8"><a href="mod-r-maps.html#cb539-8"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark              9.00  56.1</span></span>
<span id="cb539-9"><a href="mod-r-maps.html#cb539-9"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark    12.3   55.9</span></span>
<span id="cb539-10"><a href="mod-r-maps.html#cb539-10"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark 10.0   57.4</span></span>
<span id="cb539-11"><a href="mod-r-maps.html#cb539-11"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark         8.62  56.4</span></span></code></pre></div>
<p>To reverse geocode use the <code>revgeocode</code> function:</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="mod-r-maps.html#cb540-1"></a><span class="kw">revgeocode</span>(<span class="kw">c</span>(dat<span class="op">$</span>lon[<span class="dv">1</span>], dat<span class="op">$</span>lat[<span class="dv">1</span>]))</span>
<span id="cb540-2"><a href="mod-r-maps.html#cb540-2"></a><span class="co">#&gt; [1] &quot;Stormgade 157, 6715 Esbjerg Kommune, Denmark&quot;</span></span></code></pre></div>
<p>To apply it to the dataset use:</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="mod-r-maps.html#cb541-1"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb541-2"><a href="mod-r-maps.html#cb541-2"></a><span class="st">   </span><span class="kw">mutate</span>(<span class="dt">AddressGeoGoo =</span> </span>
<span id="cb541-3"><a href="mod-r-maps.html#cb541-3"></a>             <span class="kw">map_chr</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">n</span>(), <span class="cf">function</span>(i) {</span>
<span id="cb541-4"><a href="mod-r-maps.html#cb541-4"></a>               <span class="kw">revgeocode</span>(<span class="kw">c</span>(<span class="dt">lon =</span> lon[i], <span class="dt">lat =</span> lat[i]))</span>
<span id="cb541-5"><a href="mod-r-maps.html#cb541-5"></a>             }))</span>
<span id="cb541-6"><a href="mod-r-maps.html#cb541-6"></a>dat</span>
<span id="cb541-7"><a href="mod-r-maps.html#cb541-7"></a><span class="co">#&gt; # A tibble: 5 × 6</span></span>
<span id="cb541-8"><a href="mod-r-maps.html#cb541-8"></a><span class="co">#&gt;      Id Shop            Address                                        lon   lat AddressGeoGoo      </span></span>
<span id="cb541-9"><a href="mod-r-maps.html#cb541-9"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;                                        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              </span></span>
<span id="cb541-10"><a href="mod-r-maps.html#cb541-10"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark          8.46  55.5 Stormgade 157, 671…</span></span>
<span id="cb541-11"><a href="mod-r-maps.html#cb541-11"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark              9.00  56.1 Golfvej 5, 7400 He…</span></span>
<span id="cb541-12"><a href="mod-r-maps.html#cb541-12"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark    12.3   55.9 Slotsarkaderne 26,…</span></span>
<span id="cb541-13"><a href="mod-r-maps.html#cb541-13"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark 10.0   57.4 A F Heidemanns Vej…</span></span>
<span id="cb541-14"><a href="mod-r-maps.html#cb541-14"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark         8.62  56.4 Nyholmvej 20, 7500…</span></span></code></pre></div>
</div>
<div id="use-bing-maps" class="section level3">
<h3><span class="header-section-number">20.4.2</span> Use Bing Maps</h3>
<p>To get the coordinates of an address we define the <code>bing_geocode</code> function:</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="mod-r-maps.html#cb542-1"></a><span class="co">#&#39; Geocode addresses</span></span>
<span id="cb542-2"><a href="mod-r-maps.html#cb542-2"></a><span class="co">#&#39;</span></span>
<span id="cb542-3"><a href="mod-r-maps.html#cb542-3"></a><span class="co">#&#39; @param address Address(es) to geocode.</span></span>
<span id="cb542-4"><a href="mod-r-maps.html#cb542-4"></a><span class="co">#&#39; @return The coordinates as a data frame.</span></span>
<span id="cb542-5"><a href="mod-r-maps.html#cb542-5"></a>bing_geocode &lt;-<span class="st"> </span><span class="cf">function</span>(address) {</span>
<span id="cb542-6"><a href="mod-r-maps.html#cb542-6"></a>   dat &lt;-<span class="st"> </span><span class="kw">map_dfr</span>(address, <span class="cf">function</span>(s) {</span>
<span id="cb542-7"><a href="mod-r-maps.html#cb542-7"></a>      url &lt;-<span class="st"> </span><span class="kw">str_c</span>(<span class="st">&quot;http://dev.virtualearth.net/REST/v1/Locations?q=&quot;</span>, </span>
<span id="cb542-8"><a href="mod-r-maps.html#cb542-8"></a>                   s, <span class="st">&quot;&amp;key=&quot;</span>, <span class="kw">Sys.getenv</span>(<span class="st">&quot;BING_MAPS_API_KEY&quot;</span>))</span>
<span id="cb542-9"><a href="mod-r-maps.html#cb542-9"></a>      url &lt;-<span class="st"> </span><span class="kw">URLencode</span>(url)</span>
<span id="cb542-10"><a href="mod-r-maps.html#cb542-10"></a>      lst &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(url)</span>
<span id="cb542-11"><a href="mod-r-maps.html#cb542-11"></a>      <span class="cf">if</span> (lst<span class="op">$</span>statusCode <span class="op">!=</span><span class="st"> </span><span class="dv">200</span>) <span class="kw">return</span>(<span class="kw">tibble</span>(<span class="dt">lon =</span> <span class="ot">NA</span>, <span class="dt">lat =</span> <span class="ot">NA</span>))</span>
<span id="cb542-12"><a href="mod-r-maps.html#cb542-12"></a>      v &lt;-<span class="st"> </span>lst<span class="op">$</span>resourceSets<span class="op">$</span>resources[[<span class="dv">1</span>]]<span class="op">$</span>point<span class="op">$</span>coordinates[[<span class="dv">1</span>]]</span>
<span id="cb542-13"><a href="mod-r-maps.html#cb542-13"></a>      <span class="cf">if</span> (<span class="kw">is.null</span>(v)) <span class="kw">return</span>(<span class="kw">tibble</span>(<span class="dt">lon =</span> <span class="ot">NA</span>, <span class="dt">lat =</span> <span class="ot">NA</span>))</span>
<span id="cb542-14"><a href="mod-r-maps.html#cb542-14"></a>      <span class="kw">return</span>(<span class="kw">tibble</span>(<span class="dt">lon =</span> v[<span class="dv">2</span>], <span class="dt">lat =</span> v[<span class="dv">1</span>]))</span>
<span id="cb542-15"><a href="mod-r-maps.html#cb542-15"></a>   })</span>
<span id="cb542-16"><a href="mod-r-maps.html#cb542-16"></a>   <span class="kw">return</span>(dat)</span>
<span id="cb542-17"><a href="mod-r-maps.html#cb542-17"></a>}</span>
<span id="cb542-18"><a href="mod-r-maps.html#cb542-18"></a><span class="kw">bing_geocode</span>(<span class="st">&quot;A.F. Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>)</span>
<span id="cb542-19"><a href="mod-r-maps.html#cb542-19"></a><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span id="cb542-20"><a href="mod-r-maps.html#cb542-20"></a><span class="co">#&gt;     lon   lat</span></span>
<span id="cb542-21"><a href="mod-r-maps.html#cb542-21"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb542-22"><a href="mod-r-maps.html#cb542-22"></a><span class="co">#&gt; 1  10.0  57.4</span></span>
<span id="cb542-23"><a href="mod-r-maps.html#cb542-23"></a><span class="kw">bing_geocode</span>(dat<span class="op">$</span>Address)</span>
<span id="cb542-24"><a href="mod-r-maps.html#cb542-24"></a><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span id="cb542-25"><a href="mod-r-maps.html#cb542-25"></a><span class="co">#&gt;     lon   lat</span></span>
<span id="cb542-26"><a href="mod-r-maps.html#cb542-26"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb542-27"><a href="mod-r-maps.html#cb542-27"></a><span class="co">#&gt; 1  8.46  55.5</span></span>
<span id="cb542-28"><a href="mod-r-maps.html#cb542-28"></a><span class="co">#&gt; 2  9.00  56.1</span></span>
<span id="cb542-29"><a href="mod-r-maps.html#cb542-29"></a><span class="co">#&gt; 3 12.3   55.9</span></span>
<span id="cb542-30"><a href="mod-r-maps.html#cb542-30"></a><span class="co">#&gt; 4 10.0   57.4</span></span>
<span id="cb542-31"><a href="mod-r-maps.html#cb542-31"></a><span class="co">#&gt; 5  8.62  56.4</span></span></code></pre></div>
<p>We may use <code>bing_mutate_geocode</code> to add the coordinates to a dataset:</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="mod-r-maps.html#cb543-1"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>lat, <span class="op">-</span>lon)</span>
<span id="cb543-2"><a href="mod-r-maps.html#cb543-2"></a>mutate_bing_geocode &lt;-<span class="st"> </span><span class="cf">function</span> (data, address, ...) {</span>
<span id="cb543-3"><a href="mod-r-maps.html#cb543-3"></a>    adr &lt;-<span class="st"> </span>data[[<span class="kw">deparse</span>(<span class="kw">substitute</span>(Address))]]</span>
<span id="cb543-4"><a href="mod-r-maps.html#cb543-4"></a>    gcdf &lt;-<span class="st"> </span><span class="kw">bing_geocode</span>(adr)</span>
<span id="cb543-5"><a href="mod-r-maps.html#cb543-5"></a>    <span class="kw">bind_cols</span>(data, gcdf)</span>
<span id="cb543-6"><a href="mod-r-maps.html#cb543-6"></a>}</span>
<span id="cb543-7"><a href="mod-r-maps.html#cb543-7"></a></span>
<span id="cb543-8"><a href="mod-r-maps.html#cb543-8"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb543-9"><a href="mod-r-maps.html#cb543-9"></a><span class="st">  </span><span class="kw">mutate_bing_geocode</span>(Address)</span>
<span id="cb543-10"><a href="mod-r-maps.html#cb543-10"></a>dat</span>
<span id="cb543-11"><a href="mod-r-maps.html#cb543-11"></a><span class="co">#&gt; # A tibble: 5 × 6</span></span>
<span id="cb543-12"><a href="mod-r-maps.html#cb543-12"></a><span class="co">#&gt;      Id Shop            Address                                      AddressGeoGoo         lon   lat</span></span>
<span id="cb543-13"><a href="mod-r-maps.html#cb543-13"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;                                        &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb543-14"><a href="mod-r-maps.html#cb543-14"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark         Stormgade 157, 671…  8.46  55.5</span></span>
<span id="cb543-15"><a href="mod-r-maps.html#cb543-15"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark             Golfvej 5, 7400 He…  9.00  56.1</span></span>
<span id="cb543-16"><a href="mod-r-maps.html#cb543-16"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark    Slotsarkaderne 26,… 12.3   55.9</span></span>
<span id="cb543-17"><a href="mod-r-maps.html#cb543-17"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark A F Heidemanns Vej… 10.0   57.4</span></span>
<span id="cb543-18"><a href="mod-r-maps.html#cb543-18"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark        Nyholmvej 20, 7500…  8.62  56.4</span></span></code></pre></div>
<p>To reverse geocode use the <code>bing_revgeocode</code> function:</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="mod-r-maps.html#cb544-1"></a><span class="co">#&#39; Reverse geocode coordinates</span></span>
<span id="cb544-2"><a href="mod-r-maps.html#cb544-2"></a><span class="co">#&#39;</span></span>
<span id="cb544-3"><a href="mod-r-maps.html#cb544-3"></a><span class="co">#&#39; @param coordinates A vector with two elements (lon, lat).</span></span>
<span id="cb544-4"><a href="mod-r-maps.html#cb544-4"></a><span class="co">#&#39; @return The address as a data frame.</span></span>
<span id="cb544-5"><a href="mod-r-maps.html#cb544-5"></a>bing_revgeocode &lt;-<span class="st"> </span><span class="cf">function</span>(coordinates) {</span>
<span id="cb544-6"><a href="mod-r-maps.html#cb544-6"></a>   url &lt;-<span class="st"> </span><span class="kw">str_c</span>(<span class="st">&quot;http://dev.virtualearth.net/REST/v1/Locations/&quot;</span>, </span>
<span id="cb544-7"><a href="mod-r-maps.html#cb544-7"></a>                coordinates[<span class="dv">2</span>], <span class="st">&quot;,&quot;</span>, coordinates[<span class="dv">1</span>],</span>
<span id="cb544-8"><a href="mod-r-maps.html#cb544-8"></a>                <span class="st">&quot;?key=&quot;</span>, <span class="kw">Sys.getenv</span>(<span class="st">&quot;BING_MAPS_API_KEY&quot;</span>))</span>
<span id="cb544-9"><a href="mod-r-maps.html#cb544-9"></a>   url &lt;-<span class="st"> </span><span class="kw">URLencode</span>(url)</span>
<span id="cb544-10"><a href="mod-r-maps.html#cb544-10"></a>   lst &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(url)</span>
<span id="cb544-11"><a href="mod-r-maps.html#cb544-11"></a>   <span class="cf">if</span> (lst<span class="op">$</span>statusCode <span class="op">!=</span><span class="st"> </span><span class="dv">200</span>) <span class="kw">return</span>(<span class="ot">NA</span>)</span>
<span id="cb544-12"><a href="mod-r-maps.html#cb544-12"></a>   v &lt;-<span class="st"> </span>lst<span class="op">$</span>resourceSets<span class="op">$</span>resources[[<span class="dv">1</span>]]<span class="op">$</span>address<span class="op">$</span>formattedAddress</span>
<span id="cb544-13"><a href="mod-r-maps.html#cb544-13"></a>   <span class="cf">if</span> (<span class="kw">is.null</span>(v)) <span class="kw">return</span>(<span class="ot">NA</span>)</span>
<span id="cb544-14"><a href="mod-r-maps.html#cb544-14"></a>   <span class="kw">return</span>(v)</span>
<span id="cb544-15"><a href="mod-r-maps.html#cb544-15"></a>}</span>
<span id="cb544-16"><a href="mod-r-maps.html#cb544-16"></a><span class="kw">bing_revgeocode</span>(<span class="kw">c</span>(dat<span class="op">$</span>lon[<span class="dv">1</span>], dat<span class="op">$</span>lat[<span class="dv">1</span>]))</span>
<span id="cb544-17"><a href="mod-r-maps.html#cb544-17"></a><span class="co">#&gt; [1] &quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span></span></code></pre></div>
<p>To apply it to the dataset use:</p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="mod-r-maps.html#cb545-1"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb545-2"><a href="mod-r-maps.html#cb545-2"></a><span class="st">   </span><span class="kw">mutate</span>(<span class="dt">AddressGeoBing =</span> </span>
<span id="cb545-3"><a href="mod-r-maps.html#cb545-3"></a>             <span class="kw">map_chr</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">n</span>(), <span class="cf">function</span>(i) {</span>
<span id="cb545-4"><a href="mod-r-maps.html#cb545-4"></a>               <span class="kw">bing_revgeocode</span>(<span class="kw">c</span>(<span class="dt">lon =</span> lon[i], <span class="dt">lat =</span> lat[i]))</span>
<span id="cb545-5"><a href="mod-r-maps.html#cb545-5"></a>             }))</span>
<span id="cb545-6"><a href="mod-r-maps.html#cb545-6"></a>dat </span>
<span id="cb545-7"><a href="mod-r-maps.html#cb545-7"></a><span class="co">#&gt; # A tibble: 5 × 7</span></span>
<span id="cb545-8"><a href="mod-r-maps.html#cb545-8"></a><span class="co">#&gt;      Id Shop            Address            AddressGeoGoo            lon   lat AddressGeoBing        </span></span>
<span id="cb545-9"><a href="mod-r-maps.html#cb545-9"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;              &lt;chr&gt;                  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                 </span></span>
<span id="cb545-10"><a href="mod-r-maps.html#cb545-10"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 67… Stormgade 157, 6715 E…  8.46  55.5 Stormgade 157, 6715 E…</span></span>
<span id="cb545-11"><a href="mod-r-maps.html#cb545-11"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 H… Golfvej 5, 7400 Herni…  9.00  56.1 Golfvej 5, 7400 Herni…</span></span>
<span id="cb545-12"><a href="mod-r-maps.html#cb545-12"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26… Slotsarkaderne 26, 34… 12.3   55.9 SLOTSARKADERNE 26, 34…</span></span>
<span id="cb545-13"><a href="mod-r-maps.html#cb545-13"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej… A F Heidemanns Vej 20… 10.0   57.4 A.F. Heidemanns Vej 2…</span></span>
<span id="cb545-14"><a href="mod-r-maps.html#cb545-14"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 750… Nyholmvej 20, 7500 Ho…  8.62  56.4 Nyholmvej 20, 7500 Ho…</span></span></code></pre></div>
</div>
</div>
<div id="adding-markers-and-routes-to-a-map" class="section level2">
<h2><span class="header-section-number">20.5</span> Adding markers and routes to a map</h2>
<p><a href="http://leafletjs.com">Leaflet</a> is an open-source JavaScript library for interactive maps. It’s used by websites ranging from The New York Times and The Washington Post to GitHub and Flickr, as well as GIS specialists like OpenStreetMap, Mapbox, and CartoDB. The <a href="https://rstudio.github.io/leaflet/">leaflet</a> package makes it easy to create Leaflet maps from R.</p>
<p>Note Leaflet is open-source and free so you do not need an API key for making maps. If you would like to use Google maps instead then have a look at the <a href="http://symbolixau.github.io/googleway/">googleway</a> package instead.</p>
<p>First let us create a map with two base layers</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="mod-r-maps.html#cb546-1"></a><span class="kw">library</span>(leaflet)</span>
<span id="cb546-2"><a href="mod-r-maps.html#cb546-2"></a>m &lt;-<span class="st"> </span><span class="kw">leaflet</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb546-3"><a href="mod-r-maps.html#cb546-3"></a><span class="st">   </span><span class="co"># Base maps</span></span>
<span id="cb546-4"><a href="mod-r-maps.html#cb546-4"></a><span class="st">   </span><span class="kw">addTiles</span>(<span class="dt">group =</span> <span class="st">&quot;Map&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb546-5"><a href="mod-r-maps.html#cb546-5"></a><span class="st">   </span><span class="kw">addProviderTiles</span>(<span class="st">&#39;Esri.WorldImagery&#39;</span>, <span class="dt">group =</span> <span class="st">&quot;Satelite&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb546-6"><a href="mod-r-maps.html#cb546-6"></a><span class="st">   </span><span class="kw">addProviderTiles</span>(<span class="st">&quot;CartoDB.PositronOnlyLabels&quot;</span>, <span class="dt">group =</span> <span class="st">&quot;Map&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb546-7"><a href="mod-r-maps.html#cb546-7"></a><span class="st">   </span><span class="co"># Center and zoom</span></span>
<span id="cb546-8"><a href="mod-r-maps.html#cb546-8"></a><span class="st">   </span><span class="kw">setView</span>(<span class="fl">10.2</span>, <span class="fl">56.2</span>,  <span class="dt">zoom =</span> <span class="dv">7</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb546-9"><a href="mod-r-maps.html#cb546-9"></a><span class="st">   </span><span class="co"># Layer control</span></span>
<span id="cb546-10"><a href="mod-r-maps.html#cb546-10"></a><span class="st">   </span><span class="kw">addLayersControl</span>(</span>
<span id="cb546-11"><a href="mod-r-maps.html#cb546-11"></a>    <span class="dt">baseGroups =</span> <span class="kw">c</span>(<span class="st">&quot;Map&quot;</span>, <span class="st">&quot;Satelite&quot;</span>),</span>
<span id="cb546-12"><a href="mod-r-maps.html#cb546-12"></a>    <span class="dt">options =</span> <span class="kw">layersControlOptions</span>(<span class="dt">collapsed =</span> <span class="ot">TRUE</span>)</span>
<span id="cb546-13"><a href="mod-r-maps.html#cb546-13"></a>   ) </span>
<span id="cb546-14"><a href="mod-r-maps.html#cb546-14"></a> m</span></code></pre></div>
<div id="htmlwidget-884c42d1dc8b55c6e346" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-884c42d1dc8b55c6e346">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]}],"setView":[[56.2,10.2],7,[]]},"evals":[],"jsHooks":[]}</script>
<p>Next, let us add the places:</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="mod-r-maps.html#cb547-1"></a>dat &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tribble</span>(</span>
<span id="cb547-2"><a href="mod-r-maps.html#cb547-2"></a>      <span class="op">~</span>Id,              <span class="op">~</span>Shop,                                        <span class="op">~</span>Address,</span>
<span id="cb547-3"><a href="mod-r-maps.html#cb547-3"></a>       1L,    <span class="st">&quot;Bilka Esbjerg&quot;</span>,          <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>,</span>
<span id="cb547-4"><a href="mod-r-maps.html#cb547-4"></a>       2L,    <span class="st">&quot;Bilka Herning&quot;</span>,              <span class="st">&quot;Golfvej 5, 7400 Herning, Denmark&quot;</span>,</span>
<span id="cb547-5"><a href="mod-r-maps.html#cb547-5"></a>       3L,   <span class="st">&quot;Bilka Hillerød&quot;</span>,     <span class="st">&quot;Slotsarkaderne 26, 3400 Hillerød, Denmark&quot;</span>,</span>
<span id="cb547-6"><a href="mod-r-maps.html#cb547-6"></a>       4L,   <span class="st">&quot;Bilka Hjørring&quot;</span>,  <span class="st">&quot;A.F Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>,</span>
<span id="cb547-7"><a href="mod-r-maps.html#cb547-7"></a>       5L,  <span class="st">&quot;Bilka Holstebro&quot;</span>,         <span class="st">&quot;Nyholmvej 20, 7500 Holstebro, Denmark&quot;</span>,</span>
<span id="cb547-8"><a href="mod-r-maps.html#cb547-8"></a>      )</span>
<span id="cb547-9"><a href="mod-r-maps.html#cb547-9"></a>dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_geocode</span>(Address)</span>
<span id="cb547-10"><a href="mod-r-maps.html#cb547-10"></a>m &lt;-<span class="st"> </span>m <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb547-11"><a href="mod-r-maps.html#cb547-11"></a><span class="st">   </span><span class="kw">addMarkers</span>(<span class="op">~</span>lon, <span class="op">~</span>lat, <span class="dt">popup =</span> <span class="op">~</span>Address, <span class="dt">label =</span> <span class="op">~</span><span class="kw">str_c</span>(Id, <span class="st">&quot;  - &quot;</span>, Shop), <span class="dt">data =</span> dat)</span>
<span id="cb547-12"><a href="mod-r-maps.html#cb547-12"></a>m</span></code></pre></div>
<div id="htmlwidget-eb3d397b0484fed2dc43" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-eb3d397b0484fed2dc43">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.297778,10.0034954,8.622241],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.297778]}},"evals":[],"jsHooks":[]}</script>
<p>To add a line between a set of points use the <code>addPolylines</code> function:</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="mod-r-maps.html#cb548-1"></a>routeIds &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb548-2"><a href="mod-r-maps.html#cb548-2"></a>route &lt;-<span class="st"> </span>dat[routeIds,] </span>
<span id="cb548-3"><a href="mod-r-maps.html#cb548-3"></a>m <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">addPolylines</span>(<span class="dt">lng =</span> <span class="op">~</span>lon, <span class="dt">lat =</span> <span class="op">~</span>lat, <span class="dt">data =</span> route, <span class="dt">weight =</span> <span class="dv">2</span>, <span class="dt">label =</span> <span class="st">&quot;Route 1&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-9bd259e3c2448b66c7c7" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-9bd259e3c2448b66c7c7">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.297778,10.0034954,8.622241],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,8.622241,8.4559613,9.0047956],"lat":[56.1357775,56.3779116,55.5107577,56.1357775]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":2,"opacity":0.5,"fill":false,"fillColor":"#03F","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Route 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.297778]}},"evals":[],"jsHooks":[]}</script>
<p>A more advanced setup is to use the <code>addFlows</code> function from the <a href="https://github.com/rte-antares-rpackage/leaflet.minicharts">leaflet.minicharts</a> package. First let us define some lines:</p>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb549-1"><a href="mod-r-maps.html#cb549-1"></a>datLines &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">FromId =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>), <span class="dt">ToId =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb549-2"><a href="mod-r-maps.html#cb549-2"></a>datLines &lt;-<span class="st"> </span><span class="kw">left_join</span>(datLines, dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>Shop, <span class="op">-</span>Address), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;FromId&quot;</span> =<span class="st"> &quot;Id&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb549-3"><a href="mod-r-maps.html#cb549-3"></a><span class="st">   </span><span class="kw">rename</span>(<span class="st">&quot;FromLat&quot;</span> =<span class="st"> &quot;lat&quot;</span>, <span class="st">&quot;FromLon&quot;</span> =<span class="st"> &quot;lon&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb549-4"><a href="mod-r-maps.html#cb549-4"></a><span class="st">   </span><span class="kw">left_join</span>(dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>Shop, <span class="op">-</span>Address), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;ToId&quot;</span> =<span class="st"> &quot;Id&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb549-5"><a href="mod-r-maps.html#cb549-5"></a><span class="st">   </span><span class="kw">rename</span>(<span class="st">&quot;ToLat&quot;</span> =<span class="st"> &quot;lat&quot;</span>, <span class="st">&quot;ToLon&quot;</span> =<span class="st"> &quot;lon&quot;</span>)</span>
<span id="cb549-6"><a href="mod-r-maps.html#cb549-6"></a>datLines</span>
<span id="cb549-7"><a href="mod-r-maps.html#cb549-7"></a><span class="co">#&gt; # A tibble: 6 × 6</span></span>
<span id="cb549-8"><a href="mod-r-maps.html#cb549-8"></a><span class="co">#&gt;   FromId  ToId FromLon FromLat ToLon ToLat</span></span>
<span id="cb549-9"><a href="mod-r-maps.html#cb549-9"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb549-10"><a href="mod-r-maps.html#cb549-10"></a><span class="co">#&gt; 1      2     5    9.00    56.1  8.62  56.4</span></span>
<span id="cb549-11"><a href="mod-r-maps.html#cb549-11"></a><span class="co">#&gt; 2      5     1    8.62    56.4  8.46  55.5</span></span>
<span id="cb549-12"><a href="mod-r-maps.html#cb549-12"></a><span class="co">#&gt; 3      1     2    8.46    55.5  9.00  56.1</span></span>
<span id="cb549-13"><a href="mod-r-maps.html#cb549-13"></a><span class="co">#&gt; 4      2     4    9.00    56.1 10.0   57.4</span></span>
<span id="cb549-14"><a href="mod-r-maps.html#cb549-14"></a><span class="co">#&gt; 5      4     3   10.0     57.4 12.3   55.9</span></span>
<span id="cb549-15"><a href="mod-r-maps.html#cb549-15"></a><span class="co">#&gt; 6      3     2   12.3     55.9  9.00  56.1</span></span></code></pre></div>
<p>Note we have a from/to pair in each row. We add the lines to the map:</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="mod-r-maps.html#cb550-1"></a><span class="kw">library</span>(leaflet.minicharts)</span>
<span id="cb550-2"><a href="mod-r-maps.html#cb550-2"></a>m <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">addFlows</span>(datLines<span class="op">$</span>FromLon, datLines<span class="op">$</span>FromLat, datLines<span class="op">$</span>ToLon, datLines<span class="op">$</span>ToLat,</span>
<span id="cb550-3"><a href="mod-r-maps.html#cb550-3"></a>               <span class="dt">flow =</span> <span class="dv">1</span>, <span class="dt">maxFlow =</span> <span class="dv">20</span>, <span class="dt">opacity =</span> <span class="fl">0.5</span>, <span class="dt">popup =</span> <span class="kw">popupArgs</span>(<span class="dt">noPopup =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<div id="htmlwidget-a964c70d9d99c66fe470" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-a964c70d9d99c66fe470">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.297778,10.0034954,8.622241],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addFlows","args":[[{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (10.0034954,57.4440055) -> (12.297778,55.9290561)","lat0":57.4440055,"lat1":55.9290561,"lng0":10.0034954,"lng1":12.297778},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (12.297778,55.9290561) -> (9.0047956,56.1357775)","lat0":55.9290561,"lat1":56.1357775,"lng0":12.297778,"lng1":9.0047956},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (8.4559613,55.5107577) -> (9.0047956,56.1357775)","lat0":55.5107577,"lat1":56.1357775,"lng0":8.4559613,"lng1":9.0047956},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (8.622241,56.3779116) -> (8.4559613,55.5107577)","lat0":56.3779116,"lat1":55.5107577,"lng0":8.622241,"lng1":8.4559613},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (10.0034954,57.4440055)","lat0":56.1357775,"lat1":57.4440055,"lng0":9.0047956,"lng1":10.0034954},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (8.622241,56.3779116)","lat0":56.1357775,"lat1":56.3779116,"lng0":9.0047956,"lng1":8.622241},"timeSteps":1}],["1"],null,{"showTitle":true,"showValues":true,"labels":[],"supValues":null,"supLabels":[],"html":null,"noPopup":true,"digits":null},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.297778]}},"evals":[],"jsHooks":[]}</script>
<p>Let us define a function for adding routes:</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="mod-r-maps.html#cb551-1"></a>add_route &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">dat =</span> <span class="ot">NULL</span>, route, <span class="dt">solution =</span> <span class="dv">1</span>) {</span>
<span id="cb551-2"><a href="mod-r-maps.html#cb551-2"></a>   route_id =<span class="st"> </span><span class="kw">if_else</span>(<span class="kw">is.null</span>(dat), <span class="dv">1</span>, <span class="kw">max</span>(dat<span class="op">$</span>RouteId) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb551-3"><a href="mod-r-maps.html#cb551-3"></a>   tmp &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">From =</span> route[<span class="dv">1</span><span class="op">:</span>(<span class="kw">length</span>(route)<span class="op">-</span><span class="dv">1</span>)], <span class="dt">To =</span> route[<span class="dv">2</span><span class="op">:</span><span class="kw">length</span>(route)])</span>
<span id="cb551-4"><a href="mod-r-maps.html#cb551-4"></a>   tmp &lt;-<span class="st"> </span>tmp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Sol =</span> solution, <span class="dt">RouteId =</span> route_id)</span>
<span id="cb551-5"><a href="mod-r-maps.html#cb551-5"></a>   dat &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(dat, tmp)</span>
<span id="cb551-6"><a href="mod-r-maps.html#cb551-6"></a>}</span>
<span id="cb551-7"><a href="mod-r-maps.html#cb551-7"></a></span>
<span id="cb551-8"><a href="mod-r-maps.html#cb551-8"></a>datLines &lt;-<span class="st"> </span><span class="kw">add_route</span>(<span class="dt">route =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb551-9"><a href="mod-r-maps.html#cb551-9"></a><span class="st">   </span><span class="kw">add_route</span>(<span class="dt">route =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb551-10"><a href="mod-r-maps.html#cb551-10"></a><span class="st">   </span><span class="kw">add_route</span>(<span class="dt">route =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">solution =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb551-11"><a href="mod-r-maps.html#cb551-11"></a><span class="st">   </span><span class="kw">add_route</span>(<span class="dt">route =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>), <span class="dt">solution =</span> <span class="dv">2</span>)</span>
<span id="cb551-12"><a href="mod-r-maps.html#cb551-12"></a>datLines &lt;-<span class="st"> </span><span class="kw">left_join</span>(datLines, dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>Shop, <span class="op">-</span>Address), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;From&quot;</span> =<span class="st"> &quot;Id&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb551-13"><a href="mod-r-maps.html#cb551-13"></a><span class="st">   </span><span class="kw">rename</span>(<span class="st">&quot;FromLat&quot;</span> =<span class="st"> &quot;lat&quot;</span>, <span class="st">&quot;FromLon&quot;</span> =<span class="st"> &quot;lon&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb551-14"><a href="mod-r-maps.html#cb551-14"></a><span class="st">   </span><span class="kw">left_join</span>(dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>Shop, <span class="op">-</span>Address), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;To&quot;</span> =<span class="st"> &quot;Id&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb551-15"><a href="mod-r-maps.html#cb551-15"></a><span class="st">   </span><span class="kw">rename</span>(<span class="st">&quot;ToLat&quot;</span> =<span class="st"> &quot;lat&quot;</span>, <span class="st">&quot;ToLon&quot;</span> =<span class="st"> &quot;lon&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb551-16"><a href="mod-r-maps.html#cb551-16"></a><span class="st">   </span><span class="kw">mutate</span>(<span class="dt">group =</span> <span class="kw">str_c</span>(<span class="st">&quot;Solution &quot;</span>, Sol))</span>
<span id="cb551-17"><a href="mod-r-maps.html#cb551-17"></a>datLines</span>
<span id="cb551-18"><a href="mod-r-maps.html#cb551-18"></a><span class="co">#&gt; # A tibble: 12 × 9</span></span>
<span id="cb551-19"><a href="mod-r-maps.html#cb551-19"></a><span class="co">#&gt;     From    To   Sol RouteId FromLon FromLat ToLon ToLat group     </span></span>
<span id="cb551-20"><a href="mod-r-maps.html#cb551-20"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     </span></span>
<span id="cb551-21"><a href="mod-r-maps.html#cb551-21"></a><span class="co">#&gt;  1     2     5     1       1    9.00    56.1  8.62  56.4 Solution 1</span></span>
<span id="cb551-22"><a href="mod-r-maps.html#cb551-22"></a><span class="co">#&gt;  2     5     1     1       1    8.62    56.4  8.46  55.5 Solution 1</span></span>
<span id="cb551-23"><a href="mod-r-maps.html#cb551-23"></a><span class="co">#&gt;  3     1     2     1       1    8.46    55.5  9.00  56.1 Solution 1</span></span>
<span id="cb551-24"><a href="mod-r-maps.html#cb551-24"></a><span class="co">#&gt;  4     2     4     1       2    9.00    56.1 10.0   57.4 Solution 1</span></span>
<span id="cb551-25"><a href="mod-r-maps.html#cb551-25"></a><span class="co">#&gt;  5     4     3     1       2   10.0     57.4 12.3   55.9 Solution 1</span></span>
<span id="cb551-26"><a href="mod-r-maps.html#cb551-26"></a><span class="co">#&gt;  6     3     2     1       2   12.3     55.9  9.00  56.1 Solution 1</span></span>
<span id="cb551-27"><a href="mod-r-maps.html#cb551-27"></a><span class="co">#&gt;  7     2     3     2       3    9.00    56.1 12.3   55.9 Solution 2</span></span>
<span id="cb551-28"><a href="mod-r-maps.html#cb551-28"></a><span class="co">#&gt;  8     3     1     2       3   12.3     55.9  8.46  55.5 Solution 2</span></span>
<span id="cb551-29"><a href="mod-r-maps.html#cb551-29"></a><span class="co">#&gt;  9     1     2     2       3    8.46    55.5  9.00  56.1 Solution 2</span></span>
<span id="cb551-30"><a href="mod-r-maps.html#cb551-30"></a><span class="co">#&gt; 10     2     5     2       4    9.00    56.1  8.62  56.4 Solution 2</span></span>
<span id="cb551-31"><a href="mod-r-maps.html#cb551-31"></a><span class="co">#&gt; 11     5     4     2       4    8.62    56.4 10.0   57.4 Solution 2</span></span>
<span id="cb551-32"><a href="mod-r-maps.html#cb551-32"></a><span class="co">#&gt; 12     4     2     2       4   10.0     57.4  9.00  56.1 Solution 2</span></span></code></pre></div>
<p>A map with Solution 1:</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="mod-r-maps.html#cb552-1"></a>col_pal &lt;-<span class="st"> </span><span class="kw">rainbow</span>(<span class="kw">max</span>(datLines<span class="op">$</span>RouteId))</span>
<span id="cb552-2"><a href="mod-r-maps.html#cb552-2"></a>datP &lt;-<span class="st"> </span>datLines <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Sol <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb552-3"><a href="mod-r-maps.html#cb552-3"></a>m <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">addFlows</span>(datP<span class="op">$</span>FromLon, datP<span class="op">$</span>FromLat, datP<span class="op">$</span>ToLon, datP<span class="op">$</span>ToLat,</span>
<span id="cb552-4"><a href="mod-r-maps.html#cb552-4"></a>               <span class="dt">flow =</span> datP<span class="op">$</span>RouteId, <span class="dt">maxThickness =</span> <span class="dv">2</span>, <span class="dt">color =</span> col_pal[datP<span class="op">$</span>RouteId],</span>
<span id="cb552-5"><a href="mod-r-maps.html#cb552-5"></a>               <span class="dt">opacity =</span> <span class="fl">0.5</span>, <span class="dt">popup =</span> <span class="kw">popupArgs</span>(<span class="dt">labels =</span> <span class="st">&quot;Route&quot;</span>))</span></code></pre></div>
<div id="htmlwidget-5e1a537ac47b4df34bd7" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-5e1a537ac47b4df34bd7">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.297778,10.0034954,8.622241],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addFlows","args":[[{"dyn":{"color":["#80FF00"],"value":[2]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (10.0034954,57.4440055) -> (12.297778,55.9290561)","lat0":57.4440055,"lat1":55.9290561,"lng0":10.0034954,"lng1":12.297778},"timeSteps":1},{"dyn":{"color":["#80FF00"],"value":[2]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (12.297778,55.9290561) -> (9.0047956,56.1357775)","lat0":55.9290561,"lat1":56.1357775,"lng0":12.297778,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#FF0000"],"value":[1]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.4559613,55.5107577) -> (9.0047956,56.1357775)","lat0":55.5107577,"lat1":56.1357775,"lng0":8.4559613,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#FF0000"],"value":[1]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.622241,56.3779116) -> (8.4559613,55.5107577)","lat0":56.3779116,"lat1":55.5107577,"lng0":8.622241,"lng1":8.4559613},"timeSteps":1},{"dyn":{"color":["#80FF00"],"value":[2]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (10.0034954,57.4440055)","lat0":56.1357775,"lat1":57.4440055,"lng0":9.0047956,"lng1":10.0034954},"timeSteps":1},{"dyn":{"color":["#FF0000"],"value":[1]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (8.622241,56.3779116)","lat0":56.1357775,"lat1":56.3779116,"lng0":9.0047956,"lng1":8.622241},"timeSteps":1}],["1"],null,{"showTitle":true,"showValues":true,"labels":["Route"],"supValues":null,"supLabels":[],"html":null,"noPopup":false,"digits":null},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.297778]}},"evals":[],"jsHooks":[]}</script>
<p>A map with Solution 2:</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="mod-r-maps.html#cb553-1"></a>col_pal &lt;-<span class="st"> </span><span class="kw">rainbow</span>(<span class="kw">max</span>(datLines<span class="op">$</span>RouteId))</span>
<span id="cb553-2"><a href="mod-r-maps.html#cb553-2"></a>datP &lt;-<span class="st"> </span>datLines <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Sol <span class="op">==</span><span class="st"> </span><span class="dv">2</span>)</span>
<span id="cb553-3"><a href="mod-r-maps.html#cb553-3"></a>m <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">addFlows</span>(datP<span class="op">$</span>FromLon, datP<span class="op">$</span>FromLat, datP<span class="op">$</span>ToLon, datP<span class="op">$</span>ToLat,</span>
<span id="cb553-4"><a href="mod-r-maps.html#cb553-4"></a>               <span class="dt">flow =</span> datP<span class="op">$</span>RouteId, <span class="dt">maxThickness =</span> <span class="dv">2</span>, <span class="dt">color =</span> col_pal[datP<span class="op">$</span>RouteId],</span>
<span id="cb553-5"><a href="mod-r-maps.html#cb553-5"></a>               <span class="dt">opacity =</span> <span class="fl">0.5</span>, <span class="dt">popup =</span> <span class="kw">popupArgs</span>(<span class="dt">labels =</span> <span class="st">&quot;Route&quot;</span>))</span></code></pre></div>
<div id="htmlwidget-5374f89d646f87617017" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-5374f89d646f87617017">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.297778,10.0034954,8.622241],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addFlows","args":[[{"dyn":{"color":["#8000FF"],"value":[4]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (10.0034954,57.4440055) -> (9.0047956,56.1357775)","lat0":57.4440055,"lat1":56.1357775,"lng0":10.0034954,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#00FFFF"],"value":[3]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (12.297778,55.9290561) -> (8.4559613,55.5107577)","lat0":55.9290561,"lat1":55.5107577,"lng0":12.297778,"lng1":8.4559613},"timeSteps":1},{"dyn":{"color":["#00FFFF"],"value":[3]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.4559613,55.5107577) -> (9.0047956,56.1357775)","lat0":55.5107577,"lat1":56.1357775,"lng0":8.4559613,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#8000FF"],"value":[4]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.622241,56.3779116) -> (10.0034954,57.4440055)","lat0":56.3779116,"lat1":57.4440055,"lng0":8.622241,"lng1":10.0034954},"timeSteps":1},{"dyn":{"color":["#00FFFF"],"value":[3]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (12.297778,55.9290561)","lat0":56.1357775,"lat1":55.9290561,"lng0":9.0047956,"lng1":12.297778},"timeSteps":1},{"dyn":{"color":["#8000FF"],"value":[4]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (8.622241,56.3779116)","lat0":56.1357775,"lat1":56.3779116,"lng0":9.0047956,"lng1":8.622241},"timeSteps":1}],["1"],null,{"showTitle":true,"showValues":true,"labels":["Route"],"supValues":null,"supLabels":[],"html":null,"noPopup":false,"digits":null},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.297778]}},"evals":[],"jsHooks":[]}</script>
<p>An interactive map with both solutions:</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="mod-r-maps.html#cb554-1"></a>mm &lt;-<span class="st"> </span>m</span>
<span id="cb554-2"><a href="mod-r-maps.html#cb554-2"></a>res &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(datLines), <span class="cf">function</span>(i) {</span>
<span id="cb554-3"><a href="mod-r-maps.html#cb554-3"></a>   tmp &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">lat =</span> <span class="kw">c</span>(datLines<span class="op">$</span>FromLat[i], datLines<span class="op">$</span>ToLat[i]), <span class="dt">lon =</span> <span class="kw">c</span>(datLines<span class="op">$</span>FromLon[i], datLines<span class="op">$</span>ToLon[i]))</span>
<span id="cb554-4"><a href="mod-r-maps.html#cb554-4"></a>   mm &lt;&lt;-<span class="st"> </span>mm <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">addPolylines</span>(<span class="dt">lng =</span> <span class="op">~</span>lon, <span class="dt">lat =</span> <span class="op">~</span>lat, </span>
<span id="cb554-5"><a href="mod-r-maps.html#cb554-5"></a>                              <span class="dt">color =</span> col_pal[datLines<span class="op">$</span>Sol[i]], <span class="dt">group =</span> datLines<span class="op">$</span>group[i],</span>
<span id="cb554-6"><a href="mod-r-maps.html#cb554-6"></a>                              <span class="dt">data =</span> tmp, <span class="dt">weight =</span> <span class="dv">2</span>, <span class="dt">label =</span> datLines<span class="op">$</span>group[i])</span>
<span id="cb554-7"><a href="mod-r-maps.html#cb554-7"></a>   <span class="kw">return</span>(<span class="kw">invisible</span>(<span class="ot">NULL</span>))</span>
<span id="cb554-8"><a href="mod-r-maps.html#cb554-8"></a>})</span>
<span id="cb554-9"><a href="mod-r-maps.html#cb554-9"></a>mm &lt;-<span class="st"> </span>mm <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb554-10"><a href="mod-r-maps.html#cb554-10"></a><span class="st">  </span><span class="co"># Layer control</span></span>
<span id="cb554-11"><a href="mod-r-maps.html#cb554-11"></a><span class="st">  </span><span class="kw">addLayersControl</span>(</span>
<span id="cb554-12"><a href="mod-r-maps.html#cb554-12"></a>    <span class="dt">baseGroups =</span> <span class="kw">c</span>(<span class="st">&quot;Map&quot;</span>, <span class="st">&quot;Satelite&quot;</span>),</span>
<span id="cb554-13"><a href="mod-r-maps.html#cb554-13"></a>    <span class="dt">overlayGroups =</span> <span class="kw">unique</span>(datLines<span class="op">$</span>group),</span>
<span id="cb554-14"><a href="mod-r-maps.html#cb554-14"></a>    <span class="dt">options =</span> <span class="kw">layersControlOptions</span>(<span class="dt">collapsed =</span> <span class="ot">FALSE</span>)</span>
<span id="cb554-15"><a href="mod-r-maps.html#cb554-15"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb554-16"><a href="mod-r-maps.html#cb554-16"></a><span class="st">  </span><span class="kw">hideGroup</span>(<span class="kw">unique</span>(datLines<span class="op">$</span>group)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb554-17"><a href="mod-r-maps.html#cb554-17"></a><span class="st">  </span><span class="kw">showGroup</span>(<span class="st">&quot;Solution 1&quot;</span>)</span>
<span id="cb554-18"><a href="mod-r-maps.html#cb554-18"></a>mm</span></code></pre></div>
<div id="htmlwidget-2d7ed34ad05f5754f7c0" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-2d7ed34ad05f5754f7c0">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.297778,10.0034954,8.622241],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,8.622241],"lat":[56.1357775,56.3779116]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.622241,8.4559613],"lat":[56.3779116,55.5107577]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.4559613,9.0047956],"lat":[55.5107577,56.1357775]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,10.0034954],"lat":[56.1357775,57.4440055]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[10.0034954,12.297778],"lat":[57.4440055,55.9290561]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[12.297778,9.0047956],"lat":[55.9290561,56.1357775]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,12.297778],"lat":[56.1357775,55.9290561]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[12.297778,8.4559613],"lat":[55.9290561,55.5107577]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.4559613,9.0047956],"lat":[55.5107577,56.1357775]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,8.622241],"lat":[56.1357775,56.3779116]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.622241,10.0034954],"lat":[56.3779116,57.4440055]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[10.0034954,9.0047956],"lat":[57.4440055,56.1357775]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[["Map","Satelite"],["Solution 1","Solution 2"],{"collapsed":false,"autoZIndex":true,"position":"topright"}]},{"method":"hideGroup","args":[["Solution 1","Solution 2"]]},{"method":"showGroup","args":["Solution 1"]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.297778]}},"evals":[],"jsHooks":[]}</script>
<p>Note unfortunately arrows cannot be shown in this case.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mod-r-dist-fit.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mod-r-excel.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/bss-osca/tfa/edit/master/book/09-02_r-maps.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

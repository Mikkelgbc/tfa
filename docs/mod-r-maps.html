<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Module 16 Spatial data and maps | Tools for Analytics (TFA)</title>
  <meta name="description" content="Course notes for the ‘Tools for Analytics’ course" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="Module 16 Spatial data and maps | Tools for Analytics (TFA)" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://bss-osca.github.io/tfa//assets/logo.png" />
  <meta property="og:description" content="Course notes for the ‘Tools for Analytics’ course" />
  <meta name="github-repo" content="bss-osca/tfa" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Module 16 Spatial data and maps | Tools for Analytics (TFA)" />
  
  <meta name="twitter:description" content="Course notes for the ‘Tools for Analytics’ course" />
  <meta name="twitter:image" content="https://bss-osca.github.io/tfa//assets/logo.png" />

<meta name="author" content="Lars Relund Nielsen" />


<meta name="date" content="2023-08-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon" />
<link rel="prev" href="mod-r-dist-fit.html"/>
<link rel="next" href="groups.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.10/grViz.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.2/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script>
<link href="libs/minichart-0.2.2/minicharts.css" rel="stylesheet" />
<script src="libs/minichart-0.2.2/leaflet.minicharts.min.js"></script>
<link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.28/datatables.js"></script>
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<html>
<head>
<script>
  $(document).ready(function() {

  // Section anchors
  $('.section h1, .section h2, .section h3, .section h4, .section h5').each(function() {
    anchor = '#' + $(this).parent().attr('id');
    $(this).addClass("hasAnchor").prepend('<a href="' + anchor + '" class="anchor"></a>');
  });
});
</script>
<script src="https://hypothes.is/embed.js" async></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</head>
</html>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="img/logo.png"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction to the course</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#lo-intro"><i class="fa fa-check"></i><b>1.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#purpose"><i class="fa fa-check"></i><b>1.2</b> Purpose for the course</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#r-vs-vba"><i class="fa fa-check"></i><b>1.3</b> R vs Excel/VBA</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#computer"><i class="fa fa-check"></i><b>1.4</b> How a computer works</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#organization"><i class="fa fa-check"></i><b>1.5</b> How the notes are organized</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#ack"><i class="fa fa-check"></i><b>1.6</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#ex-intro"><i class="fa fa-check"></i><b>1.7</b> Exercises</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="index.html"><a href="index.html#ex-annotate"><i class="fa fa-check"></i><b>1.7.1</b> Exercise - How to annotate</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I VBA</b></span></li>
<li class="chapter" data-level="2" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html"><i class="fa fa-check"></i><b>2</b> An introduction to VBA</a>
<ul>
<li class="chapter" data-level="2.1" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#lo-vba-intro"><i class="fa fa-check"></i><b>2.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="2.2" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#vba-what"><i class="fa fa-check"></i><b>2.2</b> What is VBA</a></li>
<li class="chapter" data-level="2.3" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#vba-setup"><i class="fa fa-check"></i><b>2.3</b> Setup Excel for VBA</a></li>
<li class="chapter" data-level="2.4" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#vba-hello"><i class="fa fa-check"></i><b>2.4</b> Your first program</a></li>
<li class="chapter" data-level="2.5" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#vba-macro"><i class="fa fa-check"></i><b>2.5</b> The macro recorder</a></li>
<li class="chapter" data-level="2.6" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#vba-overview"><i class="fa fa-check"></i><b>2.6</b> VBA - A short overview</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#variables"><i class="fa fa-check"></i><b>2.6.1</b> Variables</a></li>
<li class="chapter" data-level="2.6.2" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#procedures"><i class="fa fa-check"></i><b>2.6.2</b> Procedures</a></li>
<li class="chapter" data-level="2.6.3" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#input-and-output"><i class="fa fa-check"></i><b>2.6.3</b> Input and output</a></li>
<li class="chapter" data-level="2.6.4" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#conditional-statements"><i class="fa fa-check"></i><b>2.6.4</b> Conditional statements</a></li>
<li class="chapter" data-level="2.6.5" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#loops"><i class="fa fa-check"></i><b>2.6.5</b> Loops</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#vba-coding-practice"><i class="fa fa-check"></i><b>2.7</b> Good coding pratice</a></li>
<li class="chapter" data-level="2.8" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#rc-vba-intro"><i class="fa fa-check"></i><b>2.8</b> Recap</a></li>
<li class="chapter" data-level="2.9" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-intro"><i class="fa fa-check"></i><b>2.9</b> Exercises</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-hello"><i class="fa fa-check"></i><b>2.9.1</b> Exercise - Hello</a></li>
<li class="chapter" data-level="2.9.2" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-macro"><i class="fa fa-check"></i><b>2.9.2</b> Exercise - Record a macro</a></li>
<li class="chapter" data-level="2.9.3" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-user-input"><i class="fa fa-check"></i><b>2.9.3</b> Exercise - User input</a></li>
<li class="chapter" data-level="2.9.4" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-max-min"><i class="fa fa-check"></i><b>2.9.4</b> Exercise - Max and min number</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html"><i class="fa fa-check"></i><b>3</b> Loops and conditional statements</a>
<ul>
<li class="chapter" data-level="3.1" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#lo-vba-loops-cond"><i class="fa fa-check"></i><b>3.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="3.2" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#vba-operators"><i class="fa fa-check"></i><b>3.2</b> Relational and logical operators</a></li>
<li class="chapter" data-level="3.3" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#vba-loops"><i class="fa fa-check"></i><b>3.3</b> Loops</a></li>
<li class="chapter" data-level="3.4" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#vba-cond"><i class="fa fa-check"></i><b>3.4</b> Conditional statements</a></li>
<li class="chapter" data-level="3.5" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#vba-ex-jen"><i class="fa fa-check"></i><b>3.5</b> Example - Find Jen</a></li>
<li class="chapter" data-level="3.6" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#vba-ex-dist-mat"><i class="fa fa-check"></i><b>3.6</b> Example - A distance matrix</a></li>
<li class="chapter" data-level="3.7" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#recap"><i class="fa fa-check"></i><b>3.7</b> Recap</a></li>
<li class="chapter" data-level="3.8" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#ex-vba-loops-cond"><i class="fa fa-check"></i><b>3.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#ex-vba-loops"><i class="fa fa-check"></i><b>3.8.1</b> Exercise - Loops</a></li>
<li class="chapter" data-level="3.8.2" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#ex-vba-cond"><i class="fa fa-check"></i><b>3.8.2</b> Exercise - Conditional statements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html"><i class="fa fa-check"></i><b>4</b> Procedures</a>
<ul>
<li class="chapter" data-level="4.1" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#lo-vba-procedures"><i class="fa fa-check"></i><b>4.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="4.2" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#vba-subs-functions"><i class="fa fa-check"></i><b>4.2</b> Subs and functions - The basics</a></li>
<li class="chapter" data-level="4.3" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#vba-optional-arg"><i class="fa fa-check"></i><b>4.3</b> Optional arguments</a></li>
<li class="chapter" data-level="4.4" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#vba-pub-priv"><i class="fa fa-check"></i><b>4.4</b> Public and private procedures</a></li>
<li class="chapter" data-level="4.5" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#vba-byref"><i class="fa fa-check"></i><b>4.5</b> Passing arguments by reference or by value</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#return-values-from-a-sub"><i class="fa fa-check"></i><b>4.5.1</b> Return values from a sub</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#vba-built-in"><i class="fa fa-check"></i><b>4.6</b> Built-in functions</a></li>
<li class="chapter" data-level="4.7" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#vba-test-persons"><i class="fa fa-check"></i><b>4.7</b> Example - Selection of test persons</a></li>
<li class="chapter" data-level="4.8" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#recap-1"><i class="fa fa-check"></i><b>4.8</b> Recap</a></li>
<li class="chapter" data-level="4.9" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#ex-vba-procedures"><i class="fa fa-check"></i><b>4.9</b> Exercises</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#ex-vba-subs"><i class="fa fa-check"></i><b>4.9.1</b> Exercise - Subs</a></li>
<li class="chapter" data-level="4.9.2" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#exercise---temperatures"><i class="fa fa-check"></i><b>4.9.2</b> Exercise - Temperatures</a></li>
<li class="chapter" data-level="4.9.3" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#ex-vba-functions"><i class="fa fa-check"></i><b>4.9.3</b> Exercise - Functions</a></li>
<li class="chapter" data-level="4.9.4" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#ex-vba-worksheet-functions"><i class="fa fa-check"></i><b>4.9.4</b> Exercise - Worksheet functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html"><i class="fa fa-check"></i><b>5</b> Advanced data types and usage</a>
<ul>
<li class="chapter" data-level="5.1" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#lo-vba-datatypes"><i class="fa fa-check"></i><b>5.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="5.2" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#vba-strings"><i class="fa fa-check"></i><b>5.2</b> Strings</a></li>
<li class="chapter" data-level="5.3" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#vba-objects"><i class="fa fa-check"></i><b>5.3</b> Objects</a></li>
<li class="chapter" data-level="5.4" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#vba-wst"><i class="fa fa-check"></i><b>5.4</b> The Worksheet object</a></li>
<li class="chapter" data-level="5.5" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#wst-rng"><i class="fa fa-check"></i><b>5.5</b> The Range object</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#named-ranges-in-excel"><i class="fa fa-check"></i><b>5.5.1</b> Named ranges in Excel</a></li>
<li class="chapter" data-level="5.5.2" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#current-region-of-a-range"><i class="fa fa-check"></i><b>5.5.2</b> Current region of a range</a></li>
<li class="chapter" data-level="5.5.3" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#input-and-output-1"><i class="fa fa-check"></i><b>5.5.3</b> Input and output</a></li>
<li class="chapter" data-level="5.5.4" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#sorting-a-range"><i class="fa fa-check"></i><b>5.5.4</b> Sorting a range</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#vba-ary"><i class="fa fa-check"></i><b>5.6</b> Arrays</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#multi-dimensional-arrays"><i class="fa fa-check"></i><b>5.6.1</b> Multi-dimensional arrays</a></li>
<li class="chapter" data-level="5.6.2" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#dynamic-arrays"><i class="fa fa-check"></i><b>5.6.2</b> Dynamic arrays</a></li>
<li class="chapter" data-level="5.6.3" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#input-and-output-2"><i class="fa fa-check"></i><b>5.6.3</b> Input and output</a></li>
<li class="chapter" data-level="5.6.4" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#sorting-arrays"><i class="fa fa-check"></i><b>5.6.4</b> Sorting arrays</a></li>
<li class="chapter" data-level="5.6.5" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#use-arrays-instead-of-ranges"><i class="fa fa-check"></i><b>5.6.5</b> Use arrays instead of ranges</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#vba-coll"><i class="fa fa-check"></i><b>5.7</b> Collections</a></li>
<li class="chapter" data-level="5.8" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#vba-ex-job-seq"><i class="fa fa-check"></i><b>5.8</b> Example - Job sequencing</a></li>
<li class="chapter" data-level="5.9" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#recap-2"><i class="fa fa-check"></i><b>5.9</b> Recap</a></li>
<li class="chapter" data-level="5.10" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-datatypes"><i class="fa fa-check"></i><b>5.10</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-equal"><i class="fa fa-check"></i><b>5.10.1</b> Exercise - Equal entries</a></li>
<li class="chapter" data-level="5.10.2" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-search-products"><i class="fa fa-check"></i><b>5.10.2</b> Exercise - Product search</a></li>
<li class="chapter" data-level="5.10.3" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-read-collections"><i class="fa fa-check"></i><b>5.10.3</b> Exercise - Read collections</a></li>
<li class="chapter" data-level="5.10.4" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-read-arrays"><i class="fa fa-check"></i><b>5.10.4</b> Exercise - Read arrays</a></li>
<li class="chapter" data-level="5.10.5" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-process"><i class="fa fa-check"></i><b>5.10.5</b> Exercise - Process numbers</a></li>
<li class="chapter" data-level="5.10.6" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-search-pay"><i class="fa fa-check"></i><b>5.10.6</b> Exercise - Search payments</a></li>
<li class="chapter" data-level="5.10.7" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-flight"><i class="fa fa-check"></i><b>5.10.7</b> Exercise - Flight search</a></li>
<li class="chapter" data-level="5.10.8" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-search-table"><i class="fa fa-check"></i><b>5.10.8</b> Exercise - Search table</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html"><i class="fa fa-check"></i><b>6</b> Generating random numbers</a>
<ul>
<li class="chapter" data-level="6.1" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#lo-vba-random-numbers"><i class="fa fa-check"></i><b>6.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="6.2" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#vba-random-numbers"><i class="fa fa-check"></i><b>6.2</b> Generating random numbers</a></li>
<li class="chapter" data-level="6.3" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#vba-simulation"><i class="fa fa-check"></i><b>6.3</b> Simulation</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#sec-vba-tsp"><i class="fa fa-check"></i><b>6.3.1</b> Example - Traveling salesman problem</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#recap-3"><i class="fa fa-check"></i><b>6.4</b> Recap</a></li>
<li class="chapter" data-level="6.5" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#ex-vba-random-numbers"><i class="fa fa-check"></i><b>6.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#ex-vba-random-int"><i class="fa fa-check"></i><b>6.5.1</b> Exercise - Two random integers</a></li>
<li class="chapter" data-level="6.5.2" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#ex-vba-swap"><i class="fa fa-check"></i><b>6.5.2</b> Exercise - Swap entries</a></li>
<li class="chapter" data-level="6.5.3" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#ex-vba-bakery"><i class="fa fa-check"></i><b>6.5.3</b> Exercise - Dan’s bakery</a></li>
<li class="chapter" data-level="6.5.4" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#ex-vba-generate"><i class="fa fa-check"></i><b>6.5.4</b> Exercise - Generating random numbers</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II R</b></span></li>
<li class="chapter" data-level="7" data-path="mod-r-install.html"><a href="mod-r-install.html"><i class="fa fa-check"></i><b>7</b> Setting up R</a>
<ul>
<li class="chapter" data-level="7.1" data-path="mod-r-install.html"><a href="mod-r-install.html#lo-r-install"><i class="fa fa-check"></i><b>7.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="7.2" data-path="mod-r-install.html"><a href="mod-r-install.html#r-install"><i class="fa fa-check"></i><b>7.2</b> Install R and RStudio</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="mod-r-install.html"><a href="mod-r-install.html#test-your-installation"><i class="fa fa-check"></i><b>7.2.1</b> Test your installation</a></li>
<li class="chapter" data-level="7.2.2" data-path="mod-r-install.html"><a href="mod-r-install.html#add-on-packages"><i class="fa fa-check"></i><b>7.2.2</b> Add-on packages</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="mod-r-install.html"><a href="mod-r-install.html#r-cloud"><i class="fa fa-check"></i><b>7.3</b> Setup and test Posit Cloud</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html"><i class="fa fa-check"></i><b>8</b> R basics and workflows</a>
<ul>
<li class="chapter" data-level="8.1" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#lo-r-workflow"><i class="fa fa-check"></i><b>8.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="8.2" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#working-with-r-at-the-command-line-in-rstudio"><i class="fa fa-check"></i><b>8.2</b> Working with R at the command line in RStudio</a></li>
<li class="chapter" data-level="8.3" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#your-first-datacamp-course"><i class="fa fa-check"></i><b>8.3</b> Your first DataCamp course</a></li>
<li class="chapter" data-level="8.4" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#pipes"><i class="fa fa-check"></i><b>8.4</b> Pipes</a></li>
<li class="chapter" data-level="8.5" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#rprojs"><i class="fa fa-check"></i><b>8.5</b> RStudio projects</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#storing-your-code-in-a-script-file"><i class="fa fa-check"></i><b>8.5.1</b> Storing your code in a script file</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#rc-r-workflow"><i class="fa fa-check"></i><b>8.6</b> Recap</a></li>
<li class="chapter" data-level="8.7" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#ex-r-workflow"><i class="fa fa-check"></i><b>8.7</b> Exercises</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#exercise-group-work"><i class="fa fa-check"></i><b>8.7.1</b> Exercise (group work)</a></li>
<li class="chapter" data-level="8.7.2" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#exercise-piping"><i class="fa fa-check"></i><b>8.7.2</b> Exercise (piping)</a></li>
<li class="chapter" data-level="8.7.3" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#exercise-working-dir"><i class="fa fa-check"></i><b>8.7.3</b> Exercise (working dir)</a></li>
<li class="chapter" data-level="8.7.4" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#exercise-vectors"><i class="fa fa-check"></i><b>8.7.4</b> Exercise (vectors)</a></li>
<li class="chapter" data-level="8.7.5" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#exercise-matrices"><i class="fa fa-check"></i><b>8.7.5</b> Exercise (matrices)</a></li>
<li class="chapter" data-level="8.7.6" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#exercise-data-frames"><i class="fa fa-check"></i><b>8.7.6</b> Exercise (data frames)</a></li>
<li class="chapter" data-level="8.7.7" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#exercise-lists"><i class="fa fa-check"></i><b>8.7.7</b> Exercise (lists)</a></li>
<li class="chapter" data-level="8.7.8" data-path="mod-r-workflow.html"><a href="mod-r-workflow.html#ex-strings"><i class="fa fa-check"></i><b>8.7.8</b> Exercise (string management)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html"><i class="fa fa-check"></i><b>9</b> Loops and conditionals</a>
<ul>
<li class="chapter" data-level="9.1" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html#lo-loops"><i class="fa fa-check"></i><b>9.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="9.2" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html#r-dc-loops-cond"><i class="fa fa-check"></i><b>9.2</b> Conditionals and control flow</a></li>
<li class="chapter" data-level="9.3" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html#r-loops"><i class="fa fa-check"></i><b>9.3</b> Loops</a></li>
<li class="chapter" data-level="9.4" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html#rc-r-loops-cond"><i class="fa fa-check"></i><b>9.4</b> Recap</a></li>
<li class="chapter" data-level="9.5" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html#ex-r-loops-cond"><i class="fa fa-check"></i><b>9.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html#ex-r-conditional-expressions"><i class="fa fa-check"></i><b>9.5.1</b> Exercise (conditional expressions)</a></li>
<li class="chapter" data-level="9.5.2" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html#ex-r-loops"><i class="fa fa-check"></i><b>9.5.2</b> Exercise (loops)</a></li>
<li class="chapter" data-level="9.5.3" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html#ex-r-search-vector"><i class="fa fa-check"></i><b>9.5.3</b> Exercise (search vector)</a></li>
<li class="chapter" data-level="9.5.4" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html#ex-dist"><i class="fa fa-check"></i><b>9.5.4</b> Exercise (calculating distances)</a></li>
<li class="chapter" data-level="9.5.5" data-path="mod-r-loops-cond.html"><a href="mod-r-loops-cond.html#ex-r-expand"><i class="fa fa-check"></i><b>9.5.5</b> Exercise (expand_grid)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="mod-r-functions.html"><a href="mod-r-functions.html"><i class="fa fa-check"></i><b>10</b> Functions</a>
<ul>
<li class="chapter" data-level="10.1" data-path="mod-r-functions.html"><a href="mod-r-functions.html#lo-r-functions"><i class="fa fa-check"></i><b>10.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="10.2" data-path="mod-r-functions.html"><a href="mod-r-functions.html#r-dc-functions"><i class="fa fa-check"></i><b>10.2</b> DataCamp course</a></li>
<li class="chapter" data-level="10.3" data-path="mod-r-functions.html"><a href="mod-r-functions.html#r-functions-extra"><i class="fa fa-check"></i><b>10.3</b> Functions returning multiple objects</a></li>
<li class="chapter" data-level="10.4" data-path="mod-r-functions.html"><a href="mod-r-functions.html#r-functions-arg"><i class="fa fa-check"></i><b>10.4</b> The <code>...</code> argument</a></li>
<li class="chapter" data-level="10.5" data-path="mod-r-functions.html"><a href="mod-r-functions.html#r-functions-doc"><i class="fa fa-check"></i><b>10.5</b> Documenting your functions</a></li>
<li class="chapter" data-level="10.6" data-path="mod-r-functions.html"><a href="mod-r-functions.html#example---job-sequencing"><i class="fa fa-check"></i><b>10.6</b> Example - Job sequencing</a></li>
<li class="chapter" data-level="10.7" data-path="mod-r-functions.html"><a href="mod-r-functions.html#rc-functions"><i class="fa fa-check"></i><b>10.7</b> Recap</a></li>
<li class="chapter" data-level="10.8" data-path="mod-r-functions.html"><a href="mod-r-functions.html#ex-r-functions"><i class="fa fa-check"></i><b>10.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="10.8.1" data-path="mod-r-functions.html"><a href="mod-r-functions.html#ex-r-def-func"><i class="fa fa-check"></i><b>10.8.1</b> Exercise (defining functions)</a></li>
<li class="chapter" data-level="10.8.2" data-path="mod-r-functions.html"><a href="mod-r-functions.html#ex-r-euclidean-distances"><i class="fa fa-check"></i><b>10.8.2</b> Exercise (euclidean distances)</a></li>
<li class="chapter" data-level="10.8.3" data-path="mod-r-functions.html"><a href="mod-r-functions.html#exercise-scope"><i class="fa fa-check"></i><b>10.8.3</b> Exercise (scope)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="mod-r-tidyverse-intro.html"><a href="mod-r-tidyverse-intro.html"><i class="fa fa-check"></i><b>11</b> Introduction to tidyverse and RMarkdown</a>
<ul>
<li class="chapter" data-level="11.1" data-path="mod-r-tidyverse-intro.html"><a href="mod-r-tidyverse-intro.html#lo-tidyverse-intro"><i class="fa fa-check"></i><b>11.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="11.2" data-path="mod-r-tidyverse-intro.html"><a href="mod-r-tidyverse-intro.html#r-tidyverse-intro"><i class="fa fa-check"></i><b>11.2</b> The tidyverse package</a></li>
<li class="chapter" data-level="11.3" data-path="mod-r-tidyverse-intro.html"><a href="mod-r-tidyverse-intro.html#r-markdown-intro"><i class="fa fa-check"></i><b>11.3</b> Writing reproducible reports</a></li>
<li class="chapter" data-level="11.4" data-path="mod-r-tidyverse-intro.html"><a href="mod-r-tidyverse-intro.html#r-tibbles-intro"><i class="fa fa-check"></i><b>11.4</b> Tibbles</a></li>
<li class="chapter" data-level="11.5" data-path="mod-r-tidyverse-intro.html"><a href="mod-r-tidyverse-intro.html#rc-tidyverse-intro"><i class="fa fa-check"></i><b>11.5</b> Recap</a></li>
<li class="chapter" data-level="11.6" data-path="mod-r-tidyverse-intro.html"><a href="mod-r-tidyverse-intro.html#ex-tidyverse-intro"><i class="fa fa-check"></i><b>11.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="mod-r-tidyverse-intro.html"><a href="mod-r-tidyverse-intro.html#exercise-your-first-rmarkdown-exercise"><i class="fa fa-check"></i><b>11.6.1</b> Exercise (your first RMarkdown exercise)</a></li>
<li class="chapter" data-level="11.6.2" data-path="mod-r-tidyverse-intro.html"><a href="mod-r-tidyverse-intro.html#exercise-tibbles"><i class="fa fa-check"></i><b>11.6.2</b> Exercise (tibbles)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="mod-r-io.html"><a href="mod-r-io.html"><i class="fa fa-check"></i><b>12</b> Importing and exporting data</a>
<ul>
<li class="chapter" data-level="12.1" data-path="mod-r-io.html"><a href="mod-r-io.html#lo-r-io"><i class="fa fa-check"></i><b>12.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="12.2" data-path="mod-r-io.html"><a href="mod-r-io.html#r-io-csv"><i class="fa fa-check"></i><b>12.2</b> CSV files</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="mod-r-io.html"><a href="mod-r-io.html#reading-a-csv-file"><i class="fa fa-check"></i><b>12.2.1</b> Reading a CSV file</a></li>
<li class="chapter" data-level="12.2.2" data-path="mod-r-io.html"><a href="mod-r-io.html#writing-to-csv-files"><i class="fa fa-check"></i><b>12.2.2</b> Writing to CSV files</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="mod-r-io.html"><a href="mod-r-io.html#r-io-excel"><i class="fa fa-check"></i><b>12.3</b> Excel</a></li>
<li class="chapter" data-level="12.4" data-path="mod-r-io.html"><a href="mod-r-io.html#r-io-google"><i class="fa fa-check"></i><b>12.4</b> Google Sheets</a></li>
<li class="chapter" data-level="12.5" data-path="mod-r-io.html"><a href="mod-r-io.html#r-io-text"><i class="fa fa-check"></i><b>12.5</b> Text files</a></li>
<li class="chapter" data-level="12.6" data-path="mod-r-io.html"><a href="mod-r-io.html#r-io-r"><i class="fa fa-check"></i><b>12.6</b> R’s native binary format</a></li>
<li class="chapter" data-level="12.7" data-path="mod-r-io.html"><a href="mod-r-io.html#r-io-json"><i class="fa fa-check"></i><b>12.7</b> Json</a></li>
<li class="chapter" data-level="12.8" data-path="mod-r-io.html"><a href="mod-r-io.html#rc-r-io"><i class="fa fa-check"></i><b>12.8</b> Recap</a></li>
<li class="chapter" data-level="12.9" data-path="mod-r-io.html"><a href="mod-r-io.html#ex-r-io"><i class="fa fa-check"></i><b>12.9</b> Exercises</a>
<ul>
<li class="chapter" data-level="12.9.1" data-path="mod-r-io.html"><a href="mod-r-io.html#exercise-statistikbanken"><i class="fa fa-check"></i><b>12.9.1</b> Exercise (Statistikbanken)</a></li>
<li class="chapter" data-level="12.9.2" data-path="mod-r-io.html"><a href="mod-r-io.html#exercise-tuples-in-opl"><i class="fa fa-check"></i><b>12.9.2</b> Exercise (tuples in OPL)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="mod-r-transform.html"><a href="mod-r-transform.html"><i class="fa fa-check"></i><b>13</b> Transforming data</a>
<ul>
<li class="chapter" data-level="13.1" data-path="mod-r-transform.html"><a href="mod-r-transform.html#lo-r-transform"><i class="fa fa-check"></i><b>13.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="13.2" data-path="mod-r-transform.html"><a href="mod-r-transform.html#r-transform-tidyverse"><i class="fa fa-check"></i><b>13.2</b> Working with data in the tidyverse</a></li>
<li class="chapter" data-level="13.3" data-path="mod-r-transform.html"><a href="mod-r-transform.html#r-transform-joins"><i class="fa fa-check"></i><b>13.3</b> Mutating joins</a></li>
<li class="chapter" data-level="13.4" data-path="mod-r-transform.html"><a href="mod-r-transform.html#rc-r-transform"><i class="fa fa-check"></i><b>13.4</b> Recap</a></li>
<li class="chapter" data-level="13.5" data-path="mod-r-transform.html"><a href="mod-r-transform.html#ex-r-transform"><i class="fa fa-check"></i><b>13.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="mod-r-transform.html"><a href="mod-r-transform.html#ex-gapminder1"><i class="fa fa-check"></i><b>13.5.1</b> Exercise (gapminder)</a></li>
<li class="chapter" data-level="13.5.2" data-path="mod-r-transform.html"><a href="mod-r-transform.html#ex-babynames1"><i class="fa fa-check"></i><b>13.5.2</b> Exercise (babynames)</a></li>
<li class="chapter" data-level="13.5.3" data-path="mod-r-transform.html"><a href="mod-r-transform.html#ex-profit1"><i class="fa fa-check"></i><b>13.5.3</b> Exercise (profit)</a></li>
<li class="chapter" data-level="13.5.4" data-path="mod-r-transform.html"><a href="mod-r-transform.html#ex-fish"><i class="fa fa-check"></i><b>13.5.4</b> Exercise (fisheries)</a></li>
<li class="chapter" data-level="13.5.5" data-path="mod-r-transform.html"><a href="mod-r-transform.html#ex-company"><i class="fa fa-check"></i><b>13.5.5</b> Exercise (company ranking)</a></li>
<li class="chapter" data-level="13.5.6" data-path="mod-r-transform.html"><a href="mod-r-transform.html#ex-titanic"><i class="fa fa-check"></i><b>13.5.6</b> Exercise (Titanic)</a></li>
<li class="chapter" data-level="13.5.7" data-path="mod-r-transform.html"><a href="mod-r-transform.html#ex-r-covid"><i class="fa fa-check"></i><b>13.5.7</b> Exercise (covid)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="mod-r-plot.html"><a href="mod-r-plot.html"><i class="fa fa-check"></i><b>14</b> Data visualization using ggplot</a>
<ul>
<li class="chapter" data-level="14.1" data-path="mod-r-plot.html"><a href="mod-r-plot.html#lo-plot"><i class="fa fa-check"></i><b>14.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="14.2" data-path="mod-r-plot.html"><a href="mod-r-plot.html#r-plot-intro"><i class="fa fa-check"></i><b>14.2</b> Introduction to data visualization</a></li>
<li class="chapter" data-level="14.3" data-path="mod-r-plot.html"><a href="mod-r-plot.html#r-plot-multi"><i class="fa fa-check"></i><b>14.3</b> Combining plots into one using <em>patchwork</em></a></li>
<li class="chapter" data-level="14.4" data-path="mod-r-plot.html"><a href="mod-r-plot.html#r-plot-save"><i class="fa fa-check"></i><b>14.4</b> Saving graphics</a></li>
<li class="chapter" data-level="14.5" data-path="mod-r-plot.html"><a href="mod-r-plot.html#rc-r-plot"><i class="fa fa-check"></i><b>14.5</b> Recap</a></li>
<li class="chapter" data-level="14.6" data-path="mod-r-plot.html"><a href="mod-r-plot.html#ex-r-plot"><i class="fa fa-check"></i><b>14.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="mod-r-plot.html"><a href="mod-r-plot.html#ex-gapminder2"><i class="fa fa-check"></i><b>14.6.1</b> Exercise (gapminder)</a></li>
<li class="chapter" data-level="14.6.2" data-path="mod-r-plot.html"><a href="mod-r-plot.html#ex-profit2"><i class="fa fa-check"></i><b>14.6.2</b> Exercise (profit)</a></li>
<li class="chapter" data-level="14.6.3" data-path="mod-r-plot.html"><a href="mod-r-plot.html#ex-covid19"><i class="fa fa-check"></i><b>14.6.3</b> Exercise (COVID-19)</a></li>
<li class="chapter" data-level="14.6.4" data-path="mod-r-plot.html"><a href="mod-r-plot.html#ex-lego"><i class="fa fa-check"></i><b>14.6.4</b> Exercise (Lego and sales)</a></li>
<li class="chapter" data-level="14.6.5" data-path="mod-r-plot.html"><a href="mod-r-plot.html#ex-company-plot"><i class="fa fa-check"></i><b>14.6.5</b> Exercise (company ranking)</a></li>
<li class="chapter" data-level="14.6.6" data-path="mod-r-plot.html"><a href="mod-r-plot.html#ex-titanic-plot"><i class="fa fa-check"></i><b>14.6.6</b> Exercise (Titanic)</a></li>
<li class="chapter" data-level="14.6.7" data-path="mod-r-plot.html"><a href="mod-r-plot.html#ex-r-covid-plot"><i class="fa fa-check"></i><b>14.6.7</b> Exercise (covid)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Extra R</b></span></li>
<li class="chapter" data-level="15" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html"><i class="fa fa-check"></i><b>15</b> Fitting probability distributions</a>
<ul>
<li class="chapter" data-level="15.1" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#lo-r-dist-fit"><i class="fa fa-check"></i><b>15.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="15.2" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#sec-r-dist-fit-intro"><i class="fa fa-check"></i><b>15.2</b> Introduction</a></li>
<li class="chapter" data-level="15.3" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#sec-r-dist-fit-cont"><i class="fa fa-check"></i><b>15.3</b> Fitting distributions to continuous data</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#example-breakdown-times"><i class="fa fa-check"></i><b>15.3.1</b> Example: breakdown times</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#sec-r-dist-fit-discrete"><i class="fa fa-check"></i><b>15.4</b> Fitting distributions to discrete data</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#example-sales-of-lottery-tickets"><i class="fa fa-check"></i><b>15.4.1</b> Example: sales of lottery tickets</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#sec-dist-fit-pois"><i class="fa fa-check"></i><b>15.5</b> The Poisson process</a></li>
<li class="chapter" data-level="15.6" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#rc-r-dist-fit"><i class="fa fa-check"></i><b>15.6</b> Recap</a></li>
<li class="chapter" data-level="15.7" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#ex-r-dist-fit"><i class="fa fa-check"></i><b>15.7</b> Exercises</a>
<ul>
<li class="chapter" data-level="15.7.1" data-path="mod-r-dist-fit.html"><a href="mod-r-dist-fit.html#exercise---call-center"><i class="fa fa-check"></i><b>15.7.1</b> Exercise - Call center</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="mod-r-maps.html"><a href="mod-r-maps.html"><i class="fa fa-check"></i><b>16</b> Spatial data and maps</a>
<ul>
<li class="chapter" data-level="16.1" data-path="mod-r-maps.html"><a href="mod-r-maps.html#lo-maps"><i class="fa fa-check"></i><b>16.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="16.2" data-path="mod-r-maps.html"><a href="mod-r-maps.html#sec-map-api-key"><i class="fa fa-check"></i><b>16.2</b> Services for obtatining spatial data</a></li>
<li class="chapter" data-level="16.3" data-path="mod-r-maps.html"><a href="mod-r-maps.html#calculating-distances"><i class="fa fa-check"></i><b>16.3</b> Calculating distances</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="mod-r-maps.html"><a href="mod-r-maps.html#using-google-maps"><i class="fa fa-check"></i><b>16.3.1</b> Using Google Maps</a></li>
<li class="chapter" data-level="16.3.2" data-path="mod-r-maps.html"><a href="mod-r-maps.html#using-bing-maps"><i class="fa fa-check"></i><b>16.3.2</b> Using Bing Maps</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="mod-r-maps.html"><a href="mod-r-maps.html#geocoding-and-reverse-geocoding"><i class="fa fa-check"></i><b>16.4</b> Geocoding and reverse geocoding</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="mod-r-maps.html"><a href="mod-r-maps.html#using-google-maps-1"><i class="fa fa-check"></i><b>16.4.1</b> Using Google maps</a></li>
<li class="chapter" data-level="16.4.2" data-path="mod-r-maps.html"><a href="mod-r-maps.html#use-bing-maps"><i class="fa fa-check"></i><b>16.4.2</b> Use Bing Maps</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="mod-r-maps.html"><a href="mod-r-maps.html#adding-markers-and-routes-to-a-map"><i class="fa fa-check"></i><b>16.5</b> Adding markers and routes to a map</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="groups.html"><a href="groups.html"><i class="fa fa-check"></i><b>A</b> Working in groups</a>
<ul>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#using-git"><i class="fa fa-check"></i>Using Git together with GitHub</a>
<ul>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#register-a-free-github-account"><i class="fa fa-check"></i>Register a free GitHub account</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#install-git"><i class="fa fa-check"></i>Install Git</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#check-your-installation"><i class="fa fa-check"></i>Check your installation</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#setup-projects-using-git-and-github"><i class="fa fa-check"></i>Setup projects using Git and GitHub</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="annotate.html"><a href="annotate.html"><i class="fa fa-check"></i><b>B</b> Annotate the course notes</a></li>
<li class="chapter" data-level="C" data-path="help.html"><a href="help.html"><i class="fa fa-check"></i><b>C</b> Getting help</a></li>
<li class="chapter" data-level="D" data-path="coding-convention.html"><a href="coding-convention.html"><i class="fa fa-check"></i><b>D</b> Coding/naming convention</a>
<ul>
<li class="chapter" data-level="D.1" data-path="coding-convention.html"><a href="coding-convention.html#commenting-your-code"><i class="fa fa-check"></i><b>D.1</b> Commenting your code</a></li>
</ul></li>
<li class="chapter" data-level="E" data-path="apdx-vba.html"><a href="apdx-vba.html"><i class="fa fa-check"></i><b>E</b> VBA specific topics</a>
<ul>
<li class="chapter" data-level="E.1" data-path="apdx-vba.html"><a href="apdx-vba.html#vba-debug"><i class="fa fa-check"></i><b>E.1</b> Debugging your code</a></li>
<li class="chapter" data-level="E.2" data-path="apdx-vba.html"><a href="apdx-vba.html#error-handling"><i class="fa fa-check"></i><b>E.2</b> Error handling</a></li>
<li class="chapter" data-level="E.3" data-path="apdx-vba.html"><a href="apdx-vba.html#vba-course-procedures"><i class="fa fa-check"></i><b>E.3</b> Course procedures</a>
<ul>
<li class="chapter" data-level="E.3.1" data-path="apdx-vba.html"><a href="apdx-vba.html#detailed-descriptions-of-course-procedures"><i class="fa fa-check"></i><b>E.3.1</b> Detailed descriptions of course procedures</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="F" data-path="lg-course.html"><a href="lg-course.html"><i class="fa fa-check"></i><b>F</b> Learning goals</a></li>
<li class="chapter" data-level="G" data-path="ba.html"><a href="ba.html"><i class="fa fa-check"></i><b>G</b> Business Analytics</a></li>
<li class="chapter" data-level="H" data-path="colophon.html"><a href="colophon.html"><i class="fa fa-check"></i><b>H</b> Colophon</a></li>
<li class="divider"></li>
<li><center>
  <a rel="license" href="./index.html#ack">
    License: CC BY-NC-SA<br>
    <i class = "fab fa-creative-commons fa-2x"></i>
    <i class = "fab fa-creative-commons-by fa-2x"></i>
    <i class = "fab fa-creative-commons-nc fa-2x"></i>
    <i class = "fab fa-creative-commons-sa fa-2x"></i>
  </a>
</li></center>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tools for Analytics (TFA)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mod-r-maps" class="section level1 hasAnchor" number="16">
<h1><span class="header-section-number">Module 16</span> Spatial data and maps<a href="mod-r-maps.html#mod-r-maps" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Spatial data, also known as geospatial data, is a term used to describe any data related to or containing information about a specific location on a surface (often a map). We will consider <em>distance matrix</em> calculations for finding the shortest distance/travel time between a set of origins and destinations, <em>geocoding</em> which is the process of converting an address to geographic coordinates (latitude, longitude) and <em>reverse geocoding</em> which is the opposite process of converting a location as described by geographic coordinates (latitude, longitude) to a human-readable address or place name. Finally, we consider how to display spatial data on a map.</p>
<div id="lo-maps" class="section level2 hasAnchor" number="16.1">
<h2><span class="header-section-number">16.1</span> Learning outcomes<a href="mod-r-maps.html#lo-maps" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>By the end of this module, you are expected to be able to:</p>
<ul>
<li>Calculate euclidean, manhattan, etc. distances.</li>
<li>Calculate a distance matrix, i.e. shortest paths between places using the Google and Bing API.</li>
<li>Geocode an address using the Google and Bing API.</li>
<li>Add markers and routes (lines) on a map.</li>
</ul>
<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->
</div>
<div id="sec-map-api-key" class="section level2 hasAnchor" number="16.2">
<h2><span class="header-section-number">16.2</span> Services for obtatining spatial data<a href="mod-r-maps.html#sec-map-api-key" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Often you need to connect to a service using an API for obtaining spatial data. The most common is Google and Bing (Microsoft) and to use the services you need an API key. Another service is also <a href="https://developer.here.com/">Here</a>.</p>
<p>If you use Google Maps you can obtain an API key <a href="https://cloud.google.com/maps-platform/">here</a>. Modest to light use is free; however, you need a valid credit card. Note you must enable the APIs you intend to use. Google in fact has several services for geo-related solutions. For example, the Maps Static API provides map images, while the Geocoding API provides geocoding and reverse geocoding services. You need to enable the APIs before you use them. You will only need to do that once, and then they will be ready for you to use. Enabling the APIs just means clicking a few radio buttons on the Google Maps Platform web interface.</p>
<p>We will be using the <strong>ggmap</strong> package for Google services. You can add the API key using:</p>
<div class="sourceCode" id="cb734"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb734-1"><a href="mod-r-maps.html#cb734-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb734-2"><a href="mod-r-maps.html#cb734-2" aria-hidden="true" tabindex="-1"></a><span class="fu">register_google</span>(<span class="at">key =</span> <span class="st">&quot;[your key]&quot;</span>, <span class="at">write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb734-3"><a href="mod-r-maps.html#cb734-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.getenv</span>(<span class="st">&quot;GGMAP_GOOGLE_API_KEY&quot;</span>)</span></code></pre></div>
<p>Note the key is stored in the environment object <code>GGMAP_GOOGLE_API_KEY</code>. Moreover, it is saved in the file <code>.Renviron</code> so that it is automatically reloaded when you restart R.</p>
<p>If you use Bing Maps you can obtain an API key <a href="https://www.bingmapsportal.com/">here</a>. No credit card is needed. You can add the API key using:</p>
<div class="sourceCode" id="cb735"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb735-1"><a href="mod-r-maps.html#cb735-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">edit_r_environ</span>()  <span class="co"># opens the .Renviron file</span></span>
<span id="cb735-2"><a href="mod-r-maps.html#cb735-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">BING_MAPS_API_KEY=</span>[your key]) <span class="co"># so you don&#39;t have to restart R</span></span></code></pre></div>
<p>Add the line <code>BING_MAPS_API_KEY=[your key]</code> and save the file.</p>
<p>Note your API keys is private and unique to you, so be careful not to share it online!</p>
</div>
<div id="calculating-distances" class="section level2 hasAnchor" number="16.3">
<h2><span class="header-section-number">16.3</span> Calculating distances<a href="mod-r-maps.html#calculating-distances" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If you need to calculate euclidean, manhattan, etc. distances, you can use the <code>dist</code> R function:</p>
<div class="sourceCode" id="cb736"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb736-1"><a href="mod-r-maps.html#cb736-1" aria-hidden="true" tabindex="-1"></a>coord <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>, <span class="dv">0</span>,<span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>, <span class="dv">1</span>,<span class="dv">1</span>), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb736-2"><a href="mod-r-maps.html#cb736-2" aria-hidden="true" tabindex="-1"></a>coord</span>
<span id="cb736-3"><a href="mod-r-maps.html#cb736-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2]</span></span>
<span id="cb736-4"><a href="mod-r-maps.html#cb736-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]    0    0</span></span>
<span id="cb736-5"><a href="mod-r-maps.html#cb736-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]    0    1</span></span>
<span id="cb736-6"><a href="mod-r-maps.html#cb736-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,]    1    0</span></span>
<span id="cb736-7"><a href="mod-r-maps.html#cb736-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,]    1    1</span></span>
<span id="cb736-8"><a href="mod-r-maps.html#cb736-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dist</span>(coord)</span>
<span id="cb736-9"><a href="mod-r-maps.html#cb736-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      1    2    3</span></span>
<span id="cb736-10"><a href="mod-r-maps.html#cb736-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 1.00          </span></span>
<span id="cb736-11"><a href="mod-r-maps.html#cb736-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 1.00 1.41     </span></span>
<span id="cb736-12"><a href="mod-r-maps.html#cb736-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 1.41 1.00 1.00</span></span>
<span id="cb736-13"><a href="mod-r-maps.html#cb736-13" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(<span class="fu">dist</span>(coord))</span>
<span id="cb736-14"><a href="mod-r-maps.html#cb736-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      1    2    3    4</span></span>
<span id="cb736-15"><a href="mod-r-maps.html#cb736-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0.00 1.00 1.00 1.41</span></span>
<span id="cb736-16"><a href="mod-r-maps.html#cb736-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 1.00 0.00 1.41 1.00</span></span>
<span id="cb736-17"><a href="mod-r-maps.html#cb736-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 1.00 1.41 0.00 1.00</span></span>
<span id="cb736-18"><a href="mod-r-maps.html#cb736-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 1.41 1.00 1.00 0.00</span></span></code></pre></div>
<p>However, euclidean distances are often a poor approximation of shortest path lengths.</p>
<div id="using-google-maps" class="section level3 hasAnchor" number="16.3.1">
<h3><span class="header-section-number">16.3.1</span> Using Google Maps<a href="mod-r-maps.html#using-google-maps" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Remember to have <a href="mod-r-maps.html#sec-map-api-key">set your API key</a> and activate the <em>Distance Matrix API</em> service on the Google Cloud Platform. We consider the following places:</p>
<div class="sourceCode" id="cb737"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb737-1"><a href="mod-r-maps.html#cb737-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb737-2"><a href="mod-r-maps.html#cb737-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb737-3"><a href="mod-r-maps.html#cb737-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb737-4"><a href="mod-r-maps.html#cb737-4" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>Id,              <span class="sc">~</span>Shop,                                        <span class="sc">~</span>Address,</span>
<span id="cb737-5"><a href="mod-r-maps.html#cb737-5" aria-hidden="true" tabindex="-1"></a>       1L,    <span class="st">&quot;Bilka Esbjerg&quot;</span>,          <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>,</span>
<span id="cb737-6"><a href="mod-r-maps.html#cb737-6" aria-hidden="true" tabindex="-1"></a>       2L,    <span class="st">&quot;Bilka Herning&quot;</span>,              <span class="st">&quot;Golfvej 5, 7400 Herning, Denmark&quot;</span>,</span>
<span id="cb737-7"><a href="mod-r-maps.html#cb737-7" aria-hidden="true" tabindex="-1"></a>       3L,   <span class="st">&quot;Bilka Hillerød&quot;</span>,     <span class="st">&quot;Slotsarkaderne 26, 3400 Hillerød, Denmark&quot;</span>,</span>
<span id="cb737-8"><a href="mod-r-maps.html#cb737-8" aria-hidden="true" tabindex="-1"></a>       4L,   <span class="st">&quot;Bilka Hjørring&quot;</span>,  <span class="st">&quot;A.F Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>,</span>
<span id="cb737-9"><a href="mod-r-maps.html#cb737-9" aria-hidden="true" tabindex="-1"></a>       5L,  <span class="st">&quot;Bilka Holstebro&quot;</span>,         <span class="st">&quot;Nyholmvej 20, 7500 Holstebro, Denmark&quot;</span>,</span>
<span id="cb737-10"><a href="mod-r-maps.html#cb737-10" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb737-11"><a href="mod-r-maps.html#cb737-11" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb737-12"><a href="mod-r-maps.html#cb737-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 3</span></span>
<span id="cb737-13"><a href="mod-r-maps.html#cb737-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Id Shop            Address                                     </span></span>
<span id="cb737-14"><a href="mod-r-maps.html#cb737-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;                                       </span></span>
<span id="cb737-15"><a href="mod-r-maps.html#cb737-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark        </span></span>
<span id="cb737-16"><a href="mod-r-maps.html#cb737-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark            </span></span>
<span id="cb737-17"><a href="mod-r-maps.html#cb737-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark   </span></span>
<span id="cb737-18"><a href="mod-r-maps.html#cb737-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark</span></span>
<span id="cb737-19"><a href="mod-r-maps.html#cb737-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark</span></span></code></pre></div>
<p>To calculate a distance matrix we use the <code>mapdist</code> function:</p>
<div class="sourceCode" id="cb738"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb738-1"><a href="mod-r-maps.html#cb738-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mapdist</span>(<span class="at">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb738-2"><a href="mod-r-maps.html#cb738-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">to =</span> <span class="st">&quot;Golfvej 5, 7400 Herning, Denmark&quot;</span>)</span>
<span id="cb738-3"><a href="mod-r-maps.html#cb738-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 9</span></span>
<span id="cb738-4"><a href="mod-r-maps.html#cb738-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   from                                 to                  m    km miles seconds minutes hours mode </span></span>
<span id="cb738-5"><a href="mod-r-maps.html#cb738-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span id="cb738-6"><a href="mod-r-maps.html#cb738-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark Golfvej 5, 740… 85640  85.6  53.2    4444    74.1  1.23 driv…</span></span></code></pre></div>
<p>Note Google returns results for the fastest path between the two points. Let us try to define a function which calculate all the distances:</p>
<div class="sourceCode" id="cb739"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb739-1"><a href="mod-r-maps.html#cb739-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calculate the distance matrix in long format.</span></span>
<span id="cb739-2"><a href="mod-r-maps.html#cb739-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb739-3"><a href="mod-r-maps.html#cb739-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param address A vector of addresses.</span></span>
<span id="cb739-4"><a href="mod-r-maps.html#cb739-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param mode Driving, bicycling, walking, or transit.</span></span>
<span id="cb739-5"><a href="mod-r-maps.html#cb739-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param symmetric Use symmetric distances (half the number of queries).</span></span>
<span id="cb739-6"><a href="mod-r-maps.html#cb739-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A data frame with the results</span></span>
<span id="cb739-7"><a href="mod-r-maps.html#cb739-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @note The API returns results for the fastest route.  </span></span>
<span id="cb739-8"><a href="mod-r-maps.html#cb739-8" aria-hidden="true" tabindex="-1"></a>goo_calc_distances <span class="ot">&lt;-</span> <span class="cf">function</span>(address, <span class="at">mode =</span> <span class="st">&quot;driving&quot;</span>, <span class="at">symmetric =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb739-9"><a href="mod-r-maps.html#cb739-9" aria-hidden="true" tabindex="-1"></a>   datDist <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">id_from =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(address), <span class="at">id_to =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(address))</span>
<span id="cb739-10"><a href="mod-r-maps.html#cb739-10" aria-hidden="true" tabindex="-1"></a>   datDist <span class="ot">&lt;-</span> datDist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(id_from <span class="sc">!=</span> id_to)</span>
<span id="cb739-11"><a href="mod-r-maps.html#cb739-11" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (symmetric) datDist <span class="ot">&lt;-</span> datDist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(id_from <span class="sc">&lt;</span> id_to)</span>
<span id="cb739-12"><a href="mod-r-maps.html#cb739-12" aria-hidden="true" tabindex="-1"></a>   datDist <span class="ot">&lt;-</span> datDist <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">from =</span> address[id_from], <span class="at">to =</span> address[id_to])</span>
<span id="cb739-13"><a href="mod-r-maps.html#cb739-13" aria-hidden="true" tabindex="-1"></a>   res <span class="ot">&lt;-</span> <span class="fu">mapdist</span>(<span class="at">from =</span> datDist <span class="sc">%&gt;%</span> <span class="fu">pull</span>(from), <span class="at">to =</span> datDist <span class="sc">%&gt;%</span> <span class="fu">pull</span>(to), <span class="at">mode =</span> mode)</span>
<span id="cb739-14"><a href="mod-r-maps.html#cb739-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(<span class="fu">left_join</span>(datDist, res, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;from&quot;</span>, <span class="st">&quot;to&quot;</span>)))</span>
<span id="cb739-15"><a href="mod-r-maps.html#cb739-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb739-16"><a href="mod-r-maps.html#cb739-16" aria-hidden="true" tabindex="-1"></a>datDistGoo <span class="ot">&lt;-</span> <span class="fu">goo_calc_distances</span>(dat<span class="sc">$</span>Address)</span>
<span id="cb739-17"><a href="mod-r-maps.html#cb739-17" aria-hidden="true" tabindex="-1"></a>datDistGoo</span>
<span id="cb739-18"><a href="mod-r-maps.html#cb739-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 11</span></span>
<span id="cb739-19"><a href="mod-r-maps.html#cb739-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    id_from id_to from                           to         m    km miles seconds minutes hours mode </span></span>
<span id="cb739-20"><a href="mod-r-maps.html#cb739-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      &lt;int&gt; &lt;int&gt; &lt;chr&gt;                          &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span id="cb739-21"><a href="mod-r-maps.html#cb739-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1       1     2 Stormgade 157, 6715 Esbjerg, … Golf…  85640  85.6  53.2    4444    74.1 1.23  driv…</span></span>
<span id="cb739-22"><a href="mod-r-maps.html#cb739-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2       1     3 Stormgade 157, 6715 Esbjerg, … Slot… 320932 321.  199.    11790   196.  3.28  driv…</span></span>
<span id="cb739-23"><a href="mod-r-maps.html#cb739-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3       1     4 Stormgade 157, 6715 Esbjerg, … A.F … 322069 322.  200.    11400   190   3.17  driv…</span></span>
<span id="cb739-24"><a href="mod-r-maps.html#cb739-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4       1     5 Stormgade 157, 6715 Esbjerg, … Nyho… 103723 104.   64.5    5307    88.4 1.47  driv…</span></span>
<span id="cb739-25"><a href="mod-r-maps.html#cb739-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5       2     3 Golfvej 5, 7400 Herning, Denm… Slot… 332491 332.  207.    12185   203.  3.38  driv…</span></span>
<span id="cb739-26"><a href="mod-r-maps.html#cb739-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6       2     4 Golfvej 5, 7400 Herning, Denm… A.F … 176041 176.  109.     7814   130.  2.17  driv…</span></span>
<span id="cb739-27"><a href="mod-r-maps.html#cb739-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7       2     5 Golfvej 5, 7400 Herning, Denm… Nyho…  44030  44.0  27.4    1833    30.6 0.509 driv…</span></span>
<span id="cb739-28"><a href="mod-r-maps.html#cb739-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8       3     4 Slotsarkaderne 26, 3400 Hille… A.F … 354231 354.  220.    17124   285.  4.76  driv…</span></span>
<span id="cb739-29"><a href="mod-r-maps.html#cb739-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9       3     5 Slotsarkaderne 26, 3400 Hille… Nyho… 373749 374.  232.    13746   229.  3.82  driv…</span></span>
<span id="cb739-30"><a href="mod-r-maps.html#cb739-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10       4     5 A.F Heidemannsvej 20, 9800 Hj… Nyho… 181226 181.  113.     7794   130.  2.16  driv…</span></span></code></pre></div>
<p>Note that only the calculated distances are returned. If you want to have the whole distance matrix we define function:</p>
<div class="sourceCode" id="cb740"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb740-1"><a href="mod-r-maps.html#cb740-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Convert the data frame returned from calling a `___calc_distances` function to a distance matrix.</span></span>
<span id="cb740-2"><a href="mod-r-maps.html#cb740-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb740-3"><a href="mod-r-maps.html#cb740-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param dat The data frame returned from calling `___calc_distances`.</span></span>
<span id="cb740-4"><a href="mod-r-maps.html#cb740-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param value_col The column containing the distances.</span></span>
<span id="cb740-5"><a href="mod-r-maps.html#cb740-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return The distance matrix</span></span>
<span id="cb740-6"><a href="mod-r-maps.html#cb740-6" aria-hidden="true" tabindex="-1"></a>as_dist_matrix <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, value_col) {</span>
<span id="cb740-7"><a href="mod-r-maps.html#cb740-7" aria-hidden="true" tabindex="-1"></a>   lgt <span class="ot">&lt;-</span> <span class="fu">max</span>(dat<span class="sc">$</span>id_from, dat<span class="sc">$</span>id_to)</span>
<span id="cb740-8"><a href="mod-r-maps.html#cb740-8" aria-hidden="true" tabindex="-1"></a>   distanceMat<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow=</span>lgt, <span class="at">ncol =</span> lgt)</span>
<span id="cb740-9"><a href="mod-r-maps.html#cb740-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">diag</span>(distanceMat) <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb740-10"><a href="mod-r-maps.html#cb740-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dat), <span class="cf">function</span>(r) {</span>
<span id="cb740-11"><a href="mod-r-maps.html#cb740-11" aria-hidden="true" tabindex="-1"></a>      distanceMat[dat<span class="sc">$</span>id_from[r], dat<span class="sc">$</span>id_to[r]] <span class="ot">&lt;&lt;-</span> dat[[value_col]][r]</span>
<span id="cb740-12"><a href="mod-r-maps.html#cb740-12" aria-hidden="true" tabindex="-1"></a>   })</span>
<span id="cb740-13"><a href="mod-r-maps.html#cb740-13" aria-hidden="true" tabindex="-1"></a>   idx <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">is.na</span>(distanceMat), <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb740-14"><a href="mod-r-maps.html#cb740-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(idx), <span class="cf">function</span>(r) {</span>
<span id="cb740-15"><a href="mod-r-maps.html#cb740-15" aria-hidden="true" tabindex="-1"></a>      distanceMat[idx[r, <span class="st">&quot;row&quot;</span>], idx[r, <span class="st">&quot;col&quot;</span>]] <span class="ot">&lt;&lt;-</span> distanceMat[idx[r, <span class="st">&quot;col&quot;</span>], idx[r, <span class="st">&quot;row&quot;</span>]]</span>
<span id="cb740-16"><a href="mod-r-maps.html#cb740-16" aria-hidden="true" tabindex="-1"></a>   })</span>
<span id="cb740-17"><a href="mod-r-maps.html#cb740-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(distanceMat)</span>
<span id="cb740-18"><a href="mod-r-maps.html#cb740-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb740-19"><a href="mod-r-maps.html#cb740-19" aria-hidden="true" tabindex="-1"></a><span class="fu">as_dist_matrix</span>(datDistGoo, <span class="st">&quot;km&quot;</span>)  <span class="co"># distances in km</span></span>
<span id="cb740-20"><a href="mod-r-maps.html#cb740-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       [,1]  [,2] [,3] [,4] [,5]</span></span>
<span id="cb740-21"><a href="mod-r-maps.html#cb740-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]   0.0  85.6  321  322  104</span></span>
<span id="cb740-22"><a href="mod-r-maps.html#cb740-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]  85.6   0.0  332  176   44</span></span>
<span id="cb740-23"><a href="mod-r-maps.html#cb740-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] 320.9 332.5    0  354  374</span></span>
<span id="cb740-24"><a href="mod-r-maps.html#cb740-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] 322.1 176.0  354    0  181</span></span>
<span id="cb740-25"><a href="mod-r-maps.html#cb740-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,] 103.7  44.0  374  181    0</span></span>
<span id="cb740-26"><a href="mod-r-maps.html#cb740-26" aria-hidden="true" tabindex="-1"></a><span class="fu">as_dist_matrix</span>(datDistGoo, <span class="st">&quot;seconds&quot;</span>)  <span class="co"># travel time in seconds </span></span>
<span id="cb740-27"><a href="mod-r-maps.html#cb740-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       [,1]  [,2]  [,3]  [,4]  [,5]</span></span>
<span id="cb740-28"><a href="mod-r-maps.html#cb740-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]     0  4444 11790 11400  5307</span></span>
<span id="cb740-29"><a href="mod-r-maps.html#cb740-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]  4444     0 12185  7814  1833</span></span>
<span id="cb740-30"><a href="mod-r-maps.html#cb740-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] 11790 12185     0 17124 13746</span></span>
<span id="cb740-31"><a href="mod-r-maps.html#cb740-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] 11400  7814 17124     0  7794</span></span>
<span id="cb740-32"><a href="mod-r-maps.html#cb740-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,]  5307  1833 13746  7794     0</span></span></code></pre></div>
</div>
<div id="using-bing-maps" class="section level3 hasAnchor" number="16.3.2">
<h3><span class="header-section-number">16.3.2</span> Using Bing Maps<a href="mod-r-maps.html#using-bing-maps" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Remember to have <a href="#mod-map-api-key">set your API key</a>. We first define a <code>bing_mapdist</code> function:</p>
<div class="sourceCode" id="cb741"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb741-1"><a href="mod-r-maps.html#cb741-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb741-2"><a href="mod-r-maps.html#cb741-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Distance between two locations.</span></span>
<span id="cb741-3"><a href="mod-r-maps.html#cb741-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb741-4"><a href="mod-r-maps.html#cb741-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param from From address.</span></span>
<span id="cb741-5"><a href="mod-r-maps.html#cb741-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param to To address.</span></span>
<span id="cb741-6"><a href="mod-r-maps.html#cb741-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param mode Walking, driving or transit.</span></span>
<span id="cb741-7"><a href="mod-r-maps.html#cb741-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param optimize Optimize either `distance` or `time`.</span></span>
<span id="cb741-8"><a href="mod-r-maps.html#cb741-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return</span></span>
<span id="cb741-9"><a href="mod-r-maps.html#cb741-9" aria-hidden="true" tabindex="-1"></a>bing_mapdist <span class="ot">&lt;-</span> <span class="cf">function</span>(from, to, <span class="at">mode =</span> <span class="st">&quot;driving&quot;</span>, <span class="at">optimize =</span> <span class="st">&quot;time&quot;</span>) {</span>
<span id="cb741-10"><a href="mod-r-maps.html#cb741-10" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (<span class="fu">is.data.frame</span>(from)) {</span>
<span id="cb741-11"><a href="mod-r-maps.html#cb741-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">c</span>(<span class="st">&quot;from&quot;</span>, <span class="st">&quot;to&quot;</span>) <span class="sc">%in%</span> <span class="fu">names</span>(from)))</span>
<span id="cb741-12"><a href="mod-r-maps.html#cb741-12" aria-hidden="true" tabindex="-1"></a>     from_to_df <span class="ot">&lt;-</span> from <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">&quot;from&quot;</span>, <span class="st">&quot;to&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb741-13"><a href="mod-r-maps.html#cb741-13" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb741-14"><a href="mod-r-maps.html#cb741-14" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span> {</span>
<span id="cb741-15"><a href="mod-r-maps.html#cb741-15" aria-hidden="true" tabindex="-1"></a>     from_to_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">from =</span> from, <span class="at">to =</span> to)</span>
<span id="cb741-16"><a href="mod-r-maps.html#cb741-16" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb741-17"><a href="mod-r-maps.html#cb741-17" aria-hidden="true" tabindex="-1"></a>   dat <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(from_to_df), <span class="cf">function</span>(r) {</span>
<span id="cb741-18"><a href="mod-r-maps.html#cb741-18" aria-hidden="true" tabindex="-1"></a>      url <span class="ot">&lt;-</span> </span>
<span id="cb741-19"><a href="mod-r-maps.html#cb741-19" aria-hidden="true" tabindex="-1"></a>         <span class="fu">str_c</span>(<span class="st">&quot;http://dev.virtualearth.net/REST/V1/Routes/&quot;</span>, mode, <span class="st">&quot;?wp.0=&quot;</span>, from_to_df<span class="sc">$</span>from[r], <span class="st">&quot;&amp;wp.1=&quot;</span>, from_to_df<span class="sc">$</span>to[r], </span>
<span id="cb741-20"><a href="mod-r-maps.html#cb741-20" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;&amp;optimize=&quot;</span>, optimize, <span class="st">&quot;&amp;ra=excludeItinerary&amp;rpo=None&amp;ig=false&amp;du=km&quot;</span>, </span>
<span id="cb741-21"><a href="mod-r-maps.html#cb741-21" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;&amp;avoid=minimizeTolls&amp;key=&quot;</span>, <span class="fu">Sys.getenv</span>(<span class="st">&quot;BING_MAPS_API_KEY&quot;</span>))</span>
<span id="cb741-22"><a href="mod-r-maps.html#cb741-22" aria-hidden="true" tabindex="-1"></a>      url <span class="ot">&lt;-</span> <span class="fu">URLencode</span>(url)</span>
<span id="cb741-23"><a href="mod-r-maps.html#cb741-23" aria-hidden="true" tabindex="-1"></a>      lst <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(url)</span>
<span id="cb741-24"><a href="mod-r-maps.html#cb741-24" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (lst<span class="sc">$</span>statusCode <span class="sc">!=</span> <span class="dv">200</span>) <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">km =</span> <span class="cn">NA</span>, <span class="at">seconds =</span> <span class="cn">NA</span>, <span class="at">mode =</span> <span class="cn">NA</span>))</span>
<span id="cb741-25"><a href="mod-r-maps.html#cb741-25" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">&lt;-</span> lst<span class="sc">$</span>resourceSets<span class="sc">$</span>resources[[<span class="dv">1</span>]]</span>
<span id="cb741-26"><a href="mod-r-maps.html#cb741-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">km =</span> df<span class="sc">$</span>travelDistance, <span class="at">seconds =</span> df<span class="sc">$</span>travelDuration, <span class="at">mode =</span> df<span class="sc">$</span>travelMode))</span>
<span id="cb741-27"><a href="mod-r-maps.html#cb741-27" aria-hidden="true" tabindex="-1"></a>   })</span>
<span id="cb741-28"><a href="mod-r-maps.html#cb741-28" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(<span class="fu">bind_cols</span>(from_to_df, dat))</span>
<span id="cb741-29"><a href="mod-r-maps.html#cb741-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb741-30"><a href="mod-r-maps.html#cb741-30" aria-hidden="true" tabindex="-1"></a><span class="fu">bing_mapdist</span>(<span class="at">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb741-31"><a href="mod-r-maps.html#cb741-31" aria-hidden="true" tabindex="-1"></a>             <span class="at">to =</span> <span class="st">&quot;A.F Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>)</span>
<span id="cb741-32"><a href="mod-r-maps.html#cb741-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 5</span></span>
<span id="cb741-33"><a href="mod-r-maps.html#cb741-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   from                                 to                                           km seconds mode </span></span>
<span id="cb741-34"><a href="mod-r-maps.html#cb741-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;                                     &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb741-35"><a href="mod-r-maps.html#cb741-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark A.F Heidemannsvej 20, 9800 Hjørring, Den…  322.   10006 Driv…</span></span>
<span id="cb741-36"><a href="mod-r-maps.html#cb741-36" aria-hidden="true" tabindex="-1"></a><span class="fu">bing_mapdist</span>(<span class="at">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb741-37"><a href="mod-r-maps.html#cb741-37" aria-hidden="true" tabindex="-1"></a>             <span class="at">to =</span> <span class="st">&quot;A.F Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>, </span>
<span id="cb741-38"><a href="mod-r-maps.html#cb741-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">optimize =</span> <span class="st">&quot;distance&quot;</span>)</span>
<span id="cb741-39"><a href="mod-r-maps.html#cb741-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 5</span></span>
<span id="cb741-40"><a href="mod-r-maps.html#cb741-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   from                                 to                                           km seconds mode </span></span>
<span id="cb741-41"><a href="mod-r-maps.html#cb741-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;                                     &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb741-42"><a href="mod-r-maps.html#cb741-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark A.F Heidemannsvej 20, 9800 Hjørring, Den…  259.   13366 Driv…</span></span></code></pre></div>
<p>Note we here can get both the shortest and fastest path between two points. Next, we use the <code>bing_mapdist</code> function for calculating distances:</p>
<div class="sourceCode" id="cb742"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb742-1"><a href="mod-r-maps.html#cb742-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calculate the distance matrix in long format.</span></span>
<span id="cb742-2"><a href="mod-r-maps.html#cb742-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb742-3"><a href="mod-r-maps.html#cb742-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param address A vector of addresses.</span></span>
<span id="cb742-4"><a href="mod-r-maps.html#cb742-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param symmetric Use symmetric distances (only half the number of queries).</span></span>
<span id="cb742-5"><a href="mod-r-maps.html#cb742-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param ... Further parameters passed to `bing_mapdist`.</span></span>
<span id="cb742-6"><a href="mod-r-maps.html#cb742-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A data frame with the results</span></span>
<span id="cb742-7"><a href="mod-r-maps.html#cb742-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @note The API returns results for the fastest route.  </span></span>
<span id="cb742-8"><a href="mod-r-maps.html#cb742-8" aria-hidden="true" tabindex="-1"></a>bing_calc_distances <span class="ot">&lt;-</span> <span class="cf">function</span>(address, <span class="at">symmetric =</span> <span class="cn">TRUE</span>, ...) {</span>
<span id="cb742-9"><a href="mod-r-maps.html#cb742-9" aria-hidden="true" tabindex="-1"></a>   datDist <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">id_from =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(address), <span class="at">id_to =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(address))</span>
<span id="cb742-10"><a href="mod-r-maps.html#cb742-10" aria-hidden="true" tabindex="-1"></a>   datDist <span class="ot">&lt;-</span> datDist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(id_from <span class="sc">!=</span> id_to)</span>
<span id="cb742-11"><a href="mod-r-maps.html#cb742-11" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (symmetric) datDist <span class="ot">&lt;-</span> datDist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(id_from <span class="sc">&lt;</span> id_to)</span>
<span id="cb742-12"><a href="mod-r-maps.html#cb742-12" aria-hidden="true" tabindex="-1"></a>   datDist <span class="ot">&lt;-</span> datDist <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">from =</span> address[id_from], <span class="at">to =</span> address[id_to])</span>
<span id="cb742-13"><a href="mod-r-maps.html#cb742-13" aria-hidden="true" tabindex="-1"></a>   res <span class="ot">&lt;-</span> <span class="fu">bing_mapdist</span>(datDist <span class="sc">%&gt;%</span> <span class="fu">select</span>(from, to), ...)</span>
<span id="cb742-14"><a href="mod-r-maps.html#cb742-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(<span class="fu">bind_cols</span>(datDist <span class="sc">%&gt;%</span>  <span class="fu">select</span>(id_from, id_to), res))</span>
<span id="cb742-15"><a href="mod-r-maps.html#cb742-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb742-16"><a href="mod-r-maps.html#cb742-16" aria-hidden="true" tabindex="-1"></a>datDistBing <span class="ot">&lt;-</span> <span class="fu">bing_calc_distances</span>(dat<span class="sc">$</span>Address)</span>
<span id="cb742-17"><a href="mod-r-maps.html#cb742-17" aria-hidden="true" tabindex="-1"></a>datDistBing</span>
<span id="cb742-18"><a href="mod-r-maps.html#cb742-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 7</span></span>
<span id="cb742-19"><a href="mod-r-maps.html#cb742-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    id_from id_to from                                         to                    km seconds mode </span></span>
<span id="cb742-20"><a href="mod-r-maps.html#cb742-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      &lt;int&gt; &lt;int&gt; &lt;chr&gt;                                        &lt;chr&gt;              &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb742-21"><a href="mod-r-maps.html#cb742-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1       1     2 Stormgade 157, 6715 Esbjerg, Denmark         Golfvej 5, 7400 H…  89.9    4239 Driv…</span></span>
<span id="cb742-22"><a href="mod-r-maps.html#cb742-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2       1     3 Stormgade 157, 6715 Esbjerg, Denmark         Slotsarkaderne 26… 322.    10546 Driv…</span></span>
<span id="cb742-23"><a href="mod-r-maps.html#cb742-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3       1     4 Stormgade 157, 6715 Esbjerg, Denmark         A.F Heidemannsvej… 322.    10006 Driv…</span></span>
<span id="cb742-24"><a href="mod-r-maps.html#cb742-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4       1     5 Stormgade 157, 6715 Esbjerg, Denmark         Nyholmvej 20, 750… 104.     5185 Driv…</span></span>
<span id="cb742-25"><a href="mod-r-maps.html#cb742-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5       2     3 Golfvej 5, 7400 Herning, Denmark             Slotsarkaderne 26… 334.    10778 Driv…</span></span>
<span id="cb742-26"><a href="mod-r-maps.html#cb742-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6       2     4 Golfvej 5, 7400 Herning, Denmark             A.F Heidemannsvej… 178.     7540 Driv…</span></span>
<span id="cb742-27"><a href="mod-r-maps.html#cb742-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7       2     5 Golfvej 5, 7400 Herning, Denmark             Nyholmvej 20, 750…  44.2    1819 Driv…</span></span>
<span id="cb742-28"><a href="mod-r-maps.html#cb742-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8       3     4 Slotsarkaderne 26, 3400 Hillerød, Denmark    A.F Heidemannsvej… 378.    16682 Driv…</span></span>
<span id="cb742-29"><a href="mod-r-maps.html#cb742-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9       3     5 Slotsarkaderne 26, 3400 Hillerød, Denmark    Nyholmvej 20, 750… 375.    12156 Driv…</span></span>
<span id="cb742-30"><a href="mod-r-maps.html#cb742-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10       4     5 A.F Heidemannsvej 20, 9800 Hjørring, Denmark Nyholmvej 20, 750… 185.     7770 Driv…</span></span></code></pre></div>
<p>Note in general results from the API services are based on a set of assumptions and hence the results from different services may not be the same. You may use the different services to check if the distances are correct, by checking the results from different services:</p>
<div class="sourceCode" id="cb743"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb743-1"><a href="mod-r-maps.html#cb743-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Difference in minutes</span></span>
<span id="cb743-2"><a href="mod-r-maps.html#cb743-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abs</span>(<span class="fu">as_dist_matrix</span>(datDistGoo, <span class="st">&quot;seconds&quot;</span>) <span class="sc">-</span> <span class="fu">as_dist_matrix</span>(datDistBing, <span class="st">&quot;seconds&quot;</span>))<span class="sc">/</span><span class="dv">60</span></span>
<span id="cb743-3"><a href="mod-r-maps.html#cb743-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       [,1]   [,2]  [,3]  [,4]   [,5]</span></span>
<span id="cb743-4"><a href="mod-r-maps.html#cb743-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]  0.00  3.417 20.73 23.23  2.033</span></span>
<span id="cb743-5"><a href="mod-r-maps.html#cb743-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]  3.42  0.000 23.45  4.57  0.233</span></span>
<span id="cb743-6"><a href="mod-r-maps.html#cb743-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] 20.73 23.450  0.00  7.37 26.500</span></span>
<span id="cb743-7"><a href="mod-r-maps.html#cb743-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] 23.23  4.567  7.37  0.00  0.400</span></span>
<span id="cb743-8"><a href="mod-r-maps.html#cb743-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,]  2.03  0.233 26.50  0.40  0.000</span></span>
<span id="cb743-9"><a href="mod-r-maps.html#cb743-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Km from 1 to 3</span></span>
<span id="cb743-10"><a href="mod-r-maps.html#cb743-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mapdist</span>(<span class="at">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb743-11"><a href="mod-r-maps.html#cb743-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">to =</span> <span class="st">&quot;Slotsarkaderne 26, 3400 Hillerød, Denmark&quot;</span>)</span>
<span id="cb743-12"><a href="mod-r-maps.html#cb743-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 9</span></span>
<span id="cb743-13"><a href="mod-r-maps.html#cb743-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   from                                 to                  m    km miles seconds minutes hours mode </span></span>
<span id="cb743-14"><a href="mod-r-maps.html#cb743-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span id="cb743-15"><a href="mod-r-maps.html#cb743-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark Slotsarkadern… 320932  321.  199.   11790    196.  3.28 driv…</span></span>
<span id="cb743-16"><a href="mod-r-maps.html#cb743-16" aria-hidden="true" tabindex="-1"></a><span class="fu">bing_mapdist</span>(<span class="at">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb743-17"><a href="mod-r-maps.html#cb743-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">to =</span> <span class="st">&quot;Slotsarkaderne 26, 3400 Hillerød, Denmark&quot;</span>)</span>
<span id="cb743-18"><a href="mod-r-maps.html#cb743-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 5</span></span>
<span id="cb743-19"><a href="mod-r-maps.html#cb743-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   from                                 to                                           km seconds mode </span></span>
<span id="cb743-20"><a href="mod-r-maps.html#cb743-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;                                     &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb743-21"><a href="mod-r-maps.html#cb743-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark Slotsarkaderne 26, 3400 Hillerød, Denmark  322.   10546 Driv…</span></span></code></pre></div>
</div>
</div>
<div id="geocoding-and-reverse-geocoding" class="section level2 hasAnchor" number="16.4">
<h2><span class="header-section-number">16.4</span> Geocoding and reverse geocoding<a href="mod-r-maps.html#geocoding-and-reverse-geocoding" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="using-google-maps-1" class="section level3 hasAnchor" number="16.4.1">
<h3><span class="header-section-number">16.4.1</span> Using Google maps<a href="mod-r-maps.html#using-google-maps-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Remember to enable the <em>Geocoding API</em>. To get the coordinates of an address we use the <code>geocode</code> function:</p>
<div class="sourceCode" id="cb744"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb744-1"><a href="mod-r-maps.html#cb744-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geocode</span>(<span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>)</span>
<span id="cb744-2"><a href="mod-r-maps.html#cb744-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span id="cb744-3"><a href="mod-r-maps.html#cb744-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     lon   lat</span></span>
<span id="cb744-4"><a href="mod-r-maps.html#cb744-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb744-5"><a href="mod-r-maps.html#cb744-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  8.46  55.5</span></span></code></pre></div>
<p>We may use <code>mutate_geocode</code> to add the coordinates to a dataset:</p>
<div class="sourceCode" id="cb745"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb745-1"><a href="mod-r-maps.html#cb745-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb745-2"><a href="mod-r-maps.html#cb745-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_geocode</span>(Address)</span>
<span id="cb745-3"><a href="mod-r-maps.html#cb745-3" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb745-4"><a href="mod-r-maps.html#cb745-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 5</span></span>
<span id="cb745-5"><a href="mod-r-maps.html#cb745-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Id Shop            Address                                        lon   lat</span></span>
<span id="cb745-6"><a href="mod-r-maps.html#cb745-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;                                        &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb745-7"><a href="mod-r-maps.html#cb745-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark          8.46  55.5</span></span>
<span id="cb745-8"><a href="mod-r-maps.html#cb745-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark              9.00  56.1</span></span>
<span id="cb745-9"><a href="mod-r-maps.html#cb745-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark    12.3   55.9</span></span>
<span id="cb745-10"><a href="mod-r-maps.html#cb745-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark 10.0   57.4</span></span>
<span id="cb745-11"><a href="mod-r-maps.html#cb745-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark         8.62  56.4</span></span></code></pre></div>
<p>To reverse geocode use the <code>revgeocode</code> function:</p>
<div class="sourceCode" id="cb746"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb746-1"><a href="mod-r-maps.html#cb746-1" aria-hidden="true" tabindex="-1"></a><span class="fu">revgeocode</span>(<span class="fu">c</span>(dat<span class="sc">$</span>lon[<span class="dv">1</span>], dat<span class="sc">$</span>lat[<span class="dv">1</span>]))</span>
<span id="cb746-2"><a href="mod-r-maps.html#cb746-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Stormgade 157, 6715 Esbjerg Kommune, Denmark&quot;</span></span></code></pre></div>
<p>To apply it to the dataset use:</p>
<div class="sourceCode" id="cb747"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb747-1"><a href="mod-r-maps.html#cb747-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb747-2"><a href="mod-r-maps.html#cb747-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">AddressGeoGoo =</span> </span>
<span id="cb747-3"><a href="mod-r-maps.html#cb747-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">map_chr</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(), <span class="cf">function</span>(i) {</span>
<span id="cb747-4"><a href="mod-r-maps.html#cb747-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">revgeocode</span>(<span class="fu">c</span>(<span class="at">lon =</span> lon[i], <span class="at">lat =</span> lat[i]))</span>
<span id="cb747-5"><a href="mod-r-maps.html#cb747-5" aria-hidden="true" tabindex="-1"></a>             }))</span>
<span id="cb747-6"><a href="mod-r-maps.html#cb747-6" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb747-7"><a href="mod-r-maps.html#cb747-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 6</span></span>
<span id="cb747-8"><a href="mod-r-maps.html#cb747-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Id Shop            Address                                        lon   lat AddressGeoGoo      </span></span>
<span id="cb747-9"><a href="mod-r-maps.html#cb747-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;                                        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              </span></span>
<span id="cb747-10"><a href="mod-r-maps.html#cb747-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark          8.46  55.5 Stormgade 157, 671…</span></span>
<span id="cb747-11"><a href="mod-r-maps.html#cb747-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark              9.00  56.1 Golfvej 5, 7400 He…</span></span>
<span id="cb747-12"><a href="mod-r-maps.html#cb747-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark    12.3   55.9 Slotsarkaderne 26,…</span></span>
<span id="cb747-13"><a href="mod-r-maps.html#cb747-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark 10.0   57.4 A F Heidemanns Vej…</span></span>
<span id="cb747-14"><a href="mod-r-maps.html#cb747-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark         8.62  56.4 Nyholmvej 20, 7500…</span></span></code></pre></div>
</div>
<div id="use-bing-maps" class="section level3 hasAnchor" number="16.4.2">
<h3><span class="header-section-number">16.4.2</span> Use Bing Maps<a href="mod-r-maps.html#use-bing-maps" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To get the coordinates of an address we define the <code>bing_geocode</code> function:</p>
<div class="sourceCode" id="cb748"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb748-1"><a href="mod-r-maps.html#cb748-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Geocode addresses</span></span>
<span id="cb748-2"><a href="mod-r-maps.html#cb748-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb748-3"><a href="mod-r-maps.html#cb748-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param address Address(es) to geocode.</span></span>
<span id="cb748-4"><a href="mod-r-maps.html#cb748-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return The coordinates as a data frame.</span></span>
<span id="cb748-5"><a href="mod-r-maps.html#cb748-5" aria-hidden="true" tabindex="-1"></a>bing_geocode <span class="ot">&lt;-</span> <span class="cf">function</span>(address) {</span>
<span id="cb748-6"><a href="mod-r-maps.html#cb748-6" aria-hidden="true" tabindex="-1"></a>   dat <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(address, <span class="cf">function</span>(s) {</span>
<span id="cb748-7"><a href="mod-r-maps.html#cb748-7" aria-hidden="true" tabindex="-1"></a>      url <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;http://dev.virtualearth.net/REST/v1/Locations?q=&quot;</span>, </span>
<span id="cb748-8"><a href="mod-r-maps.html#cb748-8" aria-hidden="true" tabindex="-1"></a>                   s, <span class="st">&quot;&amp;key=&quot;</span>, <span class="fu">Sys.getenv</span>(<span class="st">&quot;BING_MAPS_API_KEY&quot;</span>))</span>
<span id="cb748-9"><a href="mod-r-maps.html#cb748-9" aria-hidden="true" tabindex="-1"></a>      url <span class="ot">&lt;-</span> <span class="fu">URLencode</span>(url)</span>
<span id="cb748-10"><a href="mod-r-maps.html#cb748-10" aria-hidden="true" tabindex="-1"></a>      lst <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(url)</span>
<span id="cb748-11"><a href="mod-r-maps.html#cb748-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (lst<span class="sc">$</span>statusCode <span class="sc">!=</span> <span class="dv">200</span>) <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">lon =</span> <span class="cn">NA</span>, <span class="at">lat =</span> <span class="cn">NA</span>))</span>
<span id="cb748-12"><a href="mod-r-maps.html#cb748-12" aria-hidden="true" tabindex="-1"></a>      v <span class="ot">&lt;-</span> lst<span class="sc">$</span>resourceSets<span class="sc">$</span>resources[[<span class="dv">1</span>]]<span class="sc">$</span>point<span class="sc">$</span>coordinates[[<span class="dv">1</span>]]</span>
<span id="cb748-13"><a href="mod-r-maps.html#cb748-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.null</span>(v)) <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">lon =</span> <span class="cn">NA</span>, <span class="at">lat =</span> <span class="cn">NA</span>))</span>
<span id="cb748-14"><a href="mod-r-maps.html#cb748-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">lon =</span> v[<span class="dv">2</span>], <span class="at">lat =</span> v[<span class="dv">1</span>]))</span>
<span id="cb748-15"><a href="mod-r-maps.html#cb748-15" aria-hidden="true" tabindex="-1"></a>   })</span>
<span id="cb748-16"><a href="mod-r-maps.html#cb748-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(dat)</span>
<span id="cb748-17"><a href="mod-r-maps.html#cb748-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb748-18"><a href="mod-r-maps.html#cb748-18" aria-hidden="true" tabindex="-1"></a><span class="fu">bing_geocode</span>(<span class="st">&quot;A.F. Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>)</span>
<span id="cb748-19"><a href="mod-r-maps.html#cb748-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span id="cb748-20"><a href="mod-r-maps.html#cb748-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     lon   lat</span></span>
<span id="cb748-21"><a href="mod-r-maps.html#cb748-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb748-22"><a href="mod-r-maps.html#cb748-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  10.0  57.4</span></span>
<span id="cb748-23"><a href="mod-r-maps.html#cb748-23" aria-hidden="true" tabindex="-1"></a><span class="fu">bing_geocode</span>(dat<span class="sc">$</span>Address)</span>
<span id="cb748-24"><a href="mod-r-maps.html#cb748-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span id="cb748-25"><a href="mod-r-maps.html#cb748-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     lon   lat</span></span>
<span id="cb748-26"><a href="mod-r-maps.html#cb748-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb748-27"><a href="mod-r-maps.html#cb748-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  8.46  55.5</span></span>
<span id="cb748-28"><a href="mod-r-maps.html#cb748-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  9.00  56.1</span></span>
<span id="cb748-29"><a href="mod-r-maps.html#cb748-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 12.3   55.9</span></span>
<span id="cb748-30"><a href="mod-r-maps.html#cb748-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 10.0   57.4</span></span>
<span id="cb748-31"><a href="mod-r-maps.html#cb748-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  8.62  56.4</span></span></code></pre></div>
<p>We may use <code>bing_mutate_geocode</code> to add the coordinates to a dataset:</p>
<div class="sourceCode" id="cb749"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb749-1"><a href="mod-r-maps.html#cb749-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>lat, <span class="sc">-</span>lon)</span>
<span id="cb749-2"><a href="mod-r-maps.html#cb749-2" aria-hidden="true" tabindex="-1"></a>mutate_bing_geocode <span class="ot">&lt;-</span> <span class="cf">function</span> (data, address, ...) {</span>
<span id="cb749-3"><a href="mod-r-maps.html#cb749-3" aria-hidden="true" tabindex="-1"></a>    adr <span class="ot">&lt;-</span> data[[<span class="fu">deparse</span>(<span class="fu">substitute</span>(Address))]]</span>
<span id="cb749-4"><a href="mod-r-maps.html#cb749-4" aria-hidden="true" tabindex="-1"></a>    gcdf <span class="ot">&lt;-</span> <span class="fu">bing_geocode</span>(adr)</span>
<span id="cb749-5"><a href="mod-r-maps.html#cb749-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(data, gcdf)</span>
<span id="cb749-6"><a href="mod-r-maps.html#cb749-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb749-7"><a href="mod-r-maps.html#cb749-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb749-8"><a href="mod-r-maps.html#cb749-8" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb749-9"><a href="mod-r-maps.html#cb749-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_bing_geocode</span>(Address)</span>
<span id="cb749-10"><a href="mod-r-maps.html#cb749-10" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb749-11"><a href="mod-r-maps.html#cb749-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 6</span></span>
<span id="cb749-12"><a href="mod-r-maps.html#cb749-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Id Shop            Address                                      AddressGeoGoo         lon   lat</span></span>
<span id="cb749-13"><a href="mod-r-maps.html#cb749-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;                                        &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb749-14"><a href="mod-r-maps.html#cb749-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark         Stormgade 157, 671…  8.46  55.5</span></span>
<span id="cb749-15"><a href="mod-r-maps.html#cb749-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark             Golfvej 5, 7400 He…  9.00  56.1</span></span>
<span id="cb749-16"><a href="mod-r-maps.html#cb749-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark    Slotsarkaderne 26,… 12.3   55.9</span></span>
<span id="cb749-17"><a href="mod-r-maps.html#cb749-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark A F Heidemanns Vej… 10.0   57.4</span></span>
<span id="cb749-18"><a href="mod-r-maps.html#cb749-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark        Nyholmvej 20, 7500…  8.62  56.4</span></span></code></pre></div>
<p>To reverse geocode use the <code>bing_revgeocode</code> function:</p>
<div class="sourceCode" id="cb750"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb750-1"><a href="mod-r-maps.html#cb750-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Reverse geocode coordinates</span></span>
<span id="cb750-2"><a href="mod-r-maps.html#cb750-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb750-3"><a href="mod-r-maps.html#cb750-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param coordinates A vector with two elements (lon, lat).</span></span>
<span id="cb750-4"><a href="mod-r-maps.html#cb750-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return The address as a data frame.</span></span>
<span id="cb750-5"><a href="mod-r-maps.html#cb750-5" aria-hidden="true" tabindex="-1"></a>bing_revgeocode <span class="ot">&lt;-</span> <span class="cf">function</span>(coordinates) {</span>
<span id="cb750-6"><a href="mod-r-maps.html#cb750-6" aria-hidden="true" tabindex="-1"></a>   url <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;http://dev.virtualearth.net/REST/v1/Locations/&quot;</span>, </span>
<span id="cb750-7"><a href="mod-r-maps.html#cb750-7" aria-hidden="true" tabindex="-1"></a>                coordinates[<span class="dv">2</span>], <span class="st">&quot;,&quot;</span>, coordinates[<span class="dv">1</span>],</span>
<span id="cb750-8"><a href="mod-r-maps.html#cb750-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;?key=&quot;</span>, <span class="fu">Sys.getenv</span>(<span class="st">&quot;BING_MAPS_API_KEY&quot;</span>))</span>
<span id="cb750-9"><a href="mod-r-maps.html#cb750-9" aria-hidden="true" tabindex="-1"></a>   url <span class="ot">&lt;-</span> <span class="fu">URLencode</span>(url)</span>
<span id="cb750-10"><a href="mod-r-maps.html#cb750-10" aria-hidden="true" tabindex="-1"></a>   lst <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(url)</span>
<span id="cb750-11"><a href="mod-r-maps.html#cb750-11" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (lst<span class="sc">$</span>statusCode <span class="sc">!=</span> <span class="dv">200</span>) <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb750-12"><a href="mod-r-maps.html#cb750-12" aria-hidden="true" tabindex="-1"></a>   v <span class="ot">&lt;-</span> lst<span class="sc">$</span>resourceSets<span class="sc">$</span>resources[[<span class="dv">1</span>]]<span class="sc">$</span>address<span class="sc">$</span>formattedAddress</span>
<span id="cb750-13"><a href="mod-r-maps.html#cb750-13" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (<span class="fu">is.null</span>(v)) <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb750-14"><a href="mod-r-maps.html#cb750-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(v)</span>
<span id="cb750-15"><a href="mod-r-maps.html#cb750-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb750-16"><a href="mod-r-maps.html#cb750-16" aria-hidden="true" tabindex="-1"></a><span class="fu">bing_revgeocode</span>(<span class="fu">c</span>(dat<span class="sc">$</span>lon[<span class="dv">1</span>], dat<span class="sc">$</span>lat[<span class="dv">1</span>]))</span>
<span id="cb750-17"><a href="mod-r-maps.html#cb750-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span></span></code></pre></div>
<p>To apply it to the dataset use:</p>
<div class="sourceCode" id="cb751"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb751-1"><a href="mod-r-maps.html#cb751-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb751-2"><a href="mod-r-maps.html#cb751-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">AddressGeoBing =</span> </span>
<span id="cb751-3"><a href="mod-r-maps.html#cb751-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">map_chr</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(), <span class="cf">function</span>(i) {</span>
<span id="cb751-4"><a href="mod-r-maps.html#cb751-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">bing_revgeocode</span>(<span class="fu">c</span>(<span class="at">lon =</span> lon[i], <span class="at">lat =</span> lat[i]))</span>
<span id="cb751-5"><a href="mod-r-maps.html#cb751-5" aria-hidden="true" tabindex="-1"></a>             }))</span>
<span id="cb751-6"><a href="mod-r-maps.html#cb751-6" aria-hidden="true" tabindex="-1"></a>dat </span>
<span id="cb751-7"><a href="mod-r-maps.html#cb751-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 7</span></span>
<span id="cb751-8"><a href="mod-r-maps.html#cb751-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Id Shop            Address                             AddressGeoGoo   lon   lat AddressGeoBing</span></span>
<span id="cb751-9"><a href="mod-r-maps.html#cb751-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;                               &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;         </span></span>
<span id="cb751-10"><a href="mod-r-maps.html#cb751-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denma… Stormgade 15…  8.46  55.5 Stormgade 157…</span></span>
<span id="cb751-11"><a href="mod-r-maps.html#cb751-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark    Golfvej 5, 7…  9.00  56.1 Golfvej 5, 74…</span></span>
<span id="cb751-12"><a href="mod-r-maps.html#cb751-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, … Slotsarkader… 12.3   55.9 Slotsarkadern…</span></span>
<span id="cb751-13"><a href="mod-r-maps.html#cb751-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørrin… A F Heideman… 10.0   57.4 A F Heidemann…</span></span>
<span id="cb751-14"><a href="mod-r-maps.html#cb751-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denm… Nyholmvej 20…  8.62  56.4 Nyholmvej 20,…</span></span></code></pre></div>
</div>
</div>
<div id="adding-markers-and-routes-to-a-map" class="section level2 hasAnchor" number="16.5">
<h2><span class="header-section-number">16.5</span> Adding markers and routes to a map<a href="mod-r-maps.html#adding-markers-and-routes-to-a-map" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="http://leafletjs.com">Leaflet</a> is an open-source JavaScript library for interactive maps. It’s used by websites ranging from The New York Times and The Washington Post to GitHub and Flickr, as well as GIS specialists like OpenStreetMap, Mapbox, and CartoDB. The <a href="https://rstudio.github.io/leaflet/">leaflet</a> package makes it easy to create Leaflet maps from R.</p>
<p>Note Leaflet is open-source and free so you do not need an API key for making maps. If you would like to use Google maps instead then have a look at the <a href="http://symbolixau.github.io/googleway/">googleway</a> package instead.</p>
<p>First let us create a map with two base layers</p>
<div class="sourceCode" id="cb752"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb752-1"><a href="mod-r-maps.html#cb752-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb752-2"><a href="mod-r-maps.html#cb752-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(htmlwidgets)</span>
<span id="cb752-3"><a href="mod-r-maps.html#cb752-3" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">leaflet</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb752-4"><a href="mod-r-maps.html#cb752-4" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Base maps</span></span>
<span id="cb752-5"><a href="mod-r-maps.html#cb752-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addTiles</span>(<span class="at">group =</span> <span class="st">&quot;Map&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb752-6"><a href="mod-r-maps.html#cb752-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addProviderTiles</span>(<span class="st">&#39;Esri.WorldImagery&#39;</span>, <span class="at">group =</span> <span class="st">&quot;Satelite&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb752-7"><a href="mod-r-maps.html#cb752-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addProviderTiles</span>(<span class="st">&quot;CartoDB.PositronOnlyLabels&quot;</span>, <span class="at">group =</span> <span class="st">&quot;Map&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb752-8"><a href="mod-r-maps.html#cb752-8" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Center and zoom</span></span>
<span id="cb752-9"><a href="mod-r-maps.html#cb752-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">setView</span>(<span class="fl">10.2</span>, <span class="fl">56.2</span>,  <span class="at">zoom =</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb752-10"><a href="mod-r-maps.html#cb752-10" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Layer control</span></span>
<span id="cb752-11"><a href="mod-r-maps.html#cb752-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addLayersControl</span>(</span>
<span id="cb752-12"><a href="mod-r-maps.html#cb752-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">&quot;Map&quot;</span>, <span class="st">&quot;Satelite&quot;</span>),</span>
<span id="cb752-13"><a href="mod-r-maps.html#cb752-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">options =</span> <span class="fu">layersControlOptions</span>(<span class="at">collapsed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb752-14"><a href="mod-r-maps.html#cb752-14" aria-hidden="true" tabindex="-1"></a>   ) </span>
<span id="cb752-15"><a href="mod-r-maps.html#cb752-15" aria-hidden="true" tabindex="-1"></a> m</span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-b5ad398042c8961110b5" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-b5ad398042c8961110b5">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]}],"setView":[[56.2,10.2],7,[]]},"evals":[],"jsHooks":[]}</script>
<p>Next, let us add the places:</p>
<div class="sourceCode" id="cb753"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb753-1"><a href="mod-r-maps.html#cb753-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb753-2"><a href="mod-r-maps.html#cb753-2" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>Id,              <span class="sc">~</span>Shop,                                        <span class="sc">~</span>Address,</span>
<span id="cb753-3"><a href="mod-r-maps.html#cb753-3" aria-hidden="true" tabindex="-1"></a>       1L,    <span class="st">&quot;Bilka Esbjerg&quot;</span>,          <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>,</span>
<span id="cb753-4"><a href="mod-r-maps.html#cb753-4" aria-hidden="true" tabindex="-1"></a>       2L,    <span class="st">&quot;Bilka Herning&quot;</span>,              <span class="st">&quot;Golfvej 5, 7400 Herning, Denmark&quot;</span>,</span>
<span id="cb753-5"><a href="mod-r-maps.html#cb753-5" aria-hidden="true" tabindex="-1"></a>       3L,   <span class="st">&quot;Bilka Hillerød&quot;</span>,     <span class="st">&quot;Slotsarkaderne 26, 3400 Hillerød, Denmark&quot;</span>,</span>
<span id="cb753-6"><a href="mod-r-maps.html#cb753-6" aria-hidden="true" tabindex="-1"></a>       4L,   <span class="st">&quot;Bilka Hjørring&quot;</span>,  <span class="st">&quot;A.F Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>,</span>
<span id="cb753-7"><a href="mod-r-maps.html#cb753-7" aria-hidden="true" tabindex="-1"></a>       5L,  <span class="st">&quot;Bilka Holstebro&quot;</span>,         <span class="st">&quot;Nyholmvej 20, 7500 Holstebro, Denmark&quot;</span>,</span>
<span id="cb753-8"><a href="mod-r-maps.html#cb753-8" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb753-9"><a href="mod-r-maps.html#cb753-9" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate_geocode</span>(Address)</span>
<span id="cb753-10"><a href="mod-r-maps.html#cb753-10" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> m <span class="sc">%&gt;%</span> </span>
<span id="cb753-11"><a href="mod-r-maps.html#cb753-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addMarkers</span>(<span class="sc">~</span>lon, <span class="sc">~</span>lat, <span class="at">popup =</span> <span class="sc">~</span>Address, <span class="at">label =</span> <span class="sc">~</span><span class="fu">str_c</span>(Id, <span class="st">&quot;  - &quot;</span>, Shop), <span class="at">data =</span> dat)</span>
<span id="cb753-12"><a href="mod-r-maps.html#cb753-12" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-905f3624aa3d71bf54d2" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-905f3624aa3d71bf54d2">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.2977779,10.0034953,8.6222409],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.2977779]}},"evals":[],"jsHooks":[]}</script>
<p>To add a line between a set of points use the <code>addPolylines</code> function:</p>
<div class="sourceCode" id="cb754"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb754-1"><a href="mod-r-maps.html#cb754-1" aria-hidden="true" tabindex="-1"></a>routeIds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb754-2"><a href="mod-r-maps.html#cb754-2" aria-hidden="true" tabindex="-1"></a>route <span class="ot">&lt;-</span> dat[routeIds,] </span>
<span id="cb754-3"><a href="mod-r-maps.html#cb754-3" aria-hidden="true" tabindex="-1"></a>m <span class="sc">%&gt;%</span> <span class="fu">addPolylines</span>(<span class="at">lng =</span> <span class="sc">~</span>lon, <span class="at">lat =</span> <span class="sc">~</span>lat, <span class="at">data =</span> route, <span class="at">weight =</span> <span class="dv">2</span>, <span class="at">label =</span> <span class="st">&quot;Route 1&quot;</span>)</span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3ec241557d34f61badf7" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-3ec241557d34f61badf7">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.2977779,10.0034953,8.6222409],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,8.6222409,8.4559613,9.0047956],"lat":[56.1357775,56.3779116,55.5107577,56.1357775]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":2,"opacity":0.5,"fill":false,"fillColor":"#03F","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Route 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.2977779]}},"evals":[],"jsHooks":[]}</script>
<p>A more advanced setup is to use the <code>addFlows</code> function from the <a href="https://github.com/rte-antares-rpackage/leaflet.minicharts">leaflet.minicharts</a> package. First let us define some lines:</p>
<div class="sourceCode" id="cb755"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb755-1"><a href="mod-r-maps.html#cb755-1" aria-hidden="true" tabindex="-1"></a>datLines <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">FromId =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>), <span class="at">ToId =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb755-2"><a href="mod-r-maps.html#cb755-2" aria-hidden="true" tabindex="-1"></a>datLines <span class="ot">&lt;-</span> <span class="fu">left_join</span>(datLines, dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Shop, <span class="sc">-</span>Address), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;FromId&quot;</span> <span class="ot">=</span> <span class="st">&quot;Id&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb755-3"><a href="mod-r-maps.html#cb755-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="st">&quot;FromLat&quot;</span> <span class="ot">=</span> <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;FromLon&quot;</span> <span class="ot">=</span> <span class="st">&quot;lon&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb755-4"><a href="mod-r-maps.html#cb755-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">left_join</span>(dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Shop, <span class="sc">-</span>Address), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;ToId&quot;</span> <span class="ot">=</span> <span class="st">&quot;Id&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb755-5"><a href="mod-r-maps.html#cb755-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="st">&quot;ToLat&quot;</span> <span class="ot">=</span> <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;ToLon&quot;</span> <span class="ot">=</span> <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb755-6"><a href="mod-r-maps.html#cb755-6" aria-hidden="true" tabindex="-1"></a>datLines</span>
<span id="cb755-7"><a href="mod-r-maps.html#cb755-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 6</span></span>
<span id="cb755-8"><a href="mod-r-maps.html#cb755-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   FromId  ToId FromLon FromLat ToLon ToLat</span></span>
<span id="cb755-9"><a href="mod-r-maps.html#cb755-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb755-10"><a href="mod-r-maps.html#cb755-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      2     5    9.00    56.1  8.62  56.4</span></span>
<span id="cb755-11"><a href="mod-r-maps.html#cb755-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2      5     1    8.62    56.4  8.46  55.5</span></span>
<span id="cb755-12"><a href="mod-r-maps.html#cb755-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      1     2    8.46    55.5  9.00  56.1</span></span>
<span id="cb755-13"><a href="mod-r-maps.html#cb755-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4      2     4    9.00    56.1 10.0   57.4</span></span>
<span id="cb755-14"><a href="mod-r-maps.html#cb755-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5      4     3   10.0     57.4 12.3   55.9</span></span>
<span id="cb755-15"><a href="mod-r-maps.html#cb755-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6      3     2   12.3     55.9  9.00  56.1</span></span></code></pre></div>
<p>Note we have a from/to pair in each row. We add the lines to the map:</p>
<div class="sourceCode" id="cb756"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb756-1"><a href="mod-r-maps.html#cb756-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet.minicharts)</span>
<span id="cb756-2"><a href="mod-r-maps.html#cb756-2" aria-hidden="true" tabindex="-1"></a>m <span class="sc">%&gt;%</span> <span class="fu">addFlows</span>(datLines<span class="sc">$</span>FromLon, datLines<span class="sc">$</span>FromLat, datLines<span class="sc">$</span>ToLon, datLines<span class="sc">$</span>ToLat,</span>
<span id="cb756-3"><a href="mod-r-maps.html#cb756-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">flow =</span> <span class="dv">1</span>, <span class="at">maxFlow =</span> <span class="dv">20</span>, <span class="at">opacity =</span> <span class="fl">0.5</span>, <span class="at">popup =</span> <span class="fu">popupArgs</span>(<span class="at">noPopup =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-ef7ddd739d7583e66978" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-ef7ddd739d7583e66978">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.2977779,10.0034953,8.6222409],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addFlows","args":[[{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (10.0034953,57.4440055) -> (12.2977779,55.9290561)","lat0":57.4440055,"lat1":55.9290561,"lng0":10.0034953,"lng1":12.2977779},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (12.2977779,55.9290561) -> (9.0047956,56.1357775)","lat0":55.9290561,"lat1":56.1357775,"lng0":12.2977779,"lng1":9.0047956},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (8.4559613,55.5107577) -> (9.0047956,56.1357775)","lat0":55.5107577,"lat1":56.1357775,"lng0":8.4559613,"lng1":9.0047956},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (8.6222409,56.3779116) -> (8.4559613,55.5107577)","lat0":56.3779116,"lat1":55.5107577,"lng0":8.6222409,"lng1":8.4559613},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (10.0034953,57.4440055)","lat0":56.1357775,"lat1":57.4440055,"lng0":9.0047956,"lng1":10.0034953},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (8.6222409,56.3779116)","lat0":56.1357775,"lat1":56.3779116,"lng0":9.0047956,"lng1":8.6222409},"timeSteps":1}],["1"],null,{"showTitle":true,"showValues":true,"labels":[],"supValues":null,"supLabels":[],"html":null,"noPopup":true,"digits":null},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.2977779]}},"evals":[],"jsHooks":[]}</script>
<p>Let us define a function for adding routes:</p>
<div class="sourceCode" id="cb757"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb757-1"><a href="mod-r-maps.html#cb757-1" aria-hidden="true" tabindex="-1"></a>add_route <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">dat =</span> <span class="cn">NULL</span>, route, <span class="at">solution =</span> <span class="dv">1</span>) {</span>
<span id="cb757-2"><a href="mod-r-maps.html#cb757-2" aria-hidden="true" tabindex="-1"></a>   route_id <span class="ot">=</span> <span class="fu">if_else</span>(<span class="fu">is.null</span>(dat), <span class="dv">1</span>, <span class="fu">max</span>(dat<span class="sc">$</span>RouteId) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb757-3"><a href="mod-r-maps.html#cb757-3" aria-hidden="true" tabindex="-1"></a>   tmp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">From =</span> route[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(route)<span class="sc">-</span><span class="dv">1</span>)], <span class="at">To =</span> route[<span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(route)])</span>
<span id="cb757-4"><a href="mod-r-maps.html#cb757-4" aria-hidden="true" tabindex="-1"></a>   tmp <span class="ot">&lt;-</span> tmp <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Sol =</span> solution, <span class="at">RouteId =</span> route_id)</span>
<span id="cb757-5"><a href="mod-r-maps.html#cb757-5" aria-hidden="true" tabindex="-1"></a>   dat <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(dat, tmp)</span>
<span id="cb757-6"><a href="mod-r-maps.html#cb757-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb757-7"><a href="mod-r-maps.html#cb757-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb757-8"><a href="mod-r-maps.html#cb757-8" aria-hidden="true" tabindex="-1"></a>datLines <span class="ot">&lt;-</span> <span class="fu">add_route</span>(<span class="at">route =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb757-9"><a href="mod-r-maps.html#cb757-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">add_route</span>(<span class="at">route =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb757-10"><a href="mod-r-maps.html#cb757-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">add_route</span>(<span class="at">route =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="at">solution =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb757-11"><a href="mod-r-maps.html#cb757-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">add_route</span>(<span class="at">route =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>), <span class="at">solution =</span> <span class="dv">2</span>)</span>
<span id="cb757-12"><a href="mod-r-maps.html#cb757-12" aria-hidden="true" tabindex="-1"></a>datLines <span class="ot">&lt;-</span> <span class="fu">left_join</span>(datLines, dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Shop, <span class="sc">-</span>Address), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;From&quot;</span> <span class="ot">=</span> <span class="st">&quot;Id&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb757-13"><a href="mod-r-maps.html#cb757-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="st">&quot;FromLat&quot;</span> <span class="ot">=</span> <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;FromLon&quot;</span> <span class="ot">=</span> <span class="st">&quot;lon&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb757-14"><a href="mod-r-maps.html#cb757-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">left_join</span>(dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Shop, <span class="sc">-</span>Address), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;To&quot;</span> <span class="ot">=</span> <span class="st">&quot;Id&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb757-15"><a href="mod-r-maps.html#cb757-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="st">&quot;ToLat&quot;</span> <span class="ot">=</span> <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;ToLon&quot;</span> <span class="ot">=</span> <span class="st">&quot;lon&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb757-16"><a href="mod-r-maps.html#cb757-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">str_c</span>(<span class="st">&quot;Solution &quot;</span>, Sol))</span>
<span id="cb757-17"><a href="mod-r-maps.html#cb757-17" aria-hidden="true" tabindex="-1"></a>datLines</span>
<span id="cb757-18"><a href="mod-r-maps.html#cb757-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 12 × 9</span></span>
<span id="cb757-19"><a href="mod-r-maps.html#cb757-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     From    To   Sol RouteId FromLon FromLat ToLon ToLat group     </span></span>
<span id="cb757-20"><a href="mod-r-maps.html#cb757-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     </span></span>
<span id="cb757-21"><a href="mod-r-maps.html#cb757-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     2     5     1       1    9.00    56.1  8.62  56.4 Solution 1</span></span>
<span id="cb757-22"><a href="mod-r-maps.html#cb757-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     5     1     1       1    8.62    56.4  8.46  55.5 Solution 1</span></span>
<span id="cb757-23"><a href="mod-r-maps.html#cb757-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     1     2     1       1    8.46    55.5  9.00  56.1 Solution 1</span></span>
<span id="cb757-24"><a href="mod-r-maps.html#cb757-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     2     4     1       2    9.00    56.1 10.0   57.4 Solution 1</span></span>
<span id="cb757-25"><a href="mod-r-maps.html#cb757-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     4     3     1       2   10.0     57.4 12.3   55.9 Solution 1</span></span>
<span id="cb757-26"><a href="mod-r-maps.html#cb757-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     3     2     1       2   12.3     55.9  9.00  56.1 Solution 1</span></span>
<span id="cb757-27"><a href="mod-r-maps.html#cb757-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     2     3     2       3    9.00    56.1 12.3   55.9 Solution 2</span></span>
<span id="cb757-28"><a href="mod-r-maps.html#cb757-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     3     1     2       3   12.3     55.9  8.46  55.5 Solution 2</span></span>
<span id="cb757-29"><a href="mod-r-maps.html#cb757-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     1     2     2       3    8.46    55.5  9.00  56.1 Solution 2</span></span>
<span id="cb757-30"><a href="mod-r-maps.html#cb757-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10     2     5     2       4    9.00    56.1  8.62  56.4 Solution 2</span></span>
<span id="cb757-31"><a href="mod-r-maps.html#cb757-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11     5     4     2       4    8.62    56.4 10.0   57.4 Solution 2</span></span>
<span id="cb757-32"><a href="mod-r-maps.html#cb757-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12     4     2     2       4   10.0     57.4  9.00  56.1 Solution 2</span></span></code></pre></div>
<p>A map with Solution 1:</p>
<div class="sourceCode" id="cb758"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb758-1"><a href="mod-r-maps.html#cb758-1" aria-hidden="true" tabindex="-1"></a>col_pal <span class="ot">&lt;-</span> <span class="fu">rainbow</span>(<span class="fu">max</span>(datLines<span class="sc">$</span>RouteId))</span>
<span id="cb758-2"><a href="mod-r-maps.html#cb758-2" aria-hidden="true" tabindex="-1"></a>datP <span class="ot">&lt;-</span> datLines <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sol <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb758-3"><a href="mod-r-maps.html#cb758-3" aria-hidden="true" tabindex="-1"></a>m <span class="sc">%&gt;%</span> <span class="fu">addFlows</span>(datP<span class="sc">$</span>FromLon, datP<span class="sc">$</span>FromLat, datP<span class="sc">$</span>ToLon, datP<span class="sc">$</span>ToLat,</span>
<span id="cb758-4"><a href="mod-r-maps.html#cb758-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">flow =</span> datP<span class="sc">$</span>RouteId, <span class="at">maxThickness =</span> <span class="dv">2</span>, <span class="at">color =</span> col_pal[datP<span class="sc">$</span>RouteId],</span>
<span id="cb758-5"><a href="mod-r-maps.html#cb758-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">opacity =</span> <span class="fl">0.5</span>, <span class="at">popup =</span> <span class="fu">popupArgs</span>(<span class="at">labels =</span> <span class="st">&quot;Route&quot;</span>))</span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-28605dedfe803550afc2" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-28605dedfe803550afc2">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.2977779,10.0034953,8.6222409],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addFlows","args":[[{"dyn":{"color":["#80FF00"],"value":[2]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (10.0034953,57.4440055) -> (12.2977779,55.9290561)","lat0":57.4440055,"lat1":55.9290561,"lng0":10.0034953,"lng1":12.2977779},"timeSteps":1},{"dyn":{"color":["#80FF00"],"value":[2]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (12.2977779,55.9290561) -> (9.0047956,56.1357775)","lat0":55.9290561,"lat1":56.1357775,"lng0":12.2977779,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#FF0000"],"value":[1]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.4559613,55.5107577) -> (9.0047956,56.1357775)","lat0":55.5107577,"lat1":56.1357775,"lng0":8.4559613,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#FF0000"],"value":[1]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.6222409,56.3779116) -> (8.4559613,55.5107577)","lat0":56.3779116,"lat1":55.5107577,"lng0":8.6222409,"lng1":8.4559613},"timeSteps":1},{"dyn":{"color":["#80FF00"],"value":[2]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (10.0034953,57.4440055)","lat0":56.1357775,"lat1":57.4440055,"lng0":9.0047956,"lng1":10.0034953},"timeSteps":1},{"dyn":{"color":["#FF0000"],"value":[1]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (8.6222409,56.3779116)","lat0":56.1357775,"lat1":56.3779116,"lng0":9.0047956,"lng1":8.6222409},"timeSteps":1}],["1"],null,{"showTitle":true,"showValues":true,"labels":["Route"],"supValues":null,"supLabels":[],"html":null,"noPopup":false,"digits":null},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.2977779]}},"evals":[],"jsHooks":[]}</script>
<p>A map with Solution 2:</p>
<div class="sourceCode" id="cb759"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb759-1"><a href="mod-r-maps.html#cb759-1" aria-hidden="true" tabindex="-1"></a>col_pal <span class="ot">&lt;-</span> <span class="fu">rainbow</span>(<span class="fu">max</span>(datLines<span class="sc">$</span>RouteId))</span>
<span id="cb759-2"><a href="mod-r-maps.html#cb759-2" aria-hidden="true" tabindex="-1"></a>datP <span class="ot">&lt;-</span> datLines <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sol <span class="sc">==</span> <span class="dv">2</span>)</span>
<span id="cb759-3"><a href="mod-r-maps.html#cb759-3" aria-hidden="true" tabindex="-1"></a>m <span class="sc">%&gt;%</span> <span class="fu">addFlows</span>(datP<span class="sc">$</span>FromLon, datP<span class="sc">$</span>FromLat, datP<span class="sc">$</span>ToLon, datP<span class="sc">$</span>ToLat,</span>
<span id="cb759-4"><a href="mod-r-maps.html#cb759-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">flow =</span> datP<span class="sc">$</span>RouteId, <span class="at">maxThickness =</span> <span class="dv">2</span>, <span class="at">color =</span> col_pal[datP<span class="sc">$</span>RouteId],</span>
<span id="cb759-5"><a href="mod-r-maps.html#cb759-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">opacity =</span> <span class="fl">0.5</span>, <span class="at">popup =</span> <span class="fu">popupArgs</span>(<span class="at">labels =</span> <span class="st">&quot;Route&quot;</span>))</span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-24c3a48ad13ea6bd1179" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-24c3a48ad13ea6bd1179">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.2977779,10.0034953,8.6222409],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addFlows","args":[[{"dyn":{"color":["#8000FF"],"value":[4]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (10.0034953,57.4440055) -> (9.0047956,56.1357775)","lat0":57.4440055,"lat1":56.1357775,"lng0":10.0034953,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#00FFFF"],"value":[3]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (12.2977779,55.9290561) -> (8.4559613,55.5107577)","lat0":55.9290561,"lat1":55.5107577,"lng0":12.2977779,"lng1":8.4559613},"timeSteps":1},{"dyn":{"color":["#00FFFF"],"value":[3]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.4559613,55.5107577) -> (9.0047956,56.1357775)","lat0":55.5107577,"lat1":56.1357775,"lng0":8.4559613,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#8000FF"],"value":[4]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.6222409,56.3779116) -> (10.0034953,57.4440055)","lat0":56.3779116,"lat1":57.4440055,"lng0":8.6222409,"lng1":10.0034953},"timeSteps":1},{"dyn":{"color":["#00FFFF"],"value":[3]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (12.2977779,55.9290561)","lat0":56.1357775,"lat1":55.9290561,"lng0":9.0047956,"lng1":12.2977779},"timeSteps":1},{"dyn":{"color":["#8000FF"],"value":[4]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (8.6222409,56.3779116)","lat0":56.1357775,"lat1":56.3779116,"lng0":9.0047956,"lng1":8.6222409},"timeSteps":1}],["1"],null,{"showTitle":true,"showValues":true,"labels":["Route"],"supValues":null,"supLabels":[],"html":null,"noPopup":false,"digits":null},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.2977779]}},"evals":[],"jsHooks":[]}</script>
<p>An interactive map with both solutions:</p>
<div class="sourceCode" id="cb760"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb760-1"><a href="mod-r-maps.html#cb760-1" aria-hidden="true" tabindex="-1"></a>mm <span class="ot">&lt;-</span> m</span>
<span id="cb760-2"><a href="mod-r-maps.html#cb760-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(datLines), <span class="cf">function</span>(i) {</span>
<span id="cb760-3"><a href="mod-r-maps.html#cb760-3" aria-hidden="true" tabindex="-1"></a>   tmp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">lat =</span> <span class="fu">c</span>(datLines<span class="sc">$</span>FromLat[i], datLines<span class="sc">$</span>ToLat[i]), <span class="at">lon =</span> <span class="fu">c</span>(datLines<span class="sc">$</span>FromLon[i], datLines<span class="sc">$</span>ToLon[i]))</span>
<span id="cb760-4"><a href="mod-r-maps.html#cb760-4" aria-hidden="true" tabindex="-1"></a>   mm <span class="ot">&lt;&lt;-</span> mm <span class="sc">%&gt;%</span> <span class="fu">addPolylines</span>(<span class="at">lng =</span> <span class="sc">~</span>lon, <span class="at">lat =</span> <span class="sc">~</span>lat, </span>
<span id="cb760-5"><a href="mod-r-maps.html#cb760-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">color =</span> col_pal[datLines<span class="sc">$</span>Sol[i]], <span class="at">group =</span> datLines<span class="sc">$</span>group[i],</span>
<span id="cb760-6"><a href="mod-r-maps.html#cb760-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span> tmp, <span class="at">weight =</span> <span class="dv">2</span>, <span class="at">label =</span> datLines<span class="sc">$</span>group[i])</span>
<span id="cb760-7"><a href="mod-r-maps.html#cb760-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb760-8"><a href="mod-r-maps.html#cb760-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb760-9"><a href="mod-r-maps.html#cb760-9" aria-hidden="true" tabindex="-1"></a>mm <span class="ot">&lt;-</span> mm <span class="sc">%&gt;%</span> </span>
<span id="cb760-10"><a href="mod-r-maps.html#cb760-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Layer control</span></span>
<span id="cb760-11"><a href="mod-r-maps.html#cb760-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addLayersControl</span>(</span>
<span id="cb760-12"><a href="mod-r-maps.html#cb760-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">&quot;Map&quot;</span>, <span class="st">&quot;Satelite&quot;</span>),</span>
<span id="cb760-13"><a href="mod-r-maps.html#cb760-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">overlayGroups =</span> <span class="fu">unique</span>(datLines<span class="sc">$</span>group),</span>
<span id="cb760-14"><a href="mod-r-maps.html#cb760-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">options =</span> <span class="fu">layersControlOptions</span>(<span class="at">collapsed =</span> <span class="cn">FALSE</span>)</span>
<span id="cb760-15"><a href="mod-r-maps.html#cb760-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb760-16"><a href="mod-r-maps.html#cb760-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hideGroup</span>(<span class="fu">unique</span>(datLines<span class="sc">$</span>group)) <span class="sc">%&gt;%</span> </span>
<span id="cb760-17"><a href="mod-r-maps.html#cb760-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showGroup</span>(<span class="st">&quot;Solution 1&quot;</span>)</span>
<span id="cb760-18"><a href="mod-r-maps.html#cb760-18" aria-hidden="true" tabindex="-1"></a>mm</span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-aa47b6a768ea92011453" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-aa47b6a768ea92011453">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.2977779,10.0034953,8.6222409],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,8.6222409],"lat":[56.1357775,56.3779116]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.6222409,8.4559613],"lat":[56.3779116,55.5107577]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.4559613,9.0047956],"lat":[55.5107577,56.1357775]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,10.0034953],"lat":[56.1357775,57.4440055]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[10.0034953,12.2977779],"lat":[57.4440055,55.9290561]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[12.2977779,9.0047956],"lat":[55.9290561,56.1357775]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,12.2977779],"lat":[56.1357775,55.9290561]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[12.2977779,8.4559613],"lat":[55.9290561,55.5107577]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.4559613,9.0047956],"lat":[55.5107577,56.1357775]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,8.6222409],"lat":[56.1357775,56.3779116]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.6222409,10.0034953],"lat":[56.3779116,57.4440055]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[10.0034953,9.0047956],"lat":[57.4440055,56.1357775]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[["Map","Satelite"],["Solution 1","Solution 2"],{"collapsed":false,"autoZIndex":true,"position":"topright"}]},{"method":"hideGroup","args":[["Solution 1","Solution 2"]]},{"method":"showGroup","args":["Solution 1"]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.2977779]}},"evals":[],"jsHooks":[]}</script>
<p>Note unfortunately arrows cannot be shown in this case.</p>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="mod-r-dist-fit.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="groups.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/bss-osca/tfa/edit/master/book/16_r-maps.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

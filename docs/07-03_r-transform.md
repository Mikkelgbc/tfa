---
output: html_document
editor_options: 
  chunk_output_type: console
---



[BSS]: https://bss.au.dk/en/

[course-help]: https://github.com/bss-osca/tfa/issues
[cran]: https://cloud.r-project.org
[cheatsheet-readr]: https://rawgit.com/rstudio/cheatsheets/master/data-import.pdf
[course-welcome-to-the-tidyverse]: https://github.com/rstudio-education/welcome-to-the-tidyverse

[DataCamp]: https://www.datacamp.com/
[datacamp-signup]: https://www.datacamp.com/groups/shared_links/cbaee6c73e7d78549a9e32a900793b2d5491ace1824efc1760a6729735948215
[datacamp-r-intro]: https://learn.datacamp.com/courses/free-introduction-to-r
[datacamp-r-rmarkdown]: https://campus.datacamp.com/courses/reporting-with-rmarkdown
[datacamp-r-communicating]: https://learn.datacamp.com/courses/communicating-with-data-in-the-tidyverse
[datacamp-r-communicating-chap3]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/introduction-to-rmarkdown
[datacamp-r-communicating-chap4]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/customizing-your-rmarkdown-report
[datacamp-r-intermediate]: https://learn.datacamp.com/courses/intermediate-r
[datacamp-r-intermediate-chap1]: https://campus.datacamp.com/courses/intermediate-r/chapter-1-conditionals-and-control-flow
[datacamp-r-intermediate-chap2]: https://campus.datacamp.com/courses/intermediate-r/chapter-2-loops
[datacamp-r-intermediate-chap3]: https://campus.datacamp.com/courses/intermediate-r/chapter-3-functions
[datacamp-r-intermediate-chap4]: https://campus.datacamp.com/courses/intermediate-r/chapter-4-the-apply-family
[datacamp-r-functions]: https://learn.datacamp.com/courses/introduction-to-writing-functions-in-r
[datacamp-r-tidyverse]: https://learn.datacamp.com/courses/introduction-to-the-tidyverse
[datacamp-r-strings]: https://learn.datacamp.com/courses/string-manipulation-with-stringr-in-r
[datacamp-r-dplyr]: https://learn.datacamp.com/courses/data-manipulation-with-dplyr
[datacamp-r-dplyr-bakeoff]: https://learn.datacamp.com/courses/working-with-data-in-the-tidyverse
[datacamp-r-ggplot2-intro]: https://learn.datacamp.com/courses/introduction-to-data-visualization-with-ggplot2
[datacamp-r-ggplot2-intermediate]: https://learn.datacamp.com/courses/intermediate-data-visualization-with-ggplot2
[dplyr-cran]: https://CRAN.R-project.org/package=dplyr
[debug-in-r]: https://rstats.wtf/debugging-r-code.html

[excel-vs-r]: https://www.jessesadler.com/post/excel-vs-r/

[google-form]: https://forms.gle/s39GeDGV9AzAXUo18
[google-grupper]: https://docs.google.com/spreadsheets/d/1DHxthd5AQywAU4Crb3hM9rnog2GqGQYZ2o175SQgn_0/edit?usp=sharing
[GitHub]: https://github.com/
[git-install]: https://git-scm.com/downloads
[github-actions]: https://github.com/features/actions
[github-pages]: https://pages.github.com/

[happy-git]: https://happygitwithr.com
[hg-install-git]: https://happygitwithr.com/install-git.html
[hg-why]: https://happygitwithr.com/big-picture.html#big-picture
[hg-github-reg]: https://happygitwithr.com/github-acct.html#github-acct
[hg-git-install]: https://happygitwithr.com/install-git.html#install-git
[hg-exist-github-first]: https://happygitwithr.com/existing-github-first.html
[hg-exist-github-last]: https://happygitwithr.com/existing-github-last.html
[hg-credential-helper]: https://happygitwithr.com/credential-caching.html
[hypothes.is]: https://web.hypothes.is/

[osca-programme]: https://kandidat.au.dk/en/operationsandsupplychainanalytics/

[Peergrade]: https://peergrade.io
[peergrade-signup]: https://app.peergrade.io/join
[point-and-click]: https://en.wikipedia.org/wiki/Point_and_click
[pkg-bookdown]: https://bookdown.org/yihui/bookdown/
[pkg-openxlsx]: https://ycphs.github.io/openxlsx/index.html
[pkg-ropensci-writexl]: https://docs.ropensci.org/writexl/
[pkg-jsonlite]: https://cran.r-project.org/web/packages/jsonlite/index.html

[R]: https://www.r-project.org
[RStudio]: https://rstudio.com
[rstudio-cloud]: https://rstudio.cloud/spaces/176810/join?access_code=LSGnG2EXTuzSyeYaNXJE77vP33DZUoeMbC0xhfCz
[r-cloud-mod12]: https://rstudio.cloud/spaces/176810/project/2963819
[r-cloud-mod13]: https://rstudio.cloud/spaces/176810/project/3020139
[r-cloud-mod14]: https://rstudio.cloud/spaces/176810/project/3020322
[r-cloud-mod15]: https://rstudio.cloud/spaces/176810/project/3020509
[r-cloud-mod16]: https://rstudio.cloud/spaces/176810/project/3026754
[r-cloud-mod17]: https://rstudio.cloud/spaces/176810/project/3034015
[r-cloud-mod18]: https://rstudio.cloud/spaces/176810/project/3130795
[r-cloud-mod19]: https://rstudio.cloud/spaces/176810/project/3266132
[rstudio-download]: https://rstudio.com/products/rstudio/download/#download
[rstudio-customizing]: https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio
[rstudio-key-shortcuts]: https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts
[rstudio-workbench]: https://www.rstudio.com/wp-content/uploads/2014/04/rstudio-workbench.png
[r-markdown]: https://rmarkdown.rstudio.com/
[ropensci-writexl]: https://docs.ropensci.org/writexl/
[r4ds-pipes]: https://r4ds.had.co.nz/pipes.html
[r4ds-factors]: https://r4ds.had.co.nz/factors.html
[r4ds-strings]: https://r4ds.had.co.nz/strings.html
[r4ds-iteration]: https://r4ds.had.co.nz/iteration.html

[stat-545]: https://stat545.com
[stat-545-functions-part1]: https://stat545.com/functions-part1.html
[stat-545-functions-part2]: https://stat545.com/functions-part2.html
[stat-545-functions-part3]: https://stat545.com/functions-part3.html
[slides-welcome]: https://bss-osca.github.io/tfa/slides/00-tfa_welcome.html
[slides-m1-3]: https://bss-osca.github.io/tfa/slides/01-welcome_r_part.html
[slides-m4-5]: https://bss-osca.github.io/tfa/slides/02-programming.html
[slides-m6-8]: https://bss-osca.github.io/tfa/slides/03-transform.html
[slides-m9]: https://bss-osca.github.io/tfa/slides/04-plot.html
[slides-m83]: https://bss-osca.github.io/tfa/slides/05-joins.html

[tidyverse-main-page]: https://www.tidyverse.org
[tidyverse-packages]: https://www.tidyverse.org/packages/
[tidyverse-core]: https://www.tidyverse.org/packages/#core-tidyverse
[tidyverse-ggplot2]: https://ggplot2.tidyverse.org/
[tidyverse-dplyr]: https://dplyr.tidyverse.org/
[tidyverse-tidyr]: https://tidyr.tidyverse.org/
[tidyverse-readr]: https://readr.tidyverse.org/
[tidyverse-purrr]: https://purrr.tidyverse.org/
[tidyverse-tibble]: https://tibble.tidyverse.org/
[tidyverse-stringr]: https://stringr.tidyverse.org/
[tidyverse-forcats]: https://forcats.tidyverse.org/
[tidyverse-readxl]: https://readxl.tidyverse.org
[tidyverse-googlesheets4]: https://googlesheets4.tidyverse.org/index.html
[tutorial-markdown]: https://commonmark.org/help/tutorial/

[Udemy]: https://www.udemy.com/

[vba-yt-course1]: https://www.youtube.com/playlist?list=PLpOAvcoMay5S_hb2D7iKznLqJ8QG_pde0
[vba-course1-hello]: https://youtu.be/f42OniDWaIo

[vba-yt-course2]: https://www.youtube.com/playlist?list=PL3A6U40JUYCi4njVx59-vaUxYkG0yRO4m
[vba-course2-devel-tab]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-editor]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-project]: https://youtu.be/fp6PTbU7bXo
[vba-course2-devel-properties]: https://youtu.be/ks2QYKAd9Xw
[vba-course2-devel-hello]: https://youtu.be/EQ6tDWBc8G4

[video-install]: https://vimeo.com/415501284
[video-rstudio-intro]: https://vimeo.com/416391353
[video-packages]: https://vimeo.com/416743698
[video-projects]: https://vimeo.com/319318233
[video-r-intro-p1]: https://www.youtube.com/watch?v=vGY5i_J2c-c
[video-r-intro-p2]: https://www.youtube.com/watch?v=w8_XdYI3reU
[video-r-intro-p3]: https://www.youtube.com/watch?v=NuY6jY4qE7I
[video-subsetting]: https://www.youtube.com/watch?v=hWbgqzsQJF0&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10&t=0s
[video-datatypes]: https://www.youtube.com/watch?v=5AQM-yUX9zg&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10
[video-control-structures]: https://www.youtube.com/watch?v=s_h9ruNwI_0
[video-conditional-loops]: https://www.youtube.com/watch?v=2evtsnPaoDg
[video-functions]: https://www.youtube.com/watch?v=ffPeac3BigM
[video-tibble-vs-df]: https://www.youtube.com/watch?v=EBk6PnvE1R4
[video-dplyr]: https://www.youtube.com/watch?v=aywFompr1F4

[wiki-snake-case]: https://en.wikipedia.org/wiki/Snake_case
[wiki-camel-case]: https://en.wikipedia.org/wiki/Camel_case
[wiki-interpreted]: https://en.wikipedia.org/wiki/Interpreted_language
[wiki-literate-programming]: https://en.wikipedia.org/wiki/Literate_programming
[wiki-csv]: https://en.wikipedia.org/wiki/Comma-separated_values
[wiki-json]: https://en.wikipedia.org/wiki/JSON

# Transforming data {#mod-r-transform}

In this module, we consider transformation of data. In general raw data may be messy and need to be structured in a __tidy__ way. Tidying your data means storing it in a structured form suitable for analysis. This is done using a tibble (data frame) where each column is a variable, and each row is an observation. Tidy data is important because the consistent structure lets you focus your struggle on questions about the data.

Given a raw dataset the first step is to clean it and and transform it to a tidy format. Given tidy data, you next often need to __transform__ it. Transformation includes narrowing in on observations of interest (e.g. only observations from a specific year or warehouse), creating new variables based on existing variables (like the cost of using the machine that day given idle time). Together, tidying and transforming are called __wrangling__, because it can be a hard process to get your data in the right form.

In this chapter, you will learn how to work with tibbles using the [dplyr package][tidyverse-dplyr] which is a part of the [tidyverse][tidyverse-main-page]. 

We are all different and you may like different learning styles compared to others. In the learning path diagram, there may be links to alternative online content. Note this is an alternative to the standard learning path that you may use instead. The learning path may also have extra content, that is not a part of syllabus, you can have a look at. 


```{=html}
<div id="htmlwidget-74c772f3ba335c7a7b2a" style="width:100%;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-74c772f3ba335c7a7b2a">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"💡 Transform\\n(dplyr)\", URL = \"#r-transform-tidyverse\", tooltip = \"Working with data in the tidyverse\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"0,2!\"] \n  \"2\" [label = \"📖 Joins\", URL = \"#r-transform-joins\", tooltip = \"Mutating and filtering joins\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"2,2!\"] \n  \"3\" [label = \"💻 Exercises\", URL = \"#ex-r-transform\", tooltip = \"Exercises\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"4,2!\"] \n  \"4\" [label = \"🎬 dplyr\", URL = \"https://www.youtube.com/watch?v=aywFompr1F4\", tooltip = \"Roger Peng provides a good introduction to the dplyr R package\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"-0.75,4!\"] \n  \"5\" [label = \"📖 dplyr\", URL = \"https://bookdown.org/rdpeng/rprogdatascience/managing-data-frames-with-the-dplyr-package.html\", tooltip = \"Chapter 12 in Peng (2018) provides a nice introduction to dplyr\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkOrange4\", pos = \"0.75,4!\"] \n  \"6\" [label = \"💡 Working\\nwith data\", URL = \"https://app.datacamp.com/learn/courses/working-with-data-in-the-tidyverse\", tooltip = \"An alternative interactive DataCamp course is Working with Data in the Tidyverse which may be good to take if you need more training.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"2.5,4!\"] \n  \"7\" [label = \"\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"0.5\", fontname = \"Helvetica\", shape = \"rect\", height = \"1\", width = \"6\", fillcolor = \"#F0F8FF\", pos = \"1.9,-0.09!\"] \n  \"8\" [label = \"Color:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"0.8\", fillcolor = \"#FFFFFE\", pos = \"-0.73,0.25!\"] \n  \"9\" [label = \"mandatory\", URL = \"\", tooltip = \"Mandatory syllabus.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkSeaGreen4\", pos = \"-0.5,-0.15!\"] \n  \"10\" [label = \"alternative\", URL = \"\", tooltip = \"Alternative syllabus if you prefer another learning style.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkOrange4\", pos = \"0.5,-0.15!\"] \n  \"11\" [label = \"extra\", URL = \"\", tooltip = \"Extra learning if you are interested (not part of syllabus).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"PeachPuff3\", pos = \"1.5,-0.15!\"] \n  \"12\" [label = \"Shape:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"1\", fillcolor = \"#FFFFFE\", pos = \"2.7,0.25!\"] \n  \"13\" [label = \"non-interactive\", URL = \"\", tooltip = \"Non-interactive learning content (e.g. reading).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"1\", fillcolor = \"Grey40\", pos = \"3,-0.15!\"] \n  \"14\" [label = \"interactive\", URL = \"\", tooltip = \"Interactive learning content (tutorial, exercises etc.).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"egg\", width = \"1\", fillcolor = \"Grey40\", pos = \"4.25,-0.15!\"] \n\"1\"->\"2\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"4\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"5\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"6\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"3\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"6\" [color = \"black\", arrowhead = \"vee\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
```

<!-- * Roger Peng provides a good video giving an [Introduction to the dplyr R package][video-dplyr].  -->
<!-- * [Chapter 12](https://bookdown.org/rdpeng/rprogdatascience/managing-data-frames-with-the-dplyr-package.html) in @rdpeng provides a nice introduction to dplyr.  -->
<!-- * An alternative interactive DataCamp course is [Working with Data in the Tidyverse][datacamp-r-dplyr-bakeoff] which may be good to take if you need more training. -->



## Learning outcomes {#lo-r-transform}

By the end of this module, you are expected to be able to:

* Describe what tidy and wangling is.
* Apply the most common string functions.
* Apply tidy operations to data.
* Transform data.
* Clean data.

The learning outcomes relate to the [overall learning goals](#lg-course) number 7, 11-14 and 18 of the course.

<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->


## Working with data in the tidyverse {#r-transform-tidyverse}

An excellent introduction on how to transform data using the tidyverse is given in the interactive DataCamp course [Data Manipulation with dplyr][datacamp-r-dplyr]. Please complete the course before continuing. 

<!-- ## Tidy  -->


<!-- ## Wangling -->


<!-- https://learn.datacamp.com/projects/758 -->
<!-- https://learn.datacamp.com/courses/dealing-with-missing-data-in-r -->
<!-- https://learn.datacamp.com/courses/introduction-to-the-tidyverse -->


## Mutating joins {#r-transform-joins}

Mutating joins allow you to combine variables from multiple tables. There are four types of mutating join, which differ in their behavior when a match is not found. We'll illustrate each with a simple example:


```r
df1 <- tibble(x = c(1, 2), y = 2:1)
df2 <- tibble(x = c(3, 1), a = 10, b = "a")
df1
#> # A tibble: 2 × 2
#>       x     y
#>   <dbl> <int>
#> 1     1     2
#> 2     2     1
df2
#> # A tibble: 2 × 3
#>       x     a b    
#>   <dbl> <dbl> <chr>
#> 1     3    10 a    
#> 2     1    10 a
```

Note that column `x` is present in both tables and used when joining them.

  * `inner_join(df1, df2)` only includes observations that match in both `df1` and `df2`.
    
    
    ```r
    df1 %>% 
      inner_join(df2) 
    #> # A tibble: 1 × 4
    #>       x     y     a b    
    #>   <dbl> <int> <dbl> <chr>
    #> 1     1     2    10 a
    ```
    
  * `left_join(df1, df2)` includes all observations in `df1`, regardless of whether
    they match or not. This is the most commonly used join because it ensures 
    that you don't lose observations from your primary table.
  
    
    ```r
    df1 %>% 
      left_join(df2)
    #> # A tibble: 2 × 4
    #>       x     y     a b    
    #>   <dbl> <int> <dbl> <chr>
    #> 1     1     2    10 a    
    #> 2     2     1    NA <NA>
    ```
  
  * `right_join(df1, df2)` includes all observations in `df2`. It's equivalent to 
    `left_join(df2, df1)`, but the columns and rows will be ordered differently.
  
    
    ```r
    df1 %>% 
      right_join(df2)
    #> # A tibble: 2 × 4
    #>       x     y     a b    
    #>   <dbl> <int> <dbl> <chr>
    #> 1     1     2    10 a    
    #> 2     3    NA    10 a
    df2 %>% 
      left_join(df1)
    #> # A tibble: 2 × 4
    #>       x     a b         y
    #>   <dbl> <dbl> <chr> <int>
    #> 1     3    10 a        NA
    #> 2     1    10 a         2
    ```

  * `full_join()` includes all observations from `df1` and `df2`.

    
    ```r
    df1 %>% 
      full_join(df2)
    #> # A tibble: 3 × 4
    #>       x     y     a b    
    #>   <dbl> <int> <dbl> <chr>
    #> 1     1     2    10 a    
    #> 2     2     1    NA <NA> 
    #> 3     3    NA    10 a
    ```

The left, right and full joins are collectively know as __outer joins__. When a row doesn't match in an outer join, the new variables are filled in with missing values.

While mutating joins are primarily used to add new variables, they can also generate new observations. If a match is not unique, a join will add all possible combinations (the Cartesian product) of the matching observations:


```r
df1 <- tibble(x = c(1, 1, 2), y = 1:3)
df2 <- tibble(x = c(1, 1, 2), z = c("a", "b", "a"))
df1 %>% 
  left_join(df2)
#> # A tibble: 5 × 3
#>       x     y z    
#>   <dbl> <int> <chr>
#> 1     1     1 a    
#> 2     1     1 b    
#> 3     1     2 a    
#> 4     1     2 b    
#> 5     2     3 a
```

Filtering joins match observations in the same way as mutating joins, but affect the observations, not the variables. There are two types:

* `semi_join(df1, df2)` __keeps__ all observations in `df1` that have a match in `df2`.
* `anti_join(df1, df2)` __drops__ all observations in `df1` that have a match in `df2`.

These are most useful for diagnosing join mismatches. If you're worried about what observations your joins will match, start with a `semi_join()` or `anti_join()`. `semi_join()` and `anti_join()` never duplicate; they only remove observations. 


```r
df1 <- tibble(x = c(1, 1, 3, 4), y = 1:4)
df2 <- tibble(x = c(1, 1, 2), z = c("a", "b", "a"))

# Four rows to start with:
df1 %>% nrow()
#> [1] 4
# And we get four rows after the join
df1 %>% inner_join(df2, by = "x") %>% nrow()
#> [1] 4
# But only two rows actually match
df1 %>% semi_join(df2, by = "x") %>% nrow()
#> [1] 2
```


## Recap {#rc-r-transform}

* We consider transformation of tidy data where data are stored using a tibble (data frame) where each column is a variable, and each row is an observation/case.

* Tidy data is important because the consistent structure lets you focus your struggle on questions about the data. 

* Transformation includes narrowing in on observations of interest (e.g. only observations from a specific year or warehouse), creating new variables based on existing variables (like the cost of using the machine that day given idle time). 

* Tidying and transforming are called wrangling, because it can be a hard process to get your data in the right form.

* The package dplyr provides a consistent set of verbs that helps you solve the most common data manipulation challenges:
   - The `filter` function chooses rows (cases/observations) that meet a specific criteria. 
   - The `select` function chooses columns (variables) based on their names.
   - The `arrange` function reorders the rows. 
   - The `transmute` function adds/modifies columns (variables) and drops existing ones.
   - The `mutate` function adds/modifies columns (variables).
   - The `group_by` function groups variables for groupwise operations.
   - The `ungroup` function removes the current grouping.
   - The `count` function counts rows based on a grouping. 
   - The `summarise` function reduces multiple values down to a single summary.
   - The `distinct` function selects unique/distinct rows.
   - The `pull` function can be used to extract columns as vectors (it is similar to $).
   
* Some nice to know functions to use inside e.g. `summarise` or `mutate` are
   - The `n()` function counts the number of rows in a group.
   - The `n_distinct` counts the number of unique rows in a group.
   - The `first` function considers the first row in a group (remember to order it as needed).
   - The `slice_min` and `slice_max` functions select rows with highest or lowest values of a variable.
   - The `across` function makes it easy to apply the same transformation to multiple columns.
   
* Use `print(n = Inf)` in a pipe to print all rows.

* Use the pipe operator `%>%` to connect operations.  

* Use functions `glimpse`, `tail`, `head`, `View` to have a look at the data.

* The `skim` function in the skimr package provides an approach to summary statistics.

* Use `as.character`, `as.numeric`, etc. to convert data to a different type.

* Use `nrow` and `ncol` functions to get the number of rows and columns of the data.

* The 'Data transformation with dplyr' cheatsheet is very useful. Find the newest version in RStudio **Help > Cheatsheets**.

You may also have a look at the [slides for this module](https://bss-osca.github.io/tfa/slides/07-03_r-transform-slides.html).


## Exercises {#ex-r-transform}

Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the [help page](#help). Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution!

[Link to the project on RStudio Cloud for this module][r-cloud-mod17]. 

### Exercise (gapminder) {#ex-gapminder1}

Use the *exercise R markdown template* to solve this exercise (**File > New File > R Markdown...**, select **From template** and then **TFA Exercise**).

The gapminder data set provides values for life expectancy, GDP per capita, and population, every five years, from 1952 to 2007 for 142 countries. The data can be loaded using the gapminder package:


```r
library(gapminder)
gapminder
#> # A tibble: 1,704 × 6
#>    country     continent  year lifeExp      pop gdpPercap
#>    <fct>       <fct>     <int>   <dbl>    <int>     <dbl>
#>  1 Afghanistan Asia       1952    28.8  8425333      779.
#>  2 Afghanistan Asia       1957    30.3  9240934      821.
#>  3 Afghanistan Asia       1962    32.0 10267083      853.
#>  4 Afghanistan Asia       1967    34.0 11537966      836.
#>  5 Afghanistan Asia       1972    36.1 13079460      740.
#>  6 Afghanistan Asia       1977    38.4 14880372      786.
#>  7 Afghanistan Asia       1982    39.9 12881816      978.
#>  8 Afghanistan Asia       1987    40.8 13867957      852.
#>  9 Afghanistan Asia       1992    41.7 16317921      649.
#> 10 Afghanistan Asia       1997    41.8 22227415      635.
#> # … with 1,694 more rows
```

Let us try to examine the dataset (use pipes `%>%` as much as possible). 


<div class="modal fade bs-example-modal-lg" id="tTYxogXnrRykuwLco2Ai" tabindex="-1" role="dialog" aria-labelledby="tTYxogXnrRykuwLco2Ai-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="tTYxogXnrRykuwLco2Ai-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% glimpse()
#> Rows: 1,704
#> Columns: 6
#> $ country   <fct> "Afghanistan", "Afghanistan", "Afghanistan", "Afghanistan", "Afghanistan", "Afgh…
#> $ continent <fct> Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Europe, …
#> $ year      <int> 1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 1992, 1997, 2002, 2007, 1952, 19…
#> $ lifeExp   <dbl> 28.8, 30.3, 32.0, 34.0, 36.1, 38.4, 39.9, 40.8, 41.7, 41.8, 42.1, 43.8, 55.2, 59…
#> $ pop       <int> 8425333, 9240934, 10267083, 11537966, 13079460, 14880372, 12881816, 13867957, 16…
#> $ gdpPercap <dbl> 779, 821, 853, 836, 740, 786, 978, 852, 649, 635, 727, 975, 1601, 1942, 2313, 27…
gapminder %>% summary()
#>         country        continent        year         lifeExp          pop          
#>  Afghanistan:  12   Africa  :624   Min.   :1952   Min.   :23.6   Min.   :6.00e+04  
#>  Albania    :  12   Americas:300   1st Qu.:1966   1st Qu.:48.2   1st Qu.:2.79e+06  
#>  Algeria    :  12   Asia    :396   Median :1980   Median :60.7   Median :7.02e+06  
#>  Angola     :  12   Europe  :360   Mean   :1980   Mean   :59.5   Mean   :2.96e+07  
#>  Argentina  :  12   Oceania : 24   3rd Qu.:1993   3rd Qu.:70.8   3rd Qu.:1.96e+07  
#>  Australia  :  12                  Max.   :2007   Max.   :82.6   Max.   :1.32e+09  
#>  (Other)    :1632                                                                  
#>    gdpPercap     
#>  Min.   :   241  
#>  1st Qu.:  1202  
#>  Median :  3532  
#>  Mean   :  7215  
#>  3rd Qu.:  9325  
#>  Max.   :113523  
#> 
gapminder %>% tail()
#> # A tibble: 6 × 6
#>   country  continent  year lifeExp      pop gdpPercap
#>   <fct>    <fct>     <int>   <dbl>    <int>     <dbl>
#> 1 Zimbabwe Africa     1982    60.4  7636524      789.
#> 2 Zimbabwe Africa     1987    62.4  9216418      706.
#> 3 Zimbabwe Africa     1992    60.4 10704340      693.
#> 4 Zimbabwe Africa     1997    46.8 11404948      792.
#> 5 Zimbabwe Africa     2002    40.0 11926563      672.
#> 6 Zimbabwe Africa     2007    43.5 12311143      470.
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#tTYxogXnrRykuwLco2Ai">Solution</button>

   (@) Use `glimpse`, `summary` and `tail` to examine the data.

   (@) Use `count` to count the number of
   

<div class="modal fade bs-example-modal-lg" id="gNM2tSahdPvUs22DrqDS" tabindex="-1" role="dialog" aria-labelledby="gNM2tSahdPvUs22DrqDS-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="gNM2tSahdPvUs22DrqDS-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  count(country) %>% 
  nrow()
#> [1] 142
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#gNM2tSahdPvUs22DrqDS">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a) countries, 
       

<div class="modal fade bs-example-modal-lg" id="ljyqnrYbHlfi7nwuFy87" tabindex="-1" role="dialog" aria-labelledby="ljyqnrYbHlfi7nwuFy87-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="ljyqnrYbHlfi7nwuFy87-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  count(continent) %>% 
  nrow()
#> [1] 5
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ljyqnrYbHlfi7nwuFy87">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b) continents,
       

<div class="modal fade bs-example-modal-lg" id="VU8YpvGdi304W1hxhRQt" tabindex="-1" role="dialog" aria-labelledby="VU8YpvGdi304W1hxhRQt-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="VU8YpvGdi304W1hxhRQt-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  count(continent, country) %>% 
  count(continent)     # or
#> # A tibble: 5 × 2
#>   continent     n
#>   <fct>     <int>
#> 1 Africa       52
#> 2 Americas     25
#> 3 Asia         33
#> 4 Europe       30
#> 5 Oceania       2
gapminder %>% 
  distinct(continent, country) %>% 
  count(continent)
#> # A tibble: 5 × 2
#>   continent     n
#>   <fct>     <int>
#> 1 Africa       52
#> 2 Americas     25
#> 3 Asia         33
#> 4 Europe       30
#> 5 Oceania       2
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#VU8YpvGdi304W1hxhRQt">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c) countries per continent. 



   

<div class="modal fade bs-example-modal-lg" id="ddc1Uj3nQV2oQhJuqEzg" tabindex="-1" role="dialog" aria-labelledby="ddc1Uj3nQV2oQhJuqEzg-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="ddc1Uj3nQV2oQhJuqEzg-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  distinct(continent) %>% 
  pull(continent) %>% 
  as.character()
#> [1] "Asia"     "Europe"   "Africa"   "Americas" "Oceania"
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ddc1Uj3nQV2oQhJuqEzg">Solution</button>

<div class="modal fade bs-example-modal-lg" id="B5VeiOaiDnJdyEBFlzIO" tabindex="-1" role="dialog" aria-labelledby="B5VeiOaiDnJdyEBFlzIO-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="B5VeiOaiDnJdyEBFlzIO-title">Hint</h4></div><div class="modal-body">

```r
gapminder %>% 
  distinct(___) %>% 
  pull(___) %>% 
  as.character()
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#B5VeiOaiDnJdyEBFlzIO">Hint</button>

   (@) Retrieve a vector with all distinct continent values.

   
   
   (@) Subset rows to find:
   

<div class="modal fade bs-example-modal-lg" id="xx5D3qRhzRnWLlJtvWe0" tabindex="-1" role="dialog" aria-labelledby="xx5D3qRhzRnWLlJtvWe0-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="xx5D3qRhzRnWLlJtvWe0-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(lifeExp < 29)
#> # A tibble: 2 × 6
#>   country     continent  year lifeExp     pop gdpPercap
#>   <fct>       <fct>     <int>   <dbl>   <int>     <dbl>
#> 1 Afghanistan Asia       1952    28.8 8425333      779.
#> 2 Rwanda      Africa     1992    23.6 7290203      737.
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#xx5D3qRhzRnWLlJtvWe0">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a) all rows with life expectancy less that 29 years,



<div class="modal fade bs-example-modal-lg" id="ghSkp7Vqw7ey65NH2N3M" tabindex="-1" role="dialog" aria-labelledby="ghSkp7Vqw7ey65NH2N3M-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="ghSkp7Vqw7ey65NH2N3M-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(country == "Rwanda", year > 1979)
#> # A tibble: 6 × 6
#>   country continent  year lifeExp     pop gdpPercap
#>   <fct>   <fct>     <int>   <dbl>   <int>     <dbl>
#> 1 Rwanda  Africa     1982    46.2 5507565      882.
#> 2 Rwanda  Africa     1987    44.0 6349365      848.
#> 3 Rwanda  Africa     1992    23.6 7290203      737.
#> 4 Rwanda  Africa     1997    36.1 7212583      590.
#> 5 Rwanda  Africa     2002    43.4 7852401      786.
#> 6 Rwanda  Africa     2007    46.2 8860588      863.
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ghSkp7Vqw7ey65NH2N3M">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b) all rows for Rwanda after year 1979,



<div class="modal fade bs-example-modal-lg" id="SJr88inSmDpqz2YaG9nL" tabindex="-1" role="dialog" aria-labelledby="SJr88inSmDpqz2YaG9nL-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="SJr88inSmDpqz2YaG9nL-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>%  
  filter(country %in% c("Rwanda", "Afghanistan", "France"))
#> # A tibble: 36 × 6
#>    country     continent  year lifeExp      pop gdpPercap
#>    <fct>       <fct>     <int>   <dbl>    <int>     <dbl>
#>  1 Afghanistan Asia       1952    28.8  8425333      779.
#>  2 Afghanistan Asia       1957    30.3  9240934      821.
#>  3 Afghanistan Asia       1962    32.0 10267083      853.
#>  4 Afghanistan Asia       1967    34.0 11537966      836.
#>  5 Afghanistan Asia       1972    36.1 13079460      740.
#>  6 Afghanistan Asia       1977    38.4 14880372      786.
#>  7 Afghanistan Asia       1982    39.9 12881816      978.
#>  8 Afghanistan Asia       1987    40.8 13867957      852.
#>  9 Afghanistan Asia       1992    41.7 16317921      649.
#> 10 Afghanistan Asia       1997    41.8 22227415      635.
#> # … with 26 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#SJr88inSmDpqz2YaG9nL">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c) all rows for Rwanda, Afghanistan or France.



   (@) Select columns 
   

<div class="modal fade bs-example-modal-lg" id="cemJs27wTvdPXpbbFQTQ" tabindex="-1" role="dialog" aria-labelledby="cemJs27wTvdPXpbbFQTQ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="cemJs27wTvdPXpbbFQTQ-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  select(year, lifeExp)
#> # A tibble: 1,704 × 2
#>     year lifeExp
#>    <int>   <dbl>
#>  1  1952    28.8
#>  2  1957    30.3
#>  3  1962    32.0
#>  4  1967    34.0
#>  5  1972    36.1
#>  6  1977    38.4
#>  7  1982    39.9
#>  8  1987    40.8
#>  9  1992    41.7
#> 10  1997    41.8
#> # … with 1,694 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#cemJs27wTvdPXpbbFQTQ">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a) year and life expectancy,
    


<div class="modal fade bs-example-modal-lg" id="8NXORq5ngGQ3Z1mXPCFZ" tabindex="-1" role="dialog" aria-labelledby="8NXORq5ngGQ3Z1mXPCFZ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="8NXORq5ngGQ3Z1mXPCFZ-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  select(country, gdpPercap)
#> # A tibble: 1,704 × 2
#>    country     gdpPercap
#>    <fct>           <dbl>
#>  1 Afghanistan      779.
#>  2 Afghanistan      821.
#>  3 Afghanistan      853.
#>  4 Afghanistan      836.
#>  5 Afghanistan      740.
#>  6 Afghanistan      786.
#>  7 Afghanistan      978.
#>  8 Afghanistan      852.
#>  9 Afghanistan      649.
#> 10 Afghanistan      635.
#> # … with 1,694 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#8NXORq5ngGQ3Z1mXPCFZ">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b) country and GDP per capita.
    
      


<div class="modal fade bs-example-modal-lg" id="gJajKapZVfbtLbECimee" tabindex="-1" role="dialog" aria-labelledby="gJajKapZVfbtLbECimee-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="gJajKapZVfbtLbECimee-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
   filter((gdpPercap > 40000 & continent == "Europe") | (gdpPercap < 400 & continent == "Africa")) %>% 
   # print(n=Inf) %>%   # if want to see the intermediate results
   select(continent, country, gdpPercap) # %>% print(n=Inf)
#> # A tibble: 21 × 3
#>    continent country           gdpPercap
#>    <fct>     <fct>                 <dbl>
#>  1 Africa    Burundi                339.
#>  2 Africa    Burundi                380.
#>  3 Africa    Burundi                355.
#>  4 Africa    Congo, Dem. Rep.       312.
#>  5 Africa    Congo, Dem. Rep.       241.
#>  6 Africa    Congo, Dem. Rep.       278.
#>  7 Africa    Equatorial Guinea      376.
#>  8 Africa    Eritrea                329.
#>  9 Africa    Eritrea                344.
#> 10 Africa    Eritrea                381.
#> # … with 11 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#gJajKapZVfbtLbECimee">Solution</button>

<div class="modal fade bs-example-modal-lg" id="8JBbNXdUrB3V1kfXvyha" tabindex="-1" role="dialog" aria-labelledby="8JBbNXdUrB3V1kfXvyha-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="8JBbNXdUrB3V1kfXvyha-title">Hint</h4></div><div class="modal-body">

```r
gapminder %>% 
   filter((gdpPercap > ___ & continent == ___) | (___)) %>% 
   # print(n=Inf) %>%   # if want to see the intermediate results
   select(continent, ___, ___) # %>% print(n=Inf)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#8JBbNXdUrB3V1kfXvyha">Hint</button>

   (@) Subset your data set to find all rows with GDP per capita greater than 40000 in Europe or with GDP per capita less than 500 in Africa.





<div class="modal fade bs-example-modal-lg" id="toIp3XeVuGCqpn2sEuKD" tabindex="-1" role="dialog" aria-labelledby="toIp3XeVuGCqpn2sEuKD-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="toIp3XeVuGCqpn2sEuKD-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>%
  mutate(gdp = pop * gdpPercap)
#> # A tibble: 1,704 × 7
#>    country     continent  year lifeExp      pop gdpPercap          gdp
#>    <fct>       <fct>     <int>   <dbl>    <int>     <dbl>        <dbl>
#>  1 Afghanistan Asia       1952    28.8  8425333      779.  6567086330.
#>  2 Afghanistan Asia       1957    30.3  9240934      821.  7585448670.
#>  3 Afghanistan Asia       1962    32.0 10267083      853.  8758855797.
#>  4 Afghanistan Asia       1967    34.0 11537966      836.  9648014150.
#>  5 Afghanistan Asia       1972    36.1 13079460      740.  9678553274.
#>  6 Afghanistan Asia       1977    38.4 14880372      786. 11697659231.
#>  7 Afghanistan Asia       1982    39.9 12881816      978. 12598563401.
#>  8 Afghanistan Asia       1987    40.8 13867957      852. 11820990309.
#>  9 Afghanistan Asia       1992    41.7 16317921      649. 10595901589.
#> 10 Afghanistan Asia       1997    41.8 22227415      635. 14121995875.
#> # … with 1,694 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#toIp3XeVuGCqpn2sEuKD">Solution</button>

   (@) Use `mutate` to calculate each country's GDP (population times GDP per capita).



In general GDP numbers are large and abstract. Let us try to calculate relative numbers.



<div class="modal fade bs-example-modal-lg" id="oouaX5iEivIJlSuLA2or" tabindex="-1" role="dialog" aria-labelledby="oouaX5iEivIJlSuLA2or-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="oouaX5iEivIJlSuLA2or-title">Solution</h4></div><div class="modal-body">

```r
mean_dk <- gapminder %>% 
  filter(country == "Denmark") %>% 
  pull(gdpPercap) %>% 
  mean()
dat <- gapminder %>% 
  mutate(gdpPercapRel = gdpPercap/mean_dk)
```


<p>The relative GDP per capita numbers are, in general, well below 1. We see that most of the countries covered by this dataset have substantially lower GDP per capita, relative to Denmark, across the entire time period.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#oouaX5iEivIJlSuLA2or">Solution</button>

<div class="modal fade bs-example-modal-lg" id="1Cn8RmXUDovftowTDc0n" tabindex="-1" role="dialog" aria-labelledby="1Cn8RmXUDovftowTDc0n-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="1Cn8RmXUDovftowTDc0n-title">Hint 2</h4></div><div class="modal-body">

```r
dat <- gapminder %>% 
  mutate(gdpPercapRel = ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#1Cn8RmXUDovftowTDc0n">Hint 2</button>

<div class="modal fade bs-example-modal-lg" id="8CIABPdnZVM8sFncG1Xb" tabindex="-1" role="dialog" aria-labelledby="8CIABPdnZVM8sFncG1Xb-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="8CIABPdnZVM8sFncG1Xb-title">Hint 1</h4></div><div class="modal-body">

```r
mean_dk <- gapminder %>% 
  filter(country == "Denmark") %>% 
  pull(___) %>% 
  mean()
```


<p>First you must calculate the mean of Danish <code>gdpPercap</code> and next use that to add a new column <code>gdpPercapRel</code>.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#8CIABPdnZVM8sFncG1Xb">Hint 1</button>

   (@) Use `mutate` to calculate GDP per capita relative to mean GDP per capita in Denmark over the whole period (`gdpPercap` divided by the mean of Danish `gdpPercap`). Have a look at the calculated data. Does the numbers seem reasonable? I perceive Denmark to be a "high GDP" country, so I predict that the distribution of `gdpPercapRel` is located below 1, possibly even well below. 




   (@) Use `arrange` to order 
   

<div class="modal fade bs-example-modal-lg" id="i4EMy5C0W7DdgCcWKPjg" tabindex="-1" role="dialog" aria-labelledby="i4EMy5C0W7DdgCcWKPjg-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="i4EMy5C0W7DdgCcWKPjg-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  arrange(year, country)
#> # A tibble: 1,704 × 6
#>    country     continent  year lifeExp      pop gdpPercap
#>    <fct>       <fct>     <int>   <dbl>    <int>     <dbl>
#>  1 Afghanistan Asia       1952    28.8  8425333      779.
#>  2 Albania     Europe     1952    55.2  1282697     1601.
#>  3 Algeria     Africa     1952    43.1  9279525     2449.
#>  4 Angola      Africa     1952    30.0  4232095     3521.
#>  5 Argentina   Americas   1952    62.5 17876956     5911.
#>  6 Australia   Oceania    1952    69.1  8691212    10040.
#>  7 Austria     Europe     1952    66.8  6927772     6137.
#>  8 Bahrain     Asia       1952    50.9   120447     9867.
#>  9 Bangladesh  Asia       1952    37.5 46886859      684.
#> 10 Belgium     Europe     1952    68    8730405     8343.
#> # … with 1,694 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#i4EMy5C0W7DdgCcWKPjg">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a) data by year then country, as opposed to current by country then year,



<div class="modal fade bs-example-modal-lg" id="01rwCpZoQ3rRKTv20Ail" tabindex="-1" role="dialog" aria-labelledby="01rwCpZoQ3rRKTv20Ail-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="01rwCpZoQ3rRKTv20Ail-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>%
  filter(year == 2007) %>%
  arrange(lifeExp)
#> # A tibble: 142 × 6
#>    country                  continent  year lifeExp      pop gdpPercap
#>    <fct>                    <fct>     <int>   <dbl>    <int>     <dbl>
#>  1 Swaziland                Africa     2007    39.6  1133066     4513.
#>  2 Mozambique               Africa     2007    42.1 19951656      824.
#>  3 Zambia                   Africa     2007    42.4 11746035     1271.
#>  4 Sierra Leone             Africa     2007    42.6  6144562      863.
#>  5 Lesotho                  Africa     2007    42.6  2012649     1569.
#>  6 Angola                   Africa     2007    42.7 12420476     4797.
#>  7 Zimbabwe                 Africa     2007    43.5 12311143      470.
#>  8 Afghanistan              Asia       2007    43.8 31889923      975.
#>  9 Central African Republic Africa     2007    44.7  4369038      706.
#> 10 Liberia                  Africa     2007    45.7  3193942      415.
#> # … with 132 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#01rwCpZoQ3rRKTv20Ail">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b) data from 2007, sorted on life expectancy,



<div class="modal fade bs-example-modal-lg" id="ZSQxnKTSqBX1xUBZnREZ" tabindex="-1" role="dialog" aria-labelledby="ZSQxnKTSqBX1xUBZnREZ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="ZSQxnKTSqBX1xUBZnREZ-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>%
  filter(year == 2007) %>%
  arrange(desc(lifeExp))
#> # A tibble: 142 × 6
#>    country          continent  year lifeExp       pop gdpPercap
#>    <fct>            <fct>     <int>   <dbl>     <int>     <dbl>
#>  1 Japan            Asia       2007    82.6 127467972    31656.
#>  2 Hong Kong, China Asia       2007    82.2   6980412    39725.
#>  3 Iceland          Europe     2007    81.8    301931    36181.
#>  4 Switzerland      Europe     2007    81.7   7554661    37506.
#>  5 Australia        Oceania    2007    81.2  20434176    34435.
#>  6 Spain            Europe     2007    80.9  40448191    28821.
#>  7 Sweden           Europe     2007    80.9   9031088    33860.
#>  8 Israel           Asia       2007    80.7   6426679    25523.
#>  9 France           Europe     2007    80.7  61083916    30470.
#> 10 Canada           Americas   2007    80.7  33390141    36319.
#> # … with 132 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ZSQxnKTSqBX1xUBZnREZ">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c) data from 2007, sorted on life expectancy in **desc**ending order. Hint: use `desc()` inside `arrange`.
 


   (@) Use `select` to 
   

<div class="modal fade bs-example-modal-lg" id="0JWgJSifrY1htOeWpc5c" tabindex="-1" role="dialog" aria-labelledby="0JWgJSifrY1htOeWpc5c-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="0JWgJSifrY1htOeWpc5c-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  select(yr = year, everything())
#> # A tibble: 1,704 × 6
#>       yr country     continent lifeExp      pop gdpPercap
#>    <int> <fct>       <fct>       <dbl>    <int>     <dbl>
#>  1  1952 Afghanistan Asia         28.8  8425333      779.
#>  2  1957 Afghanistan Asia         30.3  9240934      821.
#>  3  1962 Afghanistan Asia         32.0 10267083      853.
#>  4  1967 Afghanistan Asia         34.0 11537966      836.
#>  5  1972 Afghanistan Asia         36.1 13079460      740.
#>  6  1977 Afghanistan Asia         38.4 14880372      786.
#>  7  1982 Afghanistan Asia         39.9 12881816      978.
#>  8  1987 Afghanistan Asia         40.8 13867957      852.
#>  9  1992 Afghanistan Asia         41.7 16317921      649.
#> 10  1997 Afghanistan Asia         41.8 22227415      635.
#> # … with 1,694 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#0JWgJSifrY1htOeWpc5c">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a) rename `year` to `yr` and keep all other columns (the select helper `everything` may be used),
 
 

<div class="modal fade bs-example-modal-lg" id="wzrfN5mxYyb4eClIk5ph" tabindex="-1" role="dialog" aria-labelledby="wzrfN5mxYyb4eClIk5ph-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="wzrfN5mxYyb4eClIk5ph-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  select(-pop)
#> # A tibble: 1,704 × 5
#>    country     continent  year lifeExp gdpPercap
#>    <fct>       <fct>     <int>   <dbl>     <dbl>
#>  1 Afghanistan Asia       1952    28.8      779.
#>  2 Afghanistan Asia       1957    30.3      821.
#>  3 Afghanistan Asia       1962    32.0      853.
#>  4 Afghanistan Asia       1967    34.0      836.
#>  5 Afghanistan Asia       1972    36.1      740.
#>  6 Afghanistan Asia       1977    38.4      786.
#>  7 Afghanistan Asia       1982    39.9      978.
#>  8 Afghanistan Asia       1987    40.8      852.
#>  9 Afghanistan Asia       1992    41.7      649.
#> 10 Afghanistan Asia       1997    41.8      635.
#> # … with 1,694 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#wzrfN5mxYyb4eClIk5ph">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b) remove `pop`,
  


<div class="modal fade bs-example-modal-lg" id="Bksiobj7llJ5GvK2GPRp" tabindex="-1" role="dialog" aria-labelledby="Bksiobj7llJ5GvK2GPRp-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Bksiobj7llJ5GvK2GPRp-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  select(year, pop, everything())
#> # A tibble: 1,704 × 6
#>     year      pop country     continent lifeExp gdpPercap
#>    <int>    <int> <fct>       <fct>       <dbl>     <dbl>
#>  1  1952  8425333 Afghanistan Asia         28.8      779.
#>  2  1957  9240934 Afghanistan Asia         30.3      821.
#>  3  1962 10267083 Afghanistan Asia         32.0      853.
#>  4  1967 11537966 Afghanistan Asia         34.0      836.
#>  5  1972 13079460 Afghanistan Asia         36.1      740.
#>  6  1977 14880372 Afghanistan Asia         38.4      786.
#>  7  1982 12881816 Afghanistan Asia         39.9      978.
#>  8  1987 13867957 Afghanistan Asia         40.8      852.
#>  9  1992 16317921 Afghanistan Asia         41.7      649.
#> 10  1997 22227415 Afghanistan Asia         41.8      635.
#> # … with 1,694 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Bksiobj7llJ5GvK2GPRp">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c) reorder columns in order `year`, `pop`, ... (remaining).


  (@) Use `group_by` and `summarize` to find the
  
  

<div class="modal fade bs-example-modal-lg" id="euNiOQADETSMIPoD3uF2" tabindex="-1" role="dialog" aria-labelledby="euNiOQADETSMIPoD3uF2-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="euNiOQADETSMIPoD3uF2-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  group_by(continent) %>% 
  summarize(n = n())
#> # A tibble: 5 × 2
#>   continent     n
#>   <fct>     <int>
#> 1 Africa      624
#> 2 Americas    300
#> 3 Asia        396
#> 4 Europe      360
#> 5 Oceania      24
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#euNiOQADETSMIPoD3uF2">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a) number of observations per continent,
     


<div class="modal fade bs-example-modal-lg" id="8cVl7jyLryx41LhmxMPe" tabindex="-1" role="dialog" aria-labelledby="8cVl7jyLryx41LhmxMPe-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="8cVl7jyLryx41LhmxMPe-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  group_by(continent) %>% 
  summarize(n = n(), n_countries = n_distinct(country))
#> # A tibble: 5 × 3
#>   continent     n n_countries
#>   <fct>     <int>       <int>
#> 1 Africa      624          52
#> 2 Americas    300          25
#> 3 Asia        396          33
#> 4 Europe      360          30
#> 5 Oceania      24           2
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#8cVl7jyLryx41LhmxMPe">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b) number of countries per continent (use `n_distinct` inside `summarize` to count the number of distinct observations),



<div class="modal fade bs-example-modal-lg" id="F9NfSPhAFQptaPUZUNbQ" tabindex="-1" role="dialog" aria-labelledby="F9NfSPhAFQptaPUZUNbQ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="F9NfSPhAFQptaPUZUNbQ-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  group_by(continent) %>% 
  summarize(avg_lifeExp = mean(lifeExp))
#> # A tibble: 5 × 2
#>   continent avg_lifeExp
#>   <fct>           <dbl>
#> 1 Africa           48.9
#> 2 Americas         64.7
#> 3 Asia             60.1
#> 4 Europe           71.9
#> 5 Oceania          74.3
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#F9NfSPhAFQptaPUZUNbQ">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c) average life expectancy by continent,
     


<div class="modal fade bs-example-modal-lg" id="CE2PHAoMgtzd3puwjFWg" tabindex="-1" role="dialog" aria-labelledby="CE2PHAoMgtzd3puwjFWg-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="CE2PHAoMgtzd3puwjFWg-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(continent == "Asia") %>% 
  group_by(year) %>% 
  summarize(min_lifeExp = min(lifeExp), max_lifeExp = max(lifeExp))
#> # A tibble: 12 × 3
#>     year min_lifeExp max_lifeExp
#>    <int>       <dbl>       <dbl>
#>  1  1952        28.8        65.4
#>  2  1957        30.3        67.8
#>  3  1962        32.0        69.4
#>  4  1967        34.0        71.4
#>  5  1972        36.1        73.4
#>  6  1977        31.2        75.4
#>  7  1982        39.9        77.1
#>  8  1987        40.8        78.7
#>  9  1992        41.7        79.4
#> 10  1997        41.8        80.7
#> 11  2002        42.1        82  
#> 12  2007        43.8        82.6
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#CE2PHAoMgtzd3puwjFWg">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d) minimum and maximum life expectancies seen by year in Asia.

      


<div class="modal fade bs-example-modal-lg" id="iCjgBTzUxll8thIo08ZR" tabindex="-1" role="dialog" aria-labelledby="iCjgBTzUxll8thIo08ZR-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="iCjgBTzUxll8thIo08ZR-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  group_by(country) %>%                 # group by country
  select(country, year, lifeExp) %>%    # select relevant columns
  arrange(year, .by_group = TRUE) %>%   # make sure that data is sorted correct
  mutate(lifeExp_gain = lifeExp - first(lifeExp)) %>%       
  filter(year < 1963)                   # just for nice printing
#> # A tibble: 426 × 4
#> # Groups:   country [142]
#>    country      year lifeExp lifeExp_gain
#>    <fct>       <int>   <dbl>        <dbl>
#>  1 Afghanistan  1952    28.8         0   
#>  2 Afghanistan  1957    30.3         1.53
#>  3 Afghanistan  1962    32.0         3.20
#>  4 Albania      1952    55.2         0   
#>  5 Albania      1957    59.3         4.05
#>  6 Albania      1962    64.8         9.59
#>  7 Algeria      1952    43.1         0   
#>  8 Algeria      1957    45.7         2.61
#>  9 Algeria      1962    48.3         5.23
#> 10 Angola       1952    30.0         0   
#> # … with 416 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#iCjgBTzUxll8thIo08ZR">Solution</button>

<div class="modal fade bs-example-modal-lg" id="uJmFnilqpYIVyTdcKlZK" tabindex="-1" role="dialog" aria-labelledby="uJmFnilqpYIVyTdcKlZK-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="uJmFnilqpYIVyTdcKlZK-title">Hint</h4></div><div class="modal-body">

```r
gapminder %>% 
  group_by(country) %>%                 # group by country
  select(country, year, lifeExp) %>%    # select relevant columns
  arrange(year, .by_group = TRUE) %>%   # make sure that data is sorted correct
  mutate(lifeExp_gain = ___) %>%        # define new variable
  filter(year < 1963)                   # just for nice printing
```


<p>The <code>first</code> function may be helpful to extract the first value from a vector in each group.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#uJmFnilqpYIVyTdcKlZK">Hint</button>

  (@) Sometimes you do not want to collapse the $n$ rows for each group into one row. That is, you do not want to use `summarize` but `mutate` within your groups. Try to make a new variable that is the years of life expectancy gained (lost) relative to 1952, for each individual country. 
      
      



<div class="modal fade bs-example-modal-lg" id="n1A5Y5lZDR75kSuqQg1Z" tabindex="-1" role="dialog" aria-labelledby="n1A5Y5lZDR75kSuqQg1Z-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="n1A5Y5lZDR75kSuqQg1Z-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>%
  select(country, year, continent, lifeExp) %>%     
  group_by(continent, country) %>%                  
  mutate(le_delta = lifeExp - lag(lifeExp)) %>%
  summarize(worst_le_delta = min(le_delta, na.rm = TRUE)) %>%
  slice_min(worst_le_delta) %>%
  arrange(worst_le_delta)
#> # A tibble: 5 × 3
#> # Groups:   continent [5]
#>   continent country     worst_le_delta
#>   <fct>     <fct>                <dbl>
#> 1 Africa    Rwanda             -20.4  
#> 2 Asia      Cambodia            -9.10 
#> 3 Americas  El Salvador         -1.51 
#> 4 Europe    Montenegro          -1.46 
#> 5 Oceania   Australia            0.170
```


<p>Mostly you are seeing what genocide looks like in dry statistics on average life expectancy.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#n1A5Y5lZDR75kSuqQg1Z">Solution</button>

<div class="modal fade bs-example-modal-lg" id="0ksT0YORpuQbCIhmTPpa" tabindex="-1" role="dialog" aria-labelledby="0ksT0YORpuQbCIhmTPpa-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="0ksT0YORpuQbCIhmTPpa-title">Hint</h4></div><div class="modal-body">

```r
gapminder %>%
  select(country, year, continent, lifeExp) %>%             # select relevant columns
  group_by(continent, country) %>%                          # group
  mutate(le_delta = ___) %>%                                # within country, take (lifeExp in year i) - (lifeExp in year i - 1)
  summarize(worst_le_delta = min(___, na.rm = TRUE)) %>%    # find lowest value
  slice_min(worst_le_delta) %>%                             # find min in each continent
  arrange(worst_le_delta)                                   # arrange 
```


<p>The <code>lag</code> function is useful to select the value in the previous row. Positive values of <code>le_delta</code> means lifeExp went up, negative means it went down. Break the code into pieces, starting at the top, and inspect the intermediate results. These commands are built up gradually, with lots of errors and refinements along the way.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#0ksT0YORpuQbCIhmTPpa">Hint</button>
      
  (@) Which country experienced the sharpest 5-year drop in life expectancy in each continent? Recall that the Gapminder data only has data every five years, e.g. for 1952, 1957, etc. So this really means looking at life expectancy changes between adjacent timepoints. 

      
      



### Exercise (babynames) {#ex-babynames1}

Use the *exercise R markdown template* to solve this exercise (**File > New File > R Markdown...**, select **From template** and then **TFA Exercise**).

The package babynames contains the dataset `babynames` provided by the U.S. Social Security Administration. For each year from 1880 to 2017, the number of children of each sex given each name. All names with more than 5 uses are given (source: http://www.ssa.gov/oact/babynames/limits.html).

Install it using 

```r
install.packages("babynames")
```

We will use the skimr package to get an overview over `babynames`:


```r
library(babynames)
library(skimr)
skim(babynames)
```


Table: (\#tab:unnamed-chunk-42)Data summary

|                         |          |
|:------------------------|:---------|
|Name                     |babynames |
|Number of rows           |1924665   |
|Number of columns        |5         |
|_______________________  |          |
|Column type frequency:   |          |
|character                |2         |
|numeric                  |3         |
|________________________ |          |
|Group variables          |None      |


**Variable type: character**

|skim_variable | n_missing| complete_rate| min| max| empty| n_unique| whitespace|
|:-------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|
|sex           |         0|             1|   1|   1|     0|        2|          0|
|name          |         0|             1|   2|  15|     0|    97310|          0|


**Variable type: numeric**

|skim_variable | n_missing| complete_rate| mean|   sd|   p0|  p25|  p50|  p75|     p100|hist  |
|:-------------|---------:|-------------:|----:|----:|----:|----:|----:|----:|--------:|:-----|
|year          |         0|             1| 1975|   34| 1880| 1951| 1985| 2003|  2017.00|▁▂▃▅▇ |
|n             |         0|             1|  181| 1533|    5|    7|   12|   32| 99686.00|▇▁▁▁▁ |
|prop          |         0|             1|    0|    0|    0|    0|    0|    0|     0.08|▇▁▁▁▁ |


<div class="modal fade bs-example-modal-lg" id="QAVKoNSSfjJeqvPun2Yp" tabindex="-1" role="dialog" aria-labelledby="QAVKoNSSfjJeqvPun2Yp-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="QAVKoNSSfjJeqvPun2Yp-title">Solution</h4></div><div class="modal-body">

<p>The last line only selects the <code>n</code> column.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#QAVKoNSSfjJeqvPun2Yp">Solution</button>

  1) Which of these is NOT a way to select the `name` and `n` columns together?
  
      ```r
      select(babynames, -c(year, sex, prop))
      select(babynames, name:n)
      select(babynames, starts_with("n"))
      select(babynames, ends_with("n"))
      ```
  
  2) Use `filter` and the logical operators to find:
  

<div class="modal fade bs-example-modal-lg" id="K7R5onipU4DOBTPpgw1J" tabindex="-1" role="dialog" aria-labelledby="K7R5onipU4DOBTPpgw1J-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="K7R5onipU4DOBTPpgw1J-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  filter(prop >= 0.08)
#> # A tibble: 3 × 5
#>    year sex   name        n   prop
#>   <dbl> <chr> <chr>   <int>  <dbl>
#> 1  1880 M     John     9655 0.0815
#> 2  1880 M     William  9532 0.0805
#> 3  1881 M     John     8769 0.0810
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#K7R5onipU4DOBTPpgw1J">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a) all of the names where prop is greater than or equal to 0.08,


<div class="modal fade bs-example-modal-lg" id="l4ytq5NdfgegyuH0Z16K" tabindex="-1" role="dialog" aria-labelledby="l4ytq5NdfgegyuH0Z16K-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="l4ytq5NdfgegyuH0Z16K-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  filter(name == "Sea")
#> # A tibble: 4 × 5
#>    year sex   name      n       prop
#>   <dbl> <chr> <chr> <int>      <dbl>
#> 1  1982 F     Sea       5 0.00000276
#> 2  1985 M     Sea       6 0.00000312
#> 3  1986 M     Sea       5 0.0000026 
#> 4  1998 F     Sea       5 0.00000258
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#l4ytq5NdfgegyuH0Z16K">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b) all of the children named "Sea".



  3) Use Boolean operators to return only the rows that contain:
  

<div class="modal fade bs-example-modal-lg" id="rQ0oWvJJQxZggZTxq5Tn" tabindex="-1" role="dialog" aria-labelledby="rQ0oWvJJQxZggZTxq5Tn-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="rQ0oWvJJQxZggZTxq5Tn-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  filter(name == "Sue", sex == "M")
#> # A tibble: 52 × 5
#>     year sex   name      n       prop
#>    <dbl> <chr> <chr> <int>      <dbl>
#>  1  1917 M     Sue       7 0.0000073 
#>  2  1927 M     Sue       5 0.0000043 
#>  3  1928 M     Sue       5 0.00000438
#>  4  1930 M     Sue       5 0.00000443
#>  5  1931 M     Sue       6 0.00000561
#>  6  1932 M     Sue       7 0.00000652
#>  7  1933 M     Sue       7 0.00000686
#>  8  1934 M     Sue      14 0.0000132 
#>  9  1935 M     Sue      13 0.0000122 
#> 10  1936 M     Sue       9 0.00000846
#> # … with 42 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#rQ0oWvJJQxZggZTxq5Tn">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a) _boys_ named Sue,



<div class="modal fade bs-example-modal-lg" id="Z8vidLytNLCxI7JUPE5d" tabindex="-1" role="dialog" aria-labelledby="Z8vidLytNLCxI7JUPE5d-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Z8vidLytNLCxI7JUPE5d-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  filter(year == 1880, n == 5 | n == 6)
#> # A tibble: 455 × 5
#>     year sex   name        n      prop
#>    <dbl> <chr> <chr>   <int>     <dbl>
#>  1  1880 F     Abby        6 0.0000615
#>  2  1880 F     Aileen      6 0.0000615
#>  3  1880 F     Alba        6 0.0000615
#>  4  1880 F     Alda        6 0.0000615
#>  5  1880 F     Alla        6 0.0000615
#>  6  1880 F     Alverta     6 0.0000615
#>  7  1880 F     Ara         6 0.0000615
#>  8  1880 F     Ardelia     6 0.0000615
#>  9  1880 F     Ardella     6 0.0000615
#> 10  1880 F     Arrie       6 0.0000615
#> # … with 445 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Z8vidLytNLCxI7JUPE5d">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b) names that were used by exactly 5 or 6 children in 1880,



<div class="modal fade bs-example-modal-lg" id="JUJYxNLzqMqg0Fl5oB69" tabindex="-1" role="dialog" aria-labelledby="JUJYxNLzqMqg0Fl5oB69-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="JUJYxNLzqMqg0Fl5oB69-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  filter(name %in% c("Acura", "Lexus", "Yugo"))
#> # A tibble: 57 × 5
#>     year sex   name      n       prop
#>    <dbl> <chr> <chr> <int>      <dbl>
#>  1  1990 F     Lexus    36 0.0000175 
#>  2  1990 M     Lexus    12 0.00000558
#>  3  1991 F     Lexus   102 0.0000502 
#>  4  1991 M     Lexus    16 0.00000755
#>  5  1992 F     Lexus   193 0.0000963 
#>  6  1992 M     Lexus    25 0.0000119 
#>  7  1993 F     Lexus   285 0.000145  
#>  8  1993 M     Lexus    30 0.0000145 
#>  9  1994 F     Lexus   381 0.000195  
#> 10  1994 F     Acura     6 0.00000308
#> # … with 47 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#JUJYxNLzqMqg0Fl5oB69">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c) names that are one of Acura, Lexus, or Yugo.
      


<div class="modal fade bs-example-modal-lg" id="Lr8f5RLO7ZQ4TxCagclj" tabindex="-1" role="dialog" aria-labelledby="Lr8f5RLO7ZQ4TxCagclj-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Lr8f5RLO7ZQ4TxCagclj-title">Solution</h4></div><div class="modal-body">

```r
min(babynames$n)
#> [1] 5
max(babynames$n)
#> [1] 99686
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Lr8f5RLO7ZQ4TxCagclj">Solution</button>

  4) What is the smallest value of n? What is the largest?



<div class="modal fade bs-example-modal-lg" id="riPLI1qBCJQtq401KQek" tabindex="-1" role="dialog" aria-labelledby="riPLI1qBCJQtq401KQek-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="riPLI1qBCJQtq401KQek-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  filter(sex == "F", year == 2017) %>% 
  select(name, n) %>% 
  arrange(desc(n)) 
#> # A tibble: 18,309 × 2
#>    name          n
#>    <chr>     <int>
#>  1 Emma      19738
#>  2 Olivia    18632
#>  3 Ava       15902
#>  4 Isabella  15100
#>  5 Sophia    14831
#>  6 Mia       13437
#>  7 Charlotte 12893
#>  8 Amelia    11800
#>  9 Evelyn    10675
#> 10 Abigail   10551
#> # … with 18,299 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#riPLI1qBCJQtq401KQek">Solution</button>

<div class="modal fade bs-example-modal-lg" id="3SDSKUH8drT0DYXHZqVA" tabindex="-1" role="dialog" aria-labelledby="3SDSKUH8drT0DYXHZqVA-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="3SDSKUH8drT0DYXHZqVA-title">Hint</h4></div><div class="modal-body">

```r
babynames %>% 
  filter(___) %>% 
  select(name, n) %>% 
  arrange(desc(___)) 
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#3SDSKUH8drT0DYXHZqVA">Hint</button>

  5) Write a sequence of functions that filters babynames to just the girls that were born in 2017, then select the `name` and `n` columns, then arrange the results so that the most popular names are near the top.



<div class="modal fade bs-example-modal-lg" id="sXVUBiATgX0dkvcpN53z" tabindex="-1" role="dialog" aria-labelledby="sXVUBiATgX0dkvcpN53z-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="sXVUBiATgX0dkvcpN53z-title">Solution</h4></div><div class="modal-body">

```r
# for instance
babynames %>% 
  filter(sex == "M", name == "Lars")
#> # A tibble: 112 × 5
#>     year sex   name      n      prop
#>    <dbl> <chr> <chr> <int>     <dbl>
#>  1  1883 M     Lars      7 0.0000622
#>  2  1884 M     Lars      5 0.0000407
#>  3  1886 M     Lars      5 0.000042 
#>  4  1887 M     Lars      5 0.0000457
#>  5  1897 M     Lars      5 0.000041 
#>  6  1901 M     Lars      8 0.0000692
#>  7  1912 M     Lars      6 0.0000133
#>  8  1913 M     Lars      6 0.0000112
#>  9  1914 M     Lars     16 0.0000234
#> 10  1915 M     Lars     17 0.0000193
#> # … with 102 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#sXVUBiATgX0dkvcpN53z">Solution</button>

  6) Trim `babynames` to just the rows that contain your `name` and your `sex`.


 

<div class="modal fade bs-example-modal-lg" id="sfPXHJPpbR2sJ0CDjFkk" tabindex="-1" role="dialog" aria-labelledby="sfPXHJPpbR2sJ0CDjFkk-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="sfPXHJPpbR2sJ0CDjFkk-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  filter(name == "Khaleesi") %>% 
  summarise(total = sum(n), first = min(year))
#> # A tibble: 1 × 2
#>   total first
#>   <int> <dbl>
#> 1  1964  2011
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#sfPXHJPpbR2sJ0CDjFkk">Solution</button>

<div class="modal fade bs-example-modal-lg" id="2lf7Wu75F75SX6iblFHH" tabindex="-1" role="dialog" aria-labelledby="2lf7Wu75F75SX6iblFHH-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="2lf7Wu75F75SX6iblFHH-title">Hint</h4></div><div class="modal-body">

```r
babynames ___ 
  filter(____) ___
  ____(total = ___, first = ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#2lf7Wu75F75SX6iblFHH">Hint</button>

  7) Extract the rows where `name == "Khaleesi"`. Then use `summarise()` to find the total number of children named Khaleesi and the first year Khaleesi appeared in the data.



<div class="modal fade bs-example-modal-lg" id="66wZs2T53tCj4ai9GiSW" tabindex="-1" role="dialog" aria-labelledby="66wZs2T53tCj4ai9GiSW-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="66wZs2T53tCj4ai9GiSW-title">Solution</h4></div><div class="modal-body">

```r
babynames %>%
  group_by(name, sex) %>% 
  summarize(total = sum(n)) %>% 
  arrange(desc(total))
#> # A tibble: 107,973 × 3
#> # Groups:   name [97,310]
#>    name    sex     total
#>    <chr>   <chr>   <int>
#>  1 James   M     5150472
#>  2 John    M     5115466
#>  3 Robert  M     4814815
#>  4 Michael M     4350824
#>  5 Mary    F     4123200
#>  6 William M     4102604
#>  7 David   M     3611329
#>  8 Joseph  M     2603445
#>  9 Richard M     2563082
#> 10 Charles M     2386048
#> # … with 107,963 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#66wZs2T53tCj4ai9GiSW">Solution</button>

<div class="modal fade bs-example-modal-lg" id="Weccg5Z6ToVmVydrcssy" tabindex="-1" role="dialog" aria-labelledby="Weccg5Z6ToVmVydrcssy-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Weccg5Z6ToVmVydrcssy-title">Hint</h4></div><div class="modal-body">

```r
babynames %>%
  _______(name, sex) %>% 
  _______(total = _____(n)) %>% 
  _______(desc(_____))
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Weccg5Z6ToVmVydrcssy">Hint</button>

  8) Use `group_by()`, `summarise()`, and `arrange()` to display the ten most popular names. Compute popularity as the *total* number of children of a single gender given a name. 
      
      

<div class="modal fade bs-example-modal-lg" id="YzAl23VpmaPf70uqJN81" tabindex="-1" role="dialog" aria-labelledby="YzAl23VpmaPf70uqJN81-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="YzAl23VpmaPf70uqJN81-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  group_by(year) %>% 
  summarise(total = sum(n))
#> # A tibble: 138 × 2
#>     year  total
#>    <dbl>  <int>
#>  1  1880 201484
#>  2  1881 192696
#>  3  1882 221533
#>  4  1883 216946
#>  5  1884 243462
#>  6  1885 240854
#>  7  1886 255317
#>  8  1887 247394
#>  9  1888 299473
#> 10  1889 288946
#> # … with 128 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#YzAl23VpmaPf70uqJN81">Solution</button>

  9) Use `group_by()` to calculate the total number of children born each year over time.



<div class="modal fade bs-example-modal-lg" id="6jSxzakamClF5ZGD9Kt1" tabindex="-1" role="dialog" aria-labelledby="6jSxzakamClF5ZGD9Kt1-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="6jSxzakamClF5ZGD9Kt1-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  group_by(year, sex) %>% 
  mutate(rank = min_rank(desc(n))) %>% 
  arrange(year, sex, desc(prop))
#> # A tibble: 1,924,665 × 6
#> # Groups:   year, sex [276]
#>     year sex   name          n   prop  rank
#>    <dbl> <chr> <chr>     <int>  <dbl> <int>
#>  1  1880 F     Mary       7065 0.0724     1
#>  2  1880 F     Anna       2604 0.0267     2
#>  3  1880 F     Emma       2003 0.0205     3
#>  4  1880 F     Elizabeth  1939 0.0199     4
#>  5  1880 F     Minnie     1746 0.0179     5
#>  6  1880 F     Margaret   1578 0.0162     6
#>  7  1880 F     Ida        1472 0.0151     7
#>  8  1880 F     Alice      1414 0.0145     8
#>  9  1880 F     Bertha     1320 0.0135     9
#> 10  1880 F     Sarah      1288 0.0132    10
#> # … with 1,924,655 more rows
```


<p>The same results if you use <code>n</code> since in the same order.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#6jSxzakamClF5ZGD9Kt1">Solution</button>

<div class="modal fade bs-example-modal-lg" id="jgcZOC492MefKwUrOdec" tabindex="-1" role="dialog" aria-labelledby="jgcZOC492MefKwUrOdec-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="jgcZOC492MefKwUrOdec-title">Hint</h4></div><div class="modal-body">

```r
babynames %>% 
  group_by(___, ___) %>% 
  ___(rank = ___(desc(___))) %>% 
  arrange(year, sex, desc(prop))
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#jgcZOC492MefKwUrOdec">Hint</button>

  10) Column `prop` denotes the proportion given year and sex. Use `mutate()` and `min_rank()` to rank each row in babynames from _largest_ `prop` to lowest `prop` given year and sex. What happens if you do the same using the `n` column?



<div class="modal fade bs-example-modal-lg" id="T9JH9RceE9j1O9kAW6RI" tabindex="-1" role="dialog" aria-labelledby="T9JH9RceE9j1O9kAW6RI-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="T9JH9RceE9j1O9kAW6RI-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  group_by(year, sex) %>% 
  mutate(rank = min_rank(desc(n))) %>% 
  filter(rank == 1, year > 2009)
#> # A tibble: 16 × 6
#> # Groups:   year, sex [16]
#>     year sex   name         n    prop  rank
#>    <dbl> <chr> <chr>    <int>   <dbl> <int>
#>  1  2010 F     Isabella 22905 0.0117      1
#>  2  2010 M     Jacob    22117 0.0108      1
#>  3  2011 F     Sophia   21837 0.0113      1
#>  4  2011 M     Jacob    20365 0.0100      1
#>  5  2012 F     Sophia   22304 0.0115      1
#>  6  2012 M     Jacob    19069 0.00941     1
#>  7  2013 F     Sophia   21213 0.0110      1
#>  8  2013 M     Noah     18241 0.00904     1
#>  9  2014 F     Emma     20924 0.0107      1
#> 10  2014 M     Noah     19286 0.00943     1
#> 11  2015 F     Emma     20435 0.0105      1
#> 12  2015 M     Noah     19613 0.00962     1
#> 13  2016 F     Emma     19471 0.0101      1
#> 14  2016 M     Noah     19082 0.00946     1
#> 15  2017 F     Emma     19738 0.0105      1
#> 16  2017 M     Liam     18728 0.00954     1
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#T9JH9RceE9j1O9kAW6RI">Solution</button>

  11) Filter the results to find all names with `rank == 1` after 2009.






### Exercise (profit) {#ex-profit1}



Use the *exercise R markdown template* to solve this exercise (**File > New File > R Markdown...**, select **From template** and then **TFA Exercise**).

Consider the dataset profit containing quarterly financial records for each costumer, product, etc.:


```r
library(skimr)
path <- system.file("extdata/profit_raw.csv", package = "tfa")
profit <- read_csv(path)
skim(profit)
```


Table: (\#tab:unnamed-chunk-62)Data summary

|                         |       |
|:------------------------|:------|
|Name                     |profit |
|Number of rows           |24546  |
|Number of columns        |9      |
|_______________________  |       |
|Column type frequency:   |       |
|character                |9      |
|________________________ |       |
|Group variables          |None   |


**Variable type: character**

|skim_variable         | n_missing| complete_rate| min| max| empty| n_unique| whitespace|
|:---------------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|
|Quarter               |         0|             1|   1|   2|     0|       12|          0|
|Channel               |         0|             1|   3|   3|     0|       10|          0|
|Customer ID           |         0|             1|   3|   3|     0|       18|          0|
|Country               |         0|             1|   3|  14|     0|       47|          0|
|Product Line          |         0|             1|  14|  25|     0|        6|          0|
|Revenue               |        63|             1|   1|   7|     0|     1210|          0|
|Product Cost          |        61|             1|   3|   6|     0|     1139|          0|
|Customer Service Cost |        10|             1|   1|   6|     0|      464|          0|
|Profit                |         0|             1|   3|   7|     0|      966|          0|

Note that it seems that the dataset need to be cleaned. All columns are strings (some should be numbers) and there seems to be missing values. You may start by having a view of the dataset using:

```r
View(profit)
```

First focus on column `Quarter` which currently has 12 distinct values:


```r
profit %>% distinct(Quarter)
#> # A tibble: 12 × 1
#>    Quarter
#>    <chr>  
#>  1 Q3     
#>  2 1      
#>  3 Q4     
#>  4 Q1     
#>  5 Q2     
#>  6 2      
#>  7 4      
#>  8 q1     
#>  9 q4     
#> 10 q3     
#> 11 q2     
#> 12 3
```

You would like it to be a numeric with values 1-4. 


<div class="modal fade bs-example-modal-lg" id="it97ZSNLHzA85bBJGfTG" tabindex="-1" role="dialog" aria-labelledby="it97ZSNLHzA85bBJGfTG-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="it97ZSNLHzA85bBJGfTG-title">Solution</h4></div><div class="modal-body">

```r

profit <- profit %>%  
  mutate(Quarter = str_remove(Quarter, "q") %>% str_remove("Q") %>% as.numeric())
profit %>% distinct(Quarter)
#> # A tibble: 4 × 1
#>   Quarter
#>     <dbl>
#> 1       3
#> 2       1
#> 3       4
#> 4       2
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#it97ZSNLHzA85bBJGfTG">Solution</button>

<div class="modal fade bs-example-modal-lg" id="2fWHMPlae2HhQWFewhPk" tabindex="-1" role="dialog" aria-labelledby="2fWHMPlae2HhQWFewhPk-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="2fWHMPlae2HhQWFewhPk-title">Hint</h4></div><div class="modal-body">

```r
profit <- profit %>%  
  mutate(Quarter = str_remove(___, "q") %>% str_remove(___) %>% as.numeric())
profit %>% distinct(Quarter)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#2fWHMPlae2HhQWFewhPk">Hint</button>

  1) Use `mutate`, `str_remove` and `as.numeric` to convert the column to a numeric by removing all 'q' and 'Q' values.

Let us look at the next columns:


```r
profit %>% distinct(Channel) %>% pull()
#>  [1] "ATM" "BRH" "INT" "MAL" "EML" "CCT" "TEL" "MOP" "DSA" "EVE"
profit %>% distinct(`Customer ID`) %>% pull()
#>  [1] "FRT" "MRT" "PBI" "MAM" "EBP" "RPB" "WEB" "WEM" "HEC" "STF" "IAS" "CRE" "INB" "CAM" "AGR" "SBE"
#> [17] "AFF" "MFN"
profit %>% distinct(Country) %>% pull()
#>  [1] "USA"            "Canada"         "Great Britain"  "Finland"        "New Zealand"   
#>  [6] "Brazil"         "Mexico"         "Germany"        "Puerto Rico"    "Hong Kong"     
#> [11] "Japan"          "Columbia"       "Switzerland"    "Uruguay"        "Netherlands"   
#> [16] "Korea"          "Venezuela"      "Panama"         "Sweden"         "China"         
#> [21] "Guatemala"      "South Africa"   "Malaysia"       "Nigeria"        "Denmark"       
#> [26] "France"         "India"          "Taiwan"         "Norway"         "Chile"         
#> [31] "Indonesia"      "Ireland"        "Thailand"       "Peru"           "Spain"         
#> [36] "Belgium"        "Poland"         "Ecuador"        "Costa Rica"     "Australia"     
#> [41] "Israel"         "Guam"           "Oman"           "Singapore"      "Argentina"     
#> [46] "Czechoslovakia" "Philippines"
profit %>% distinct(`Product Line`) %>% pull()
#> [1] "Credit Products"           "Deposit Products"          "Revolving Credit Products"
#> [4] "Other Products"            "Third Party Products"      "Fee Based Products"
```

These seem to be okay. The last columns should be numbers. Let us consider `Revenue`. 


```r
profit %>% distinct(Revenue) %>% pull() %>% head(n = 100)
#>   [1] "$ 6044"  "$ 4686"  "$ 6063"  "$ 4682"  "$ 6320"  "$ 2993"  "$ 3355"  "$ 5716"  "$ 3347" 
#>  [10] "$ 2624"  "$ 3629"  "$ 5612"  "$ 4618"  "$ 2080"  "$ 2788"  "$ 2829"  "$ 2898"  "$ 5232" 
#>  [19] "$ 2949"  "$ 5565"  "$ 2153"  "$ 3097"  "$ 1920"  "$ 4041"  "$ 5931"  "$ 1605"  "$ 2026" 
#>  [28] "$ 1687"  "$ 5075"  "$ 4223"  "$ 2456"  "$ 1924"  "$ 1578"  "$ 3235"  "$ 5123"  "$ 1560" 
#>  [37] "$ 1945"  "$ 6060"  "$ 1222"  "$ 1660"  "$ 3000"  "$ 2970"  "$ 1631"  "$ 1215"  "$ 1759" 
#>  [46] "$ 3285"  "$ 2048"  "$ 2173"  "$ 3353"  "$ 1162"  "$ 1232"  "$ 1561"  "$ 1123"  "$ 1794" 
#>  [55] "$ 1202"  "$ 1510"  "$ 4472"  "$ 2370"  "$ 2581"  "$ 2761"  "$ 6371"  "$ 1972"  "$ 1562" 
#>  [64] "$ 2742"  "$ 4598"  "$ 5322"  "$ 3411"  NA        "$ 1569"  "$ 2852"  "$ 1622"  "$ 2505" 
#>  [73] "$ 1596"  "$ 1447"  "$ 1690"  "$ 2448"  "$ 1593"  "$ 1876"  "$ 6591"  "$ 1611"  "$ 1254" 
#>  [82] "Unknown" "$ 842"   "$ 1529"  "$ 1439"  "$ 762"   "$ 1959"  "$ 4382"  "$ 1407"  "$ 909"  
#>  [91] "$ 1549"  "$ 2161"  "$ 1331"  "$ 727"   "$ 1462"  "$ 1067"  "$ 833"   "$ 1675"  "$ 1524" 
#> [100] "$ 1285"
```

Most values start with a dollar sign. Let us have a look at the other ones:


```r
profit %>% filter(!str_starts(Revenue, fixed("$"))) 
#> # A tibble: 95 × 9
#>    Quarter Channel `Customer ID` Country      `Product Line` Revenue `Product Cost` `Customer Serv…`
#>      <dbl> <chr>   <chr>         <chr>        <chr>          <chr>   <chr>          <chr>           
#>  1       3 INT     MAM           USA          Deposit Produ… Unknown $ 1008         $ 246           
#>  2       3 MAL     RPB           USA          Credit Produc… ?       $ 1420         $ 347           
#>  3       1 MAL     WEM           Great Brita… Other Products ?       $ 87           $ 19            
#>  4       3 ATM     MFN           Germany      Fee Based Pro… unknown $ 47           $ 6             
#>  5       3 ATM     PBI           Costa Rica   Third Party P… Unknown $ 51           $ 9             
#>  6       1 ATM     PBI           Chile        Deposit Produ… Unknown $ 58           $ 7             
#>  7       4 CCT     MRT           Great Brita… Revolving Cre… ?       $ 27           $ 5             
#>  8       4 ATM     MAM           Taiwan       Third Party P… unknown $ 55           $ 9             
#>  9       4 MAL     WEB           Japan        Other Products unknown $ 40           $ 7             
#> 10       2 CCT     MAM           Netherlands  Credit Produc… unknown $ 14           $ 3             
#> # … with 85 more rows, and 1 more variable: Profit <chr>
na_values <- profit %>% 
  filter(!str_starts(Revenue, fixed("$"))) %>% 
  distinct(Revenue) %>% 
  pull(Revenue)
na_values
#> [1] "Unknown" "?"       "unknown"
```

The expression is a bit complex. Let us break it up. Function `fixed` just returns the fixed string '$'. This is necessary since the dollar sign has a special meaning in regular expressions (beyond the scope here). Function `str_starts` checks if the string starts with a dollar sign. We use the logical negation (NOT) to find the complementary set. 

Note that different strings have been used to indicate `NA` values (Unknown, ?, unknown). Let us first use a single value to indicate `NA` (a question mark):

```r
profit <- profit %>% 
  mutate(Revenue = str_replace_all(Revenue, c("unknown" = "?", "Unknown" = "?")))
```

Next, we replace all `?` with `NA`:

```r
profit <- profit %>% 
  mutate(Revenue = na_if(Revenue, "?"))
profit %>% # check
  filter(!str_starts(Revenue, fixed("$"))) 
#> # A tibble: 0 × 9
#> # … with 9 variables: Quarter <dbl>, Channel <chr>, Customer ID <chr>, Country <chr>,
#> #   Product Line <chr>, Revenue <chr>, Product Cost <chr>, Customer Service Cost <chr>,
#> #   Profit <chr>
```

Finally, we remove all dollar signs:


```r
profit <- profit %>% 
  mutate(Revenue = str_remove(Revenue, fixed("$ ")) %>% as.numeric())
profit
#> # A tibble: 24,546 × 9
#>    Quarter Channel `Customer ID` Country `Product Line`      Revenue `Product Cost` `Customer Serv…`
#>      <dbl> <chr>   <chr>         <chr>   <chr>                 <dbl> <chr>          <chr>           
#>  1       3 ATM     FRT           USA     Credit Products        6044 $ 3998         $ 413           
#>  2       1 ATM     MRT           USA     Credit Products        4686 $ 3229         $ 643           
#>  3       4 ATM     PBI           USA     Deposit Products       6063 $ 7440         $ 1842          
#>  4       1 ATM     PBI           USA     Deposit Products       4682 $ 6127         $ 1118          
#>  5       4 ATM     MRT           USA     Deposit Products       6320 $ 7913         $ 1854          
#>  6       3 BRH     MAM           USA     Deposit Products       2993 $ 1034         $ 242           
#>  7       4 BRH     PBI           USA     Revolving Credit P…    3355 $ 4355         $ 1027          
#>  8       3 ATM     FRT           USA     Revolving Credit P…    5716 $ 5617         $ 876           
#>  9       4 BRH     PBI           USA     Deposit Products       3347 $ 4229         $ 425           
#> 10       1 BRH     PBI           USA     Credit Products        2624 $ 1960         $ 264           
#> # … with 24,536 more rows, and 1 more variable: Profit <chr>
```

As one pipe: 

```r
profit <- profit %>% 
  mutate(Revenue = str_replace_all(Revenue, c("unknown" = "?", "Unknown" = "?"))) %>% 
  mutate(Revenue = na_if(Revenue, "?")) %>% 
  mutate(Revenue = str_remove(Revenue, fixed("$ ")) %>% as.numeric())
```



  2) Convert the remaining columns to numeric like shown for `Revenue` above. 
  


<div class="modal fade bs-example-modal-lg" id="eBVKj1x8cFDMAoWaHKz8" tabindex="-1" role="dialog" aria-labelledby="eBVKj1x8cFDMAoWaHKz8-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="eBVKj1x8cFDMAoWaHKz8-title">Solution</h4></div><div class="modal-body">

```r
profit <- read_csv(path)
profit <- profit %>% 
  mutate(across(Revenue:Profit, ~str_replace_all(.x, c("unknown" = "?", "Unknown" = "?")) )) %>% 
  mutate(across(Revenue:Profit, ~na_if(.x, "?") )) %>% 
  mutate(across(Revenue:Profit, ~str_remove(.x, fixed("$ ")) %>% as.numeric() )) 
profit
#> # A tibble: 24,546 × 9
#>    Quarter Channel `Customer ID` Country `Product Line`      Revenue `Product Cost` `Customer Serv…`
#>    <chr>   <chr>   <chr>         <chr>   <chr>                 <dbl>          <dbl>            <dbl>
#>  1 Q3      ATM     FRT           USA     Credit Products        6044           3998              413
#>  2 1       ATM     MRT           USA     Credit Products        4686           3229              643
#>  3 Q4      ATM     PBI           USA     Deposit Products       6063           7440             1842
#>  4 Q1      ATM     PBI           USA     Deposit Products       4682           6127             1118
#>  5 Q4      ATM     MRT           USA     Deposit Products       6320           7913             1854
#>  6 Q3      BRH     MAM           USA     Deposit Products       2993           1034              242
#>  7 Q4      BRH     PBI           USA     Revolving Credit P…    3355           4355             1027
#>  8 Q3      ATM     FRT           USA     Revolving Credit P…    5716           5617              876
#>  9 Q4      BRH     PBI           USA     Deposit Products       3347           4229              425
#> 10 Q1      BRH     PBI           USA     Credit Products        2624           1960              264
#> # … with 24,536 more rows, and 1 more variable: Profit <dbl>
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#eBVKj1x8cFDMAoWaHKz8">Solution</button>

<div class="modal fade bs-example-modal-lg" id="XA6dQBgH27WtkJFNnFoP" tabindex="-1" role="dialog" aria-labelledby="XA6dQBgH27WtkJFNnFoP-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="XA6dQBgH27WtkJFNnFoP-title">Hint</h4></div><div class="modal-body">

```r
profit <- read_csv(path) %>% 
  mutate(across(___:___, ~str_replace_all(.x, c("unknown" = "?", "Unknown" = "?")) )) %>% 
  mutate(across(___:___, ~na_if(.x, "?") )) %>% 
  mutate(across(___:___, ~str_remove(.x, fixed("$ ")) %>% as.numeric() )) 
profit
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#XA6dQBgH27WtkJFNnFoP">Hint</button>
   3) Use the `across` function to apply the operations in Question 2 for a set of columns. Hint: see the examples on the help page of `across`. 




<div class="modal fade bs-example-modal-lg" id="Lk2kHKQg118DaSErPXx4" tabindex="-1" role="dialog" aria-labelledby="Lk2kHKQg118DaSErPXx4-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Lk2kHKQg118DaSErPXx4-title">Solution</h4></div><div class="modal-body">

```r
profit <- read_csv(path) %>% 
  mutate(Quarter = str_remove(Quarter, "q") %>% str_remove("Q") %>% as.numeric()) %>% 
  mutate(across(Revenue:Profit, ~str_replace_all(.x, c("unknown" = "?", "Unknown" = "?")) )) %>% 
  mutate(across(Revenue:Profit, ~na_if(.x, "?") )) %>% 
  mutate(across(Revenue:Profit, ~str_remove(.x, fixed("$ ")) %>% as.numeric() )) 
skim(profit)
```


Table: (\#tab:unnamed-chunk-75)Data summary

|                         |       |
|:------------------------|:------|
|Name                     |profit |
|Number of rows           |24546  |
|Number of columns        |9      |
|_______________________  |       |
|Column type frequency:   |       |
|character                |4      |
|numeric                  |5      |
|________________________ |       |
|Group variables          |None   |


**Variable type: character**

|skim_variable | n_missing| complete_rate| min| max| empty| n_unique| whitespace|
|:-------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|
|Channel       |         0|             1|   3|   3|     0|       10|          0|
|Customer ID   |         0|             1|   3|   3|     0|       18|          0|
|Country       |         0|             1|   3|  14|     0|       47|          0|
|Product Line  |         0|             1|  14|  25|     0|        6|          0|


**Variable type: numeric**

|skim_variable         | n_missing| complete_rate|   mean|     sd|    p0| p25| p50| p75| p100|hist  |
|:---------------------|---------:|-------------:|------:|------:|-----:|---:|---:|---:|----:|:-----|
|Quarter               |         0|          1.00|   2.50|   1.12|     1|   2|   2|   3|    4|▇▇▁▇▇ |
|Revenue               |       158|          0.99| 120.31| 421.79|     1|  12|  41|  74| 7540|▇▁▁▁▁ |
|Product Cost          |        61|          1.00| 100.04| 375.58|     0|   9|  29|  68| 9256|▇▁▁▁▁ |
|Customer Service Cost |        96|          1.00|  17.41|  67.50|     0|   1|   5|  12| 1865|▇▁▁▁▁ |
|Profit                |         0|          1.00|   2.71| 154.89| -4139|  -7|   0|   9| 3664|▁▁▇▁▁ |


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Lk2kHKQg118DaSErPXx4">Solution</button>

  4) Write one pipe that does all the cleaning.
  




<div class="modal fade bs-example-modal-lg" id="8IknibfR1pTc4qnJDvrG" tabindex="-1" role="dialog" aria-labelledby="8IknibfR1pTc4qnJDvrG-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="8IknibfR1pTc4qnJDvrG-title">Solution</h4></div><div class="modal-body">

```r
profit <- profit %>% 
  mutate(Profit_calc = Revenue - `Product Cost` - `Customer Service Cost`, Diff = abs(Profit - Profit_calc)) %>%  
  mutate(Profit = if_else(Diff > 0 & Diff <= 1, Profit_calc, Profit, missing = Profit) ) 
profit %>% filter(Diff == 1, is.na(Profit_calc))  # check
#> # A tibble: 0 × 11
#> # … with 11 variables: Quarter <dbl>, Channel <chr>, Customer ID <chr>, Country <chr>,
#> #   Product Line <chr>, Revenue <dbl>, Product Cost <dbl>, Customer Service Cost <dbl>,
#> #   Profit <dbl>, Profit_calc <dbl>, Diff <dbl>
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#8IknibfR1pTc4qnJDvrG">Solution</button>

<div class="modal fade bs-example-modal-lg" id="UbYJwqszCgmHH87psxkg" tabindex="-1" role="dialog" aria-labelledby="UbYJwqszCgmHH87psxkg-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="UbYJwqszCgmHH87psxkg-title">Hint</h4></div><div class="modal-body">

```r
profit <- profit %>% 
  mutate(Profit_calc = Revenue - `Product Cost` - `Customer Service Cost`, Diff = abs(___)) %>%  
  mutate(Profit = if_else(Diff > 0 & Diff <= 1, ___, Profit, Profit) ) 
profit %>% filter(Diff == 1, is.na(Profit_calc))  # check
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#UbYJwqszCgmHH87psxkg">Hint</button>

  5) Validate that revenue - product costs - customer service cost equals profit. If you see small rounding errors (less than or equal one) then recalculate the profit.





<div class="modal fade bs-example-modal-lg" id="OR7zOgspX9II89TlROXr" tabindex="-1" role="dialog" aria-labelledby="OR7zOgspX9II89TlROXr-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="OR7zOgspX9II89TlROXr-title">Solution</h4></div><div class="modal-body">

```r
profit <- profit %>% 
  rowwise() %>% 
  mutate(c_na = sum(is.na(c_across(Revenue:Profit)))) %>% 
  mutate(Revenue = if_else(is.na(Revenue) & c_na == 1, Profit + `Product Cost` + `Customer Service Cost`, Revenue, Revenue),
         `Product Cost` = if_else(is.na(`Product Cost`) & c_na == 1, - Profit + Revenue - `Customer Service Cost`, `Product Cost`), 
         `Customer Service Cost` = if_else(is.na(`Customer Service Cost`) & c_na == 1, - Profit + Revenue - `Product Cost`, `Customer Service Cost`)) %>% 
  select(Quarter:Profit)

# check - do numbers match
profit %>% 
  mutate(Profit_calc = Revenue - `Product Cost` - `Customer Service Cost`, Diff = abs(Profit - Profit_calc)) %>%  
  filter(Diff > 0)
#> # A tibble: 0 × 11
#> # Rowwise: 
#> # … with 11 variables: Quarter <dbl>, Channel <chr>, Customer ID <chr>, Country <chr>,
#> #   Product Line <chr>, Revenue <dbl>, Product Cost <dbl>, Customer Service Cost <dbl>,
#> #   Profit <dbl>, Profit_calc <dbl>, Diff <dbl>

# check - find NA values
profit %>% 
  rowwise() %>% 
  mutate(c_na = sum(is.na(c_across(Revenue:Profit)))) %>% 
  filter(c_na > 0)
#> # A tibble: 3 × 10
#> # Rowwise: 
#>   Quarter Channel `Customer ID` Country `Product Line`       Revenue `Product Cost` `Customer Serv…`
#>     <dbl> <chr>   <chr>         <chr>   <chr>                  <dbl>          <dbl>            <dbl>
#> 1       1 EML     FRT           France  Revolving Credit Pr…       3             NA               NA
#> 2       2 BRH     EBP           Guam    Fee Based Products        NA             NA                0
#> 3       1 MAL     MFN           Japan   Fee Based Products        NA             NA                5
#> # … with 2 more variables: Profit <dbl>, c_na <int>
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#OR7zOgspX9II89TlROXr">Solution</button>

<div class="modal fade bs-example-modal-lg" id="UxO2OIxLzPlNZv3Lidt9" tabindex="-1" role="dialog" aria-labelledby="UxO2OIxLzPlNZv3Lidt9-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="UxO2OIxLzPlNZv3Lidt9-title">Hint 2</h4></div><div class="modal-body">

```r
profit <- profit %>% 
  rowwise() %>% 
  mutate(c_na = sum(is.na(c_across(Revenue:Profit)))) %>% 
  mutate(Revenue = if_else(is.na(___) & c_na == 1, ___, Revenue, Revenue),
         `Product Cost` = if_else(is.na(___) & c_na == 1, ___, `Product Cost`), 
         `Customer Service Cost` = if_else(is.na(___) & c_na == 1, ___, `Customer Service Cost`)) %>% 
  select(Quarter:Profit)
```


<p>You can check you calculations using your code from Question 5.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#UxO2OIxLzPlNZv3Lidt9">Hint 2</button>

<div class="modal fade bs-example-modal-lg" id="QnQ298AkOiISi9ie8xKk" tabindex="-1" role="dialog" aria-labelledby="QnQ298AkOiISi9ie8xKk-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="QnQ298AkOiISi9ie8xKk-title">Hint 1</h4></div><div class="modal-body">

```r
# To find the number of missing values (`NA`) you can create a new column 
# counting the number of missing values:
profit <- profit %>% 
  rowwise() %>% 
  mutate(ct_na = sum(is.na(c_across(Revenue:Profit)))) %>% 
  ungroup()
profit %>% filter(ct_na >= 1)
```


<p>Recall that profit = revenue - product costs - customer service cost; that is, if a single value of these are missing then the value can be calculated using the other ones.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#QnQ298AkOiISi9ie8xKk">Hint 1</button>

   6) Recalculate values in columns `Revenue` to `Profit` if possible. 

     
  




<div class="modal fade bs-example-modal-lg" id="Uls3nO4Wr5ogPPnRBox6" tabindex="-1" role="dialog" aria-labelledby="Uls3nO4Wr5ogPPnRBox6-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Uls3nO4Wr5ogPPnRBox6-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(Quarter) %>% 
  slice_max(Profit, n = 2)
#> # A tibble: 8 × 9
#> # Groups:   Quarter [4]
#>   Quarter Channel `Customer ID` Country `Product Line`       Revenue `Product Cost` `Customer Serv…`
#>     <dbl> <chr>   <chr>         <chr>   <chr>                  <dbl>          <dbl>            <dbl>
#> 1       1 ATM     PBI           USA     Credit Products         4821           1808              233
#> 2       1 ATM     PBI           USA     Revolving Credit Pr…    4268           1638              363
#> 3       2 ATM     FRT           USA     Credit Products         5931           3137              406
#> 4       2 ATM     RPB           USA     Deposit Products        4864           2156              533
#> 5       3 ATM     WEM           USA     Credit Products         5682           2112              454
#> 6       3 ATM     WEM           USA     Deposit Products        4850           2493              253
#> 7       4 ATM     MAM           USA     Revolving Credit Pr…    6699           2506              530
#> 8       4 ATM     WEM           USA     Revolving Credit Pr…    5836           2114              265
#> # … with 1 more variable: Profit <dbl>
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Uls3nO4Wr5ogPPnRBox6">Solution</button>

  7) Find the two best rows with highest profit in each quarter.
  



<div class="modal fade bs-example-modal-lg" id="ZMHNxttj3sfRqNRUP1zL" tabindex="-1" role="dialog" aria-labelledby="ZMHNxttj3sfRqNRUP1zL-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="ZMHNxttj3sfRqNRUP1zL-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(Quarter, `Customer ID`) %>% 
  summarise(Profit = sum(Profit)) %>% 
  slice_max(Profit, n = 2)
#> # A tibble: 8 × 3
#> # Groups:   Quarter [4]
#>   Quarter `Customer ID` Profit
#>     <dbl> <chr>          <dbl>
#> 1       1 MRT             3925
#> 2       1 WEB             3776
#> 3       2 FRT             7272
#> 4       2 MAM             6992
#> 5       3 WEM             6616
#> 6       3 RPB             3245
#> 7       4 EBP            10093
#> 8       4 WEM             8262
```


<p>The results are not the same since use another group by.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ZMHNxttj3sfRqNRUP1zL">Solution</button>

<div class="modal fade bs-example-modal-lg" id="vUtNtkw8eHWpl2L7xRSJ" tabindex="-1" role="dialog" aria-labelledby="vUtNtkw8eHWpl2L7xRSJ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="vUtNtkw8eHWpl2L7xRSJ-title">Hint</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(___, `Customer ID`) %>% 
  summarise(Profit = ___) %>% 
  slice_max(Profit, n = 2)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#vUtNtkw8eHWpl2L7xRSJ">Hint</button>

  8) Find the two best customers with highest profit in each quarter. Is the result the same as in Question 7?





<div class="modal fade bs-example-modal-lg" id="SgNkUwnBU4oESw9Q68gk" tabindex="-1" role="dialog" aria-labelledby="SgNkUwnBU4oESw9Q68gk-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="SgNkUwnBU4oESw9Q68gk-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Product Line`) %>% 
  summarise(Profit = sum(Profit)) %>% 
  slice_max(Profit)
#> # A tibble: 1 × 2
#>   `Product Line`  Profit
#>   <chr>            <dbl>
#> 1 Credit Products  31022
# ... repeat 

# Using a function
summarise_profit  <- function(data, group_var, summarise_var) {
  data %>%
    group_by(across({{ group_var }})) %>% 
    summarise(across({{ summarise_var }}, sum)) %>% 
    slice_max(Profit)
}
summarise_profit(profit, `Product Line`, Profit)
#> # A tibble: 1 × 2
#>   `Product Line`  Profit
#>   <chr>            <dbl>
#> 1 Credit Products  31022
summarise_profit(profit, `Customer ID`, Profit)
#> # A tibble: 1 × 2
#>   `Customer ID` Profit
#>   <chr>          <dbl>
#> 1 WEM            18942
# ... repeat

# Using purrr package to get a single tibble (if interested in the purrr package)
val <- names(profit)[1:5]
max_profit <- map_df(
  val, 
  ~{
      tmp <- profit %>% 
        group_by(.data[[.x]]) %>% 
        summarise(Profit = sum(Profit), .groups = "drop") %>% 
        slice_max(Profit)
      tibble(by = .x, 
        best = as.character(tmp[[1,1]]),
        profit = tmp[[1,2]] 
      )
    } 
  )
max_profit 
#> # A tibble: 5 × 3
#>   by           best            profit
#>   <chr>        <chr>            <dbl>
#> 1 Quarter      4                35268
#> 2 Channel      ATM              30433
#> 3 Customer ID  WEM              18942
#> 4 Country      USA              39693
#> 5 Product Line Credit Products  31022
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#SgNkUwnBU4oESw9Q68gk">Solution</button>

<div class="modal fade bs-example-modal-lg" id="Kx7llTgh5mW1VbgtDsNX" tabindex="-1" role="dialog" aria-labelledby="Kx7llTgh5mW1VbgtDsNX-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Kx7llTgh5mW1VbgtDsNX-title">Hint</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(___) %>% 
  summarise(Profit = ___) %>% 
  slice_max(Profit)
# ... repeat 
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Kx7llTgh5mW1VbgtDsNX">Hint</button>

  9) Find the product line, customer, channel, country and quarter with the highest profit. 
  




<div class="modal fade bs-example-modal-lg" id="ejcKZTW2bDrhHX9KuEBf" tabindex="-1" role="dialog" aria-labelledby="ejcKZTW2bDrhHX9KuEBf-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="ejcKZTW2bDrhHX9KuEBf-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Customer ID`) %>% 
  distinct(Country) %>% 
  count(`Customer ID`)
#> # A tibble: 18 × 2
#> # Groups:   Customer ID [18]
#>    `Customer ID`     n
#>    <chr>         <int>
#>  1 AFF               1
#>  2 AGR              16
#>  3 CAM               1
#>  4 CRE               1
#>  5 EBP              47
#>  6 FRT              47
#>  7 HEC               1
#>  8 IAS               1
#>  9 INB               1
#> 10 MAM              47
#> 11 MFN              30
#> 12 MRT              47
#> 13 PBI              47
#> 14 RPB              47
#> 15 SBE               1
#> 16 STF               2
#> 17 WEB              47
#> 18 WEM              47
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ejcKZTW2bDrhHX9KuEBf">Solution</button>

  10) Are there rows with the same customer in different countries?
  




<div class="modal fade bs-example-modal-lg" id="0LG2rAAhtK58UEmeFmWB" tabindex="-1" role="dialog" aria-labelledby="0LG2rAAhtK58UEmeFmWB-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="0LG2rAAhtK58UEmeFmWB-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  arrange(desc(Profit), desc(Revenue))
#> # A tibble: 24,546 × 9
#> # Rowwise: 
#>    Quarter Channel `Customer ID` Country `Product Line`      Revenue `Product Cost` `Customer Serv…`
#>      <dbl> <chr>   <chr>         <chr>   <chr>                 <dbl>          <dbl>            <dbl>
#>  1       4 ATM     MAM           USA     Revolving Credit P…    6699           2506              530
#>  2       4 ATM     WEM           USA     Revolving Credit P…    5836           2114              265
#>  3       4 ATM     MAM           USA     Credit Products        7540           3374              728
#>  4       4 ATM     MRT           USA     Credit Products        6419           2669              618
#>  5       3 ATM     WEM           USA     Credit Products        5682           2112              454
#>  6       4 ATM     WEB           USA     Deposit Products       5145           1907              191
#>  7       1 ATM     PBI           USA     Credit Products        4821           1808              233
#>  8       4 ATM     RPB           USA     Credit Products        5828           2727              559
#>  9       2 ATM     FRT           USA     Credit Products        5931           3137              406
#> 10       1 ATM     PBI           USA     Revolving Credit P…    4268           1638              363
#> # … with 24,536 more rows, and 1 more variable: Profit <dbl>
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#0LG2rAAhtK58UEmeFmWB">Solution</button>

  11) Sort the data decreasing with respect to profit and next revenue.
  

  
  

<div class="modal fade bs-example-modal-lg" id="smL8Uo3UnSAcXRY5OZPb" tabindex="-1" role="dialog" aria-labelledby="smL8Uo3UnSAcXRY5OZPb-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="smL8Uo3UnSAcXRY5OZPb-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Product Line`) %>% 
  summarise(cost = sum(`Product Cost` + `Customer Service Cost`)) %>% 
  # print() %>%   # if want a peek before slicing 
  slice_max(cost)
#> # A tibble: 1 × 2
#>   `Product Line`    cost
#>   <chr>            <dbl>
#> 1 Credit Products 820665

profit %>% 
  group_by(`Product Line`) %>% 
  summarise(cost = sum(`Product Cost`)) %>% 
  slice_min(cost)
#> # A tibble: 1 × 2
#>   `Product Line`        cost
#>   <chr>                <dbl>
#> 1 Third Party Products 91796
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#smL8Uo3UnSAcXRY5OZPb">Solution</button>

<div class="modal fade bs-example-modal-lg" id="PYgmJAbGAq5fw1FgFAVL" tabindex="-1" role="dialog" aria-labelledby="PYgmJAbGAq5fw1FgFAVL-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="PYgmJAbGAq5fw1FgFAVL-title">Hint</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Product Line`) %>% 
  summarise(cost = sum(___)) %>% 
  # print() %>%   # if want a peek before slicing 
  slice_max(___)

profit %>% 
  ___% 
  slice_min(cost)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#PYgmJAbGAq5fw1FgFAVL">Hint</button>

  12) Which product line has the highest and lowest total cost?





<div class="modal fade bs-example-modal-lg" id="xhRqVXlVYHAOcNFaVf8y" tabindex="-1" role="dialog" aria-labelledby="xhRqVXlVYHAOcNFaVf8y-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="xhRqVXlVYHAOcNFaVf8y-title">Solution</h4></div><div class="modal-body">

```r
profit %>%
  mutate(cust_cost_new = `Customer Service Cost` * 1.05, 
         profit_new = Revenue - cust_cost_new - `Product Cost`) %>% 
  group_by(`Product Line`) %>% 
  summarise(cust_cost = sum(`Customer Service Cost`), profit = sum(Profit), 
            cust_cost_new = sum(cust_cost_new), profit_new = sum(profit_new),
            profit_decrease = profit_new - profit)
#> # A tibble: 6 × 6
#>   `Product Line`            cust_cost profit cust_cost_new profit_new profit_decrease
#>   <chr>                         <dbl>  <dbl>         <dbl>      <dbl>           <dbl>
#> 1 Credit Products              119612  31022       125593.     25041.          -5981.
#> 2 Deposit Products             114526   5408       120252.      -318.          -5726.
#> 3 Fee Based Products            22900   4953        24045         NA              NA 
#> 4 Other Products                33282   7438        34946.      5774.          -1664.
#> 5 Revolving Credit Products        NA  15905           NA         NA              NA 
#> 6 Third Party Products          15970   2264        16768.      1465.           -799.
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#xhRqVXlVYHAOcNFaVf8y">Solution</button>

<div class="modal fade bs-example-modal-lg" id="IuyuIIthdZGj2tdIWDKM" tabindex="-1" role="dialog" aria-labelledby="IuyuIIthdZGj2tdIWDKM-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="IuyuIIthdZGj2tdIWDKM-title">Hint</h4></div><div class="modal-body">

```r
profit %>%
  mutate(cust_cost_new = ___ * 1.05, 
         profit_new = ___) %>% 
  group_by(`Product Line`) %>% 
  summarise(cust_cost = sum(___), profit = sum(Profit), 
            cust_cost_new = ___, profit_new = ___,
            profit_decrease = ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#IuyuIIthdZGj2tdIWDKM">Hint</button>

  13) Assume that customer service cost increases with 5%. How will that affect the profit for each product line?
  

```r
rm(profit)
```


### Exercise (fisheries) {#ex-fish}

Use the *exercise R markdown template* to solve this exercise (**File > New File > R Markdown...**, select **From template** and then **TFA Exercise**).

The dataset called `fisheries` contains world fisheries harvest for 2005. The tonnage from capture and aquaculture is listed by country.

You need the `tidyverse` package as usual:


```r
library(tidyverse)
# install tfa package using remotes::install_github("bss-osca/tfa/tfa-package", upgrade = FALSE)     
```

We load the needed datasets:


```r
fisheries <- read_csv(system.file("extdata/fisheries.csv", package = "tfa"))
fisheries
#> # A tibble: 216 × 4
#>    country             capture aquaculture  total
#>    <chr>                 <dbl>       <dbl>  <dbl>
#>  1 Afghanistan            1000        1200   2200
#>  2 Albania                7886         950   8836
#>  3 Algeria               95000        1361  96361
#>  4 American Samoa         3047          20   3067
#>  5 Andorra                   0           0      0
#>  6 Angola               486490         655 487145
#>  7 Antigua and Barbuda    3000          10   3010
#>  8 Argentina            755226        3673 758899
#>  9 Armenia                3758       16381  20139
#> 10 Aruba                   142           0    142
#> # … with 206 more rows
continents <- read_csv(system.file("extdata/continents.csv", package = "tfa"))
continents
#> # A tibble: 247 × 2
#>    country           continent
#>    <chr>             <chr>    
#>  1 Afghanistan       Asia     
#>  2 Åland Islands     Europe   
#>  3 Albania           Europe   
#>  4 Algeria           Africa   
#>  5 American Samoa    Oceania  
#>  6 Andorra           Europe   
#>  7 Angola            Africa   
#>  8 Anguilla          Americas 
#>  9 Antigua & Barbuda Americas 
#> 10 Argentina         Americas 
#> # … with 237 more rows
```

Some mean statistics:


```r
fisheries %>%
  summarise(across(where(is.numeric), mean, na.rm = TRUE))
#> # A tibble: 1 × 3
#>   capture aquaculture   total
#>     <dbl>       <dbl>   <dbl>
#> 1 421916.     508368. 930284.
```




<div class="modal fade bs-example-modal-lg" id="Sxpp0KJl0t5n77KQppZl" tabindex="-1" role="dialog" aria-labelledby="Sxpp0KJl0t5n77KQppZl-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Sxpp0KJl0t5n77KQppZl-title">Solution</h4></div><div class="modal-body">

```r
fisheries %>% 
  anti_join(continents)      # countries not belonging to a continent
#> # A tibble: 20 × 4
#>    country                          capture aquaculture   total
#>    <chr>                              <dbl>       <dbl>   <dbl>
#>  1 Antigua and Barbuda                 3000          10    3010
#>  2 Bosnia and Herzegovina               305        4564    4869
#>  3 Czech Republic                      3507       20952   24459
#>  4 Democratic Republic of the Congo  237372        3161  240533
#>  5 Eswatini                              65         100     165
#>  6 Federated States of Micronesia     88397           0   88397
#>  7 Ivory Coast                        67500        4701   72201
#>  8 Jersey and Guernsey                 2985        1499    4484
#>  9 Macao                               1500           0    1500
#> 10 Myanmar                          2072390     1017644 3090034
#> 11 North Macedonia                      306         986    1292
#> 12 Palestine                           3306         280    3586
#> 13 Republic of the Congo              86748         177   86925
#> 14 Saint Kitts and Nevis              65734           1   65735
#> 15 Saint Lucia                         2097          32    2129
#> 16 Saint Vincent and the Grenadines   23077           0   23077
#> 17 São Tomé and Príncipe              11750           0   11750
#> 18 Trinidad and Tobago                13027          11   13038
#> 19 Turks and Caicos Islands            2780           0    2780
#> 20 US Virgin Islands                    551           8     559
fisheries <- fisheries %>% 
  print() %>% 
  left_join(continents) %>% 
  print()
#> # A tibble: 216 × 4
#>    country             capture aquaculture  total
#>    <chr>                 <dbl>       <dbl>  <dbl>
#>  1 Afghanistan            1000        1200   2200
#>  2 Albania                7886         950   8836
#>  3 Algeria               95000        1361  96361
#>  4 American Samoa         3047          20   3067
#>  5 Andorra                   0           0      0
#>  6 Angola               486490         655 487145
#>  7 Antigua and Barbuda    3000          10   3010
#>  8 Argentina            755226        3673 758899
#>  9 Armenia                3758       16381  20139
#> 10 Aruba                   142           0    142
#> # … with 206 more rows
#> # A tibble: 216 × 5
#>    country             capture aquaculture  total continent
#>    <chr>                 <dbl>       <dbl>  <dbl> <chr>    
#>  1 Afghanistan            1000        1200   2200 Asia     
#>  2 Albania                7886         950   8836 Europe   
#>  3 Algeria               95000        1361  96361 Africa   
#>  4 American Samoa         3047          20   3067 Oceania  
#>  5 Andorra                   0           0      0 Europe   
#>  6 Angola               486490         655 487145 Africa   
#>  7 Antigua and Barbuda    3000          10   3010 <NA>     
#>  8 Argentina            755226        3673 758899 Americas 
#>  9 Armenia                3758       16381  20139 Asia     
#> 10 Aruba                   142           0    142 Americas 
#> # … with 206 more rows
fisheries %>% filter(is.na(continent))   # same result - countries not belonging to a continent
#> # A tibble: 20 × 5
#>    country                          capture aquaculture   total continent
#>    <chr>                              <dbl>       <dbl>   <dbl> <chr>    
#>  1 Antigua and Barbuda                 3000          10    3010 <NA>     
#>  2 Bosnia and Herzegovina               305        4564    4869 <NA>     
#>  3 Czech Republic                      3507       20952   24459 <NA>     
#>  4 Democratic Republic of the Congo  237372        3161  240533 <NA>     
#>  5 Eswatini                              65         100     165 <NA>     
#>  6 Federated States of Micronesia     88397           0   88397 <NA>     
#>  7 Ivory Coast                        67500        4701   72201 <NA>     
#>  8 Jersey and Guernsey                 2985        1499    4484 <NA>     
#>  9 Macao                               1500           0    1500 <NA>     
#> 10 Myanmar                          2072390     1017644 3090034 <NA>     
#> 11 North Macedonia                      306         986    1292 <NA>     
#> 12 Palestine                           3306         280    3586 <NA>     
#> 13 Republic of the Congo              86748         177   86925 <NA>     
#> 14 Saint Kitts and Nevis              65734           1   65735 <NA>     
#> 15 Saint Lucia                         2097          32    2129 <NA>     
#> 16 Saint Vincent and the Grenadines   23077           0   23077 <NA>     
#> 17 São Tomé and Príncipe              11750           0   11750 <NA>     
#> 18 Trinidad and Tobago                13027          11   13038 <NA>     
#> 19 Turks and Caicos Islands            2780           0    2780 <NA>     
#> 20 US Virgin Islands                    551           8     559 <NA>
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Sxpp0KJl0t5n77KQppZl">Solution</button>

<div class="modal fade bs-example-modal-lg" id="lNudKyBJiTHSZBxXONbi" tabindex="-1" role="dialog" aria-labelledby="lNudKyBJiTHSZBxXONbi-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="lNudKyBJiTHSZBxXONbi-title">Hint 2</h4></div><div class="modal-body">

```r
fisheries %>% 
  anti_join(___)      # countries not belonging to a continent
fisheries <- fisheries %>% 
  print() %>% 
  left_join(___) %>% 
  print()
fisheries %>% 
  filter(is.na(___))   # same result - countries not belonging to a continent
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#lNudKyBJiTHSZBxXONbi">Hint 2</button>

<div class="modal fade bs-example-modal-lg" id="69wCPOGSqRnFbLYWSzXy" tabindex="-1" role="dialog" aria-labelledby="69wCPOGSqRnFbLYWSzXy-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="69wCPOGSqRnFbLYWSzXy-title">Hint 1</h4></div><div class="modal-body">

<p>You could use <code>anti_join</code> to find missing values. Use <code>left_join</code> to join the datasets.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#69wCPOGSqRnFbLYWSzXy">Hint 1</button>

1) Use a mutating join to add a continent column to the `fisheries` dataset. Are there some countries which do not belong to a continent? 




<div class="modal fade bs-example-modal-lg" id="sbv0w4a8Yot57v62MLXi" tabindex="-1" role="dialog" aria-labelledby="sbv0w4a8Yot57v62MLXi-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="sbv0w4a8Yot57v62MLXi-title">Solution</h4></div><div class="modal-body">

```r
fisheries <- fisheries %>%
  filter(total > 100000)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#sbv0w4a8Yot57v62MLXi">Solution</button>

<div class="modal fade bs-example-modal-lg" id="9fbDov9njyZXlmOz5vs0" tabindex="-1" role="dialog" aria-labelledby="9fbDov9njyZXlmOz5vs0-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="9fbDov9njyZXlmOz5vs0-title">Hint</h4></div><div class="modal-body">

```r
fisheries <- ___ %>%
  filter(___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#9fbDov9njyZXlmOz5vs0">Hint</button>

2) Filter out countries whose total harvest was less than 100,000 tons.




<div class="modal fade bs-example-modal-lg" id="6pbjbNYS4yfkmsT4dIUX" tabindex="-1" role="dialog" aria-labelledby="6pbjbNYS4yfkmsT4dIUX-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="6pbjbNYS4yfkmsT4dIUX-title">Solution</h4></div><div class="modal-body">

```r
fisheries %>% filter(is.na(continent))
#> # A tibble: 2 × 5
#>   country                          capture aquaculture   total continent
#>   <chr>                              <dbl>       <dbl>   <dbl> <chr>    
#> 1 Democratic Republic of the Congo  237372        3161  240533 <NA>     
#> 2 Myanmar                          2072390     1017644 3090034 <NA>
fisheries <- fisheries %>%
  mutate(continent = case_when(
    country == "Democratic Republic of the Congo" ~ "Africa",
    country == "Hong Kong"                        ~ "Asia",
    country == "Myanmar"                          ~ "Asia",
    TRUE                                          ~ continent
    )
  )
fisheries %>% filter(is.na(continent))
#> # A tibble: 0 × 5
#> # … with 5 variables: country <chr>, capture <dbl>, aquaculture <dbl>, total <dbl>, continent <chr>
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#6pbjbNYS4yfkmsT4dIUX">Solution</button>

<div class="modal fade bs-example-modal-lg" id="JWm7gQt4agewu9Wy95bz" tabindex="-1" role="dialog" aria-labelledby="JWm7gQt4agewu9Wy95bz-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="JWm7gQt4agewu9Wy95bz-title">Hint</h4></div><div class="modal-body">

```r
fisheries %>% filter(is.na(continent))
fisheries <- ___ %>%
  mutate(continent = case_when(
    country == ___ ~ "Africa",
    country == ___ ~ "Asia",
    country == ___ ~ "Asia",
    TRUE           ~ continent
    )
  )
fisheries %>% filter(is.na(continent))
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#JWm7gQt4agewu9Wy95bz">Hint</button>

3) If still any countries not belonging to a continent then add them to the closest continent.




<div class="modal fade bs-example-modal-lg" id="RCHdRgxoQEibMpeuiK7K" tabindex="-1" role="dialog" aria-labelledby="RCHdRgxoQEibMpeuiK7K-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="RCHdRgxoQEibMpeuiK7K-title">Solution</h4></div><div class="modal-body">

```r
fisheries <- fisheries %>% 
  mutate(aquaculture_perc = aquaculture / total)
```


<p>The percentage of fish harvest done using aquaculture.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#RCHdRgxoQEibMpeuiK7K">Solution</button>

<div class="modal fade bs-example-modal-lg" id="Dp4JUB9hOf27IwLtt2dK" tabindex="-1" role="dialog" aria-labelledby="Dp4JUB9hOf27IwLtt2dK-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Dp4JUB9hOf27IwLtt2dK-title">Hint</h4></div><div class="modal-body">

```r
fisheries <- ___ %>% 
  mutate(___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Dp4JUB9hOf27IwLtt2dK">Hint</button>

4) Add column `aquaculture_perc = aquaculture / total` and explain the variable.





<div class="modal fade bs-example-modal-lg" id="Tduf4hvBBBbEGihlIe0v" tabindex="-1" role="dialog" aria-labelledby="Tduf4hvBBBbEGihlIe0v-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Tduf4hvBBBbEGihlIe0v-title">Solution</h4></div><div class="modal-body">

```r
fisheries %>%                 
  group_by(continent) %>%                      
  summarize(mean_ap = mean(aquaculture_perc))           
#> # A tibble: 5 × 2
#>   continent mean_ap
#>   <chr>       <dbl>
#> 1 Africa     0.0943
#> 2 Americas   0.192 
#> 3 Asia       0.367 
#> 4 Europe     0.165 
#> 5 Oceania    0.150
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Tduf4hvBBBbEGihlIe0v">Solution</button>

<div class="modal fade bs-example-modal-lg" id="PcCcN9eUrcIunbUQnUTa" tabindex="-1" role="dialog" aria-labelledby="PcCcN9eUrcIunbUQnUTa-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="PcCcN9eUrcIunbUQnUTa-title">Hint</h4></div><div class="modal-body">

```r
fisheries %>%                  # start with the fisheries data frame
  ___ %>%                      # group by continent
  ___(mean_ap = ___)           # calculate mean aquaculture
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#PcCcN9eUrcIunbUQnUTa">Hint</button>

5) Calculate the mean aquaculture percentage (we'll call it `mean_ap` for short) for continents in the fisheries data.




<div class="modal fade bs-example-modal-lg" id="KV0qWhaHw2dNAEptu7UL" tabindex="-1" role="dialog" aria-labelledby="KV0qWhaHw2dNAEptu7UL-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="KV0qWhaHw2dNAEptu7UL-title">Solution</h4></div><div class="modal-body">

```r
fisheries_summary_continent <- fisheries %>%                 
  group_by(continent) %>%                      
  summarize(mean_ap = mean(aquaculture_perc), min_ap = min(aquaculture_perc), max_ap = max(aquaculture_perc)) %>% 
  print()
#> # A tibble: 5 × 4
#>   continent mean_ap  min_ap max_ap
#>   <chr>       <dbl>   <dbl>  <dbl>
#> 1 Africa     0.0943 0        0.803
#> 2 Americas   0.192  0        0.529
#> 3 Asia       0.367  0        0.782
#> 4 Europe     0.165  0.00682  0.618
#> 5 Oceania    0.150  0.0197   0.357
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#KV0qWhaHw2dNAEptu7UL">Solution</button>

<div class="modal fade bs-example-modal-lg" id="zzdjXUrGZKTd9MyqtjLO" tabindex="-1" role="dialog" aria-labelledby="zzdjXUrGZKTd9MyqtjLO-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="zzdjXUrGZKTd9MyqtjLO-title">Hint</h4></div><div class="modal-body">

```r
fisheries_summary_continent <- fisheries %>%    # start with the fisheries data frame
  ___ %>%                                       # group by continent
  ___(mean_ap = ___, min_ap = ___, ___)         # calculate mean aquaculture
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#zzdjXUrGZKTd9MyqtjLO">Hint</button>

6) Now expand your calculations to also calculate the minimum and maximum 
aquaculture percentage for continents in the fisheries data and store the summary table in a data frame called `fisheries_summary_continent`. 




<div class="modal fade bs-example-modal-lg" id="31myaZL80A1YJ1hzOy6j" tabindex="-1" role="dialog" aria-labelledby="31myaZL80A1YJ1hzOy6j-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="31myaZL80A1YJ1hzOy6j-title">Solution</h4></div><div class="modal-body">

```r
fisheries_summary_continent %>%      
  arrange(desc(mean_ap))                             
#> # A tibble: 5 × 4
#>   continent mean_ap  min_ap max_ap
#>   <chr>       <dbl>   <dbl>  <dbl>
#> 1 Asia       0.367  0        0.782
#> 2 Americas   0.192  0        0.529
#> 3 Europe     0.165  0.00682  0.618
#> 4 Oceania    0.150  0.0197   0.357
#> 5 Africa     0.0943 0        0.803
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#31myaZL80A1YJ1hzOy6j">Solution</button>

<div class="modal fade bs-example-modal-lg" id="3KDAe4uOynW8BsoY1VDF" tabindex="-1" role="dialog" aria-labelledby="3KDAe4uOynW8BsoY1VDF-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="3KDAe4uOynW8BsoY1VDF-title">Hint</h4></div><div class="modal-body">

```r
fisheries_summary_continent %>%      # start with the fisheries_summary_continent data frame
  ___                                # order in descending order of mean_ap
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#3KDAe4uOynW8BsoY1VDF">Hint</button>

7) Take the `fisheries_summary_continent` data frame and order the results in descending 
order of mean aquaculture percentage.




<div class="modal fade bs-example-modal-lg" id="tcI4lM4qtaDk7UZDaxsb" tabindex="-1" role="dialog" aria-labelledby="tcI4lM4qtaDk7UZDaxsb-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="tcI4lM4qtaDk7UZDaxsb-title">Solution</h4></div><div class="modal-body">

```r
ggplot(fisheries_summary_continent, 
       aes(y = reorder(continent, mean_ap), x = mean_ap)) +
  geom_col() +
  labs(
    x = "",
    y = "",
    title = "Average share of aquaculture by continent",
    subtitle = "out of total fisheries harvest",
    caption = "Source: bit.ly/2VrawTt"
  ) 
```

<img src="07-03_r-transform_files/figure-html/unnamed-chunk-111-1.png" width="672" style="display: block; margin: auto;" />
<p>An example plot</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#tcI4lM4qtaDk7UZDaxsb">Solution</button>

8) If you already have read the module about visualizations, then try to make some relevant plots.






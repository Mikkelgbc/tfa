<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Module 18 Spatial data and maps | Tools for Analytics (TFA)</title>
  <meta name="description" content="Course notes for the ‘Tools for Analytics’ course" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Module 18 Spatial data and maps | Tools for Analytics (TFA)" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://bss-osca.github.io/tfa/" />
  <meta property="og:image" content="https://bss-osca.github.io/tfa//assets/logo.png" />
  <meta property="og:description" content="Course notes for the ‘Tools for Analytics’ course" />
  <meta name="github-repo" content="bss-osca/tfa" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Module 18 Spatial data and maps | Tools for Analytics (TFA)" />
  
  <meta name="twitter:description" content="Course notes for the ‘Tools for Analytics’ course" />
  <meta name="twitter:image" content="https://bss-osca.github.io/tfa//assets/logo.png" />

<meta name="author" content="Lars Relund Nielsen" />


<meta name="date" content="2021-08-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon" />
<link rel="prev" href="mod-project.html"/>
<link rel="next" href="mod-r-excel.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
<link href="libs/font-awesome-5.3.1/css/all.min.css" rel="stylesheet" />
<link href="libs/font-awesome-5.3.1/css/v4-shims.min.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>
<link href="libs/minichart-0.2.2/minicharts.css" rel="stylesheet" />
<script src="libs/minichart-0.2.2/leaflet.minicharts.min.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.18/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<html>
<head>
<script>
  $(document).ready(function() {

  // Section anchors
  $('.section h1, .section h2, .section h3, .section h4, .section h5').each(function() {
    anchor = '#' + $(this).parent().attr('id');
    $(this).addClass("hasAnchor").prepend('<a href="' + anchor + '" class="anchor"></a>');
  });
});
</script>
<script src="https://hypothes.is/embed.js" async></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</head>
</html>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="img/logo.png"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction to the book</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#lo-intro"><i class="fa fa-check"></i><b>1.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#purpose"><i class="fa fa-check"></i><b>1.2</b> Purpose for the book</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#r-vs-vba"><i class="fa fa-check"></i><b>1.3</b> R vs Excel/VBA</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#computer"><i class="fa fa-check"></i><b>1.4</b> How a computer works</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#organization"><i class="fa fa-check"></i><b>1.5</b> How this book is organized</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#ack"><i class="fa fa-check"></i><b>1.6</b> Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I Getting started with VBA</b></span></li>
<li class="chapter" data-level="2" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html"><i class="fa fa-check"></i><b>2</b> An introduction to VBA</a>
<ul>
<li class="chapter" data-level="2.1" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#lo-vba-intro"><i class="fa fa-check"></i><b>2.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="2.2" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#vba-what"><i class="fa fa-check"></i><b>2.2</b> What is VBA</a></li>
<li class="chapter" data-level="2.3" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#vba-hello"><i class="fa fa-check"></i><b>2.3</b> Your first program</a></li>
<li class="chapter" data-level="2.4" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#vba-macro"><i class="fa fa-check"></i><b>2.4</b> The macro recorder</a></li>
<li class="chapter" data-level="2.5" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#a-short-overview"><i class="fa fa-check"></i><b>2.5</b> A short overview</a></li>
<li class="chapter" data-level="2.6" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#rc-vba-intro"><i class="fa fa-check"></i><b>2.6</b> Recap</a></li>
<li class="chapter" data-level="2.7" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-intro"><i class="fa fa-check"></i><b>2.7</b> Exercises</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-hello"><i class="fa fa-check"></i><b>2.7.1</b> Exercise - Hello</a></li>
<li class="chapter" data-level="2.7.2" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-macro"><i class="fa fa-check"></i><b>2.7.2</b> Exercise - Record a macro</a></li>
<li class="chapter" data-level="2.7.3" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-user-input"><i class="fa fa-check"></i><b>2.7.3</b> Exercise - User input</a></li>
<li class="chapter" data-level="2.7.4" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-max-min"><i class="fa fa-check"></i><b>2.7.4</b> Exercise - Max and min number</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Programming in VBA</b></span></li>
<li class="chapter" data-level="3" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html"><i class="fa fa-check"></i><b>3</b> Data types and variables</a>
<ul>
<li class="chapter" data-level="3.1" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#lo-vba-datatypes"><i class="fa fa-check"></i><b>3.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="3.2" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#vba-datatypes"><i class="fa fa-check"></i><b>3.2</b> Datatypes</a></li>
<li class="chapter" data-level="3.3" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#vba-code-structure"><i class="fa fa-check"></i><b>3.3</b> How do I structure my code?</a></li>
<li class="chapter" data-level="3.4" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#recap"><i class="fa fa-check"></i><b>3.4</b> Recap</a></li>
<li class="chapter" data-level="3.5" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-datatypes"><i class="fa fa-check"></i><b>3.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-search-products"><i class="fa fa-check"></i><b>3.5.1</b> Exercise - Product search</a></li>
<li class="chapter" data-level="3.5.2" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-read-arrays"><i class="fa fa-check"></i><b>3.5.2</b> Exercise - Read Arrays</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html"><i class="fa fa-check"></i><b>4</b> Procedures</a>
<ul>
<li class="chapter" data-level="4.1" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#lo-vba-procedures"><i class="fa fa-check"></i><b>4.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="4.2" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#vba-procedures"><i class="fa fa-check"></i><b>4.2</b> Procedures</a></li>
<li class="chapter" data-level="4.3" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#vba-debug"><i class="fa fa-check"></i><b>4.3</b> How do I debug my code?</a></li>
<li class="chapter" data-level="4.4" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#recap-1"><i class="fa fa-check"></i><b>4.4</b> Recap</a></li>
<li class="chapter" data-level="4.5" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#ex-vba-procedures"><i class="fa fa-check"></i><b>4.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#ex-vba-subs"><i class="fa fa-check"></i><b>4.5.1</b> Exercise - Subs</a></li>
<li class="chapter" data-level="4.5.2" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#ex-vba-functions"><i class="fa fa-check"></i><b>4.5.2</b> Exercise - Functions</a></li>
<li class="chapter" data-level="4.5.3" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#ex-vba-worksheet-functions"><i class="fa fa-check"></i><b>4.5.3</b> Exercise - Worksheet functions</a></li>
<li class="chapter" data-level="4.5.4" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#ex-vba-byref"><i class="fa fa-check"></i><b>4.5.4</b> Exercise - <code>ByRef</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html"><i class="fa fa-check"></i><b>5</b> Loops and conditional statements</a>
<ul>
<li class="chapter" data-level="5.1" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#lo-vba-loops-cond"><i class="fa fa-check"></i><b>5.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="5.2" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#vba-cond"><i class="fa fa-check"></i><b>5.2</b> Conditional statements</a></li>
<li class="chapter" data-level="5.3" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#vba-loops"><i class="fa fa-check"></i><b>5.3</b> Loops</a></li>
<li class="chapter" data-level="5.4" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#recap-2"><i class="fa fa-check"></i><b>5.4</b> Recap</a></li>
<li class="chapter" data-level="5.5" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#ex-vba-loops-cond"><i class="fa fa-check"></i><b>5.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#ex-vba-loops"><i class="fa fa-check"></i><b>5.5.1</b> Exercise - Loops</a></li>
<li class="chapter" data-level="5.5.2" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#ex-vba-flight"><i class="fa fa-check"></i><b>5.5.2</b> Exercise - Flight search</a></li>
<li class="chapter" data-level="5.5.3" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#ex-vba-job-seq"><i class="fa fa-check"></i><b>5.5.3</b> Exercise - Job sequencing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mod-vba-object-model.html"><a href="mod-vba-object-model.html"><i class="fa fa-check"></i><b>6</b> Object model</a></li>
<li class="part"><span><b>III Randomization in VBA</b></span></li>
<li class="chapter" data-level="7" data-path="generating-random-values.html"><a href="generating-random-values.html"><i class="fa fa-check"></i><b>7</b> Generating random values</a>
<ul>
<li class="chapter" data-level="7.1" data-path="generating-random-values.html"><a href="generating-random-values.html#learning-outcomes"><i class="fa fa-check"></i><b>7.1</b> Learning outcomes</a></li>
</ul></li>
<li class="part"><span><b>IV Extra topics in VBA</b></span></li>
<li class="chapter" data-level="8" data-path="file-management.html"><a href="file-management.html"><i class="fa fa-check"></i><b>8</b> File management</a>
<ul>
<li class="chapter" data-level="8.1" data-path="file-management.html"><a href="file-management.html#learning-outcomes-1"><i class="fa fa-check"></i><b>8.1</b> Learning outcomes</a></li>
</ul></li>
<li class="part"><span><b>V Getting started in R</b></span></li>
<li class="chapter" data-level="9" data-path="mod-install.html"><a href="mod-install.html"><i class="fa fa-check"></i><b>9</b> Install R and RStudio</a>
<ul>
<li class="chapter" data-level="9.1" data-path="mod-install.html"><a href="mod-install.html#lo-install"><i class="fa fa-check"></i><b>9.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="9.2" data-path="mod-install.html"><a href="mod-install.html#install-r"><i class="fa fa-check"></i><b>9.2</b> Install R and RStudio</a></li>
<li class="chapter" data-level="9.3" data-path="mod-install.html"><a href="mod-install.html#test-your-installation"><i class="fa fa-check"></i><b>9.3</b> Test your installation</a></li>
<li class="chapter" data-level="9.4" data-path="mod-install.html"><a href="mod-install.html#add-on-packages"><i class="fa fa-check"></i><b>9.4</b> Add-on packages</a></li>
<li class="chapter" data-level="9.5" data-path="mod-install.html"><a href="mod-install.html#lp-install"><i class="fa fa-check"></i><b>9.5</b> Different learning paths</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="mod-r-basics.html"><a href="mod-r-basics.html"><i class="fa fa-check"></i><b>10</b> R basics and workflows</a>
<ul>
<li class="chapter" data-level="" data-path="mod-r-basics.html"><a href="mod-r-basics.html#learning-path-diagramme"><i class="fa fa-check"></i>Learning path diagramme</a></li>
<li class="chapter" data-level="10.1" data-path="mod-r-basics.html"><a href="mod-r-basics.html#lo-r-basics"><i class="fa fa-check"></i><b>10.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="10.2" data-path="mod-r-basics.html"><a href="mod-r-basics.html#working-with-r-at-the-command-line-in-rstudio"><i class="fa fa-check"></i><b>10.2</b> Working with R at the command line in RStudio</a></li>
<li class="chapter" data-level="10.3" data-path="mod-r-basics.html"><a href="mod-r-basics.html#your-first-datacamp-course"><i class="fa fa-check"></i><b>10.3</b> Your first DataCamp course</a></li>
<li class="chapter" data-level="10.4" data-path="mod-r-basics.html"><a href="mod-r-basics.html#pipes"><i class="fa fa-check"></i><b>10.4</b> Pipes</a></li>
<li class="chapter" data-level="10.5" data-path="mod-r-basics.html"><a href="mod-r-basics.html#rprojs"><i class="fa fa-check"></i><b>10.5</b> RStudio projects</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="mod-r-basics.html"><a href="mod-r-basics.html#storing-your-code-in-a-script-file"><i class="fa fa-check"></i><b>10.5.1</b> Storing your code in a script file</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="mod-r-basics.html"><a href="mod-r-basics.html#global-options"><i class="fa fa-check"></i><b>10.6</b> Global options</a></li>
<li class="chapter" data-level="10.7" data-path="mod-r-basics.html"><a href="mod-r-basics.html#working-directory"><i class="fa fa-check"></i><b>10.7</b> Working directory</a></li>
<li class="chapter" data-level="10.8" data-path="mod-r-basics.html"><a href="mod-r-basics.html#lp-r-basics"><i class="fa fa-check"></i><b>10.8</b> Different learning paths</a></li>
<li class="chapter" data-level="10.9" data-path="mod-r-basics.html"><a href="mod-r-basics.html#rc-r-basics"><i class="fa fa-check"></i><b>10.9</b> Recap</a></li>
<li class="chapter" data-level="10.10" data-path="mod-r-basics.html"><a href="mod-r-basics.html#ex-r-basics"><i class="fa fa-check"></i><b>10.10</b> Exercises</a>
<ul>
<li class="chapter" data-level="10.10.1" data-path="mod-r-basics.html"><a href="mod-r-basics.html#exercise-group-work"><i class="fa fa-check"></i><b>10.10.1</b> Exercise (group work)</a></li>
<li class="chapter" data-level="10.10.2" data-path="mod-r-basics.html"><a href="mod-r-basics.html#exercise-install-packages"><i class="fa fa-check"></i><b>10.10.2</b> Exercise (install packages)</a></li>
<li class="chapter" data-level="10.10.3" data-path="mod-r-basics.html"><a href="mod-r-basics.html#exercise-piping"><i class="fa fa-check"></i><b>10.10.3</b> Exercise (piping)</a></li>
<li class="chapter" data-level="10.10.4" data-path="mod-r-basics.html"><a href="mod-r-basics.html#exercise-working-dir"><i class="fa fa-check"></i><b>10.10.4</b> Exercise (working dir)</a></li>
<li class="chapter" data-level="10.10.5" data-path="mod-r-basics.html"><a href="mod-r-basics.html#exercise-vectors"><i class="fa fa-check"></i><b>10.10.5</b> Exercise (vectors)</a></li>
<li class="chapter" data-level="10.10.6" data-path="mod-r-basics.html"><a href="mod-r-basics.html#exercise-matrices"><i class="fa fa-check"></i><b>10.10.6</b> Exercise (matrices)</a></li>
<li class="chapter" data-level="10.10.7" data-path="mod-r-basics.html"><a href="mod-r-basics.html#exercise-data-frames"><i class="fa fa-check"></i><b>10.10.7</b> Exercise (data frames)</a></li>
<li class="chapter" data-level="10.10.8" data-path="mod-r-basics.html"><a href="mod-r-basics.html#exercise-lists"><i class="fa fa-check"></i><b>10.10.8</b> Exercise (lists)</a></li>
<li class="chapter" data-level="10.10.9" data-path="mod-r-basics.html"><a href="mod-r-basics.html#ex-strings"><i class="fa fa-check"></i><b>10.10.9</b> Exercise (string management)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VI Programming in R</b></span></li>
<li class="chapter" data-level="11" data-path="mod-loops.html"><a href="mod-loops.html"><i class="fa fa-check"></i><b>11</b> Loops and conditionals</a>
<ul>
<li class="chapter" data-level="" data-path="mod-loops.html"><a href="mod-loops.html#learning-path-diagramme-1"><i class="fa fa-check"></i>Learning path diagramme</a></li>
<li class="chapter" data-level="11.1" data-path="mod-loops.html"><a href="mod-loops.html#lo-loops"><i class="fa fa-check"></i><b>11.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="11.2" data-path="mod-loops.html"><a href="mod-loops.html#conditionals-and-control-flow"><i class="fa fa-check"></i><b>11.2</b> Conditionals and control flow</a></li>
<li class="chapter" data-level="11.3" data-path="mod-loops.html"><a href="mod-loops.html#loops"><i class="fa fa-check"></i><b>11.3</b> Loops</a></li>
<li class="chapter" data-level="11.4" data-path="mod-loops.html"><a href="mod-loops.html#lp-loops"><i class="fa fa-check"></i><b>11.4</b> Different learning paths</a></li>
<li class="chapter" data-level="11.5" data-path="mod-loops.html"><a href="mod-loops.html#rc-loops"><i class="fa fa-check"></i><b>11.5</b> Recap</a></li>
<li class="chapter" data-level="11.6" data-path="mod-loops.html"><a href="mod-loops.html#ex-loops"><i class="fa fa-check"></i><b>11.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="mod-loops.html"><a href="mod-loops.html#exercise-conditional-expressions"><i class="fa fa-check"></i><b>11.6.1</b> Exercise (conditional expressions)</a></li>
<li class="chapter" data-level="11.6.2" data-path="mod-loops.html"><a href="mod-loops.html#exercise-loops"><i class="fa fa-check"></i><b>11.6.2</b> Exercise (loops)</a></li>
<li class="chapter" data-level="11.6.3" data-path="mod-loops.html"><a href="mod-loops.html#ex-dist"><i class="fa fa-check"></i><b>11.6.3</b> Exercise (calculating distances)</a></li>
<li class="chapter" data-level="11.6.4" data-path="mod-loops.html"><a href="mod-loops.html#exercise-expand_grid"><i class="fa fa-check"></i><b>11.6.4</b> Exercise (<code>expand_grid</code>)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="mod-functions.html"><a href="mod-functions.html"><i class="fa fa-check"></i><b>12</b> Functions</a>
<ul>
<li class="chapter" data-level="12.1" data-path="mod-functions.html"><a href="mod-functions.html#lo-functions"><i class="fa fa-check"></i><b>12.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="12.2" data-path="mod-functions.html"><a href="mod-functions.html#datacamp-course"><i class="fa fa-check"></i><b>12.2</b> DataCamp course</a></li>
<li class="chapter" data-level="12.3" data-path="mod-functions.html"><a href="mod-functions.html#functions-returning-multiple-objects"><i class="fa fa-check"></i><b>12.3</b> Functions returning multiple objects</a></li>
<li class="chapter" data-level="12.4" data-path="mod-functions.html"><a href="mod-functions.html#the-...-argument"><i class="fa fa-check"></i><b>12.4</b> The <code>...</code> argument</a></li>
<li class="chapter" data-level="12.5" data-path="mod-functions.html"><a href="mod-functions.html#documenting-your-functions"><i class="fa fa-check"></i><b>12.5</b> Documenting your functions</a></li>
<li class="chapter" data-level="12.6" data-path="mod-functions.html"><a href="mod-functions.html#lp-functions"><i class="fa fa-check"></i><b>12.6</b> Different learning paths</a></li>
<li class="chapter" data-level="12.7" data-path="mod-functions.html"><a href="mod-functions.html#rc-functions"><i class="fa fa-check"></i><b>12.7</b> Recap</a></li>
<li class="chapter" data-level="12.8" data-path="mod-functions.html"><a href="mod-functions.html#ex-functions"><i class="fa fa-check"></i><b>12.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="12.8.1" data-path="mod-functions.html"><a href="mod-functions.html#exercise-defining-functions"><i class="fa fa-check"></i><b>12.8.1</b> Exercise (defining functions)</a></li>
<li class="chapter" data-level="12.8.2" data-path="mod-functions.html"><a href="mod-functions.html#exercise-scope"><i class="fa fa-check"></i><b>12.8.2</b> Exercise (scope)</a></li>
<li class="chapter" data-level="12.8.3" data-path="mod-functions.html"><a href="mod-functions.html#exercise-job-sequencing"><i class="fa fa-check"></i><b>12.8.3</b> Exercise (job sequencing)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VII IO, tidy and transform</b></span></li>
<li class="chapter" data-level="13" data-path="mod-tidy-intro.html"><a href="mod-tidy-intro.html"><i class="fa fa-check"></i><b>13</b> Introduction to tidyverse and R Markdown</a>
<ul>
<li class="chapter" data-level="13.1" data-path="mod-tidy-intro.html"><a href="mod-tidy-intro.html#lo-tidy-intro"><i class="fa fa-check"></i><b>13.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="13.2" data-path="mod-tidy-intro.html"><a href="mod-tidy-intro.html#the-tidyverse-package"><i class="fa fa-check"></i><b>13.2</b> The tidyverse package</a></li>
<li class="chapter" data-level="13.3" data-path="mod-tidy-intro.html"><a href="mod-tidy-intro.html#writing-reproducible-reports"><i class="fa fa-check"></i><b>13.3</b> Writing reproducible reports</a></li>
<li class="chapter" data-level="13.4" data-path="mod-tidy-intro.html"><a href="mod-tidy-intro.html#tibbles"><i class="fa fa-check"></i><b>13.4</b> Tibbles</a></li>
<li class="chapter" data-level="13.5" data-path="mod-tidy-intro.html"><a href="mod-tidy-intro.html#lp-tidy-intro"><i class="fa fa-check"></i><b>13.5</b> Different learning paths</a></li>
<li class="chapter" data-level="13.6" data-path="mod-tidy-intro.html"><a href="mod-tidy-intro.html#rc-tidy-intro"><i class="fa fa-check"></i><b>13.6</b> Recap</a></li>
<li class="chapter" data-level="13.7" data-path="mod-tidy-intro.html"><a href="mod-tidy-intro.html#ex-tidy-intro"><i class="fa fa-check"></i><b>13.7</b> Exercises</a>
<ul>
<li class="chapter" data-level="13.7.1" data-path="mod-tidy-intro.html"><a href="mod-tidy-intro.html#exercise-your-first-r-markdown-exercise"><i class="fa fa-check"></i><b>13.7.1</b> Exercise (your first R Markdown exercise)</a></li>
<li class="chapter" data-level="13.7.2" data-path="mod-tidy-intro.html"><a href="mod-tidy-intro.html#exercise-tibbles"><i class="fa fa-check"></i><b>13.7.2</b> Exercise (tibbles)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="mod-io.html"><a href="mod-io.html"><i class="fa fa-check"></i><b>14</b> Importing and exporting data</a>
<ul>
<li class="chapter" data-level="14.1" data-path="mod-io.html"><a href="mod-io.html#lo-io"><i class="fa fa-check"></i><b>14.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="14.2" data-path="mod-io.html"><a href="mod-io.html#csv-files"><i class="fa fa-check"></i><b>14.2</b> CSV files</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="mod-io.html"><a href="mod-io.html#reading-a-csv-file"><i class="fa fa-check"></i><b>14.2.1</b> Reading a CSV file</a></li>
<li class="chapter" data-level="14.2.2" data-path="mod-io.html"><a href="mod-io.html#writing-to-csv-files"><i class="fa fa-check"></i><b>14.2.2</b> Writing to CSV files</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="mod-io.html"><a href="mod-io.html#excel"><i class="fa fa-check"></i><b>14.3</b> Excel</a></li>
<li class="chapter" data-level="14.4" data-path="mod-io.html"><a href="mod-io.html#google-sheets"><i class="fa fa-check"></i><b>14.4</b> Google Sheets</a></li>
<li class="chapter" data-level="14.5" data-path="mod-io.html"><a href="mod-io.html#text-files"><i class="fa fa-check"></i><b>14.5</b> Text files</a></li>
<li class="chapter" data-level="14.6" data-path="mod-io.html"><a href="mod-io.html#rs-native-binary-format"><i class="fa fa-check"></i><b>14.6</b> R’s native binary format</a></li>
<li class="chapter" data-level="14.7" data-path="mod-io.html"><a href="mod-io.html#json"><i class="fa fa-check"></i><b>14.7</b> Json</a></li>
<li class="chapter" data-level="14.8" data-path="mod-io.html"><a href="mod-io.html#lp-io"><i class="fa fa-check"></i><b>14.8</b> Different learning paths</a></li>
<li class="chapter" data-level="14.9" data-path="mod-io.html"><a href="mod-io.html#rc-io"><i class="fa fa-check"></i><b>14.9</b> Recap</a></li>
<li class="chapter" data-level="14.10" data-path="mod-io.html"><a href="mod-io.html#ex-io"><i class="fa fa-check"></i><b>14.10</b> Exercises</a>
<ul>
<li class="chapter" data-level="14.10.1" data-path="mod-io.html"><a href="mod-io.html#exercise-statistikbanken"><i class="fa fa-check"></i><b>14.10.1</b> Exercise (Statistikbanken)</a></li>
<li class="chapter" data-level="14.10.2" data-path="mod-io.html"><a href="mod-io.html#exercise-tuples-in-opl"><i class="fa fa-check"></i><b>14.10.2</b> Exercise (tuples in OPL)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="mod-transform.html"><a href="mod-transform.html"><i class="fa fa-check"></i><b>15</b> Transforming data</a>
<ul>
<li class="chapter" data-level="15.1" data-path="mod-transform.html"><a href="mod-transform.html#lo-transform"><i class="fa fa-check"></i><b>15.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="15.2" data-path="mod-transform.html"><a href="mod-transform.html#working-with-data-in-the-tidyverse"><i class="fa fa-check"></i><b>15.2</b> Working with data in the tidyverse</a></li>
<li class="chapter" data-level="15.3" data-path="mod-transform.html"><a href="mod-transform.html#mutating-and-filtering-joins"><i class="fa fa-check"></i><b>15.3</b> Mutating and filtering joins</a></li>
<li class="chapter" data-level="15.4" data-path="mod-transform.html"><a href="mod-transform.html#lp-transform"><i class="fa fa-check"></i><b>15.4</b> Different learning paths</a></li>
<li class="chapter" data-level="15.5" data-path="mod-transform.html"><a href="mod-transform.html#rc-transform"><i class="fa fa-check"></i><b>15.5</b> Recap</a></li>
<li class="chapter" data-level="15.6" data-path="mod-transform.html"><a href="mod-transform.html#ex-transform"><i class="fa fa-check"></i><b>15.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="15.6.1" data-path="mod-transform.html"><a href="mod-transform.html#ex-gapminder1"><i class="fa fa-check"></i><b>15.6.1</b> Exercise (gapminder)</a></li>
<li class="chapter" data-level="15.6.2" data-path="mod-transform.html"><a href="mod-transform.html#ex-babynames1"><i class="fa fa-check"></i><b>15.6.2</b> Exercise (babynames)</a></li>
<li class="chapter" data-level="15.6.3" data-path="mod-transform.html"><a href="mod-transform.html#ex-profit1"><i class="fa fa-check"></i><b>15.6.3</b> Exercise (profit)</a></li>
<li class="chapter" data-level="15.6.4" data-path="mod-transform.html"><a href="mod-transform.html#ex-fish"><i class="fa fa-check"></i><b>15.6.4</b> Exercise (fisheries)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VIII Visualization</b></span></li>
<li class="chapter" data-level="16" data-path="mod-plot.html"><a href="mod-plot.html"><i class="fa fa-check"></i><b>16</b> Data visualization using ggplot</a>
<ul>
<li class="chapter" data-level="16.1" data-path="mod-plot.html"><a href="mod-plot.html#lo-plot"><i class="fa fa-check"></i><b>16.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="16.2" data-path="mod-plot.html"><a href="mod-plot.html#introduction-to-data-visualization"><i class="fa fa-check"></i><b>16.2</b> Introduction to data visualization</a></li>
<li class="chapter" data-level="16.3" data-path="mod-plot.html"><a href="mod-plot.html#combining-plots-into-one-using-patchwork"><i class="fa fa-check"></i><b>16.3</b> Combining plots into one using <em>patchwork</em></a></li>
<li class="chapter" data-level="16.4" data-path="mod-plot.html"><a href="mod-plot.html#saving-graphics"><i class="fa fa-check"></i><b>16.4</b> Saving graphics</a></li>
<li class="chapter" data-level="16.5" data-path="mod-plot.html"><a href="mod-plot.html#lp-r-plot"><i class="fa fa-check"></i><b>16.5</b> Different learning paths</a></li>
<li class="chapter" data-level="16.6" data-path="mod-plot.html"><a href="mod-plot.html#rc-r-plot"><i class="fa fa-check"></i><b>16.6</b> Recap</a></li>
<li class="chapter" data-level="16.7" data-path="mod-plot.html"><a href="mod-plot.html#ex-r-plot"><i class="fa fa-check"></i><b>16.7</b> Exercises</a>
<ul>
<li class="chapter" data-level="16.7.1" data-path="mod-plot.html"><a href="mod-plot.html#ex-gapminder2"><i class="fa fa-check"></i><b>16.7.1</b> Exercise (gapminder)</a></li>
<li class="chapter" data-level="16.7.2" data-path="mod-plot.html"><a href="mod-plot.html#ex-profit2"><i class="fa fa-check"></i><b>16.7.2</b> Exercise (profit)</a></li>
<li class="chapter" data-level="16.7.3" data-path="mod-plot.html"><a href="mod-plot.html#ex-covid19"><i class="fa fa-check"></i><b>16.7.3</b> Exercise (COVID-19)</a></li>
<li class="chapter" data-level="16.7.4" data-path="mod-plot.html"><a href="mod-plot.html#ex-lego"><i class="fa fa-check"></i><b>16.7.4</b> Exercise (Lego and sales)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IX R project in groups</b></span></li>
<li class="chapter" data-level="17" data-path="mod-project.html"><a href="mod-project.html"><i class="fa fa-check"></i><b>17</b> Mandatory R project</a>
<ul>
<li class="chapter" data-level="17.1" data-path="mod-project.html"><a href="mod-project.html#lo-project"><i class="fa fa-check"></i><b>17.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="17.2" data-path="mod-project.html"><a href="mod-project.html#r-project"><i class="fa fa-check"></i><b>17.2</b> R project</a></li>
</ul></li>
<li class="part"><span><b>X Extra</b></span></li>
<li class="chapter" data-level="18" data-path="mod-maps.html"><a href="mod-maps.html"><i class="fa fa-check"></i><b>18</b> Spatial data and maps</a>
<ul>
<li class="chapter" data-level="18.1" data-path="mod-maps.html"><a href="mod-maps.html#lo-maps"><i class="fa fa-check"></i><b>18.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="18.2" data-path="mod-maps.html"><a href="mod-maps.html#mod-map-api-key"><i class="fa fa-check"></i><b>18.2</b> Services for obtatining spatial data</a></li>
<li class="chapter" data-level="18.3" data-path="mod-maps.html"><a href="mod-maps.html#calculating-distances"><i class="fa fa-check"></i><b>18.3</b> Calculating distances</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="mod-maps.html"><a href="mod-maps.html#using-google-maps"><i class="fa fa-check"></i><b>18.3.1</b> Using Google Maps</a></li>
<li class="chapter" data-level="18.3.2" data-path="mod-maps.html"><a href="mod-maps.html#using-bing-maps"><i class="fa fa-check"></i><b>18.3.2</b> Using Bing Maps</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="mod-maps.html"><a href="mod-maps.html#geocoding-and-reverse-geocoding"><i class="fa fa-check"></i><b>18.4</b> Geocoding and reverse geocoding</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="mod-maps.html"><a href="mod-maps.html#using-google-maps-1"><i class="fa fa-check"></i><b>18.4.1</b> Using Google maps</a></li>
<li class="chapter" data-level="18.4.2" data-path="mod-maps.html"><a href="mod-maps.html#use-bing-maps"><i class="fa fa-check"></i><b>18.4.2</b> Use Bing Maps</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="mod-maps.html"><a href="mod-maps.html#adding-markers-and-routes-to-a-map"><i class="fa fa-check"></i><b>18.5</b> Adding markers and routes to a map</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="mod-r-excel.html"><a href="mod-r-excel.html"><i class="fa fa-check"></i><b>19</b> Using R in Excel and Excel in R</a></li>
<li class="chapter" data-level="20" data-path="mod-opl.html"><a href="mod-opl.html"><i class="fa fa-check"></i><b>20</b> Run an OPL model from R</a></li>
<li class="chapter" data-level="21" data-path="mod-simulation.html"><a href="mod-simulation.html"><i class="fa fa-check"></i><b>21</b> Simulation in R</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="groups.html"><a href="groups.html"><i class="fa fa-check"></i><b>A</b> Working in groups</a>
<ul>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#r-project-structure"><i class="fa fa-check"></i>R project structure</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#using-git"><i class="fa fa-check"></i>Using Git together with GitHub</a>
<ul>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#register-a-free-github-account"><i class="fa fa-check"></i>Register a free GitHub account</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#install-git"><i class="fa fa-check"></i>Install Git</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#check-your-installation"><i class="fa fa-check"></i>Check your installation</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#setup-projects-using-git-and-github"><i class="fa fa-check"></i>Setup projects using Git and GitHub</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="annotate.html"><a href="annotate.html"><i class="fa fa-check"></i><b>B</b> Annotate the course notes</a></li>
<li class="chapter" data-level="C" data-path="help.html"><a href="help.html"><i class="fa fa-check"></i><b>C</b> Getting help</a></li>
<li class="chapter" data-level="D" data-path="coding-convention.html"><a href="coding-convention.html"><i class="fa fa-check"></i><b>D</b> Coding/naming convention</a>
<ul>
<li class="chapter" data-level="D.1" data-path="coding-convention.html"><a href="coding-convention.html#commenting-your-code"><i class="fa fa-check"></i><b>D.1</b> Commenting your code</a></li>
</ul></li>
<li class="chapter" data-level="E" data-path="lg-course.html"><a href="lg-course.html"><i class="fa fa-check"></i><b>E</b> Learning goals</a></li>
<li class="chapter" data-level="F" data-path="sec-ba.html"><a href="sec-ba.html"><i class="fa fa-check"></i><b>F</b> Business Analytics</a></li>
<li class="chapter" data-level="G" data-path="colophon.html"><a href="colophon.html"><i class="fa fa-check"></i><b>G</b> Colophon</a></li>
<li class="divider"></li>
<li><center>
  <a rel="license" href="./index.html#ack">
    License: CC BY-NC-SA<br>
    <i class = "fab fa-creative-commons fa-2x"></i>
    <i class = "fab fa-creative-commons-by fa-2x"></i>
    <i class = "fab fa-creative-commons-nc fa-2x"></i>
    <i class = "fab fa-creative-commons-sa fa-2x"></i>
  </a>
</li></center>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tools for Analytics (TFA)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mod-maps" class="section level1" number="18">
<h1><span class="header-section-number">Module 18</span> Spatial data and maps</h1>
<p>Spatial data, also known as geospatial data, is a term used to describe any data related to or containing information about a specific location on a surface (often a map). We will consider <em>distance matrix</em> calculations for finding the shortest distance/travel time between a set of origins and destinations, <em>geocoding</em> which is the process of converting an address to geographic coordinates (latitude, longitude) and <em>reverse geocoding</em> which is the opposite process of converting a location as described by geographic coordinates (latitude, longitude) to a human-readable address or place name. Finally, we consider how to display spatial data on a map.</p>
<div id="lo-maps" class="section level2" number="18.1">
<h2><span class="header-section-number">18.1</span> Learning outcomes</h2>
<p>By the end of this module, you are expected to be able to:</p>
<ul>
<li>Calculate euclidean, manhattan, etc. distances.</li>
<li>Calculate a distance matrix, i.e. shortest paths between places using the Google and Bing API.</li>
<li>Geocode an address using the Google and Bing API.</li>
<li>Add markers and routes (lines) on a map.</li>
</ul>
<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->
</div>
<div id="mod-map-api-key" class="section level2" number="18.2">
<h2><span class="header-section-number">18.2</span> Services for obtatining spatial data</h2>
<p>Often you need to connect to a service using an API for obtaining spatial data. The most common is Google and Bing (Microsoft) and to use the services you need an API key. Another service is also <a href="https://developer.here.com/">Here</a>.</p>
<p>If you use Google Maps you can obtain an API key <a href="https://cloud.google.com/maps-platform/">here</a>. Modest to light use is free; however, you need a valid credit card. Note you must enable the APIs you intend to use. Google in fact has several services for geo-related solutions. For example, the Maps Static API provides map images, while the Geocoding API provides geocoding and reverse geocoding services. You need to enable the APIs before you use them. You will only need to do that once, and then they will be ready for you to use. Enabling the APIs just means clicking a few radio buttons on the Google Maps Platform web interface.</p>
<p>We will be using the <strong>ggmap</strong> package for Google services. You can add the API key using:</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="mod-maps.html#cb467-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb467-2"><a href="mod-maps.html#cb467-2" aria-hidden="true" tabindex="-1"></a><span class="fu">register_google</span>(<span class="at">key =</span> <span class="st">&quot;[your key]&quot;</span>, <span class="at">write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb467-3"><a href="mod-maps.html#cb467-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.getenv</span>(<span class="st">&quot;GGMAP_GOOGLE_API_KEY&quot;</span>)</span></code></pre></div>
<p>Note the key is stored in the environment object <code>GGMAP_GOOGLE_API_KEY</code>. Moreover, it is saved in the file <code>.Renviron</code> so that it is automatically reloaded when you restart R.</p>
<p>If you use Bing Maps you can obtain an API key <a href="https://www.bingmapsportal.com/">here</a>. No credit card is needed. You can add the API key using:</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="mod-maps.html#cb468-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">edit_r_environ</span>()  <span class="co"># opens the .Renviron file</span></span>
<span id="cb468-2"><a href="mod-maps.html#cb468-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">BING_MAPS_API_KEY=</span>[your key]) <span class="co"># so you don&#39;t have to restart R</span></span></code></pre></div>
<p>Add the line <code>BING_MAPS_API_KEY=[your key]</code> and save the file.</p>
<p>Note your API keys is private and unique to you, so be careful not to share it online!</p>
</div>
<div id="calculating-distances" class="section level2" number="18.3">
<h2><span class="header-section-number">18.3</span> Calculating distances</h2>
<p>If you need to calculate euclidean, manhattan, etc. distances, you can use the <code>dist</code> R function:</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="mod-maps.html#cb469-1" aria-hidden="true" tabindex="-1"></a>coord <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>, <span class="dv">0</span>,<span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>, <span class="dv">1</span>,<span class="dv">1</span>), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb469-2"><a href="mod-maps.html#cb469-2" aria-hidden="true" tabindex="-1"></a>coord</span>
<span id="cb469-3"><a href="mod-maps.html#cb469-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2]</span></span>
<span id="cb469-4"><a href="mod-maps.html#cb469-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]    0    0</span></span>
<span id="cb469-5"><a href="mod-maps.html#cb469-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]    0    1</span></span>
<span id="cb469-6"><a href="mod-maps.html#cb469-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,]    1    0</span></span>
<span id="cb469-7"><a href="mod-maps.html#cb469-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,]    1    1</span></span>
<span id="cb469-8"><a href="mod-maps.html#cb469-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dist</span>(coord)</span>
<span id="cb469-9"><a href="mod-maps.html#cb469-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      1    2    3</span></span>
<span id="cb469-10"><a href="mod-maps.html#cb469-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 1.00          </span></span>
<span id="cb469-11"><a href="mod-maps.html#cb469-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 1.00 1.41     </span></span>
<span id="cb469-12"><a href="mod-maps.html#cb469-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 1.41 1.00 1.00</span></span>
<span id="cb469-13"><a href="mod-maps.html#cb469-13" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(<span class="fu">dist</span>(coord))</span>
<span id="cb469-14"><a href="mod-maps.html#cb469-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      1    2    3    4</span></span>
<span id="cb469-15"><a href="mod-maps.html#cb469-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0.00 1.00 1.00 1.41</span></span>
<span id="cb469-16"><a href="mod-maps.html#cb469-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 1.00 0.00 1.41 1.00</span></span>
<span id="cb469-17"><a href="mod-maps.html#cb469-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 1.00 1.41 0.00 1.00</span></span>
<span id="cb469-18"><a href="mod-maps.html#cb469-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 1.41 1.00 1.00 0.00</span></span></code></pre></div>
<p>However, euclidean distances are often a poor approximation of shortest path lengths.</p>
<div id="using-google-maps" class="section level3" number="18.3.1">
<h3><span class="header-section-number">18.3.1</span> Using Google Maps</h3>
<p>Remember to have <a href="mod-maps.html#mod-map-api-key">set your API key</a> and activate the <em>Distance Matrix API</em> service on the Google Cloud Platform. We consider the following places:</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="mod-maps.html#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb470-2"><a href="mod-maps.html#cb470-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb470-3"><a href="mod-maps.html#cb470-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb470-4"><a href="mod-maps.html#cb470-4" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>Id,              <span class="sc">~</span>Shop,                                        <span class="sc">~</span>Address,</span>
<span id="cb470-5"><a href="mod-maps.html#cb470-5" aria-hidden="true" tabindex="-1"></a>       1L,    <span class="st">&quot;Bilka Esbjerg&quot;</span>,          <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>,</span>
<span id="cb470-6"><a href="mod-maps.html#cb470-6" aria-hidden="true" tabindex="-1"></a>       2L,    <span class="st">&quot;Bilka Herning&quot;</span>,              <span class="st">&quot;Golfvej 5, 7400 Herning, Denmark&quot;</span>,</span>
<span id="cb470-7"><a href="mod-maps.html#cb470-7" aria-hidden="true" tabindex="-1"></a>       3L,   <span class="st">&quot;Bilka Hillerød&quot;</span>,     <span class="st">&quot;Slotsarkaderne 26, 3400 Hillerød, Denmark&quot;</span>,</span>
<span id="cb470-8"><a href="mod-maps.html#cb470-8" aria-hidden="true" tabindex="-1"></a>       4L,   <span class="st">&quot;Bilka Hjørring&quot;</span>,  <span class="st">&quot;A.F Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>,</span>
<span id="cb470-9"><a href="mod-maps.html#cb470-9" aria-hidden="true" tabindex="-1"></a>       5L,  <span class="st">&quot;Bilka Holstebro&quot;</span>,         <span class="st">&quot;Nyholmvej 20, 7500 Holstebro, Denmark&quot;</span>,</span>
<span id="cb470-10"><a href="mod-maps.html#cb470-10" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb470-11"><a href="mod-maps.html#cb470-11" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb470-12"><a href="mod-maps.html#cb470-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 3</span></span>
<span id="cb470-13"><a href="mod-maps.html#cb470-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Id Shop            Address                                     </span></span>
<span id="cb470-14"><a href="mod-maps.html#cb470-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;                                       </span></span>
<span id="cb470-15"><a href="mod-maps.html#cb470-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark        </span></span>
<span id="cb470-16"><a href="mod-maps.html#cb470-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark            </span></span>
<span id="cb470-17"><a href="mod-maps.html#cb470-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark   </span></span>
<span id="cb470-18"><a href="mod-maps.html#cb470-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark</span></span>
<span id="cb470-19"><a href="mod-maps.html#cb470-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark</span></span></code></pre></div>
<p>To calculate a distance matrix we use the <code>mapdist</code> function:</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="mod-maps.html#cb471-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mapdist</span>(<span class="at">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb471-2"><a href="mod-maps.html#cb471-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">to =</span> <span class="st">&quot;Golfvej 5, 7400 Herning, Denmark&quot;</span>)</span>
<span id="cb471-3"><a href="mod-maps.html#cb471-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 9</span></span>
<span id="cb471-4"><a href="mod-maps.html#cb471-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   from                                 to                  m    km miles seconds minutes hours mode </span></span>
<span id="cb471-5"><a href="mod-maps.html#cb471-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span id="cb471-6"><a href="mod-maps.html#cb471-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark Golfvej 5, 740… 85637  85.6  53.2    4405    73.4  1.22 driv…</span></span></code></pre></div>
<p>Note Google returns results for the fastest path between the two points. Let us try to define a function which calculate all the distances:</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="mod-maps.html#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calculate the distance matrix in long format.</span></span>
<span id="cb472-2"><a href="mod-maps.html#cb472-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb472-3"><a href="mod-maps.html#cb472-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param address A vector of addresses.</span></span>
<span id="cb472-4"><a href="mod-maps.html#cb472-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param mode Driving, bicycling, walking, or transit.</span></span>
<span id="cb472-5"><a href="mod-maps.html#cb472-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param symmetric Use symmetric distances (half the number of queries).</span></span>
<span id="cb472-6"><a href="mod-maps.html#cb472-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A data frame with the results</span></span>
<span id="cb472-7"><a href="mod-maps.html#cb472-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @note The API returns results for the fastest route.  </span></span>
<span id="cb472-8"><a href="mod-maps.html#cb472-8" aria-hidden="true" tabindex="-1"></a>goo_calc_distances <span class="ot">&lt;-</span> <span class="cf">function</span>(address, <span class="at">mode =</span> <span class="st">&quot;driving&quot;</span>, <span class="at">symmetric =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb472-9"><a href="mod-maps.html#cb472-9" aria-hidden="true" tabindex="-1"></a>   datDist <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">id_from =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(address), <span class="at">id_to =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(address))</span>
<span id="cb472-10"><a href="mod-maps.html#cb472-10" aria-hidden="true" tabindex="-1"></a>   datDist <span class="ot">&lt;-</span> datDist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(id_from <span class="sc">!=</span> id_to)</span>
<span id="cb472-11"><a href="mod-maps.html#cb472-11" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (symmetric) datDist <span class="ot">&lt;-</span> datDist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(id_from <span class="sc">&lt;</span> id_to)</span>
<span id="cb472-12"><a href="mod-maps.html#cb472-12" aria-hidden="true" tabindex="-1"></a>   datDist <span class="ot">&lt;-</span> datDist <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">from =</span> address[id_from], <span class="at">to =</span> address[id_to])</span>
<span id="cb472-13"><a href="mod-maps.html#cb472-13" aria-hidden="true" tabindex="-1"></a>   res <span class="ot">&lt;-</span> <span class="fu">mapdist</span>(<span class="at">from =</span> datDist <span class="sc">%&gt;%</span> <span class="fu">pull</span>(from), <span class="at">to =</span> datDist <span class="sc">%&gt;%</span> <span class="fu">pull</span>(to), <span class="at">mode =</span> mode)</span>
<span id="cb472-14"><a href="mod-maps.html#cb472-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(<span class="fu">left_join</span>(datDist, res, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;from&quot;</span>, <span class="st">&quot;to&quot;</span>)))</span>
<span id="cb472-15"><a href="mod-maps.html#cb472-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb472-16"><a href="mod-maps.html#cb472-16" aria-hidden="true" tabindex="-1"></a>datDistGoo <span class="ot">&lt;-</span> <span class="fu">goo_calc_distances</span>(dat<span class="sc">$</span>Address)</span>
<span id="cb472-17"><a href="mod-maps.html#cb472-17" aria-hidden="true" tabindex="-1"></a>datDistGoo</span>
<span id="cb472-18"><a href="mod-maps.html#cb472-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 11</span></span>
<span id="cb472-19"><a href="mod-maps.html#cb472-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    id_from id_to from               to                     m    km miles seconds minutes hours mode </span></span>
<span id="cb472-20"><a href="mod-maps.html#cb472-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      &lt;int&gt; &lt;int&gt; &lt;chr&gt;              &lt;chr&gt;              &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span id="cb472-21"><a href="mod-maps.html#cb472-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1       1     2 Stormgade 157, 67… Golfvej 5, 7400 …  85637  85.6  53.2    4405    73.4 1.22  driv…</span></span>
<span id="cb472-22"><a href="mod-maps.html#cb472-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2       1     3 Stormgade 157, 67… Slotsarkaderne 2… 321027 321.  199.    11744   196.  3.26  driv…</span></span>
<span id="cb472-23"><a href="mod-maps.html#cb472-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3       1     4 Stormgade 157, 67… A.F Heidemannsve… 322123 322.  200.    11007   183.  3.06  driv…</span></span>
<span id="cb472-24"><a href="mod-maps.html#cb472-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4       1     5 Stormgade 157, 67… Nyholmvej 20, 75… 103720 104.   64.5    5294    88.2 1.47  driv…</span></span>
<span id="cb472-25"><a href="mod-maps.html#cb472-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5       2     3 Golfvej 5, 7400 H… Slotsarkaderne 2… 491611 492.  305.    17427   290.  4.84  driv…</span></span>
<span id="cb472-26"><a href="mod-maps.html#cb472-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6       2     4 Golfvej 5, 7400 H… A.F Heidemannsve… 374866 375.  233.    13562   226.  3.77  driv…</span></span>
<span id="cb472-27"><a href="mod-maps.html#cb472-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7       2     5 Golfvej 5, 7400 H… Nyholmvej 20, 75… 332585 333.  207.    12085   201.  3.36  driv…</span></span>
<span id="cb472-28"><a href="mod-maps.html#cb472-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8       3     4 Slotsarkaderne 26… A.F Heidemannsve… 178236 178.  111.     7810   130.  2.17  driv…</span></span>
<span id="cb472-29"><a href="mod-maps.html#cb472-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9       3     5 Slotsarkaderne 26… Nyholmvej 20, 75…  44035  44.0  27.4    1882    31.4 0.523 driv…</span></span>
<span id="cb472-30"><a href="mod-maps.html#cb472-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10       4     5 A.F Heidemannsvej… Nyholmvej 20, 75… 181265 181.  113.     7735   129.  2.15  driv…</span></span></code></pre></div>
<p>Note that only the calculated distances are returned. If you want to have the whole distance matrix we define function:</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="mod-maps.html#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Convert the data frame returned from calling a `___calc_distances` function to a distance matrix.</span></span>
<span id="cb473-2"><a href="mod-maps.html#cb473-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb473-3"><a href="mod-maps.html#cb473-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param dat The data frame returned from calling `___calc_distances`.</span></span>
<span id="cb473-4"><a href="mod-maps.html#cb473-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param value_col The column containing the distances.</span></span>
<span id="cb473-5"><a href="mod-maps.html#cb473-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return The distance matrix</span></span>
<span id="cb473-6"><a href="mod-maps.html#cb473-6" aria-hidden="true" tabindex="-1"></a>as_dist_matrix <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, value_col) {</span>
<span id="cb473-7"><a href="mod-maps.html#cb473-7" aria-hidden="true" tabindex="-1"></a>   lgt <span class="ot">&lt;-</span> <span class="fu">max</span>(dat<span class="sc">$</span>id_from, dat<span class="sc">$</span>id_to)</span>
<span id="cb473-8"><a href="mod-maps.html#cb473-8" aria-hidden="true" tabindex="-1"></a>   distanceMat<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow=</span>lgt, <span class="at">ncol =</span> lgt)</span>
<span id="cb473-9"><a href="mod-maps.html#cb473-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">diag</span>(distanceMat) <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb473-10"><a href="mod-maps.html#cb473-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dat), <span class="cf">function</span>(r) {</span>
<span id="cb473-11"><a href="mod-maps.html#cb473-11" aria-hidden="true" tabindex="-1"></a>      distanceMat[dat<span class="sc">$</span>id_from[r], dat<span class="sc">$</span>id_to[r]] <span class="ot">&lt;&lt;-</span> dat[[value_col]][r]</span>
<span id="cb473-12"><a href="mod-maps.html#cb473-12" aria-hidden="true" tabindex="-1"></a>   })</span>
<span id="cb473-13"><a href="mod-maps.html#cb473-13" aria-hidden="true" tabindex="-1"></a>   idx <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">is.na</span>(distanceMat), <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb473-14"><a href="mod-maps.html#cb473-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(idx), <span class="cf">function</span>(r) {</span>
<span id="cb473-15"><a href="mod-maps.html#cb473-15" aria-hidden="true" tabindex="-1"></a>      distanceMat[idx[r, <span class="st">&quot;row&quot;</span>], idx[r, <span class="st">&quot;col&quot;</span>]] <span class="ot">&lt;&lt;-</span> distanceMat[idx[r, <span class="st">&quot;col&quot;</span>], idx[r, <span class="st">&quot;row&quot;</span>]]</span>
<span id="cb473-16"><a href="mod-maps.html#cb473-16" aria-hidden="true" tabindex="-1"></a>   })</span>
<span id="cb473-17"><a href="mod-maps.html#cb473-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(distanceMat)</span>
<span id="cb473-18"><a href="mod-maps.html#cb473-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb473-19"><a href="mod-maps.html#cb473-19" aria-hidden="true" tabindex="-1"></a><span class="fu">as_dist_matrix</span>(datDistGoo, <span class="st">&quot;km&quot;</span>)  <span class="co"># distances in km</span></span>
<span id="cb473-20"><a href="mod-maps.html#cb473-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       [,1]  [,2] [,3] [,4] [,5]</span></span>
<span id="cb473-21"><a href="mod-maps.html#cb473-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]   0.0  85.6  321  322  104</span></span>
<span id="cb473-22"><a href="mod-maps.html#cb473-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]  85.6   0.0  492  375  333</span></span>
<span id="cb473-23"><a href="mod-maps.html#cb473-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] 321.0 491.6    0  178   44</span></span>
<span id="cb473-24"><a href="mod-maps.html#cb473-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] 322.1 374.9  178    0  181</span></span>
<span id="cb473-25"><a href="mod-maps.html#cb473-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,] 103.7 332.6   44  181    0</span></span>
<span id="cb473-26"><a href="mod-maps.html#cb473-26" aria-hidden="true" tabindex="-1"></a><span class="fu">as_dist_matrix</span>(datDistGoo, <span class="st">&quot;seconds&quot;</span>)  <span class="co"># travel time in seconds </span></span>
<span id="cb473-27"><a href="mod-maps.html#cb473-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       [,1]  [,2]  [,3]  [,4]  [,5]</span></span>
<span id="cb473-28"><a href="mod-maps.html#cb473-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]     0  4405 11744 11007  5294</span></span>
<span id="cb473-29"><a href="mod-maps.html#cb473-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]  4405     0 17427 13562 12085</span></span>
<span id="cb473-30"><a href="mod-maps.html#cb473-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] 11744 17427     0  7810  1882</span></span>
<span id="cb473-31"><a href="mod-maps.html#cb473-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] 11007 13562  7810     0  7735</span></span>
<span id="cb473-32"><a href="mod-maps.html#cb473-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,]  5294 12085  1882  7735     0</span></span></code></pre></div>
</div>
<div id="using-bing-maps" class="section level3" number="18.3.2">
<h3><span class="header-section-number">18.3.2</span> Using Bing Maps</h3>
<p>Remember to have <a href="mod-maps.html#mod-map-api-key">set your API key</a>. We first define a <code>bing_mapdist</code> function:</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="mod-maps.html#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb474-2"><a href="mod-maps.html#cb474-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Distance between two locations.</span></span>
<span id="cb474-3"><a href="mod-maps.html#cb474-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb474-4"><a href="mod-maps.html#cb474-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param from From address.</span></span>
<span id="cb474-5"><a href="mod-maps.html#cb474-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param to To address.</span></span>
<span id="cb474-6"><a href="mod-maps.html#cb474-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param mode Walking, driving or transit.</span></span>
<span id="cb474-7"><a href="mod-maps.html#cb474-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param optimize Optimize either `distance` or `time`.</span></span>
<span id="cb474-8"><a href="mod-maps.html#cb474-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return</span></span>
<span id="cb474-9"><a href="mod-maps.html#cb474-9" aria-hidden="true" tabindex="-1"></a>bing_mapdist <span class="ot">&lt;-</span> <span class="cf">function</span>(from, to, <span class="at">mode =</span> <span class="st">&quot;driving&quot;</span>, <span class="at">optimize =</span> <span class="st">&quot;time&quot;</span>) {</span>
<span id="cb474-10"><a href="mod-maps.html#cb474-10" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (<span class="fu">is.data.frame</span>(from)) {</span>
<span id="cb474-11"><a href="mod-maps.html#cb474-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">c</span>(<span class="st">&quot;from&quot;</span>, <span class="st">&quot;to&quot;</span>) <span class="sc">%in%</span> <span class="fu">names</span>(from)))</span>
<span id="cb474-12"><a href="mod-maps.html#cb474-12" aria-hidden="true" tabindex="-1"></a>     from_to_df <span class="ot">&lt;-</span> from <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">&quot;from&quot;</span>, <span class="st">&quot;to&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb474-13"><a href="mod-maps.html#cb474-13" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb474-14"><a href="mod-maps.html#cb474-14" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span> {</span>
<span id="cb474-15"><a href="mod-maps.html#cb474-15" aria-hidden="true" tabindex="-1"></a>     from_to_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">from =</span> from, <span class="at">to =</span> to)</span>
<span id="cb474-16"><a href="mod-maps.html#cb474-16" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb474-17"><a href="mod-maps.html#cb474-17" aria-hidden="true" tabindex="-1"></a>   dat <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(from_to_df), <span class="cf">function</span>(r) {</span>
<span id="cb474-18"><a href="mod-maps.html#cb474-18" aria-hidden="true" tabindex="-1"></a>      url <span class="ot">&lt;-</span> </span>
<span id="cb474-19"><a href="mod-maps.html#cb474-19" aria-hidden="true" tabindex="-1"></a>         <span class="fu">str_c</span>(<span class="st">&quot;http://dev.virtualearth.net/REST/V1/Routes/&quot;</span>, mode, <span class="st">&quot;?wp.0=&quot;</span>, from_to_df<span class="sc">$</span>from[r], <span class="st">&quot;&amp;wp.1=&quot;</span>, from_to_df<span class="sc">$</span>to[r], </span>
<span id="cb474-20"><a href="mod-maps.html#cb474-20" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;&amp;optimize=&quot;</span>, optimize, <span class="st">&quot;&amp;ra=excludeItinerary&amp;rpo=None&amp;ig=false&amp;du=km&quot;</span>, </span>
<span id="cb474-21"><a href="mod-maps.html#cb474-21" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;&amp;avoid=minimizeTolls&amp;key=&quot;</span>, <span class="fu">Sys.getenv</span>(<span class="st">&quot;BING_MAPS_API_KEY&quot;</span>))</span>
<span id="cb474-22"><a href="mod-maps.html#cb474-22" aria-hidden="true" tabindex="-1"></a>      url <span class="ot">&lt;-</span> <span class="fu">URLencode</span>(url)</span>
<span id="cb474-23"><a href="mod-maps.html#cb474-23" aria-hidden="true" tabindex="-1"></a>      lst <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(url)</span>
<span id="cb474-24"><a href="mod-maps.html#cb474-24" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (lst<span class="sc">$</span>statusCode <span class="sc">!=</span> <span class="dv">200</span>) <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">km =</span> <span class="cn">NA</span>, <span class="at">seconds =</span> <span class="cn">NA</span>, <span class="at">mode =</span> <span class="cn">NA</span>))</span>
<span id="cb474-25"><a href="mod-maps.html#cb474-25" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">&lt;-</span> lst<span class="sc">$</span>resourceSets<span class="sc">$</span>resources[[<span class="dv">1</span>]]</span>
<span id="cb474-26"><a href="mod-maps.html#cb474-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">km =</span> df<span class="sc">$</span>travelDistance, <span class="at">seconds =</span> df<span class="sc">$</span>travelDuration, <span class="at">mode =</span> df<span class="sc">$</span>travelMode))</span>
<span id="cb474-27"><a href="mod-maps.html#cb474-27" aria-hidden="true" tabindex="-1"></a>   })</span>
<span id="cb474-28"><a href="mod-maps.html#cb474-28" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(<span class="fu">bind_cols</span>(from_to_df, dat))</span>
<span id="cb474-29"><a href="mod-maps.html#cb474-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb474-30"><a href="mod-maps.html#cb474-30" aria-hidden="true" tabindex="-1"></a><span class="fu">bing_mapdist</span>(<span class="at">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb474-31"><a href="mod-maps.html#cb474-31" aria-hidden="true" tabindex="-1"></a>             <span class="at">to =</span> <span class="st">&quot;A.F Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>)</span>
<span id="cb474-32"><a href="mod-maps.html#cb474-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 5</span></span>
<span id="cb474-33"><a href="mod-maps.html#cb474-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   from                                 to                                          km seconds mode  </span></span>
<span id="cb474-34"><a href="mod-maps.html#cb474-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;                                    &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt; </span></span>
<span id="cb474-35"><a href="mod-maps.html#cb474-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark A.F Heidemannsvej 20, 9800 Hjørring, De…  322.    9909 Drivi…</span></span>
<span id="cb474-36"><a href="mod-maps.html#cb474-36" aria-hidden="true" tabindex="-1"></a><span class="fu">bing_mapdist</span>(<span class="at">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb474-37"><a href="mod-maps.html#cb474-37" aria-hidden="true" tabindex="-1"></a>             <span class="at">to =</span> <span class="st">&quot;A.F Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>, </span>
<span id="cb474-38"><a href="mod-maps.html#cb474-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">optimize =</span> <span class="st">&quot;distance&quot;</span>)</span>
<span id="cb474-39"><a href="mod-maps.html#cb474-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 5</span></span>
<span id="cb474-40"><a href="mod-maps.html#cb474-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   from                                 to                                          km seconds mode  </span></span>
<span id="cb474-41"><a href="mod-maps.html#cb474-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;                                    &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt; </span></span>
<span id="cb474-42"><a href="mod-maps.html#cb474-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark A.F Heidemannsvej 20, 9800 Hjørring, De…  256.   14040 Drivi…</span></span></code></pre></div>
<p>Note we here can get both the shortest and fastest path between two points. Next, we use the <code>bing_mapdist</code> function for calculating distances:</p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="mod-maps.html#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calculate the distance matrix in long format.</span></span>
<span id="cb475-2"><a href="mod-maps.html#cb475-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb475-3"><a href="mod-maps.html#cb475-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param address A vector of addresses.</span></span>
<span id="cb475-4"><a href="mod-maps.html#cb475-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param symmetric Use symmetric distances (only half the number of queries).</span></span>
<span id="cb475-5"><a href="mod-maps.html#cb475-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param ... Further parameters passed to `bing_mapdist`.</span></span>
<span id="cb475-6"><a href="mod-maps.html#cb475-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A data frame with the results</span></span>
<span id="cb475-7"><a href="mod-maps.html#cb475-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @note The API returns results for the fastest route.  </span></span>
<span id="cb475-8"><a href="mod-maps.html#cb475-8" aria-hidden="true" tabindex="-1"></a>bing_calc_distances <span class="ot">&lt;-</span> <span class="cf">function</span>(address, <span class="at">symmetric =</span> <span class="cn">TRUE</span>, ...) {</span>
<span id="cb475-9"><a href="mod-maps.html#cb475-9" aria-hidden="true" tabindex="-1"></a>   datDist <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">id_from =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(address), <span class="at">id_to =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(address))</span>
<span id="cb475-10"><a href="mod-maps.html#cb475-10" aria-hidden="true" tabindex="-1"></a>   datDist <span class="ot">&lt;-</span> datDist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(id_from <span class="sc">!=</span> id_to)</span>
<span id="cb475-11"><a href="mod-maps.html#cb475-11" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (symmetric) datDist <span class="ot">&lt;-</span> datDist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(id_from <span class="sc">&lt;</span> id_to)</span>
<span id="cb475-12"><a href="mod-maps.html#cb475-12" aria-hidden="true" tabindex="-1"></a>   datDist <span class="ot">&lt;-</span> datDist <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">from =</span> address[id_from], <span class="at">to =</span> address[id_to])</span>
<span id="cb475-13"><a href="mod-maps.html#cb475-13" aria-hidden="true" tabindex="-1"></a>   res <span class="ot">&lt;-</span> <span class="fu">bing_mapdist</span>(datDist <span class="sc">%&gt;%</span> <span class="fu">select</span>(from, to), ...)</span>
<span id="cb475-14"><a href="mod-maps.html#cb475-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(<span class="fu">bind_cols</span>(datDist <span class="sc">%&gt;%</span>  <span class="fu">select</span>(id_from, id_to), res))</span>
<span id="cb475-15"><a href="mod-maps.html#cb475-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb475-16"><a href="mod-maps.html#cb475-16" aria-hidden="true" tabindex="-1"></a>datDistBing <span class="ot">&lt;-</span> <span class="fu">bing_calc_distances</span>(dat<span class="sc">$</span>Address)</span>
<span id="cb475-17"><a href="mod-maps.html#cb475-17" aria-hidden="true" tabindex="-1"></a>datDistBing</span>
<span id="cb475-18"><a href="mod-maps.html#cb475-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 7</span></span>
<span id="cb475-19"><a href="mod-maps.html#cb475-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    id_from id_to from                                         to                    km seconds mode </span></span>
<span id="cb475-20"><a href="mod-maps.html#cb475-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      &lt;int&gt; &lt;int&gt; &lt;chr&gt;                                        &lt;chr&gt;              &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb475-21"><a href="mod-maps.html#cb475-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1       1     2 Stormgade 157, 6715 Esbjerg, Denmark         Golfvej 5, 7400 H…  87.7    4596 Driv…</span></span>
<span id="cb475-22"><a href="mod-maps.html#cb475-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2       1     3 Stormgade 157, 6715 Esbjerg, Denmark         Slotsarkaderne 26… 322.    10433 Driv…</span></span>
<span id="cb475-23"><a href="mod-maps.html#cb475-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3       1     4 Stormgade 157, 6715 Esbjerg, Denmark         A.F Heidemannsvej… 322.     9956 Driv…</span></span>
<span id="cb475-24"><a href="mod-maps.html#cb475-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4       1     5 Stormgade 157, 6715 Esbjerg, Denmark         Nyholmvej 20, 750… 123.     5706 Driv…</span></span>
<span id="cb475-25"><a href="mod-maps.html#cb475-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5       2     3 Golfvej 5, 7400 Herning, Denmark             Slotsarkaderne 26… 334.    10652 Driv…</span></span>
<span id="cb475-26"><a href="mod-maps.html#cb475-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6       2     4 Golfvej 5, 7400 Herning, Denmark             A.F Heidemannsvej… 187.     7925 Driv…</span></span>
<span id="cb475-27"><a href="mod-maps.html#cb475-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7       2     5 Golfvej 5, 7400 Herning, Denmark             Nyholmvej 20, 750…  44.2    1735 Driv…</span></span>
<span id="cb475-28"><a href="mod-maps.html#cb475-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8       3     4 Slotsarkaderne 26, 3400 Hillerød, Denmark    A.F Heidemannsvej… 397.    17190 Driv…</span></span>
<span id="cb475-29"><a href="mod-maps.html#cb475-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9       3     5 Slotsarkaderne 26, 3400 Hillerød, Denmark    Nyholmvej 20, 750… 375.    12111 Driv…</span></span>
<span id="cb475-30"><a href="mod-maps.html#cb475-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10       4     5 A.F Heidemannsvej 20, 9800 Hjørring, Denmark Nyholmvej 20, 750… 194.     8230 Driv…</span></span></code></pre></div>
<p>Note in general results from the API services are based on a set of assumptions and hence the results from different services may not be the same. You may use the different services to check if the distances are correct, by checking the results from different services:</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="mod-maps.html#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Difference in minutes</span></span>
<span id="cb476-2"><a href="mod-maps.html#cb476-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abs</span>(<span class="fu">as_dist_matrix</span>(datDistGoo, <span class="st">&quot;seconds&quot;</span>) <span class="sc">-</span> <span class="fu">as_dist_matrix</span>(datDistBing, <span class="st">&quot;seconds&quot;</span>))<span class="sc">/</span><span class="dv">60</span></span>
<span id="cb476-3"><a href="mod-maps.html#cb476-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       [,1]   [,2]  [,3]   [,4]   [,5]</span></span>
<span id="cb476-4"><a href="mod-maps.html#cb476-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]  0.00   3.18  21.9  17.52   6.87</span></span>
<span id="cb476-5"><a href="mod-maps.html#cb476-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]  3.18   0.00 112.9  93.95 172.50</span></span>
<span id="cb476-6"><a href="mod-maps.html#cb476-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] 21.85 112.92   0.0 156.33 170.48</span></span>
<span id="cb476-7"><a href="mod-maps.html#cb476-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] 17.52  93.95 156.3   0.00   8.25</span></span>
<span id="cb476-8"><a href="mod-maps.html#cb476-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,]  6.87 172.50 170.5   8.25   0.00</span></span>
<span id="cb476-9"><a href="mod-maps.html#cb476-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Km from 1 to 3</span></span>
<span id="cb476-10"><a href="mod-maps.html#cb476-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mapdist</span>(<span class="at">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb476-11"><a href="mod-maps.html#cb476-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">to =</span> <span class="st">&quot;Slotsarkaderne 26, 3400 Hillerød, Denmark&quot;</span>)</span>
<span id="cb476-12"><a href="mod-maps.html#cb476-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 9</span></span>
<span id="cb476-13"><a href="mod-maps.html#cb476-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   from                                 to                  m    km miles seconds minutes hours mode </span></span>
<span id="cb476-14"><a href="mod-maps.html#cb476-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span id="cb476-15"><a href="mod-maps.html#cb476-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark Slotsarkadern… 321027  321.  199.   11744    196.  3.26 driv…</span></span>
<span id="cb476-16"><a href="mod-maps.html#cb476-16" aria-hidden="true" tabindex="-1"></a><span class="fu">bing_mapdist</span>(<span class="at">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb476-17"><a href="mod-maps.html#cb476-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">to =</span> <span class="st">&quot;Slotsarkaderne 26, 3400 Hillerød, Denmark&quot;</span>)</span>
<span id="cb476-18"><a href="mod-maps.html#cb476-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 5</span></span>
<span id="cb476-19"><a href="mod-maps.html#cb476-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   from                                 to                                           km seconds mode </span></span>
<span id="cb476-20"><a href="mod-maps.html#cb476-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;                                     &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb476-21"><a href="mod-maps.html#cb476-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark Slotsarkaderne 26, 3400 Hillerød, Denmark  324.   10540 Driv…</span></span></code></pre></div>
</div>
</div>
<div id="geocoding-and-reverse-geocoding" class="section level2" number="18.4">
<h2><span class="header-section-number">18.4</span> Geocoding and reverse geocoding</h2>
<div id="using-google-maps-1" class="section level3" number="18.4.1">
<h3><span class="header-section-number">18.4.1</span> Using Google maps</h3>
<p>Remember to enable the <em>Geocoding API</em>. To get the coordinates of an address we use the <code>geocode</code> function:</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="mod-maps.html#cb477-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geocode</span>(<span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>)</span>
<span id="cb477-2"><a href="mod-maps.html#cb477-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span id="cb477-3"><a href="mod-maps.html#cb477-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     lon   lat</span></span>
<span id="cb477-4"><a href="mod-maps.html#cb477-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb477-5"><a href="mod-maps.html#cb477-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  8.46  55.5</span></span></code></pre></div>
<p>We may use <code>mutate_geocode</code> to add the coordinates to a dataset:</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="mod-maps.html#cb478-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb478-2"><a href="mod-maps.html#cb478-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_geocode</span>(Address)</span>
<span id="cb478-3"><a href="mod-maps.html#cb478-3" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb478-4"><a href="mod-maps.html#cb478-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 5</span></span>
<span id="cb478-5"><a href="mod-maps.html#cb478-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Id Shop            Address                                        lon   lat</span></span>
<span id="cb478-6"><a href="mod-maps.html#cb478-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;                                        &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb478-7"><a href="mod-maps.html#cb478-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark          8.46  55.5</span></span>
<span id="cb478-8"><a href="mod-maps.html#cb478-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark              9.00  56.1</span></span>
<span id="cb478-9"><a href="mod-maps.html#cb478-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark    12.3   55.9</span></span>
<span id="cb478-10"><a href="mod-maps.html#cb478-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark 10.0   57.4</span></span>
<span id="cb478-11"><a href="mod-maps.html#cb478-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark         8.62  56.4</span></span></code></pre></div>
<p>To reverse geocode use the <code>revgeocode</code> function:</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="mod-maps.html#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="fu">revgeocode</span>(<span class="fu">c</span>(dat<span class="sc">$</span>lon[<span class="dv">1</span>], dat<span class="sc">$</span>lat[<span class="dv">1</span>]))</span>
<span id="cb479-2"><a href="mod-maps.html#cb479-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span></span></code></pre></div>
<p>To apply it to the dataset use:</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="mod-maps.html#cb480-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb480-2"><a href="mod-maps.html#cb480-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">AddressGeoGoo =</span> </span>
<span id="cb480-3"><a href="mod-maps.html#cb480-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">map_chr</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(), <span class="cf">function</span>(i) {</span>
<span id="cb480-4"><a href="mod-maps.html#cb480-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">revgeocode</span>(<span class="fu">c</span>(<span class="at">lon =</span> lon[i], <span class="at">lat =</span> lat[i]))</span>
<span id="cb480-5"><a href="mod-maps.html#cb480-5" aria-hidden="true" tabindex="-1"></a>             }))</span>
<span id="cb480-6"><a href="mod-maps.html#cb480-6" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb480-7"><a href="mod-maps.html#cb480-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 6</span></span>
<span id="cb480-8"><a href="mod-maps.html#cb480-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Id Shop            Address                                        lon   lat AddressGeoGoo      </span></span>
<span id="cb480-9"><a href="mod-maps.html#cb480-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;                                        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              </span></span>
<span id="cb480-10"><a href="mod-maps.html#cb480-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark          8.46  55.5 Stormgade 157, 671…</span></span>
<span id="cb480-11"><a href="mod-maps.html#cb480-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark              9.00  56.1 Golfvej 5, 7400 He…</span></span>
<span id="cb480-12"><a href="mod-maps.html#cb480-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark    12.3   55.9 Slotsarkaderne 26,…</span></span>
<span id="cb480-13"><a href="mod-maps.html#cb480-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark 10.0   57.4 A F Heidemanns Vej…</span></span>
<span id="cb480-14"><a href="mod-maps.html#cb480-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark         8.62  56.4 Nyholmvej 20, 7500…</span></span></code></pre></div>
</div>
<div id="use-bing-maps" class="section level3" number="18.4.2">
<h3><span class="header-section-number">18.4.2</span> Use Bing Maps</h3>
<p>To get the coordinates of an address we define the <code>bing_geocode</code> function:</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="mod-maps.html#cb481-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Geocode addresses</span></span>
<span id="cb481-2"><a href="mod-maps.html#cb481-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb481-3"><a href="mod-maps.html#cb481-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param address Address(es) to geocode.</span></span>
<span id="cb481-4"><a href="mod-maps.html#cb481-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return The coordinates as a data frame.</span></span>
<span id="cb481-5"><a href="mod-maps.html#cb481-5" aria-hidden="true" tabindex="-1"></a>bing_geocode <span class="ot">&lt;-</span> <span class="cf">function</span>(address) {</span>
<span id="cb481-6"><a href="mod-maps.html#cb481-6" aria-hidden="true" tabindex="-1"></a>   dat <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(address, <span class="cf">function</span>(s) {</span>
<span id="cb481-7"><a href="mod-maps.html#cb481-7" aria-hidden="true" tabindex="-1"></a>      url <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;http://dev.virtualearth.net/REST/v1/Locations?q=&quot;</span>, </span>
<span id="cb481-8"><a href="mod-maps.html#cb481-8" aria-hidden="true" tabindex="-1"></a>                   s, <span class="st">&quot;&amp;key=&quot;</span>, <span class="fu">Sys.getenv</span>(<span class="st">&quot;BING_MAPS_API_KEY&quot;</span>))</span>
<span id="cb481-9"><a href="mod-maps.html#cb481-9" aria-hidden="true" tabindex="-1"></a>      url <span class="ot">&lt;-</span> <span class="fu">URLencode</span>(url)</span>
<span id="cb481-10"><a href="mod-maps.html#cb481-10" aria-hidden="true" tabindex="-1"></a>      lst <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(url)</span>
<span id="cb481-11"><a href="mod-maps.html#cb481-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (lst<span class="sc">$</span>statusCode <span class="sc">!=</span> <span class="dv">200</span>) <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">lon =</span> <span class="cn">NA</span>, <span class="at">lat =</span> <span class="cn">NA</span>))</span>
<span id="cb481-12"><a href="mod-maps.html#cb481-12" aria-hidden="true" tabindex="-1"></a>      v <span class="ot">&lt;-</span> lst<span class="sc">$</span>resourceSets<span class="sc">$</span>resources[[<span class="dv">1</span>]]<span class="sc">$</span>point<span class="sc">$</span>coordinates[[<span class="dv">1</span>]]</span>
<span id="cb481-13"><a href="mod-maps.html#cb481-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.null</span>(v)) <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">lon =</span> <span class="cn">NA</span>, <span class="at">lat =</span> <span class="cn">NA</span>))</span>
<span id="cb481-14"><a href="mod-maps.html#cb481-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">lon =</span> v[<span class="dv">2</span>], <span class="at">lat =</span> v[<span class="dv">1</span>]))</span>
<span id="cb481-15"><a href="mod-maps.html#cb481-15" aria-hidden="true" tabindex="-1"></a>   })</span>
<span id="cb481-16"><a href="mod-maps.html#cb481-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(dat)</span>
<span id="cb481-17"><a href="mod-maps.html#cb481-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb481-18"><a href="mod-maps.html#cb481-18" aria-hidden="true" tabindex="-1"></a><span class="fu">bing_geocode</span>(<span class="st">&quot;A.F. Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>)</span>
<span id="cb481-19"><a href="mod-maps.html#cb481-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span id="cb481-20"><a href="mod-maps.html#cb481-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     lon   lat</span></span>
<span id="cb481-21"><a href="mod-maps.html#cb481-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb481-22"><a href="mod-maps.html#cb481-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  10.0  57.4</span></span>
<span id="cb481-23"><a href="mod-maps.html#cb481-23" aria-hidden="true" tabindex="-1"></a><span class="fu">bing_geocode</span>(dat<span class="sc">$</span>Address)</span>
<span id="cb481-24"><a href="mod-maps.html#cb481-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span id="cb481-25"><a href="mod-maps.html#cb481-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     lon   lat</span></span>
<span id="cb481-26"><a href="mod-maps.html#cb481-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb481-27"><a href="mod-maps.html#cb481-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  8.46  55.5</span></span>
<span id="cb481-28"><a href="mod-maps.html#cb481-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  9.00  56.1</span></span>
<span id="cb481-29"><a href="mod-maps.html#cb481-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 12.3   55.9</span></span>
<span id="cb481-30"><a href="mod-maps.html#cb481-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 10.0   57.4</span></span>
<span id="cb481-31"><a href="mod-maps.html#cb481-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  8.62  56.4</span></span></code></pre></div>
<p>We may use <code>bing_mutate_geocode</code> to add the coordinates to a dataset:</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="mod-maps.html#cb482-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>lat, <span class="sc">-</span>lon)</span>
<span id="cb482-2"><a href="mod-maps.html#cb482-2" aria-hidden="true" tabindex="-1"></a>mutate_bing_geocode <span class="ot">&lt;-</span> <span class="cf">function</span> (data, address, ...) {</span>
<span id="cb482-3"><a href="mod-maps.html#cb482-3" aria-hidden="true" tabindex="-1"></a>    adr <span class="ot">&lt;-</span> data[[<span class="fu">deparse</span>(<span class="fu">substitute</span>(Address))]]</span>
<span id="cb482-4"><a href="mod-maps.html#cb482-4" aria-hidden="true" tabindex="-1"></a>    gcdf <span class="ot">&lt;-</span> <span class="fu">bing_geocode</span>(adr)</span>
<span id="cb482-5"><a href="mod-maps.html#cb482-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(data, gcdf)</span>
<span id="cb482-6"><a href="mod-maps.html#cb482-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb482-7"><a href="mod-maps.html#cb482-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-8"><a href="mod-maps.html#cb482-8" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb482-9"><a href="mod-maps.html#cb482-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_bing_geocode</span>(Address)</span>
<span id="cb482-10"><a href="mod-maps.html#cb482-10" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb482-11"><a href="mod-maps.html#cb482-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 6</span></span>
<span id="cb482-12"><a href="mod-maps.html#cb482-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Id Shop            Address                                      AddressGeoGoo         lon   lat</span></span>
<span id="cb482-13"><a href="mod-maps.html#cb482-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;                                        &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb482-14"><a href="mod-maps.html#cb482-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark         Stormgade 157, 671…  8.46  55.5</span></span>
<span id="cb482-15"><a href="mod-maps.html#cb482-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark             Golfvej 5, 7400 He…  9.00  56.1</span></span>
<span id="cb482-16"><a href="mod-maps.html#cb482-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark    Slotsarkaderne 26,… 12.3   55.9</span></span>
<span id="cb482-17"><a href="mod-maps.html#cb482-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark A F Heidemanns Vej… 10.0   57.4</span></span>
<span id="cb482-18"><a href="mod-maps.html#cb482-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark        Nyholmvej 20, 7500…  8.62  56.4</span></span></code></pre></div>
<p>To reverse geocode use the <code>bing_revgeocode</code> function:</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="mod-maps.html#cb483-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Reverse geocode coordinates</span></span>
<span id="cb483-2"><a href="mod-maps.html#cb483-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb483-3"><a href="mod-maps.html#cb483-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param coordinates A vector with two elements (lon, lat).</span></span>
<span id="cb483-4"><a href="mod-maps.html#cb483-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return The address as a data frame.</span></span>
<span id="cb483-5"><a href="mod-maps.html#cb483-5" aria-hidden="true" tabindex="-1"></a>bing_revgeocode <span class="ot">&lt;-</span> <span class="cf">function</span>(coordinates) {</span>
<span id="cb483-6"><a href="mod-maps.html#cb483-6" aria-hidden="true" tabindex="-1"></a>   url <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;http://dev.virtualearth.net/REST/v1/Locations/&quot;</span>, </span>
<span id="cb483-7"><a href="mod-maps.html#cb483-7" aria-hidden="true" tabindex="-1"></a>                coordinates[<span class="dv">2</span>], <span class="st">&quot;,&quot;</span>, coordinates[<span class="dv">1</span>],</span>
<span id="cb483-8"><a href="mod-maps.html#cb483-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;?key=&quot;</span>, <span class="fu">Sys.getenv</span>(<span class="st">&quot;BING_MAPS_API_KEY&quot;</span>))</span>
<span id="cb483-9"><a href="mod-maps.html#cb483-9" aria-hidden="true" tabindex="-1"></a>   url <span class="ot">&lt;-</span> <span class="fu">URLencode</span>(url)</span>
<span id="cb483-10"><a href="mod-maps.html#cb483-10" aria-hidden="true" tabindex="-1"></a>   lst <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(url)</span>
<span id="cb483-11"><a href="mod-maps.html#cb483-11" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (lst<span class="sc">$</span>statusCode <span class="sc">!=</span> <span class="dv">200</span>) <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb483-12"><a href="mod-maps.html#cb483-12" aria-hidden="true" tabindex="-1"></a>   v <span class="ot">&lt;-</span> lst<span class="sc">$</span>resourceSets<span class="sc">$</span>resources[[<span class="dv">1</span>]]<span class="sc">$</span>address<span class="sc">$</span>formattedAddress</span>
<span id="cb483-13"><a href="mod-maps.html#cb483-13" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (<span class="fu">is.null</span>(v)) <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb483-14"><a href="mod-maps.html#cb483-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(v)</span>
<span id="cb483-15"><a href="mod-maps.html#cb483-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb483-16"><a href="mod-maps.html#cb483-16" aria-hidden="true" tabindex="-1"></a><span class="fu">bing_revgeocode</span>(<span class="fu">c</span>(dat<span class="sc">$</span>lon[<span class="dv">1</span>], dat<span class="sc">$</span>lat[<span class="dv">1</span>]))</span>
<span id="cb483-17"><a href="mod-maps.html#cb483-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span></span></code></pre></div>
<p>To apply it to the dataset use:</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="mod-maps.html#cb484-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb484-2"><a href="mod-maps.html#cb484-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">AddressGeoBing =</span> </span>
<span id="cb484-3"><a href="mod-maps.html#cb484-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">map_chr</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(), <span class="cf">function</span>(i) {</span>
<span id="cb484-4"><a href="mod-maps.html#cb484-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">bing_revgeocode</span>(<span class="fu">c</span>(<span class="at">lon =</span> lon[i], <span class="at">lat =</span> lat[i]))</span>
<span id="cb484-5"><a href="mod-maps.html#cb484-5" aria-hidden="true" tabindex="-1"></a>             }))</span>
<span id="cb484-6"><a href="mod-maps.html#cb484-6" aria-hidden="true" tabindex="-1"></a>dat </span>
<span id="cb484-7"><a href="mod-maps.html#cb484-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 7</span></span>
<span id="cb484-8"><a href="mod-maps.html#cb484-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Id Shop            Address            AddressGeoGoo            lon   lat AddressGeoBing        </span></span>
<span id="cb484-9"><a href="mod-maps.html#cb484-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;              &lt;chr&gt;                  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                 </span></span>
<span id="cb484-10"><a href="mod-maps.html#cb484-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 67… Stormgade 157, 6715 E…  8.46  55.5 Stormgade 157, 6715 E…</span></span>
<span id="cb484-11"><a href="mod-maps.html#cb484-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 H… Golfvej 5, 7400 Herni…  9.00  56.1 Golfvej 5, 7400 Herni…</span></span>
<span id="cb484-12"><a href="mod-maps.html#cb484-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26… Slotsarkaderne 26, 34… 12.3   55.9 Lokesvej 18, 3400 Hil…</span></span>
<span id="cb484-13"><a href="mod-maps.html#cb484-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej… A F Heidemanns Vej 20… 10.0   57.4 A.F. Heidemanns Vej 2…</span></span>
<span id="cb484-14"><a href="mod-maps.html#cb484-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 750… Nyholmvej 20, 7500 Ho…  8.62  56.4 Stationsvej 9, 7500 H…</span></span></code></pre></div>
</div>
</div>
<div id="adding-markers-and-routes-to-a-map" class="section level2" number="18.5">
<h2><span class="header-section-number">18.5</span> Adding markers and routes to a map</h2>
<p><a href="http://leafletjs.com">Leaflet</a> is an open-source JavaScript library for interactive maps. It’s used by websites ranging from The New York Times and The Washington Post to GitHub and Flickr, as well as GIS specialists like OpenStreetMap, Mapbox, and CartoDB. The <a href="https://rstudio.github.io/leaflet/">leaflet</a> package makes it easy to create Leaflet maps from R.</p>
<p>Note Leaflet is open-source and free so you do not need an API key for making maps. If you would like to use Google maps instead then have a look at the <a href="http://symbolixau.github.io/googleway/">googleway</a> package instead.</p>
<p>First let us create a map with two base layers</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="mod-maps.html#cb485-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb485-2"><a href="mod-maps.html#cb485-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">leaflet</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb485-3"><a href="mod-maps.html#cb485-3" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Base maps</span></span>
<span id="cb485-4"><a href="mod-maps.html#cb485-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addTiles</span>(<span class="at">group =</span> <span class="st">&quot;Map&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb485-5"><a href="mod-maps.html#cb485-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addProviderTiles</span>(<span class="st">&#39;Esri.WorldImagery&#39;</span>, <span class="at">group =</span> <span class="st">&quot;Satelite&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb485-6"><a href="mod-maps.html#cb485-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addProviderTiles</span>(<span class="st">&quot;CartoDB.PositronOnlyLabels&quot;</span>, <span class="at">group =</span> <span class="st">&quot;Map&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb485-7"><a href="mod-maps.html#cb485-7" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Center and zoom</span></span>
<span id="cb485-8"><a href="mod-maps.html#cb485-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">setView</span>(<span class="fl">10.2</span>, <span class="fl">56.2</span>,  <span class="at">zoom =</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb485-9"><a href="mod-maps.html#cb485-9" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Layer control</span></span>
<span id="cb485-10"><a href="mod-maps.html#cb485-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addLayersControl</span>(</span>
<span id="cb485-11"><a href="mod-maps.html#cb485-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">&quot;Map&quot;</span>, <span class="st">&quot;Satelite&quot;</span>),</span>
<span id="cb485-12"><a href="mod-maps.html#cb485-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">options =</span> <span class="fu">layersControlOptions</span>(<span class="at">collapsed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb485-13"><a href="mod-maps.html#cb485-13" aria-hidden="true" tabindex="-1"></a>   ) </span>
<span id="cb485-14"><a href="mod-maps.html#cb485-14" aria-hidden="true" tabindex="-1"></a> m</span></code></pre></div>
<div id="htmlwidget-f5ae7789b0df5e686617" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-f5ae7789b0df5e686617">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]}],"setView":[[56.2,10.2],7,[]]},"evals":[],"jsHooks":[]}</script>
<p>Next, let us add the places:</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="mod-maps.html#cb486-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb486-2"><a href="mod-maps.html#cb486-2" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>Id,              <span class="sc">~</span>Shop,                                        <span class="sc">~</span>Address,</span>
<span id="cb486-3"><a href="mod-maps.html#cb486-3" aria-hidden="true" tabindex="-1"></a>       1L,    <span class="st">&quot;Bilka Esbjerg&quot;</span>,          <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>,</span>
<span id="cb486-4"><a href="mod-maps.html#cb486-4" aria-hidden="true" tabindex="-1"></a>       2L,    <span class="st">&quot;Bilka Herning&quot;</span>,              <span class="st">&quot;Golfvej 5, 7400 Herning, Denmark&quot;</span>,</span>
<span id="cb486-5"><a href="mod-maps.html#cb486-5" aria-hidden="true" tabindex="-1"></a>       3L,   <span class="st">&quot;Bilka Hillerød&quot;</span>,     <span class="st">&quot;Slotsarkaderne 26, 3400 Hillerød, Denmark&quot;</span>,</span>
<span id="cb486-6"><a href="mod-maps.html#cb486-6" aria-hidden="true" tabindex="-1"></a>       4L,   <span class="st">&quot;Bilka Hjørring&quot;</span>,  <span class="st">&quot;A.F Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>,</span>
<span id="cb486-7"><a href="mod-maps.html#cb486-7" aria-hidden="true" tabindex="-1"></a>       5L,  <span class="st">&quot;Bilka Holstebro&quot;</span>,         <span class="st">&quot;Nyholmvej 20, 7500 Holstebro, Denmark&quot;</span>,</span>
<span id="cb486-8"><a href="mod-maps.html#cb486-8" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb486-9"><a href="mod-maps.html#cb486-9" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate_geocode</span>(Address)</span>
<span id="cb486-10"><a href="mod-maps.html#cb486-10" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> m <span class="sc">%&gt;%</span> </span>
<span id="cb486-11"><a href="mod-maps.html#cb486-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addMarkers</span>(<span class="sc">~</span>lon, <span class="sc">~</span>lat, <span class="at">popup =</span> <span class="sc">~</span>Address, <span class="at">label =</span> <span class="sc">~</span><span class="fu">str_c</span>(Id, <span class="st">&quot;  - &quot;</span>, Shop), <span class="at">data =</span> dat)</span>
<span id="cb486-12"><a href="mod-maps.html#cb486-12" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<div id="htmlwidget-945954882425248f16bf" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-945954882425248f16bf">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4446261,56.3779116],[8.4559613,9.0047956,12.297778,10.0031376,8.622241],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4446261],"lng":[8.4559613,12.297778]}},"evals":[],"jsHooks":[]}</script>
<p>To add a line between a set of points use the <code>addPolylines</code> function:</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="mod-maps.html#cb487-1" aria-hidden="true" tabindex="-1"></a>routeIds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb487-2"><a href="mod-maps.html#cb487-2" aria-hidden="true" tabindex="-1"></a>route <span class="ot">&lt;-</span> dat[routeIds,] </span>
<span id="cb487-3"><a href="mod-maps.html#cb487-3" aria-hidden="true" tabindex="-1"></a>m <span class="sc">%&gt;%</span> <span class="fu">addPolylines</span>(<span class="at">lng =</span> <span class="sc">~</span>lon, <span class="at">lat =</span> <span class="sc">~</span>lat, <span class="at">data =</span> route, <span class="at">weight =</span> <span class="dv">2</span>, <span class="at">label =</span> <span class="st">&quot;Route 1&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-d3f3365bf99da020a15d" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-d3f3365bf99da020a15d">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4446261,56.3779116],[8.4559613,9.0047956,12.297778,10.0031376,8.622241],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,8.622241,8.4559613,9.0047956],"lat":[56.1357775,56.3779116,55.5107577,56.1357775]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":2,"opacity":0.5,"fill":false,"fillColor":"#03F","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Route 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4446261],"lng":[8.4559613,12.297778]}},"evals":[],"jsHooks":[]}</script>
<p>A more advanced setup is to use the <code>addFlows</code> function from the <a href="https://github.com/rte-antares-rpackage/leaflet.minicharts">leaflet.minicharts</a> package. First let us define some lines:</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="mod-maps.html#cb488-1" aria-hidden="true" tabindex="-1"></a>datLines <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">FromId =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>), <span class="at">ToId =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb488-2"><a href="mod-maps.html#cb488-2" aria-hidden="true" tabindex="-1"></a>datLines <span class="ot">&lt;-</span> <span class="fu">left_join</span>(datLines, dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Shop, <span class="sc">-</span>Address), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;FromId&quot;</span> <span class="ot">=</span> <span class="st">&quot;Id&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb488-3"><a href="mod-maps.html#cb488-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="st">&quot;FromLat&quot;</span> <span class="ot">=</span> <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;FromLon&quot;</span> <span class="ot">=</span> <span class="st">&quot;lon&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb488-4"><a href="mod-maps.html#cb488-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">left_join</span>(dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Shop, <span class="sc">-</span>Address), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;ToId&quot;</span> <span class="ot">=</span> <span class="st">&quot;Id&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb488-5"><a href="mod-maps.html#cb488-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="st">&quot;ToLat&quot;</span> <span class="ot">=</span> <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;ToLon&quot;</span> <span class="ot">=</span> <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb488-6"><a href="mod-maps.html#cb488-6" aria-hidden="true" tabindex="-1"></a>datLines</span>
<span id="cb488-7"><a href="mod-maps.html#cb488-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 6</span></span>
<span id="cb488-8"><a href="mod-maps.html#cb488-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   FromId  ToId FromLon FromLat ToLon ToLat</span></span>
<span id="cb488-9"><a href="mod-maps.html#cb488-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb488-10"><a href="mod-maps.html#cb488-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      2     5    9.00    56.1  8.62  56.4</span></span>
<span id="cb488-11"><a href="mod-maps.html#cb488-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2      5     1    8.62    56.4  8.46  55.5</span></span>
<span id="cb488-12"><a href="mod-maps.html#cb488-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      1     2    8.46    55.5  9.00  56.1</span></span>
<span id="cb488-13"><a href="mod-maps.html#cb488-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4      2     4    9.00    56.1 10.0   57.4</span></span>
<span id="cb488-14"><a href="mod-maps.html#cb488-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5      4     3   10.0     57.4 12.3   55.9</span></span>
<span id="cb488-15"><a href="mod-maps.html#cb488-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6      3     2   12.3     55.9  9.00  56.1</span></span></code></pre></div>
<p>Note we have a from/to pair in each row. We add the lines to the map:</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="mod-maps.html#cb489-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet.minicharts)</span>
<span id="cb489-2"><a href="mod-maps.html#cb489-2" aria-hidden="true" tabindex="-1"></a>m <span class="sc">%&gt;%</span> <span class="fu">addFlows</span>(datLines<span class="sc">$</span>FromLon, datLines<span class="sc">$</span>FromLat, datLines<span class="sc">$</span>ToLon, datLines<span class="sc">$</span>ToLat,</span>
<span id="cb489-3"><a href="mod-maps.html#cb489-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">flow =</span> <span class="dv">1</span>, <span class="at">maxFlow =</span> <span class="dv">20</span>, <span class="at">opacity =</span> <span class="fl">0.5</span>, <span class="at">popup =</span> <span class="fu">popupArgs</span>(<span class="at">noPopup =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<div id="htmlwidget-0a0fb7e0d170cecbb5fc" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-0a0fb7e0d170cecbb5fc">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4446261,56.3779116],[8.4559613,9.0047956,12.297778,10.0031376,8.622241],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addFlows","args":[[{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (10.0031376,57.4446261) -> (12.297778,55.9290561)","lat0":57.4446261,"lat1":55.9290561,"lng0":10.0031376,"lng1":12.297778},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (12.297778,55.9290561) -> (9.0047956,56.1357775)","lat0":55.9290561,"lat1":56.1357775,"lng0":12.297778,"lng1":9.0047956},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (8.4559613,55.5107577) -> (9.0047956,56.1357775)","lat0":55.5107577,"lat1":56.1357775,"lng0":8.4559613,"lng1":9.0047956},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (8.622241,56.3779116) -> (8.4559613,55.5107577)","lat0":56.3779116,"lat1":55.5107577,"lng0":8.622241,"lng1":8.4559613},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (10.0031376,57.4446261)","lat0":56.1357775,"lat1":57.4446261,"lng0":9.0047956,"lng1":10.0031376},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (8.622241,56.3779116)","lat0":56.1357775,"lat1":56.3779116,"lng0":9.0047956,"lng1":8.622241},"timeSteps":1}],["1"],null,{"showTitle":true,"showValues":true,"labels":[],"supValues":null,"supLabels":[],"html":null,"noPopup":true,"digits":null},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4446261],"lng":[8.4559613,12.297778]}},"evals":[],"jsHooks":[]}</script>
<p>Let us define a function for adding routes:</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="mod-maps.html#cb490-1" aria-hidden="true" tabindex="-1"></a>add_route <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">dat =</span> <span class="cn">NULL</span>, route, <span class="at">solution =</span> <span class="dv">1</span>) {</span>
<span id="cb490-2"><a href="mod-maps.html#cb490-2" aria-hidden="true" tabindex="-1"></a>   route_id <span class="ot">=</span> <span class="fu">if_else</span>(<span class="fu">is.null</span>(dat), <span class="dv">1</span>, <span class="fu">max</span>(dat<span class="sc">$</span>RouteId) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb490-3"><a href="mod-maps.html#cb490-3" aria-hidden="true" tabindex="-1"></a>   tmp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">From =</span> route[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(route)<span class="sc">-</span><span class="dv">1</span>)], <span class="at">To =</span> route[<span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(route)])</span>
<span id="cb490-4"><a href="mod-maps.html#cb490-4" aria-hidden="true" tabindex="-1"></a>   tmp <span class="ot">&lt;-</span> tmp <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Sol =</span> solution, <span class="at">RouteId =</span> route_id)</span>
<span id="cb490-5"><a href="mod-maps.html#cb490-5" aria-hidden="true" tabindex="-1"></a>   dat <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(dat, tmp)</span>
<span id="cb490-6"><a href="mod-maps.html#cb490-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb490-7"><a href="mod-maps.html#cb490-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb490-8"><a href="mod-maps.html#cb490-8" aria-hidden="true" tabindex="-1"></a>datLines <span class="ot">&lt;-</span> <span class="fu">add_route</span>(<span class="at">route =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb490-9"><a href="mod-maps.html#cb490-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">add_route</span>(<span class="at">route =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb490-10"><a href="mod-maps.html#cb490-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">add_route</span>(<span class="at">route =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="at">solution =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb490-11"><a href="mod-maps.html#cb490-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">add_route</span>(<span class="at">route =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>), <span class="at">solution =</span> <span class="dv">2</span>)</span>
<span id="cb490-12"><a href="mod-maps.html#cb490-12" aria-hidden="true" tabindex="-1"></a>datLines <span class="ot">&lt;-</span> <span class="fu">left_join</span>(datLines, dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Shop, <span class="sc">-</span>Address), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;From&quot;</span> <span class="ot">=</span> <span class="st">&quot;Id&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb490-13"><a href="mod-maps.html#cb490-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="st">&quot;FromLat&quot;</span> <span class="ot">=</span> <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;FromLon&quot;</span> <span class="ot">=</span> <span class="st">&quot;lon&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb490-14"><a href="mod-maps.html#cb490-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">left_join</span>(dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Shop, <span class="sc">-</span>Address), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;To&quot;</span> <span class="ot">=</span> <span class="st">&quot;Id&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb490-15"><a href="mod-maps.html#cb490-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="st">&quot;ToLat&quot;</span> <span class="ot">=</span> <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;ToLon&quot;</span> <span class="ot">=</span> <span class="st">&quot;lon&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb490-16"><a href="mod-maps.html#cb490-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">str_c</span>(<span class="st">&quot;Solution &quot;</span>, Sol))</span>
<span id="cb490-17"><a href="mod-maps.html#cb490-17" aria-hidden="true" tabindex="-1"></a>datLines</span>
<span id="cb490-18"><a href="mod-maps.html#cb490-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 12 × 9</span></span>
<span id="cb490-19"><a href="mod-maps.html#cb490-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     From    To   Sol RouteId FromLon FromLat ToLon ToLat group     </span></span>
<span id="cb490-20"><a href="mod-maps.html#cb490-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     </span></span>
<span id="cb490-21"><a href="mod-maps.html#cb490-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     2     5     1       1    9.00    56.1  8.62  56.4 Solution 1</span></span>
<span id="cb490-22"><a href="mod-maps.html#cb490-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     5     1     1       1    8.62    56.4  8.46  55.5 Solution 1</span></span>
<span id="cb490-23"><a href="mod-maps.html#cb490-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     1     2     1       1    8.46    55.5  9.00  56.1 Solution 1</span></span>
<span id="cb490-24"><a href="mod-maps.html#cb490-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     2     4     1       2    9.00    56.1 10.0   57.4 Solution 1</span></span>
<span id="cb490-25"><a href="mod-maps.html#cb490-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     4     3     1       2   10.0     57.4 12.3   55.9 Solution 1</span></span>
<span id="cb490-26"><a href="mod-maps.html#cb490-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     3     2     1       2   12.3     55.9  9.00  56.1 Solution 1</span></span>
<span id="cb490-27"><a href="mod-maps.html#cb490-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     2     3     2       3    9.00    56.1 12.3   55.9 Solution 2</span></span>
<span id="cb490-28"><a href="mod-maps.html#cb490-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     3     1     2       3   12.3     55.9  8.46  55.5 Solution 2</span></span>
<span id="cb490-29"><a href="mod-maps.html#cb490-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     1     2     2       3    8.46    55.5  9.00  56.1 Solution 2</span></span>
<span id="cb490-30"><a href="mod-maps.html#cb490-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10     2     5     2       4    9.00    56.1  8.62  56.4 Solution 2</span></span>
<span id="cb490-31"><a href="mod-maps.html#cb490-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11     5     4     2       4    8.62    56.4 10.0   57.4 Solution 2</span></span>
<span id="cb490-32"><a href="mod-maps.html#cb490-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12     4     2     2       4   10.0     57.4  9.00  56.1 Solution 2</span></span></code></pre></div>
<p>A map with Solution 1:</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="mod-maps.html#cb491-1" aria-hidden="true" tabindex="-1"></a>col_pal <span class="ot">&lt;-</span> <span class="fu">rainbow</span>(<span class="fu">max</span>(datLines<span class="sc">$</span>RouteId))</span>
<span id="cb491-2"><a href="mod-maps.html#cb491-2" aria-hidden="true" tabindex="-1"></a>datP <span class="ot">&lt;-</span> datLines <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sol <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb491-3"><a href="mod-maps.html#cb491-3" aria-hidden="true" tabindex="-1"></a>m <span class="sc">%&gt;%</span> <span class="fu">addFlows</span>(datP<span class="sc">$</span>FromLon, datP<span class="sc">$</span>FromLat, datP<span class="sc">$</span>ToLon, datP<span class="sc">$</span>ToLat,</span>
<span id="cb491-4"><a href="mod-maps.html#cb491-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">flow =</span> datP<span class="sc">$</span>RouteId, <span class="at">maxThickness =</span> <span class="dv">2</span>, <span class="at">color =</span> col_pal[datP<span class="sc">$</span>RouteId],</span>
<span id="cb491-5"><a href="mod-maps.html#cb491-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">opacity =</span> <span class="fl">0.5</span>, <span class="at">popup =</span> <span class="fu">popupArgs</span>(<span class="at">labels =</span> <span class="st">&quot;Route&quot;</span>))</span></code></pre></div>
<div id="htmlwidget-20e8358343efa7798524" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-20e8358343efa7798524">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4446261,56.3779116],[8.4559613,9.0047956,12.297778,10.0031376,8.622241],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addFlows","args":[[{"dyn":{"color":["#80FF00"],"value":[2]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (10.0031376,57.4446261) -> (12.297778,55.9290561)","lat0":57.4446261,"lat1":55.9290561,"lng0":10.0031376,"lng1":12.297778},"timeSteps":1},{"dyn":{"color":["#80FF00"],"value":[2]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (12.297778,55.9290561) -> (9.0047956,56.1357775)","lat0":55.9290561,"lat1":56.1357775,"lng0":12.297778,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#FF0000"],"value":[1]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.4559613,55.5107577) -> (9.0047956,56.1357775)","lat0":55.5107577,"lat1":56.1357775,"lng0":8.4559613,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#FF0000"],"value":[1]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.622241,56.3779116) -> (8.4559613,55.5107577)","lat0":56.3779116,"lat1":55.5107577,"lng0":8.622241,"lng1":8.4559613},"timeSteps":1},{"dyn":{"color":["#80FF00"],"value":[2]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (10.0031376,57.4446261)","lat0":56.1357775,"lat1":57.4446261,"lng0":9.0047956,"lng1":10.0031376},"timeSteps":1},{"dyn":{"color":["#FF0000"],"value":[1]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (8.622241,56.3779116)","lat0":56.1357775,"lat1":56.3779116,"lng0":9.0047956,"lng1":8.622241},"timeSteps":1}],["1"],null,{"showTitle":true,"showValues":true,"labels":["Route"],"supValues":null,"supLabels":[],"html":null,"noPopup":false,"digits":null},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4446261],"lng":[8.4559613,12.297778]}},"evals":[],"jsHooks":[]}</script>
<p>A map with Solution 2:</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="mod-maps.html#cb492-1" aria-hidden="true" tabindex="-1"></a>col_pal <span class="ot">&lt;-</span> <span class="fu">rainbow</span>(<span class="fu">max</span>(datLines<span class="sc">$</span>RouteId))</span>
<span id="cb492-2"><a href="mod-maps.html#cb492-2" aria-hidden="true" tabindex="-1"></a>datP <span class="ot">&lt;-</span> datLines <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sol <span class="sc">==</span> <span class="dv">2</span>)</span>
<span id="cb492-3"><a href="mod-maps.html#cb492-3" aria-hidden="true" tabindex="-1"></a>m <span class="sc">%&gt;%</span> <span class="fu">addFlows</span>(datP<span class="sc">$</span>FromLon, datP<span class="sc">$</span>FromLat, datP<span class="sc">$</span>ToLon, datP<span class="sc">$</span>ToLat,</span>
<span id="cb492-4"><a href="mod-maps.html#cb492-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">flow =</span> datP<span class="sc">$</span>RouteId, <span class="at">maxThickness =</span> <span class="dv">2</span>, <span class="at">color =</span> col_pal[datP<span class="sc">$</span>RouteId],</span>
<span id="cb492-5"><a href="mod-maps.html#cb492-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">opacity =</span> <span class="fl">0.5</span>, <span class="at">popup =</span> <span class="fu">popupArgs</span>(<span class="at">labels =</span> <span class="st">&quot;Route&quot;</span>))</span></code></pre></div>
<div id="htmlwidget-6ed45c96dd4286c0021e" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-6ed45c96dd4286c0021e">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4446261,56.3779116],[8.4559613,9.0047956,12.297778,10.0031376,8.622241],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addFlows","args":[[{"dyn":{"color":["#8000FF"],"value":[4]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (10.0031376,57.4446261) -> (9.0047956,56.1357775)","lat0":57.4446261,"lat1":56.1357775,"lng0":10.0031376,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#00FFFF"],"value":[3]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (12.297778,55.9290561) -> (8.4559613,55.5107577)","lat0":55.9290561,"lat1":55.5107577,"lng0":12.297778,"lng1":8.4559613},"timeSteps":1},{"dyn":{"color":["#00FFFF"],"value":[3]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.4559613,55.5107577) -> (9.0047956,56.1357775)","lat0":55.5107577,"lat1":56.1357775,"lng0":8.4559613,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#8000FF"],"value":[4]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.622241,56.3779116) -> (10.0031376,57.4446261)","lat0":56.3779116,"lat1":57.4446261,"lng0":8.622241,"lng1":10.0031376},"timeSteps":1},{"dyn":{"color":["#00FFFF"],"value":[3]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (12.297778,55.9290561)","lat0":56.1357775,"lat1":55.9290561,"lng0":9.0047956,"lng1":12.297778},"timeSteps":1},{"dyn":{"color":["#8000FF"],"value":[4]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (8.622241,56.3779116)","lat0":56.1357775,"lat1":56.3779116,"lng0":9.0047956,"lng1":8.622241},"timeSteps":1}],["1"],null,{"showTitle":true,"showValues":true,"labels":["Route"],"supValues":null,"supLabels":[],"html":null,"noPopup":false,"digits":null},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4446261],"lng":[8.4559613,12.297778]}},"evals":[],"jsHooks":[]}</script>
<p>An interactive map with both solutions:</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="mod-maps.html#cb493-1" aria-hidden="true" tabindex="-1"></a>mm <span class="ot">&lt;-</span> m</span>
<span id="cb493-2"><a href="mod-maps.html#cb493-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(datLines), <span class="cf">function</span>(i) {</span>
<span id="cb493-3"><a href="mod-maps.html#cb493-3" aria-hidden="true" tabindex="-1"></a>   tmp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">lat =</span> <span class="fu">c</span>(datLines<span class="sc">$</span>FromLat[i], datLines<span class="sc">$</span>ToLat[i]), <span class="at">lon =</span> <span class="fu">c</span>(datLines<span class="sc">$</span>FromLon[i], datLines<span class="sc">$</span>ToLon[i]))</span>
<span id="cb493-4"><a href="mod-maps.html#cb493-4" aria-hidden="true" tabindex="-1"></a>   mm <span class="ot">&lt;&lt;-</span> mm <span class="sc">%&gt;%</span> <span class="fu">addPolylines</span>(<span class="at">lng =</span> <span class="sc">~</span>lon, <span class="at">lat =</span> <span class="sc">~</span>lat, </span>
<span id="cb493-5"><a href="mod-maps.html#cb493-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">color =</span> col_pal[datLines<span class="sc">$</span>Sol[i]], <span class="at">group =</span> datLines<span class="sc">$</span>group[i],</span>
<span id="cb493-6"><a href="mod-maps.html#cb493-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span> tmp, <span class="at">weight =</span> <span class="dv">2</span>, <span class="at">label =</span> datLines<span class="sc">$</span>group[i])</span>
<span id="cb493-7"><a href="mod-maps.html#cb493-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb493-8"><a href="mod-maps.html#cb493-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb493-9"><a href="mod-maps.html#cb493-9" aria-hidden="true" tabindex="-1"></a>mm <span class="ot">&lt;-</span> mm <span class="sc">%&gt;%</span> </span>
<span id="cb493-10"><a href="mod-maps.html#cb493-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Layer control</span></span>
<span id="cb493-11"><a href="mod-maps.html#cb493-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addLayersControl</span>(</span>
<span id="cb493-12"><a href="mod-maps.html#cb493-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">&quot;Map&quot;</span>, <span class="st">&quot;Satelite&quot;</span>),</span>
<span id="cb493-13"><a href="mod-maps.html#cb493-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">overlayGroups =</span> <span class="fu">unique</span>(datLines<span class="sc">$</span>group),</span>
<span id="cb493-14"><a href="mod-maps.html#cb493-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">options =</span> <span class="fu">layersControlOptions</span>(<span class="at">collapsed =</span> <span class="cn">FALSE</span>)</span>
<span id="cb493-15"><a href="mod-maps.html#cb493-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb493-16"><a href="mod-maps.html#cb493-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hideGroup</span>(<span class="fu">unique</span>(datLines<span class="sc">$</span>group)) <span class="sc">%&gt;%</span> </span>
<span id="cb493-17"><a href="mod-maps.html#cb493-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showGroup</span>(<span class="st">&quot;Solution 1&quot;</span>)</span>
<span id="cb493-18"><a href="mod-maps.html#cb493-18" aria-hidden="true" tabindex="-1"></a>mm</span></code></pre></div>
<div id="htmlwidget-c0a87ddff1586a21c117" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-c0a87ddff1586a21c117">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4446261,56.3779116],[8.4559613,9.0047956,12.297778,10.0031376,8.622241],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,8.622241],"lat":[56.1357775,56.3779116]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.622241,8.4559613],"lat":[56.3779116,55.5107577]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.4559613,9.0047956],"lat":[55.5107577,56.1357775]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,10.0031376],"lat":[56.1357775,57.4446261]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[10.0031376,12.297778],"lat":[57.4446261,55.9290561]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[12.297778,9.0047956],"lat":[55.9290561,56.1357775]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,12.297778],"lat":[56.1357775,55.9290561]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[12.297778,8.4559613],"lat":[55.9290561,55.5107577]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.4559613,9.0047956],"lat":[55.5107577,56.1357775]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,8.622241],"lat":[56.1357775,56.3779116]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.622241,10.0031376],"lat":[56.3779116,57.4446261]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[10.0031376,9.0047956],"lat":[57.4446261,56.1357775]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[["Map","Satelite"],["Solution 1","Solution 2"],{"collapsed":false,"autoZIndex":true,"position":"topright"}]},{"method":"hideGroup","args":[["Solution 1","Solution 2"]]},{"method":"showGroup","args":["Solution 1"]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4446261],"lng":[8.4559613,12.297778]}},"evals":[],"jsHooks":[]}</script>
<p>Note unfortunately arrows cannot be shown in this case.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mod-project.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mod-r-excel.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/bss-osca/tfa/edit/master/book/09-01_r-maps.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

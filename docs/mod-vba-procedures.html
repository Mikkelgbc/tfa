<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Module 4 Procedures | Tools for Analytics (TFA)</title>
  <meta name="description" content="Course notes for the ‘Tools for Analytics’ course" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Module 4 Procedures | Tools for Analytics (TFA)" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://bss-osca.github.io/tfa//assets/logo.png" />
  <meta property="og:description" content="Course notes for the ‘Tools for Analytics’ course" />
  <meta name="github-repo" content="bss-osca/tfa" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Module 4 Procedures | Tools for Analytics (TFA)" />
  
  <meta name="twitter:description" content="Course notes for the ‘Tools for Analytics’ course" />
  <meta name="twitter:image" content="https://bss-osca.github.io/tfa//assets/logo.png" />

<meta name="author" content="Lars Relund Nielsen" />


<meta name="date" content="2022-07-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon" />
<link rel="prev" href="mod-vba-loops-cond.html"/>
<link rel="next" href="mod-vba-datatypes.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.9/grViz.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.23/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<html>
<head>
<script>
  $(document).ready(function() {

  // Section anchors
  $('.section h1, .section h2, .section h3, .section h4, .section h5').each(function() {
    anchor = '#' + $(this).parent().attr('id');
    $(this).addClass("hasAnchor").prepend('<a href="' + anchor + '" class="anchor"></a>');
  });
});
</script>
<script src="https://hypothes.is/embed.js" async></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</head>
</html>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="img/logo.png"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction to the course</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#lo-intro"><i class="fa fa-check"></i><b>1.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#purpose"><i class="fa fa-check"></i><b>1.2</b> Purpose for the course</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#r-vs-vba"><i class="fa fa-check"></i><b>1.3</b> R vs Excel/VBA</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#computer"><i class="fa fa-check"></i><b>1.4</b> How a computer works</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#organization"><i class="fa fa-check"></i><b>1.5</b> How the notes are organized</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#ack"><i class="fa fa-check"></i><b>1.6</b> Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I VBA</b></span></li>
<li class="chapter" data-level="2" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html"><i class="fa fa-check"></i><b>2</b> An introduction to VBA</a>
<ul>
<li class="chapter" data-level="2.1" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#lo-vba-intro"><i class="fa fa-check"></i><b>2.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="2.2" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#vba-what"><i class="fa fa-check"></i><b>2.2</b> What is VBA</a></li>
<li class="chapter" data-level="2.3" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#vba-setup"><i class="fa fa-check"></i><b>2.3</b> Setup Excel for VBA</a></li>
<li class="chapter" data-level="2.4" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#vba-hello"><i class="fa fa-check"></i><b>2.4</b> Your first program</a></li>
<li class="chapter" data-level="2.5" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#vba-macro"><i class="fa fa-check"></i><b>2.5</b> The macro recorder</a></li>
<li class="chapter" data-level="2.6" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#vba-overview"><i class="fa fa-check"></i><b>2.6</b> VBA - A short overview</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#variables"><i class="fa fa-check"></i><b>2.6.1</b> Variables</a></li>
<li class="chapter" data-level="2.6.2" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#procedures"><i class="fa fa-check"></i><b>2.6.2</b> Procedures</a></li>
<li class="chapter" data-level="2.6.3" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#input-and-output"><i class="fa fa-check"></i><b>2.6.3</b> Input and output</a></li>
<li class="chapter" data-level="2.6.4" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#conditional-statements"><i class="fa fa-check"></i><b>2.6.4</b> Conditional statements</a></li>
<li class="chapter" data-level="2.6.5" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#loops"><i class="fa fa-check"></i><b>2.6.5</b> Loops</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#vba-coding-practice"><i class="fa fa-check"></i><b>2.7</b> Good coding pratice</a></li>
<li class="chapter" data-level="2.8" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#rc-vba-intro"><i class="fa fa-check"></i><b>2.8</b> Recap</a></li>
<li class="chapter" data-level="2.9" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-intro"><i class="fa fa-check"></i><b>2.9</b> Exercises</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-hello"><i class="fa fa-check"></i><b>2.9.1</b> Exercise - Hello</a></li>
<li class="chapter" data-level="2.9.2" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-macro"><i class="fa fa-check"></i><b>2.9.2</b> Exercise - Record a macro</a></li>
<li class="chapter" data-level="2.9.3" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-user-input"><i class="fa fa-check"></i><b>2.9.3</b> Exercise - User input</a></li>
<li class="chapter" data-level="2.9.4" data-path="mod-vba-intro.html"><a href="mod-vba-intro.html#ex-vba-max-min"><i class="fa fa-check"></i><b>2.9.4</b> Exercise - Max and min number</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html"><i class="fa fa-check"></i><b>3</b> Loops and conditional statements</a>
<ul>
<li class="chapter" data-level="3.1" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#lo-vba-loops-cond"><i class="fa fa-check"></i><b>3.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="3.2" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#vba-operators"><i class="fa fa-check"></i><b>3.2</b> Relational and logical operators</a></li>
<li class="chapter" data-level="3.3" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#vba-loops"><i class="fa fa-check"></i><b>3.3</b> Loops</a></li>
<li class="chapter" data-level="3.4" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#vba-cond"><i class="fa fa-check"></i><b>3.4</b> Conditional statements</a></li>
<li class="chapter" data-level="3.5" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#vba-ex-jen"><i class="fa fa-check"></i><b>3.5</b> Example - Find Jen</a></li>
<li class="chapter" data-level="3.6" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#vba-ex-dist-mat"><i class="fa fa-check"></i><b>3.6</b> Example - A distance matrix</a></li>
<li class="chapter" data-level="3.7" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#recap"><i class="fa fa-check"></i><b>3.7</b> Recap</a></li>
<li class="chapter" data-level="3.8" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#ex-vba-loops-cond"><i class="fa fa-check"></i><b>3.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#ex-vba-loops"><i class="fa fa-check"></i><b>3.8.1</b> Exercise - Loops</a></li>
<li class="chapter" data-level="3.8.2" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#ex-vba-flight"><i class="fa fa-check"></i><b>3.8.2</b> Exercise - Flight search</a></li>
<li class="chapter" data-level="3.8.3" data-path="mod-vba-loops-cond.html"><a href="mod-vba-loops-cond.html#ex-vba-job-seq"><i class="fa fa-check"></i><b>3.8.3</b> Exercise - Job sequencing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html"><i class="fa fa-check"></i><b>4</b> Procedures</a>
<ul>
<li class="chapter" data-level="4.1" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#lo-vba-procedures"><i class="fa fa-check"></i><b>4.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="4.2" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#vba-subs-functions"><i class="fa fa-check"></i><b>4.2</b> Subs and functions - The basics</a></li>
<li class="chapter" data-level="4.3" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#optional-arguments"><i class="fa fa-check"></i><b>4.3</b> Optional arguments</a></li>
<li class="chapter" data-level="4.4" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#public-and-private-procedures"><i class="fa fa-check"></i><b>4.4</b> Public and private procedures</a></li>
<li class="chapter" data-level="4.5" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#vba-byref"><i class="fa fa-check"></i><b>4.5</b> Passing arguments by reference or by value</a></li>
<li class="chapter" data-level="4.6" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#built-in-functions"><i class="fa fa-check"></i><b>4.6</b> Built-in functions</a></li>
<li class="chapter" data-level="4.7" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#recap-1"><i class="fa fa-check"></i><b>4.7</b> Recap</a></li>
<li class="chapter" data-level="4.8" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#ex-vba-procedures"><i class="fa fa-check"></i><b>4.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#ex-vba-subs"><i class="fa fa-check"></i><b>4.8.1</b> Exercise - Subs</a></li>
<li class="chapter" data-level="4.8.2" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#ex-vba-functions"><i class="fa fa-check"></i><b>4.8.2</b> Exercise - Functions</a></li>
<li class="chapter" data-level="4.8.3" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#ex-vba-worksheet-functions"><i class="fa fa-check"></i><b>4.8.3</b> Exercise - Worksheet functions</a></li>
<li class="chapter" data-level="4.8.4" data-path="mod-vba-procedures.html"><a href="mod-vba-procedures.html#ex-vba-byref"><i class="fa fa-check"></i><b>4.8.4</b> Exercise - <code>ByRef</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html"><i class="fa fa-check"></i><b>5</b> Advanced data types and usage</a>
<ul>
<li class="chapter" data-level="5.1" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#lo-vba-datatypes"><i class="fa fa-check"></i><b>5.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="5.2" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#why-declare-variables"><i class="fa fa-check"></i><b>5.2</b> Why declare variables?</a></li>
<li class="chapter" data-level="5.3" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#declare-and-assign-values-to-variables"><i class="fa fa-check"></i><b>5.3</b> Declare and assign values to variables</a></li>
<li class="chapter" data-level="5.4" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#strings"><i class="fa fa-check"></i><b>5.4</b> Strings</a></li>
<li class="chapter" data-level="5.5" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#vba-objects"><i class="fa fa-check"></i><b>5.5</b> Objects</a></li>
<li class="chapter" data-level="5.6" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#worksheets"><i class="fa fa-check"></i><b>5.6</b> Worksheets</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ranges"><i class="fa fa-check"></i><b>5.6.1</b> Ranges</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#arrays"><i class="fa fa-check"></i><b>5.7</b> Arrays</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#multi-dimensional-arrays"><i class="fa fa-check"></i><b>5.7.1</b> Multi-dimensional arrays</a></li>
<li class="chapter" data-level="5.7.2" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#dynamic-arrays"><i class="fa fa-check"></i><b>5.7.2</b> Dynamic arrays</a></li>
<li class="chapter" data-level="5.7.3" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#use-arrays-instead-of-ranges"><i class="fa fa-check"></i><b>5.7.3</b> Use arrays instead of ranges</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#collections"><i class="fa fa-check"></i><b>5.8</b> Collections</a></li>
<li class="chapter" data-level="5.9" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#vba-code-structure"><i class="fa fa-check"></i><b>5.9</b> How do I structure my code?</a></li>
<li class="chapter" data-level="5.10" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#recap-2"><i class="fa fa-check"></i><b>5.10</b> Recap</a></li>
<li class="chapter" data-level="5.11" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-datatypes"><i class="fa fa-check"></i><b>5.11</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.11.1" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-search-products"><i class="fa fa-check"></i><b>5.11.1</b> Exercise - Product search</a></li>
<li class="chapter" data-level="5.11.2" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-read-arrays"><i class="fa fa-check"></i><b>5.11.2</b> Exercise - Read arrays</a></li>
<li class="chapter" data-level="5.11.3" data-path="mod-vba-datatypes.html"><a href="mod-vba-datatypes.html#ex-vba-read-collections"><i class="fa fa-check"></i><b>5.11.3</b> Exercise - Read collections</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html"><i class="fa fa-check"></i><b>6</b> Generating random numbers</a>
<ul>
<li class="chapter" data-level="6.1" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#lo-vba-random-numbers"><i class="fa fa-check"></i><b>6.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="6.2" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#vba-random-numbers"><i class="fa fa-check"></i><b>6.2</b> Generating random numbers</a></li>
<li class="chapter" data-level="6.3" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#vba-simulation"><i class="fa fa-check"></i><b>6.3</b> Simulation</a></li>
<li class="chapter" data-level="6.4" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#recap-3"><i class="fa fa-check"></i><b>6.4</b> Recap</a></li>
<li class="chapter" data-level="6.5" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#ex-vba-random-numbers"><i class="fa fa-check"></i><b>6.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#ex-vba-generate"><i class="fa fa-check"></i><b>6.5.1</b> Exercise - Generating random numbers</a></li>
<li class="chapter" data-level="6.5.2" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#ex-vba-tsp"><i class="fa fa-check"></i><b>6.5.2</b> Exercise - Traveling salesman problem</a></li>
<li class="chapter" data-level="6.5.3" data-path="mod-vba-random-numbers.html"><a href="mod-vba-random-numbers.html#ex-vba-bakery"><i class="fa fa-check"></i><b>6.5.3</b> Exercise - Dan’s bakery</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="groups.html"><a href="groups.html"><i class="fa fa-check"></i><b>A</b> Working in groups</a>
<ul>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#joint-r-project-structure"><i class="fa fa-check"></i>Joint R project structure</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#using-git"><i class="fa fa-check"></i>Using Git together with GitHub</a>
<ul>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#register-a-free-github-account"><i class="fa fa-check"></i>Register a free GitHub account</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#install-git"><i class="fa fa-check"></i>Install Git</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#check-your-installation"><i class="fa fa-check"></i>Check your installation</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#setup-projects-using-git-and-github"><i class="fa fa-check"></i>Setup projects using Git and GitHub</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="annotate.html"><a href="annotate.html"><i class="fa fa-check"></i><b>B</b> Annotate the course notes</a></li>
<li class="chapter" data-level="C" data-path="help.html"><a href="help.html"><i class="fa fa-check"></i><b>C</b> Getting help</a></li>
<li class="chapter" data-level="D" data-path="coding-convention.html"><a href="coding-convention.html"><i class="fa fa-check"></i><b>D</b> Coding/naming convention</a>
<ul>
<li class="chapter" data-level="D.1" data-path="coding-convention.html"><a href="coding-convention.html#commenting-your-code"><i class="fa fa-check"></i><b>D.1</b> Commenting your code</a></li>
</ul></li>
<li class="chapter" data-level="E" data-path="vba-specific-topics.html"><a href="vba-specific-topics.html"><i class="fa fa-check"></i><b>E</b> VBA specific topics</a>
<ul>
<li class="chapter" data-level="E.1" data-path="vba-specific-topics.html"><a href="vba-specific-topics.html#vba-debug"><i class="fa fa-check"></i><b>E.1</b> Debugging your code</a></li>
<li class="chapter" data-level="E.2" data-path="vba-specific-topics.html"><a href="vba-specific-topics.html#error-handling"><i class="fa fa-check"></i><b>E.2</b> Error handling</a></li>
<li class="chapter" data-level="E.3" data-path="vba-specific-topics.html"><a href="vba-specific-topics.html#vba-course-procedures"><i class="fa fa-check"></i><b>E.3</b> Course procedures</a></li>
</ul></li>
<li class="chapter" data-level="F" data-path="lg-course.html"><a href="lg-course.html"><i class="fa fa-check"></i><b>F</b> Learning goals</a></li>
<li class="chapter" data-level="G" data-path="sec:ba.html"><a href="sec:ba.html"><i class="fa fa-check"></i><b>G</b> Business Analytics</a></li>
<li class="chapter" data-level="H" data-path="colophon.html"><a href="colophon.html"><i class="fa fa-check"></i><b>H</b> Colophon</a></li>
<li class="divider"></li>
<li><center>
  <a rel="license" href="./index.html#ack">
    License: CC BY-NC-SA<br>
    <i class = "fab fa-creative-commons fa-2x"></i>
    <i class = "fab fa-creative-commons-by fa-2x"></i>
    <i class = "fab fa-creative-commons-nc fa-2x"></i>
    <i class = "fab fa-creative-commons-sa fa-2x"></i>
  </a>
</li></center>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tools for Analytics (TFA)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mod-vba-procedures" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Module 4</span> Procedures<a href="mod-vba-procedures.html#mod-vba-procedures" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This module gives a short introduction to procedures. A procedure is a piece of code stored in a module which contains a series of computational steps that will be carried out when the procedure is called. VBA has two kinds of procedures subs (short for subroutine) and functions. Both are basic building blocks in programming. The main differences between a sub and a function is:</p>
<p><strong>Subs</strong></p>
<ul>
<li>Can make changes to the worksheet.</li>
<li>Can modify its surroundings.</li>
<li>Can be executed by a button (a macro - if no arguments).</li>
<li>Cannot return anything.</li>
</ul>
<p><strong>Functions</strong></p>
<ul>
<li>Can return something.</li>
<li>Can be used in Excel.</li>
<li>Cannot be used as a macro.</li>
</ul>
<div>
A template with VBA code for this module is given in the file
<a href="https://github.com/bss-osca/tfa/blob/master/vba/04-vba-procedures-template.xlsm" target="_blank">04-vba-procedures-template.xlsm</a>
(open it and use it while reading the notes). Have a look inside the module
<i>TM4_ex</i>
for examples used in the notes and during lectures. Have a look at module
<i>TM4_exercises</i>
for exercises. The template file for next teaching module will contain guiding answers for the exercises to this teaching module.
</div>
<p>During execution of procedures it may be useful to use the debugger to run the code step by step. A very short introduction to debugging in VBA is given in Section @ref(#vba-debug). Read it before continuing this teaching module.</p>
<div id="learning-path-diagram-3" class="section level4 unnumbered hasAnchor">
<h4>Learning path diagram<a href="mod-vba-procedures.html#learning-path-diagram-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Click/hover the nodes to follow links and see details.</p>
<div id="htmlwidget-4e3e2f38c3ca21f58512" style="width:100%;height:400px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-4e3e2f38c3ca21f58512">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"📖 Procedures\", URL = \"#vba-procedures\", tooltip = \"Procedures\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"2,1!\"] \n  \"2\" [label = \"📖 How do I debug my code?\", URL = \"#vba-debug\", tooltip = \"How do I debug my code?\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"5,1!\"] \n  \"3\" [label = \"💻 Exercises\", URL = \"#ex-vba-procedures\", tooltip = \"Exercises\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"8,1!\"] \n  \"4\" [label = \"🎬 Subs and parameters\", URL = \"https://youtu.be/aoueDZDh0D4\", tooltip = \"Subs and parameters\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"2,2!\"] \n  \"5\" [label = \"🎬 Functions\", URL = \"https://youtu.be/1rK_WVYn2oQ\", tooltip = \"Functions\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"2,3!\"] \n  \"6\" [label = \"🎬 Debug toolbar\", URL = \"https://youtu.be/AONXBZdx20Y\", tooltip = \"Debug toolbar\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"4,2!\"] \n  \"7\" [label = \"🎬 Locals window\", URL = \"https://youtu.be/BC8py7Ce2rg\", tooltip = \"Locals window\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"4,3!\"] \n  \"8\" [label = \"🎬 Breakpoints\", URL = \"https://youtu.be/k_1zrFdlZCU\", tooltip = \"Breakpoints\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"4,4!\"] \n  \"9\" [label = \"📖 Chapter 9 in\\nWøhlk (2010)\", URL = \"\", tooltip = \"Chapter 9 in Wøhlk (2010)\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"6,2!\"] \n  \"10\" [label = \"\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"0.5\", fontname = \"Helvetica\", shape = \"rect\", height = \"1\", width = \"6\", fillcolor = \"#F0F8FF\", pos = \"4,-0.14!\"] \n  \"11\" [label = \"Color:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"0.8\", fillcolor = \"#FFFFFE\", pos = \"1.37,0.2!\"] \n  \"12\" [label = \"mandatory\", URL = \"\", tooltip = \"Mandatory syllabus.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkSeaGreen4\", pos = \"1.6,-0.2!\"] \n  \"13\" [label = \"alternative\", URL = \"\", tooltip = \"Alternative syllabus if you prefer another learning style.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkOrange4\", pos = \"2.6,-0.2!\"] \n  \"14\" [label = \"extra\", URL = \"\", tooltip = \"Extra learning if you are interested (not part of syllabus).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"PeachPuff3\", pos = \"3.6,-0.2!\"] \n  \"15\" [label = \"Shape:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"1\", fillcolor = \"#FFFFFE\", pos = \"4.8,0.2!\"] \n  \"16\" [label = \"non-interactive\", URL = \"\", tooltip = \"Non-interactive learning content (e.g. reading).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"1\", fillcolor = \"Grey40\", pos = \"5.1,-0.2!\"] \n  \"17\" [label = \"interactive\", URL = \"\", tooltip = \"Interactive learning content (tutorial, exercises etc.).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"egg\", width = \"1\", fillcolor = \"Grey40\", pos = \"6.35,-0.2!\"] \n\"1\"->\"2\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"4\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"3\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"9\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"6\" [color = \"black\", arrowhead = \"vee\"] \n\"4\"->\"5\" [color = \"black\", arrowhead = \"vee\"] \n\"6\"->\"7\" [color = \"black\", arrowhead = \"vee\"] \n\"7\"->\"8\" [color = \"black\", arrowhead = \"vee\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>In general syllabus will point to chapters in <span class="citation">Wøhlk (<a href="#ref-vba-book" role="doc-biblioref">2010</a>)</span>; however, there is a lot for videos about VBA online such as course <a href="https://www.youtube.com/playlist?list=PL3A6U40JUYCi4njVx59-vaUxYkG0yRO4m">14-Hour VBA Course</a>. You may have a look at these videos instead if you prefer a different learning style. In the learning path diagram, links to alternative online content will be pointed out. Note this is alternatives to the standard learning path that you may use instead. The learning path may also have extra content that is not a part of syllabus you can have a look at.</p>
</div>
<div id="lo-vba-procedures" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Learning outcomes<a href="mod-vba-procedures.html#lo-vba-procedures" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>By the end of this module, you are expected to be able to:</p>
<ul>
<li>Describe what a procedure is.</li>
<li>Explain what kind of procedures there are in VBA and what they can be used for.</li>
<li>Declare and call a procedure.</li>
<li>Explain what the difference is by using input arguments <em>by reference</em> or <em>by value</em> in a procedure.</li>
<li>Set the scope of a procedure using private or public procedures.</li>
<li>Set default input arguments.</li>
<li>Call built-in functions for VBA and Excel.</li>
</ul>
<p>The learning outcomes relate to the <a href="lg-course.html#lg-course">overall learning goals</a> number 1, 2, 4, 8 and 9 of the course.</p>
<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->
</div>
<div id="vba-subs-functions" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Subs and functions - The basics<a href="mod-vba-procedures.html#vba-subs-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A sub is declared using:</p>
<pre><code>Sub SubName(arg1 As &lt;datatype&gt;, arg2 As &lt;datatype&gt;)
   &lt;code&gt;
End Sub</code></pre>
<p>The name of the sub is <code>SubName</code> and it takes two <em>arguments</em> <code>arg1</code> and <code>arg2</code>. A sub can take an arbitrary number of arguments. Until now we have mostly considered subs with no arguments often called a macro. Macros can be called using a button in Excel.</p>
<p>A function is declared using:</p>
<pre><code>Function FunctionName(arg1 As &lt;datatype&gt;, arg2 As &lt;datatype&gt;) As &lt;return datatype&gt;
 &lt;code&gt;
 FunctionName = value  &#39; assign a return value to the function
End Sub</code></pre>
<p>The name of the function is <code>FunctionName</code> and it takes two <em>arguments</em> <code>arg1</code> and <code>arg2</code>. A function can take an arbitrary number of arguments. A function always return a value of a data type (a sub do not return anything). You return a value by assigning it to the variable <code>FunctionName</code> (same as the function name).</p>
<p>Let us consider a simple sub with one argument:</p>
<pre><code>Sub TM4_SimpleSub(str As String)
   MsgBox (str)
End Sub</code></pre>
<p>and a simple function with two arguments:</p>
<pre><code>Function TM4_SimpleFunc(dblA As Double, dblB As Double) As Integer
   TM4_SimpleFunc = dblA + dblB  &#39; return variable equals function name
End Function</code></pre>
<p>You call a sub from another procedure using the <code>Call</code> keyword and a another function by assigning its return value to a variable:</p>
<pre><code>&#39; Try running it using the debugger (Ctrl + F8 (win) or cmd + shift + I (mac))
Sub TM4_CallSimpleProc()
   Dim dblV As Double
   
   MsgBox (&quot;Ready&quot;)
   Call TM4_SimpleSub(&quot;SimpleSub&quot;)  &#39; call a sub within a procedure
   dblV = TM4_SimpleFunc(3, 4)      &#39; call a function within a procedure
   MsgBox (&quot;Value is &quot; &amp; intV)
End Sub</code></pre>
<p>It is always good coding practice to document you procedures:</p>
<pre><code>&#39;&#39; Product of two numbers
&#39; @param i First number
&#39; @param j Second number
&#39; @return The product i * j
&#39; @remarks The numbers are doubles.
Function TM4_ProductFunc(i As Double, j As Double) As Double
    TM4_ProductFunc = i * j
End Function

&#39;&#39; Product of two numbers which are stored in dblV (since ByRef is the default).
&#39; @param i First number
&#39; @param j Second number
&#39; @param dblV Stores the product
&#39; @remarks The numbers are doubles.
Private Sub TM4_ProductSub(i As Double, j As Double, dblV As Double)
    dblV = i * j
End Sub</code></pre>
<p>Note both procedures above do the same thing. The function returns the product and the procedure stores the product in argument <code>dblV</code> which is modified when the function call is returned:</p>
<pre><code>&#39;&#39; Use TM4_ProductSub (TM4_ProductFunc produce the same result)
&#39; Try running it using the debugger (Ctrl + F8 (win) or cmd + shift + I (mac))
Sub TM4_RunProductSub()
    Dim dblV As Double
    
    dblV = 4
    MsgBox (&quot;Current value is &quot; &amp; dblV)  &#39; Current value is 4
    Call TM4_ProductSub(7, 3, dblV)      &#39; dblV = TM4_ProductFunc(7, 3) (same result)
    MsgBox (&quot;Current value is &quot; &amp; dblV)  &#39; Current value is 21
End Sub</code></pre>
<p>The reason is that arguments are per default references pointing to the same place in memory (we will look at the details in Section <a href="mod-vba-procedures.html#vba-byref">4.5</a>).</p>
<p>You can use <code>Exit Sub</code>/<code>Exit Function</code> to exit the sub/function early in the code:</p>
<pre><code>&#39;&#39; Division of two numbers
&#39; @param i First number.
&#39; @param j Second number.
&#39; @return Divison i / j.
&#39; @remarks The numbers are doubles.
Sub TM4_DivisionSub(i As Double, j As Double)
    If j = 0 Then
      MsgBox (&quot;Error: division with zero!&quot;)
      Exit Sub
    End If
    MsgBox (&quot;Value is &quot; &amp; i / j)
End Sub

&#39;&#39; Run using F5
Sub TM4_TestDivisionSub()
    Call TM4_DivisionSub(8, 2)  &#39; no error
    Call TM4_DivisionSub(8, 0)  &#39; gives an error message
End Sub</code></pre>
</div>
<div id="optional-arguments" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Optional arguments<a href="mod-vba-procedures.html#optional-arguments" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Often you define procedures that have arguments with a default value. You can do this using the <code>Optional</code> keyword:</p>
<pre><code>&#39;&#39; Convert kilograms to grams or pounds
&#39; @param dblKg Kilograms.
&#39; @param blnToGrams Convert to grams (if true) otherwise to pounds.
&#39; @return Converted value.
Function TM4_ConvertKg(dblKg As Double, Optional blnToGrams As Boolean = True)
   If blnToGrams Then
      TM4_ConvertKg = dblKg * 1000
      Exit Function
   End If
   TM4_ConvertKg = dblKg * 2.20462
End Function

&#39;&#39; Run using F5
Sub TM4_TestConvertKg()
   MsgBox (TM4_ConvertKg(10))         &#39; use default value (to grams)
   MsgBox (TM4_ConvertKg(10, False))  &#39; to pounds
End Sub</code></pre>
<p>Here we have one optional argument with default value equal to true. Now the function can be called with one argument (use the default value of the second argument) or with two arguments. Have a look at cells A8:C13 in worksheet <em>TM4</em> (Figure <a href="mod-vba-procedures.html#fig:tm4-sheet">4.1</a>) where we use the function to find convert to grams (<code>TM4_ConvertKg(A8)</code>) and pounds (<code>TM4_ConvertKg(A8; FALSE)</code>).</p>
<p>Let us try to define a sub that format some cells (the content have been found using the macro recorder and then cleaned):</p>
<pre><code>&#39;&#39; Format a range
&#39;@param rng Range to format.
&#39;@param intInteriorColor Interior color index.
&#39;@param intFontColor Font color index.
&#39;@param intFontSize Font size.
Sub TM4_FormatCell(rng As Range, Optional intInteriorColor As Integer = 0, _
 Optional intFontColor As Integer = 44, Optional intFontSize As Integer = 12)
    rng.Interior.ColorIndex = intInteriorColor
    rng.Font.ColorIndex = intFontColor
    rng.Font.Size = intFontSize
End Sub

&#39;&#39; Run using F5
Sub TestingFormatCell()
    Dim rng As Range
    
    Worksheets(&quot;TM4&quot;).Activate
    Call FormatCell(Range(&quot;A16&quot;))       &#39; use default values
    Call FormatCell(Range(&quot;B16&quot;), 46)   &#39; use background color index 46
    Call FormatCell(Range(&quot;C16&quot;), , 21) &#39; set font color
    Call FormatCell(rng:=Range(&quot;D16&quot;), intFontSize:=16, intFontColor:=23)  &#39; call sub using argument names explicit
End Sub</code></pre>
<p>Observe that there is different ways to call a procedure with optional arguments. If you have may optional arguments it is best to use the last where you explicit state the argument names (here the order of the arguments do not matter either). Note that every argument following an optional argument in the procedure definition must also be optional. Moreover, if lines are to long you may split them using <code>_</code> (underscore).</p>
<p>In the example above we use the color index values in VBA (56 different ones). Let us have a look at them:</p>
<pre><code>&#39;&#39; Run using F5
Sub TM4_SeeColorIndex()
   Dim r As Integer
   Dim c As Integer
   Dim i As Integer
   
   Worksheets(&quot;TM4&quot;).Activate
   i = 1
   For r = 18 To 40
      For c = 2 To 5
         Cells(r, c) = i
         Call TM4_FormatCell(rng:=Cells(r, c), intInteriorColor:=i, intFontColor:=1 + i Mod 4)
         If i = 56 Then
            Exit Sub
         End If
         i = i + 1
      Next
   Next
End Sub</code></pre>
<p>The output will be outputted from row 18 (column B-E):</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:tm4-sheet"></span>
<img src="img/tm4-sheet.png" alt="TM4 worksheet." width="400px" />
<p class="caption">
Figure 4.1: TM4 worksheet.
</p>
</div>
</div>
<div id="public-and-private-procedures" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Public and private procedures<a href="mod-vba-procedures.html#public-and-private-procedures" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You may use the keyword <code>Private</code> or <code>Public</code> (default) when you define a procedure. For instance:</p>
<pre><code>Private Sub SubName(arg1 As &lt;datatype&gt;, arg2 As &lt;datatype&gt;)
   &lt;code&gt;
End Sub</code></pre>
<p>A private procedure can only be used by other procedures in the module. This may be useful if you want to define ‘internal’ procedures that you only want to use in the module. This also imply that a private sub can not be called from a button and a private function can not be called from a cell. Note the default value is <code>Public</code>. That is, if <code>Private</code> or <code>Public</code> is excluded, VBA will always treat the sub as if it were Public:</p>
<pre><code>Sub SubName(arg1 As &lt;datatype&gt;, arg2 As &lt;datatype&gt;)  &#39; VBA assumes it is public (the default)
   &lt;code&gt;
End Sub

Public Sub SubName(arg1 As &lt;datatype&gt;, arg2 As &lt;datatype&gt;) &#39; same result as above
   &lt;code&gt;
End Sub</code></pre>
</div>
<div id="vba-byref" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Passing arguments by reference or by value<a href="mod-vba-procedures.html#vba-byref" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are two ways of passing arguments to procedures:</p>
<pre><code>Sub SubName(ByRef arg1 As &lt;datatype&gt;, ByVal arg2 As &lt;datatype&gt;)
 &lt;code&gt;
End Sub</code></pre>
<p>Argument <code>arg1</code> is passed <strong>by reference</strong> (default). That is, no new memory is allocated when the procedure is called and as a result the procedure can have changed the value of <code>arg1</code> when the procedure stops. Note since the default, the result is the same if we omitted the keyword <code>ByRef</code>. Argument <code>arg2</code> is passed <strong>by value</strong>. That is, a copy of the variable is created in memory. Hence the procedure cannot change the value of <code>arg2</code> when the procedure stops (the copy is deleted).</p>
<p>Using <code>ByRef</code> is faster and saves memory since we do not have to allocate new memory. We may use <code>ByRef</code> to return updated values of the input arguments (sub <code>TM4_ProductSub</code> did that). In fact you may have multiple arguments which when the sub finished have been modified. See it as the arguments have been modified with the result of the sub. Using <code>ByVal</code> is safer if you want be sure that the argument is not modified inside the procedure.</p>
<p>Try guessing the result of running sub <code>TM4_TestingBy</code>:</p>
<pre><code>Private Function TM4_ByVal(ByVal i As Integer) As Integer
    i = i * 2
    MsgBox (&quot;In ByVal i is &quot; &amp; i)
    TM4_ByVal = i * 5
End Function

&#39;&#39; Note &quot;Function TM4_ByRef(i As Integer) As Integer&quot; gives same result
Private Function TM4_ByRef(ByRef i As Integer) As Integer
    i = i * 2
    MsgBox (&quot;In ByRef i is &quot; &amp; i)
    TM4_ByRef = i * 5
End Function


&#39; Try running it using F5 or the debugger (Ctrl + F8 (win) or cmd + shift + I (mac))
Private Sub TM4_TestBy()
    Dim n As Integer
    Dim i As Integer
    
    i = 5
    MsgBox (&quot;In the start i is &quot; &amp; i)
    n = TM4_ByVal(i)
    MsgBox (&quot;Try gussing the values of n and i&quot;)
    MsgBox (&quot;After TM4_ByVal i is &quot; &amp; i &amp; &quot; and &quot; &amp; n &amp; &quot; is returned.&quot;)
    n = TM4_ByRef(i)
    MsgBox (&quot;Try gussing the values of n and i&quot;)
    MsgBox (&quot;After TM4_ByRef i is &quot; &amp; i &amp; &quot; and &quot; &amp; n &amp; &quot; is returned.&quot;)
End Sub</code></pre>
</div>
<div id="built-in-functions" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Built-in functions<a href="mod-vba-procedures.html#built-in-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>VBA has a set of <a href="https://bettersolutions.com/vba/functions/complete-list.htm">built-in functions</a> such as <code>Abs</code>, <code>Log</code> and <code>Date</code>. You call them by just writing their name:</p>
<pre><code>&#39;&#39; Test VBA functions
&#39; You can always get help by putting the crusor in the function name and press F1
Sub TM4_TestVBAfunctions()
   MsgBox (&quot;Absolute value: &quot; &amp; Abs(-4.2))
   MsgBox (&quot;Integer part: &quot; &amp; Fix(-4.2))
   MsgBox (&quot;Floor of the number: &quot; &amp; Int(-4.2))
   MsgBox (&quot;Natural logarithm: &quot; &amp; Log(16))
   MsgBox (&quot;Random number [0,1[: &quot; &amp; Rnd())
End Sub</code></pre>
<p>You can also use the <a href="https://bettersolutions.com/excel/functions/vba-or-excel.htm">worksheet functions</a> in Excel. You call them using the <code>WorksheetFunction</code> object. A few examples:</p>
<pre><code>&#39;&#39; Test worksheetfunctions
&#39; You can always get help by putting the crusor in the function name and press F1
Sub TM4_TestWorksheetfunctions()
   Dim r As Integer
   Dim c As Integer
   
   Worksheets(&quot;TM4&quot;).Activate
   MsgBox (&quot;Numbers above 80: &quot; &amp; WorksheetFunction.CountIf(Range(&quot;B33:E38&quot;), &quot;&gt;80&quot;)) &#39; count numbers above
   MsgBox (&quot;Sumproduct: &quot; &amp; WorksheetFunction.SumProduct(Range(&quot;B33:E33&quot;), Range(&quot;B34:E34&quot;)))
   MsgBox (&quot;Max: &quot; &amp; WorksheetFunction.Max(Range(&quot;B33:E38&quot;)))
   
   For r = 40 To 45
      For c = 2 To 4
         Cells(r, c) = WorksheetFunction.RandBetween(0, 9)
      Next
   Next
End Sub</code></pre>
</div>
<div id="recap-1" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Recap<a href="mod-vba-procedures.html#recap-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>A procedure is a piece of code stored in a module.</p></li>
<li><p>A procedure contains a series of computational steps that will be carried out when the procedure is called.</p></li>
<li><p>VBA has two kinds of procedures:</p>
<p>Subs:</p>
<ul>
<li>Can make changes to the worksheet.</li>
<li>Can modify its surroundings.</li>
<li>Can be executed by a button (if no arguments).</li>
<li>Cannot return anything.</li>
</ul>
<p>Functions:</p>
<ul>
<li>Can return something.</li>
<li>Can be used in Excel.</li>
<li>Cannot be used as a macro.</li>
</ul></li>
<li><p>You declare a procedure using</p>
<pre><code> Sub SubName(arg1 As &lt;datatype&gt;, arg2 As &lt;datatype&gt;)
    &lt;code&gt;
 End Sub

 Function FunctionName(arg1 As &lt;datatype&gt;, arg2 As &lt;datatype&gt;) As &lt;return datatype&gt;
  &lt;code&gt;
  FunctionName = value  &#39; assign a return value to the function
 End Sub</code></pre></li>
<li><p>You can use <code>Exit Sub</code>/<code>Exit Function</code> to exit the sub/function early in the code.</p></li>
<li><p>Procedures can be either public or private:</p>
<ul>
<li><p>Public (default): Can be used from other modules, from other files and from Excel.</p>
<pre><code>Public Sub SubName()
...
End Sub</code></pre></li>
<li><p>Private: Can only be used from within its own module.</p>
<pre><code>Private Sub SubName()
...
End Sub</code></pre></li>
</ul></li>
<li><p>Use the <code>Call</code> keyword to call a sub:</p>
<pre><code>Call SubName(arg1, arg2)</code></pre></li>
<li><p>Call a function by assigning its return value to a variable</p>
<pre><code>result = FunctionName(arg1, arg2)</code></pre></li>
<li><p>There are two ways of passing arguments to procedures:</p>
<pre><code>Sub SubName(ByRef arg1 As &lt;datatype&gt;, ByVal arg2 As &lt;datatype&gt;)
  &lt;code&gt;
End Sub</code></pre>
<ul>
<li><p>Argument <code>arg1</code> is passed <strong>by reference</strong> (default). That is, no new memory is allocated when the procedure is called and hence the procedure can have changed the value of <code>arg1</code> when the procedure stops.</p></li>
<li><p>Since the default is <code>ByRef</code>, the result is the same if we omitted the keyword <code>ByRef</code>.</p></li>
<li><p>Argument <code>arg2</code> is passed <strong>by value</strong>. That is, a copy of the variable is created in memory with local scope. Hence the procedure cannot change the value of <code>arg2</code> when the procedure stops (the local variables is deleted).</p></li>
<li><p>Using <code>ByRef</code> is faster and saves memory since we do not have to allocate new memory.</p></li>
<li><p>We may use <code>ByRef</code> to return updated values of the input arguments.</p></li>
</ul></li>
<li><p>Use the <code>Optional</code> keyword to indicate default input arguments:</p>
<pre><code>Sub SubName(arg1 As &lt;datatype&gt;, Optional arg2 As &lt;datatype&gt; = &lt;defaultValue&gt;)  </code></pre>
<p>You can now call the procedure using:</p>
<pre><code>Call SubName(arg1)  &#39; assume that arg2 = defaultValue</code></pre>
<p>Every parameter following an optional parameter in the procedure definition must also be optional.</p></li>
<li><p>VBA has a set of <a href="https://bettersolutions.com/vba/functions/complete-list.htm">built-in functions</a> such as <code>Abs</code>, <code>Log</code> and <code>Date</code>. You call them by just writing their name:</p>
<pre><code>dtm as Date
dtm = Date()</code></pre></li>
<li><p>You can also use the <a href="https://docs.microsoft.com/en-us/office/vba/excel/concepts/events-worksheetfunctions-shapes/list-of-worksheet-functions-available-to-visual-basic">worksheet functions</a> in Excel. You call them using the <code>WorksheetFunction</code> object:</p>
<pre><code>sum = WorksheetFunction.Sum(Range(&quot;A1:D5&quot;))</code></pre></li>
</ul>
<p>You may also have a look at the <a href="https://bss-osca.github.io/tfa/slides/02-02_vba-procedures-slides.html">slides for this module</a>.</p>
</div>
<div id="ex-vba-procedures" class="section level2 hasAnchor" number="4.8">
<h2><span class="header-section-number">4.8</span> Exercises<a href="mod-vba-procedures.html#ex-vba-procedures" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the <a href="help.html#help">help page</a>. Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution!</p>
<div id="ex-vba-subs" class="section level3 hasAnchor" number="4.8.1">
<h3><span class="header-section-number">4.8.1</span> Exercise - Subs<a href="mod-vba-procedures.html#ex-vba-subs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <a href="https://github.com/bss-osca/tfa/blob/master/vba/vba-subs-template.xlsm">file</a> may be used as a starting point for this exercise.</p>
<ol style="list-style-type: decimal">
<li>Create a sub <code>GetMsg</code> that takes a string and a Boolean as input and create a message box with the string content if the Boolean is true. Test the procedure using the <code>TestGetMsg</code> sub.</li>
<li>Modify the procedure so the Boolean have a default value equal to true.</li>
<li>Create a sub <code>PrintNameAge</code> that takes two arguments as input (name and age) and create a message box with the persons name and age.</li>
<li>Write a sub <code>TestPrintNameAge</code> that uses two input boxes to ask for name and age and then call sub <code>PrintNameAge</code>.</li>
</ol>
</div>
<div id="ex-vba-functions" class="section level3 hasAnchor" number="4.8.2">
<h3><span class="header-section-number">4.8.2</span> Exercise - Functions<a href="mod-vba-procedures.html#ex-vba-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <a href="https://github.com/bss-osca/tfa/blob/master/vba/vba-functions-template.xlsm">file</a> may be used as a starting point for this exercise.</p>
<ol style="list-style-type: decimal">
<li>Write a function <code>Discount</code> which takes a two input arguments (doubles): the discount percentage and the amount and returns the discounted value. Have a look at the unfinished sub <code>Discount</code> for hints. Note the comments describing the function using the <a href="coding-convention.html#coding-convention">coding convention</a>.</li>
<li>Write a function <code>Larger</code> which takes two integer arguments and returns true if the first is larger than the last; otherwise false.</li>
<li>Write a function <code>NumbDays</code> that takes a date as argument and return the number of days from today. Hint: Have a look at the <code>DateDiff</code> function.</li>
</ol>
<p>Test all the functions in the <em>Testing</em> sheet.</p>
<ol start="4" style="list-style-type: decimal">
<li>Write a sub that uses an input box to ask for an amount a then returns the discounted amount when the discount is 20%. The sub should use the function in Question 1. Create a button running the sub.</li>
</ol>
</div>
<div id="ex-vba-worksheet-functions" class="section level3 hasAnchor" number="4.8.3">
<h3><span class="header-section-number">4.8.3</span> Exercise - Worksheet functions<a href="mod-vba-procedures.html#ex-vba-worksheet-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <a href="https://github.com/bss-osca/tfa/blob/master/vba/vba-worksheet-functions-template.xlsm">file</a> contains a procedure to generate a set of numbers.</p>
<p>Create a procedure <code>Summary</code> that uses worksheet functions to:</p>
<ul>
<li>Find the maximum number and write it to cell D1.</li>
<li>Find the minimum number and write it to cell D2.</li>
<li>Find the sum of the numbers and write it to cell D3.</li>
<li>Count the number of positives and write it to cell D4.</li>
<li>Find the row number with maximum value and write it to cell D5.</li>
</ul>
<p>Google is a good place to start if you want to find a specific Excel function, e.g. try to search ‘excel row with max value’.</p>
</div>
<div id="ex-vba-byref" class="section level3 hasAnchor" number="4.8.4">
<h3><span class="header-section-number">4.8.4</span> Exercise - <code>ByRef</code><a href="mod-vba-procedures.html#ex-vba-byref" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <a href="https://github.com/bss-osca/tfa/blob/master/vba/vba-byref-template.xlsm">file</a> should be used as a starting point for this exercise.</p>
<ol style="list-style-type: decimal">
<li>Create a procedure <code>AryToVal</code> satisfying:
<ul>
<li>Arguments are <code>ByRef ary As Variant, value As Variant</code>.</li>
<li>All entries in the array are set to <code>value</code>.</li>
<li>The procedure work both if the dimension of the array is 1 or 2. You may use <code>AryDim</code> to find the dimension.</li>
</ul>
Test the procedure using the <code>Main</code> procedure.</li>
<li>Create a procedure <code>AryToValByVal</code> equal to <code>AryToVal</code> except that arguments are <code>ByVal ary As Variant, value As Variant</code>. Test the procedure using the <code>Main</code> procedure. What is the difference?</li>
<li>Create a procedure <code>AryToSeq</code> satisfying:
<ul>
<li>Arguments are <code>ByRef ary As Variant, lngFrom As Long, lngTo As Long, Optional lngIdx As Long = 1</code>.</li>
<li>Entries in the array is set to values <code>lngFrom</code> to <code>lngTo</code>.</li>
<li>Use <code>ReDim</code> to resize the array.</li>
</ul>
Test the procedure using the <code>Main</code> procedure.</li>
<li>Create a procedure <code>AryRead</code> satisfying:
<ul>
<li>Arguments are <code>ByRef ary As Variant, ByRef rng As Range, Optional intStartIdx1 As Integer = 1, Optional intStartIdx2 As Integer = 1</code></li>
<li>Entries in the range <code>rng</code> are stored in the array <code>ary</code>.</li>
<li>Use <code>ReDim</code> to resize the array.</li>
</ul>
Test the procedure using the <code>Main</code> procedure.</li>
</ol>
<script src="//unpkg.com/@highlightjs/cdn-assets@11.5.1/highlight.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/highlightjs-vba/dist/vba.min.js"></script>
<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script> -->
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
  // hljs.initLineNumbersOnLoad({singleLine: true}); 
</script>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-vba-book" class="csl-entry">
Wøhlk, S. 2010. <em>VBA Programming in Business Economics</em>. DJØF Publishing.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mod-vba-loops-cond.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mod-vba-datatypes.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/bss-osca/tfa/edit/master/book/04_vba-procedures.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

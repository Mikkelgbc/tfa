[["index.html", "Tools for Analytics (TFA) Course notes Module 1 Introduction to the course 1.1 Learning outcomes 1.2 Purpose for the course 1.3 R vs Excel/VBA 1.4 How a computer works 1.5 How the notes are organized 1.6 Acknowledgements 1.7 Exercises", " Tools for Analytics (TFA) Course notes Lars Relund Nielsen 2022-07-29 Module 1 Introduction to the course This site contains course notes for the course “Tools for Analytics” held at Aarhus BSS. The notes show the learning path for each week and contain. The course is an introductory course at the Operations and Supply Chain Analytics programme and intended to give knowledge about IT tools for Analytics. Expect the notes to be updated when the course runs. The date listed above is the last time the notes was updated. Learning path diagram Click/hover the nodes to follow links and see details. A detailed description of Business Analytics have been pointed out as an extra supplement in the learning path diagram. You may have a look at it if you like. 1.1 Learning outcomes By the end of this module, you are expected to: Memorize the purpose of the course. Describe what the term Business Analytics mean. Identify pros and cons of using Excel, VBA and R. Describe how a computer works. Describe what an algorithm is. Know how the course is organized. The learning outcomes relate to the overall learning goals number 1, 3 and 5 of the course. 1.2 Purpose for the course Since the amount of available data has increased extensively in many companies, there is a need for analysts with the ability to do tasks within Analytics. For instance, extract relevant data and perform valid quantitative analysis. Clearly, it is also important that the analyst can communicate the results of the analysis to their surroundings. This requires for the analyst to be particularly qualified in handling IT based tools beyond e.g. basic Excel. Business Analytics (BA) (or just Analytics) refers to the scientific process of transforming data into insight for making better decisions in business. BA can both be seen as the complete decision making process for solving a business problem and the creation of business value by integration of concepts, methods and data. As a process, it can be characterized by descriptive, predictive, and prescriptive model building using data sources. For a full definition see the appendix. Within a Business Analytics (BA) framework the course focuses on giving you an introduction to programming, handeling data and doing descriptive analytics. Descriptive analytics categorizes, characterizes, consolidates, and classifies data. Examples are standard reporting and dashboards (key performance indicators (KPIs), what happened or is happening now?) and ad-hoc reporting (how many/often?). Descriptive analytics often serves as a first step in the successful application of predictive or prescriptive analytics. Predictive and prescriptive analytics are covered in other courses of the programme. Analytics may be seen as a data driven process: Figure 1.1: Analytics as a data driven process. For doing data driven analytics you first must import your data. That is, take data from a database, file, web API etc. and transform it into a data frame/table. In general raw data may be messy and need to be structured in a tidy way. Tidying your data means storing it in a structured form suitable for analysis. In brief, when your data is tidy, each column is a variable, and each row is an observation. Tidy data is important because the consistent structure lets you focus your struggle on questions about the data. Once you have tidy data, a common first step is to transform it. Transformation includes narrowing in on observations of interest (e.g. only observations from a specific year or warehouse), creating new variables based on existing variables (e.g. the cost of using the machine that day given idle time). Together, tidying and transforming are called wrangling, because it can be a hard process to get your data in the right form. The next step is to do a simple exploration of you data such as calculating a set of summary statistics (like counts, means or KPIs). A good way to get an overview over your data is by visualization. A good visualisation will show you things that you did not expect, raise new questions about the data or confirm your hypothesis. A good visualization might also hint that you’re asking the wrong question, or you need to collect different data. Exploration and visualization are descriptive analytics and used to answer questions such as: What happened? How many, how often, where? Where exactly is the problem? What actions are needed? Models are complementary tools to visualization. Once you have made your questions sufficiently precise, you can use a model to answer them. A model is a description of a system using mathematical concepts and a simplification of the real system. That is, the results of a model are based on a set of assumptions. Models for statistical analysis, forecasting, system behavior are predictive analytics and answer questions like: Why is this happening? What if these trends continue? What will happen next? Models for prescriptive analytics use optimization and other decision modeling techniques to suggest decision options with the goal of improving business performance and answer questions like: What is the best that can happen? Exploration, visualization and modeling may be seen as different steps which can be used for analyzing the data and answer the overall questions. This course will focus on the two first steps. Given an analysis, communication is an absolutely critical part. It does not matter how well your models and visualization have led you to understand the data unless you can also communicate your results to decision makers. Note that analytics is not a one-way process, it is common that you several times have to tidy and transform your data, explore and visualize based on the results of a model, rerun the model based on feedback from the decision makers etc. Common connections are visualized using directed arrows in Figure 1.1. Surrounding the process is programming. Programming is the Swiss army knife you use during parts of the process. An introduction to programming is given using both VBA in Excel and the programming language and free software environment R. Programming focus on writing algorithms. An algorithm is a finite sequence of well-defined instructions to solve a specific problem or to perform a computation. That is, we use a programming language to program an algorithm that solves a specific task, e.g. find the best route, sort words, make a plot, etc. 1.3 R vs Excel/VBA This course gives you an introduction to programming using both VBA and R. The two programming languages are different and here are some comparisons: Excel Pros: Initial learning curve is quite minimal. Analysis can be done via point-and-click. Useful for fast analysis (you can change a cell and see effects on other cells, plots etc.) It is not exceedingly hard to make basic graphs and charts. Data can be stored inside the sheets. Cons: The mixture of data entries, analysis, and visualization makes it easy to confuse cells that contain raw data from those that are the product of analysis. The analysis directly manipulates the only copy of the raw data. Using mouse clicks means that a mistaken click or drag action can lead to errors or the overwriting of data. Do not handle non-tabular data well. VBA VBA is a compiled language implemented using compilers (translators that generate machine code from source code). That is, code need to be compiled first before running it. Pros: Can be used inside MS Office applications e.g. Excel. Already contained in Excel, i.e. if you have Excel installed you can start coding. The VBA code is stored within the spreadsheet, allowing any user with access to the spreadsheet to easily run the code. VBA is easy to learn. Especially if you are already experienced in Excel. Good for automating tasks in Excel. Still used in many companies. Cons: A programming language, meaning the initial learning curve is steeper. It will take you some time to become familiar with the interface and master the various functions. Since a compiled language, compiling code may take time. Powerful inside Excel but other programming languages are better to learn for general tasks. An old programming language (Microsoft stopped investing in VBA in 2008). R R is an interpreted language with step-by-step execution of source code (no pre-runtime translation takes place) from the command line or using a script file. Pros: There is a clear division between data entry and analysis. You import the data, create an object that is a copy of the raw data and do manipulations on this copy. That is, the original data are never altered in any way and there is no way to mess up the raw data. Manipulating a copy of the data enables you to experiment. A line of code that fails to produce the expected result can be tweaked and rerun. All manipulations can be done in code. The process of analysis are easily reproduced by the code. That is, the use of code for data analysis enables the creation of more reproducible research. With code all analysis is documented instead of being hidden behind mouse clicks. Saving analysis in code has the immediate benefit that it can be easily rerun anytime that new data is added or the code can also be applied to a completely new data set. Free and with a large community that promotes sharing of libraries for data analysis. Can produce complex and advanced data visualizations. Cons: R is a programming language, meaning the initial learning curve is steeper. It will take you some time to become familiar with the interface and master the various functions. 1.4 How a computer works As a prerequisite for this course you need some basic knowledge about what a computer is. Have a look at these slides or this video. 1.5 How the notes are organized Module 1 (this module) gives a short introduction to the course. The course notes consists of different parts each containing teaching modules about specific topics: Part I consider tools for analytics using VBA in Excel (mainly programming). Module 2 gives you an introduction to VBA so you can get started programming. In Module 3 loop and conditional statements are introduced and Module 4 focus on how to make procedures. Next, we consider advanced data types and usage in Module 5. Finally, Module @ref(#mod-vba-random-numbers) considers generation of random numbers in VBA and how they can be used for simulation. Part II consider tools for analytics using R. The appendix contains different modules that may be helpful for you including hints on how to work in groups, how to get help if you are stuck and how to annotate the course notes. 1.6 Acknowledgements Some of the materials in these notes are taken from various places The bookdown skeleton and some notes are based on the Stat545 course. Some parts in Module 1 are inspired by Chapter 1 in Wickham (2017). The VBA modules are inspired by the book Wøhlk (2010). This also holds for some of the exercises. Module ?? is inspired by Chapter 1 in Bryan (2017). Module ?? is using some text and images from Chapter 1 in Ismay and Kim (2020) and Chapter 2 in Bryan (2017). A few exercises are inspired by Chapter 2 in Irizarry (2020). Notes about git and GitHub in the appendix are based on Bryan, STAT 545 TAs, and Hester (2020). Exercise ?? is a revision of Chapters 6-7 in Bryan (2017). Exercise ?? is a revision of Session 3 in the Welcome to the tidyverse course. Exercise ?? is a revision of Chapter 9 in Irizarry (2020). Exercise ?? is inspired by the COVID19 application exercise at the data science in a box course. Exercise ?? is inspired by the Lego homework exercise at the data science in a box course. Exercise ?? is inspired by the Fisheries application exercise at the data science in a box course. I would like to thank all for their inspiration. Also thanks to Solveig for proofreading the draft. This work is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International CC BY-NC-SA 4.0. 1.7 Exercises 1.7.1 Exercise - How to annotate The online course notes can be annotated using hypothes.is. You can create both private and public annotations. Collaborative annotation helps people connect to each other and what they’re reading, even when they’re keeping their distance. You may also use public notes to help indicate spell errors, unclear content etc. in the notes. Sign-up at hypothes.is. If you are using Chrome you may also install the Chrome extension. Go back to this page and login in the upper right corner (there should be some icons e.g. &lt;). Select some text and try to annotate it using both a private and public annotation (you may delete it again afterwards). Go to the slides for this module and try to annotate the page with a private comment. References "],["mod-vba-intro.html", "Module 2 An introduction to VBA 2.1 Learning outcomes 2.2 What is VBA 2.3 Setup Excel for VBA 2.4 Your first program 2.5 The macro recorder 2.6 VBA - A short overview 2.7 Good coding pratice 2.8 Recap 2.9 Exercises", " Module 2 An introduction to VBA This module gives a short introduction to VBA, so you can get started programming and run your code. A template with VBA code for this module is given in the file 02-vba-intro-template.xlsm (open it and use it while reading the notes). Have a look inside the module TM2_ex in the VBA editor for examples used in the notes and during lectures. Have a look at module TM2_exercises for exercises. The template file for next teaching module will contain guiding answers for the exercises to this teaching module. Learning path diagram Click/hover the nodes to follow links and see details. If you like a different learning style there is a lot for videos about VBA online such as course 14-Hour VBA Course. The videos have been pointed out as extra online supplements in the learning path diagram. However, they are not necessary for the course. Since Excel change as new versions arrive and it work on different operating systems, the look in the screenshots and videos might be a bit different from your version. However, you still should be able to understand it. 2.1 Learning outcomes By the end of this module, you are expected to: Describe what VBA is. Setup Excel for VBA. Know how the macro recorder works. Make your first program. Have an overview over what VBA can do. Describe what a variable is. Name different data types and how they effect memory size. Declare a variable as a data type. Make a simple procedure. Do simple loops and conditional statements. Recorded you first macro using the macro recorder The learning outcomes relate to the overall learning goals number 2 and 4 of the course. 2.2 What is VBA Visual Basic for Applications (VBA) is an implementation of the BASIC programming language intended to control and automate Microsoft Office applications, developed by Microsoft. For instance, you can automatically create sheets, delete objects, create user-defined functions or read/write data to a sheet. It is not a standalone program, it can only run in the host application. In this course we will focus on running VBA from Excel. VBA is widely used in the industry (specially linked to Excel) and easy to learn. Microsoft stopped investing in VBA in 2008. It only update it for small changes. However, VBA is still a vital part of desktop Office applications, and will continue to be so in the future. VBA is a compiled language implemented using compilers (translators that generate machine code from source code). That is, code need to be compiled first before running it. You can only run VBA using the desktop version of Excel. That is, you can’t create, run, or edit VBA in Excel for the web. With VBA you can extend Excel and automate tasks by coding different algorithms that for instance can be run by pressing a button. Since VBA is a programming language, the initial learning curve is steeper compared to Excel. However, you will get started fast because you already know Excel. 2.3 Setup Excel for VBA For running VBA code the Developer tab needs to be visible in Excel. This can be done by check marking the Developer tab under the ‘Ribbon and Toolbar’ options in Excel. You add it by choosing Excel -&gt; Preferences -&gt; Ribbon and toolbar ( ) or right click a tab and choose Customize ribbon … ( ). Figure 2.1: The VBA editor. In the Developer tab you open the VBA editor by pressing the Visual basic button ( Alt + F11, ⌥ + F11). The VBA editor is where you write your VBA code. A screenshot of the VBA editor can be seen in Figure 2.1. You can setup the editor so it consists of a set of different sub-windows. Here we will highlight the ones you will use the most: Code: The code window is where you can see the code of your modules. Process Explorer: Gives you an overview over all your open workbooks (a Excel file) and the VBA modules (a place to write VBA code) inside each workbook. Properties: Each element in the Process Explorer can be seen as an object and each object has a set of properties. For instance a module have a property called Name containing the name of the module. You can edit the name by modifying the field in the Properties window. Similar a worksheet has a set of properties (try selecting one of the sheets in the Process Explorer). Locals: This is a window which can be used for debugging. During debugging you can run your code line by line by inserting breakpoints. You can then observe the values of your variables in the Locals window. If you do not see the sub-windows in the editor. Then you can open them using the icons in the toolbar (hoover over the icons to find them). Finally, let us set the preferences for the VBA editor. Open the preferences/options Excel -&gt; Preferences -&gt; Editor ( ) or Tools -&gt; Options -&gt; Editor ( ). Uncheck mark ‘Auto Syntax Check’ and check mark ‘Require Variable Declaration’. 2.4 Your first program Let us try to make your first piece of code. Download the template file 02-vba-intro-template.xlsm, open the file and open the VBA editor under the Developer tab. Add a new module by clicking the Insert Module icon (upper left corner - note you can hoover over the icons to see what they do). Rename the module (named Module1) to TM2_hello (note you have to use underscores). Open the module by double clicking on the module in the Process Explorer Add the code &#39; Your first program/macro Sub TM2_SayHello() MsgBox (&quot;Say hello world :-)&quot;) End Sub The code is a procedure (sub) and since it does not have any input arguments it is called a macro and can be run directly. Note if a line starts with a ' then the line is considered as a comment and not used by the program. Run the macro by pressing the Play icon or using the shortcut F5. What happend? Go to the worksheet TM2 in Excel. In the Developer tab press the Button icon and click on cell G3. In the popup window select macro name TM2_SayHello and click OK. Rename the button by clicking the text and call it ‘Say Hello’. Click besides the button to finish. Run the button by clicking it. Try right clicking the button and move/resize it. Save the workbook (Excel file). Note the Excel file has extension .xlsm and not .xlsx because it contains VBA code. You have now finished your first program by saying hello to the world using a message box. 2.5 The macro recorder It is possible to use the Macro recorder to turn your actions in Excel into VBA code. This can be particularly useful if you have forgotten the code for a specific color, the name of a function or need to plot a graph. Unfortunately, you cannot record if-statements or loops, so the recorder is not an easy way out of learning to code. But it is a handy tool for getting pieces of code. Let us try to record a macro that make a scatter plot of cells D8:E12 and change the title: Click the Record Macro icon under under the Developer tab. Name the macro TM2_Plot and click OK (the recorder is now running). Go to the worksheet TM2 and select cells D8:E12. Add a scatter plot of the points. Rename the title to ‘A line’. Click the Stop Recording icon under under the Developer tab. You have now finished recording your macro. Let us have a look at the code by going to the TM2_Plot sub in the VBA editor. You should have something similar to: Sub TM2_Plot() &#39; &#39; TM2_Plot Macro &#39; Worksheets(&quot;TM2&quot;).Activate Range(&quot;D8:E12&quot;).Select ActiveSheet.Shapes.AddChart2(240, xlXYScatterSmooth).Select ActiveChart.SetSourceData Source:=Range(&quot;&#39;TM2&#39;!$D$8:$E$12&quot;) ActiveChart.ChartTitle.Select ActiveChart.ChartTitle.Select ActiveChart.ChartTitle.Text = &quot;A line&quot; Selection.Format.TextFrame2.TextRange.Characters.Text = &quot;A line&quot; With Selection.Format.TextFrame2.TextRange.Characters(1, 6).ParagraphFormat .TextDirection = msoTextDirectionLeftToRight .Alignment = msoAlignCenter End With With Selection.Format.TextFrame2.TextRange.Characters(1, 1).Font .BaselineOffset = 0 .Bold = msoFalse .NameComplexScript = &quot;+mn-cs&quot; .NameFarEast = &quot;+mn-ea&quot; .Fill.Visible = msoTrue .Fill.ForeColor.RGB = RGB(89, 89, 89) .Fill.Transparency = 0 .Fill.Solid .Size = 14 .Italic = msoFalse .Kerning = 12 .Name = &quot;+mn-lt&quot; .UnderlineStyle = msoNoUnderline .Spacing = 0 .Strike = msoNoStrike End With With Selection.Format.TextFrame2.TextRange.Characters(2, 5).Font .BaselineOffset = 0 .Bold = msoFalse .NameComplexScript = &quot;+mn-cs&quot; .NameFarEast = &quot;+mn-ea&quot; .Fill.Visible = msoTrue .Fill.ForeColor.RGB = RGB(89, 89, 89) .Fill.Transparency = 0 .Fill.Solid .Size = 14 .Italic = msoFalse .Kerning = 12 .Name = &quot;+mn-lt&quot; .UnderlineStyle = msoNoUnderline .Spacing = 0 .Strike = msoNoStrike End With ActiveChart.ChartArea.Select End Sub In general a recorded macro contains a lot of unnecessary code which can be removed. For instance, here we just want to make a scatter plot of cells D8:E12 and change the title. That is, the code can be reduced to: &#39; Add a scatter plot Sub TM2_Plot() Worksheets(&quot;TM2&quot;).Activate Range(&quot;D8:E12&quot;).Select ActiveSheet.Shapes.AddChart2(240, xlXYScatterSmooth).Select ActiveChart.SetSourceData Source:=Range(&quot;&#39;TM2&#39;!$D$8:$E$12&quot;) ActiveChart.ChartTitle.Text = &quot;A line&quot; End Sub Which code to remove can sometimes be hard to realize. However, you may try to remove small parts of code, run the macro and check if the results still are as wanted. Finally, try to add a button ‘Make plot’ that run the macro. Go to the worksheet TM2 and do steps: In the Developer tab press the Button icon and click on cell G8. In the popup window select macro name TM2_Plot and click OK. Rename the button by clicking the text and call it ‘Make plot’. Click besides the button to finish. Run the button by clicking it. 2.6 VBA - A short overview Let us have a short overview over some VBA features so you can get started coding. Basic building blocks in programming are: Variables store stuff in memory. Procedures (functions and subs) execute a set of instructions. Input and output are needed to read data and output the result. Conditional statements are used to execute different instructions depending on a true/false value. Loops are used to execute code repeatedly. 2.6.1 Variables Variables are used to store information that is saved in memory. You may visualize a variable as a box in memory (see Figure 2.2). The variable name can be seen as the label on the box. Figure 2.2: Visualization of computer memory The box can contain for instance a number, a date or a boolean. That is, any data type defined by VBA. Some of the basic data types used by VBA are: Table 2.1: Basic data types. Name Type Details Byte Numerical Whole number between 0 and 255. Integer Numerical Whole number between -32768 and 32767. Long Numerical Whole number between - 2147483648 and 2147483647. Double Numerical Floating decimal number between -1.79769313486232E308 and 1.79769313486232E308. String Text Text. Date Date Date and time. Boolean Boolean True or False. Variant Any type Any kind of data (default type if the variable is not declared). All basic data types can be seen in the VBA documentation. Note that some data types are numericals, i.e. they represent a number (either an integer or a decimal number), other data types represent a set of characters (a string), a boolean or a date. More advanced data types such as a group of numbers (a numeric array), a range of cells in a worksheet (an object) or a set of numbers (a collection) will be considered in Module 5. Your memory contains a limited amount of storage and it is therefore important to use it wisely. The computer memory can be seen as a group of bits (zero and ones) and we can measure the memory size by counting the number of bits or bytes (8 bits = 1 byte). Different data types take up different amounts of memory. For example, the memory requirements for some of the basic data types are: Table 2.2: Memory requirements for some data types. Data type Storage size Byte 1 byte Boolean 2 bytes Integer 2 bytes Long (long integer) 4 bytes Double (double-precision floating-point) 8 bytes Date 8 bytes String 10 bytes + string length * 2 bytes Variant (a number) 16 bytes Variant (a string) 22 bytes + string length * 2 bytes 8 Bits = 1 Byte, 1024 Bytes = 1 Kilobyte, 1024 Kilobytes = 1 Megabyte, 1024 Megabytes = 1 Gigabyte and 1024 Gigabytes = 1 Terabyte. Always declare your variables explicit in VBA. If you can add Option Explicit in the top of your module, undefined variables will raise an error. You can add it by default by modifying the preferences for the VBA editor (see Section 2.3). Declaring variables is good coding practice since it reduces the memory requirements and avoid type errors such as Option Explicit Dim intCtr as integer intCtr = 10 intCtr = intCtg + 10 This will raise an error because intCtg is not defined (you have made a typo and meant intCtr). Without Option Explicit the code will run and assume that intCtg is another variable (initialized to zero). As can be seen a double takes 4 times the memory compared to an integer. That is, you can save memory by considering what data type you need. Consider an example where you have 10000 customer locations on a map and you want to store the distance between customer \\(i\\) and \\(j\\). That is, you have to store \\(10000 \\cdot 10000 = 100.000.000\\) numbers. The memory requirements given different data types are: Data type Memory requirements Variant \\((10000\\cdot 10000\\cdot 16)/1024/1024 \\approx 1526\\) MB Double \\((10000\\cdot 10000\\cdot 8)/1024/1024 \\approx 763\\) MB Integer \\((10000\\cdot 10000\\cdot 2)/1024/1024 \\approx 191\\) MB If you do not think about memory usage a Variant data type would have been used taking up the double the size compared to using a Double (a decimal number). Moreover, if it is enough to measure the distance using an Integer between 0 and 32767, then we can reduce the memory requirements to only 191 MB. Often the free memory in your computer is around 5 GB, i.e. think about which data type you need! You declare variables using the Dim keyword: &#39;&#39; Declare some variables Sub TM03_DeclareVariables() &#39; Always declare variables in the top of a procedure (memory is allocated) Dim intPersons As Integer Dim dblAmount As Double Dim strText As String &#39; Here we assign values to the variables (modify the memory) intPersons = 10 dblAmount = 27.4 strText = &quot;Number of persons are &quot; MsgBox (strText &amp; intPersons &amp; &quot; which own &quot; &amp; dblAmount &amp; &quot;$&quot;) End Sub Three variables are declared on the first three lines in the sub (good coding practice). Variables can be of different data types (here an integer, a double and a string). We allocate values to the variables on the next lines and finally output the result in a message box. Note VBA code is case-insensitive, i.e. strText and strtext is the same variable. It is good coding practice to be consistent and often the VBA editor will help you by changing strtext to strText automatically. 2.6.2 Procedures In VBA we deal with two kinds of procedures: A Sub which can work as a “macro” in Excel, i.e. we can call it using e.g. a button and a Function which can work like Excel functions, i.e. return a value. We already have declared some subs. Let us try to make a function: &#39;&#39; A function joining two strings Function TM2_StringJoin(strF As String, strL As String) As String Dim strJ As String strJ = strF &amp; &quot; &quot; &amp; strL TM2_StringJoin = strJ End Function First observe that the function have two string input arguments strF and strL. These two strings are joined into one string (saved in the variable strJ) by using the string concatenate symbol &amp;. Finally, the value is returned by assigning the value to same variable as the function name TM2_StringJoin. The function can be called from Excel like any other function by using the function name (have a look at cell D5 in the worksheet TM2). You may also use all the built-in Excel functions in VBA: &#39;&#39; Call an Excel function Sub TM2_ExcelFunction() MsgBox (&quot;The sum of cells D9:D12 are &quot; &amp; WorksheetFunction.Sum(Worksheets(&quot;TM2&quot;).Range(&quot;D9:D12&quot;))) End Sub Note all Excel functions are accessed using the WorksheetFunction object. That is, we write WorksheetFunction.&lt;function name&gt;. VBA also has a set of built-in functions which can be used. For instance the Date and InStr function: &#39;&#39; Call VBA functions (run it using F5) Sub TM2_VBAFunction() MsgBox (&quot;The current date is &quot; &amp; Date) MsgBox (&quot;Jen is found at char number: &quot; &amp; InStr(&quot;Hi Jen how are you&quot;, &quot;Jen&quot;)) End Sub We will have a closer look on procedures in Module 4. 2.6.3 Input and output Input and output are needed to read data and output the result. Examples on input/output are dialog boxes which can be created using MsgBox or InputBox: Sub TM2_Dialog() Dim strName As String strName = InputBox(&quot;Type your name:&quot;) MsgBox &quot;Your name is &quot; &amp; strName End Sub First, a string is declared. Next, a value is read to the string using an input box. Finally, the result is output using a message box. You can also write/read values from a sheet using Range or Cells. Note it is always a good idea to know which sheet you are considering by using the Worksheets function: &#39;&#39; Read and write to sheet Sub TM2_ReadWriteSheet() Dim str1 As String Dim int1 As Integer Worksheets(&quot;TM2&quot;).Activate &#39; We activate a sheet so know use this sheet &#39; Input values from sheet str1 = Range(&quot;D4&quot;) &#39; read cell D4 int1 = Cells(9, 4) &#39; read row 9 and col 4 (cell D9) &#39; Output values Range(&quot;B7&quot;) = str1 &amp; &quot;(&quot; &amp; int1 &amp; &quot;)&quot; Cells(8, 2) = str1 End Sub After declaring variables, the worksheet TM2 is activated and we input/output values using the Range and Cells functions. We will have a closer look on the range object in Module 5. 2.6.4 Conditional statements Conditional statements execute different instructions depending on a true/false value. &#39;&#39; Conditional statements example Sub TM2_CondStatement() Dim strName As String Dim intAnswer As Integer Worksheets(&quot;TM2&quot;).Activate strName = InputBox(&quot;Type your name:&quot;) intAnswer = MsgBox(&quot;Do you want to display your name in a message box?&quot;, vbYesNo) &#39; you can use vbYes and vbNo in your code If intAnswer = vbYes Then &#39; Make the message box: MsgBox (&quot;Your name is &quot; &amp; strName) Else &#39; Write to the sheet: Range(&quot;B10&quot;) = strName MsgBox (&quot;Your name is in cell B10&quot;) End If End Sub After declaring variables and activating the worksheet, a dialog box is used for reading your name. Next, based on your answer we use an If/Else statement to do two different tasks. We will have a closer look on conditional statements in Module 3. 2.6.5 Loops Loops can be used to execute code repeatedly: &#39;&#39; Loops example Sub TM2_Loops() Dim k As Integer Worksheets(&quot;TM2&quot;).Activate For k = 2 To 5 Cells(k, 10) = &quot;Row &quot; &amp; k Next End Sub Here a For loop is used to write out values to cells J2:J5. We will have a closer look on loops in Module ??. 2.7 Good coding pratice It is always a good idea to maintain a consistent coding practice. The main reason for using a consistent set of coding conventions is to standardize the structure and coding style of an application so that you and others can easily read and understand the code. Good coding conventions result in precise, readable, and unambiguous source code that is consistent with other language conventions and as intuitive as possible. As you already have seen the code in this teaching module has been structured in VBA modules (we use the prefix TM2_ for all modules related to this teaching module). Each procedure starts with a capital letter and we use code indention to read the code easier. Different ways of naming variables exists (naming convention). Some use snake case others use camel case. The Leszynski naming convention define variables with a consistent prefix that makes it easy to identify its data type. Some common prefixes used for the Leszynski naming convention are: Table 2.3: Prefixes for some variables. Type Prefix Example Boolean bln blnFound Currency cur curRevenue Date (Time) dtm&lt; dtmStart Double dbl dblTolerance Integer int intQuantity Long lng lngDistance String str strFName Variant vnt vntCheckSum Array ary aryNumbers (optional) Worksheet wst wstDistances Workbook wbk wbkData Many other prefixes can be used also. It is common to use Leszynski convention within the VBA community. A few examples: this_is_snake_case # note you do not use capital letters here (not used) thisIsCamelCase # you start each word with a capital letter intAmount # Lezynski convention naming an integer (int) variable strFullName # Lezynski naming a string (str) variable We adapt the Leszynski naming convention together with camel case. One exception is that we add the suffix TM2_ when we name procedures so that we can easy find procedures related to a given teaching module. When defining variables and functions, it is in general good practice to use nouns for variables and verbs for functions. It is always good practice to comment your code. Such that others can get a fast overview and understand your code easier. We will use roxygen documentation comments which are widely known. For example in the top of a module file you may write: &#39;&#39; Module description. &#39; Can be more than one line. &#39; @author Lars Relund &lt;junk@relund.dk&gt; Before each sub, function etc. write something like: &#39;&#39; Sub description &#39; &#39; @pre Precondition &#39; @post Postcondition &#39; &#39; @param strA Explanation of input parameter strA &#39; @param intB Explanation of input parameter intB &#39; @return Return value (if a function) &#39; @remarks Further remarks Function MyFunc(strA As String, intB As Integer) As Integer { ... } For further details about coding/naming convention see Section D. 2.8 Recap This module gives a short introduction to VBA: A programming language intended to control and automate Microsoft Office applications (we use Excel). VBA (Visual Basic for Applications) is an implementation of BASIC developed by Microsoft. A compiled language. That is, code need to be compiled first before running it. You can only run VBA using the desktop version of Excel (not the web version). With VBA you can extend Excel and automate tasks by coding different algorithms that for instance can be run by pressing a button. For running VBA code the Developer tab needs to be visible in Excel. This can be done by check marking the Developer tab under the ‘Ribbon and Toolbar’ options in Excel. You add it by choosing Excel -&gt; Preferences -&gt; Ribbon and toolbar ( ) or right click a tab and choose Customize ribbon … ( ). In the Developer tab you open the VBA editor by pressing the Visual basic button ( Alt + F11, ⌥ + F11). A few useful shortcuts: Toggle VBA editor and Excel ( Alt + F11, ⌘⇧´). Run current procedure or continues execution after pausing (F5). Auto complete code (Ctrl + Space). On a mac you may have to disable the default shortcut (Ctrl + Space) for switching input sources. You can go to the System Preferences -&gt; Keyboard -&gt; Shortcuts -&gt; Input Sources and disable it. Use the debugger and go to next line of code ( F8, ⇧⌘I). Switch between subs/functions ( Ctrl + Up/Down, ⌘ + Up/Down). Basic building blocks in programming: Variables store stuff in memory. Procedures (functions and subs) execute a set of instructions. Conditional statements are used to execute different instructions depending on a true/false statement. Loops are used to execute code repeatedly. Input/output are needed to read data and output the result. Variables are used to store information in the program. Think of it as a box that can contain e.g. a number, a string or a date. The variable name is the label on the box. In VBA we deal with two kinds of procedures: A Sub which can work as a “macro” in Excel, i.e. we can call it using e.g. a button and a Function which can work like Excel functions, i.e. return a value. Examples on input/output are dialog boxes which can be created using MsgBox or InputBox. You can also write/read values from a sheet using Range or Cells. Note it is always a good idea to know which sheet you are considering by using Worksheets(\"&lt;sheet name&gt;\").Activate. Conditional statements (decisions) execute different instructions depending on a true/false. Loops can be used to execute code repeatedly. Excel functions can be called with the WorksheetFunction e.g. WorksheetFunction.Sum(Range(\"D2:E5\")) Always remember to save workbooks with VBA code using the file has extension .xlsm and not .xlsx otherwise the VBA code will be removed from the file! You may also have a look at the slides for this module . 2.9 Exercises Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the help page. Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution! A template with VBA code for this module is given in the file 02-vba-intro-template.xlsm (open it and use it while reading the notes). Have a look inside the module TM2_ex in the VBA editor for examples used in the notes and during lectures. Have a look at module TM2_exercises for exercises. The template file for next teaching module will contain guiding answers for the exercises to this teaching module. 2.9.1 Exercise - Hello Consider the procedure TM2_SayHello in Section 2.4 and modify it into procedure TM2_SayHelloAdv with features: Use an input box to ask for your name. Output Hello in cell B11 in worksheet TM2. Run it using the shortcut F5. 2.9.2 Exercise - Record a macro Do the following steps: Type ‘My name is:’ in cell B12. Type you name in cell B13 and activate it (click on it). Start the macro recorder and call the macro TM2_ChangeLayout. Change the color to blue and font size to 14. Stop the macro recorder. Activate cell B12 and run the macro. Open the VBA editor and inspect the macro. Cleanup the macro so only stuff about color and size are maintained. Add a button to run the macro. Select cells D15:E17 and run the macro. Modify the macro in the editor so the font size is 10 and test it. 2.9.3 Exercise - User input Write a procedure (sub) TM2_CheckNumber that: Ask for an integer using an input box. Make a message box telling if the number is above or at most 10. Write the number to cell B14. What happens if you do type in a string in the input box? 2.9.4 Exercise - Max and min number The worksheet TM2_Numbers contains a button to a procedure that generate 40 random numbers. × Hint Sub TM2_FindMax() Dim intM As Integer Dim r As Integer Worksheets(&quot;TM2_Numbers&quot;).Activate intM = 0 For r = 1 To 40 If Cells(r, 1) ___ intM Then intM = ___ End If Next Range(&quot;D1&quot;) = ___ End Sub Close Hint Create a procedure that use loops and conditional statements to find the maximum number and write it to cell D1. Assign the procedure to button Find max. Create a procedure that use loops and conditional statements to find the minimum number and write it to cell D2. Assign the procedure to button Find min. × Hint Sub TM2_FindRange() Dim intM1 As Integer Dim intM2 As Integer Dim r As Integer Worksheets(&quot;TM2_Numbers&quot;).Activate intM1 = 1001 intM2 = 0 For r = 1 To 40 ___ Next Range(&quot;D3&quot;) = &quot;[&quot; &amp; intM1 &amp; &quot;,&quot; &amp; intM2 &amp; &quot;]&quot; End Sub Close Hint Create a procedure that use loops and conditional statements to find the number range and write it to cell D3. Assign the procedure to button Find range. Given two numbers m1 and m2, you can concatenate them to a string using &amp; e.g. \"[\" &amp; m1 &amp; \",\" &amp; m2 &amp; \"]\". Create a procedure that use loops and conditional statements to count the number of positives and write it to cell D4. Assign the procedure to button Count positives. It may often be nice to know the row number of the minimum and maximum values. Create a procedure that finds the maximum row number and write it to cell D5. Assign the procedure to button Find max row. Create a procedure that finds the minimum row number and write it to cell D6. Assign the procedure to button Find min row. The procedure TM2_RunAll which is already linked to button Run All, runs all the procedures. Have a look at the code and try it out. "],["mod-vba-loops-cond.html", "Module 3 Loops and conditional statements 3.1 Learning outcomes 3.2 Relational and logical operators 3.3 Loops 3.4 Conditional statements 3.5 Example - Find Jen 3.6 Example - A distance matrix 3.7 Recap 3.8 Exercises", " Module 3 Loops and conditional statements This module gives an introduction to loops and conditional statements. Loops are used to repeat code and conditional statements are used to redirect code execution based on the conditions. Both are basic building blocks in programming. A template with VBA code for this module is given in the file 03-vba-loops-cond-template.xlsm (open it and use it while reading the notes). Have a look inside the module TM3_ex in the VBA editor for examples used in the notes and during lectures. Have a look at module TM3_exercises for exercises. The template file for next teaching module will contain guiding answers for the exercises to this teaching module. Learning path diagram Click/hover the nodes to follow links and see details. If you like a different learning style there is a lot for videos about VBA online such as course 14-Hour VBA Course. The videos have been pointed out as online supplements in the learning path diagram. However, they are not necessary for the course. Since Excel change as new versions arrive and it work on different operating systems, the look in the screenshots and videos might be a bit different from your version. However, you still should be able to understand it. 3.1 Learning outcomes By the end of this module, you are expected to be able to: Describe what a conditional statement is. Test a condition built using relational/logical operators. Declare a conditional statement. Describe what a loop is. Declare a loop. Declare nested loops. Exit a loop. The learning outcomes relate to the overall learning goals number 1, 2, 4, 8, 9-12 and 16 of the course. 3.2 Relational and logical operators Often you will need to compare a variable with another one. For this you need the relational operators given in Table 3.1 (also called comparison operators). Table 3.1: Comparison/relational operators. Operator Description Example = Equal to. A = B ’ False &lt;&gt; Not equal to A &lt;&gt; B ’ True &gt; Greater than. A &gt; B ’ False &lt; Less than. A &lt; B ’ True &gt;= Greater than or equal to. A &lt; B ’ True &lt;= Less than or equal to. A &lt;= B ’ True Assume that A = 2 and B=4. Let us consider an example (try to guess the output before running the procedure): &#39;&#39; Comparison of two variables Sub TM3_Comparison() Dim intA As Integer Dim intB As Integer intA = 10 intB = 20 If intA = intB Then MsgBox (&quot;A = B is True&quot;) Else MsgBox (&quot;A = B is False&quot;) End If If intA &lt;&gt; intB Then MsgBox (&quot;A not equal B is True&quot;) Else MsgBox (&quot;A not equal B is False&quot;) End If If intA &gt; intB Then MsgBox (&quot;A greter then B is True&quot;) Else MsgBox (&quot;A greter then B is False&quot;) End If If intA &lt;= intB Then MsgBox (&quot;A less than or equal to B is True&quot;) Else MsgBox (&quot;A less than or equal to B is False&quot;) End If End Sub Given two boolean expressions we use logical operators to compare them (see Table 3.2) Table 3.2: Logical operators. Operator Description Example AND If both the conditions are True, then the expression is true. A&lt;&gt;0 AND B&lt;&gt;0 ’ False OR If any of the two conditions are True, then the expression is true. A&lt;&gt;0 OR B&lt;&gt;0 ’ True NOT Reverse logical: if the expression is true, then the NOT operator returns false. NOT(A&lt;&gt;0 OR B&lt;&gt;0) ’ False XOR Logical Exclusion. If exactly one condition is True, the result is True. A&lt;&gt;0 XOR B&lt;&gt;0 ’ True Assume that A = 0 and B=4. Let us consider an example (try to guess the output before running the procedure): Sub TM3_Logical() If 5 &gt; 4 And 6 &gt; 2 Then MsgBox (&quot;5 &gt; 4 And 6 &gt; 2 is True&quot;) Else MsgBox (&quot;5 &gt; 4 And 6 &gt; 2 is False&quot;) End If If 1 &gt; 4 Or 1 &gt; 2 Then MsgBox (&quot;1 &gt; 4 Or 1 &gt; 2 is True&quot;) Else MsgBox (&quot;1 &gt; 4 Or 1 &gt; 2 is False&quot;) End If If 6 &gt; 4 Or 1 &gt; 2 Then MsgBox (&quot;6 &gt; 4 Or 1 &gt; 2 is True&quot;) Else MsgBox (&quot;6 &gt; 4 Or 1 &gt; 2 is False&quot;) End If If 5 &gt; 4 And Not 6 &gt; 2 Then MsgBox (&quot;5 &gt; 4 And Not 6 &gt; 2 is True&quot;) Else MsgBox (&quot;5 &gt; 4 And Not 6 &gt; 2 is False&quot;) End If &#39; If more than two boolean expressions remember parenthesis If (5 &gt; 4 Xor 6 &gt; 2) And 7 &gt; 10 Then &#39; Xor (exactly one is true) MsgBox (&quot;(5 &gt; 4 Xor 6 &gt; 2) And 7 &gt; 10 is True&quot;) Else MsgBox (&quot;(5 &gt; 4 Xor 6 &gt; 2) And 7 &gt; 10 is False&quot;) End If If 5 &gt; 4 Xor (6 &gt; 2 And 7 &gt; 10) Then MsgBox (&quot;5 &gt; 4 Xor (6 &gt; 2 And 7 &gt; 10) is True&quot;) Else MsgBox (&quot;5 &gt; 4 Xor (6 &gt; 2 And 7 &gt; 10) is False&quot;) End If End Sub Note parentheses have an impact on the result. Remember to use them correctly. 3.3 Loops Loops are used to repeat pieces of code. There are many types of loops statements but here we will consider For and While loops. The structure of a For loop is: For i = 1 To 10 &lt;code&gt; Next Here i is a counter used to repeat the code inside the loop 10 times. In general we do not use a suffix for counter variables (i should have been named intI according to our naming convention). An example on a simple for loop is: Sub TM3_Loop1() Dim i As Integer For i = 1 To 3 MsgBox (i) &#39; What will the output be? Next End Sub You can use the Step keyword to increment the counter by more than one: Sub TM3_Loop2() Dim i As Integer For i = 2 To 9 Step 2 If i &lt;&gt; 4 Then MsgBox (i) &#39; What will the output be? End If Next End Sub You can use Exit For to end a for loop prematurely (jump to the code after the loop): &#39;&#39; Write the row number in column A and exit after row 10 even though the loop runs to 20 Sub TM3_WriteNumbers1() Dim r As Integer Worksheets(&quot;TM3&quot;).Activate &#39; activate the sheet we want to use For r = 6 To 20 If r &gt; 10 Then Exit For End If Cells(r, 1) = r &#39; write to row r, col 1 (A) Next End Sub Loops may be nested inside each other. For instance if some action needs to be performed for each day and each employee or for each project and each work package of that project. Sub TM3_NestedLoops() Dim i As Integer Dim j As Integer For i = 1 To 2 For j = 1 To 3 MsgBox (&quot;(&quot; &amp; i &amp; &quot;,&quot; &amp; j &amp; &quot;)&quot;) Next Next End Sub The structure of a While loop is: Do While &lt;condition true&gt; &lt;code&gt; Loop Here the loops runs until the condition is not true. While loops are useful when you do not know how many times to do the loop in advance. An example on a simple while loop is: &#39;&#39; Write the row number in column B and exit after row 10 Sub TM3_WriteNumbers2() Dim r As Integer Worksheets(&quot;TM3&quot;).Activate r = 6 Do While r &lt; 11 Cells(r, 2) = r &#39; write to row r, col 2 (B) r = r + 1 Loop End Sub You can use Exit Do to end a while loop prematurely (jump to the code after the loop): &#39;&#39; Write 2, 4, ... in column C and exit after 21 or if equals 12 Sub TM3_WriteNumbers3() Dim i As Integer, r As Integer Worksheets(&quot;TM3&quot;).Activate r = 6 i = 2 Do While i &lt; 21 Cells(r, 3) = i &#39; write to row r, col 3 (C) If i = 12 Then Exit Do End If r = r + 1 i = i + 2 Loop End Sub Beware of endless loops. If the stopping criteria is NOT reached when using a while loop, the computer will keep going: &#39; An endless loop. Do not run if you don&#39;t know how to stop Sub TM3_EndlessLoop() Dim i As Integer While i &gt;= 0 i = i + 1 Wend End Sub An endless loop can be hard to stop depending on the operating system you use. Therefore always “save” before you “run” the code. Make sure the stopping criterion will be reached. You may try to stop the program using a shortcut ( try Ctrl + Break or Ctrl + Alt + Delete. try ⌘., ⌃ + Esc or ⌘⌥ + Esc.) Finally, the For Each loop has to be mentioned: Sub TM3_ForEach() Dim rngC As Range Dim i As Integer Worksheets(&quot;TM3&quot;).Activate i = 1 For Each rngC In Range(&quot;D6:E9&quot;) rngC = i i = i + 1 Next End Sub The loop is used for running trough a set of objects (we will have a closer look at objects in Section 5.3). Here rngC is used to run through all the cells in the range and set values. Note a range is scanned left-down. 3.4 Conditional statements Conditional statements are used to redirect code execution based on the conditions. If the condition is met then the code is executed. The general layout of an if-then-else conditional statement is: If &lt;condition&gt; Then &lt;code&gt; ElseIf &lt;condition&gt; Then &lt;code&gt; ElseIf &lt;condition&gt; Then &lt;code&gt; Else &lt;code&gt; End If If &lt;condition&gt; Then &lt;code&gt; Else &lt;code&gt; &#39; single line form You can drop the ElseIf and Else code chunks. Other conditional statements exists but in general you can formulate them using an if-then-else statement. Let us try to use a conditional statement to separate persons in two groups: &#39;&#39; Seperate persons into two groups (names are written in 2 columns) Sub TM3_SeparatePersons1() Dim r As Integer Worksheets(&quot;TM3_Separate1&quot;).Activate &#39; activate the correct sheet For r = 2 To 12 &#39; scan rows 2-12 If Cells(r, 2) = &quot;Professor&quot; Then Cells(r, 3) = Cells(r, 1) &#39; output in row C Else Cells(r, 4) = Cells(r, 1) &#39; output in row D End If Next End Sub We use variable r to store the row number we want to write to and then an if statement to separate professors from others. The output will be: Figure 3.1: Separate into two groups. If you want to separate both professors and associate professors from others, you may modify the if statement and use an ElseIf: &#39;&#39; Seperate persons into 3 groups (names are written in 3 columns) Sub TM3_SeparatePersons2() Dim r As Integer Worksheets(&quot;TM3_Separate2&quot;).Activate &#39; activate the correct sheet For r = 2 To 12 If Cells(r, 2) = &quot;Professor&quot; Then Cells(r, 3) = Cells(r, 1) ElseIf Cells(r, 2) = &quot;Associate Professor&quot; Then Cells(r, 4) = Cells(r, 1) Else Cells(r, 5) = Cells(r, 1) End If Next End Sub Finally, let us try to separate into five groups: &#39;&#39; Seperate persons into 5 groups (names are written in 5 columns) Sub TM3_SeparatePersons3() Dim r As Integer Worksheets(&quot;TM3_Separate3&quot;).Activate &#39; activate the correct sheet For r = 2 To 12 If Cells(r, 2) = &quot;Professor&quot; Then Cells(r, 3) = Cells(r, 1) ElseIf Sheet1.Cells(r, 2) = &quot;Associate Professor&quot; Then Cells(r, 4) = Cells(r, 1) ElseIf Sheet1.Cells(r, 2) = &quot;Post Doc&quot; Then Cells(r, 5) = Cells(r, 1) ElseIf Sheet1.Cells(r, 2) = &quot;PhD student&quot; Then Cells(r, 6) = Cells(r, 1) Else Cells(r, 7) = Cells(r, 1) End If Next End Sub Here the output will be: Figure 3.2: Separate into five groups. 3.5 Example - Find Jen Consider column A in Figure 3.2. Assume we want to check if Jen is in a name and output her position. We can use a for loop for this: &#39;&#39; Find cell with Jen using a For loop Sub TM3_FindJen1() Dim r As Integer Worksheets(&quot;TM3_Separate1&quot;).Activate &#39; activate the correct sheet For r = 2 To 12 If InStr(Cells(r, 1), &quot;Jen &quot;) &gt; 0 Then &#39; InStr returns first char position at which match is found (0 if no match) MsgBox &quot;Jen is a &quot; &amp; Cells(r, 2) &amp; &quot; (Row &quot; &amp; r &amp; &quot;)&quot; Exit For &#39; exit the loop End If Next End Sub We scan all rows for Jen and return her position. If we found her, then we exit the for loop (no need to search further). What happens if we search for \"Jen\" and not \"Jen \"? Figure 3.3: Search for Jen. The same can be done using a while loop: &#39;&#39; Find cell with Jen using a While loop Sub TM3_FindJen2() Dim r As Integer r = 2 Do While InStr(Cells(r, 1), &quot;Jen &quot;) = 0 r = r + 1 Loop MsgBox &quot;Jen is a &quot; &amp; Cells(r, 2) &amp; &quot; (Row &quot; &amp; r &amp; &quot;)&quot; End Sub Beware of endless looping here. What happens if Jen is not present in column A? A more error safe while loop is: &#39;&#39; Find cell with Jen using a While loop and better stopping criteria Sub TM3_FindJen3() Dim r As Integer r = 2 Do While InStr(Cells(r, 1), &quot;Jen &quot;) = 0 And r &lt; 13 r = r + 1 Loop If (r = 13) Then MsgBox (&quot;Jen not found&quot;) Else MsgBox &quot;Jen is a &quot; &amp; Cells(r, 2) &amp; &quot; (Cell A&quot; &amp; r &amp; &quot;)&quot; End If End Sub 3.6 Example - A distance matrix Assume that you have a set of \\(n=10\\) locations: Table 3.3: A set of locations Location number \\(x\\)-coordinate \\(y\\)-coordinate 1 6 1 2 1 5 3 6 3 4 7 4 5 4 6 6 4 7 7 5 2 8 1 4 9 4 2 10 6 5 The euclidean distance \\(d\\) between location \\(l_1 = (x_1, y_1)\\) and \\(l_2 = (x_2, y_2)\\) are: \\[d(1,2)=\\sqrt{(x_1-x_2)^2 + (y_1-y_2)^2}.\\] In VBA the function becomes: &#39;&#39; Calculate distance between two points &#39; &#39; @param x1 x-coordinate of first point. &#39; @param y1 y-coordinate of first point. &#39; @param x2 x-coordinate of second point. &#39; @param y2 y-coordinate of second point. Private Function TM3_Distance(x1, y1, x2, y2) Dim x As Double Dim y As Double x = x1 - x2 y = y1 - y2 TM3_Distance = Sqr((x * x) + (y * y)) End Function Assume that you want to calculate the distance matrix \\(D\\) where entry \\((i,j)\\) contains the distance between location \\(i\\) and location \\(j\\). Consider the locations in columns B and C: Figure 3.4: Distance matrix worksheet. We want to fill out the cells F1:P11 with the distances. This have been done using procedure: &#39;&#39; Create a distance matrix starting in column 6 &#39; &#39; @pre Assume that coordinates are stored in column B and C starting from row 2 &#39; and that number of points are stored in E1. Public Sub TM3_MakeDistanceMatrix() Dim n As Integer Dim i As Integer Dim j As Integer n = Range(&quot;E1&quot;) For i = 1 To n &#39; add row and column headers Cells(i + 1, 6) = Cells(1 + i, 1) &#39; row equals i+1 Cells(1, 6 + i) = Cells(1 + i, 1) &#39; column equals i+6 Next &#39; add distances For i = 1 To n For j = 1 To n Cells(i + 1, j + 6) = TM3_Distance(Cells(i + 1, 2), Cells(i + 1, 3), Cells(j + 1, 2), Cells(j + 1, 3)) Next Next End Sub First, row and column headers are written to the cells. Next, we use a nested for loop to calculate the distances and output them to the cells. Note we in fact calculate the same distance two times (the distance from \\(i\\) to \\(j\\) equals the distance from \\(j\\) to \\(i\\)). Since we have symmetric distances there is no need to do this and it can be avoided by letting the inner loop in the nested loops be dependent on the outer loop: &#39;&#39; Create a symetric distance matrix with only the upper right part filled starting in column 6. &#39; &#39; @pre Assume that coordinates are stored in column B and C starting from row 2 &#39; and that number of points are stored in E1. Public Sub TM3_MakeSymetricDistanceMatrix() Dim n As Integer Dim i As Integer Dim j As Integer n = Range(&quot;E1&quot;) For i = 1 To n Cells(i + 1, 6) = Cells(1 + i, 1) Cells(1, 6 + i) = Cells(1 + i, 1) Next For i = 1 To n For j = i + 1 To n Cells(i + 1, j + 6) = TM3_Distance(Cells(i + 1, 2), Cells(i + 1, 3), Cells(j + 1, 2), Cells(j + 1, 3)) Next Next End Sub Figure 3.5: Distance matrix worksheet with symmetric distances. 3.7 Recap Loops are used to repeat pieces of code. For loops (repeat a number of times): For i = 1 To 10 &lt;code&gt; Next While loops (repeat until a condition is met): Do While &lt;condition&gt; &#39; repeat while true &lt;code&gt; Loop Use Exit for and Exit Do to break a For and a Do While loop before it ends (jump to the code after the loop). Loops may be nested inside each other: For i = 1 To 2 For j = 1 To 3 MsgBox (&quot;(&quot; &amp; i &amp; &quot;,&quot; &amp; j &amp; &quot;)&quot;) Next Next Conditional Statements are used to make decisions based on the conditions. If the condition is met then the code is executed. An if-then-else statement: If &lt;condition&gt; Then &lt;code&gt; ElseIf &lt;condition&gt; Then &lt;code&gt; Else &lt;code&gt; End If You may drop the ElseIf and Else code chunks. You may also have a look at the slides for this module . 3.8 Exercises Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the help page. Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution! A template with VBA code for this module is given in the file 03-vba-loops-cond-template.xlsm (open it and use it while reading the notes). Have a look inside the module TM3_ex in the VBA editor for examples used in the notes and during lectures. Have a look at module TM3_exercises for exercises. The template file for next teaching module will contain guiding answers for the exercises to this teaching module. 3.8.1 Exercise - Loops Use the sheet TM3 for output. Create a for loop that writes numbers 1 to 4 in rows 25 to 28 in column A. Create a do while loop that writes numbers 1 to 4 in rows 25 to 28 in column B. Create a loop that writes numbers 1 to 4 in rows 27 to 30 in column C. Create a loop that writes numbers -1 to -4 in rows 25 to 28 in column D. Create a loop that writes numbers 1 to 4 in rows 28 to 31 in column E, except if the number is 3 then the output should to a string missing. Create a do while loop that writes numbers i = 1, 2, … in column G (starting in row 25) until i/5 + 3 = 8. Hint: you may use a Exit Do to quit the loop. Create a sub that runs all the loops. 3.8.2 Exercise - Conditional statements Consider worksheet TM3_Numbers, which contains a set of numbers. Create a procedure with the following features Make a copy of the numbers with the upper left cell starting G1. Scan all the numbers and remove (clear the cell) all the negative numbers (you may use a For Each loop). Highlight all the numbers above 20 (using e.g. rngC.Interior.ColorIndex = 37). Add a button to worksheet TM3_Numbers that run the procedure. Create a procedure with the following features: Scan the numbers and find the sum of all non-negative numbers, the mean of all negative numbers. Use a message box to display the sum and mean calculated. Add a button to worksheet TM3_Numbers that run the procedure. This exercise is a slightly modified version an exam assignment (reexam 2022-A5). "],["mod-vba-procedures.html", "Module 4 Procedures 4.1 Learning outcomes 4.2 Subs and functions - The basics 4.3 Optional arguments 4.4 Public and private procedures 4.5 Passing arguments by reference or by value 4.6 Built-in functions 4.7 Example - Selection of test persons 4.8 Recap 4.9 Exercises", " Module 4 Procedures This module gives a short introduction to procedures. A procedure is a piece of code stored in a module which contains a series of computational steps that will be carried out when the procedure is called. VBA has two kinds of procedures subs (short for subroutine) and functions. Both are basic building blocks in programming. The main differences between a sub and a function is: Subs Can make changes to the worksheet. Can modify its surroundings. Can be executed by a button (a macro - if no arguments). Cannot return anything. Functions Can return something. Can be used in Excel. Cannot be used as a macro. A template with VBA code for this module is given in the file 04-vba-procedures-template.xlsm (open it and use it while reading the notes). Have a look inside the module TM4_ex in the VBA editor for examples used in the notes and during lectures. Have a look at module TM4_exercises for exercises. The template file for next teaching module will contain guiding answers for the exercises to this teaching module. During execution of procedures it may be useful to use the debugger to run the code step by step. A very short introduction to debugging in VBA is given in Section E.1. Read it before continuing this teaching module. Learning path diagram Click/hover the nodes to follow links and see details. 4.1 Learning outcomes By the end of this module, you are expected to be able to: Describe what a procedure is. Explain what kind of procedures there are in VBA and what they can be used for. Declare and call a procedure. Explain what the difference is by using input arguments by reference or by value in a procedure. Set the scope of a procedure using private or public procedures. Set default input arguments. Call built-in functions for VBA and Excel. The learning outcomes relate to the overall learning goals number 1, 2, 4, 8 and 9 of the course. 4.2 Subs and functions - The basics A sub is declared using: Sub SubName(arg1 As &lt;datatype&gt;, arg2 As &lt;datatype&gt;) &lt;code&gt; End Sub The name of the sub is SubName and it takes two arguments arg1 and arg2. A sub can take an arbitrary number of arguments. Until now we have mostly considered subs with no arguments often called a macro. Macros can be called using a button in Excel. A function is declared using: Function FunctionName(arg1 As &lt;datatype&gt;, arg2 As &lt;datatype&gt;) As &lt;return datatype&gt; &lt;code&gt; FunctionName = value &#39; assign a return value to the function End Sub The name of the function is FunctionName and it takes two arguments arg1 and arg2. A function can take an arbitrary number of arguments. A function always return a value of a data type (a sub do not return anything). You return a value by assigning it to the variable FunctionName (same as the function name). Let us consider a simple sub with one argument: Sub TM4_SimpleSub(str As String) MsgBox (str) End Sub and a simple function with two arguments: Function TM4_SimpleFunc(dblA As Double, dblB As Double) As Integer TM4_SimpleFunc = dblA + dblB &#39; return variable equals function name End Function You call a sub from another procedure using the Call keyword and a another function by assigning its return value to a variable: &#39; Try running it using the debugger (Ctrl + F8 (win) or cmd + shift + I (mac)) Sub TM4_CallSimpleProc() Dim dblV As Double MsgBox (&quot;Ready&quot;) Call TM4_SimpleSub(&quot;SimpleSub&quot;) &#39; call a sub within a procedure dblV = TM4_SimpleFunc(3, 4) &#39; call a function within a procedure MsgBox (&quot;Value is &quot; &amp; intV) End Sub It is always good coding practice to document you procedures: &#39;&#39; Product of two numbers &#39; @param i First number &#39; @param j Second number &#39; @return The product i * j &#39; @remarks The numbers are doubles. Function TM4_ProductFunc(i As Double, j As Double) As Double TM4_ProductFunc = i * j End Function &#39;&#39; Product of two numbers which are stored in dblV (since ByRef is the default). &#39; @param i First number &#39; @param j Second number &#39; @param dblV Stores the product &#39; @remarks The numbers are doubles. Private Sub TM4_ProductSub(i As Double, j As Double, dblV As Double) dblV = i * j End Sub Note both procedures above do the same thing. The function returns the product and the procedure stores the product in argument dblV which is modified when the function call is returned: &#39;&#39; Use TM4_ProductSub (TM4_ProductFunc produce the same result) &#39; Try running it using the debugger (Ctrl + F8 (win) or cmd + shift + I (mac)) Sub TM4_RunProductSub() Dim dblV As Double dblV = 4 MsgBox (&quot;Current value is &quot; &amp; dblV) &#39; Current value is 4 Call TM4_ProductSub(7, 3, dblV) &#39; dblV = TM4_ProductFunc(7, 3) (same result) MsgBox (&quot;Current value is &quot; &amp; dblV) &#39; Current value is 21 End Sub The reason is that arguments are per default references pointing to the same place in memory (we will look at the details in Section 4.5). You can use Exit Sub/Exit Function to exit the sub/function early in the code: &#39;&#39; Division of two numbers &#39; @param i First number. &#39; @param j Second number. &#39; @return Divison i / j. &#39; @remarks The numbers are doubles. Sub TM4_DivisionSub(i As Double, j As Double) If j = 0 Then MsgBox (&quot;Error: division with zero!&quot;) Exit Sub End If MsgBox (&quot;Value is &quot; &amp; i / j) End Sub &#39;&#39; Run using F5 Sub TM4_TestDivisionSub() Call TM4_DivisionSub(8, 2) &#39; no error Call TM4_DivisionSub(8, 0) &#39; gives an error message End Sub 4.3 Optional arguments Often you define procedures that have arguments with a default value. You can do this using the Optional keyword: &#39;&#39; Convert kilograms to grams or pounds &#39; @param dblKg Kilograms. &#39; @param blnToGrams Convert to grams (if true) otherwise to pounds. &#39; @return Converted value. Function TM4_ConvertKg(dblKg As Double, Optional blnToGrams As Boolean = True) If blnToGrams Then TM4_ConvertKg = dblKg * 1000 Exit Function End If TM4_ConvertKg = dblKg * 2.20462 End Function &#39;&#39; Run using F5 Sub TM4_TestConvertKg() MsgBox (TM4_ConvertKg(10)) &#39; use default value (to grams) MsgBox (TM4_ConvertKg(10, False)) &#39; to pounds End Sub Here we have one optional argument with default value equal to true. Now the function can be called with one argument (use the default value of the second argument) or with two arguments. Have a look at cells A8:C13 in worksheet TM4 (Figure 4.1) where we use the function to find convert to grams (TM4_ConvertKg(A8)) and pounds (TM4_ConvertKg(A8; FALSE)). Let us try to define a sub that format some cells (the content have been found using the macro recorder and then cleaned): &#39;&#39; Format a range &#39;@param rng Range to format. &#39;@param intInteriorColor Interior color index. &#39;@param intFontColor Font color index. &#39;@param intFontSize Font size. Sub TM4_FormatCell(rng As Range, Optional intInteriorColor As Integer = 0, _ Optional intFontColor As Integer = 44, Optional intFontSize As Integer = 12) rng.Interior.ColorIndex = intInteriorColor rng.Font.ColorIndex = intFontColor rng.Font.Size = intFontSize End Sub &#39;&#39; Run using F5 Sub TestingFormatCell() Dim rng As Range Worksheets(&quot;TM4&quot;).Activate Call FormatCell(Range(&quot;A16&quot;)) &#39; use default values Call FormatCell(Range(&quot;B16&quot;), 46) &#39; use background color index 46 Call FormatCell(Range(&quot;C16&quot;), , 21) &#39; set font color Call FormatCell(rng:=Range(&quot;D16&quot;), intFontSize:=16, intFontColor:=23) &#39; call sub using argument names explicit End Sub Observe that there is different ways to call a procedure with optional arguments. If you have may optional arguments it is best to use the last where you explicit state the argument names (here the order of the arguments do not matter either). Note that every argument following an optional argument in the procedure definition must also be optional. Moreover, if lines are to long you may split them using _ (underscore). In the example above we use the color index values in VBA (56 different ones). Let us have a look at them: &#39;&#39; Run using F5 Sub TM4_SeeColorIndex() Dim r As Integer Dim c As Integer Dim i As Integer Worksheets(&quot;TM4&quot;).Activate i = 1 For r = 18 To 40 For c = 2 To 5 Cells(r, c) = i Call TM4_FormatCell(rng:=Cells(r, c), intInteriorColor:=i, intFontColor:=1 + i Mod 4) If i = 56 Then Exit Sub End If i = i + 1 Next Next End Sub The output will be outputted from row 18 (column B-E): Figure 4.1: TM4 worksheet. 4.4 Public and private procedures You may use the keyword Private or Public (default) when you define a procedure. For instance: Private Sub SubName(arg1 As &lt;datatype&gt;, arg2 As &lt;datatype&gt;) &lt;code&gt; End Sub A private procedure can only be used by other procedures in the module. This may be useful if you want to define ‘internal’ procedures that you only want to use in the module. This also imply that a private sub can not be called from a button and a private function can not be called from a cell. Note the default value is Public. That is, if Private or Public is excluded, VBA will always treat the sub as if it were Public: Sub SubName(arg1 As &lt;datatype&gt;, arg2 As &lt;datatype&gt;) &#39; VBA assumes it is public (the default) &lt;code&gt; End Sub Public Sub SubName(arg1 As &lt;datatype&gt;, arg2 As &lt;datatype&gt;) &#39; same result as above &lt;code&gt; End Sub 4.5 Passing arguments by reference or by value There are two ways of passing arguments to procedures: Sub SubName(ByRef arg1 As &lt;datatype&gt;, ByVal arg2 As &lt;datatype&gt;) &lt;code&gt; End Sub Argument arg1 is passed by reference (default). That is, no new memory is allocated when the procedure is called and as a result the procedure can have changed the value of arg1 when the procedure stops. Note since the default, the result is the same if we omitted the keyword ByRef. Argument arg2 is passed by value. That is, a copy of the variable is created in memory. Hence the procedure cannot change the value of arg2 when the procedure stops (the copy is deleted). Using ByRef is faster and saves memory since we do not have to allocate new memory. We may use ByRef to return updated values of the input arguments (sub TM4_ProductSub did that). In fact you may have multiple arguments which when the sub finished have been modified. See it as the arguments have been modified with the result of the sub. Using ByVal is safer if you want be sure that the argument is not modified inside the procedure. Try guessing the result of running sub TM4_TestingBy: Private Function TM4_ByVal(ByVal i As Integer) As Integer i = i * 2 MsgBox (&quot;In ByVal i is &quot; &amp; i) TM4_ByVal = i * 5 End Function &#39;&#39; Note &quot;Function TM4_ByRef(i As Integer) As Integer&quot; gives same result Private Function TM4_ByRef(ByRef i As Integer) As Integer i = i * 2 MsgBox (&quot;In ByRef i is &quot; &amp; i) TM4_ByRef = i * 5 End Function &#39; Try running it using F5 or the debugger (Ctrl + F8 (win) or cmd + shift + I (mac)) Private Sub TM4_TestBy() Dim n As Integer Dim i As Integer i = 5 MsgBox (&quot;In the start i is &quot; &amp; i) n = TM4_ByVal(i) MsgBox (&quot;Try gussing the values of n and i&quot;) MsgBox (&quot;After TM4_ByVal i is &quot; &amp; i &amp; &quot; and &quot; &amp; n &amp; &quot; is returned.&quot;) n = TM4_ByRef(i) MsgBox (&quot;Try gussing the values of n and i&quot;) MsgBox (&quot;After TM4_ByRef i is &quot; &amp; i &amp; &quot; and &quot; &amp; n &amp; &quot; is returned.&quot;) End Sub 4.5.1 Return values from a sub Since ByRef does not create a new copy of the argument in memory. We can return multiple values from a sub by Pass arguments (variables) by reference in the sub. Modify the variables inside the sub. When the sub returns after it has been called the variables used a arguments contain the new updated values. See e.g TM4_ProductSub which returns the product in variable dblV. 4.6 Built-in functions VBA has a set of built-in functions such as Abs, Log and Date. You call them by just writing their name: &#39;&#39; Test VBA functions &#39; You can always get help by putting the crusor in the function name and press F1 Sub TM4_TestVBAfunctions() MsgBox (&quot;Absolute value: &quot; &amp; Abs(-4.2)) MsgBox (&quot;Integer part: &quot; &amp; Fix(-4.2)) MsgBox (&quot;Floor of the number: &quot; &amp; Int(-4.2)) MsgBox (&quot;Natural logarithm: &quot; &amp; Log(16)) MsgBox (&quot;Random number [0,1[: &quot; &amp; Rnd()) MsgBox (&quot;Current date: &quot; &amp; Date) MsgBox (&quot;Days from now: &quot; &amp; DateDiff(&quot;d&quot;, Date, DateValue(&quot;October, 28, 2022&quot;))) End Sub You can also use the worksheet functions in Excel. You call them using the WorksheetFunction object. A few examples: &#39;&#39; Test worksheetfunctions &#39; You can always get help by putting the crusor in the function name and press F1 Sub TM4_TestWorksheetfunctions() Dim r As Integer Dim c As Integer Worksheets(&quot;TM4&quot;).Activate MsgBox (&quot;Numbers above 80: &quot; &amp; WorksheetFunction.CountIf(Range(&quot;B33:E38&quot;), &quot;&gt;80&quot;)) &#39; count numbers above MsgBox (&quot;Sumproduct: &quot; &amp; WorksheetFunction.SumProduct(Range(&quot;B33:E33&quot;), Range(&quot;B34:E34&quot;))) MsgBox (&quot;Max: &quot; &amp; WorksheetFunction.Max(Range(&quot;B33:E38&quot;))) For r = 40 To 45 For c = 2 To 4 Cells(r, c) = WorksheetFunction.RandBetween(0, 9) Next Next End Sub 4.7 Example - Selection of test persons This example is a slightly modified version an exam assignment (exam 2021-A6). A virus has infected a number of persons. A possible cure has been developed, but the effect of it is expected to be dependent on the persons’ height. The cure can be tested on non-infected persons and the findings of this test can be directly transferred to any infected person whose height is within a range of 2 cm from the height of the tested person. For example, if the cure is tested on a non-infected person of height \\(172.2\\), then any infected person whose height is in the interval \\([170.2 ; 174.2]\\) is covered by the test. Figure 4.2: Infected and test persons. Figure 4.2 shows the data in worksheet TM4_Virus: Cell D1 states the number of infected persons. Columns A and B provide the person’s ID and height for each person. Cell D2 states the number of non-infected persons volunteering to be test persons. Columns F and G provide their ID and height. The testing process is extremely resource demanding, and thus it is only possible to test a limited number of test volunteers. This number is stated in cell D3. Given a test person we make a function TM4_TestCover that takes person id as argument and return the number of new infected persons covered. A person is already covered, if that person has a 1 in the Covered column. Function TM4_TestCover(intId As Integer) As Integer Dim intI As Integer &#39; number of infected Dim intC As Integer &#39; number of covered Dim dblHeight As Double &#39; height of test person Dim r As Integer intI = Range(&quot;D1&quot;) dblHeight = Range(&quot;G&quot; &amp; intId + 6) intC = 0 For r = 7 To intI + 6 &#39; loop through all infected If Cells(r, 2) &gt;= dblHeight - 2 And Cells(r, 2) &lt;= dblHeight + 2 And Cells(r, 3) &lt;&gt; 1 Then intC = intC + 1 End If Next TM4_TestCover = intC End Function First, note that given a test person id, the height is found in row id + 6 and column G. Next, we use the counter intC to count new covered persons. This result is returned by the function. To find the right test persons the following greedy strategy is used: Step 1: Select the test person (not already selected) that can cover most new infected persons (not yet covered). If more than one test person have the same cover, select the one with the smallest ID. Step 2: Add ones to the Covered column for all infected persons covered by the test person. Step 3: Go to Step 1 until found the test persons needed. We implement the the greedy strategy: Sub TM4_FindTestPersons() Dim intI As Integer &#39; number of infected Dim intT As Integer &#39; number of test volunteers Dim intS As Integer &#39; number of selected persons Dim intC As Integer &#39; number of covered Dim intBestId As Integer &#39; best id found Dim intBestC As Integer &#39; best cover value found Dim r As Integer Worksheets(&quot;TM4_Virus&quot;).Activate intI = Range(&quot;D1&quot;) intT = Range(&quot;D2&quot;) intS = 0 &#39; no selected yet Do While intS &lt; Range(&quot;D3&quot;) &#39; stop when have found needed test persons intBestId = -1 intBestC = -1 For r = 7 To intT + 6 &#39; loop through all test volunteers If Cells(r, 8) &lt;&gt; 1 Then &#39; not selected already intC = TM4_TestCover(Cells(r, 6)) If intBestC &lt; intC Then &#39; found a better person intBestC = intC intBestId = Cells(r, 6) End If End If Next Cells(intBestId + 6, 8) = 1 &#39; select best For r = 7 To intI + 6 &#39; add ones in covered column If Abs(Cells(r, 2) - Cells(intBestId + 6, 7)) &lt;= 2 Then Cells(r, 3) = 1 End If Next intS = intS + 1 Loop End Sub First, the number of persons are stored in variables. Next, a Do While loop is used to find the test persons. We use two variables to store the best id and cover value. The first inner for loop scan the test persons and for each person (not yet selected) we find the cover (using TM4_TestCover), check if better than current and update. The second inner for loop add ones to the Covered column. The output is given in Figure 4.3. Figure 4.3: Infected and test persons. In total 13 infected persons are covered by 3 test persons. 4.8 Recap A procedure is a piece of code stored in a module. A procedure contains a series of computational steps that will be carried out when the procedure is called. VBA has two kinds of procedures: Subs: Can make changes to the worksheet. Can modify its surroundings. Can be executed by a button (if no arguments). Cannot return anything. Functions: Can return something. Can be used in Excel. Cannot be used as a macro. You declare a procedure using Sub SubName(arg1 As &lt;datatype&gt;, arg2 As &lt;datatype&gt;) &lt;code&gt; End Sub Function FunctionName(arg1 As &lt;datatype&gt;, arg2 As &lt;datatype&gt;) As &lt;return datatype&gt; &lt;code&gt; FunctionName = value &#39; assign a return value to the function End Sub You can use Exit Sub/Exit Function to exit the sub/function early in the code. Procedures can be either public or private: Public (default): Can be used from other modules, from other files and from Excel. Public Sub SubName() ... End Sub Private: Can only be used from within its own module. Private Sub SubName() ... End Sub Use the Call keyword to call a sub: Call SubName(arg1, arg2) Call a function by assigning its return value to a variable result = FunctionName(arg1, arg2) There are two ways of passing arguments to procedures: Sub SubName(ByRef arg1 As &lt;datatype&gt;, ByVal arg2 As &lt;datatype&gt;) &lt;code&gt; End Sub Argument arg1 is passed by reference (default). That is, no new memory is allocated when the procedure is called and hence the procedure can have changed the value of arg1 when the procedure stops. Since the default is ByRef, the result is the same if we omitted the keyword ByRef. Argument arg2 is passed by value. That is, a copy of the variable is created in memory with local scope. Hence the procedure cannot change the value of arg2 when the procedure stops (the local variables is deleted). Using ByRef is faster and saves memory since we do not have to allocate new memory. We may use ByRef to return updated values of the input arguments. Use the Optional keyword to indicate default input arguments: Sub SubName(arg1 As &lt;datatype&gt;, Optional arg2 As &lt;datatype&gt; = &lt;defaultValue&gt;) You can now call the procedure using: Call SubName(arg1) &#39; assume that arg2 = defaultValue Every parameter following an optional parameter in the procedure definition must also be optional. VBA has a set of built-in functions such as Abs, Log and Date. You call them by just writing their name: dtm as Date dtm = Date() You can also use the worksheet functions in Excel. You call them using the WorksheetFunction object: sum = WorksheetFunction.Sum(Range(&quot;A1:D5&quot;)) You may also have a look at the slides for this module . 4.9 Exercises Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the help page. Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution! A template with VBA code for this module is given in the file 04-vba-procedures-template.xlsm (open it and use it while reading the notes). Have a look inside the module TM4_ex in the VBA editor for examples used in the notes and during lectures. Have a look at module TM4_exercises for exercises. The template file for next teaching module will contain guiding answers for the exercises to this teaching module. 4.9.1 Exercise - Subs Create a sub GetMsg that takes a string and a Boolean as input and create a message box with the string content if the Boolean is true. Test the procedure using the TestGetMsg sub. Modify the procedure so the Boolean have a default value equal to true. Create a sub PrintNameAge that takes two arguments as input (name and age) and create a message box with the persons name and age. Write a sub TestPrintNameAge that uses two input boxes to ask for name and age and then call sub PrintNameAge. 4.9.2 Exercise - Temperatures This exercise is a slightly modified version an exam assignment (reexam 2022-A4). Temperatures in Fahrenheit can be converted to Celsius using \\[C = \\frac{5(F-32)}{9}\\] Similar temperatures in Celsius can be converted to Fahrenheit using \\[F = \\frac{9C}{5} + 32\\] Make functions: TM4_CelsiusToFahrenheit that takes a double dblVal in Celsius as input argument and returns the number converted to Fahrenheit. TM4_FahrenheitToCelsius that takes a double dblVal in Fahrenheit as input argument and returns the number converted to Celsius. Make a function TM4_ConvertTemp with the following features: Input arguments are a double dblVal and a string strIUnit. If the input unit strIUnit equals “c” then the returned number is converted to Fahrenheit. If the input unit strIUnit equals “f” then the returned number is converted to Celsius. If the input unit strIUnit does not equals “f” or “c” then a message box is given with an error. Test function TM4_ConvertTemp on worksheet TM4 (row 66). 4.9.3 Exercise - Functions Write a function TM4_Discount which takes a two input arguments (doubles): the discount percentage and the amount. The function returns the discounted value. For instance if the discount is 10 percent and amount 100 then the discounted value is \\(90 = 100\\cdot(1-0.1)\\). Have a look at the unfinished sub TM4_Discount for hints. Note the comments describing the function using the coding convention. Check the test results starting from row 47 in worksheet TM4. Write a function Larger which takes two integer arguments and returns true if the first is larger than the last; otherwise false. Check the test results starting from row 53 in worksheet TM4. Write a function NumbDays that takes a date as argument and return the number of days from today. Hint: Have a look at the DateDiff function. Check the test results starting from row 59 in worksheet TM4. Write a sub that uses an input box to ask for an amount a then returns the discounted amount when the discount is 20%. The sub should use the function in Question 1. Test it using the button in worksheet TM4 (row 49). 4.9.4 Exercise - Worksheet functions The worksheet TM4_Numbers contains a button that runs a procedure which generate a set of numbers. Create a procedure TM4_Summary that uses worksheet functions to: Find the maximum number and write it to cell D1. Find the minimum number and write it to cell D2. Find the sum of the numbers and write it to cell D3. Count the number of positives and write it to cell D4. Find the row number with maximum value and write it to cell D5. Google is a good place to start if you want to find a specific Excel function, e.g. try to search ‘excel row with max value’. Test the procedure using the Summary button in worksheet TM4_Numbers. "],["mod-vba-datatypes.html", "Module 5 Advanced data types and usage 5.1 Learning outcomes 5.2 Strings 5.3 Objects 5.4 The Worksheet object 5.5 The Range object 5.6 Arrays 5.7 Collections 5.8 Example - Job sequencing 5.9 Recap 5.10 Exercises", " Module 5 Advanced data types and usage Recall that variables are used to store information that is saved in memory. A variable may store different data types. Until now we have mostly considered basic data types such as an integer, a double or a string. In this module a short introduction to some of the more advanced data types is given such as a group of integers (an array), a range of cells in a worksheet (a range object) or a set of numbers (a collection). Learning path diagram Click/hover the nodes to follow links and see details. If you like a different learning style there is a lot for videos about VBA online such as course 14-Hour VBA Course. The videos have been pointed out as extra online supplements in the learning path diagram. However, they are not necessary for the course. Since Excel change as new versions arrive and it work on different operating systems, the look in the screenshots and videos might be a bit different from your version. However, you still should be able to understand it. 5.1 Learning outcomes By the end of this module, you are expected to be able to: Name different data types and how they effect memory size. Declare a variable as a data type. Declare and manipulate strings. Describe what the object is. Declare and set an object. Manipulate worksheets (add, delete, clear). Understand what a range is and extract info about it such as rows, start row, address, start column etc. Use the current region of a range to get information about the size for data. Sort, paste and modify a range. Declare and use an array with both fixed and dynamic dimension. Sort, read and modify an array. Explain why using arrays is often better than ranges. Declare and use a collection. Explain what a collection of objects are. Use a For Each loop to iterate though a collection of objects. The learning outcomes relate to the overall learning goals number 1, 2, 4, 8 and 9 of the course. 5.2 Strings Strings contain a group of characters (an empty string is of length zero). Memory requirements vary with the length of the string (10 bytes + length \\(\\cdot\\) 2 byte). We use the symbol &amp; to concatenate strings (glue strings together): &#39;&#39; Concatenate two strings Sub TM5_StrConcat() Dim strX As String Dim strY As String Dim strRes As String strX = &quot;VBA&quot; strY = &quot;Strings&quot; strRes = strX &amp; &quot; &quot; &amp; strY MsgBox (strRes) MsgBox (strX &amp; vbCr &amp; strY) &#39; use vbCr to insert a new line End Sub Note you can use constant vbCr to add a new line. There are many VBA functions that can be used to manipulate strings. Some examples: &#39;&#39; String functions Sub TM5_StrFunc() Dim str As String str = &quot;VBA Strings&quot; MsgBox (&quot;The length is: &quot; &amp; Len(str)) MsgBox (&quot;In lowercase: &quot; &amp; LCase(str)) MsgBox (&quot;Last 7 char: &quot; &amp; Right(str, 7)) MsgBox (&quot;Replace: &quot; &amp; Replace(str, &quot;Strings&quot;, &quot;Rules&quot;)) MsgBox (&quot;Compare: &quot; &amp; StrComp(str, &quot;VBA Strings&quot;)) &#39; result is 0 (equal) MsgBox (&quot;Compare: &quot; &amp; StrComp(str, &quot;Apple&quot;)) &#39; result is 1 (str alfabetically after) MsgBox (&quot;Compare: &quot; &amp; StrComp(str, &quot;Wait&quot;)) &#39; result is -1 (str alfabetically before) MsgBox (&quot;String is starting at char number: &quot; &amp; InStr(str, &quot;String&quot;)) &#39; result is 0 if not found End Sub 5.3 Objects VBA have a lot of predefined objects you can use. Think of an object as a datatype that holds a group of variables. Examples of some objects are Range, Worksheet, and WorksheetFunction. Objects are grouped, nested and you refer to an object by specifying the path, e.g.: Workbooks(&quot;Jobs.xlsm&quot;).Worksheets(&quot;Data values&quot;).Range(&quot;D4&quot;).value Here we refer to the value in cell D4 in worksheet Data values in the file Jobs.xlsm. You may skip parts of the path (VBA then uses the current active one): Workbooks(&quot;Jobs.xlsm&quot;).Worksheets(&quot;Data values&quot;).Range(&quot;D4&quot;).value &#39; full specification Worksheets(&quot;Data values&quot;).Range(&quot;D4&quot;).value &#39; same result if Excel file &quot;Jobs.xlsm&quot; is active Range(&quot;D4&quot;) &#39; same result if Excel sheet &quot;Data values&quot; is active and &quot;Jobs.xlsm&quot; file Note .value has been dropped in the last line because it is the default, i.e. you do not have to write it explicit. Object variables are declared like any other variables: Dim rng As Range Dim wst As Worksheet Use Set to allocate the Object: Set rng = Range(&quot;F7&quot;) Set wst = Worksheets(&quot;Data values&quot;) Now rng is a reference to cell F7 and wst is a reference to worksheet Data values. Think of a reference as a value that identify where in memory the object is. In the next sections let us have a look at some relevant objects. 5.4 The Worksheet object The Worksheet object refer to a worksheet in the Excel file and you can use it to e.g. modify cells: Sub TM5_TestWorksheet() ThisWorkbook.Activate &#39; activate this workbook Worksheets(&quot;TM5_Test1&quot;).Range(&quot;B2&quot;) = &quot;Testing Worksheet&quot; &#39; write to cell in sheet TM5_Test1 Sheet_TM5_Test1.Range(&quot;B3&quot;) = &quot;Use the sheets code name&quot; &#39; use the code name (also work if sheet renamed) &#39;ThisWorkbook.Worksheets(&quot;Test3&quot;).Range(&quot;B5&quot;) = &quot;Test&quot; &#39; Error since there is no sheet Test3 in this workbook Range(&quot;B4&quot;) = &quot;Do you know which sheet is active?&quot; &#39; Active sheet &#39; Good coding pratice is always to specify the full path (as above) or make the sheet under considration active Worksheets(&quot;TM5_Test1&quot;).Activate &#39; Make sheet active so know where is Range(&quot;B5&quot;) = &quot;I know which sheet is active!&quot; End Sub It is always good practice to make sure that you are working with the correct Excel file. Otherwise you will get errors if another file is active. This can be done using the ThisWorkbook object. Similar you either refer to a worksheet directly using its name or its code name. The code name can be set in the Properties window in the VBA editor. An alternative is to activate the worksheet. You can use Worksheet variables: Sub TM5_TestWorksheetVar() Dim wst1 As Worksheet &#39; define a variable which hold a reference to a Worksheet object Dim wst2 As Worksheet &#39; define a variable which hold a reference to a Worksheet object Dim rng As Range Set wst1 = ThisWorkbook.Worksheets(&quot;TM5_Test1&quot;) &#39; set the reference Set wst2 = ThisWorkbook.Worksheets(&quot;TM5_Test2&quot;) &#39; set the reference wst1.Range(&quot;B6&quot;) = &quot;Writing using wst1&quot; wst2.Range(&quot;B2&quot;) = &quot;Writing using wst2&quot; wst1.Activate &#39; just to have a look End Sub Here by having two worksheet variables we can write directly to cells in different worksheets without activating the worksheet. You may check if a worksheet exists using: &#39;&#39; Check if a worksheet exists &#39; @param strName Name of worksheet. &#39; @return True if exists. Function WstExists(strName As String) As Boolean WstExists = Evaluate(&quot;ISREF(&#39;&quot; &amp; strName &amp; &quot;&#39;!A1)&quot;) End Function The worksheet object has a lot of methods/properties (think of methods as procedures defined inside the object) for instance wst.Add and wst.Delete. Let us try to define a function that delete a worksheet: &#39;&#39; Delete a worksheet if it exists &#39; @param strName Name of worksheet. &#39; @return True if deleted. &#39; @author Lars Relund &lt;lars@relund.dk&gt; Function WstDelete(strName As String) As Boolean Dim wst As Worksheet Dim bln As Boolean bln = Application.DisplayAlerts Application.DisplayAlerts = False &#39; no &quot;really want to delete&quot; alert If WstExists(strName) Then Worksheets(strName).Delete WstDelete = True Else WstDelete = False End If Application.DisplayAlerts = bln &#39; restore value End Function We first use the function WstExists to check if there is a worksheet. If there is, we call the .delete method and delete the worksheet. Note since we do not want an alert stating if we really want to delete the worksheet this is disabled using the Application object. The function returns true if the worksheet has been deleted. Let us try to define a function that create a worksheet: &#39;&#39; Create a worksheet &#39; @param strName Name of worksheet. &#39; @param blnForce Force deletion of worksheet if exists. &#39; @return True if created. Function WstCreate(strName As String, Optional blnForce As Boolean = False) As Boolean Dim wst As Worksheet If blnForce And WstExists(strName) Then Call WstDelete(strName) If Not WstExists(strName) Then Set wst = Worksheets.Add wst.Name = strName WstCreate = True Else WstCreate = False End If End Function We use an optional argument to force deletion of the old worksheet (if a worksheet with the same name). Next, we create the worksheet using the .Add method and rename it using the .Name method. The function returns true if the worksheet has been created. Finally, let us create a function that clear a worksheet: &#39;&#39; Clear a worksheet if it exists &#39; @param strName Name of worksheet. &#39; @param blnCells Delete cell contents, formats, comments, etc. (default). &#39; @param blnContents Delete cell contents. &#39; @param blnFormat Delete cell format. &#39; @param blnObjects Delete cell buttons and charts. &#39; @return True if cleared. Function WstClear(strName As String, _ Optional blnCells As Boolean = True, _ Optional blnContents As Boolean = False, _ Optional blnFormat As Boolean = False, _ Optional blnObjects As Boolean = False) As Boolean Dim wst As Worksheet On Error Resume Next If WstExists(strName) Then Set wst = Worksheets(strName) If blnCells Then wst.UsedRange.Clear If blnContents Then wst.Cells.ClearContents If blnFormat Then wst.Cells.ClearFormats If blnObjects Then wst.ChartObjects.Delete wst.Buttons.Delete End If WstClear = True Else WstClear = False End If End Function First note that we have a lot of optional arguments depending on what we want to clear. Next the On Error Resume Next statement is used to make the program not stop even if an error happens. Finally, depending on the setting of the optional arguments we e.g. clear the format in all cells if blnFormat is true. All the functions above is part of the course procedures that you may use ‘as is’ during the course and at the exam. I will explicitly state if you are not allowed to use them otherwise. All the worksheet procedures start with Wst so you easy can find them using auto complete in the VBA editor. All worksheet procedures are stored in the ModWst module. You may open the module to have a look at the procedures. Let us see them in action: &#39;&#39; Test the worksheet functions Sub TM5_TestWorksheetFunc() If WstCreate(&quot;Test&quot;, blnForce:=True) Then MsgBox (&quot;Created Test&quot;) If WstRename(&quot;Test&quot;, &quot;Test1&quot;) Then MsgBox (&quot;Renamed the Test to Test1&quot;) &#39; only work if no Test1 sheet If WstClear(&quot;Test8&quot;) Then MsgBox (&quot;Cleared Test8&quot;) &#39; no clearing since on sheet with that name If WstDelete(&quot;Test1&quot;) Then MsgBox (&quot;Deleted Test1&quot;) End Sub 5.5 The Range object Ranges are objects that refer to parts of a worksheet e.g. a cell, a row, a column, or a rectangular selection of cells. Ranges can be used to read and write to cells Sub TM5_RangeEx1() Dim rng As Range Dim cell As Range Dim i As Integer Call TM5_ClearTestTM5 &#39; clear test cells so have empty cells ThisWorkbook.Worksheets(&quot;TM5&quot;).Activate &#39; Modify a range to a fixed value Set rng = Range(&quot;G4:I6&quot;) rng = 145 &#39; cell value in rng MsgBox rng.Address &#39; range address &#39; Use for each to scan range (direction left-down) Set rng = Range(&quot;G8:I10&quot;) i = 1 For Each cell In rng cell = &quot;Entry &quot; &amp; i i = i + 1 Next &#39; Use Cells to set a range Set rng = Range(Cells(23, 3), Cells(25, 6)) MsgBox rng.Address End Sub The method .Address is used to return the cell address. Figure 5.1: TM5 worksheet. Similar the number of rows can by found using .rows.Count: &#39;&#39; Rows in range &#39; @param rng A range. Function RngGetRows(rng As Range) As Long RngGetRows = rng.rows.Count End Function We can also find number of columns, address of upper left cell or lower right cell etc. In the course procedures (module ModRng) all these have been defined. Let us try to use them: Sub TM5_RangeEx2() Dim rng As Range Set rng = ThisWorkbook.Worksheets(&quot;TM5&quot;).Range(&quot;C4:E19&quot;) MsgBox (&quot;Number of rows: &quot; &amp; RngGetRows(rng)) MsgBox (&quot;Number of cols: &quot; &amp; RngGetCols(rng)) MsgBox (&quot;First column number: &quot; &amp; RngGetFirstCol(rng)) MsgBox (&quot;First column letter: &quot; &amp; RngGetFirstCol(rng, asLetter:=True)) MsgBox (&quot;Lower right cell: &quot; &amp; RngGetLowerRight(rng, asString:=True)) MsgBox (&quot;Upper right cell: &quot; &amp; RngGetUpperRight(rng, asString:=True)) End Sub 5.5.1 Current region of a range An important method is the current region .CurrentRegion which expands the range until all cells surrounding the range is empty. This is very useful if don’t know the size for data. Let us make a function that return the current region: &#39;&#39; Return the current region of a range. &#39; @param rng The range to get the current region from. Function RngCurRegion(rng As Range) As Range Set RngCurRegion = rng.CurrentRegion End Function Note we have to use the Set keyword since the return value is a range (object). We can now test the course procedures starting with prefix RngGet: Sub TM5_CurrentRegionEx1() Dim rng As Range ThisWorkbook.Worksheets(&quot;TM5&quot;).Activate &#39; Try to guess the output Set rng = RngCurRegion(Range(&quot;D7&quot;)) &#39; rng now is the current region MsgBox (&quot;Address: &quot; &amp; RngGetAddress(rng)) MsgBox (&quot;Rows = &quot; &amp; RngGetRows(rng) &amp; &quot; cols = &quot; &amp; RngGetCols(rng)) MsgBox (&quot;First row number = &quot; &amp; RngGetFirstRow(rng) &amp; &quot;. Last row number = &quot; &amp; RngGetLastRow(rng) &amp; &quot;.&quot;) MsgBox (&quot;First col number = &quot; &amp; RngGetFirstCol(rng) &amp; &quot;. Last col number = &quot; &amp; RngGetLastCol(rng) &amp; &quot;.&quot;) MsgBox (&quot;First col letter = &quot; &amp; RngGetFirstCol(rng, True) &amp; &quot;. Last col letter = &quot; &amp; RngGetLastCol(rng, True) &amp; &quot;.&quot;) &#39; Try to guess the output Set rng = RngCurRegion(Range(&quot;C23&quot;)) &#39; assume we know that data contains cell C23 MsgBox (&quot;Address: &quot; &amp; RngGetAddress(rng)) End Sub The same result can be obtained using the course procedures starting with RngGetCurRegion: Sub TM5_CurrentRegionEx2() Dim rng As Range ThisWorkbook.Worksheets(&quot;TM5&quot;).Activate &#39; Try to guess the output Set rng = Range(&quot;D7&quot;) &#39; assume we know that data contains cell D7 MsgBox (&quot;Address: &quot; &amp; RngGetCurRegionAddress(rng)) MsgBox (&quot;Rows = &quot; &amp; RngGetCurRegionRows(rng) &amp; &quot; cols = &quot; &amp; RngGetCurRegionCols(rng)) MsgBox (&quot;First row number = &quot; &amp; RngGetCurRegionFirstRow(rng) &amp; &quot;. Last row number = &quot; &amp; RngGetCurRegionLastRow(rng) &amp; &quot;.&quot;) MsgBox (&quot;First col number = &quot; &amp; RngGetCurRegionFirstCol(rng) &amp; &quot;. Last col number = &quot; &amp; RngGetCurRegionLastCol(rng) &amp; &quot;.&quot;) MsgBox (&quot;First col letter = &quot; &amp; RngGetCurRegionFirstCol(rng, True) &amp; &quot;. Last col letter = &quot; &amp; RngGetCurRegionLastCol(rng, True) &amp; &quot;.&quot;) Set rng = Range(&quot;C23&quot;) &#39; assume we know that data contains cell C23 MsgBox (&quot;Address: &quot; &amp; RngGetCurRegionAddress(rng)) End Sub Note the difference in how rng is defined. 5.5.2 Input and output You can read/write and copy/paste values to a range using the course procedures: Sub TM5_RangeEx3() Dim rng As Range Dim rngNew As Range Set rng = RngCurRegion(Range(&quot;D7&quot;)) &#39; get current region MsgBox (&quot;Copy to H14 (upper left corner).&quot;) Set rngNew = RngPaste(rng, Range(&quot;H14&quot;)) &#39; rngNew is now the new range MsgBox (&quot;Make yellow.&quot;) Call RngFormat(rngNew, &quot;yellow&quot;) MsgBox (&quot;Remove format.&quot;) Call RngClear(rngNew, blnCells:=False, blnFormat:=True) MsgBox (&quot;Clear range.&quot;) Call RngClear(rngNew) End Sub Here RngPaste is used to copy a range and paste it to another range. Note you may use RngFormat to format cells of a range. Moreover, you can read/write values from/to a csv file. A comma-separated values (csv) file is a delimited text file that uses a delimiter to separate values. Each line of the file is a data record. Each record consists of one or more fields, separated by the delimiter. The file format is not fully standardized, i.e. the delimiter may be a semicolon, a colon or another delimiter. Moreover, a field may be surrounded with quotation marks. Let us have a look at a csv file data1.csv with a header using a semicolon as delimiter: Year;Brand;Model 1997;Ford;E350 2000;Mercury;Cougar and the csv file data2.csv without a header using a semicolon as delimiter: 55,18,34,1,81,26,90,11,46,32,93 49,95,73,82,53,40,99,10,52,38,92 59,90,97,100,59,73,88,33,78,61,24 96,84,32,36,94,82,49,94,48,49,1 59,21,24,57,3,78,54,79,57,42,8 Let us try to read the two files: Sub TM5_RngFromCSVEx() Dim rng As Range ThisWorkbook.Worksheets(&quot;TM5&quot;).Activate Call TM5_ClearTestTM5 &#39; clear test cells so have empty cells &#39;&#39; Read data1.csv file (NOTE you must know the separator in the csv file beforehand!) Range(&quot;G3&quot;) = &quot;Content of data1.csv:&quot; Set rng = RngFromCSV(&quot;data1.csv&quot;, Range(&quot;G4&quot;), &quot;;&quot;) &#39; paste file in range with upper left cell G4 MsgBox (RngGetAddress(rng)) &#39;&#39; Read data2.csv file (NOTE you must know the separator in the csv file beforehand!) Range(&quot;G8&quot;) = &quot;Content of data2.csv:&quot; Set rng = RngFromCSV(&quot;data2.csv&quot;, Range(&quot;G9&quot;), &quot;,&quot;) &#39; paste file in range with upper left cell G9 MsgBox (RngGetAddress(rng)) End Sub Here we use the course procedure RngFromCSV to read the file and specify the upper left corner cell of where to paste. Note the function returns the pasted range. You can write the content of a range to a csv file using: Sub TM5_RngToCSVEx() Dim rng As Range ThisWorkbook.Worksheets(&quot;TM5&quot;).Activate Call TM5_ClearTestTM5 &#39; clear test cells so have empty cells &#39;&#39; Write to csv file Set rng = Range(&quot;C4:E19&quot;) Call RngToCSV(&quot;test.csv&quot;, rng, &quot;;&quot;) &#39; semicolon (;) separated file &#39;&#39; Read test.csv file to check Range(&quot;G3&quot;) = &quot;Content of test.csv:&quot; Set rng = RngFromCSV(&quot;test.csv&quot;, Range(&quot;G4&quot;), &quot;;&quot;) End Sub Here we use the course procedure RngToCSV to write the range to the file. Note you can specify different delimiters (here we use a semicolon). 5.5.3 Sorting a range Ranges can be sorted using the .Sort method: Sub TM5_SortRangeEx() Dim rng As Range Dim rngCur As Range ThisWorkbook.Worksheets(&quot;TM5&quot;).Activate Call TM5_ClearTestTM5 &#39; clear test cells so have empty cells Set rng = RngCurRegion(Range(&quot;C4&quot;)) &#39;&#39; Sort based on second column ascending Set rngCur = RngPaste(rng, Range(&quot;G4&quot;), withFormat:=True) &#39; make a copy to work with Call rngCur.Sort(Key1:=rngCur.Columns(2), Header:=xlYes) rngCur(1).Offset(-1, 0) = &quot;Sort 2. column&quot; &#39; offset first cell in range by -1 row and 0 col &#39;&#39; Sort based on second column and afterwards 3. column (descending) Set rngCur = RngPaste(rng, Range(&quot;K4&quot;), True) Call rngCur.Sort(Key1:=rngCur.Columns(2), Header:=xlYes, Key2:=rngCur.Columns(3), Order2:=xlDescending) rngCur(1).Offset(-1, 0) = &quot;Sort 2. and next 3. column&quot; End Sub We use the Key arguments to identify which columns we want to sort and the Header argument to identify if the first row in the range is a header. Finally the ordering is given using the Order argument (either xlAscending (default) or xlDescending). 5.6 Arrays Arrays are used to store groups of variables of a specific datatype: &#39;&#39; Define an array (run using the debugger - step into) &#39; How to check the content of an array? &#39; Use the Locals window together with debug mode or a message box Sub TM5_ArrayEx1() Dim intAry(4) As Integer &#39; define array with index 0-4 Dim strAry(3 To 5) As String &#39; define array with index 3-5 Dim i As Integer &#39; Set values intAry(0) = 9 intAry(1) = 12 intAry(2) = 222 intAry(3) = 4 intAry(4) = 100 &#39; Information about the array MsgBox (&quot;Lowest index: &quot; &amp; LBound(intAry)) MsgBox (&quot;Largest index: &quot; &amp; UBound(intAry)) MsgBox (&quot;Number of elements: &quot; &amp; UBound(intAry) - LBound(intAry) + 1) MsgBox (&quot;Array as a string: &quot; &amp; AryToStr(intAry)) &#39; Read and assign values For i = 3 To 5 strAry(i) = ThisWorkbook.Worksheets(&quot;TM5&quot;).Cells(23 + i, 3) Next MsgBox (&quot;Array values: &quot; &amp; AryToStr(strAry)) End Sub Array intAry contain 5 elements which can be accessed using index 0, 1, 2, …, 4. In memory this is done by allocating memory for 5 integers (see Figure 5.2) with index 0-4. The lower and upper index bounds can be found using LBound and UBound and we can use the course procedure AryToStr to print it. Figure 5.2: An array in memory. Note the default start index is 0. If you want another start index you can use e.g. Dim strAry(3 To 5) As String which use indices 3-5 (\\(3 = 5-3+1\\) elements). Moreover, if you want to start with index 1 as default then add Option Base 1 to the top of your module. Arrays require 20 bytes of memory plus 4 bytes for each array dimension plus the number of bytes occupied by the data itself. A Variant containing an array requires 12 bytes more than the array alone. 5.6.1 Multi-dimensional arrays Figure 5.3: Arrays with different dimensions. An array can have different dimensions (see Figure 5.3) e.g. and array with three dimensions is declared using: Dim intOrderSize(52, 100, 50) As Integer where indices may be (week, customer, product) number. Let us assume that index start from 1 then we have an array with \\(52 \\cdot 100 \\cdot 50\\) elements which can be accessed using e.g. MsgBox(intOrderSize(2, 10, 20)) &#39; order size week 2, customer 10, product 20 Let us consider an example: Sub TM5_MultiDimArrayEx() Dim intA(20, 10) As Integer Dim i As Integer, j As Integer ThisWorkbook.Worksheets(&quot;TM5&quot;).Activate Call TM5_ClearTestTM5 &#39; clear test cells so have empty cells &#39; Assign some values For i = LBound(intA, 1) To UBound(intA, 1) For j = LBound(intA, 2) To UBound(intA, 2) intA(i, j) = WorksheetFunction.RandBetween(1, 1000) Next Next &#39; print results from G4 For i = LBound(intA, 1) To UBound(intA, 1) For j = LBound(intA, 2) To UBound(intA, 2) Cells(i + 4, j + 7) = intA(i, j) Next Next &#39; Call AryPaste(intA, Range(&quot;G4&quot;)) &#39; same result End Sub We first assign random values to intA in the first loop. Note we use LBound and UBound to find the range of the indices (the second argument is the dimension we consider). Next, the results are printed to the sheet with upper left equal to G4. Here you may also have used the course procedure AryPaste instead. 5.6.2 Dynamic arrays Often we do not know the size of the array we need when we start the program. For this we use dynamic arrays: Sub TM5_DynArrayEx() Dim ary() As String &#39; dynamic array, note use empty () Dim i As Integer ThisWorkbook.Worksheets(&quot;TM5_Test3&quot;).Activate ReDim ary(2 To 5) &#39; create entries a(2) to a(5) For i = 2 To 5 ary(i) = Cells(i + 1, 1) &#39; read from Array sheet Next MsgBox (&quot;Values are: &quot; &amp; AryToStr(ary)) MsgBox (&quot;The lowest and higest index are &quot; &amp; LBound(ary) &amp; &quot; and &quot; &amp; UBound(ary)) ReDim ary(3 To 5) &#39; reallocate array, all values are set to default (empty string) MsgBox (&quot;Values are: &quot; &amp; AryToStr(ary)) For i = 3 To 5 ary(i) = Cells(i + 1, 1) Next MsgBox (&quot;Values are: &quot; &amp; AryToStr(ary)) MsgBox (&quot;The lowest and higest index are &quot; &amp; LBound(ary) &amp; &quot; and &quot; &amp; UBound(ary)) End Sub First, the dynamic array is declared using empty parenthesis Dim ary() As String. Next the ReDim keyword is used to set the dimension. 5.6.3 Input and output A set of course procedures (module ModAry) have been defined to read/set the values in an array and output the values of an array: Sub TM5_IOAryEx() Dim ary() As Integer Dim strAry() As String ThisWorkbook.Worksheets(&quot;TM5&quot;).Activate Call TM5_ClearTestTM5 &#39;&#39; Set to value single value ReDim ary(2) Call AryToVal(ary, 5) Range(&quot;G4&quot;) = &quot;A fixed value:&quot; Call AryPaste(ary, Range(&quot;G5&quot;)) &#39; the upper left cell is G5 &#39;&#39; Paste vertical Range(&quot;K4&quot;) = &quot;Paste vertical:&quot; Call AryPaste(ary, Range(&quot;K5&quot;), False) &#39;&#39; Set to sequence Call AryToSeq(ary, 1, 6) Range(&quot;G10&quot;) = &quot;A sequence:&quot; Call AryPaste(ary, Range(&quot;G11&quot;)) &#39;&#39; Read strings from a range Call AryRead(strAry, Range(&quot;C31:D33&quot;)) &#39; read a 2D array Range(&quot;G31&quot;) = &quot;Names in the &quot; &amp; AryDim(strAry) &amp; &quot;D array:&quot; Call AryPaste(strAry, Range(&quot;G32&quot;)) End Sub You set all entries in the array to a single value using AryToVal and a sequence using AryToSeq. Moreover, use AryRead to read the values of a range into an array. Finally, AryPaste can be used to paste values of an array to a sheet. You just have to specify the upper left cell where you want to paste. Procedure AryRead can both read values into 1D and 2D arrays: Sub TM5_AryReadEx() Dim ary() As Integer ThisWorkbook.Worksheets(&quot;TM5&quot;).Activate Call TM5_ClearTestTM5 &#39;&#39; Read values from a range with only 1 column Call AryRead(ary, Range(&quot;C5:C9&quot;)) Range(&quot;G4&quot;) = AryDim(ary) &amp; &quot;D array:&quot; Call AryPaste(ary, Range(&quot;G5&quot;), False) &#39;&#39; Read values from a range with only 1 row Call AryRead(ary, Range(&quot;C5:E5&quot;)) Range(&quot;I4&quot;) = AryDim(ary) &amp; &quot;D array:&quot; Call AryPaste(ary, Range(&quot;I5&quot;)) &#39;&#39; Read values from a range with only 1 column/row but use 2D array Call AryRead(ary, Range(&quot;C11:C14&quot;), blnReduceDim:=False) Range(&quot;G10&quot;) = AryDim(ary) &amp; &quot;D array:&quot; Call AryPaste(ary, Range(&quot;G11&quot;), False) &#39;&#39; Use other start and end index Call AryRead(ary, Range(&quot;C17:E19&quot;), intStartIdx1:=2, intStartIdx2:=5) Range(&quot;G16&quot;) = AryDim(ary) &amp; &quot;D array with start index &quot; &amp; LBound(ary, 1) &amp; &quot; and &quot; &amp; LBound(ary, 2) &amp; &quot;:&quot; Call AryPaste(ary, Range(&quot;G17&quot;)) End Sub First, note that if the optional argument blnReduceDim is not set to false the array automatically becomes a 1D array if a range with one row or column is read. Next, you can use another start index of the array (default is 1) by specifying the optional arguments intStartIdx1 and intStartIdx2. Procedure AryRead fails if we want to set values for arrays with more than 2 dimensions. For this the AryReadLong can be used which can read arrays until five dimensions: Sub TM5_AryReadLongEx() Dim ary() As Integer ThisWorkbook.Worksheets(&quot;TM5&quot;).Activate Call TM5_ClearTestTM5 &#39;&#39; Read 1D array Call AryReadLong(ary, Range(&quot;A36:B38&quot;), 3) &#39; default value = 3 Range(&quot;G35&quot;) = &quot;Values in the &quot; &amp; AryDim(ary) &amp; &quot;D array:&quot; Call AryPaste(ary, Range(&quot;G36&quot;)) &#39;&#39; Read 2D array Call AryReadLong(ary, Range(&quot;A41:C47&quot;), 4) &#39; default value = 4 Range(&quot;G40&quot;) = &quot;Values in the &quot; &amp; AryDim(ary) &amp; &quot;D array:&quot; Call AryPaste(ary, Range(&quot;G41&quot;)) &#39;&#39; Read 3D array (cannot be pasted to the sheet, have a look at it using the debugger) Call AryReadLong(ary, Range(&quot;A50:D56&quot;), 5) &#39; default value = 5 End Sub Procedure AryReadLong assumes that you specify the values in long format, i.e. there is index values in all columns except the last which contains the values (see Figure 5.4). For instance, if we consider row 54, then the specification says that ary(1,3,1) = 49. Note we do not have to specify all combination of indices, e.g. in the specification A41:C47 the index (2,4) is missing and set to the default value 4. It is assumed that indices start from the lowest to highest index in each dimension. Figure 5.4: Reading values to an array using a long format (TM5 worksheet). You can also read a csv file into an array. Let us have a look at a csv file data2.csv using a semicolon as delimiter: 55,18,34,1,81,26,90,11,46,32,93 49,95,73,82,53,40,99,10,52,38,92 59,90,97,100,59,73,88,33,78,61,24 96,84,32,36,94,82,49,94,48,49,1 59,21,24,57,3,78,54,79,57,42,8 You can read the values into an array using AryFromCSV: Sub TM5_AryReadCSVEx() Dim rng As Range Dim ary() As Integer ThisWorkbook.Worksheets(&quot;TM5&quot;).Activate Call TM5_ClearTestTM5 &#39;&#39; Read csv file (NOTE you must know the separator in the csv file beforehand!) Range(&quot;G3&quot;) = &quot;Array values:&quot; Call AryFromCSV(ary, &quot;data2.csv&quot;, &quot;,&quot;) &#39; know that it contains integers (otherwise use variant) Call AryPaste(ary, Range(&quot;G4&quot;)) End Sub 5.6.4 Sorting arrays Arrays can be sorted using AryQuickSort: Sub TM5_ArySortEx() Dim ary() As Integer ThisWorkbook.Worksheets(&quot;TM5&quot;).Activate Call TM5_ClearTestTM5 &#39;&#39; Read from a range and sort Call AryRead(ary, Range(&quot;C5:E19&quot;)) Call AryQuickSort(ary, 2) Range(&quot;G3&quot;) = &quot;Sort w.r.t. 2. column:&quot; Call RngPaste(Range(&quot;C4:E4&quot;), Range(&quot;G4&quot;)) &#39; copy header Call AryPaste(ary, Range(&quot;G5&quot;)) End Sub Here we sort based on the 2. column in the array. 5.6.5 Use arrays instead of ranges Since a range represent a block of cells in a sheet, one may think of a range a some kind of 1D or 2D array. Hence one may use a range directly to read/write values instead of an array (we did that in Section 4.7). However, often arrays are better to use than ranges: You can set indices as you like so they give a meaning to you, e.g. intOrderSize(2, 10, 20) denote the order size of product 20, in week 2 for customer 10. Arrays are much faster to update that ranges. It is much faster to update the values many times in an array compared to a range. You worksheet and ranges may be seen as a place where you keep your data. Hence, when you run an algorithm, you first read the data into some arrays. Next, do some calculations (update the arrays) and finally output the result to a worksheet again. Consider for example the distance matrix calculations in Section 3.6. Here it would be faster to store the distance matrix in a 2D array: Sub TM5_MakeDistArray() Dim n As Integer Dim aryDist() As Double Dim i As Integer Dim j As Integer ThisWorkbook.Worksheets(&quot;TM3_DistanceMatrix&quot;).Activate n = Range(&quot;E1&quot;) ReDim aryDist(1 To n, 1 To n) For i = 1 To n For j = i + 1 To n aryDist(i, j) = TM3_Distance(Cells(i + 1, 2), Cells(i + 1, 3), Cells(j + 1, 2), Cells(j + 1, 3)) aryDist(j, i) = aryDist(i, j) &#39; set symetric value Next Next End Sub Afterwards aryDist can be used during in an algorithm. 5.7 Collections Collections are a way of storing a group of items together (think of it as a set). Collections and arrays are both used to group variables. They both store a set of items e.g. a list of student marks or country names. If we compare collections against arrays: Collections are similar to arrays but better to use when the number of items is not fixed. With an array you normally set the size once. On the contrary you often add or remove items from a collection. Collections are better when adding and removing items. An item in a collection are read-only whereas an entry in an array are read/write. Collection can be accessed using a key or an index (starting from 1). Items of a collection do not have to share the same data type. Collections are a part of the predefined objects in VBA and hence a collection have to be defined in a special way. Let us consider an example: Sub TM5_CollEx() Dim col As New Collection &#39; declare and create Dim e As Variant ThisWorkbook.Worksheets(&quot;TM5&quot;).Activate Call TM5_ClearTestTM5 &#39;&#39; Add items Call col.Add(&quot;Apple&quot;) Call col.Add(&quot;Pear&quot;) Call col.Add(123) Cells(4, 7) = &quot;The collection now contains &quot; &amp; col.Count &amp; &quot; items: &quot; &amp; Coll2Str(col) &#39;&#39; Use For Each to scan elements For Each e In col MsgBox (e) Next e &#39;&#39; Access values in the collection using index Cells(5, 7) = &quot;The 1. item is: &quot; &amp; col(1) Cells(6, 7) = &quot;The 3. item is: &quot; &amp; col(3) &#39; Remove items Call col.Remove(2) Cells(7, 7) = &quot;The collection now contains &quot; &amp; col.Count &amp; &quot; items: &quot; &amp; Coll2Str(col) &#39;&#39; Note index of items has now changed (the 3. item has become the 2. item) Cells(8, 7) = &quot;The 1. item is: &quot; &amp; col(1) Cells(9, 7) = &quot;The 2. item is: &quot; &amp; col(2) &#39;&#39; Clear collection Set col = Nothing Cells(10, 7) = &quot;The collection now contains &quot; &amp; col.Count &amp; &quot; items.&quot; End Sub First we declare and create a collection: Dim col As New Collection The collection (or set) is now defined with zero items. You can add items using Call col.Add(&quot;Apple&quot;) Call col.Add(&quot;Pear&quot;) Call col.Add(123) Let us create a function that prints the items of a collection as string: Function Coll2Str(col As Collection, Optional strSep As String = &quot;, &quot;) As String Dim e As Variant Dim str As String For Each e In col str = str &amp; e &amp; strSep Next e Coll2Str = Left(str, Len(str) - Len(strSep)) End Function Then the output of &quot;The collection now contains &quot; &amp; col.Count &amp; &quot; items: &quot; &amp; Coll2Str(col) becomes The collection now contains 3 items: Apple, Pear, 123 You can access values in the collection using index: &quot;The 1. item is: &quot; &amp; col(1) &quot;The 3. item is: &quot; &amp; col(3) The 1. item is: Apple The 3. item is: 123 Items are removed using: Call col.Remove (2) &quot;The collection now contains &quot; &amp; col.Count &amp; &quot; items: &quot; &amp; Coll2Str(col) The collection now contains 2 items: Apple, 123 Note index of items has now changed (the 3. item has become the 2. item): &quot;The 1. item is: &quot; &amp; col(1) &quot;The 2. item is: &quot; &amp; col(2) The 1. item is: Apple The 2. item is: 123 You clear a collection using: Set col = Nothing &quot;The collection now contains &quot; &amp; col.Count &amp; &quot; items.&quot; The collection now contains 0 items. An item in a collection can be given a key (think af a key as a name tag given to each item): Sub TM5_CollKeyEx() Dim col As New Collection &#39; declare and create Dim k As Variant ThisWorkbook.Worksheets(&quot;TM5&quot;).Activate &#39;&#39; Add using keys Call col.Add(&quot;Hans Jørgensen&quot;, &quot;ID123&quot;) &#39; value, key Call col.Add(&quot;Jens Hansen&quot;, &quot;ID234&quot;) Call col.Add(&quot;Lone Nielsen&quot;, &quot;ID456&quot;) &#39; col.Add &quot;Sine Mikkelsen&quot;, &quot;ID456&quot; &#39; gives an error since already used the key Cells(12, 7) = &quot;The collection now contains &quot; &amp; col.Count &amp; &quot; items: &quot; &amp; Coll2Str(col) &#39;&#39; Access values using keys Cells(13, 7) = &quot;The item with key ID123 is: &quot; &amp; col(&quot;ID123&quot;) &#39; Remove items using keys col.Remove &quot;ID123&quot; Cells(14, 7) = &quot;The collection now contains &quot; &amp; col.Count &amp; &quot; items: &quot; &amp; Coll2Str(col) End Sub Here we add items using a key: Call col.Add(&quot;Hans Jørgensen&quot;, &quot;ID123&quot;) &#39; value, key Call col.Add(&quot;Jens Hansen&quot;, &quot;ID234&quot;) Call col.Add(&quot;Lone Nielsen&quot;, &quot;ID456&quot;) &quot;The collection now contains &quot; &amp; col.Count &amp; &quot; items: &quot; &amp; Coll2Str(col) The collection now contains 3 items: Hans Jørgensen, Jens Hansen, Lone Nielsen You can now access the item using the key: &quot;The item with key ID123 is: &quot; &amp; col(&quot;ID123&quot;) The item with key ID123 is: Hans Jørgensen Similar you can remove an item using a key: Call col.Remove(&quot;ID123&quot;) &quot;The collection now contains &quot; &amp; col.Count &amp; &quot; items: &quot; &amp; Coll2Str(col) The collection now contains 2 items: Jens Hansen, Lone Nielsen It is recommended to use keys since using keys has three advantages: If the order changes your code will still access the correct item You can directly access the item without reading through the entire collection It can make you code more readable For more information about collections you may have a look at this webpage. 5.8 Example - Job sequencing Consider \\(i = 1,...,n\\) jobs that has to be done on a machine and let \\(c_{ij}\\) denote the setup cost of switching from job \\(i\\) to job \\(j\\). Moreover, let \\(c_{0i}\\) denote the setup cost of setting up job \\(i\\) when the machine is idle (index 0). Let \\(s = (0, s_1, \\ldots, s_n)\\) denote the sequence of jobs and \\(C\\) the total setup costs, e.g. if \\(s = (0,1,3,2,6,5,4)\\), then \\(C = c_{01} + c_{13} + c_{32} + c_{26} + c_{65} + c_{54}\\). Different algorithms for finding a good strategy minimizing the total setup costs exists. A greedy algorithm is: Step 0: Select the first job as one with minimal idle setup cost. Step 1: Given current job \\(i\\) select the unscheduled with minimal setup cost. Step 2: If no unscheduled jobs then stop and output the found job sequence else go to Step 1. Often a better algorithm is: Step 0: For each column \\(j\\) find \\(\\bar{c}_j = min(c_{0j},\\ldots,c_{j-1,j},c_{j+1,j},\\ldots,c_{nj})\\) and define relative setup costs \\(\\hat{c}_{ij} = c_{ij}-\\bar{c}_{j}\\) (the cost is subtracted the minimum value in that column). Step 1: Call the greedy algorithm using costs \\(\\hat{c}_{ij}\\). Examples on how data could look like can be seen in worksheet TM5_JobSeq that contains the setup costs (Figure 5.5). Columns M-T contain three datasets for which we want to calculate a job sequence. Figure 5.5: Worksheet TM5_JobSeq. Let us try to implement the greedy algorithm which takes the cost array costs as arguments and output the job sequence and cost: &#39;&#39; Job sequeceing using a cost array &#39; &#39; @param costs An array with setup costs &#39; @param strSeq The job sequence found (returned ByRef). &#39; @param dblCosts The total setup costs (returned ByRef). Sub TM5_GreedyAlg(costs() As Double, strSeq As String, dblCosts As Double) Dim intJobs As Integer &#39; number of jobs Dim used() As Integer &#39; an entry equals 1 if already scheduled Dim intCurJob As Integer &#39; current job Dim intNextJob As Integer &#39; best candidate for next job (= intM if not found yet) Dim dblNextCost As Double &#39; setup cost current to next job Dim c As Integer &#39; iterators Dim intM As Integer &#39; big number &#39;&#39; Allocate arrays intJobs = UBound(costs, 1) ReDim used(1 To intJobs) &#39; set size Call AryToVal(used, 0) &#39; set to 0 &#39;&#39; Run greedy strSeq = &quot;0&quot; &#39; start idle intM = 1000 &#39; a number bigger than largest cost intCurJob = 0 &#39; start idle dblCosts = 0 Do While True &#39; find next job given current intNextJob = intM dblNextCost = intM For c = 1 To intJobs &#39; scan row in array to find next unused job with minimal cost If used(c) &lt;&gt; 1 And costs(intCurJob, c) &lt; dblNextCost Then intNextJob = c dblNextCost = costs(intCurJob, c) End If Next If intNextJob = intM Then Exit Do &#39; no new job found (all jobs used) dblCosts = dblCosts + dblNextCost used(intNextJob) = 1 intCurJob = intNextJob strSeq = strSeq &amp; &quot;, &quot; &amp; intNextJob Loop End Sub First observe that the procedure have three arguments costs, strSeq and dblCosts. The array costs contain the setup costs and is an input argument to the algorithm. The last two arguments are output arguments. Since arguments are passed by reference by default (no new memory is allocated), we modify them with the solution. Next, to run the algorithm we need to keep track of which jobs have been used. We use the array used for this and set it to 0 (not used) and 1 (used). Finally, the Do While loop is used to scan a row in the cost array. We want to find the minimum cost and hence use a big number as starting value, then scan all unused jobs and choose the one with minimum cost. If no new job is found we finish; otherwise we update strSeq and dblCosts. Note that the procedure do not have any interaction with a worksheet. It simply takes an array as input argument and store the result in two output arguments. That is, the procedure is independent of where the data is from (could e.g. be an csv file instead of a worksheet). Let us try to link the greedy algorithm to the data in workheet TM5_JobSeq. Columns M-T contain three datasets for which we want to calculate a job sequence. First, let us make a procedure that copies a dataset to A4 (upper left cell): Sub TM5_CopyData() Dim str As String ThisWorkbook.Worksheets(&quot;TM5_JobSeq&quot;).Activate &#39; so use the correct sheet str = InputBox(&quot;Specify cell in data (e.g. N7)&quot;) &#39; get a cell value Call TM5_CleanJobSeq &#39; delete previous data Call RngPaste(RngCurRegion(Range(str)), Range(&quot;A4&quot;), withFormat:=True) &#39; paste the current region End Sub Note we use the current region of the cell value to retrieve the dataset. We can now run the greedy algorithm using the data starting in A4: Sub TM5_RunGreedy() Dim costs() As Double &#39; setup costs Dim strSeq As String &#39; job seq Dim dblCosts As Double &#39; total setup costs Dim rng As Range ThisWorkbook.Worksheets(&quot;TM5_JobSeq&quot;).Activate &#39; Allocate costs to array Set rng = RngCurRegion(Range(&quot;A4&quot;)) &#39; rng now is the whole dataset with headers Set rng = Range(&quot;B5:&quot; &amp; RngGetLastCol(rng, asLetter:=True) &amp; RngGetLastRow(rng)) &#39; rng now is the costs Call AryRead(costs, rng, 0, 1) &#39; start index from 0 (first dim) and 1 (second dim) &#39; Run algorithm Call TM5_GreedyAlg(costs, strSeq, dblCosts) &#39; Write results to sheet Range(&quot;C1&quot;) = UBound(costs, 1) Range(&quot;C2&quot;) = strSeq Range(&quot;F1&quot;) = dblCosts End Sub First, observe how we allocate values to the ‘costs’ array. We use the course procedure AryRead and hence first have to find the range containing the setup costs. This can be done may ways, but we know that the upper left cell is B5 and the lower right is found using the RngGet functions. Next, we call AryRead and set the index to start from 0 (first dimension) and 1 (second dimension). Given setup costs, we call the greedy algorithm which returns updated strSeq and dblCosts. Finally, we output the results to the worksheet. To implement the ‘better’ algorithm we need to modify the costs array and subtract the minimum column value: Sub TM5_RunBetter() Dim minCol() As Double &#39; min value in col c Dim intJobs As Integer &#39; number of jobs Dim costs() As Double &#39; setup costs Dim strSeq As String &#39; job seq Dim dblCosts As Double &#39; total setup costs Dim rng As Range Dim dbl As Double Dim r As Integer, c As Integer ThisWorkbook.Worksheets(&quot;TM5_JobSeq&quot;).Activate &#39; Allocate costs to array Set rng = RngCurRegion(Range(&quot;A4&quot;)) &#39; rng now is the whole dataset with headers Set rng = Range(&quot;B5:&quot; &amp; RngGetLastCol(rng, asLetter:=True) &amp; RngGetLastRow(rng)) &#39; rng now is the costs Call AryRead(costs, rng, 0, 1) &#39; start index from 0 (first dim) and 1 (second dim) &#39; Calc min value in each col intJobs = UBound(costs, 1) ReDim minCol(1 To intJobs) For c = 1 To intJobs dbl = 10000000 &#39; a big number For r = 0 To intJobs If costs(r, c) &lt; dbl And r &lt;&gt; c Then dbl = costs(r, c) Next minCol(c) = dbl Next &#39; Calc relative For c = 1 To intJobs For r = 0 To intJobs costs(r, c) = costs(r, c) - minCol(c) Next Next &#39; Run algorithm Call TM5_GreedyAlg(costs, strSeq, dblCosts) &#39; Write results to sheet Range(&quot;C1&quot;) = intJobs Range(&quot;C2&quot;) = strSeq Range(&quot;F1&quot;) = dblCosts + WorksheetFunction.Sum(minCol) End Sub First, an array minCol is used to store the minimum values for each column. Next, we update the costs array with the relative values and the greedy algorithm is run with the relative setup cost values. Finally, we output the results. Note we have to add the minimum costs back to dblCosts (the sum of the minCol values). 5.9 Recap Variables are used to store information that is saved in memory. A variable may store different data types such an integer, a double, a group of doubles (an array), a range of cells in a worksheet (a range object) or a set of numbers (a collection). Strings are special variables with varying length. Use the &amp; to concatenate strings (glue strings together). An empty string is of length zero. VBA have a lot of predefined objects you can use. Think of an object as a datatype that holds a group of variables. Examples of some objects are Range, Worksheet, and WorksheetFunction. Refer to an object by specifying the path in the hierarchy e.g.  Workbooks(&quot;Jobs.xlsm&quot;).Worksheets(&quot;Data values&quot;).Range(&quot;D4&quot;).value You may skip parts of the path (VBA then uses the current active one). Warning, you must know which sheet is active. Always specify what you want to be active ThisWorkbook.Worksheets(&quot;Data values&quot;).Activate &#39; activate the sheet dbl = Range(&quot;D4&quot;) Declare object variables using: Dim rng As Range Dim wst As Worksheet Set a reference to object variables using the keyword Set: Set rng = Range(&quot;F7&quot;) Set wst = Worksheets(&quot;Data values&quot;) A Worksheet object refer to a worksheet and you can use it to e.g. modify cells: Worksheets(&quot;TM5_Test1&quot;).Range(&quot;B2&quot;) = &quot;Testing Worksheet&quot; &#39; write to cell in sheet TM5_Test1 Set wst1 = ThisWorkbook.Worksheets(&quot;TM5_Test1&quot;) &#39; set a reference to a worksheet wst1.Range(&quot;B6&quot;) = &quot;Writing using wst1&quot; Different functions for worksheets is part of the course procedures. All the worksheet procedures start with Wst so you easy can find them using auto complete in the VBA editor. All worksheet procedures are stored in the ModWst module. You may open the module to have a look at the procedures. Examples: If WstCreate(&quot;Test&quot;, blnForce:=True) Then MsgBox (&quot;Created Test&quot;) If WstRename(&quot;Test&quot;, &quot;Test1&quot;) Then MsgBox (&quot;Renamed the Test to Test1&quot;) &#39; only work if no Test1 sheet If WstClear(&quot;Test8&quot;) Then MsgBox (&quot;Cleared Test8&quot;) &#39; clear sheet Test8 if exists If WstDelete(&quot;Test1&quot;) Then MsgBox (&quot;Deleted Test1&quot;) Ranges are objects that refer to parts of a worksheet e.g. a cell, a row, a column, or a rectangular selection of cells. Ranges can be used to read and write to cells Dim rng As Range Set rng = Range(&quot;A1:D5&quot;) rng = 145 &#39; cell value MsgBox rng.Address &#39; range address ($A$1:$D$5) You can use the course procedures (module ModRng) with prefix RngGet to retrieve info about the range: Set rng = ThisWorkbook.Worksheets(&quot;TM5&quot;).Range(&quot;C4:E19&quot;) MsgBox (&quot;Number of rows: &quot; &amp; RngGetRows(rng)) MsgBox (&quot;Number of cols: &quot; &amp; RngGetCols(rng)) MsgBox (&quot;First column number: &quot; &amp; RngGetFirstCol(rng)) MsgBox (&quot;First column letter: &quot; &amp; RngGetFirstCol(rng, asLetter:=True)) MsgBox (&quot;Lower right cell: &quot; &amp; RngGetLowerRight(rng, asString:=True)) MsgBox (&quot;Upper right cell: &quot; &amp; RngGetUpperRight(rng, asString:=True)) The current region of a range is found by expanding the range until all cells surrounding the range is empty rng = Range(&quot;D23&quot;).CurrentRegion This is useful if don’t know the size for data. You can use the course procedures (module ModRng) with prefix RngGetCurRegion to retrieve info about the current region of a range: Set rng = Range(&quot;D7&quot;) &#39; assume we know that data contains cell D7 MsgBox (&quot;Address: &quot; &amp; RngGetCurRegionAddress(rng)) MsgBox (&quot;Rows = &quot; &amp; RngGetCurRegionRows(rng) &amp; &quot; cols = &quot; &amp; RngGetCurRegionCols(rng)) MsgBox (&quot;First row number = &quot; &amp; RngGetCurRegionFirstRow(rng) &amp; &quot;. Last row number = &quot; &amp; RngGetCurRegionLastRow(rng) &amp; &quot;.&quot;) MsgBox (&quot;First col number = &quot; &amp; RngGetCurRegionFirstCol(rng) &amp; &quot;. Last col number = &quot; &amp; RngGetCurRegionLastCol(rng) &amp; &quot;.&quot;) MsgBox (&quot;First col letter = &quot; &amp; RngGetCurRegionFirstCol(rng, True) &amp; &quot;. Last col letter = &quot; &amp; RngGetCurRegionLastCol(rng, True) &amp; &quot;.&quot;) You copy/paste a range using: Set rng = Range(&quot;D7:E10&quot;) Set rngNew = RngPaste(rng, Range(&quot;H14&quot;)) &#39; paste with upper left = H14, rngNew is now the new range You can read values from a csv file using: Set rng = RngFromCSV(&quot;data1.csv&quot;, Range(&quot;G4&quot;), &quot;;&quot;) &#39; paste file in range with upper left cell G4 You can write values from a range to a csv file using: Call RngToCSV(&quot;test.csv&quot;, rng, &quot;;&quot;) &#39; semicolon (;) separated file The columns in a range can be sorted. For instance sort a range ascending with respect to the second column and next descending with respect to the first column. Call rng.Sort(Key1:=rng.Columns(2), Order1:=xlAscending, _ Key2:=rng.Columns(1), Order2:=xlDescending, Header:=xlYes) An array store groups of variables of a specific data type. For example Dim intValues(8) As Integer The variable intValues is an array with 9 elements which can be accessed using index 0, 1, 2, …, 8. The default start index of an array is 0. If you want to start with index 1 then add Option Base 1 to the top of your module or use: Dim strAry(3 To 5) As String &#39; define array with index 3-5 An array can have different dimensions, e.g. three: Dim intOrderSize(52, 100, 50) As Integer where indices may be (week, customer, product) number. Let us assume that index start from 1 then we have an array with \\(52 \\cdot 100 \\cdot 50\\) elements which can be accessed using e.g. intOrderSize(2,10, 20) &#39; order size week 2, customer 10, product 20 Arrays require 20 bytes of memory plus 4 bytes for each array dimension plus the number of bytes occupied by the data itself. A Variant containing an array requires 12 bytes more than the array alone. Dynamic arrays are arrays where the dimension is unknown when they are declared. Use ReDim to set the dimension later: Dim strPeople() As String ... n = 8 ReDim strPeople(n) You can set values for an array by reading from a range: Dim ary() As Integer Call AryRead(ary, Range(&quot;C5:E9&quot;)) You can paste values of an array to a range: Call AryPaste(ary, Range(&quot;G5&quot;)) &#39; the upper left cell is G5 You can set values for an array with more than 2 dimensions by reading from a range: Dim ary() As Integer Call AryReadLong(ary, Range(&quot;A36:B38&quot;), 3) &#39; default value = 3 The procedure AryReadLong assumes that you specify the values in long format, i.e. there is index values in all columns except the last which contains the values. You can read a csv file into an array using: Dim ary() As Integer Call AryFromCSV(ary, &quot;data2.csv&quot;, &quot;,&quot;) &#39; know that it contains integers (otherwise use variant) Arrays can be sorted using: Dim ary() As Integer Call AryQuickSort(ary, 2) &#39; sort w.r.t. 2. column Often arrays are better to use than ranges: You can set indices as you like so they give a meaning to you, e.g. intOrderSize(2, 10, 20) denote the order size of product 20, in week 2 for customer 10. Arrays are much faster to update that ranges. It is much faster to update the values many times in an array compared to a range. You worksheet and ranges may be seen as a place where you keep your data. Hence, when you run an algorithm, you first read the data into some arrays. Next, do some calculations (update the arrays) and finally output the result to a worksheet again. Collections are used for storing a group of items together (think of it as a set). Collections and arrays are both used to group variables. If we compare collections against arrays: Collections are similar to arrays but better to use when the number of items is not fixed. With an array you normally set the size once. On the contrary you often add or remove items from a collection. Collections are better when adding and removing items. An item in a collection are read-only whereas an entry in an array are read/write. Collection can be accessed using a key or an index (starting from 1). Items of a collection do not have to share the same data type. Declare and create a collection: Dim col As New Collection Add items using: Call col.Add(&quot;Apple&quot;) Call col.Add(&quot;Pear&quot;) Items are removed using: Call col.Remove (2) Clear a collection using: Set col = Nothing An item in a collection can be given a key (think af a key as a name tag given to each item): Call col.Add(&quot;Hans Jørgensen&quot;, &quot;ID123&quot;) &#39; value, key Call col.Add(&quot;Jens Hansen&quot;, &quot;ID234&quot;) You can now access the item using the key: &quot;The item with key ID123 is: &quot; &amp; col(&quot;ID123&quot;) You can remove an item using a key: Call col.Remove(&quot;ID123&quot;) It is recommended to use keys since using keys has three advantages: If the order changes your code will still access the correct item You can directly access the item without reading through the entire collection It can make you code more readable You may also have a look at the slides for this module . 5.10 Exercises Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the help page. Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution! A template with VBA code for this module is given in the file 05-vba-datatypes-template.xlsm (open it and use it while reading the notes). Have a look inside the module TM5_ex in the VBA editor for examples used in the notes and during lectures. Have a look at module TM5_exercises for exercises. The template file for next teaching module will contain guiding answers for the exercises to this teaching module. 5.10.1 Exercise - Equal entries This exercise is a slightly modified version an exam assignment (exam 2021-A4). Consider worksheet TM5_Equal with seven data sets. Each data set consists of a list of integer values and is contained in a single column. Your code should be able to run on any of these data sets, but only on one data set at a time. The value in cell C1 states the column to use, so you can change the data set by changing this value (the values can be 1, 3, 5, …). The data sets vary in size. If you need to know the number of values in the data set, it should be done as part of your vba code. Write a sub TM5_Equal that stores the values of the data set indicated in cell C1 in an array; creates an array equal, where equal(k,j) is 1, if the k’th and j’th values are equal, and 0 otherwise. 5.10.2 Exercise - Product search Consider the worksheet TM5_Products containing a set of products with product code and price. Create a sub TM5_FindProduct that Declare two arrays to store the price and product code. Assign values to the arrays. Use an input box to ask for a product code. Use a for loop to search for the product and output the price in a message box. Hint: the Exit sub may be useful. Add a button to the worksheet that run the procedure. Test you code using different product codes. What happens if you write the product code without capital letters? If your code do not work, have a look at the UCase function. Modify your code so that if the product is not found then “Product not found!” is given in a message box. 5.10.3 Exercise - Read collections Consider worksheet TM5_Coll with numbers in column A to be read into a collection. Create a procedure TM5_CollNoKeys that: Create a collection col and add all the numbers. Print the collection in a message box (you may use the function Coll2Str here). Create another collection colC and add all the items in col with value below 5. Consider worksheet TM5_Coll with some ID numbers and prices for a set of products in columns C-D. Create a procedure TM5_CollKeys that: Create a collection col and add all the prices using ID as key. Print the price of the product with ID92011 in a message box. What happens if you try to print the price of ID92? 5.10.4 Exercise - Read arrays Consider the worksheet TM5_Array containing 3 datasets to be read into an array. The first two are in long format and the last in range format. Write a procedure TM5_ReadArrays that use course procedures AryRead and AryReadLong to read the values into three arrays. Assume that For the first dataset is the default array value 10. For the second dataset is the default array value 5. For the third dataset index must start from 3 (first dimension) and 5 (second dimension). Use the debugger to inspect if the values have been read correctly into the arrays. 5.10.5 Exercise - Process numbers This exercise is a slightly modified version an exam assignment (reexam 2022-A5). Consider worksheet TM5_ProcessData, which contains a set of numbers. Create a procedure TM5_Process with the following features: Copy the numbers to worksheet TM5_Process. Scan all the numbers and remove (clear the cell) all the negative numbers. Highlight all the numbers above 20. Add a button to the worksheet TM5_Process that run the procedure. The procedure should work for other datasets with a different size. You may assume that the data starts in cell A1. Create a procedure TM5_Stat with the following features: Scan the numbers and find the sum of all non-negative numbers, the mean of all negative numbers. Use a message box to display the sum and mean calculated. Add a button to the worksheet TM5_ProcessData that run the procedure. The procedure should work for other datasets with a different size. You may assume that the data starts in cell A1. 5.10.6 Exercise - Search payments This exercise is a slightly modified version an exam assignment (reexam 2022-A6). Consider worksheet TM5_PaymentsData which contains a table with three columns. The table contains data about payments for clients at a set of dates. Create a procedure TM5_SearchPayments that searches the table with the following features: Read the payment boolean in cell B1 (TRUE or FALSE) and the grouping string in cell B2 (None or Year) on worksheet TM5_Payments. Only consider payments where cells in the Payment column equals the payment boolean. If the grouping string equals None then count the number of payments for each client. Next, output the results on worksheet TM5_Payments. See worksheet TM5_PaymentsEx1 for an example. If the grouping string equals Year then count the number of payments for each client and year. Next, output the results on worksheet TM5_Payments. See worksheet TM5_PaymentsEx2_ for an example. Add a button to worksheet TM5_Payments that run the procedure. The procedure should work for other datasets with different number of rows too. 5.10.7 Exercise - Flight search The worksheet TM5_FlightData contains a set of flights between different destinations. You task is to create a procedure TM5_SearchFlights that can search for matching flights given a set of origins and destinations. Have a look at the results in worksheet TM5_FlightData. The origin and destinations to search for are given in columns A and B and the search result in columns D, E and F. Try pressing the Clear Search button and see what happens. Have a look at the code in the VBA editor for this sub and get an overview. × Hint Set the range you want to read and use AryRead Close Hint Try to finish the first part of the TM5_SearchFlights sub and store the flights in arrays. Use the debugger to check if the values are stored correctly. Try to finish the second part of the SearchFlights sub and search for matching origin-destination pairs. Note origins and destinations listed to be searched for are also matching origin-destination pairs if they are not in the same row. "],["mod-vba-random-numbers.html", "Module 6 Generating random numbers 6.1 Learning outcomes 6.2 Generating random numbers 6.3 Simulation 6.4 Recap 6.5 Exercises", " Module 6 Generating random numbers This module gives a short introduction on how to generate random numbers and using them in a simulation. Learning path diagram Click/hover the nodes to follow links and see details. 6.1 Learning outcomes By the end of this module, you are expected to be able to: Describe what a random number is. Generate a random number from a distribution. Run a simulation and compare/analyse results. The learning outcomes relate to the overall learning goals number 2-4, 8-14 and 16 of the course. 6.2 Generating random numbers Often we want to model a system where some of the elements are uncertain. To simulate the system we want to generate some random numbers following different distributions. This can be done using the built-in VBA and Excel functions. Read Sections 18.1 of Chapter 18 in Wøhlk (2010). 6.3 Simulation Given an uncertain system we simulate the system by constructing a deterministic model (that is we assume the random numbers have some specific values) and algorithms for solving it. Next, random numbers are generated and used to solve the model and store the results. This is repeated a number of times and statistics such as min, mean, standard deviation or max value of a statistic can be found. Read Sections 18.2 of Chapter 18 in Wøhlk (2010). 6.4 Recap Often we want to model a system where some of the elements are uncertain. To simulate the system we want to generate some random numbers following different distributions. This can be done using the built-in VBA and Excel functions. Initialize generation of random numbers using Randomize() &#39; chooses a random seed Or Randomize(100) &#39; generate the same random numbers We normally use the first option. When generating random numbers in VBA and writing them to the worksheet, they will NOT be changed when the worksheet is updated! Only when the code is executed! Examples on some distributions are Uniform between 0 and 1: Rnd() Uniform between i and j: i + (j - i) * Rnd Normal distribution: WorksheetFunction.NormInv(Rnd, dblMean, dblSD) Binomial distribution: WorksheetFunction.Binom_Inv(intTrials, dblPr, Rnd) Given an uncertain system we simulate the system by constructing a Deterministic model (that is we assume the random numbers have some specific values) and algorithms for solving it. Generate random numbers and used to solve the model and store the results. Repeat a number of times and calculate statistics such as min, mean and standard deviation. You may also have a look at the slides for this module. 6.5 Exercises Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the help page. Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution! 6.5.1 Exercise - Generating random numbers This file should be used as a starting point for this exercise. Create a procedure GenNormal with arguments intSize, dblMean, dblSD and ary. The procedure must generate intSize random numbers from a normal distribution with mean dblMean and standard deviation dblSD. The procedure must store the values in ary. Create a procedure GenUniform with arguments intSize, dblMin, dblMax and ary. The procedure must generate intSize random numbers from a uniform distribution in the range dblMin to dblMax. The procedure must store the values in ary. Create a procedure GenBinomial with arguments intSize, intTrials, dblPr and ary. The procedure must generate intSize random numbers from a binomial distribution using intTrials trials with dblPr probability of success. The procedure must store the values in ary. Create a procedure GenPoisson with arguments intSize, dblLambda and ary. The procedure must generate intSize random numbers from a poisson distribution with mean dblLambda. The procedure must store the values in ary. You may use the PoissonInv function. Create a procedure GenDiscrete with arguments intSize, dblDens and ary. The procedure must generate intSize random numbers from a discrete distribution with density dblDens (first column in the array contains the outcome and the second the probability). The procedure must store the values in ary. You may use the DiscreteInv function. Create a procedure Main that generate 5000 random numbers of A normal distribution with mean 100 and standard deviation 20. An uniform distribution with range 10 to 500. A binomial distribution with 100 trials and a 0.2 probability of success. A poisson distribution with mean 5. Plot the results for each distribution using CreatePlot. 6.5.2 Exercise - Traveling salesman problem This file should be used as a starting point for this exercise. The travelling salesman problem (TSP) asks the following question: Given a list of cities and the distances between each pair of the cities, what is the shortest possible route that visits each city exactly once and returns to the origin city? The problem is an NP-hard problem (worst case solution time grows exponential with the number of cities) in combinatorial optimization, important in theoretical computer science and operations research. The problem was first formulated in 1930 and is one of the most intensively studied problems in optimization. Even though the problem is computationally difficult, many heuristics and exact algorithms are known. The goal with this exercise is to test different heuristics on a set of problem instances. To see which one works best. Create a procedure GenTSPData satisfying: Arguments are ByRef dblCoord() As Double, Optional intCities As Integer = 0, Optional blnPrint As Boolean = False. Each city has an id number and a x and y-coordinate. The generated cities are stored in array dblCoord with intCities rows and three columns (column 1 store the city id, column 2 the x-coordinate and column 3 the y-coordinate) The x and y-coordinates are random numbers from an uniform distribution between 0 and 10. If blnPrint is true then coordinates are printed to the main sheet starting in cell A2. If intCities is zero then use an input box to ask for the number of cities. Create a procedure BtnGenTSPData that calls GenTSPData, ask for the number of cities and print the result to cell A2. A button linking to the procedure has already been created in the template file. Create a procedure CalcDistArray satisfying: Arguments are ByRef dblDist() As Double, dblCoord() As Double where dblCoord are the coordinates found using GenTSPData. The distance between two cities are stored in dblDist, i.e. dblDist(i, j) store the distance between city i and j. Symmetric distances are assumed, i.e. dblDist(i, j) = dblDist(j, i). Create a procedure SolveTSPIncX satisfying: Arguments are dblCoord() As Double, dblDist() As Double, ByRef dblCost As Double, ByRef intSeq() As Integer Sort the array dblCoord increasing in the x-coordinate (you may use the procedure ArySort in module ModuleAry to do this). Visit the cities in the order of the sorted array and return to the starting city. The visiting city sequence are stored in intSeq. The total cost are stored in dblCost. You may use the CalcCost function to find the total cost. Create a procedure BtnSolveTSPIncX that calls SolveTSPIncX using the TSP data in the Main sheet and print out the total cost in cell H4. A button linking to the procedure has already been created. Create a procedure SolveTSPIncY satisfying: Arguments are dblCoord() As Double, dblDist() As Double, ByRef dblCost As Double, ByRef intSeq() As Integer Sort the array dblCoord increasing in the y-coordinate (you may use the procedure ArySort in module ModuleAry to do this). Visit the cities in the order of the sorted array and return to the starting city. The visiting city sequence are stored in intSeq. The total cost are stored in dblCost. You may use the CalcCost function to find the total cost. Create a procedure BtnSolveTSPIncY that calls SolveTSPIncY using the TSP data in the Main sheet and print out the total cost in cell H8. A button linking to the procedure has already been created. Create a procedure SolveTSPRand satisfying: Arguments are dblCoord() As Double, dblDist() As Double, ByRef dblCost As Double, ByRef intSeq() As Integer Visit the cities in the order of the dblCoord array and return to the starting city. This may seen as we visit the cities in random order since generate x and y-coordinate random. The visiting city sequence are stored in intSeq. The total cost are stored in dblCost. You may use the CalcCost function to find the total cost. Create a procedure BtnSolveTSPRand that calls SolveTSPRand using the TSP data in the Main sheet and print out the total cost in cell H11. A button linking to the procedure has already been created. Create a procedure SolveTSPNN satisfying: Arguments are dblCoord() As Double, dblDist() As Double, ByRef dblCost As Double, ByRef intSeq() As Integer Start in city 1. Given the current city find the next city (not already visited) as the city with shortest distance. The visiting city sequence are stored in intSeq. The total cost are stored in dblCost. You may use the CalcCost function to find the total cost. Create a procedure BtnSolveTSPNN that calls SolveTSPNN using the TSP data in the Main sheet and print out the total cost in cell H14. A button linking to the procedure has already been created. Create a procedure Simulation satisfying: Generate an instance of TSP data with intCities cities which are chosen random between 10 and 500. Calculate the distance matrix. Solve the instance using all of the above solutions algorithms. Store the result in a row in the Simulation sheet. Repeat 100 times and calculate min, mean and max values for each solution algorithm. Have a look at sheet Simulation example for an example. Note you do not have to print the coordinates out to the Main sheet. Which solution algorithm seems to give the shortest total travel distance? 6.5.3 Exercise - Dan’s bakery This file should be used as a starting point for this exercise. Dan owns a small bakery baking a single cold-rised bread. The demand level \\(l\\) for bread is uncertain and on a given day the demand level equals \\(l=1\\) (low) with probability 0.2, \\(l=2\\) (medium) with probability 0.5 and \\(l=3\\) (high) with probability 0.3. The actual demand (number of customers) depends on the demand level and is Poisson distributed with mean \\(50 + 20l\\). The sales price per bread is 45 DKK and production cost 7 DKK. If a customer arrives and Dan has no bread left then he estimates the loss of goodwill to be 10 DKK. A customer always buy one bread. Dan can have 20 breads in the oven a time and hence always produce a multiple of 20 breads. Create a function Profit that returns the daily profit given a specific demand and production. Create a procedure Simulate that simulate the system for \\(y\\) days given that Dan choose to produce \\(x\\) breads each day. Number of runs (days), production, price, production cost, and lost goodwill cost instead of contribution margin and lost goodwill, average profit, standard deviation, min and max profit should be returned in an array. You may use functions DiscreteInv and PoissonInv to generate numbers. Create a procedure BtnSimulate that calls Simulate for different production levels and output the results in sheet Simulation. Is it best for Pierre to produce 80 or 120 breads? Create a function OptimalProd that search for the optimal production using the following steps: Start with production of 20 bread. Calculate the average profit based on 500 simulations. Increase the production with 20 breads unit until no better average profit is found. Return the production found. Test it on the data in sheet OptimalProd. References "],["groups.html", "A Working in groups Joint R project structure Using Git together with GitHub", " A Working in groups During the course you have been allocated into groups. You are expected to solve the exercises and write the project reports in these groups. Before you start, it is a good idea to agree on a set of group rules. First, agree on a coding convention. Most people in the R community use snake case but camel case is also okay. Next, setup rules on when to meet and how you will organize the work. For instance, it is a good idea that all try to solve some of the exercises before you meet and you then discuss the answers, problems etc. Finally, it is a good idea to have a common place for your code. You have different options: Use a cloud storage services such as Dropbox, OneDrive or Google Drive. Use a version control system such as Git together with GitHub. GitHub is a code sharing and publishing service and may be seen as a social networking site for programmers. If you use RStudio Cloud then one person in the group can create a shared workspace with projects: First create a new workspace named e.g. Shared. Press Members and add the group members as moderators. Now go back to Projects in the Tools for Analytics workspace and move one project to the shared workspace. Rename it to e.g. Group Project. Members will now have access to this project where you can share code. NOTE you can not work collectively on a file simultaneously. That is, only one member can change a file at a time! Hence it is a good idea to have your own private project to work on and use this project as a place where you can share code. If you want to download a project to your laptop then press the export button. The benefit of a cloud storage service is that it is well known to you and easy to setup. Cons are that you cannot work on the same file simultaneously. The benefit of Git and GitHub is that it manages the evolution of a set of files – called a repository – in a sane, highly structured way. If you have no idea what I’m talking about, think of it as the “Track Changes” features from Microsoft Word on steroids. Here you can work on files simultaneously. Moreover, it can be used from within RStudio. Cons are that it is harder to setup and learn. For a detailed description see Why Git? Why GitHub?. I recommend that you use Git and GitHub. However, if you find the learning curve to high just use a cloud storage service. The Using Git together with GitHub section gives a tutorial on how to setup Git and GitHub. Skip it if you use a cloud storage service. Joint R project structure I suggest to have an R project with subfolders joint, [student1 name], [student2 name], …, [student5 name]. Student folders contain files only a single student work on (good when you do some exercises before class). Folder joint contains joint work. That could for instance be a joint answer of an exercise (based on the work you did in the student folders) and a sub-folder with the project report. Using Git together with GitHub Git is a version control system. Git manages the evolution of a set of files – called a repository – in a sane, highly structured way. If you have no idea what I’m talking about, think of it as the “Track Changes” features from Microsoft Word on steroids. GitHub provide a home for your Git-based projects on the internet. If you have no idea what I’m talking about, think of it as DropBox but much, much better. It allows other people to see your stuff, sync up with you, and perhaps even make changes. Even for private solo projects, it’s a good idea to push your work to a remote location for peace of mind. To configure your computer go though the following steps: Register a free GitHub account Sign-up at GitHub. Some thoughts about your username: Incorporate your actual name! People like to know who they’re dealing with. Also makes your username easier for people to guess or remember. Reuse your username from other contexts, e.g., Twitter or Slack. But, of course, someone with no GitHub activity will probably be squatting on that. Pick a username you will be comfortable revealing to your future boss. Shorter is better than longer. Be as unique as possible in as few characters as possible. In some settings GitHub auto-completes or suggests usernames. Make it timeless. Don’t highlight your current university, employer, or place of residence, e.g. JennyFromTheBlock. Avoid the use of upper vs. lower case to separate words. We highly recommend all lowercase. GitHub treats usernames in a case insensitive way, but using all lowercase is kinder to people doing downstream regular expression work with usernames, in various languages. A better strategy for word separation is to use a hyphen - or underscore _. Install Git Find installation instructions below for your operating system. Windows Install Git from the web. Windows prefers for Git to be installed below C:/Program Files and this appears to be the default. This implies, for example, that the Git executable on my Windows system is found at C:/Program Files/Git/bin/git.exe. Unless you have specific reasons to otherwise, follow this convention. If asked about “Adjusting your PATH environment”, make sure to select “Git from the command line and also from 3rd-party software”. macOS Option 1 (highly recommended): Install the Xcode command line tools (not all of Xcode), which includes Git. Go to the shell and enter one of these commands to elicit an offer to install developer command line tools: git --version git config Accept the offer! Click on “Install”. Here’s another way to request this installation, more directly: xcode-select --install We just happen to find this Git-based trigger apropos. Note also that, after upgrading macOS, you might need to re-do the above and/or re-agree to the Xcode license agreement. We have seen this cause the RStudio Git pane to disappear on a system where it was previously working. Use commands like those above to tickle Xcode into prompting you for what it needs, then restart RStudio. Option 2 (recommended): Install Git from here: http://git-scm.com/downloads. This arguably sets you up the best for the future. It will certainly get you the latest version of Git of all approaches described here. The GitHub home for the macOS installer is here: https://github.com/timcharper/git_osx_installer. At that link, you can find more info if something goes wrong or you are working on an old version of macOS. Option 3 (recommended): If you anticipate getting heavily into scientific computing, you’re going to be installing and updating lots of software. You should check out Homebrew, “the missing package manager for OS X”. Among many other things, it can install Git for you. Once you have Homebrew installed, do this in the shell: brew install git Linux Install Git via your distro’s package manager. Ubuntu or Debian Linux: sudo apt-get install git Fedora or RedHat Linux: sudo yum install git A comprehensive list for various Linux and Unix package managers: https://git-scm.com/download/linux Check your installation Quit and re-launch RStudio if there’s any doubt in your mind about whether you opened RStudio before or after installing Git. You can set your Git user name and email from within R using the usethis package: ## install if needed (do this exactly once): ## install.packages(&quot;usethis&quot;) library(usethis) use_git_config(user.name = &quot;Jane Doe&quot;, user.email = &quot;jane@example.org&quot;) What user name should you give to Git? This does not have to be your GitHub user name, although it can be. Another good option is your actual first name and last name. If you commit from different machines, sometimes people work that info into the user name. Your commits will be labelled with this user name, so make it informative to potential collaborators and future you. What email should you give to Git? This must be the email associated with your GitHub account. These commands return nothing. You can check that Git understood what you typed by looking at the output of git config --global --list from a shell. An easy way to get into a shell from RStudio is **Tools &gt; Terminal* or *Tools &gt; Shell**. If you have any problems go though Chapters 4-14 on the Happy Git site. Setup projects using Git and GitHub You have different options depending on how you start you project. I will only highlight the prefererd one. New project, GitHub first Here we create a project with “GitHub first, then RStudio” sequence: Step 1: Go to GitHub and make sure you are logged in. Click green “New repository” button. Or, if you are on your own profile page, click on “Repositories”, then click the green “New” button. Repository name: test (or whatever you wish) Public YES Initialize this repository with a README Click the big green button “Create repository.” Copy the HTTPS clone URL to your clipboard via the green “Clone or Download” button. Step 2: In RStudio, start a new Project: File &gt; New Project &gt; Version Control &gt; Git. In the “repository URL” paste the URL of your new GitHub repository. It will be something like this https://github.com/[you-username]/test.git. Be intentional about where you create this Project. Suggest you “Open in new session”. Click “Create Project” to create a new directory, which will be all of these things: a directory or “folder” on your computer a Git repository, linked to a remote GitHub repository an RStudio Project In the absence of other constraints, I suggest that all of your R projects have exactly this set-up. This should download the README.md file that we created on GitHub in the previous step. Look in RStudio’s file browser pane for the README.md file. There’s a big advantage to the “GitHub first, then RStudio” workflow: the remote GitHub repo is added as a remote for your local repo and your local master branch is now tracking master on GitHub. This is a technical but important point about Git. The practical implication is that you are now set up to push and pull. No need to fanny around setting up Git remotes and tracking branches on the command line. Step 3: Make local changes, save, commit. Do this every time you finish a valuable chunk of work, probably many times a day. From RStudio, modify the README.md file, e.g., by adding the line “This is a line from RStudio”. Save your changes. Commit these changes to your local repo. How? Click the “Git” tab in upper right pane Check “Staged” box for any files whose existence or modifications you want to commit. To see more detail on what’s changed in file since the last commit, click on “Diff” for a Git pop-up If you’re not already in the Git pop-up, click “Commit” Type a message in “Commit message”, such as “Commit from RStudio”. Click “Commit” Step 4: Push your local changes to GitHub Do this a few times a day, but possibly less often than you commit. You have new work in your local Git repository, but the changes are not online yet. This will seem counterintuitive, but first let’s stop and pull from GitHub. Why? Establish this habit for the future! If you make changes to the repo in the browser or from another machine or (one day) a collaborator has pushed, you will be happier if you pull those changes in before you attempt to push. Click the blue “Pull” button in the “Git” tab in RStudio. I doubt anything will happen, i.e. you’ll get the message “Already up-to-date.” This is just to establish a habit. Click the green “Push” button to send your local changes to GitHub. You should see some message along these lines. [master dc671f0] blah 3 files changed, 22 insertions(+) create mode 100644 .gitignore create mode 100644 myrepo.Rproj Step 5: Confirm the local change propagated to the GitHub remote Go back to the browser. I assume we’re still viewing your new GitHub repo. Refresh. You should see the new “This is a line from RStudio” in the README. If you click on “commits,” you should see one with the message “Commit from RStudio”. Step 6: Make a change on GitHub Click on README.md in the file listing on GitHub. In the upper right corner, click on the pencil for “Edit this file”. Add a line to this file, such as “Line added from GitHub.” Edit the commit message in “Commit changes” or accept the default. Click the big green button “Commit changes.” Step 7: Pull from GitHub Back in RStudio locally … Inspect your README.md. It should NOT have the line “Line added from GitHub”. It should be as you left it. Verify that. Click the blue Pull button. Look at README.md again. You should now see the new line there. The end Now just repeat these operations when you do group work. Do work somewhere. Commit it. Push it or pull it depending on where you did it, but get local and remote “synced up”. Repeat. Note that in general (and especially in future when collaborating with other developers) you will usually need to pull changes from the remote (GitHub) before pushing the local changes you have made. For this reason, it’s a good idea to try and get into the habit of pulling before you attempt to push. If you have to type in your password over and over again, this can be avoided. Have a look at Chapter 10 of Happy Git. Existing project, GitHub first See details in Chapter 16 of Happy Git. Existing project, GitHub last See details in Chapter 17 of Happy Git. "],["annotate.html", "B Annotate the course notes", " B Annotate the course notes I recommend using hypothes.is to annotate the online course notes. You can create both private and public annotations. Collaborative annotation helps people connect to each other and what they’re reading, even when they’re keeping their distance. You may also use public notes to help me indicate spell errors, unclear content etc. in the notes. "],["help.html", "C Getting help", " C Getting help We all get stuck sometimes and need some help. Below are some advises on how to help yourself and ask for help: First try to understand the error message and solve the problem. You may try to debug your code by inserting break points in VBA or use browser() in your R code. See Chapter 11 in Bryan and H (n.d.) for further details. Google is your friend. This is always the first step. Try searches like “vba range”, “r dplyr filter”, “r tidyverse”, “r subset vector”, etc. Do you need help for a specific function in R then try ?[function-name] such as ?geom_line, ?mutate, etc. Mostly, focus on the last section with examples. Moreover, some packages may have written vignettes try browseVignettes(package = \"package_name\") to check. Have a look at Help &gt; Cheatsheets in RStudio. If you can’t find an answer then it is time to ask on-line. I recommend asking a question at stackoverflow. To make your question effective, the idea is to make things as easy as possible for someone to answer. This stack overflow thread How to make a great R reproducible example? give you some good hints. The process of providing a good minimal reproducible example (reprex) often causes you to answer your own question! See also Stack Exchange’s ‘How to ask’ and How to make a reprex at tidyverse. If you have a more course related question then ask it at our course forum and we will try to answer your question asap. Students are also welcome in helping each other. You can also try to annotate the online course notes if something is unclear. I will try to answer asap. You can get help from our TAs at study cafés. Note help using mail correspondence is not supported! References "],["coding-convention.html", "D Coding/naming convention D.1 Commenting your code", " D Coding/naming convention The main reason for using a consistent set of coding conventions is to standardize the structure and coding style of an application so that you and others can easily read and understand the code. Good coding conventions result in precise, readable, and unambiguous source code that is consistent with other language conventions and as intuitive as possible. Different ways of naming you variables exists. You are advised to adopt a naming convention; some use snake case others use camel case. The Leszynski naming convention define variables with a consistent prefix that makes it easy to identify its data type. It is common to use Leszynski convention within the VBA community. The R community use snake case but camel case is also okay. Some common prefixes used for the Leszynski naming convention are: Type Prefix Example Boolean bln blnFound Currency cur curRevenue Date (Time) dtm dtmStart Double dbl dblTolerance Integer int intQuantity Long lng lngDistance String str strFName Variant vnt vntCheckSum Array ary aryNumbers (optional) User form frm frmProcess Worksheet wst wstDistances Workbook wbk wbkData Many other prefixes can be used also. Choose the naming convention you like best in your study group. But stick only to one of them. A few examples: this_is_snake_case # note you do not use capital letters here thisIsCamelCase # you start each word with a capital letter (except the first) dblTolerance # Lezynski convention naming a double (dbl) variable strFullName # Lezynski naming a string (str) variable When defining variables and functions, it is in general good practice to use nouns for variables and verbs for functions. D.1 Commenting your code It is always good practice to comment your code. Such that others can get a fast overview and understand your code easier. We will use roxygen documentation comments which are widely known. A few examples in VBA are The top of a module file: &#39;&#39; Module description. &#39; Can be more than one line. &#39; @remarks Put your remarks on the module implementation here &#39; @author Lars Relund &lt;junk@relund.dk&gt; &#39; @date 2016-08-26 Before each sub, function etc. write: &#39;&#39; Sub description &#39; @pre Precondition &#39; @post Postcondition &#39; @param strA Explanation of input parameter strA &#39; @param intB Explanation of input parameter intB &#39; @return Return value (if a function) &#39; @remarks Further remarks Public Function MyFunc(strA As String, intB As Integer) As Integer { ... } Further tags (i.e. keywords starting with @) can be seen here. In R we use a ‘hash’ (#’) to comment functions: #&#39; Subtract two vectors #&#39; #&#39; @param x First vector. #&#39; @param y Vector to be subtracted. #&#39; #&#39; @return The difference. #&#39; @export #&#39; #&#39; @examples #&#39; subtract(x = c(5,5), y = c(2,3)) subtract &lt;- function(x, y) { return(x-y) } "],["apdx-vba.html", "E VBA specific topics E.1 Debugging your code E.2 Error handling E.3 Course procedures", " E VBA specific topics E.1 Debugging your code You debug you code to find errors and correct bugs in your program. VBA has a built-in debugger that you may use to step though you code and check if the values in memory are correct. You start and use the debugger using the debugger buttons in the VBA editor, e.g. set the cursor in the top of a sub and press the Step Into button ( F8, ⇧⌘I). You can now repeatedly press the button to step though the code. In the Locals window you can see the values of the variables as you run you code. Finally, if you want to run the program until a specific line or code then insert a break-point by clicking the margin of that line in the VBA editor. Next, run you sub and the debugger will stop at that line. For more details you may have a look at Chapter 9 in Wøhlk (2010) or the videos Debug toolbar, Locals window and Breakpoints. E.2 Error handling See https://excelmacromastery.com/vba-error-handling/ E.3 Course procedures The course have a set of course procedures that you may use ‘as is’ during the course and at the exam. I will explicitly state if you are not allowed to use them otherwise. A overview is given in Table ??. All procedures within a topic start with the same suffix so you easy can find them using auto complete in the VBA editor (Ctrl + Space). On a mac you may have to disable the default shortcut (Ctrl + Space) for switching input sources. You can go to the System Preferences -&gt; Keyboard -&gt; Shortcuts -&gt; Input Sources and disable it. For instance all procedures related to arrays start with suffix Ary. Similar the procedures are stored in module ModAry. The modules are stored in the template files for each teaching module (if used) and all course procedures can be found in ???. If you want to use a procedure copy the whole module containing the procedure to the Excel file. [Table here (e.g. read from tribble)] References "],["lg-course.html", "F Learning goals", " F Learning goals The purpose of this course is to give students a knowledge about IT tools for Analytics which requires the analyst to be qualified in handling tools beyond e.g. basic Excel. After having participated in the course, the student must, in addition to achieving general academic skills, demonstrate: Knowledge of how a computer works at a basic level. basic programming such as variables, arrays, loops, functions and procedures. what an algorithm is. how to implement an algorithm based on a description. different programming languages. how to manage a code in a collaborative working environment. Skills to handle data such as import, tidy, transform, visualize and export. develop well-structured code. perform testing and debugging. implement/code selected algorithms. apply analytical techniques on data. apply relevant methods, algorithms and techniques from this course in order to solve a specific problem. Competences to independently handle data given a problem. independently analyze data given a relevant research question. compare different programming languages. compare different algorithms solving a problem and discuss their advantages and disadvantages. interpret and discuss results based on a data analysis in relation to the relevant academic literature. communicate results from applied research in a scientific way, e.g. using literate programming. "],["ba.html", "G Business Analytics", " G Business Analytics Business Analytics (BA) refers to the scientific process of transforming data into insight for making better decisions in business. BA can both be seen as the complete decision making process for solving a business problem or as a set of methodologies that enable the creation of business value. As a process it can be characterized by descriptive, predictive, and prescriptive model building using “big” data sources. Descriptive Analytics: A set of technologies and processes that use data to understand and analyze business performance. Descriptive analytics are the most commonly used and most well understood type of analytics. Descriptive analytics categorizes, characterizes, consolidates, and classifies data. Examples are standard reporting and dashboards (KPIs, what happened or is happening now?) and ad-hoc reporting (how many/often?). Descriptive analytics often serves as a first step in the successful application of predictive or prescriptive analytics. Predictive Analytics: The use of data and statistical techniques to make predictions about future outputs/outcomes, identify patterns or opportunities for business performance. Examples of techniques are data mining (what data is correlated with other data?), pattern recognition and alerts (when should I take action to correct/adjust a spare part?), Monte-Carlo simulation (what could happen?), neural networks (which customer group are best?) and forecasting (what if these trends continue?). Prescriptive Analytics: The use of optimization and other decision modelling techniques using the results of descriptive and predictive analytics to suggest decision options with the goal of improving business performance. Prescriptive analytics attempt to quantify the effect of future decisions in order to advise on possible outcomes before the decisions are actually made. Prescriptive analytics predicts not only what will happen, but also why it will happen and provides recommendations regarding actions that will take advantage of the predictions. Prescriptive analytics are relatively complex to administer, and most companies are not yet using it in their daily course of business. However, when implemented correctly, it can have a huge impact on business performance and how businesses make decisions. Examples on prescriptive analytics are optimization in production planning and scheduling, inventory management, the supply chain and transportation planning. Companies who use BA focus on fact-based management to drive decision making and treats data and information as a strategic asset that is shared within the company. This enterprise approach generates a companywide respect for applying descriptive, predictive and prescriptive analytics in areas such as supply chain, marketing and human resources. Related areas: In the past Business Intelligence traditionally focuses on querying, reporting, online analytical processing, i.e. descriptive analytics. However, a more modern definition of Business Intelligence is the union of descriptive and predictive analytics. Operations Research or Management Science deals with the application of advanced analytical methods to help make better decisions and can hence be seen as prescriptive analytics. However, traditionally it has been taking a more theoretical approach and focusing on problem-driven research while BA takes a more data-driven approach. Logistics is a cross-functional area focusing on the effective and efficient flows of goods and services, and the related flows of information and cash. Supply Chain Management adds a process-oriented and cross-company perspective. Both can be seen as prescriptive analytics with a more problem-driven research focus. Advanced Analytics is often used as a classification of both predictive and prescriptive analytics. Data science is an interdisciplinary field about scientific methods, processes, and systems to extract knowledge or insights from data in various forms, either structured or unstructured and can be seen as Business analytics applied to a wider range of data. Resources http://analytics-magazine.org/the-analytics-journey/ https://en.wikipedia.org/wiki/Business_analytics http://connect.informs.org/analytics/home https://www.or-exchange.org/questions/5645/informs-analytics-definition https://en.wikipedia.org/wiki/Prescriptive_analytics https://en.wikipedia.org/wiki/Predictive_analytics "],["colophon.html", "H Colophon", " H Colophon These notes were written in bookdown inside RStudio. This version of the book was built with: #&gt; Finding R package dependencies ... Done! #&gt; setting value #&gt; version R version 4.2.1 (2022-06-23) #&gt; os macOS Monterey 12.4 #&gt; system x86_64, darwin17.0 #&gt; ui RStudio #&gt; language (EN) #&gt; collate en_US.UTF-8 #&gt; ctype en_US.UTF-8 #&gt; tz Europe/Copenhagen #&gt; date 2022-07-29 #&gt; rstudio 2022.07.0+548 Spotted Wakerobin (desktop) #&gt; pandoc 2.18 @ /Applications/RStudio.app/Contents/MacOS/quarto/bin/tools/ (via rmarkdown) Along with these packages: "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]

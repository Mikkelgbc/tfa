---
output: html_document
editor_options: 
  chunk_output_type: console
---



[BSS]: https://bss.au.dk/en/

[course-help]: https://github.com/bss-osca/tfa/issues
[cran]: https://cloud.r-project.org
[cheatsheet-readr]: https://rawgit.com/rstudio/cheatsheets/master/data-import.pdf
[course-welcome-to-the-tidyverse]: https://github.com/rstudio-education/welcome-to-the-tidyverse

[DataCamp]: https://www.datacamp.com/
[datacamp-signup]: https://www.datacamp.com/groups/shared_links/cbaee6c73e7d78549a9e32a900793b2d5491ace1824efc1760a6729735948215
[datacamp-r-intro]: https://learn.datacamp.com/courses/free-introduction-to-r
[datacamp-r-rmarkdown]: https://campus.datacamp.com/courses/reporting-with-rmarkdown
[datacamp-r-communicating]: https://learn.datacamp.com/courses/communicating-with-data-in-the-tidyverse
[datacamp-r-communicating-chap3]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/introduction-to-rmarkdown
[datacamp-r-communicating-chap4]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/customizing-your-rmarkdown-report
[datacamp-r-intermediate]: https://learn.datacamp.com/courses/intermediate-r
[datacamp-r-intermediate-chap1]: https://campus.datacamp.com/courses/intermediate-r/chapter-1-conditionals-and-control-flow
[datacamp-r-intermediate-chap2]: https://campus.datacamp.com/courses/intermediate-r/chapter-2-loops
[datacamp-r-intermediate-chap3]: https://campus.datacamp.com/courses/intermediate-r/chapter-3-functions
[datacamp-r-intermediate-chap4]: https://campus.datacamp.com/courses/intermediate-r/chapter-4-the-apply-family
[datacamp-r-functions]: https://learn.datacamp.com/courses/introduction-to-writing-functions-in-r
[datacamp-r-tidyverse]: https://learn.datacamp.com/courses/introduction-to-the-tidyverse
[datacamp-r-strings]: https://learn.datacamp.com/courses/string-manipulation-with-stringr-in-r
[datacamp-r-dplyr]: https://learn.datacamp.com/courses/data-manipulation-with-dplyr
[datacamp-r-dplyr-bakeoff]: https://learn.datacamp.com/courses/working-with-data-in-the-tidyverse
[datacamp-r-ggplot2-intro]: https://learn.datacamp.com/courses/introduction-to-data-visualization-with-ggplot2
[datacamp-r-ggplot2-intermediate]: https://learn.datacamp.com/courses/intermediate-data-visualization-with-ggplot2
[dplyr-cran]: https://CRAN.R-project.org/package=dplyr
[debug-in-r]: https://rstats.wtf/debugging-r-code.html

[excel-vs-r]: https://www.jessesadler.com/post/excel-vs-r/

[google-form]: https://forms.gle/s39GeDGV9AzAXUo18
[google-grupper]: https://docs.google.com/spreadsheets/d/1DHxthd5AQywAU4Crb3hM9rnog2GqGQYZ2o175SQgn_0/edit?usp=sharing
[GitHub]: https://github.com/
[git-install]: https://git-scm.com/downloads
[github-actions]: https://github.com/features/actions
[github-pages]: https://pages.github.com/

[happy-git]: https://happygitwithr.com
[hg-install-git]: https://happygitwithr.com/install-git.html
[hg-why]: https://happygitwithr.com/big-picture.html#big-picture
[hg-github-reg]: https://happygitwithr.com/github-acct.html#github-acct
[hg-git-install]: https://happygitwithr.com/install-git.html#install-git
[hg-exist-github-first]: https://happygitwithr.com/existing-github-first.html
[hg-exist-github-last]: https://happygitwithr.com/existing-github-last.html
[hg-credential-helper]: https://happygitwithr.com/credential-caching.html
[hypothes.is]: https://web.hypothes.is/

[osca-programme]: https://kandidat.au.dk/en/operationsandsupplychainanalytics/

[Peergrade]: https://peergrade.io
[peergrade-signup]: https://app.peergrade.io/join
[point-and-click]: https://en.wikipedia.org/wiki/Point_and_click
[pkg-bookdown]: https://bookdown.org/yihui/bookdown/
[pkg-openxlsx]: https://ycphs.github.io/openxlsx/index.html
[pkg-ropensci-writexl]: https://docs.ropensci.org/writexl/
[pkg-jsonlite]: https://cran.r-project.org/web/packages/jsonlite/index.html

[R]: https://www.r-project.org
[RStudio]: https://rstudio.com
[rstudio-cloud]: https://rstudio.cloud/spaces/176810/join?access_code=LSGnG2EXTuzSyeYaNXJE77vP33DZUoeMbC0xhfCz
[r-cloud-mod12]: https://rstudio.cloud/spaces/176810/project/2963819
[r-cloud-mod13]: https://rstudio.cloud/spaces/176810/project/3020139
[r-cloud-mod14]: https://rstudio.cloud/spaces/176810/project/3020322
[r-cloud-mod15]: https://rstudio.cloud/spaces/176810/project/3020509
[r-cloud-mod16]: https://rstudio.cloud/spaces/176810/project/3026754
[r-cloud-mod17]: https://rstudio.cloud/spaces/176810/project/3034015
[r-cloud-mod18]: https://rstudio.cloud/spaces/176810/project/3130795
[r-cloud-mod19]: https://rstudio.cloud/spaces/176810/project/3266132
[rstudio-download]: https://rstudio.com/products/rstudio/download/#download
[rstudio-customizing]: https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio
[rstudio-key-shortcuts]: https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts
[rstudio-workbench]: https://www.rstudio.com/wp-content/uploads/2014/04/rstudio-workbench.png
[r-markdown]: https://rmarkdown.rstudio.com/
[ropensci-writexl]: https://docs.ropensci.org/writexl/
[r4ds-pipes]: https://r4ds.had.co.nz/pipes.html
[r4ds-factors]: https://r4ds.had.co.nz/factors.html
[r4ds-strings]: https://r4ds.had.co.nz/strings.html
[r4ds-iteration]: https://r4ds.had.co.nz/iteration.html

[stat-545]: https://stat545.com
[stat-545-functions-part1]: https://stat545.com/functions-part1.html
[stat-545-functions-part2]: https://stat545.com/functions-part2.html
[stat-545-functions-part3]: https://stat545.com/functions-part3.html
[slides-welcome]: https://bss-osca.github.io/tfa/slides/00-tfa_welcome.html
[slides-m1-3]: https://bss-osca.github.io/tfa/slides/01-welcome_r_part.html
[slides-m4-5]: https://bss-osca.github.io/tfa/slides/02-programming.html
[slides-m6-8]: https://bss-osca.github.io/tfa/slides/03-transform.html
[slides-m9]: https://bss-osca.github.io/tfa/slides/04-plot.html
[slides-m83]: https://bss-osca.github.io/tfa/slides/05-joins.html

[tidyverse-main-page]: https://www.tidyverse.org
[tidyverse-packages]: https://www.tidyverse.org/packages/
[tidyverse-core]: https://www.tidyverse.org/packages/#core-tidyverse
[tidyverse-ggplot2]: https://ggplot2.tidyverse.org/
[tidyverse-dplyr]: https://dplyr.tidyverse.org/
[tidyverse-tidyr]: https://tidyr.tidyverse.org/
[tidyverse-readr]: https://readr.tidyverse.org/
[tidyverse-purrr]: https://purrr.tidyverse.org/
[tidyverse-tibble]: https://tibble.tidyverse.org/
[tidyverse-stringr]: https://stringr.tidyverse.org/
[tidyverse-forcats]: https://forcats.tidyverse.org/
[tidyverse-readxl]: https://readxl.tidyverse.org
[tidyverse-googlesheets4]: https://googlesheets4.tidyverse.org/index.html
[tutorial-markdown]: https://commonmark.org/help/tutorial/

[Udemy]: https://www.udemy.com/

[vba-yt-course1]: https://www.youtube.com/playlist?list=PLpOAvcoMay5S_hb2D7iKznLqJ8QG_pde0
[vba-course1-hello]: https://youtu.be/f42OniDWaIo

[vba-yt-course2]: https://www.youtube.com/playlist?list=PL3A6U40JUYCi4njVx59-vaUxYkG0yRO4m
[vba-course2-devel-tab]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-editor]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-project]: https://youtu.be/fp6PTbU7bXo
[vba-course2-devel-properties]: https://youtu.be/ks2QYKAd9Xw
[vba-course2-devel-hello]: https://youtu.be/EQ6tDWBc8G4

[video-install]: https://vimeo.com/415501284
[video-rstudio-intro]: https://vimeo.com/416391353
[video-packages]: https://vimeo.com/416743698
[video-projects]: https://vimeo.com/319318233
[video-r-intro-p1]: https://www.youtube.com/watch?v=vGY5i_J2c-c
[video-r-intro-p2]: https://www.youtube.com/watch?v=w8_XdYI3reU
[video-r-intro-p3]: https://www.youtube.com/watch?v=NuY6jY4qE7I
[video-subsetting]: https://www.youtube.com/watch?v=hWbgqzsQJF0&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10&t=0s
[video-datatypes]: https://www.youtube.com/watch?v=5AQM-yUX9zg&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10
[video-control-structures]: https://www.youtube.com/watch?v=s_h9ruNwI_0
[video-conditional-loops]: https://www.youtube.com/watch?v=2evtsnPaoDg
[video-functions]: https://www.youtube.com/watch?v=ffPeac3BigM
[video-tibble-vs-df]: https://www.youtube.com/watch?v=EBk6PnvE1R4
[video-dplyr]: https://www.youtube.com/watch?v=aywFompr1F4

[wiki-snake-case]: https://en.wikipedia.org/wiki/Snake_case
[wiki-camel-case]: https://en.wikipedia.org/wiki/Camel_case
[wiki-interpreted]: https://en.wikipedia.org/wiki/Interpreted_language
[wiki-literate-programming]: https://en.wikipedia.org/wiki/Literate_programming
[wiki-csv]: https://en.wikipedia.org/wiki/Comma-separated_values
[wiki-json]: https://en.wikipedia.org/wiki/JSON

# Importing and exporting data {#mod-r-io}

For doing data driven analytics, you first must __import__ some data. That is, take data from a database, file, web API etc. and transform it into a data frame/table. Moreover, after processing data, you often want to export or store some of the results. This module introduces you to different ways of importing and exporting data. 

We are all different and you may like different learning styles compared to others. In the learning path diagram, there may be links to alternative online content. Note this is an alternative to the standard learning path that you may use instead. The learning path may also have extra content, that is not a part of syllabus, you can have a look at. 


```{=html}
<div id="htmlwidget-5ecc84d3d83d211d03b0" style="width:1000px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-5ecc84d3d83d211d03b0">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"📖 CSV files\", URL = \"#r-io-csv\", tooltip = \"CSV files\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"0,2!\"] \n  \"2\" [label = \"📖 Excel\", URL = \"#r-io-excel\", tooltip = \"Excel\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"2,2!\"] \n  \"3\" [label = \"📖 Google\\nsheets\", URL = \"#r-io-google\", tooltip = \"Google\\nsheets\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"4,2!\"] \n  \"4\" [label = \"📖 Text\\nfiles\", URL = \"#r-io-text\", tooltip = \"Text\\nfiles\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"6,2!\"] \n  \"5\" [label = \"📖 R\", URL = \"#r-io-r\", tooltip = \"Rs native binary format\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"7.5,2!\"] \n  \"6\" [label = \"📖 Json\", URL = \"#r-io-json\", tooltip = \"Json\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"9,2!\"] \n  \"7\" [label = \"💻 Exercises\", URL = \"#ex-r-io\", tooltip = \"Exercises\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"11,2!\"] \n  \"8\" [label = \"📖 Importing\\ndata\", URL = \"https://rafalab.github.io/dsbook/importing-data.html\", tooltip = \"Chapter 5 in Irizarry (2020) gives an alternative introduction to importing data.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"4,0!\"] \n  \"9\" [label = \"\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"0.5\", fontname = \"Helvetica\", shape = \"rect\", height = \"1\", width = \"6\", fillcolor = \"#F0F8FF\", pos = \"2.4,3.66!\"] \n  \"10\" [label = \"Color:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"0.8\", fillcolor = \"#FFFFFE\", pos = \"-0.23,4!\"] \n  \"11\" [label = \"mandatory\", URL = \"\", tooltip = \"Mandatory syllabus.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkSeaGreen4\", pos = \"0,3.6!\"] \n  \"12\" [label = \"alternative\", URL = \"\", tooltip = \"Alternative syllabus if you prefer another learning style.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkOrange4\", pos = \"1,3.6!\"] \n  \"13\" [label = \"extra\", URL = \"\", tooltip = \"Extra learning if you are interested (not part of syllabus).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"PeachPuff3\", pos = \"2,3.6!\"] \n  \"14\" [label = \"Shape:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"1\", fillcolor = \"#FFFFFE\", pos = \"3.2,4!\"] \n  \"15\" [label = \"non-interactive\", URL = \"\", tooltip = \"Non-interactive learning content (e.g. reading).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"1\", fillcolor = \"Grey40\", pos = \"3.5,3.6!\"] \n  \"16\" [label = \"interactive\", URL = \"\", tooltip = \"Interactive learning content (tutorial, exercises etc.).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"egg\", width = \"1\", fillcolor = \"Grey40\", pos = \"4.75,3.6!\"] \n\"1\"->\"2\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"8\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"3\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"8\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"4\" [color = \"black\", arrowhead = \"vee\"] \n\"4\"->\"5\" [color = \"black\", arrowhead = \"vee\"] \n\"4\"->\"8\" [color = \"black\", arrowhead = \"vee\"] \n\"5\"->\"6\" [color = \"black\", arrowhead = \"vee\"] \n\"6\"->\"7\" [color = \"black\", arrowhead = \"vee\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
```

<!-- * [Chapter 5](https://rafalab.github.io/dsbook/importing-data.html) in @dsbook gives an alternative introduction to importing data. -->


## Learning outcomes {#lo-r-io}

By the end of this module, you are expected to be able to:

* Import and export csv files in different formats.
* Import and export data from Excel.
* Import and export data from Google Sheets.
* Write to a text file.
* Save data using R's native format.
* Read and write to a json file.

The learning outcomes relate to the [overall learning goals](#lg-course) number 7 and 13 of the course.

<!-- SOLO increasing: identify · memorize · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->


## CSV files {#r-io-csv}

[CSV files][wiki-csv] contain *comma separated values* (csv) in plain text and are often named using the file suffix `.csv`. Each line of the file is a data record. Each record consists of one or more fields, separated by a common delimiter (e.g. `,`, `;` or `_`). The CSV file format is not fully standardized. Different delimiters may be used, fields may be surrounded by quotation marks, text may contain escape characters and the encoding of the file may not be known. Despite these problems, CSV files are commonly used since they are easy to exchange and read.

We will use the [readr][tidyverse-readr] package for reading and writing. An overview over the functions can be seen in the [cheatsheet][cheatsheet-readr].


### Reading a CSV file

In general use the following functions

   * `read_csv`: Read a file with delimiter `,`.
   * `read_csv2`: Read a file with delimiter `;`.
   * `read_delim`: Read a file with a delimiter set by you.

#### Reading an unknown CSV file

For importing a CSV file properly, you need to know the delimiter, if the files has headers and the encoding. If you are not sure, you may have a look on the file by opening it in a text editor or try to read some lines:  


```r
csv_file <- readr_example("mtcars.csv") # csv file
lines <- read_lines(csv_file, n_max = 3)
lines
#> [1] "\"mpg\",\"cyl\",\"disp\",\"hp\",\"drat\",\"wt\",\"qsec\",\"vs\",\"am\",\"gear\",\"carb\""
#> [2] "21,6,160,110,3.9,2.62,16.46,0,1,4,4"                                                     
#> [3] "21,6,160,110,3.9,2.875,17.02,0,1,4,4"
cat(lines, sep = "\n")
#> "mpg","cyl","disp","hp","drat","wt","qsec","vs","am","gear","carb"
#> 21,6,160,110,3.9,2.62,16.46,0,1,4,4
#> 21,6,160,110,3.9,2.875,17.02,0,1,4,4
```
It seems that the delimiter is a `,` and we may try to read the file using `read_csv`:


```r
dat <- read_csv(csv_file)
head(dat)
#> # A tibble: 6 × 11
#>     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
#>   <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
#> 1  21       6   160   110  3.9   2.62  16.5     0     1     4     4
#> 2  21       6   160   110  3.9   2.88  17.0     0     1     4     4
#> 3  22.8     4   108    93  3.85  2.32  18.6     1     1     4     1
#> 4  21.4     6   258   110  3.08  3.22  19.4     1     0     3     1
#> 5  18.7     8   360   175  3.15  3.44  17.0     0     0     3     2
#> 6  18.1     6   225   105  2.76  3.46  20.2     1     0     3     1
```

CSV files should always be saved using encoding UTF-8. However, sometimes you may have encoding problems when you read a file:


```r
csv_file <- system.file("extdata/persons.csv", package = "tfa")
read_csv(csv_file)
#> # A tibble: 3 × 2
#>   first    last        
#>   <chr>    <chr>       
#> 1 "Hans"   "S\xf8gaard"
#> 2 "\xc5ge" "\xd8kse"   
#> 3 "Yvette" "L\xe6ske"
```

Note that some of the characters are not converted correctly. This is usually because the file encoding is not UTF-8. In this case, try to guess the encoding using:


```r
guess_encoding(csv_file)
#> # A tibble: 1 × 2
#>   encoding   confidence
#>   <chr>           <dbl>
#> 1 ISO-8859-1       0.27
dat <- read_csv(csv_file, locale = locale(encoding = "ISO-8859-1"))
dat
#> # A tibble: 3 × 2
#>   first  last   
#>   <chr>  <chr>  
#> 1 Hans   Søgaard
#> 2 Åge    Økse   
#> 3 Yvette Læske
```


### Writing to CSV files

Given a tibble/data frame export it using `write_csv`:


```r
csv_file <- "testing.csv"
write_csv(dat, file = csv_file) 
write_csv2(dat, file = "testing_semicolon.csv")   # use a semicolon as delimitor
```

You can now always import the data again using `read_csv`:


```r
read_csv(csv_file)
#> # A tibble: 3 × 2
#>   first  last   
#>   <chr>  <chr>  
#> 1 Hans   Søgaard
#> 2 Åge    Økse   
#> 3 Yvette Læske
guess_encoding(csv_file)
#> # A tibble: 3 × 2
#>   encoding     confidence
#>   <chr>             <dbl>
#> 1 UTF-8              1   
#> 2 windows-1252       0.31
#> 3 windows-1250       0.25
```
Note that `write_csv` always saves the file using encoding UTF-8. 

In a few cases, you may need to save a CSV file that can be read by Excel. For this purpose use:


```r
write_excel_csv2(dat, csv_file)
```

The CSV file can now be opened correctly in Excel. 




## Excel {#r-io-excel}

There are different packages in R for reading and writing to Excel. We will use the [readxl][tidyverse-readxl] package for reading Excel files which is a part of tidyverse. The package supports both the legacy `.xls` format and the modern xml-based `.xlsx` format. Let us use one of the example files provided by the package:


```r
xlsx_file <- system.file("extdata/datasets.xlsx", package = "readxl")
```

It is always a good idea to have a look at the file before you import from it. You can open it from R by using: 


```r
browseURL(xlsx_file)
```

Data can be read using:


```r
library(readxl)
xlsx <- read_excel(xlsx_file)   # reads the first sheet
xlsx
#> # A tibble: 150 × 5
#>    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
#>           <dbl>       <dbl>        <dbl>       <dbl> <chr>  
#>  1          5.1         3.5          1.4         0.2 setosa 
#>  2          4.9         3            1.4         0.2 setosa 
#>  3          4.7         3.2          1.3         0.2 setosa 
#>  4          4.6         3.1          1.5         0.2 setosa 
#>  5          5           3.6          1.4         0.2 setosa 
#>  6          5.4         3.9          1.7         0.4 setosa 
#>  7          4.6         3.4          1.4         0.3 setosa 
#>  8          5           3.4          1.5         0.2 setosa 
#>  9          4.4         2.9          1.4         0.2 setosa 
#> 10          4.9         3.1          1.5         0.1 setosa 
#> # … with 140 more rows
xlsx <- read_excel(xlsx_file, sheet = 2)   # reads the second sheet
xlsx
#> # A tibble: 32 × 11
#>      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
#>    <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
#>  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4
#>  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4
#>  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
#>  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
#>  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
#>  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
#>  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
#>  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
#>  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
#> 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
#> # … with 22 more rows
xlsx <- read_excel(xlsx_file, sheet = "quakes")   # reads a named sheet
xlsx
#> # A tibble: 1,000 × 5
#>      lat  long depth   mag stations
#>    <dbl> <dbl> <dbl> <dbl>    <dbl>
#>  1 -20.4  182.   562   4.8       41
#>  2 -20.6  181.   650   4.2       15
#>  3 -26    184.    42   5.4       43
#>  4 -18.0  182.   626   4.1       19
#>  5 -20.4  182.   649   4         11
#>  6 -19.7  184.   195   4         12
#>  7 -11.7  166.    82   4.8       43
#>  8 -28.1  182.   194   4.4       15
#>  9 -28.7  182.   211   4.7       35
#> 10 -17.5  180.   622   4.3       19
#> # … with 990 more rows
xlsx <- read_excel(xlsx_file, sheet = "mtcars", range = "A5:G11", col_names = F)   # reads a range
colnames(xlsx) <- read_excel(xlsx_file, sheet = "mtcars", range = "A1:G1", col_names = F)   # reads the column names
xlsx
#> # A tibble: 7 × 7
#>     mpg   cyl  disp    hp  drat    wt  qsec
#>   <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
#> 1  21.4     6  258    110  3.08  3.22  19.4
#> 2  18.7     8  360    175  3.15  3.44  17.0
#> 3  18.1     6  225    105  2.76  3.46  20.2
#> 4  14.3     8  360    245  3.21  3.57  15.8
#> 5  24.4     4  147.    62  3.69  3.19  20  
#> 6  22.8     4  141.    95  3.92  3.15  22.9
#> 7  19.2     6  168.   123  3.92  3.44  18.3
```

Writing to an Excel file can be done using the [openxlsx][pkg-openxlsx] package. To write to a new file use:


```r
library(openxlsx)
dat <- trees   # test dataset
head(dat)
#>   Girth Height Volume
#> 1   8.3     70   10.3
#> 2   8.6     65   10.3
#> 3   8.8     63   10.2
#> 4  10.5     72   16.4
#> 5  10.7     81   18.8
#> 6  10.8     83   19.7
write.xlsx(dat, "test1.xlsx", sheetName = "trees") # start at cell A1
write.xlsx(dat, "test2.xlsx", sheetName = "trees", startCol = "C", startRow = 3)
```

If you want to append a sheet to a file use:


```r
xlsx_file <- system.file("extdata/datasets.xlsx", package = "tfa")
file.copy(xlsx_file, "test.xlsx")         # copy the file so can make some tests
#> [1] TRUE
wb <- loadWorkbook(file = "test.xlsx")    # read the workbook
addWorksheet(wb = wb, sheetName = "trees")
writeData(wb, sheet = "trees", x = dat)
saveWorkbook(wb, file = "test.xlsx", overwrite = TRUE)
```




## Google Sheets {#r-io-google}

You can import and export to Google sheets using the [googlesheets4][tidyverse-googlesheets4] package in tidyverse. To read and write data, in general, you need to be logged in as a Google user. The package will ask you when needed. However, if you only want to read data from a public sheet, you can use `gs4_deauth` to skip this:


```r
library(googlesheets4)
gs4_deauth()
```

To read data use:


```r
url <- "https://docs.google.com/spreadsheets/d/1U6Cf_qEOhiR9AZqTqS3mbMF3zt2db48ZP5v3rkrAEJY/edit#gid=780868077"
read_sheet(url)
read_sheet(url, sheet = 3)
range_read(url, sheet = 2, n_max = 3)
range_read(url, range = "Africa!A5:C15")
```

To write data to a new file use:


```r
gs4_auth()
gs <- gs4_create("test", sheets = c("Sheet 1", "Sheet 2"))
write_sheet(dat, ss = gs)
range_write(gs, dat, sheet = "Sheet 1", range = "C4")
gs4_browse(gs)  # have a look at the file in a browser
```

To see the results, have a look at your Google sheet `test` in your browser.


## Text files {#r-io-text}

You can read and write to plain text files using the [readr][tidyverse-readr] package. However, mostly you want to write to a text file because you want to save some kind of log file when you run your script. Here `sink` is an excellent function to use, since it redirects your R output. To see the output without messages, errors and warnings use:


```r
sink(file = "ex1.log", split = TRUE)  # open the file for output
cat("This is a string\n... and on a new line\n\n")
print("This is another string")
head(mtcars)
rep(1, 4)
message("A message.")
warning("A warning.")
rep(3, f)  # a error
cat("\nLast line\n")
sink()  # close the file again
# file.show("ex1.log")   # to view in external viewer
```

Let us have a look at the content of the file (run `cat(read_file("ex1.log"))`):


```
This is a string
... and on a new line

[1] "This is another string"
                   mpg cyl disp  hp drat   wt qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.62 16.5  0  1    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.88 17.0  0  1    4    4
Datsun 710        22.8   4  108  93 3.85 2.32 18.6  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.21 19.4  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.44 17.0  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.46 20.2  1  0    3    1
[1] 1 1 1 1

Last line
```

Note that messages, errors and warnings are not included in the output. If you want to include it use:


```r
zz <- file("ex2.log", open = "wt")
sink(zz, type = "output")   # open the file for output
sink(zz, type = "message")  # open the same file for messages, errors and warnings
cat("This is a string\n... and on a new line\n\n")
print("This is another string")
head(mtcars)
rep(1, 4)
message("A message.")
warning("A warning.")
rep(3, f)  # a error
cat("\nLast line\n")
sink()  # close the file for output
sink()  # close the file for messages, errors and warnings
```

That is, we call sink two times. Let us have a look at the content of the file:


```
This is a string
... and on a new line

[1] "This is another string"
                   mpg cyl disp  hp drat   wt qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.62 16.5  0  1    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.88 17.0  0  1    4    4
Datsun 710        22.8   4  108  93 3.85 2.32 18.6  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.21 19.4  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.44 17.0  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.46 20.2  1  0    3    1
[1] 1 1 1 1
A message.
Warning message:
A warning. 
Error: object 'f' not found

Last line
Warning message:
In sink() : no sink to remove
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
Error: unexpected symbol in "By the"
Error: unexpected '*' in "*"
Error: unexpected '*' in "*"
Error: unexpected '*' in "*"
Error: unexpected '*' in "*"
Error: unexpected '*' in "*"
Error: unexpected symbol in "The learning"
Error: unexpected '<' in "<"
Error: unexpected '<' in "<"
Error: unexpected '<' in "<"
Error: unexpected '<' in "<"
Error: unexpected symbol in "An excellent"
Error: unexpected '<' in "<"
Error: unexpected '<' in "<"
Error: unexpected '<' in "<"
Error: unexpected '<' in "<"
Error: unexpected '<' in "<"
Error: unexpected symbol in "Mutating joins"
Error: attempt to use zero-length variable name
Error in curl::curl_fetch_memory(url, handle = handle) : 
  Error in the HTTP2 framing layer
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
x Request failed [429]. Retry 1 happens in 3.5 seconds ...
x Request failed [429]. Retry 2 happens in 3.5 seconds ...
x Request failed [429]. Retry 3 happens in 8.2 seconds ...

x Request failed [429]. Retry 1 happens in 2.5 seconds ...
x Request failed [429]. Retry 2 happens in 1.9 seconds ...
x Request failed [429]. Retry 3 happens in 26 seconds ...

x Request failed [429]. Retry 1 happens in 4.2 seconds ...
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
```


## R's native binary format {#r-io-r}

In general, we can differ between two main types of data/files. Information is either binary encoded (basically just 0’s and 1’s) or stored as text files. What we have considered so far is storing data in text files. 

Text files can be read by humans and computers alike. The great thing about plain text is their simplicity and their ease of use: any programming language can read a plain text file. Text files are good for storing tabular data but lacks type-safety, and has limited precision for numeric values. Binary file formats cannot be read by humans but allow space-efficient data compression. Furthermore, binary formats may be difficult to read and write using other programs.

As most other programming languages, R comes with its own binary format. We will focus on the Rds data format which is optimized for speed and compression ratios. To save and read an R object use:


```r
dat <- list(x = c(2, 5, 6), y = "A string", z = mtcars)
saveRDS(dat, file = "test.rds")
readRDS("test.rds")
#> $x
#> [1] 2 5 6
#> 
#> $y
#> [1] "A string"
#> 
#> $z
#>                      mpg cyl  disp  hp drat   wt qsec vs am gear carb
#> Mazda RX4           21.0   6 160.0 110 3.90 2.62 16.5  0  1    4    4
#> Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.88 17.0  0  1    4    4
#> Datsun 710          22.8   4 108.0  93 3.85 2.32 18.6  1  1    4    1
#> Hornet 4 Drive      21.4   6 258.0 110 3.08 3.21 19.4  1  0    3    1
#> Hornet Sportabout   18.7   8 360.0 175 3.15 3.44 17.0  0  0    3    2
#> Valiant             18.1   6 225.0 105 2.76 3.46 20.2  1  0    3    1
#> Duster 360          14.3   8 360.0 245 3.21 3.57 15.8  0  0    3    4
#> Merc 240D           24.4   4 146.7  62 3.69 3.19 20.0  1  0    4    2
#> Merc 230            22.8   4 140.8  95 3.92 3.15 22.9  1  0    4    2
#> Merc 280            19.2   6 167.6 123 3.92 3.44 18.3  1  0    4    4
#> Merc 280C           17.8   6 167.6 123 3.92 3.44 18.9  1  0    4    4
#> Merc 450SE          16.4   8 275.8 180 3.07 4.07 17.4  0  0    3    3
#> Merc 450SL          17.3   8 275.8 180 3.07 3.73 17.6  0  0    3    3
#> Merc 450SLC         15.2   8 275.8 180 3.07 3.78 18.0  0  0    3    3
#> Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.25 18.0  0  0    3    4
#> Lincoln Continental 10.4   8 460.0 215 3.00 5.42 17.8  0  0    3    4
#> Chrysler Imperial   14.7   8 440.0 230 3.23 5.34 17.4  0  0    3    4
#> Fiat 128            32.4   4  78.7  66 4.08 2.20 19.5  1  1    4    1
#> Honda Civic         30.4   4  75.7  52 4.93 1.61 18.5  1  1    4    2
#> Toyota Corolla      33.9   4  71.1  65 4.22 1.83 19.9  1  1    4    1
#> Toyota Corona       21.5   4 120.1  97 3.70 2.46 20.0  1  0    3    1
#> Dodge Challenger    15.5   8 318.0 150 2.76 3.52 16.9  0  0    3    2
#> AMC Javelin         15.2   8 304.0 150 3.15 3.44 17.3  0  0    3    2
#> Camaro Z28          13.3   8 350.0 245 3.73 3.84 15.4  0  0    3    4
#> Pontiac Firebird    19.2   8 400.0 175 3.08 3.85 17.1  0  0    3    2
#> Fiat X1-9           27.3   4  79.0  66 4.08 1.94 18.9  1  1    4    1
#> Porsche 914-2       26.0   4 120.3  91 4.43 2.14 16.7  0  1    5    2
#> Lotus Europa        30.4   4  95.1 113 3.77 1.51 16.9  1  1    5    2
#> Ford Pantera L      15.8   8 351.0 264 4.22 3.17 14.5  0  1    5    4
#> Ferrari Dino        19.7   6 145.0 175 3.62 2.77 15.5  0  1    5    6
#> Maserati Bora       15.0   8 301.0 335 3.54 3.57 14.6  0  1    5    8
#> Volvo 142E          21.4   4 121.0 109 4.11 2.78 18.6  1  1    4    2
```

Note we here have saved a non tabular R object (a list).




## Json {#r-io-json}

[JavaScript Object Notation][wiki-json] (json) is an open standard text file format, and data interchange format, that uses human-readable text to store and transmit data objects consisting of attribute–value pairs and array data types. It can be used to store non tabular data in text format. It is often used for data-exchange in web-apis. 

Let us try to read and write to a json file using the [jsonlite][pkg-jsonlite] package.


```r
library(jsonlite)
dat <- list(x = c(2, 5, 6), y = "A string", z = head(mtcars))
write_json(dat, "test.json", pretty = T)
lst <- read_json("test.json", simplifyDataFrame = T, simplifyVector = T)
lst
#> $x
#> [1] 2 5 6
#> 
#> $y
#> [1] "A string"
#> 
#> $z
#>                    mpg cyl disp  hp drat   wt qsec vs am gear carb
#> Mazda RX4         21.0   6  160 110 3.90 2.62 16.5  0  1    4    4
#> Mazda RX4 Wag     21.0   6  160 110 3.90 2.88 17.0  0  1    4    4
#> Datsun 710        22.8   4  108  93 3.85 2.32 18.6  1  1    4    1
#> Hornet 4 Drive    21.4   6  258 110 3.08 3.21 19.4  1  0    3    1
#> Hornet Sportabout 18.7   8  360 175 3.15 3.44 17.0  0  0    3    2
#> Valiant           18.1   6  225 105 2.76 3.46 20.2  1  0    3    1
```

The content of the json file look likes:


```
{
  "x": [2, 5, 6],
  "y": ["A string"],
  "z": [
    {
      "mpg": 21,
      "cyl": 6,
      "disp": 160,
      "hp": 110,
      "drat": 3.9,
      "wt": 2.62,
      "qsec": 16.46,
      "vs": 0,
      "am": 1,
      "gear": 4,
      "carb": 4,
      "_row": "Mazda RX4"
    },
    {
      "mpg": 21,
      "cyl": 6,
      "disp": 160,
      "hp": 110,
      "drat": 3.9,
      "wt": 2.875,
      "qsec": 17.02,
      "vs": 0,
      "am": 1,
      "gear": 4,
      "carb": 4,
      "_row": "Mazda RX4 Wag"
    },
    {
      "mpg": 22.8,
      "cyl": 4,
      "disp": 108,
      "hp": 93,
      "drat": 3.85,
      "wt": 2.32,
      "qsec": 18.61,
      "vs": 1,
      "am": 1,
      "gear": 4,
      "carb": 1,
      "_row": "Datsun 710"
    },
    {
      "mpg": 21.4,
      "cyl": 6,
      "disp": 258,
      "hp": 110,
      "drat": 3.08,
      "wt": 3.215,
      "qsec": 19.44,
      "vs": 1,
      "am": 0,
      "gear": 3,
      "carb": 1,
      "_row": "Hornet 4 Drive"
    },
    {
      "mpg": 18.7,
      "cyl": 8,
      "disp": 360,
      "hp": 175,
      "drat": 3.15,
      "wt": 3.44,
      "qsec": 17.02,
      "vs": 0,
      "am": 0,
      "gear": 3,
      "carb": 2,
      "_row": "Hornet Sportabout"
    },
    {
      "mpg": 18.1,
      "cyl": 6,
      "disp": 225,
      "hp": 105,
      "drat": 2.76,
      "wt": 3.46,
      "qsec": 20.22,
      "vs": 1,
      "am": 0,
      "gear": 3,
      "carb": 1,
      "_row": "Valiant"
    }
  ]
}
```




## Recap {#rc-r-io}

* For doing data driven analytics you first must import some data. That is, take data from a database, file, web API etc. and transform it into a data frame/table. 

* CSV files contain delimiter separated values in plain text and are often named using the file suffix `.csv`. 

* Each line of a csv file is a data record. Each record consists of one or more fields, separated by a common delimiter (e.g. `,`, `;` or `_`). 

* The [readxl][tidyverse-readxl] package can be used to read Excel files. 

* Writing to an Excel file can be done using the [openxlsx][pkg-openxlsx] package. 

* You can import and export to Google sheets using the [googlesheets4][tidyverse-googlesheets4] package in tidyverse. 

* Use `sink` to save output of you R script.

* There are two main types of data files. Information is either binary encoded or stored as text files. 

* Text files can be read by humans and computers alike. The great thing about plain text is their simplicity and their ease of use: any programming language can read a plain text file. 

* Text files are good for storing tabular data but lacks type-safety, and has limited precision for numeric values. 

* Binary file formats cannot be read by humans but allow space-efficient data compression. Moreover they can be used to save non tabular data.

* As most other programming languages, R comes with its own binary format. We will focus on the Rds data format which are optimized for speed and compression ratios. 

* Json is an open standard text file format, and data interchange format. It can be used to store non tabular data in text format. It is often used for data-exchange in web-api's. 

You may also have a look at the [slides for this module](https://bss-osca.github.io/tfa/slides/07-02_r-io-slides.html).



## Exercises {#ex-r-io}

Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the [help page](#help). Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution!

[Link to the project on RStudio Cloud for this module][r-cloud-mod16]. 

### Exercise (Statistikbanken)

Use the *exercise R markdown template* to solve this exercise (**File > New File > R Markdown...**, select **From template** and then **TFA Exercise**).

You can use the [API](https://api.statbank.dk/console) from [Statistikbanken](https://www.statistikbanken.dk/) to download a lot of data sets. Let us consider airports in Denmark (data set with table id FLYV41):


```r
url <- "https://api.statbank.dk/v1/data/FLYV41/CSV?lang=en&LUFTHAVN=*&Tid=*&Transport=*"
```

   1) Use `cat(read_lines(url, n_max = 3), sep = "\n")` to have a look at the delimiter used.
   
   
   

<div class="modal fade bs-example-modal-lg" id="PTvgRjqcg7fhJJesfPSB" tabindex="-1" role="dialog" aria-labelledby="PTvgRjqcg7fhJJesfPSB-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="PTvgRjqcg7fhJJesfPSB-title">Solution</h4></div><div class="modal-body">

```r
url <- 'https://api.statbank.dk/v1/data/FLYV41/CSV?lang=en&LUFTHAVN=*&Tid=*&Transport=*'
dat <- read_csv2(url)
dat
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#PTvgRjqcg7fhJJesfPSB">Solution</button>
   2) Import the csv file.
   
   
   3) Try to retrieve information and get an overview over the data by running:
      
      ```r
      library(jsonlite)
      url <- "https://api.statbank.dk/v1/tableinfo/FLYV41?lang=en"
      lst <- read_json(url, simplifyVector = T)
      View(lst)
      ```
      Note the data returned is in json format, so we use `read_json` to read the data into a list.
      
      

<div class="modal fade bs-example-modal-lg" id="sSy16popVfXIbZYK28XS" tabindex="-1" role="dialog" aria-labelledby="sSy16popVfXIbZYK28XS-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="sSy16popVfXIbZYK28XS-title">Solution</h4></div><div class="modal-body">

```r
info <- function(tab_id) {
   url <- str_c("https://api.statbank.dk/v1/tableinfo/", tab_id, "?lang=en")
   lst <- read_json(url, simplifyVector = T) 
   return(list(description = lst$description, unit = lst$unit, variables = lst$variables[,1:2]))
}
info("FLYV41")
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#sSy16popVfXIbZYK28XS">Solution</button>

<div class="modal fade bs-example-modal-lg" id="ayLnJ0fOmPhVCTwnRFcd" tabindex="-1" role="dialog" aria-labelledby="ayLnJ0fOmPhVCTwnRFcd-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="ayLnJ0fOmPhVCTwnRFcd-title">Hint 2</h4></div><div class="modal-body">

```r
info <- function(tab_id) {
   url <- str_c(___)
   lst <- read_json(___) 
   return(list(description = lst$___, unit = ___, ___))
}
info("FLYV41")
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ayLnJ0fOmPhVCTwnRFcd">Hint 2</button>

<div class="modal fade bs-example-modal-lg" id="6CMr7tQI3Vf7PxFEt5bZ" tabindex="-1" role="dialog" aria-labelledby="6CMr7tQI3Vf7PxFEt5bZ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="6CMr7tQI3Vf7PxFEt5bZ-title">Hint 1</h4></div><div class="modal-body">

<p>You can modify the code in Question 3 to return only parts of the list.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#6CMr7tQI3Vf7PxFEt5bZ">Hint 1</button>
   
   4) Create a function `info(tab_id)` that returns a list with components `description`, `unit` and `variables` from the information for a data set with table id `tab_id`. 
      
   5) Information about all the data sets can be retrieved using:
      
      ```r
      url <- "https://api.statbank.dk/v1/tables?lang=en"
      lst <- jsonlite::read_json(url, simplifyVector = T)
      View(lst)
      ```
      Have a look at the row for FLYV41.
   
   


<div class="modal fade bs-example-modal-lg" id="kgldsu4cDC6pu7SvjFs4" tabindex="-1" role="dialog" aria-labelledby="kgldsu4cDC6pu7SvjFs4-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="kgldsu4cDC6pu7SvjFs4-title">Solution</h4></div><div class="modal-body">

```r
get_data <- function(tab_id, col_id = NULL) {
   url <- str_c("https://api.statbank.dk/v1/tableinfo/", tab_id, "?lang=en")
   lst <- read_json(url, simplifyVector = T) 
   cols <- lst$variables$id
   if (!is.null(col_id)) cols <- cols[col_id]
   url <- str_c("https://api.statbank.dk/v1/data/", tab_id, "/CSV?lang=en&", str_c(cols, collapse = "=*&"), "=*") %>% 
      URLencode()
   dat <- read_csv2(url)
   return(dat)
}
get_data("FLYV41", 3)
get_data("FLYV41", 1:2)
get_data("FLYV41")
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#kgldsu4cDC6pu7SvjFs4">Solution</button>

<div class="modal fade bs-example-modal-lg" id="m6FwfXHlR9qzReVn18n9" tabindex="-1" role="dialog" aria-labelledby="m6FwfXHlR9qzReVn18n9-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="m6FwfXHlR9qzReVn18n9-title">Hint</h4></div><div class="modal-body">

```r
get_data <- function(tab_id, col_id = NULL) {
   url <- ___
   lst <- ___
   cols <- lst$variables$id
   if (!is.null(col_id)) cols <- cols[___]
   url <- ___
   dat <- ___
   return(dat)
}
get_data("FLYV41", 3)
get_data("FLYV41", 1:2)
get_data("FLYV41")
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#m6FwfXHlR9qzReVn18n9">Hint</button>
   6) Given the information about variables in a data set we can construct the url to retrieve the data in csv format:
      
      ```r
      tab_id <- "FLYV41"
      url <- str_c("https://api.statbank.dk/v1/tableinfo/", tab_id, "?lang=en")
      lst <- read_json(url, simplifyVector = T) 
      col_id <- c(1,3)  # column ids in lst$variables$id
      cols <- lst$variables$id[col_id]
      url <- str_c("https://api.statbank.dk/v1/data/", tab_id, "/CSV?lang=en&", str_c(cols, collapse = "=*&"), "=*") %>% 
         URLencode()
      url
      #> [1] "https://api.statbank.dk/v1/data/FLYV41/CSV?lang=en&LUFTHAVN=*&Tid=*"
      ```
      Create a function `get_data(tab_id, col_id)` that retrieve a data set.
      
      

<div class="modal fade bs-example-modal-lg" id="V6TFLAMkzniE0qEPdDs5" tabindex="-1" role="dialog" aria-labelledby="V6TFLAMkzniE0qEPdDs5-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="V6TFLAMkzniE0qEPdDs5-title">Solution</h4></div><div class="modal-body">

```r
dat <- get_data("FOLK1A", c(2, 3, 5))
dat
write_csv(dat, "test.csv")
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#V6TFLAMkzniE0qEPdDs5">Solution</button>
   
   7) Use the function `get_data` to retrieve data for `tab_id = "FOLK1A"` and `col_id = c(2, 3, 5)` and save it as a csv file with a comma as delimiter.
   
   

<div class="modal fade bs-example-modal-lg" id="UzvAVbzT88WUeZk4r4Ok" tabindex="-1" role="dialog" aria-labelledby="UzvAVbzT88WUeZk4r4Ok-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="UzvAVbzT88WUeZk4r4Ok-title">Solution</h4></div><div class="modal-body">

```r
library(openxlsx)
write.xlsx(dat, "test.xlsx", sheetName = "FOLK1A") 

library(googlesheets4)
gs <- gs4_create("test")
write_sheet(dat, ss = gs, sheet = "FOLK1A")
gs4_browse(gs)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#UzvAVbzT88WUeZk4r4Ok">Solution</button>

<div class="modal fade bs-example-modal-lg" id="hC1xY1DdKpn6DNjDdJP5" tabindex="-1" role="dialog" aria-labelledby="hC1xY1DdKpn6DNjDdJP5-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="hC1xY1DdKpn6DNjDdJP5-title">Hint</h4></div><div class="modal-body">

```r
library(openxlsx)
write.xlsx(___) 

library(googlesheets4)
gs <- gs4_create("test")
write_sheet(___, ss = ___, sheet = "FOLK1A")
gs4_browse(gs)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#hC1xY1DdKpn6DNjDdJP5">Hint</button>
   8) Save the data in an Excel file and a Google sheet.

### Exercise (tuples in OPL)
   
In the algebraic modeling language OPL (Optimization Programming Language) used by [IBM ILOG CPLEX Optimization Studio](https://www.ibm.com/products/ilog-cplex-optimization-studio), you can define tuples to contain various information. For example consider tuples defined as:

```java
tuple nurse {
  string name;
  int experience;   // higest best
}

tuple shift {
   string departmentName;
   string day;
   int startTime;
   int endTime;
}
```

A `nurse` tuple is then defined as `<"Anne", 11>` and a `shift` tuple as `<"Consultation", "Monday" 12, 18>.

A set of tuples can be defined using:

```java
{nurse} nurses = ...;
{shift} shifts = ...;
```

where the `...` operator means that the sets are read from a data text file:

```java
nurses = {
   <"Anne", 11>, 
   <"Bethanie", 4>, 
   <"Betsy", 2>
};

shifts = {
   <"Emergency", "Monday", 2, 8>,
   <"Emergency", Monday 8 12 4 7>, 
   <"Emergency", "Monday" 12 18 2 5> 
};
```

You can now use the sets to define decision variables $x_{ns}$ equal one if nurse $n$ is assigned to shift $s$. 

In this exercise we will try to generate the data text file given tibbles with data.



<div class="modal fade bs-example-modal-lg" id="k3KS7Hy9BH8bhNVGf0VR" tabindex="-1" role="dialog" aria-labelledby="k3KS7Hy9BH8bhNVGf0VR-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="k3KS7Hy9BH8bhNVGf0VR-title">Solution</h4></div><div class="modal-body">

```r
file = "test.dat"
write_lines("nurses = {", file)
write_lines('   <"Anne", 11>', file, append = TRUE)
write_lines('};', file, append = TRUE)
cat(read_file("test.dat"))
#> nurses = {
#>    <"Anne", 11>
#> };
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#k3KS7Hy9BH8bhNVGf0VR">Solution</button>

<div class="modal fade bs-example-modal-lg" id="U6I7PNpJyoXn2PShIRkb" tabindex="-1" role="dialog" aria-labelledby="U6I7PNpJyoXn2PShIRkb-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="U6I7PNpJyoXn2PShIRkb-title">Hint</h4></div><div class="modal-body">

```r
file = "test.dat"
write_lines("nurses = {", file)
write_lines(___, ___, append = TRUE)
write_lines(___, ___, append = TRUE)
cat(read_file("test.dat"))  # to have a look 
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#U6I7PNpJyoXn2PShIRkb">Hint</button>
1) Try to generate a text file named `test.dat` using function `write_lines` with content 

   ```java 
   nurses = {
      <"Anne", 11>
   };
   ```

Load datasets 


```r
# remotes::install_github("bss-osca/tfa/tfa-package", dependencies = FALSE)  # if tfa not installed
library(tfa)
library(tidyverse)
nurses <- read_csv(system.file("extdata/nurses.csv", package = "tfa"))
shifts <- read_csv(system.file("extdata/shifts.csv", package = "tfa"))
```





<div class="modal fade bs-example-modal-lg" id="BdWz4rUjqYLxjg5EM8dI" tabindex="-1" role="dialog" aria-labelledby="BdWz4rUjqYLxjg5EM8dI-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="BdWz4rUjqYLxjg5EM8dI-title">Solution</h4></div><div class="modal-body">

```r
nurses %>%
   mutate(across(where(is.character), ~str_c('"', .x, '"'))) 
#> # A tibble: 32 × 2
#>    name           experience
#>    <chr>               <dbl>
#>  1 "\"Anne\""             11
#>  2 "\"Bethanie\""          4
#>  3 "\"Betsy\""             2
#>  4 "\"Cathy\""             2
#>  5 "\"Cecilia\""           9
#>  6 "\"Chris\""            11
#>  7 "\"Cindy\""             5
#>  8 "\"David\""             1
#>  9 "\"Debbie\""            7
#> 10 "\"Dee\""               3
#> # … with 22 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#BdWz4rUjqYLxjg5EM8dI">Solution</button>

<div class="modal fade bs-example-modal-lg" id="BvqiXLrJN5tV3TjZD5sv" tabindex="-1" role="dialog" aria-labelledby="BvqiXLrJN5tV3TjZD5sv-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="BvqiXLrJN5tV3TjZD5sv-title">Hint 2</h4></div><div class="modal-body">

```r
nurses %>%
   mutate(across(where(___), ~str_c('___', .x, '___'))) 
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#BvqiXLrJN5tV3TjZD5sv">Hint 2</button>

<div class="modal fade bs-example-modal-lg" id="Xjzn1U8FFy2vtZgJjlYd" tabindex="-1" role="dialog" aria-labelledby="Xjzn1U8FFy2vtZgJjlYd-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Xjzn1U8FFy2vtZgJjlYd-title">Hint 1</h4></div><div class="modal-body">

```r
v <- c("foo", "bar")
str_c('"', v, '"')  # use of str_c to add "
#> [1] "\"foo\"" "\"bar\""
str_c(v, collapse = ", ") # collapsing a vector
#> [1] "foo, bar"
tbl <- tribble(
   ~name, ~experience,
   "Anne", 11,
   "Bethanie", 4
)
tbl
#> # A tibble: 2 × 2
#>   name     experience
#>   <chr>         <dbl>
#> 1 Anne             11
#> 2 Bethanie          4
tbl %>% 
   mutate(across(where(is.character), # use across to find all character columns
                 ~str_c('(', .x, ')'))) # str_c is applied to each column where .x is the column values 
#> # A tibble: 2 × 2
#>   name       experience
#>   <chr>           <dbl>
#> 1 (Anne)             11
#> 2 (Bethanie)          4
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Xjzn1U8FFy2vtZgJjlYd">Hint 1</button>

2) Transform all character columns in `nurses` so they start and end with `"`. Some hints are given in Hint 1. 



<div class="modal fade bs-example-modal-lg" id="oJRV8pPDpUc0BwtWJADQ" tabindex="-1" role="dialog" aria-labelledby="oJRV8pPDpUc0BwtWJADQ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="oJRV8pPDpUc0BwtWJADQ-title">Solution</h4></div><div class="modal-body">

```r
nurses %>%
   mutate(across(where(is.character), ~str_c('"', .x, '"'))) %>% 
   unite("tuple", everything(), sep = ", ", remove = FALSE)
#> # A tibble: 32 × 3
#>    tuple             name           experience
#>    <chr>             <chr>               <dbl>
#>  1 "\"Anne\", 11"    "\"Anne\""             11
#>  2 "\"Bethanie\", 4" "\"Bethanie\""          4
#>  3 "\"Betsy\", 2"    "\"Betsy\""             2
#>  4 "\"Cathy\", 2"    "\"Cathy\""             2
#>  5 "\"Cecilia\", 9"  "\"Cecilia\""           9
#>  6 "\"Chris\", 11"   "\"Chris\""            11
#>  7 "\"Cindy\", 5"    "\"Cindy\""             5
#>  8 "\"David\", 1"    "\"David\""             1
#>  9 "\"Debbie\", 7"   "\"Debbie\""            7
#> 10 "\"Dee\", 3"      "\"Dee\""               3
#> # … with 22 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#oJRV8pPDpUc0BwtWJADQ">Solution</button>

<div class="modal fade bs-example-modal-lg" id="bZmSDLHs5lRtvQopJX8I" tabindex="-1" role="dialog" aria-labelledby="bZmSDLHs5lRtvQopJX8I-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="bZmSDLHs5lRtvQopJX8I-title">Hint</h4></div><div class="modal-body">

```r
nurses %>%
   mutate(across(where(is.character), ~str_c('"', .x, '"'))) %>% 
   unite("tuple", everything(), sep = ___, remove = ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#bZmSDLHs5lRtvQopJX8I">Hint</button>

3) Unite all columns into a new column named `tuple` where each column is separated with `,`. Hint: have a look at the `unite` function. All columns can be selected using `everything()`.




<div class="modal fade bs-example-modal-lg" id="nVg1m9e8Xf7VR8OuYHyh" tabindex="-1" role="dialog" aria-labelledby="nVg1m9e8Xf7VR8OuYHyh-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="nVg1m9e8Xf7VR8OuYHyh-title">Solution</h4></div><div class="modal-body">

```r
nurses %>%
   mutate(across(where(is.character), ~str_c('"', .x, '"'))) %>% 
   unite("tuple", everything(), sep = ", ", remove = FALSE) %>% 
   mutate(tuple = str_c("<", tuple, ">"))
#> # A tibble: 32 × 3
#>    tuple               name           experience
#>    <chr>               <chr>               <dbl>
#>  1 "<\"Anne\", 11>"    "\"Anne\""             11
#>  2 "<\"Bethanie\", 4>" "\"Bethanie\""          4
#>  3 "<\"Betsy\", 2>"    "\"Betsy\""             2
#>  4 "<\"Cathy\", 2>"    "\"Cathy\""             2
#>  5 "<\"Cecilia\", 9>"  "\"Cecilia\""           9
#>  6 "<\"Chris\", 11>"   "\"Chris\""            11
#>  7 "<\"Cindy\", 5>"    "\"Cindy\""             5
#>  8 "<\"David\", 1>"    "\"David\""             1
#>  9 "<\"Debbie\", 7>"   "\"Debbie\""            7
#> 10 "<\"Dee\", 3>"      "\"Dee\""               3
#> # … with 22 more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#nVg1m9e8Xf7VR8OuYHyh">Solution</button>

<div class="modal fade bs-example-modal-lg" id="OwpUJyEvmK0BSQjeqHlR" tabindex="-1" role="dialog" aria-labelledby="OwpUJyEvmK0BSQjeqHlR-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="OwpUJyEvmK0BSQjeqHlR-title">Hint</h4></div><div class="modal-body">

```r
nurses %>%
   mutate(across(where(is.character), ~str_c('"', .x, '"'))) %>% 
   unite("tuple", everything(), sep = ", ", remove = FALSE) %>% 
   mutate(tuple = str_c(___, tuple, ___))
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#OwpUJyEvmK0BSQjeqHlR">Hint</button>

4) Add `<` and `>` the start and end of the `tuple` column.




<div class="modal fade bs-example-modal-lg" id="D5Wqr6MgLfeNYuIQCEp3" tabindex="-1" role="dialog" aria-labelledby="D5Wqr6MgLfeNYuIQCEp3-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="D5Wqr6MgLfeNYuIQCEp3-title">Solution</h4></div><div class="modal-body">

```r
nurses %>%
   mutate(across(where(is.character), ~str_c('"', .x, '"'))) %>% 
   unite("tuple", everything(), sep = ", ", remove = FALSE) %>% 
   mutate(tuple = str_c("<", tuple, ">")) %>% 
   pull(tuple) %>% 
   str_c(collapse = ",\n")
#> [1] "<\"Anne\", 11>,\n<\"Bethanie\", 4>,\n<\"Betsy\", 2>,\n<\"Cathy\", 2>,\n<\"Cecilia\", 9>,\n<\"Chris\", 11>,\n<\"Cindy\", 5>,\n<\"David\", 1>,\n<\"Debbie\", 7>,\n<\"Dee\", 3>,\n<\"Gloria\", 8>,\n<\"Isabelle\", 3>,\n<\"Jane\", 3>,\n<\"Janelle\", 4>,\n<\"Janice\", 2>,\n<\"Jemma\", 2>,\n<\"Joan\", 5>,\n<\"Joyce\", 8>,\n<\"Jude\", 4>,\n<\"Julie\", 6>,\n<\"Juliet\", 7>,\n<\"Kate\", 5>,\n<\"Nancy\", 8>,\n<\"Nathalie\", 9>,\n<\"Nicole\", 0>,\n<\"Patricia\", 1>,\n<\"Patrick\", 6>,\n<\"Roberta\", 3>,\n<\"Suzanne\", 5>,\n<\"Vickie\", 7>,\n<\"Wendie\", 5>,\n<\"Zoe\", 8>"
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#D5Wqr6MgLfeNYuIQCEp3">Solution</button>

<div class="modal fade bs-example-modal-lg" id="poiB0OCx5QnhDj3AyjlN" tabindex="-1" role="dialog" aria-labelledby="poiB0OCx5QnhDj3AyjlN-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="poiB0OCx5QnhDj3AyjlN-title">Hint</h4></div><div class="modal-body">

```r
nurses %>%
   mutate(across(where(is.character), ~str_c('"', .x, '"'))) %>% 
   unite("tuple", everything(), sep = ", ", remove = FALSE) %>% 
   mutate(tuple = str_c("<", tuple, ">")) %>% 
   pull(___) %>% 
   str_c(___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#poiB0OCx5QnhDj3AyjlN">Hint</button>

5) Extract the `tuple` column and transform it into a string with `collapse = ",\n"`.




<div class="modal fade bs-example-modal-lg" id="vaJ7JzDBBFYd1GOMGnOn" tabindex="-1" role="dialog" aria-labelledby="vaJ7JzDBBFYd1GOMGnOn-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="vaJ7JzDBBFYd1GOMGnOn-title">Solution</h4></div><div class="modal-body">

```r
write_tuple <- function(dat, file) {
   write_lines("nurses = {", file, sep = "\n   ")
   tuples <- dat %>%
      mutate(across(where(is.character), ~str_c('"', .x, '"'))) %>% 
      unite("tuple", everything(), sep = ", ", remove = FALSE) %>% 
      mutate(tuple = str_c("<", tuple, ">")) %>% 
      pull(tuple) %>% 
      str_c(collapse = ",\n   ")
   write_lines(tuples, file, append = TRUE)
   write_lines("};", file, append = TRUE)
}
file <- "test.dat"
write_tuple(nurses, file)
cat(read_file("test.dat"))  # to have a look 
#> nurses = {
#>    <"Anne", 11>,
#>    <"Bethanie", 4>,
#>    <"Betsy", 2>,
#>    <"Cathy", 2>,
#>    <"Cecilia", 9>,
#>    <"Chris", 11>,
#>    <"Cindy", 5>,
#>    <"David", 1>,
#>    <"Debbie", 7>,
#>    <"Dee", 3>,
#>    <"Gloria", 8>,
#>    <"Isabelle", 3>,
#>    <"Jane", 3>,
#>    <"Janelle", 4>,
#>    <"Janice", 2>,
#>    <"Jemma", 2>,
#>    <"Joan", 5>,
#>    <"Joyce", 8>,
#>    <"Jude", 4>,
#>    <"Julie", 6>,
#>    <"Juliet", 7>,
#>    <"Kate", 5>,
#>    <"Nancy", 8>,
#>    <"Nathalie", 9>,
#>    <"Nicole", 0>,
#>    <"Patricia", 1>,
#>    <"Patrick", 6>,
#>    <"Roberta", 3>,
#>    <"Suzanne", 5>,
#>    <"Vickie", 7>,
#>    <"Wendie", 5>,
#>    <"Zoe", 8>
#> };
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#vaJ7JzDBBFYd1GOMGnOn">Solution</button>

<div class="modal fade bs-example-modal-lg" id="6hIgUqg682oSZSU1PYNJ" tabindex="-1" role="dialog" aria-labelledby="6hIgUqg682oSZSU1PYNJ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="6hIgUqg682oSZSU1PYNJ-title">Hint 2</h4></div><div class="modal-body">

```r
write_tuple <- function(dat, file) {
   write_lines("nurses = {", file, sep = "\n   ")
   tuples <- dat %>%
      ___
   write_lines(tuples, file, append = TRUE)
   write_lines("};", file, append = TRUE)
}
file <- "test.dat"
write_tuple(nurses, file)
cat(read_file("test.dat"))  # to have a look 
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#6hIgUqg682oSZSU1PYNJ">Hint 2</button>

<div class="modal fade bs-example-modal-lg" id="bvI4trOyVRKHir5Rc5RW" tabindex="-1" role="dialog" aria-labelledby="bvI4trOyVRKHir5Rc5RW-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="bvI4trOyVRKHir5Rc5RW-title">Hint 1</h4></div><div class="modal-body">

```r
write_tuple <- function(dat, file) {
   write_lines(___)
   ___
   write_lines("};", ___, ___)
}
file <- "test.dat"
write_tuple(nurses, file)
cat(read_file("test.dat"))  # to have a look 
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#bvI4trOyVRKHir5Rc5RW">Hint 1</button>

6) Create a function `write_tuple` that takes nurses as input and write the tuples to a file.

The name of an object can be extracted as a string using 


```r
deparse(substitute(nurses))
#> [1] "nurses"
```





<div class="modal fade bs-example-modal-lg" id="9mBpfpZHbC2xWvLDKhnx" tabindex="-1" role="dialog" aria-labelledby="9mBpfpZHbC2xWvLDKhnx-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="9mBpfpZHbC2xWvLDKhnx-title">Solution</h4></div><div class="modal-body">

```r
write_tuple <- function(dat, file) {
   name <- deparse(substitute(dat))
   write_lines(str_c(name, " = {"), file, sep = "\n   ")
   tuples <- dat %>%
      mutate(across(where(is.character), ~str_c('"', .x, '"'))) %>% 
      unite("tuple", everything(), sep = ", ", remove = FALSE) %>% 
      mutate(tuple = str_c("<", tuple, ">")) %>% 
      pull(tuple) %>% 
      str_c(collapse = ",\n   ")
   write_lines(tuples, file, append = TRUE)
   write_lines("};", file, append = TRUE)
}
file <- "test.dat"
write_tuple(shifts, file)
cat(read_file("test.dat"))  # to have a look 
#> shifts = {
#>    <"Emergency", "Monday", 2, 8>,
#>    <"Emergency", "Monday", 8, 12>,
#>    <"Emergency", "Monday", 12, 18>,
#>    <"Emergency", "Monday", 18, 2>,
#>    <"Consultation", "Monday", 8, 12>,
#>    <"Consultation", "Monday", 12, 18>,
#>    <"Emergency", "Tuesday", 8, 12>,
#>    <"Emergency", "Tuesday", 12, 18>,
#>    <"Emergency", "Tuesday", 18, 2>,
#>    <"Consultation", "Tuesday", 8, 12>,
#>    <"Consultation", "Tuesday", 12, 18>,
#>    <"Emergency", "Wednesday", 2, 8>,
#>    <"Emergency", "Wednesday", 8, 12>,
#>    <"Emergency", "Wednesday", 12, 18>,
#>    <"Emergency", "Wednesday", 18, 2>,
#>    <"Consultation", "Wednesday", 8, 12>,
#>    <"Consultation", "Wednesday", 12, 18>,
#>    <"Emergency", "Thursday", 2, 8>,
#>    <"Emergency", "Thursday", 8, 12>,
#>    <"Emergency", "Thursday", 12, 18>,
#>    <"Emergency", "Thursday", 18, 2>,
#>    <"Consultation", "Thursday", 8, 12>,
#>    <"Consultation", "Thursday", 12, 18>,
#>    <"Emergency", "Friday", 2, 8>,
#>    <"Emergency", "Friday", 8, 12>,
#>    <"Emergency", "Friday", 12, 18>,
#>    <"Emergency", "Friday", 18, 2>,
#>    <"Consultation", "Friday", 8, 12>,
#>    <"Consultation", "Friday", 12, 18>,
#>    <"Emergency", "Saturday", 2, 12>,
#>    <"Emergency", "Saturday", 12, 20>,
#>    <"Emergency", "Saturday", 20, 2>,
#>    <"Emergency", "Sunday", 2, 12>,
#>    <"Emergency", "Sunday", 12, 20>,
#>    <"Emergency", "Sunday", 20, 2>
#> };
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#9mBpfpZHbC2xWvLDKhnx">Solution</button>

7) Modify `write_tuple` so it works if `shifts` are given as input instead of nurses.





<div class="modal fade bs-example-modal-lg" id="7HCwSWlM3ngGPBie2jRn" tabindex="-1" role="dialog" aria-labelledby="7HCwSWlM3ngGPBie2jRn-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="7HCwSWlM3ngGPBie2jRn-title">Solution</h4></div><div class="modal-body">

```r
write_tuple <- function(dat, file, append = FALSE) {
   name <- deparse(substitute(dat))
   write_lines(str_c("\n", name, " = {"), file, sep = "\n   ", append = append)
   tuples <- dat %>%
      mutate(across(where(is.character), ~str_c('"', .x, '"'))) %>% 
      unite("tuple", everything(), sep = ", ", remove = FALSE) %>% 
      mutate(tuple = str_c("<", tuple, ">")) %>% 
      pull(tuple) %>% 
      str_c(collapse = ",\n   ")
   write_lines(tuples, file, append = TRUE)
   write_lines("};", file, append = TRUE)
}
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#7HCwSWlM3ngGPBie2jRn">Solution</button>

8) Modify `write_tuple` with a new input argument `append` which is false by default. If true, then then the file is not overwritten.





<div class="modal fade bs-example-modal-lg" id="U6LcR4ihJUsLZG0tco41" tabindex="-1" role="dialog" aria-labelledby="U6LcR4ihJUsLZG0tco41-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="U6LcR4ihJUsLZG0tco41-title">Solution</h4></div><div class="modal-body">

```r
file <- "test.dat"
write_tuple(nurses, file)
write_tuple(shifts, file, append = TRUE)
cat(read_file("test.dat"))  # to have a look 
#> 
#> nurses = {
#>    <"Anne", 11>,
#>    <"Bethanie", 4>,
#>    <"Betsy", 2>,
#>    <"Cathy", 2>,
#>    <"Cecilia", 9>,
#>    <"Chris", 11>,
#>    <"Cindy", 5>,
#>    <"David", 1>,
#>    <"Debbie", 7>,
#>    <"Dee", 3>,
#>    <"Gloria", 8>,
#>    <"Isabelle", 3>,
#>    <"Jane", 3>,
#>    <"Janelle", 4>,
#>    <"Janice", 2>,
#>    <"Jemma", 2>,
#>    <"Joan", 5>,
#>    <"Joyce", 8>,
#>    <"Jude", 4>,
#>    <"Julie", 6>,
#>    <"Juliet", 7>,
#>    <"Kate", 5>,
#>    <"Nancy", 8>,
#>    <"Nathalie", 9>,
#>    <"Nicole", 0>,
#>    <"Patricia", 1>,
#>    <"Patrick", 6>,
#>    <"Roberta", 3>,
#>    <"Suzanne", 5>,
#>    <"Vickie", 7>,
#>    <"Wendie", 5>,
#>    <"Zoe", 8>
#> };
#> 
#> shifts = {
#>    <"Emergency", "Monday", 2, 8>,
#>    <"Emergency", "Monday", 8, 12>,
#>    <"Emergency", "Monday", 12, 18>,
#>    <"Emergency", "Monday", 18, 2>,
#>    <"Consultation", "Monday", 8, 12>,
#>    <"Consultation", "Monday", 12, 18>,
#>    <"Emergency", "Tuesday", 8, 12>,
#>    <"Emergency", "Tuesday", 12, 18>,
#>    <"Emergency", "Tuesday", 18, 2>,
#>    <"Consultation", "Tuesday", 8, 12>,
#>    <"Consultation", "Tuesday", 12, 18>,
#>    <"Emergency", "Wednesday", 2, 8>,
#>    <"Emergency", "Wednesday", 8, 12>,
#>    <"Emergency", "Wednesday", 12, 18>,
#>    <"Emergency", "Wednesday", 18, 2>,
#>    <"Consultation", "Wednesday", 8, 12>,
#>    <"Consultation", "Wednesday", 12, 18>,
#>    <"Emergency", "Thursday", 2, 8>,
#>    <"Emergency", "Thursday", 8, 12>,
#>    <"Emergency", "Thursday", 12, 18>,
#>    <"Emergency", "Thursday", 18, 2>,
#>    <"Consultation", "Thursday", 8, 12>,
#>    <"Consultation", "Thursday", 12, 18>,
#>    <"Emergency", "Friday", 2, 8>,
#>    <"Emergency", "Friday", 8, 12>,
#>    <"Emergency", "Friday", 12, 18>,
#>    <"Emergency", "Friday", 18, 2>,
#>    <"Consultation", "Friday", 8, 12>,
#>    <"Consultation", "Friday", 12, 18>,
#>    <"Emergency", "Saturday", 2, 12>,
#>    <"Emergency", "Saturday", 12, 20>,
#>    <"Emergency", "Saturday", 20, 2>,
#>    <"Emergency", "Sunday", 2, 12>,
#>    <"Emergency", "Sunday", 12, 20>,
#>    <"Emergency", "Sunday", 20, 2>
#> };
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#U6LcR4ihJUsLZG0tco41">Solution</button>

9) Write `nurses` and `shifts` to a single data file.






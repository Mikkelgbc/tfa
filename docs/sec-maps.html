<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Module 18 Spatial data and maps | Tools for Analytics (TFA)</title>
  <meta name="description" content="Course notes for the ‘Tools for Analytics’ course" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Module 18 Spatial data and maps | Tools for Analytics (TFA)" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://bss-osca.github.io/tfa/" />
  <meta property="og:image" content="https://bss-osca.github.io/tfa//assets/logo.png" />
  <meta property="og:description" content="Course notes for the ‘Tools for Analytics’ course" />
  <meta name="github-repo" content="bss-osca/tfa" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Module 18 Spatial data and maps | Tools for Analytics (TFA)" />
  
  <meta name="twitter:description" content="Course notes for the ‘Tools for Analytics’ course" />
  <meta name="twitter:image" content="https://bss-osca.github.io/tfa//assets/logo.png" />

<meta name="author" content="Lars Relund Nielsen" />


<meta name="date" content="2021-08-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon" />
<link rel="prev" href="sec-project.html"/>
<link rel="next" href="sec-r-excel.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
<link href="libs/font-awesome-5.3.1/css/all.min.css" rel="stylesheet" />
<link href="libs/font-awesome-5.3.1/css/v4-shims.min.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>
<link href="libs/minichart-0.2.2/minicharts.css" rel="stylesheet" />
<script src="libs/minichart-0.2.2/leaflet.minicharts.min.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.18/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<html>
<head>
<script>
  $(document).ready(function() {

  // Section anchors
  $('.section h1, .section h2, .section h3, .section h4, .section h5').each(function() {
    anchor = '#' + $(this).parent().attr('id');
    $(this).addClass("hasAnchor").prepend('<a href="' + anchor + '" class="anchor"></a>');
  });
});
</script>
<script src="https://hypothes.is/embed.js" async></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</head>
</html>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="img/logo.png"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction to the book</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#lo-intro"><i class="fa fa-check"></i><b>1.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#purpose"><i class="fa fa-check"></i><b>1.2</b> Purpose for the book</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#r-vs-vba"><i class="fa fa-check"></i><b>1.3</b> R vs Excel/VBA</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#computer"><i class="fa fa-check"></i><b>1.4</b> How a computer works</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#organization"><i class="fa fa-check"></i><b>1.5</b> How this book is organized</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#ack"><i class="fa fa-check"></i><b>1.6</b> Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I Getting started with VBA</b></span></li>
<li class="chapter" data-level="2" data-path="sec-vba-intro.html"><a href="sec-vba-intro.html"><i class="fa fa-check"></i><b>2</b> An introduction to VBA</a>
<ul>
<li class="chapter" data-level="2.1" data-path="sec-vba-intro.html"><a href="sec-vba-intro.html#lo-vba-intro"><i class="fa fa-check"></i><b>2.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="2.2" data-path="sec-vba-intro.html"><a href="sec-vba-intro.html#vba-what"><i class="fa fa-check"></i><b>2.2</b> What is VBA</a></li>
<li class="chapter" data-level="2.3" data-path="sec-vba-intro.html"><a href="sec-vba-intro.html#vba-hello"><i class="fa fa-check"></i><b>2.3</b> Your first program</a></li>
<li class="chapter" data-level="2.4" data-path="sec-vba-intro.html"><a href="sec-vba-intro.html#vba-macro"><i class="fa fa-check"></i><b>2.4</b> The macro recorder</a></li>
<li class="chapter" data-level="2.5" data-path="sec-vba-intro.html"><a href="sec-vba-intro.html#a-short-overview"><i class="fa fa-check"></i><b>2.5</b> A short overview</a></li>
<li class="chapter" data-level="2.6" data-path="sec-vba-intro.html"><a href="sec-vba-intro.html#rc-vba-intro"><i class="fa fa-check"></i><b>2.6</b> Recap</a></li>
<li class="chapter" data-level="2.7" data-path="sec-vba-intro.html"><a href="sec-vba-intro.html#ex-vba-intro"><i class="fa fa-check"></i><b>2.7</b> Exercises</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="sec-vba-intro.html"><a href="sec-vba-intro.html#ex-vba-hello"><i class="fa fa-check"></i><b>2.7.1</b> Exercise - Hello</a></li>
<li class="chapter" data-level="2.7.2" data-path="sec-vba-intro.html"><a href="sec-vba-intro.html#ex-vba-macro"><i class="fa fa-check"></i><b>2.7.2</b> Exercise - Record a macro</a></li>
<li class="chapter" data-level="2.7.3" data-path="sec-vba-intro.html"><a href="sec-vba-intro.html#ex-vba-user-input"><i class="fa fa-check"></i><b>2.7.3</b> Exercise - User input</a></li>
<li class="chapter" data-level="2.7.4" data-path="sec-vba-intro.html"><a href="sec-vba-intro.html#ex-vba-max-min"><i class="fa fa-check"></i><b>2.7.4</b> Exercise - Max and min number</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Programming in VBA</b></span></li>
<li class="chapter" data-level="3" data-path="data-types-varables.html"><a href="data-types-varables.html"><i class="fa fa-check"></i><b>3</b> Data types - Varables</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-types-varables.html"><a href="data-types-varables.html#learning-outcomes"><i class="fa fa-check"></i><b>3.1</b> Learning outcomes</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="procedures-and-functions.html"><a href="procedures-and-functions.html"><i class="fa fa-check"></i><b>4</b> Procedures and functions</a>
<ul>
<li class="chapter" data-level="4.1" data-path="procedures-and-functions.html"><a href="procedures-and-functions.html#learning-outcomes-1"><i class="fa fa-check"></i><b>4.1</b> Learning outcomes</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="loops-and-conditionals.html"><a href="loops-and-conditionals.html"><i class="fa fa-check"></i><b>5</b> Loops and conditionals</a>
<ul>
<li class="chapter" data-level="5.1" data-path="loops-and-conditionals.html"><a href="loops-and-conditionals.html#learning-outcomes-2"><i class="fa fa-check"></i><b>5.1</b> Learning outcomes</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="object-model.html"><a href="object-model.html"><i class="fa fa-check"></i><b>6</b> Object model</a>
<ul>
<li class="chapter" data-level="6.1" data-path="object-model.html"><a href="object-model.html#learning-outcomes-3"><i class="fa fa-check"></i><b>6.1</b> Learning outcomes</a></li>
</ul></li>
<li class="part"><span><b>III Randomization in VBA</b></span></li>
<li class="chapter" data-level="7" data-path="generating-random-values.html"><a href="generating-random-values.html"><i class="fa fa-check"></i><b>7</b> Generating random values</a>
<ul>
<li class="chapter" data-level="7.1" data-path="generating-random-values.html"><a href="generating-random-values.html#learning-outcomes-4"><i class="fa fa-check"></i><b>7.1</b> Learning outcomes</a></li>
</ul></li>
<li class="part"><span><b>IV Extra topics in VBA</b></span></li>
<li class="chapter" data-level="8" data-path="file-management.html"><a href="file-management.html"><i class="fa fa-check"></i><b>8</b> File management</a>
<ul>
<li class="chapter" data-level="8.1" data-path="file-management.html"><a href="file-management.html#learning-outcomes-5"><i class="fa fa-check"></i><b>8.1</b> Learning outcomes</a></li>
</ul></li>
<li class="part"><span><b>V Getting started in R</b></span></li>
<li class="chapter" data-level="9" data-path="sec-install.html"><a href="sec-install.html"><i class="fa fa-check"></i><b>9</b> Install R and RStudio</a>
<ul>
<li class="chapter" data-level="9.1" data-path="sec-install.html"><a href="sec-install.html#lo-install"><i class="fa fa-check"></i><b>9.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="9.2" data-path="sec-install.html"><a href="sec-install.html#install-r"><i class="fa fa-check"></i><b>9.2</b> Install R and RStudio</a></li>
<li class="chapter" data-level="9.3" data-path="sec-install.html"><a href="sec-install.html#test-your-installation"><i class="fa fa-check"></i><b>9.3</b> Test your installation</a></li>
<li class="chapter" data-level="9.4" data-path="sec-install.html"><a href="sec-install.html#add-on-packages"><i class="fa fa-check"></i><b>9.4</b> Add-on packages</a></li>
<li class="chapter" data-level="9.5" data-path="sec-install.html"><a href="sec-install.html#lp-install"><i class="fa fa-check"></i><b>9.5</b> Different learning paths</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="sec-r-basics.html"><a href="sec-r-basics.html"><i class="fa fa-check"></i><b>10</b> R basics and workflows</a>
<ul>
<li class="chapter" data-level="" data-path="sec-r-basics.html"><a href="sec-r-basics.html#learning-path-diagramme"><i class="fa fa-check"></i>Learning path diagramme</a></li>
<li class="chapter" data-level="10.1" data-path="sec-r-basics.html"><a href="sec-r-basics.html#lo-r-basics"><i class="fa fa-check"></i><b>10.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="10.2" data-path="sec-r-basics.html"><a href="sec-r-basics.html#working-with-r-at-the-command-line-in-rstudio"><i class="fa fa-check"></i><b>10.2</b> Working with R at the command line in RStudio</a></li>
<li class="chapter" data-level="10.3" data-path="sec-r-basics.html"><a href="sec-r-basics.html#your-first-datacamp-course"><i class="fa fa-check"></i><b>10.3</b> Your first DataCamp course</a></li>
<li class="chapter" data-level="10.4" data-path="sec-r-basics.html"><a href="sec-r-basics.html#pipes"><i class="fa fa-check"></i><b>10.4</b> Pipes</a></li>
<li class="chapter" data-level="10.5" data-path="sec-r-basics.html"><a href="sec-r-basics.html#rprojs"><i class="fa fa-check"></i><b>10.5</b> RStudio projects</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="sec-r-basics.html"><a href="sec-r-basics.html#storing-your-code-in-a-script-file"><i class="fa fa-check"></i><b>10.5.1</b> Storing your code in a script file</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="sec-r-basics.html"><a href="sec-r-basics.html#global-options"><i class="fa fa-check"></i><b>10.6</b> Global options</a></li>
<li class="chapter" data-level="10.7" data-path="sec-r-basics.html"><a href="sec-r-basics.html#working-directory"><i class="fa fa-check"></i><b>10.7</b> Working directory</a></li>
<li class="chapter" data-level="10.8" data-path="sec-r-basics.html"><a href="sec-r-basics.html#lp-r-basics"><i class="fa fa-check"></i><b>10.8</b> Different learning paths</a></li>
<li class="chapter" data-level="10.9" data-path="sec-r-basics.html"><a href="sec-r-basics.html#rc-r-basics"><i class="fa fa-check"></i><b>10.9</b> Recap</a></li>
<li class="chapter" data-level="10.10" data-path="sec-r-basics.html"><a href="sec-r-basics.html#ex-r-basics"><i class="fa fa-check"></i><b>10.10</b> Exercises</a>
<ul>
<li class="chapter" data-level="10.10.1" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-group-work"><i class="fa fa-check"></i><b>10.10.1</b> Exercise (group work)</a></li>
<li class="chapter" data-level="10.10.2" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-install-packages"><i class="fa fa-check"></i><b>10.10.2</b> Exercise (install packages)</a></li>
<li class="chapter" data-level="10.10.3" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-piping"><i class="fa fa-check"></i><b>10.10.3</b> Exercise (piping)</a></li>
<li class="chapter" data-level="10.10.4" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-working-dir"><i class="fa fa-check"></i><b>10.10.4</b> Exercise (working dir)</a></li>
<li class="chapter" data-level="10.10.5" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-vectors"><i class="fa fa-check"></i><b>10.10.5</b> Exercise (vectors)</a></li>
<li class="chapter" data-level="10.10.6" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-matrices"><i class="fa fa-check"></i><b>10.10.6</b> Exercise (matrices)</a></li>
<li class="chapter" data-level="10.10.7" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-data-frames"><i class="fa fa-check"></i><b>10.10.7</b> Exercise (data frames)</a></li>
<li class="chapter" data-level="10.10.8" data-path="sec-r-basics.html"><a href="sec-r-basics.html#exercise-lists"><i class="fa fa-check"></i><b>10.10.8</b> Exercise (lists)</a></li>
<li class="chapter" data-level="10.10.9" data-path="sec-r-basics.html"><a href="sec-r-basics.html#ex-strings"><i class="fa fa-check"></i><b>10.10.9</b> Exercise (string management)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VI Programming in R</b></span></li>
<li class="chapter" data-level="11" data-path="sec-loops.html"><a href="sec-loops.html"><i class="fa fa-check"></i><b>11</b> Loops and conditionals</a>
<ul>
<li class="chapter" data-level="" data-path="sec-loops.html"><a href="sec-loops.html#learning-path-diagramme-1"><i class="fa fa-check"></i>Learning path diagramme</a></li>
<li class="chapter" data-level="11.1" data-path="sec-loops.html"><a href="sec-loops.html#lo-loops"><i class="fa fa-check"></i><b>11.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="11.2" data-path="sec-loops.html"><a href="sec-loops.html#conditionals-and-control-flow"><i class="fa fa-check"></i><b>11.2</b> Conditionals and control flow</a></li>
<li class="chapter" data-level="11.3" data-path="sec-loops.html"><a href="sec-loops.html#loops"><i class="fa fa-check"></i><b>11.3</b> Loops</a></li>
<li class="chapter" data-level="11.4" data-path="sec-loops.html"><a href="sec-loops.html#lp-loops"><i class="fa fa-check"></i><b>11.4</b> Different learning paths</a></li>
<li class="chapter" data-level="11.5" data-path="sec-loops.html"><a href="sec-loops.html#rc-loops"><i class="fa fa-check"></i><b>11.5</b> Recap</a></li>
<li class="chapter" data-level="11.6" data-path="sec-loops.html"><a href="sec-loops.html#ex-loops"><i class="fa fa-check"></i><b>11.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="sec-loops.html"><a href="sec-loops.html#exercise-conditional-expressions"><i class="fa fa-check"></i><b>11.6.1</b> Exercise (conditional expressions)</a></li>
<li class="chapter" data-level="11.6.2" data-path="sec-loops.html"><a href="sec-loops.html#exercise-loops"><i class="fa fa-check"></i><b>11.6.2</b> Exercise (loops)</a></li>
<li class="chapter" data-level="11.6.3" data-path="sec-loops.html"><a href="sec-loops.html#ex-dist"><i class="fa fa-check"></i><b>11.6.3</b> Exercise (calculating distances)</a></li>
<li class="chapter" data-level="11.6.4" data-path="sec-loops.html"><a href="sec-loops.html#exercise-expand_grid"><i class="fa fa-check"></i><b>11.6.4</b> Exercise (<code>expand_grid</code>)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="sec-functions.html"><a href="sec-functions.html"><i class="fa fa-check"></i><b>12</b> Functions</a>
<ul>
<li class="chapter" data-level="12.1" data-path="sec-functions.html"><a href="sec-functions.html#lo-functions"><i class="fa fa-check"></i><b>12.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="12.2" data-path="sec-functions.html"><a href="sec-functions.html#datacamp-course"><i class="fa fa-check"></i><b>12.2</b> DataCamp course</a></li>
<li class="chapter" data-level="12.3" data-path="sec-functions.html"><a href="sec-functions.html#functions-returning-multiple-objects"><i class="fa fa-check"></i><b>12.3</b> Functions returning multiple objects</a></li>
<li class="chapter" data-level="12.4" data-path="sec-functions.html"><a href="sec-functions.html#the-...-argument"><i class="fa fa-check"></i><b>12.4</b> The <code>...</code> argument</a></li>
<li class="chapter" data-level="12.5" data-path="sec-functions.html"><a href="sec-functions.html#documenting-your-functions"><i class="fa fa-check"></i><b>12.5</b> Documenting your functions</a></li>
<li class="chapter" data-level="12.6" data-path="sec-functions.html"><a href="sec-functions.html#lp-functions"><i class="fa fa-check"></i><b>12.6</b> Different learning paths</a></li>
<li class="chapter" data-level="12.7" data-path="sec-functions.html"><a href="sec-functions.html#rc-functions"><i class="fa fa-check"></i><b>12.7</b> Recap</a></li>
<li class="chapter" data-level="12.8" data-path="sec-functions.html"><a href="sec-functions.html#ex-functions"><i class="fa fa-check"></i><b>12.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="12.8.1" data-path="sec-functions.html"><a href="sec-functions.html#exercise-defining-functions"><i class="fa fa-check"></i><b>12.8.1</b> Exercise (defining functions)</a></li>
<li class="chapter" data-level="12.8.2" data-path="sec-functions.html"><a href="sec-functions.html#exercise-scope"><i class="fa fa-check"></i><b>12.8.2</b> Exercise (scope)</a></li>
<li class="chapter" data-level="12.8.3" data-path="sec-functions.html"><a href="sec-functions.html#exercise-job-sequencing"><i class="fa fa-check"></i><b>12.8.3</b> Exercise (job sequencing)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VII IO, tidy and transform</b></span></li>
<li class="chapter" data-level="13" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html"><i class="fa fa-check"></i><b>13</b> Introduction to tidyverse and R Markdown</a>
<ul>
<li class="chapter" data-level="13.1" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#lo-tidy-intro"><i class="fa fa-check"></i><b>13.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="13.2" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#the-tidyverse-package"><i class="fa fa-check"></i><b>13.2</b> The tidyverse package</a></li>
<li class="chapter" data-level="13.3" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#writing-reproducible-reports"><i class="fa fa-check"></i><b>13.3</b> Writing reproducible reports</a></li>
<li class="chapter" data-level="13.4" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#tibbles"><i class="fa fa-check"></i><b>13.4</b> Tibbles</a></li>
<li class="chapter" data-level="13.5" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#lp-tidy-intro"><i class="fa fa-check"></i><b>13.5</b> Different learning paths</a></li>
<li class="chapter" data-level="13.6" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#rc-tidy-intro"><i class="fa fa-check"></i><b>13.6</b> Recap</a></li>
<li class="chapter" data-level="13.7" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#ex-tidy-intro"><i class="fa fa-check"></i><b>13.7</b> Exercises</a>
<ul>
<li class="chapter" data-level="13.7.1" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#exercise-your-first-r-markdown-exercise"><i class="fa fa-check"></i><b>13.7.1</b> Exercise (your first R Markdown exercise)</a></li>
<li class="chapter" data-level="13.7.2" data-path="sec-tidy-intro.html"><a href="sec-tidy-intro.html#exercise-tibbles"><i class="fa fa-check"></i><b>13.7.2</b> Exercise (tibbles)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="sec-io.html"><a href="sec-io.html"><i class="fa fa-check"></i><b>14</b> Importing and exporting data</a>
<ul>
<li class="chapter" data-level="14.1" data-path="sec-io.html"><a href="sec-io.html#lo-io"><i class="fa fa-check"></i><b>14.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="14.2" data-path="sec-io.html"><a href="sec-io.html#csv-files"><i class="fa fa-check"></i><b>14.2</b> CSV files</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="sec-io.html"><a href="sec-io.html#reading-a-csv-file"><i class="fa fa-check"></i><b>14.2.1</b> Reading a CSV file</a></li>
<li class="chapter" data-level="14.2.2" data-path="sec-io.html"><a href="sec-io.html#writing-to-csv-files"><i class="fa fa-check"></i><b>14.2.2</b> Writing to CSV files</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="sec-io.html"><a href="sec-io.html#excel"><i class="fa fa-check"></i><b>14.3</b> Excel</a></li>
<li class="chapter" data-level="14.4" data-path="sec-io.html"><a href="sec-io.html#google-sheets"><i class="fa fa-check"></i><b>14.4</b> Google Sheets</a></li>
<li class="chapter" data-level="14.5" data-path="sec-io.html"><a href="sec-io.html#text-files"><i class="fa fa-check"></i><b>14.5</b> Text files</a></li>
<li class="chapter" data-level="14.6" data-path="sec-io.html"><a href="sec-io.html#rs-native-binary-format"><i class="fa fa-check"></i><b>14.6</b> R’s native binary format</a></li>
<li class="chapter" data-level="14.7" data-path="sec-io.html"><a href="sec-io.html#json"><i class="fa fa-check"></i><b>14.7</b> Json</a></li>
<li class="chapter" data-level="14.8" data-path="sec-io.html"><a href="sec-io.html#lp-io"><i class="fa fa-check"></i><b>14.8</b> Different learning paths</a></li>
<li class="chapter" data-level="14.9" data-path="sec-io.html"><a href="sec-io.html#rc-io"><i class="fa fa-check"></i><b>14.9</b> Recap</a></li>
<li class="chapter" data-level="14.10" data-path="sec-io.html"><a href="sec-io.html#ex-io"><i class="fa fa-check"></i><b>14.10</b> Exercises</a>
<ul>
<li class="chapter" data-level="14.10.1" data-path="sec-io.html"><a href="sec-io.html#exercise-statistikbanken"><i class="fa fa-check"></i><b>14.10.1</b> Exercise (Statistikbanken)</a></li>
<li class="chapter" data-level="14.10.2" data-path="sec-io.html"><a href="sec-io.html#exercise-tuples-in-opl"><i class="fa fa-check"></i><b>14.10.2</b> Exercise (tuples in OPL)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="sec-transform.html"><a href="sec-transform.html"><i class="fa fa-check"></i><b>15</b> Transforming data</a>
<ul>
<li class="chapter" data-level="15.1" data-path="sec-transform.html"><a href="sec-transform.html#lo-transform"><i class="fa fa-check"></i><b>15.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="15.2" data-path="sec-transform.html"><a href="sec-transform.html#working-with-data-in-the-tidyverse"><i class="fa fa-check"></i><b>15.2</b> Working with data in the tidyverse</a></li>
<li class="chapter" data-level="15.3" data-path="sec-transform.html"><a href="sec-transform.html#mutating-and-filtering-joins"><i class="fa fa-check"></i><b>15.3</b> Mutating and filtering joins</a></li>
<li class="chapter" data-level="15.4" data-path="sec-transform.html"><a href="sec-transform.html#lp-transform"><i class="fa fa-check"></i><b>15.4</b> Different learning paths</a></li>
<li class="chapter" data-level="15.5" data-path="sec-transform.html"><a href="sec-transform.html#rc-transform"><i class="fa fa-check"></i><b>15.5</b> Recap</a></li>
<li class="chapter" data-level="15.6" data-path="sec-transform.html"><a href="sec-transform.html#ex-transform"><i class="fa fa-check"></i><b>15.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="15.6.1" data-path="sec-transform.html"><a href="sec-transform.html#ex-gapminder1"><i class="fa fa-check"></i><b>15.6.1</b> Exercise (gapminder)</a></li>
<li class="chapter" data-level="15.6.2" data-path="sec-transform.html"><a href="sec-transform.html#ex-babynames1"><i class="fa fa-check"></i><b>15.6.2</b> Exercise (babynames)</a></li>
<li class="chapter" data-level="15.6.3" data-path="sec-transform.html"><a href="sec-transform.html#ex-profit1"><i class="fa fa-check"></i><b>15.6.3</b> Exercise (profit)</a></li>
<li class="chapter" data-level="15.6.4" data-path="sec-transform.html"><a href="sec-transform.html#ex-fish"><i class="fa fa-check"></i><b>15.6.4</b> Exercise (fisheries)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VIII Visualization</b></span></li>
<li class="chapter" data-level="16" data-path="sec-plot.html"><a href="sec-plot.html"><i class="fa fa-check"></i><b>16</b> Data visualization using ggplot</a>
<ul>
<li class="chapter" data-level="16.1" data-path="sec-plot.html"><a href="sec-plot.html#lo-plot"><i class="fa fa-check"></i><b>16.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="16.2" data-path="sec-plot.html"><a href="sec-plot.html#introduction-to-data-visualization"><i class="fa fa-check"></i><b>16.2</b> Introduction to data visualization</a></li>
<li class="chapter" data-level="16.3" data-path="sec-plot.html"><a href="sec-plot.html#combining-plots-into-one-using-patchwork"><i class="fa fa-check"></i><b>16.3</b> Combining plots into one using <em>patchwork</em></a></li>
<li class="chapter" data-level="16.4" data-path="sec-plot.html"><a href="sec-plot.html#saving-graphics"><i class="fa fa-check"></i><b>16.4</b> Saving graphics</a></li>
<li class="chapter" data-level="16.5" data-path="sec-plot.html"><a href="sec-plot.html#lp-r-plot"><i class="fa fa-check"></i><b>16.5</b> Different learning paths</a></li>
<li class="chapter" data-level="16.6" data-path="sec-plot.html"><a href="sec-plot.html#rc-r-plot"><i class="fa fa-check"></i><b>16.6</b> Recap</a></li>
<li class="chapter" data-level="16.7" data-path="sec-plot.html"><a href="sec-plot.html#ex-r-plot"><i class="fa fa-check"></i><b>16.7</b> Exercises</a>
<ul>
<li class="chapter" data-level="16.7.1" data-path="sec-plot.html"><a href="sec-plot.html#ex-gapminder2"><i class="fa fa-check"></i><b>16.7.1</b> Exercise (gapminder)</a></li>
<li class="chapter" data-level="16.7.2" data-path="sec-plot.html"><a href="sec-plot.html#ex-profit2"><i class="fa fa-check"></i><b>16.7.2</b> Exercise (profit)</a></li>
<li class="chapter" data-level="16.7.3" data-path="sec-plot.html"><a href="sec-plot.html#ex-covid19"><i class="fa fa-check"></i><b>16.7.3</b> Exercise (COVID-19)</a></li>
<li class="chapter" data-level="16.7.4" data-path="sec-plot.html"><a href="sec-plot.html#ex-lego"><i class="fa fa-check"></i><b>16.7.4</b> Exercise (Lego and sales)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IX R project in groups</b></span></li>
<li class="chapter" data-level="17" data-path="sec-project.html"><a href="sec-project.html"><i class="fa fa-check"></i><b>17</b> Mandatory R project</a>
<ul>
<li class="chapter" data-level="17.1" data-path="sec-project.html"><a href="sec-project.html#lo-project"><i class="fa fa-check"></i><b>17.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="17.2" data-path="sec-project.html"><a href="sec-project.html#r-project"><i class="fa fa-check"></i><b>17.2</b> R project</a></li>
</ul></li>
<li class="part"><span><b>X Extra</b></span></li>
<li class="chapter" data-level="18" data-path="sec-maps.html"><a href="sec-maps.html"><i class="fa fa-check"></i><b>18</b> Spatial data and maps</a>
<ul>
<li class="chapter" data-level="18.1" data-path="sec-maps.html"><a href="sec-maps.html#lo-maps"><i class="fa fa-check"></i><b>18.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="18.2" data-path="sec-maps.html"><a href="sec-maps.html#sec-map-api-key"><i class="fa fa-check"></i><b>18.2</b> Services for obtatining spatial data</a></li>
<li class="chapter" data-level="18.3" data-path="sec-maps.html"><a href="sec-maps.html#calculating-distances"><i class="fa fa-check"></i><b>18.3</b> Calculating distances</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="sec-maps.html"><a href="sec-maps.html#using-google-maps"><i class="fa fa-check"></i><b>18.3.1</b> Using Google Maps</a></li>
<li class="chapter" data-level="18.3.2" data-path="sec-maps.html"><a href="sec-maps.html#using-bing-maps"><i class="fa fa-check"></i><b>18.3.2</b> Using Bing Maps</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="sec-maps.html"><a href="sec-maps.html#geocoding-and-reverse-geocoding"><i class="fa fa-check"></i><b>18.4</b> Geocoding and reverse geocoding</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="sec-maps.html"><a href="sec-maps.html#using-google-maps-1"><i class="fa fa-check"></i><b>18.4.1</b> Using Google maps</a></li>
<li class="chapter" data-level="18.4.2" data-path="sec-maps.html"><a href="sec-maps.html#use-bing-maps"><i class="fa fa-check"></i><b>18.4.2</b> Use Bing Maps</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="sec-maps.html"><a href="sec-maps.html#adding-markers-and-routes-to-a-map"><i class="fa fa-check"></i><b>18.5</b> Adding markers and routes to a map</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="sec-r-excel.html"><a href="sec-r-excel.html"><i class="fa fa-check"></i><b>19</b> Using R in Excel and Excel in R</a></li>
<li class="chapter" data-level="20" data-path="sec-opl.html"><a href="sec-opl.html"><i class="fa fa-check"></i><b>20</b> Run an OPL model from R</a></li>
<li class="chapter" data-level="21" data-path="sec-simulation.html"><a href="sec-simulation.html"><i class="fa fa-check"></i><b>21</b> Simulation in R</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="groups.html"><a href="groups.html"><i class="fa fa-check"></i><b>A</b> Working in groups</a>
<ul>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#r-project-structure"><i class="fa fa-check"></i>R project structure</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#using-git"><i class="fa fa-check"></i>Using Git together with GitHub</a>
<ul>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#register-a-free-github-account"><i class="fa fa-check"></i>Register a free GitHub account</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#install-git"><i class="fa fa-check"></i>Install Git</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#check-your-installation"><i class="fa fa-check"></i>Check your installation</a></li>
<li class="chapter" data-level="" data-path="groups.html"><a href="groups.html#setup-projects-using-git-and-github"><i class="fa fa-check"></i>Setup projects using Git and GitHub</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="annotate.html"><a href="annotate.html"><i class="fa fa-check"></i><b>B</b> Annotate the course notes</a></li>
<li class="chapter" data-level="C" data-path="help.html"><a href="help.html"><i class="fa fa-check"></i><b>C</b> Getting help</a></li>
<li class="chapter" data-level="D" data-path="slides.html"><a href="slides.html"><i class="fa fa-check"></i><b>D</b> Slides</a></li>
<li class="chapter" data-level="E" data-path="lg-course.html"><a href="lg-course.html"><i class="fa fa-check"></i><b>E</b> Learning goals</a></li>
<li class="chapter" data-level="F" data-path="sec-ba.html"><a href="sec-ba.html"><i class="fa fa-check"></i><b>F</b> Business Analytics</a></li>
<li class="chapter" data-level="G" data-path="colophon.html"><a href="colophon.html"><i class="fa fa-check"></i><b>G</b> Colophon</a></li>
<li class="divider"></li>
<li><center>
  <a rel="license" href="./index.html#ack">
    License: CC BY-NC-SA<br>
    <i class = "fab fa-creative-commons fa-2x"></i>
    <i class = "fab fa-creative-commons-by fa-2x"></i>
    <i class = "fab fa-creative-commons-nc fa-2x"></i>
    <i class = "fab fa-creative-commons-sa fa-2x"></i>
  </a>
</li></center>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tools for Analytics (TFA)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sec-maps" class="section level1" number="18">
<h1><span class="header-section-number">Module 18</span> Spatial data and maps</h1>
<p>Spatial data, also known as geospatial data, is a term used to describe any data related to or containing information about a specific location on a surface (often a map). We will consider <em>distance matrix</em> calculations for finding the shortest distance/travel time between a set of origins and destinations, <em>geocoding</em> which is the process of converting an address to geographic coordinates (latitude, longitude) and <em>reverse geocoding</em> which is the opposite process of converting a location as described by geographic coordinates (latitude, longitude) to a human-readable address or place name. Finally, we consider how to display spatial data on a map.</p>
<div id="lo-maps" class="section level2" number="18.1">
<h2><span class="header-section-number">18.1</span> Learning outcomes</h2>
<p>By the end of this module, you are expected to be able to:</p>
<ul>
<li>Calculate euclidean, manhattan, etc. distances.</li>
<li>Calculate a distance matrix, i.e. shortest paths between places using the Google and Bing API.</li>
<li>Geocode an address using the Google and Bing API.</li>
<li>Add markers and routes (lines) on a map.</li>
</ul>
<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->
</div>
<div id="sec-map-api-key" class="section level2" number="18.2">
<h2><span class="header-section-number">18.2</span> Services for obtatining spatial data</h2>
<p>Often you need to connect to a service using an API for obtaining spatial data. The most common is Google and Bing (Microsoft) and to use the services you need an API key. Another service is also <a href="https://developer.here.com/">Here</a>.</p>
<p>If you use Google Maps you can obtain an API key <a href="https://cloud.google.com/maps-platform/">here</a>. Modest to light use is free; however, you need a valid credit card. Note you must enable the APIs you intend to use. Google in fact has several services for geo-related solutions. For example, the Maps Static API provides map images, while the Geocoding API provides geocoding and reverse geocoding services. You need to enable the APIs before you use them. You will only need to do that once, and then they will be ready for you to use. Enabling the APIs just means clicking a few radio buttons on the Google Maps Platform web interface.</p>
<p>We will be using the <strong>ggmap</strong> package for Google services. You can add the API key using:</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="sec-maps.html#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb446-2"><a href="sec-maps.html#cb446-2" aria-hidden="true" tabindex="-1"></a><span class="fu">register_google</span>(<span class="at">key =</span> <span class="st">&quot;[your key]&quot;</span>, <span class="at">write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb446-3"><a href="sec-maps.html#cb446-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.getenv</span>(<span class="st">&quot;GGMAP_GOOGLE_API_KEY&quot;</span>)</span></code></pre></div>
<p>Note the key is stored in the environment object <code>GGMAP_GOOGLE_API_KEY</code>. Moreover, it is saved in the file <code>.Renviron</code> so that it is automatically reloaded when you restart R.</p>
<p>If you use Bing Maps you can obtain an API key <a href="https://www.bingmapsportal.com/">here</a>. No credit card is needed. You can add the API key using:</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="sec-maps.html#cb447-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">edit_r_environ</span>()  <span class="co"># opens the .Renviron file</span></span>
<span id="cb447-2"><a href="sec-maps.html#cb447-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">BING_MAPS_API_KEY=</span>[your key]) <span class="co"># so you don&#39;t have to restart R</span></span></code></pre></div>
<p>Add the line <code>BING_MAPS_API_KEY=[your key]</code> and save the file.</p>
<p>Note your API keys is private and unique to you, so be careful not to share it online!</p>
</div>
<div id="calculating-distances" class="section level2" number="18.3">
<h2><span class="header-section-number">18.3</span> Calculating distances</h2>
<p>If you need to calculate euclidean, manhattan, etc. distances, you can use the <code>dist</code> R function:</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="sec-maps.html#cb448-1" aria-hidden="true" tabindex="-1"></a>coord <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>, <span class="dv">0</span>,<span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>, <span class="dv">1</span>,<span class="dv">1</span>), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb448-2"><a href="sec-maps.html#cb448-2" aria-hidden="true" tabindex="-1"></a>coord</span>
<span id="cb448-3"><a href="sec-maps.html#cb448-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2]</span></span>
<span id="cb448-4"><a href="sec-maps.html#cb448-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]    0    0</span></span>
<span id="cb448-5"><a href="sec-maps.html#cb448-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]    0    1</span></span>
<span id="cb448-6"><a href="sec-maps.html#cb448-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,]    1    0</span></span>
<span id="cb448-7"><a href="sec-maps.html#cb448-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,]    1    1</span></span>
<span id="cb448-8"><a href="sec-maps.html#cb448-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dist</span>(coord)</span>
<span id="cb448-9"><a href="sec-maps.html#cb448-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      1    2    3</span></span>
<span id="cb448-10"><a href="sec-maps.html#cb448-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 1.00          </span></span>
<span id="cb448-11"><a href="sec-maps.html#cb448-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 1.00 1.41     </span></span>
<span id="cb448-12"><a href="sec-maps.html#cb448-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 1.41 1.00 1.00</span></span>
<span id="cb448-13"><a href="sec-maps.html#cb448-13" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(<span class="fu">dist</span>(coord))</span>
<span id="cb448-14"><a href="sec-maps.html#cb448-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      1    2    3    4</span></span>
<span id="cb448-15"><a href="sec-maps.html#cb448-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0.00 1.00 1.00 1.41</span></span>
<span id="cb448-16"><a href="sec-maps.html#cb448-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 1.00 0.00 1.41 1.00</span></span>
<span id="cb448-17"><a href="sec-maps.html#cb448-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 1.00 1.41 0.00 1.00</span></span>
<span id="cb448-18"><a href="sec-maps.html#cb448-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 1.41 1.00 1.00 0.00</span></span></code></pre></div>
<p>However, euclidean distances are often a poor approximation of shortest path lengths.</p>
<div id="using-google-maps" class="section level3" number="18.3.1">
<h3><span class="header-section-number">18.3.1</span> Using Google Maps</h3>
<p>Remember to have <a href="sec-maps.html#sec-map-api-key">set your API key</a> and activate the <em>Distance Matrix API</em> service on the Google Cloud Platform. We consider the following places:</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="sec-maps.html#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb449-2"><a href="sec-maps.html#cb449-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb449-3"><a href="sec-maps.html#cb449-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb449-4"><a href="sec-maps.html#cb449-4" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>Id,              <span class="sc">~</span>Shop,                                        <span class="sc">~</span>Address,</span>
<span id="cb449-5"><a href="sec-maps.html#cb449-5" aria-hidden="true" tabindex="-1"></a>       1L,    <span class="st">&quot;Bilka Esbjerg&quot;</span>,          <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>,</span>
<span id="cb449-6"><a href="sec-maps.html#cb449-6" aria-hidden="true" tabindex="-1"></a>       2L,    <span class="st">&quot;Bilka Herning&quot;</span>,              <span class="st">&quot;Golfvej 5, 7400 Herning, Denmark&quot;</span>,</span>
<span id="cb449-7"><a href="sec-maps.html#cb449-7" aria-hidden="true" tabindex="-1"></a>       3L,   <span class="st">&quot;Bilka Hillerød&quot;</span>,     <span class="st">&quot;Slotsarkaderne 26, 3400 Hillerød, Denmark&quot;</span>,</span>
<span id="cb449-8"><a href="sec-maps.html#cb449-8" aria-hidden="true" tabindex="-1"></a>       4L,   <span class="st">&quot;Bilka Hjørring&quot;</span>,  <span class="st">&quot;A.F Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>,</span>
<span id="cb449-9"><a href="sec-maps.html#cb449-9" aria-hidden="true" tabindex="-1"></a>       5L,  <span class="st">&quot;Bilka Holstebro&quot;</span>,         <span class="st">&quot;Nyholmvej 20, 7500 Holstebro, Denmark&quot;</span>,</span>
<span id="cb449-10"><a href="sec-maps.html#cb449-10" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb449-11"><a href="sec-maps.html#cb449-11" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb449-12"><a href="sec-maps.html#cb449-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 3</span></span>
<span id="cb449-13"><a href="sec-maps.html#cb449-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Id Shop            Address                                     </span></span>
<span id="cb449-14"><a href="sec-maps.html#cb449-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;                                       </span></span>
<span id="cb449-15"><a href="sec-maps.html#cb449-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark        </span></span>
<span id="cb449-16"><a href="sec-maps.html#cb449-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark            </span></span>
<span id="cb449-17"><a href="sec-maps.html#cb449-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark   </span></span>
<span id="cb449-18"><a href="sec-maps.html#cb449-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark</span></span>
<span id="cb449-19"><a href="sec-maps.html#cb449-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark</span></span></code></pre></div>
<p>To calculate a distance matrix we use the <code>mapdist</code> function:</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="sec-maps.html#cb450-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mapdist</span>(<span class="at">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb450-2"><a href="sec-maps.html#cb450-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">to =</span> <span class="st">&quot;Golfvej 5, 7400 Herning, Denmark&quot;</span>)</span>
<span id="cb450-3"><a href="sec-maps.html#cb450-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 9</span></span>
<span id="cb450-4"><a href="sec-maps.html#cb450-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   from                                 to                  m    km miles seconds minutes hours mode </span></span>
<span id="cb450-5"><a href="sec-maps.html#cb450-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span id="cb450-6"><a href="sec-maps.html#cb450-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark Golfvej 5, 740… 85637  85.6  53.2    4407    73.4  1.22 driv…</span></span></code></pre></div>
<p>Note Google returns results for the fastest path between the two points. Let us try to define a function which calculate all the distances:</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="sec-maps.html#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calculate the distance matrix in long format.</span></span>
<span id="cb451-2"><a href="sec-maps.html#cb451-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb451-3"><a href="sec-maps.html#cb451-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param address A vector of addresses.</span></span>
<span id="cb451-4"><a href="sec-maps.html#cb451-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param mode Driving, bicycling, walking, or transit.</span></span>
<span id="cb451-5"><a href="sec-maps.html#cb451-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param symmetric Use symmetric distances (half the number of queries).</span></span>
<span id="cb451-6"><a href="sec-maps.html#cb451-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A data frame with the results</span></span>
<span id="cb451-7"><a href="sec-maps.html#cb451-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @note The API returns results for the fastest route.  </span></span>
<span id="cb451-8"><a href="sec-maps.html#cb451-8" aria-hidden="true" tabindex="-1"></a>goo_calc_distances <span class="ot">&lt;-</span> <span class="cf">function</span>(address, <span class="at">mode =</span> <span class="st">&quot;driving&quot;</span>, <span class="at">symmetric =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb451-9"><a href="sec-maps.html#cb451-9" aria-hidden="true" tabindex="-1"></a>   datDist <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">id_from =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(address), <span class="at">id_to =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(address))</span>
<span id="cb451-10"><a href="sec-maps.html#cb451-10" aria-hidden="true" tabindex="-1"></a>   datDist <span class="ot">&lt;-</span> datDist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(id_from <span class="sc">!=</span> id_to)</span>
<span id="cb451-11"><a href="sec-maps.html#cb451-11" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (symmetric) datDist <span class="ot">&lt;-</span> datDist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(id_from <span class="sc">&lt;</span> id_to)</span>
<span id="cb451-12"><a href="sec-maps.html#cb451-12" aria-hidden="true" tabindex="-1"></a>   datDist <span class="ot">&lt;-</span> datDist <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">from =</span> address[id_from], <span class="at">to =</span> address[id_to])</span>
<span id="cb451-13"><a href="sec-maps.html#cb451-13" aria-hidden="true" tabindex="-1"></a>   res <span class="ot">&lt;-</span> <span class="fu">mapdist</span>(<span class="at">from =</span> datDist <span class="sc">%&gt;%</span> <span class="fu">pull</span>(from), <span class="at">to =</span> datDist <span class="sc">%&gt;%</span> <span class="fu">pull</span>(to), <span class="at">mode =</span> mode)</span>
<span id="cb451-14"><a href="sec-maps.html#cb451-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(<span class="fu">left_join</span>(datDist, res, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;from&quot;</span>, <span class="st">&quot;to&quot;</span>)))</span>
<span id="cb451-15"><a href="sec-maps.html#cb451-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb451-16"><a href="sec-maps.html#cb451-16" aria-hidden="true" tabindex="-1"></a>datDistGoo <span class="ot">&lt;-</span> <span class="fu">goo_calc_distances</span>(dat<span class="sc">$</span>Address)</span>
<span id="cb451-17"><a href="sec-maps.html#cb451-17" aria-hidden="true" tabindex="-1"></a>datDistGoo</span>
<span id="cb451-18"><a href="sec-maps.html#cb451-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 11</span></span>
<span id="cb451-19"><a href="sec-maps.html#cb451-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    id_from id_to from               to                     m    km miles seconds minutes hours mode </span></span>
<span id="cb451-20"><a href="sec-maps.html#cb451-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      &lt;int&gt; &lt;int&gt; &lt;chr&gt;              &lt;chr&gt;              &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span id="cb451-21"><a href="sec-maps.html#cb451-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1       1     2 Stormgade 157, 67… Golfvej 5, 7400 …  85637  85.6  53.2    4407    73.4 1.22  driv…</span></span>
<span id="cb451-22"><a href="sec-maps.html#cb451-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2       1     3 Stormgade 157, 67… Slotsarkaderne 2… 321175 321.  200.    11677   195.  3.24  driv…</span></span>
<span id="cb451-23"><a href="sec-maps.html#cb451-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3       1     4 Stormgade 157, 67… A.F Heidemannsve… 322236 322.  200.    10923   182.  3.03  driv…</span></span>
<span id="cb451-24"><a href="sec-maps.html#cb451-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4       1     5 Stormgade 157, 67… Nyholmvej 20, 75… 103720 104.   64.5    5295    88.2 1.47  driv…</span></span>
<span id="cb451-25"><a href="sec-maps.html#cb451-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5       2     3 Golfvej 5, 7400 H… Slotsarkaderne 2… 491579 492.  305.    17258   288.  4.79  driv…</span></span>
<span id="cb451-26"><a href="sec-maps.html#cb451-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6       2     4 Golfvej 5, 7400 H… A.F Heidemannsve… 374866 375.  233.    13408   223.  3.72  driv…</span></span>
<span id="cb451-27"><a href="sec-maps.html#cb451-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7       2     5 Golfvej 5, 7400 H… Nyholmvej 20, 75… 332587 333.  207.    12044   201.  3.35  driv…</span></span>
<span id="cb451-28"><a href="sec-maps.html#cb451-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8       3     4 Slotsarkaderne 26… A.F Heidemannsve… 178212 178.  111.     7725   129.  2.15  driv…</span></span>
<span id="cb451-29"><a href="sec-maps.html#cb451-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9       3     5 Slotsarkaderne 26… Nyholmvej 20, 75…  44036  44.0  27.4    1811    30.2 0.503 driv…</span></span>
<span id="cb451-30"><a href="sec-maps.html#cb451-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10       4     5 A.F Heidemannsvej… Nyholmvej 20, 75… 181238 181.  113.     7698   128.  2.14  driv…</span></span></code></pre></div>
<p>Note that only the calculated distances are returned. If you want to have the whole distance matrix we define function:</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="sec-maps.html#cb452-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Convert the data frame returned from calling a `___calc_distances` function to a distance matrix.</span></span>
<span id="cb452-2"><a href="sec-maps.html#cb452-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb452-3"><a href="sec-maps.html#cb452-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param dat The data frame returned from calling `___calc_distances`.</span></span>
<span id="cb452-4"><a href="sec-maps.html#cb452-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param value_col The column containing the distances.</span></span>
<span id="cb452-5"><a href="sec-maps.html#cb452-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return The distance matrix</span></span>
<span id="cb452-6"><a href="sec-maps.html#cb452-6" aria-hidden="true" tabindex="-1"></a>as_dist_matrix <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, value_col) {</span>
<span id="cb452-7"><a href="sec-maps.html#cb452-7" aria-hidden="true" tabindex="-1"></a>   lgt <span class="ot">&lt;-</span> <span class="fu">max</span>(dat<span class="sc">$</span>id_from, dat<span class="sc">$</span>id_to)</span>
<span id="cb452-8"><a href="sec-maps.html#cb452-8" aria-hidden="true" tabindex="-1"></a>   distanceMat<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow=</span>lgt, <span class="at">ncol =</span> lgt)</span>
<span id="cb452-9"><a href="sec-maps.html#cb452-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">diag</span>(distanceMat) <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb452-10"><a href="sec-maps.html#cb452-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dat), <span class="cf">function</span>(r) {</span>
<span id="cb452-11"><a href="sec-maps.html#cb452-11" aria-hidden="true" tabindex="-1"></a>      distanceMat[dat<span class="sc">$</span>id_from[r], dat<span class="sc">$</span>id_to[r]] <span class="ot">&lt;&lt;-</span> dat[[value_col]][r]</span>
<span id="cb452-12"><a href="sec-maps.html#cb452-12" aria-hidden="true" tabindex="-1"></a>   })</span>
<span id="cb452-13"><a href="sec-maps.html#cb452-13" aria-hidden="true" tabindex="-1"></a>   idx <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">is.na</span>(distanceMat), <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb452-14"><a href="sec-maps.html#cb452-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(idx), <span class="cf">function</span>(r) {</span>
<span id="cb452-15"><a href="sec-maps.html#cb452-15" aria-hidden="true" tabindex="-1"></a>      distanceMat[idx[r, <span class="st">&quot;row&quot;</span>], idx[r, <span class="st">&quot;col&quot;</span>]] <span class="ot">&lt;&lt;-</span> distanceMat[idx[r, <span class="st">&quot;col&quot;</span>], idx[r, <span class="st">&quot;row&quot;</span>]]</span>
<span id="cb452-16"><a href="sec-maps.html#cb452-16" aria-hidden="true" tabindex="-1"></a>   })</span>
<span id="cb452-17"><a href="sec-maps.html#cb452-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(distanceMat)</span>
<span id="cb452-18"><a href="sec-maps.html#cb452-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb452-19"><a href="sec-maps.html#cb452-19" aria-hidden="true" tabindex="-1"></a><span class="fu">as_dist_matrix</span>(datDistGoo, <span class="st">&quot;km&quot;</span>)  <span class="co"># distances in km</span></span>
<span id="cb452-20"><a href="sec-maps.html#cb452-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       [,1]  [,2] [,3] [,4] [,5]</span></span>
<span id="cb452-21"><a href="sec-maps.html#cb452-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]   0.0  85.6  321  322  104</span></span>
<span id="cb452-22"><a href="sec-maps.html#cb452-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]  85.6   0.0  492  375  333</span></span>
<span id="cb452-23"><a href="sec-maps.html#cb452-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] 321.2 491.6    0  178   44</span></span>
<span id="cb452-24"><a href="sec-maps.html#cb452-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] 322.2 374.9  178    0  181</span></span>
<span id="cb452-25"><a href="sec-maps.html#cb452-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,] 103.7 332.6   44  181    0</span></span>
<span id="cb452-26"><a href="sec-maps.html#cb452-26" aria-hidden="true" tabindex="-1"></a><span class="fu">as_dist_matrix</span>(datDistGoo, <span class="st">&quot;seconds&quot;</span>)  <span class="co"># travel time in seconds </span></span>
<span id="cb452-27"><a href="sec-maps.html#cb452-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       [,1]  [,2]  [,3]  [,4]  [,5]</span></span>
<span id="cb452-28"><a href="sec-maps.html#cb452-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]     0  4407 11677 10923  5295</span></span>
<span id="cb452-29"><a href="sec-maps.html#cb452-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]  4407     0 17258 13408 12044</span></span>
<span id="cb452-30"><a href="sec-maps.html#cb452-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] 11677 17258     0  7725  1811</span></span>
<span id="cb452-31"><a href="sec-maps.html#cb452-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] 10923 13408  7725     0  7698</span></span>
<span id="cb452-32"><a href="sec-maps.html#cb452-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,]  5295 12044  1811  7698     0</span></span></code></pre></div>
</div>
<div id="using-bing-maps" class="section level3" number="18.3.2">
<h3><span class="header-section-number">18.3.2</span> Using Bing Maps</h3>
<p>Remember to have <a href="sec-maps.html#sec-map-api-key">set your API key</a>. We first define a <code>bing_mapdist</code> function:</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="sec-maps.html#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb453-2"><a href="sec-maps.html#cb453-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Distance between two locations.</span></span>
<span id="cb453-3"><a href="sec-maps.html#cb453-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb453-4"><a href="sec-maps.html#cb453-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param from From address.</span></span>
<span id="cb453-5"><a href="sec-maps.html#cb453-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param to To address.</span></span>
<span id="cb453-6"><a href="sec-maps.html#cb453-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param mode Walking, driving or transit.</span></span>
<span id="cb453-7"><a href="sec-maps.html#cb453-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param optimize Optimize either `distance` or `time`.</span></span>
<span id="cb453-8"><a href="sec-maps.html#cb453-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return</span></span>
<span id="cb453-9"><a href="sec-maps.html#cb453-9" aria-hidden="true" tabindex="-1"></a>bing_mapdist <span class="ot">&lt;-</span> <span class="cf">function</span>(from, to, <span class="at">mode =</span> <span class="st">&quot;driving&quot;</span>, <span class="at">optimize =</span> <span class="st">&quot;time&quot;</span>) {</span>
<span id="cb453-10"><a href="sec-maps.html#cb453-10" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (<span class="fu">is.data.frame</span>(from)) {</span>
<span id="cb453-11"><a href="sec-maps.html#cb453-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">c</span>(<span class="st">&quot;from&quot;</span>, <span class="st">&quot;to&quot;</span>) <span class="sc">%in%</span> <span class="fu">names</span>(from)))</span>
<span id="cb453-12"><a href="sec-maps.html#cb453-12" aria-hidden="true" tabindex="-1"></a>     from_to_df <span class="ot">&lt;-</span> from <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">&quot;from&quot;</span>, <span class="st">&quot;to&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb453-13"><a href="sec-maps.html#cb453-13" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb453-14"><a href="sec-maps.html#cb453-14" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span> {</span>
<span id="cb453-15"><a href="sec-maps.html#cb453-15" aria-hidden="true" tabindex="-1"></a>     from_to_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">from =</span> from, <span class="at">to =</span> to)</span>
<span id="cb453-16"><a href="sec-maps.html#cb453-16" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb453-17"><a href="sec-maps.html#cb453-17" aria-hidden="true" tabindex="-1"></a>   dat <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(from_to_df), <span class="cf">function</span>(r) {</span>
<span id="cb453-18"><a href="sec-maps.html#cb453-18" aria-hidden="true" tabindex="-1"></a>      url <span class="ot">&lt;-</span> </span>
<span id="cb453-19"><a href="sec-maps.html#cb453-19" aria-hidden="true" tabindex="-1"></a>         <span class="fu">str_c</span>(<span class="st">&quot;http://dev.virtualearth.net/REST/V1/Routes/&quot;</span>, mode, <span class="st">&quot;?wp.0=&quot;</span>, from_to_df<span class="sc">$</span>from[r], <span class="st">&quot;&amp;wp.1=&quot;</span>, from_to_df<span class="sc">$</span>to[r], </span>
<span id="cb453-20"><a href="sec-maps.html#cb453-20" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;&amp;optimize=&quot;</span>, optimize, <span class="st">&quot;&amp;ra=excludeItinerary&amp;rpo=None&amp;ig=false&amp;du=km&quot;</span>, </span>
<span id="cb453-21"><a href="sec-maps.html#cb453-21" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;&amp;avoid=minimizeTolls&amp;key=&quot;</span>, <span class="fu">Sys.getenv</span>(<span class="st">&quot;BING_MAPS_API_KEY&quot;</span>))</span>
<span id="cb453-22"><a href="sec-maps.html#cb453-22" aria-hidden="true" tabindex="-1"></a>      url <span class="ot">&lt;-</span> <span class="fu">URLencode</span>(url)</span>
<span id="cb453-23"><a href="sec-maps.html#cb453-23" aria-hidden="true" tabindex="-1"></a>      lst <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(url)</span>
<span id="cb453-24"><a href="sec-maps.html#cb453-24" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (lst<span class="sc">$</span>statusCode <span class="sc">!=</span> <span class="dv">200</span>) <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">km =</span> <span class="cn">NA</span>, <span class="at">seconds =</span> <span class="cn">NA</span>, <span class="at">mode =</span> <span class="cn">NA</span>))</span>
<span id="cb453-25"><a href="sec-maps.html#cb453-25" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">&lt;-</span> lst<span class="sc">$</span>resourceSets<span class="sc">$</span>resources[[<span class="dv">1</span>]]</span>
<span id="cb453-26"><a href="sec-maps.html#cb453-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">km =</span> df<span class="sc">$</span>travelDistance, <span class="at">seconds =</span> df<span class="sc">$</span>travelDuration, <span class="at">mode =</span> df<span class="sc">$</span>travelMode))</span>
<span id="cb453-27"><a href="sec-maps.html#cb453-27" aria-hidden="true" tabindex="-1"></a>   })</span>
<span id="cb453-28"><a href="sec-maps.html#cb453-28" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(<span class="fu">bind_cols</span>(from_to_df, dat))</span>
<span id="cb453-29"><a href="sec-maps.html#cb453-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb453-30"><a href="sec-maps.html#cb453-30" aria-hidden="true" tabindex="-1"></a><span class="fu">bing_mapdist</span>(<span class="at">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb453-31"><a href="sec-maps.html#cb453-31" aria-hidden="true" tabindex="-1"></a>             <span class="at">to =</span> <span class="st">&quot;A.F Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>)</span>
<span id="cb453-32"><a href="sec-maps.html#cb453-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 5</span></span>
<span id="cb453-33"><a href="sec-maps.html#cb453-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   from                                 to                                          km seconds mode  </span></span>
<span id="cb453-34"><a href="sec-maps.html#cb453-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;                                    &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt; </span></span>
<span id="cb453-35"><a href="sec-maps.html#cb453-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark A.F Heidemannsvej 20, 9800 Hjørring, De…  322.    9960 Drivi…</span></span>
<span id="cb453-36"><a href="sec-maps.html#cb453-36" aria-hidden="true" tabindex="-1"></a><span class="fu">bing_mapdist</span>(<span class="at">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb453-37"><a href="sec-maps.html#cb453-37" aria-hidden="true" tabindex="-1"></a>             <span class="at">to =</span> <span class="st">&quot;A.F Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>, </span>
<span id="cb453-38"><a href="sec-maps.html#cb453-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">optimize =</span> <span class="st">&quot;distance&quot;</span>)</span>
<span id="cb453-39"><a href="sec-maps.html#cb453-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 5</span></span>
<span id="cb453-40"><a href="sec-maps.html#cb453-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   from                                 to                                          km seconds mode  </span></span>
<span id="cb453-41"><a href="sec-maps.html#cb453-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;                                    &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt; </span></span>
<span id="cb453-42"><a href="sec-maps.html#cb453-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark A.F Heidemannsvej 20, 9800 Hjørring, De…  257.   14085 Drivi…</span></span></code></pre></div>
<p>Note we here can get both the shortest and fastest path between two points. Next, we use the <code>bing_mapdist</code> function for calculating distances:</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="sec-maps.html#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calculate the distance matrix in long format.</span></span>
<span id="cb454-2"><a href="sec-maps.html#cb454-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb454-3"><a href="sec-maps.html#cb454-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param address A vector of addresses.</span></span>
<span id="cb454-4"><a href="sec-maps.html#cb454-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param symmetric Use symmetric distances (only half the number of queries).</span></span>
<span id="cb454-5"><a href="sec-maps.html#cb454-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param ... Further parameters passed to `bing_mapdist`.</span></span>
<span id="cb454-6"><a href="sec-maps.html#cb454-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A data frame with the results</span></span>
<span id="cb454-7"><a href="sec-maps.html#cb454-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @note The API returns results for the fastest route.  </span></span>
<span id="cb454-8"><a href="sec-maps.html#cb454-8" aria-hidden="true" tabindex="-1"></a>bing_calc_distances <span class="ot">&lt;-</span> <span class="cf">function</span>(address, <span class="at">symmetric =</span> <span class="cn">TRUE</span>, ...) {</span>
<span id="cb454-9"><a href="sec-maps.html#cb454-9" aria-hidden="true" tabindex="-1"></a>   datDist <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">id_from =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(address), <span class="at">id_to =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(address))</span>
<span id="cb454-10"><a href="sec-maps.html#cb454-10" aria-hidden="true" tabindex="-1"></a>   datDist <span class="ot">&lt;-</span> datDist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(id_from <span class="sc">!=</span> id_to)</span>
<span id="cb454-11"><a href="sec-maps.html#cb454-11" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (symmetric) datDist <span class="ot">&lt;-</span> datDist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(id_from <span class="sc">&lt;</span> id_to)</span>
<span id="cb454-12"><a href="sec-maps.html#cb454-12" aria-hidden="true" tabindex="-1"></a>   datDist <span class="ot">&lt;-</span> datDist <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">from =</span> address[id_from], <span class="at">to =</span> address[id_to])</span>
<span id="cb454-13"><a href="sec-maps.html#cb454-13" aria-hidden="true" tabindex="-1"></a>   res <span class="ot">&lt;-</span> <span class="fu">bing_mapdist</span>(datDist <span class="sc">%&gt;%</span> <span class="fu">select</span>(from, to), ...)</span>
<span id="cb454-14"><a href="sec-maps.html#cb454-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(<span class="fu">bind_cols</span>(datDist <span class="sc">%&gt;%</span>  <span class="fu">select</span>(id_from, id_to), res))</span>
<span id="cb454-15"><a href="sec-maps.html#cb454-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb454-16"><a href="sec-maps.html#cb454-16" aria-hidden="true" tabindex="-1"></a>datDistBing <span class="ot">&lt;-</span> <span class="fu">bing_calc_distances</span>(dat<span class="sc">$</span>Address)</span>
<span id="cb454-17"><a href="sec-maps.html#cb454-17" aria-hidden="true" tabindex="-1"></a>datDistBing</span>
<span id="cb454-18"><a href="sec-maps.html#cb454-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 7</span></span>
<span id="cb454-19"><a href="sec-maps.html#cb454-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    id_from id_to from                                         to                    km seconds mode </span></span>
<span id="cb454-20"><a href="sec-maps.html#cb454-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      &lt;int&gt; &lt;int&gt; &lt;chr&gt;                                        &lt;chr&gt;              &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb454-21"><a href="sec-maps.html#cb454-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1       1     2 Stormgade 157, 6715 Esbjerg, Denmark         Golfvej 5, 7400 H…  87.7    4595 Driv…</span></span>
<span id="cb454-22"><a href="sec-maps.html#cb454-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2       1     3 Stormgade 157, 6715 Esbjerg, Denmark         Slotsarkaderne 26… 322.    10422 Driv…</span></span>
<span id="cb454-23"><a href="sec-maps.html#cb454-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3       1     4 Stormgade 157, 6715 Esbjerg, Denmark         A.F Heidemannsvej… 322.     9960 Driv…</span></span>
<span id="cb454-24"><a href="sec-maps.html#cb454-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4       1     5 Stormgade 157, 6715 Esbjerg, Denmark         Nyholmvej 20, 750… 123.     5788 Driv…</span></span>
<span id="cb454-25"><a href="sec-maps.html#cb454-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5       2     3 Golfvej 5, 7400 Herning, Denmark             Slotsarkaderne 26… 334.    10640 Driv…</span></span>
<span id="cb454-26"><a href="sec-maps.html#cb454-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6       2     4 Golfvej 5, 7400 Herning, Denmark             A.F Heidemannsvej… 187.     7926 Driv…</span></span>
<span id="cb454-27"><a href="sec-maps.html#cb454-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7       2     5 Golfvej 5, 7400 Herning, Denmark             Nyholmvej 20, 750…  44.2    1744 Driv…</span></span>
<span id="cb454-28"><a href="sec-maps.html#cb454-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8       3     4 Slotsarkaderne 26, 3400 Hillerød, Denmark    A.F Heidemannsvej… 397.    17197 Driv…</span></span>
<span id="cb454-29"><a href="sec-maps.html#cb454-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9       3     5 Slotsarkaderne 26, 3400 Hillerød, Denmark    Nyholmvej 20, 750… 375.    12118 Driv…</span></span>
<span id="cb454-30"><a href="sec-maps.html#cb454-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10       4     5 A.F Heidemannsvej 20, 9800 Hjørring, Denmark Nyholmvej 20, 750… 194.     8237 Driv…</span></span></code></pre></div>
<p>Note in general results from the API services are based on a set of assumptions and hence the results from different services may not be the same. You may use the different services to check if the distances are correct, by checking the results from different services:</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="sec-maps.html#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Difference in minutes</span></span>
<span id="cb455-2"><a href="sec-maps.html#cb455-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abs</span>(<span class="fu">as_dist_matrix</span>(datDistGoo, <span class="st">&quot;seconds&quot;</span>) <span class="sc">-</span> <span class="fu">as_dist_matrix</span>(datDistBing, <span class="st">&quot;seconds&quot;</span>))<span class="sc">/</span><span class="dv">60</span></span>
<span id="cb455-3"><a href="sec-maps.html#cb455-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       [,1]   [,2]  [,3]   [,4]   [,5]</span></span>
<span id="cb455-4"><a href="sec-maps.html#cb455-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]  0.00   3.13  20.9  16.05   8.22</span></span>
<span id="cb455-5"><a href="sec-maps.html#cb455-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]  3.13   0.00 110.3  91.37 171.67</span></span>
<span id="cb455-6"><a href="sec-maps.html#cb455-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] 20.92 110.30   0.0 157.87 171.78</span></span>
<span id="cb455-7"><a href="sec-maps.html#cb455-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] 16.05  91.37 157.9   0.00   8.98</span></span>
<span id="cb455-8"><a href="sec-maps.html#cb455-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,]  8.22 171.67 171.8   8.98   0.00</span></span>
<span id="cb455-9"><a href="sec-maps.html#cb455-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Km from 1 to 3</span></span>
<span id="cb455-10"><a href="sec-maps.html#cb455-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mapdist</span>(<span class="at">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb455-11"><a href="sec-maps.html#cb455-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">to =</span> <span class="st">&quot;Slotsarkaderne 26, 3400 Hillerød, Denmark&quot;</span>)</span>
<span id="cb455-12"><a href="sec-maps.html#cb455-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 9</span></span>
<span id="cb455-13"><a href="sec-maps.html#cb455-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   from                                 to                  m    km miles seconds minutes hours mode </span></span>
<span id="cb455-14"><a href="sec-maps.html#cb455-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span id="cb455-15"><a href="sec-maps.html#cb455-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark Slotsarkadern… 321175  321.  200.   11677    195.  3.24 driv…</span></span>
<span id="cb455-16"><a href="sec-maps.html#cb455-16" aria-hidden="true" tabindex="-1"></a><span class="fu">bing_mapdist</span>(<span class="at">from =</span> <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>, </span>
<span id="cb455-17"><a href="sec-maps.html#cb455-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">to =</span> <span class="st">&quot;Slotsarkaderne 26, 3400 Hillerød, Denmark&quot;</span>)</span>
<span id="cb455-18"><a href="sec-maps.html#cb455-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 5</span></span>
<span id="cb455-19"><a href="sec-maps.html#cb455-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   from                                 to                                           km seconds mode </span></span>
<span id="cb455-20"><a href="sec-maps.html#cb455-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                &lt;chr&gt;                                     &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb455-21"><a href="sec-maps.html#cb455-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Stormgade 157, 6715 Esbjerg, Denmark Slotsarkaderne 26, 3400 Hillerød, Denmark  322.   10422 Driv…</span></span></code></pre></div>
</div>
</div>
<div id="geocoding-and-reverse-geocoding" class="section level2" number="18.4">
<h2><span class="header-section-number">18.4</span> Geocoding and reverse geocoding</h2>
<div id="using-google-maps-1" class="section level3" number="18.4.1">
<h3><span class="header-section-number">18.4.1</span> Using Google maps</h3>
<p>Remember to enable the <em>Geocoding API</em>. To get the coordinates of an address we use the <code>geocode</code> function:</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="sec-maps.html#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geocode</span>(<span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>)</span>
<span id="cb456-2"><a href="sec-maps.html#cb456-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span id="cb456-3"><a href="sec-maps.html#cb456-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     lon   lat</span></span>
<span id="cb456-4"><a href="sec-maps.html#cb456-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb456-5"><a href="sec-maps.html#cb456-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  8.46  55.5</span></span></code></pre></div>
<p>We may use <code>mutate_geocode</code> to add the coordinates to a dataset:</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="sec-maps.html#cb457-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb457-2"><a href="sec-maps.html#cb457-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_geocode</span>(Address)</span>
<span id="cb457-3"><a href="sec-maps.html#cb457-3" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb457-4"><a href="sec-maps.html#cb457-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 5</span></span>
<span id="cb457-5"><a href="sec-maps.html#cb457-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Id Shop            Address                                        lon   lat</span></span>
<span id="cb457-6"><a href="sec-maps.html#cb457-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;                                        &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb457-7"><a href="sec-maps.html#cb457-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark          8.46  55.5</span></span>
<span id="cb457-8"><a href="sec-maps.html#cb457-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark              9.00  56.1</span></span>
<span id="cb457-9"><a href="sec-maps.html#cb457-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark    12.3   55.9</span></span>
<span id="cb457-10"><a href="sec-maps.html#cb457-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark 10.0   57.4</span></span>
<span id="cb457-11"><a href="sec-maps.html#cb457-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark         8.62  56.4</span></span></code></pre></div>
<p>To reverse geocode use the <code>revgeocode</code> function:</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="sec-maps.html#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="fu">revgeocode</span>(<span class="fu">c</span>(dat<span class="sc">$</span>lon[<span class="dv">1</span>], dat<span class="sc">$</span>lat[<span class="dv">1</span>]))</span>
<span id="cb458-2"><a href="sec-maps.html#cb458-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span></span></code></pre></div>
<p>To apply it to the dataset use:</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="sec-maps.html#cb459-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb459-2"><a href="sec-maps.html#cb459-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">AddressGeoGoo =</span> </span>
<span id="cb459-3"><a href="sec-maps.html#cb459-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">map_chr</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(), <span class="cf">function</span>(i) {</span>
<span id="cb459-4"><a href="sec-maps.html#cb459-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">revgeocode</span>(<span class="fu">c</span>(<span class="at">lon =</span> lon[i], <span class="at">lat =</span> lat[i]))</span>
<span id="cb459-5"><a href="sec-maps.html#cb459-5" aria-hidden="true" tabindex="-1"></a>             }))</span>
<span id="cb459-6"><a href="sec-maps.html#cb459-6" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb459-7"><a href="sec-maps.html#cb459-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 6</span></span>
<span id="cb459-8"><a href="sec-maps.html#cb459-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Id Shop            Address                                        lon   lat AddressGeoGoo      </span></span>
<span id="cb459-9"><a href="sec-maps.html#cb459-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;                                        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              </span></span>
<span id="cb459-10"><a href="sec-maps.html#cb459-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark          8.46  55.5 Stormgade 157, 671…</span></span>
<span id="cb459-11"><a href="sec-maps.html#cb459-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark              9.00  56.1 Golfvej 5, 7400 He…</span></span>
<span id="cb459-12"><a href="sec-maps.html#cb459-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark    12.3   55.9 Slotsarkaderne 26,…</span></span>
<span id="cb459-13"><a href="sec-maps.html#cb459-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark 10.0   57.4 A F Heidemanns Vej…</span></span>
<span id="cb459-14"><a href="sec-maps.html#cb459-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark         8.62  56.4 Nyholmvej 20, 7500…</span></span></code></pre></div>
</div>
<div id="use-bing-maps" class="section level3" number="18.4.2">
<h3><span class="header-section-number">18.4.2</span> Use Bing Maps</h3>
<p>To get the coordinates of an address we define the <code>bing_geocode</code> function:</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="sec-maps.html#cb460-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Geocode addresses</span></span>
<span id="cb460-2"><a href="sec-maps.html#cb460-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb460-3"><a href="sec-maps.html#cb460-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param address Address(es) to geocode.</span></span>
<span id="cb460-4"><a href="sec-maps.html#cb460-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return The coordinates as a data frame.</span></span>
<span id="cb460-5"><a href="sec-maps.html#cb460-5" aria-hidden="true" tabindex="-1"></a>bing_geocode <span class="ot">&lt;-</span> <span class="cf">function</span>(address) {</span>
<span id="cb460-6"><a href="sec-maps.html#cb460-6" aria-hidden="true" tabindex="-1"></a>   dat <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(address, <span class="cf">function</span>(s) {</span>
<span id="cb460-7"><a href="sec-maps.html#cb460-7" aria-hidden="true" tabindex="-1"></a>      url <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;http://dev.virtualearth.net/REST/v1/Locations?q=&quot;</span>, </span>
<span id="cb460-8"><a href="sec-maps.html#cb460-8" aria-hidden="true" tabindex="-1"></a>                   s, <span class="st">&quot;&amp;key=&quot;</span>, <span class="fu">Sys.getenv</span>(<span class="st">&quot;BING_MAPS_API_KEY&quot;</span>))</span>
<span id="cb460-9"><a href="sec-maps.html#cb460-9" aria-hidden="true" tabindex="-1"></a>      url <span class="ot">&lt;-</span> <span class="fu">URLencode</span>(url)</span>
<span id="cb460-10"><a href="sec-maps.html#cb460-10" aria-hidden="true" tabindex="-1"></a>      lst <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(url)</span>
<span id="cb460-11"><a href="sec-maps.html#cb460-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (lst<span class="sc">$</span>statusCode <span class="sc">!=</span> <span class="dv">200</span>) <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">lon =</span> <span class="cn">NA</span>, <span class="at">lat =</span> <span class="cn">NA</span>))</span>
<span id="cb460-12"><a href="sec-maps.html#cb460-12" aria-hidden="true" tabindex="-1"></a>      v <span class="ot">&lt;-</span> lst<span class="sc">$</span>resourceSets<span class="sc">$</span>resources[[<span class="dv">1</span>]]<span class="sc">$</span>point<span class="sc">$</span>coordinates[[<span class="dv">1</span>]]</span>
<span id="cb460-13"><a href="sec-maps.html#cb460-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.null</span>(v)) <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">lon =</span> <span class="cn">NA</span>, <span class="at">lat =</span> <span class="cn">NA</span>))</span>
<span id="cb460-14"><a href="sec-maps.html#cb460-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">lon =</span> v[<span class="dv">2</span>], <span class="at">lat =</span> v[<span class="dv">1</span>]))</span>
<span id="cb460-15"><a href="sec-maps.html#cb460-15" aria-hidden="true" tabindex="-1"></a>   })</span>
<span id="cb460-16"><a href="sec-maps.html#cb460-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(dat)</span>
<span id="cb460-17"><a href="sec-maps.html#cb460-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb460-18"><a href="sec-maps.html#cb460-18" aria-hidden="true" tabindex="-1"></a><span class="fu">bing_geocode</span>(<span class="st">&quot;A.F. Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>)</span>
<span id="cb460-19"><a href="sec-maps.html#cb460-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span id="cb460-20"><a href="sec-maps.html#cb460-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     lon   lat</span></span>
<span id="cb460-21"><a href="sec-maps.html#cb460-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb460-22"><a href="sec-maps.html#cb460-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  10.0  57.4</span></span>
<span id="cb460-23"><a href="sec-maps.html#cb460-23" aria-hidden="true" tabindex="-1"></a><span class="fu">bing_geocode</span>(dat<span class="sc">$</span>Address)</span>
<span id="cb460-24"><a href="sec-maps.html#cb460-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span id="cb460-25"><a href="sec-maps.html#cb460-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     lon   lat</span></span>
<span id="cb460-26"><a href="sec-maps.html#cb460-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb460-27"><a href="sec-maps.html#cb460-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  8.46  55.5</span></span>
<span id="cb460-28"><a href="sec-maps.html#cb460-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  9.00  56.1</span></span>
<span id="cb460-29"><a href="sec-maps.html#cb460-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 12.3   55.9</span></span>
<span id="cb460-30"><a href="sec-maps.html#cb460-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 10.0   57.4</span></span>
<span id="cb460-31"><a href="sec-maps.html#cb460-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  8.62  56.4</span></span></code></pre></div>
<p>We may use <code>bing_mutate_geocode</code> to add the coordinates to a dataset:</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="sec-maps.html#cb461-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>lat, <span class="sc">-</span>lon)</span>
<span id="cb461-2"><a href="sec-maps.html#cb461-2" aria-hidden="true" tabindex="-1"></a>mutate_bing_geocode <span class="ot">&lt;-</span> <span class="cf">function</span> (data, address, ...) {</span>
<span id="cb461-3"><a href="sec-maps.html#cb461-3" aria-hidden="true" tabindex="-1"></a>    adr <span class="ot">&lt;-</span> data[[<span class="fu">deparse</span>(<span class="fu">substitute</span>(Address))]]</span>
<span id="cb461-4"><a href="sec-maps.html#cb461-4" aria-hidden="true" tabindex="-1"></a>    gcdf <span class="ot">&lt;-</span> <span class="fu">bing_geocode</span>(adr)</span>
<span id="cb461-5"><a href="sec-maps.html#cb461-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(data, gcdf)</span>
<span id="cb461-6"><a href="sec-maps.html#cb461-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb461-7"><a href="sec-maps.html#cb461-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-8"><a href="sec-maps.html#cb461-8" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb461-9"><a href="sec-maps.html#cb461-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_bing_geocode</span>(Address)</span>
<span id="cb461-10"><a href="sec-maps.html#cb461-10" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb461-11"><a href="sec-maps.html#cb461-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 6</span></span>
<span id="cb461-12"><a href="sec-maps.html#cb461-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Id Shop            Address                                      AddressGeoGoo         lon   lat</span></span>
<span id="cb461-13"><a href="sec-maps.html#cb461-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;                                        &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb461-14"><a href="sec-maps.html#cb461-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark         Stormgade 157, 671…  8.46  55.5</span></span>
<span id="cb461-15"><a href="sec-maps.html#cb461-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark             Golfvej 5, 7400 He…  9.00  56.1</span></span>
<span id="cb461-16"><a href="sec-maps.html#cb461-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark    Slotsarkaderne 26,… 12.3   55.9</span></span>
<span id="cb461-17"><a href="sec-maps.html#cb461-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark A F Heidemanns Vej… 10.0   57.4</span></span>
<span id="cb461-18"><a href="sec-maps.html#cb461-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark        Nyholmvej 20, 7500…  8.62  56.4</span></span></code></pre></div>
<p>To reverse geocode use the <code>bing_revgeocode</code> function:</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="sec-maps.html#cb462-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Reverse geocode coordinates</span></span>
<span id="cb462-2"><a href="sec-maps.html#cb462-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb462-3"><a href="sec-maps.html#cb462-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param coordinates A vector with two elements (lon, lat).</span></span>
<span id="cb462-4"><a href="sec-maps.html#cb462-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return The address as a data frame.</span></span>
<span id="cb462-5"><a href="sec-maps.html#cb462-5" aria-hidden="true" tabindex="-1"></a>bing_revgeocode <span class="ot">&lt;-</span> <span class="cf">function</span>(coordinates) {</span>
<span id="cb462-6"><a href="sec-maps.html#cb462-6" aria-hidden="true" tabindex="-1"></a>   url <span class="ot">&lt;-</span> <span class="fu">str_c</span>(<span class="st">&quot;http://dev.virtualearth.net/REST/v1/Locations/&quot;</span>, </span>
<span id="cb462-7"><a href="sec-maps.html#cb462-7" aria-hidden="true" tabindex="-1"></a>                coordinates[<span class="dv">2</span>], <span class="st">&quot;,&quot;</span>, coordinates[<span class="dv">1</span>],</span>
<span id="cb462-8"><a href="sec-maps.html#cb462-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;?key=&quot;</span>, <span class="fu">Sys.getenv</span>(<span class="st">&quot;BING_MAPS_API_KEY&quot;</span>))</span>
<span id="cb462-9"><a href="sec-maps.html#cb462-9" aria-hidden="true" tabindex="-1"></a>   url <span class="ot">&lt;-</span> <span class="fu">URLencode</span>(url)</span>
<span id="cb462-10"><a href="sec-maps.html#cb462-10" aria-hidden="true" tabindex="-1"></a>   lst <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(url)</span>
<span id="cb462-11"><a href="sec-maps.html#cb462-11" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (lst<span class="sc">$</span>statusCode <span class="sc">!=</span> <span class="dv">200</span>) <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb462-12"><a href="sec-maps.html#cb462-12" aria-hidden="true" tabindex="-1"></a>   v <span class="ot">&lt;-</span> lst<span class="sc">$</span>resourceSets<span class="sc">$</span>resources[[<span class="dv">1</span>]]<span class="sc">$</span>address<span class="sc">$</span>formattedAddress</span>
<span id="cb462-13"><a href="sec-maps.html#cb462-13" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (<span class="fu">is.null</span>(v)) <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb462-14"><a href="sec-maps.html#cb462-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(v)</span>
<span id="cb462-15"><a href="sec-maps.html#cb462-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb462-16"><a href="sec-maps.html#cb462-16" aria-hidden="true" tabindex="-1"></a><span class="fu">bing_revgeocode</span>(<span class="fu">c</span>(dat<span class="sc">$</span>lon[<span class="dv">1</span>], dat<span class="sc">$</span>lat[<span class="dv">1</span>]))</span>
<span id="cb462-17"><a href="sec-maps.html#cb462-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span></span></code></pre></div>
<p>To apply it to the dataset use:</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="sec-maps.html#cb463-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb463-2"><a href="sec-maps.html#cb463-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">AddressGeoBing =</span> </span>
<span id="cb463-3"><a href="sec-maps.html#cb463-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">map_chr</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(), <span class="cf">function</span>(i) {</span>
<span id="cb463-4"><a href="sec-maps.html#cb463-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">bing_revgeocode</span>(<span class="fu">c</span>(<span class="at">lon =</span> lon[i], <span class="at">lat =</span> lat[i]))</span>
<span id="cb463-5"><a href="sec-maps.html#cb463-5" aria-hidden="true" tabindex="-1"></a>             }))</span>
<span id="cb463-6"><a href="sec-maps.html#cb463-6" aria-hidden="true" tabindex="-1"></a>dat </span>
<span id="cb463-7"><a href="sec-maps.html#cb463-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 7</span></span>
<span id="cb463-8"><a href="sec-maps.html#cb463-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Id Shop            Address            AddressGeoGoo            lon   lat AddressGeoBing        </span></span>
<span id="cb463-9"><a href="sec-maps.html#cb463-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;              &lt;chr&gt;                  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                 </span></span>
<span id="cb463-10"><a href="sec-maps.html#cb463-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 Bilka Esbjerg   Stormgade 157, 67… Stormgade 157, 6715 E…  8.46  55.5 Stormgade 157, 6715 E…</span></span>
<span id="cb463-11"><a href="sec-maps.html#cb463-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2 Bilka Herning   Golfvej 5, 7400 H… Golfvej 5, 7400 Herni…  9.00  56.1 Golfvej 5, 7400 Herni…</span></span>
<span id="cb463-12"><a href="sec-maps.html#cb463-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     3 Bilka Hillerød  Slotsarkaderne 26… Slotsarkaderne 26, 34… 12.3   55.9 SLOTSARKADERNE 26, 34…</span></span>
<span id="cb463-13"><a href="sec-maps.html#cb463-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4 Bilka Hjørring  A.F Heidemannsvej… A F Heidemanns Vej 20… 10.0   57.4 A.F. Heidemanns Vej 2…</span></span>
<span id="cb463-14"><a href="sec-maps.html#cb463-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     5 Bilka Holstebro Nyholmvej 20, 750… Nyholmvej 20, 7500 Ho…  8.62  56.4 Nyholmvej 20, 7500 Ho…</span></span></code></pre></div>
</div>
</div>
<div id="adding-markers-and-routes-to-a-map" class="section level2" number="18.5">
<h2><span class="header-section-number">18.5</span> Adding markers and routes to a map</h2>
<p><a href="http://leafletjs.com">Leaflet</a> is an open-source JavaScript library for interactive maps. It’s used by websites ranging from The New York Times and The Washington Post to GitHub and Flickr, as well as GIS specialists like OpenStreetMap, Mapbox, and CartoDB. The <a href="https://rstudio.github.io/leaflet/">leaflet</a> package makes it easy to create Leaflet maps from R.</p>
<p>Note Leaflet is open-source and free so you do not need an API key for making maps. If you would like to use Google maps instead then have a look at the <a href="http://symbolixau.github.io/googleway/">googleway</a> package instead.</p>
<p>First let us create a map with two base layers</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="sec-maps.html#cb464-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb464-2"><a href="sec-maps.html#cb464-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">leaflet</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb464-3"><a href="sec-maps.html#cb464-3" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Base maps</span></span>
<span id="cb464-4"><a href="sec-maps.html#cb464-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addTiles</span>(<span class="at">group =</span> <span class="st">&quot;Map&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb464-5"><a href="sec-maps.html#cb464-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addProviderTiles</span>(<span class="st">&#39;Esri.WorldImagery&#39;</span>, <span class="at">group =</span> <span class="st">&quot;Satelite&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb464-6"><a href="sec-maps.html#cb464-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addProviderTiles</span>(<span class="st">&quot;CartoDB.PositronOnlyLabels&quot;</span>, <span class="at">group =</span> <span class="st">&quot;Map&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb464-7"><a href="sec-maps.html#cb464-7" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Center and zoom</span></span>
<span id="cb464-8"><a href="sec-maps.html#cb464-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">setView</span>(<span class="fl">10.2</span>, <span class="fl">56.2</span>,  <span class="at">zoom =</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb464-9"><a href="sec-maps.html#cb464-9" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Layer control</span></span>
<span id="cb464-10"><a href="sec-maps.html#cb464-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addLayersControl</span>(</span>
<span id="cb464-11"><a href="sec-maps.html#cb464-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">&quot;Map&quot;</span>, <span class="st">&quot;Satelite&quot;</span>),</span>
<span id="cb464-12"><a href="sec-maps.html#cb464-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">options =</span> <span class="fu">layersControlOptions</span>(<span class="at">collapsed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb464-13"><a href="sec-maps.html#cb464-13" aria-hidden="true" tabindex="-1"></a>   ) </span>
<span id="cb464-14"><a href="sec-maps.html#cb464-14" aria-hidden="true" tabindex="-1"></a> m</span></code></pre></div>
<div id="htmlwidget-e8c2cda903c4c3d7d046" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-e8c2cda903c4c3d7d046">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]}],"setView":[[56.2,10.2],7,[]]},"evals":[],"jsHooks":[]}</script>
<p>Next, let us add the places:</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="sec-maps.html#cb465-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb465-2"><a href="sec-maps.html#cb465-2" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>Id,              <span class="sc">~</span>Shop,                                        <span class="sc">~</span>Address,</span>
<span id="cb465-3"><a href="sec-maps.html#cb465-3" aria-hidden="true" tabindex="-1"></a>       1L,    <span class="st">&quot;Bilka Esbjerg&quot;</span>,          <span class="st">&quot;Stormgade 157, 6715 Esbjerg, Denmark&quot;</span>,</span>
<span id="cb465-4"><a href="sec-maps.html#cb465-4" aria-hidden="true" tabindex="-1"></a>       2L,    <span class="st">&quot;Bilka Herning&quot;</span>,              <span class="st">&quot;Golfvej 5, 7400 Herning, Denmark&quot;</span>,</span>
<span id="cb465-5"><a href="sec-maps.html#cb465-5" aria-hidden="true" tabindex="-1"></a>       3L,   <span class="st">&quot;Bilka Hillerød&quot;</span>,     <span class="st">&quot;Slotsarkaderne 26, 3400 Hillerød, Denmark&quot;</span>,</span>
<span id="cb465-6"><a href="sec-maps.html#cb465-6" aria-hidden="true" tabindex="-1"></a>       4L,   <span class="st">&quot;Bilka Hjørring&quot;</span>,  <span class="st">&quot;A.F Heidemannsvej 20, 9800 Hjørring, Denmark&quot;</span>,</span>
<span id="cb465-7"><a href="sec-maps.html#cb465-7" aria-hidden="true" tabindex="-1"></a>       5L,  <span class="st">&quot;Bilka Holstebro&quot;</span>,         <span class="st">&quot;Nyholmvej 20, 7500 Holstebro, Denmark&quot;</span>,</span>
<span id="cb465-8"><a href="sec-maps.html#cb465-8" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb465-9"><a href="sec-maps.html#cb465-9" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate_geocode</span>(Address)</span>
<span id="cb465-10"><a href="sec-maps.html#cb465-10" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> m <span class="sc">%&gt;%</span> </span>
<span id="cb465-11"><a href="sec-maps.html#cb465-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addMarkers</span>(<span class="sc">~</span>lon, <span class="sc">~</span>lat, <span class="at">popup =</span> <span class="sc">~</span>Address, <span class="at">label =</span> <span class="sc">~</span><span class="fu">str_c</span>(Id, <span class="st">&quot;  - &quot;</span>, Shop), <span class="at">data =</span> dat)</span>
<span id="cb465-12"><a href="sec-maps.html#cb465-12" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<div id="htmlwidget-6cf47732277ec33c83bc" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-6cf47732277ec33c83bc">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.297778,10.0034954,8.622241],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.297778]}},"evals":[],"jsHooks":[]}</script>
<p>To add a line between a set of points use the <code>addPolylines</code> function:</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="sec-maps.html#cb466-1" aria-hidden="true" tabindex="-1"></a>routeIds <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb466-2"><a href="sec-maps.html#cb466-2" aria-hidden="true" tabindex="-1"></a>route <span class="ot">&lt;-</span> dat[routeIds,] </span>
<span id="cb466-3"><a href="sec-maps.html#cb466-3" aria-hidden="true" tabindex="-1"></a>m <span class="sc">%&gt;%</span> <span class="fu">addPolylines</span>(<span class="at">lng =</span> <span class="sc">~</span>lon, <span class="at">lat =</span> <span class="sc">~</span>lat, <span class="at">data =</span> route, <span class="at">weight =</span> <span class="dv">2</span>, <span class="at">label =</span> <span class="st">&quot;Route 1&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-22f383c921d172efd14c" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-22f383c921d172efd14c">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.297778,10.0034954,8.622241],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,8.622241,8.4559613,9.0047956],"lat":[56.1357775,56.3779116,55.5107577,56.1357775]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":2,"opacity":0.5,"fill":false,"fillColor":"#03F","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Route 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.297778]}},"evals":[],"jsHooks":[]}</script>
<p>A more advanced setup is to use the <code>addFlows</code> function from the <a href="https://github.com/rte-antares-rpackage/leaflet.minicharts">leaflet.minicharts</a> package. First let us define some lines:</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="sec-maps.html#cb467-1" aria-hidden="true" tabindex="-1"></a>datLines <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">FromId =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>), <span class="at">ToId =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb467-2"><a href="sec-maps.html#cb467-2" aria-hidden="true" tabindex="-1"></a>datLines <span class="ot">&lt;-</span> <span class="fu">left_join</span>(datLines, dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Shop, <span class="sc">-</span>Address), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;FromId&quot;</span> <span class="ot">=</span> <span class="st">&quot;Id&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb467-3"><a href="sec-maps.html#cb467-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="st">&quot;FromLat&quot;</span> <span class="ot">=</span> <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;FromLon&quot;</span> <span class="ot">=</span> <span class="st">&quot;lon&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb467-4"><a href="sec-maps.html#cb467-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">left_join</span>(dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Shop, <span class="sc">-</span>Address), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;ToId&quot;</span> <span class="ot">=</span> <span class="st">&quot;Id&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb467-5"><a href="sec-maps.html#cb467-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="st">&quot;ToLat&quot;</span> <span class="ot">=</span> <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;ToLon&quot;</span> <span class="ot">=</span> <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb467-6"><a href="sec-maps.html#cb467-6" aria-hidden="true" tabindex="-1"></a>datLines</span>
<span id="cb467-7"><a href="sec-maps.html#cb467-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 6</span></span>
<span id="cb467-8"><a href="sec-maps.html#cb467-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   FromId  ToId FromLon FromLat ToLon ToLat</span></span>
<span id="cb467-9"><a href="sec-maps.html#cb467-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb467-10"><a href="sec-maps.html#cb467-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      2     5    9.00    56.1  8.62  56.4</span></span>
<span id="cb467-11"><a href="sec-maps.html#cb467-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2      5     1    8.62    56.4  8.46  55.5</span></span>
<span id="cb467-12"><a href="sec-maps.html#cb467-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      1     2    8.46    55.5  9.00  56.1</span></span>
<span id="cb467-13"><a href="sec-maps.html#cb467-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4      2     4    9.00    56.1 10.0   57.4</span></span>
<span id="cb467-14"><a href="sec-maps.html#cb467-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5      4     3   10.0     57.4 12.3   55.9</span></span>
<span id="cb467-15"><a href="sec-maps.html#cb467-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6      3     2   12.3     55.9  9.00  56.1</span></span></code></pre></div>
<p>Note we have a from/to pair in each row. We add the lines to the map:</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="sec-maps.html#cb468-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet.minicharts)</span>
<span id="cb468-2"><a href="sec-maps.html#cb468-2" aria-hidden="true" tabindex="-1"></a>m <span class="sc">%&gt;%</span> <span class="fu">addFlows</span>(datLines<span class="sc">$</span>FromLon, datLines<span class="sc">$</span>FromLat, datLines<span class="sc">$</span>ToLon, datLines<span class="sc">$</span>ToLat,</span>
<span id="cb468-3"><a href="sec-maps.html#cb468-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">flow =</span> <span class="dv">1</span>, <span class="at">maxFlow =</span> <span class="dv">20</span>, <span class="at">opacity =</span> <span class="fl">0.5</span>, <span class="at">popup =</span> <span class="fu">popupArgs</span>(<span class="at">noPopup =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<div id="htmlwidget-086902b53ec779ca322c" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-086902b53ec779ca322c">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.297778,10.0034954,8.622241],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addFlows","args":[[{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (10.0034954,57.4440055) -> (12.297778,55.9290561)","lat0":57.4440055,"lat1":55.9290561,"lng0":10.0034954,"lng1":12.297778},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (12.297778,55.9290561) -> (9.0047956,56.1357775)","lat0":55.9290561,"lat1":56.1357775,"lng0":12.297778,"lng1":9.0047956},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (8.4559613,55.5107577) -> (9.0047956,56.1357775)","lat0":55.5107577,"lat1":56.1357775,"lng0":8.4559613,"lng1":9.0047956},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (8.622241,56.3779116) -> (8.4559613,55.5107577)","lat0":56.3779116,"lat1":55.5107577,"lng0":8.622241,"lng1":8.4559613},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (10.0034954,57.4440055)","lat0":56.1357775,"lat1":57.4440055,"lng0":9.0047956,"lng1":10.0034954},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (8.622241,56.3779116)","lat0":56.1357775,"lat1":56.3779116,"lng0":9.0047956,"lng1":8.622241},"timeSteps":1}],["1"],null,{"showTitle":true,"showValues":true,"labels":[],"supValues":null,"supLabels":[],"html":null,"noPopup":true,"digits":null},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.297778]}},"evals":[],"jsHooks":[]}</script>
<p>Let us define a function for adding routes:</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="sec-maps.html#cb469-1" aria-hidden="true" tabindex="-1"></a>add_route <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">dat =</span> <span class="cn">NULL</span>, route, <span class="at">solution =</span> <span class="dv">1</span>) {</span>
<span id="cb469-2"><a href="sec-maps.html#cb469-2" aria-hidden="true" tabindex="-1"></a>   route_id <span class="ot">=</span> <span class="fu">if_else</span>(<span class="fu">is.null</span>(dat), <span class="dv">1</span>, <span class="fu">max</span>(dat<span class="sc">$</span>RouteId) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb469-3"><a href="sec-maps.html#cb469-3" aria-hidden="true" tabindex="-1"></a>   tmp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">From =</span> route[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(route)<span class="sc">-</span><span class="dv">1</span>)], <span class="at">To =</span> route[<span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(route)])</span>
<span id="cb469-4"><a href="sec-maps.html#cb469-4" aria-hidden="true" tabindex="-1"></a>   tmp <span class="ot">&lt;-</span> tmp <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Sol =</span> solution, <span class="at">RouteId =</span> route_id)</span>
<span id="cb469-5"><a href="sec-maps.html#cb469-5" aria-hidden="true" tabindex="-1"></a>   dat <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(dat, tmp)</span>
<span id="cb469-6"><a href="sec-maps.html#cb469-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb469-7"><a href="sec-maps.html#cb469-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-8"><a href="sec-maps.html#cb469-8" aria-hidden="true" tabindex="-1"></a>datLines <span class="ot">&lt;-</span> <span class="fu">add_route</span>(<span class="at">route =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb469-9"><a href="sec-maps.html#cb469-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">add_route</span>(<span class="at">route =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb469-10"><a href="sec-maps.html#cb469-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">add_route</span>(<span class="at">route =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="at">solution =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb469-11"><a href="sec-maps.html#cb469-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">add_route</span>(<span class="at">route =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>), <span class="at">solution =</span> <span class="dv">2</span>)</span>
<span id="cb469-12"><a href="sec-maps.html#cb469-12" aria-hidden="true" tabindex="-1"></a>datLines <span class="ot">&lt;-</span> <span class="fu">left_join</span>(datLines, dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Shop, <span class="sc">-</span>Address), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;From&quot;</span> <span class="ot">=</span> <span class="st">&quot;Id&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb469-13"><a href="sec-maps.html#cb469-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="st">&quot;FromLat&quot;</span> <span class="ot">=</span> <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;FromLon&quot;</span> <span class="ot">=</span> <span class="st">&quot;lon&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb469-14"><a href="sec-maps.html#cb469-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">left_join</span>(dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Shop, <span class="sc">-</span>Address), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;To&quot;</span> <span class="ot">=</span> <span class="st">&quot;Id&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb469-15"><a href="sec-maps.html#cb469-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="st">&quot;ToLat&quot;</span> <span class="ot">=</span> <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;ToLon&quot;</span> <span class="ot">=</span> <span class="st">&quot;lon&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb469-16"><a href="sec-maps.html#cb469-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">str_c</span>(<span class="st">&quot;Solution &quot;</span>, Sol))</span>
<span id="cb469-17"><a href="sec-maps.html#cb469-17" aria-hidden="true" tabindex="-1"></a>datLines</span>
<span id="cb469-18"><a href="sec-maps.html#cb469-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 12 × 9</span></span>
<span id="cb469-19"><a href="sec-maps.html#cb469-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     From    To   Sol RouteId FromLon FromLat ToLon ToLat group     </span></span>
<span id="cb469-20"><a href="sec-maps.html#cb469-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     </span></span>
<span id="cb469-21"><a href="sec-maps.html#cb469-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     2     5     1       1    9.00    56.1  8.62  56.4 Solution 1</span></span>
<span id="cb469-22"><a href="sec-maps.html#cb469-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     5     1     1       1    8.62    56.4  8.46  55.5 Solution 1</span></span>
<span id="cb469-23"><a href="sec-maps.html#cb469-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     1     2     1       1    8.46    55.5  9.00  56.1 Solution 1</span></span>
<span id="cb469-24"><a href="sec-maps.html#cb469-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     2     4     1       2    9.00    56.1 10.0   57.4 Solution 1</span></span>
<span id="cb469-25"><a href="sec-maps.html#cb469-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     4     3     1       2   10.0     57.4 12.3   55.9 Solution 1</span></span>
<span id="cb469-26"><a href="sec-maps.html#cb469-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     3     2     1       2   12.3     55.9  9.00  56.1 Solution 1</span></span>
<span id="cb469-27"><a href="sec-maps.html#cb469-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     2     3     2       3    9.00    56.1 12.3   55.9 Solution 2</span></span>
<span id="cb469-28"><a href="sec-maps.html#cb469-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     3     1     2       3   12.3     55.9  8.46  55.5 Solution 2</span></span>
<span id="cb469-29"><a href="sec-maps.html#cb469-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     1     2     2       3    8.46    55.5  9.00  56.1 Solution 2</span></span>
<span id="cb469-30"><a href="sec-maps.html#cb469-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10     2     5     2       4    9.00    56.1  8.62  56.4 Solution 2</span></span>
<span id="cb469-31"><a href="sec-maps.html#cb469-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11     5     4     2       4    8.62    56.4 10.0   57.4 Solution 2</span></span>
<span id="cb469-32"><a href="sec-maps.html#cb469-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12     4     2     2       4   10.0     57.4  9.00  56.1 Solution 2</span></span></code></pre></div>
<p>A map with Solution 1:</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="sec-maps.html#cb470-1" aria-hidden="true" tabindex="-1"></a>col_pal <span class="ot">&lt;-</span> <span class="fu">rainbow</span>(<span class="fu">max</span>(datLines<span class="sc">$</span>RouteId))</span>
<span id="cb470-2"><a href="sec-maps.html#cb470-2" aria-hidden="true" tabindex="-1"></a>datP <span class="ot">&lt;-</span> datLines <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sol <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb470-3"><a href="sec-maps.html#cb470-3" aria-hidden="true" tabindex="-1"></a>m <span class="sc">%&gt;%</span> <span class="fu">addFlows</span>(datP<span class="sc">$</span>FromLon, datP<span class="sc">$</span>FromLat, datP<span class="sc">$</span>ToLon, datP<span class="sc">$</span>ToLat,</span>
<span id="cb470-4"><a href="sec-maps.html#cb470-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">flow =</span> datP<span class="sc">$</span>RouteId, <span class="at">maxThickness =</span> <span class="dv">2</span>, <span class="at">color =</span> col_pal[datP<span class="sc">$</span>RouteId],</span>
<span id="cb470-5"><a href="sec-maps.html#cb470-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">opacity =</span> <span class="fl">0.5</span>, <span class="at">popup =</span> <span class="fu">popupArgs</span>(<span class="at">labels =</span> <span class="st">&quot;Route&quot;</span>))</span></code></pre></div>
<div id="htmlwidget-256f771dba4f65a00c26" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-256f771dba4f65a00c26">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.297778,10.0034954,8.622241],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addFlows","args":[[{"dyn":{"color":["#80FF00"],"value":[2]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (10.0034954,57.4440055) -> (12.297778,55.9290561)","lat0":57.4440055,"lat1":55.9290561,"lng0":10.0034954,"lng1":12.297778},"timeSteps":1},{"dyn":{"color":["#80FF00"],"value":[2]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (12.297778,55.9290561) -> (9.0047956,56.1357775)","lat0":55.9290561,"lat1":56.1357775,"lng0":12.297778,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#FF0000"],"value":[1]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.4559613,55.5107577) -> (9.0047956,56.1357775)","lat0":55.5107577,"lat1":56.1357775,"lng0":8.4559613,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#FF0000"],"value":[1]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.622241,56.3779116) -> (8.4559613,55.5107577)","lat0":56.3779116,"lat1":55.5107577,"lng0":8.622241,"lng1":8.4559613},"timeSteps":1},{"dyn":{"color":["#80FF00"],"value":[2]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (10.0034954,57.4440055)","lat0":56.1357775,"lat1":57.4440055,"lng0":9.0047956,"lng1":10.0034954},"timeSteps":1},{"dyn":{"color":["#FF0000"],"value":[1]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (8.622241,56.3779116)","lat0":56.1357775,"lat1":56.3779116,"lng0":9.0047956,"lng1":8.622241},"timeSteps":1}],["1"],null,{"showTitle":true,"showValues":true,"labels":["Route"],"supValues":null,"supLabels":[],"html":null,"noPopup":false,"digits":null},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.297778]}},"evals":[],"jsHooks":[]}</script>
<p>A map with Solution 2:</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="sec-maps.html#cb471-1" aria-hidden="true" tabindex="-1"></a>col_pal <span class="ot">&lt;-</span> <span class="fu">rainbow</span>(<span class="fu">max</span>(datLines<span class="sc">$</span>RouteId))</span>
<span id="cb471-2"><a href="sec-maps.html#cb471-2" aria-hidden="true" tabindex="-1"></a>datP <span class="ot">&lt;-</span> datLines <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sol <span class="sc">==</span> <span class="dv">2</span>)</span>
<span id="cb471-3"><a href="sec-maps.html#cb471-3" aria-hidden="true" tabindex="-1"></a>m <span class="sc">%&gt;%</span> <span class="fu">addFlows</span>(datP<span class="sc">$</span>FromLon, datP<span class="sc">$</span>FromLat, datP<span class="sc">$</span>ToLon, datP<span class="sc">$</span>ToLat,</span>
<span id="cb471-4"><a href="sec-maps.html#cb471-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">flow =</span> datP<span class="sc">$</span>RouteId, <span class="at">maxThickness =</span> <span class="dv">2</span>, <span class="at">color =</span> col_pal[datP<span class="sc">$</span>RouteId],</span>
<span id="cb471-5"><a href="sec-maps.html#cb471-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">opacity =</span> <span class="fl">0.5</span>, <span class="at">popup =</span> <span class="fu">popupArgs</span>(<span class="at">labels =</span> <span class="st">&quot;Route&quot;</span>))</span></code></pre></div>
<div id="htmlwidget-b28d12b19bad51b1fae1" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-b28d12b19bad51b1fae1">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.297778,10.0034954,8.622241],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addFlows","args":[[{"dyn":{"color":["#8000FF"],"value":[4]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (10.0034954,57.4440055) -> (9.0047956,56.1357775)","lat0":57.4440055,"lat1":56.1357775,"lng0":10.0034954,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#00FFFF"],"value":[3]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (12.297778,55.9290561) -> (8.4559613,55.5107577)","lat0":55.9290561,"lat1":55.5107577,"lng0":12.297778,"lng1":8.4559613},"timeSteps":1},{"dyn":{"color":["#00FFFF"],"value":[3]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.4559613,55.5107577) -> (9.0047956,56.1357775)","lat0":55.5107577,"lat1":56.1357775,"lng0":8.4559613,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#8000FF"],"value":[4]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.622241,56.3779116) -> (10.0034954,57.4440055)","lat0":56.3779116,"lat1":57.4440055,"lng0":8.622241,"lng1":10.0034954},"timeSteps":1},{"dyn":{"color":["#00FFFF"],"value":[3]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (12.297778,55.9290561)","lat0":56.1357775,"lat1":55.9290561,"lng0":9.0047956,"lng1":12.297778},"timeSteps":1},{"dyn":{"color":["#8000FF"],"value":[4]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (8.622241,56.3779116)","lat0":56.1357775,"lat1":56.3779116,"lng0":9.0047956,"lng1":8.622241},"timeSteps":1}],["1"],null,{"showTitle":true,"showValues":true,"labels":["Route"],"supValues":null,"supLabels":[],"html":null,"noPopup":false,"digits":null},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.297778]}},"evals":[],"jsHooks":[]}</script>
<p>An interactive map with both solutions:</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="sec-maps.html#cb472-1" aria-hidden="true" tabindex="-1"></a>mm <span class="ot">&lt;-</span> m</span>
<span id="cb472-2"><a href="sec-maps.html#cb472-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(datLines), <span class="cf">function</span>(i) {</span>
<span id="cb472-3"><a href="sec-maps.html#cb472-3" aria-hidden="true" tabindex="-1"></a>   tmp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">lat =</span> <span class="fu">c</span>(datLines<span class="sc">$</span>FromLat[i], datLines<span class="sc">$</span>ToLat[i]), <span class="at">lon =</span> <span class="fu">c</span>(datLines<span class="sc">$</span>FromLon[i], datLines<span class="sc">$</span>ToLon[i]))</span>
<span id="cb472-4"><a href="sec-maps.html#cb472-4" aria-hidden="true" tabindex="-1"></a>   mm <span class="ot">&lt;&lt;-</span> mm <span class="sc">%&gt;%</span> <span class="fu">addPolylines</span>(<span class="at">lng =</span> <span class="sc">~</span>lon, <span class="at">lat =</span> <span class="sc">~</span>lat, </span>
<span id="cb472-5"><a href="sec-maps.html#cb472-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">color =</span> col_pal[datLines<span class="sc">$</span>Sol[i]], <span class="at">group =</span> datLines<span class="sc">$</span>group[i],</span>
<span id="cb472-6"><a href="sec-maps.html#cb472-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span> tmp, <span class="at">weight =</span> <span class="dv">2</span>, <span class="at">label =</span> datLines<span class="sc">$</span>group[i])</span>
<span id="cb472-7"><a href="sec-maps.html#cb472-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">NULL</span>))</span>
<span id="cb472-8"><a href="sec-maps.html#cb472-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb472-9"><a href="sec-maps.html#cb472-9" aria-hidden="true" tabindex="-1"></a>mm <span class="ot">&lt;-</span> mm <span class="sc">%&gt;%</span> </span>
<span id="cb472-10"><a href="sec-maps.html#cb472-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Layer control</span></span>
<span id="cb472-11"><a href="sec-maps.html#cb472-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addLayersControl</span>(</span>
<span id="cb472-12"><a href="sec-maps.html#cb472-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">&quot;Map&quot;</span>, <span class="st">&quot;Satelite&quot;</span>),</span>
<span id="cb472-13"><a href="sec-maps.html#cb472-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">overlayGroups =</span> <span class="fu">unique</span>(datLines<span class="sc">$</span>group),</span>
<span id="cb472-14"><a href="sec-maps.html#cb472-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">options =</span> <span class="fu">layersControlOptions</span>(<span class="at">collapsed =</span> <span class="cn">FALSE</span>)</span>
<span id="cb472-15"><a href="sec-maps.html#cb472-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb472-16"><a href="sec-maps.html#cb472-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hideGroup</span>(<span class="fu">unique</span>(datLines<span class="sc">$</span>group)) <span class="sc">%&gt;%</span> </span>
<span id="cb472-17"><a href="sec-maps.html#cb472-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showGroup</span>(<span class="st">&quot;Solution 1&quot;</span>)</span>
<span id="cb472-18"><a href="sec-maps.html#cb472-18" aria-hidden="true" tabindex="-1"></a>mm</span></code></pre></div>
<div id="htmlwidget-f22a785dd1637b243b8b" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-f22a785dd1637b243b8b">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.297778,10.0034954,8.622241],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,8.622241],"lat":[56.1357775,56.3779116]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.622241,8.4559613],"lat":[56.3779116,55.5107577]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.4559613,9.0047956],"lat":[55.5107577,56.1357775]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,10.0034954],"lat":[56.1357775,57.4440055]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[10.0034954,12.297778],"lat":[57.4440055,55.9290561]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[12.297778,9.0047956],"lat":[55.9290561,56.1357775]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,12.297778],"lat":[56.1357775,55.9290561]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[12.297778,8.4559613],"lat":[55.9290561,55.5107577]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.4559613,9.0047956],"lat":[55.5107577,56.1357775]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,8.622241],"lat":[56.1357775,56.3779116]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.622241,10.0034954],"lat":[56.3779116,57.4440055]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[10.0034954,9.0047956],"lat":[57.4440055,56.1357775]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[["Map","Satelite"],["Solution 1","Solution 2"],{"collapsed":false,"autoZIndex":true,"position":"topright"}]},{"method":"hideGroup","args":[["Solution 1","Solution 2"]]},{"method":"showGroup","args":["Solution 1"]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.297778]}},"evals":[],"jsHooks":[]}</script>
<p>Note unfortunately arrows cannot be shown in this case.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sec-project.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sec-r-excel.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/bss-osca/tfa/edit/master/book/09-01_r-maps.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

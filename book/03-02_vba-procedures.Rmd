---
output: html_document
editor_options: 
  chunk_output_type: console
---
```{r, code = readLines("common.R"), cache = FALSE, include=FALSE}
```


# Useful VBA procedures {#mod-vba-procedures}

During the course a set of useful procedures have been made. All of these have been stored in the Excel file [vba-help-procedures.xlsm](https://github.com/bss-osca/tfa/blob/master/vba/vba-help-procedures.xlsm). The file also contain other procedures that may be useful when coding and have modules useful for handling array, collections, ranges, generating random numbers, record CPU times, reading and writing csv files etc. Documentation is given above each procedure and examples can the seen in the module `ModExamples`.

Let us consider an example where we read and write to a csv file. A [comma-separated values (csv) file](https://en.wikipedia.org/wiki/Comma-separated_values) is a delimited text file that uses a delimiter to separate values. Each line of the file is a data record. Each record consists of one or more fields, separated by the delimiter. The file format is not fully standardized, i.e. the delimiter may be a semicolon, a colon or another delimiter. Moreover, a field may be surrounded with quotation marks. Let us have a look at a csv file `data.csv` with a header using a semicolon as delimiter:

```
Year;Make;Model
1997;Ford;E350
2000;Mercury;Cougar
```

The [vba-help-procedures.xlsm](https://github.com/bss-osca/tfa/blob/master/vba/vba-help-procedures.xlsm) file contains procedures for reading and writing to csv files. First, let us try to read the file:
```
Dim ary As Variant
Call CSVRead2Array(ary, "data.csv")     ' Read the values into an array 
Call CSVRead("data5.csv", Range("A1"))  ' Read and paste the values into sheet where upper left is A1
```
You can write to a csv file using 
```
Set rng = Range("A1:D34")                    ' The range containing the data to write
Call CSVWrite("test1.csv", rng)              ' Semicolon (;) delimiter
Call CSVWrite("test2.csv", rng, ",", True)   ' quotes and colon (,) delimiter
```

You can also record the CPU time of running code using:
```
Dim dbltimer As Double
dbltimer = StartTimer()
Application.Wait (Now() + TimeValue("0:00:02"))   ' wait for approx 2 sec
MsgBox (TimeElapsed(dbltimer, "sec"))
```



```{r links, child="links.md", include=FALSE}
```
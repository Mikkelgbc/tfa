```{r, include = FALSE}
source("common.R")
```

# R basics and workflows {#r-basics}

## Learning outcomes

By the end of this module, you are expected to have:

* Tried R and RStudio.
* Learned how the RStudio IDE works.
* Finished your first course on DataCamp.
* Solved your first exercises.

<!-- Content from: https://stat545.com/block002_hello-r-workspace-wd-project.html-->
<!-- Content from: https://moderndive.netlify.app/1-getting-started.html -->

## Working with R at the command line in RStudio

R is a programming language and free software environment. The R language is widely used among statisticians and data miners for data analysis. To run R you need to install it on your computer. Throughout this book, we will assume that you are using R via RStudio. First time users often confuse the two. At its simplest, R is like a car's engine while RStudio is like a car's dashboard as illustrated in Figure \@ref(fig:R-vs-RStudio-1).

```{r R-vs-RStudio-1, echo=FALSE, fig.align="center", fig.cap="Analogy of difference between R and RStudio.", out.width="95%", purl=FALSE}
knitr::include_graphics("img/R_vs_RStudio_1.png")
```

More precisely, R is a programming language that runs computations, while RStudio is an *integrated development environment (IDE)* that provides an interface by adding many convenient features and tools. So just as the way of having access to a speedometer, rearview mirrors, and a navigation system makes driving much easier, using RStudio's interface makes using R much easier as well. 

Compared to Excel. The benefit of using Excel is that the initial learning curve is quite minimal, and most analysis can be done via point-and-click on the top panel. Once a user imports their data into the program, itâ€™s not exceedingly hard to make basic graphs and charts. R is a programming language, however, meaning the initial learning curve is steeper. It will take you some time to become familiar with the interface and master the various functions. Luckily, using R can quickly become second-nature with practice. For a detailed description you may see [Excel vs R: A Brief Introduction to R][excel-vs-r] by Jesse Sadler.

Compared to VBA, R is an [interpreted language][wiki-interpreted]; users typically access it through a command-line or script file. To run VBA you need to compile and execute it.   

Recall our car analogy from earlier. Much as we don't drive a car by interacting directly with the engine but rather by interacting with elements on the car's dashboard, we won't be using R directly but rather we will use RStudio's interface. After you install R and RStudio on your computer, you'll have two new *programs* (also called *applications*) you can open. We'll always work in RStudio and not in the R application. Figure \@ref(fig:R-vs-RStudio-2) shows what icon you should be clicking on your computer. 


```{r R-vs-RStudio-2, echo=FALSE, fig.align="center", fig.cap="Icons of R versus RStudio on your computer.", out.width="90%", purl=FALSE}
knitr::include_graphics("img/R_vs_RStudio.png")
```

Launch RStudio/R and notice the panes:

* Console (left)
* Environment/History (tabbed in upper right)
* Files/Plots/Packages/Help (tabbed in lower right)

FYI: you can change the default location of the panes, among many other things: [Customizing RStudio][rstudio-customizing].

Now that you're set up with R and RStudio, you are probably asking yourself, "OK. Now how do I use R?". The first thing to note is that unlike other statistical software programs like Excel, SPSS, or Minitab that provide [point-and-click] interfaces, R is an [interpreted language][wiki-interpreted]. This means you have to type in commands written in *R code*. In other words, you have to code/program in R. Note that we'll use the terms "coding" and "programming" interchangeably in this book.

Go into the Console, where we interact with the live R process.

Make an assignment and then inspect the object you just created:

```{r start_rbasics}
x <- 3 * 4
x
```

All R statements where you create objects -- "assignments" -- have this form:
```{r eval = FALSE}
objectName <- value
```
and in my head I hear, e.g., "x equals 12". You will make lots of assignments and the operator `<-` is a pain to type. Don't be lazy and use `=`, although it would work, because it will just sow confusion later. Instead, utilize RStudio's keyboard shortcut: Alt + - (the minus sign).

Notice that RStudio automatically surrounds `<-` with spaces, which demonstrates a useful code formatting practice. Give your eyes a break and use spaces.

RStudio offers many handy [keyboard shortcuts][rstudio-key-shortcuts]. Also, Alt+Shift+K brings up a keyboard shortcut reference card.

Object names cannot start with a digit and cannot contain certain other characters such as a comma or a space. You will be wise to adopt a naming convention some use [snake case][wiki-snake-case] others use [camel case][wiki-camel-case]. Choose the naming convention you like best in your study group. But stick only to one of them.

```
this_is_snake_case   # note you don't use capital letters here
thisIsCamelCase      # you start each word with a capital letter
```

Make another assignment:
```{r}
this_is_a_long_name <- 2.5
```

To inspect this, try out RStudio's completion facility: type the first few characters, press TAB, add characters until you disambiguate, then press return.

In VBA you have procedures and functions. In R we only use functions which always return an object. R has a mind-blowing collection of built-in functions that are accessed like so:

```{r eval = FALSE, tidy = FALSE}
functionName(arg1 = val1, arg2 = val2, ...)
```

Let's try function `seq()` which makes regular sequences of numbers and, while we're at it, demo more helpful features of RStudio.

Type `se` and hit TAB. A pop up shows you possible completions. Specify `seq()` by typing more to disambiguate or using the up/down arrows to select. Notice the floating tool-tip-type help that pops up, reminding you of a function's arguments. If you want even more help, press F1 as directed to get the full documentation in the help tab of the lower right pane. Now open the parentheses and notice the automatic addition of the closing parenthesis and the placement of cursor in the middle.  Type the arguments `1, 10` and hit return.  

```{r}
seq(1, 10)
```

The above also demonstrates something about how R resolves function arguments. Type seq and press F1 or type:

```{r, eval=FALSE}
?seq
```

The help tab of the lower right pane will show the help documentation of function `seq` with a description of usage, arguments, return value etc. Note all function arguments have names. You can always specify arguments using `name = value` form. But if you do not, R attempts to resolve by position. So above, it is assumed that we want a sequence `from = 1` that goes `to = 10`. Since we didn't specify step size, the default value of `by` in the function definition is used, which ends up being 1 in this case. Note since the default value for `from` is 1, the same result is obtained by typing:

```{r}
seq(to = 10)
```

Make this assignment and notice similar help with quotation marks.
```{r}
yo <- "hello world"
```

If you just make an assignment, you don't see the value. You may see the value by:

```{r}
yo          # same as print(yo)
print(yo)  
```

Now look at your Environment tab in the upper right pane where user-defined objects accumulate. You can also get a listing of these objects with commands:

```{r}
objects()
ls()
```

If you want to remove the object named `yo`, you can do this:

```{r}
rm(yo)
```

To remove everything:

```{r}
rm(list = ls())
```

or click the broom in RStudio's Environment pane.


## Your first DataCamp course

[Datacamp] is an online platform for learning data science. We are going to use the platform for online lessons and exercises. DataCamp runs all the courses in your browser. That is, R is run on a server and you don't use RStudio here. The first course gives an [Introduction to R][datacamp-r-intro]. You are expected to have completed the course before continuing this module!


## RStudio projects {#rprojs}

Let us return to RStudio. 

One day you will need to quit R, do something else and return to your analysis later.

One day you will have multiple analyses going that use R and you want to keep them separate.

One day you will need to bring data from the outside world into R and send numerical results and figures from R back out into the world.

To handle these real life situations, you need to store your work in a project that keeps all the files associated with a project organized together (such as input data, R scripts, analytical results and figures). RStudio has built-in support for this via its [_projects_][rstudio-using-projects]. You may think of a project as a folder where you store all you work. 

Let's make one to use for the rest of this module. Do this: **File > New Project... > New Directory > New Project >**. The directory name you choose here will be the project name. Call it whatever you want (or follow me for convenience). I used `tfa_testing` in my `tmp` directory (that is `tfa_testing` is now a subfolder of `tmp`.

You now need a way to store R code in your project. We will use 2 ways of storing your code. In a R script file or a R Markdown document. Normally you store lines of R code in a script file that you need to run. 

R Markdown provides an easy way to produce a rich, fully-documented reproducible analysis. Here you combine text, figures and metadata needed to reproduce the analysis from beginning to end in a single file. R Markdown compiles to nicely formatted HTML, PDF, or Word. We are going to use R Markdown for larger projects (e.g. the mandatory R report in Week 48). We will come back to R Markdown later 

### Storing your code in a script file

R code can be stored in a script file with file suffix `.R`. A script file contains a line for each R command to run (think of each line as a command added to the console). Create a new script file **File > New File > R Script**. Let us add some R code to the file:

```{r script, eval=FALSE}
# this is a comment
a <- 2
b <- -3
sig_sq <- 0.5
x <- runif(40)
y <- a + b * x + rnorm(40, sd = sqrt(sig_sq))
(avg_x <- mean(x))
write(avg_x, "avg_x.txt")
plot(x, y)
abline(a, b, col = "purple")
dev.print(pdf, "toy_line_plot.pdf")
```

Save the file as `testing.R` Now run each line by setting the cursor at the first line, hit Ctrl+Enter (runs the line in the Console and moves the cursor to the next line). Repeat Ctrl+Enter until you have run all the lines. Alternatively you may select all the code and hit Ctrl+Enter. 

Change some things about your code. Top priority would be to set a sample size `n` at the top, e.g. `n <- 40`, and then replace all the hard-wired 40's with `n`. Change some other minor-but-detectable stuff, e.g. alter the sample size `n`, the slope of the line `b`,the color of the line etc. Practice the different ways to re-run the code:

* Walk through line by line by keyboard shortcut (Ctrl+Enter) or mouse (click "Run" in the upper right corner of editor pane).
  
* Source the entire document by entering `source('Testing.R')` in the Console or use keyboard shortcut (Shift+Ctrl+S) or mouse (click "Source" in the upper right corner of editor pane or select from the mini-menu accessible from the associated down triangle).
  
* Source with echo from the Source mini-menu.
  
Try to get an overview over the different planes and tabs. For instance in the Files tab (lower right plane) you can get an overview over your project files. You may also see this [video about projects][rstudio-video-projects].

<!-- ### Storing your code in a R Markdown file -->

<!-- Try to open a new file **File > New File > New RMarkdown...**. Use the defaults and press **OK**. Next save the file as `testing.Rmd` and compile it using **Knit** (Ctrl+Shift+K). You have now compiled a document with R code inside of it.  -->

<!-- Have a look at the output (a html file) in the Viewer and the input file `testing.Rmd`. In a RMarkdown file you store your R code inside *code chunks* and add comments and text outside the chunks using simple markdown.  -->


## Global options

Quit RStudio. Inspect the folder associated with your project if you wish. Maybe view the PDF in an external viewer. Restart RStudio. Notice that things, by default, restore to where we were earlier. Check the Environment tap (top-right plane). The environment should be empty. If it contains objects you defined before you closed R, it is because they have been restored. This is in general not advisable and please change it by opening **Tools > Global Options ...**. Under **General** set the check marks as:  

```{r echo=FALSE, out.width='60%'}
knitr::include_graphics('img/global_options_general.PNG')
```

Quit RStudio and reopen it. The Environment tab should now be empty. 


## Working directory

Any process running on your computer has a notion of its "working directory". In R, this is where R will look, by default, for files you ask it to load. It also where, by default, any files you write to disk will go. Chances are your current working directory is the directory we inspected above, i.e. the one where RStudio wanted to save the workspace.

You can explicitly check your working directory with:

```{r eval = FALSE}
getwd()
```

It is also displayed at the top of the RStudio console. In general it should be the directory of your R project. You can set R's working directory at the command line like so:

```{r eval = FALSE}
setwd("./subfolder")  # sets the working dir to a subfolder of you project folder
```

You can also use RStudio's Files pane to navigate to a directory and then set it as working directory from the menu: **Session > Set Working Directory > To Files Pane Location**.

## Different learning paths

`r strLPath`

* Suggestion 1 
* Suggestion 2

## Recap

R is a programming language that runs computations, while RStudio is an integrated development environment (IDE) that provides an interface by adding many convenient features and tools. 

Adopt a naming convention. Either use snake case or use camel case. Choose the naming convention you like best in your study group. But stick only to one of them.

Store your work in a project that keeps all the files associated with a project organized together (such as input data, R scripts, analytical results and figures). You may think of a project as a folder where you store all you work. 

This workflow will serve you well in the future:

* Create an RStudio project for an analytical project
* Keep inputs there (we'll soon talk about importing)
* Keep scripts there; edit them, run them in bits or as a whole from there
* Keep outputs there (like the PDF written above)

Avoid using the mouse for pieces of your analytical workflow, such as loading a dataset or saving a figure. Terribly important for reproducibility and for making it possible to retrospectively determine how a numerical table or PDF was actually produced.

Store your R commands in a script file and R scripts with a `.R` suffix. 

Comments start with one or more `#` symbols. Use them. RStudio helps you (de)comment selected lines with Ctrl+Shift+C (Windows and Linux) or Ctrl+Shift+C (Mac).

Values saved in R are stored in *Objects*. 

The interactive DataCamp course gave an introduction to some basic programming concepts and terminology:

<!-- Instead of asking you to memorize all these concepts and terminology right now, we'll guide you so that you'll "learn by doing." To help you learn, we will always use a different font to distinguish regular text from `computer_code`. The best way to master these topics is, in our opinions, through [deliberate practice](https://jamesclear.com/deliberate-practice-theory) with R and lots of repetition. -->

* *Data types*: integers, doubles/numerics, logicals, and characters.  Integers are values like -1, 0, 2, 4092. Doubles or numerics are a larger set of values containing both the integers but also fractions and decimal values like -24.932 and 0.8. Logicals are either `TRUE` or `FALSE` while characters are text such as "Hamilton", "The Wire is the greatest TV show ever", and "This ramen is delicious." Note that characters are often denoted with the quotation marks around them.
* *Vectors*: a series of values. These are created using the `c()` function, where `c()` stands for "combine" or "concatenate." For example, `c(6, 11, 13, 31, 90, 92)` creates a six element series of positive integer values \index{vectors}.
* *Factors*: *categorical data* are commonly represented in R as factors. Categorical data can also be represented as *strings*. 
* *Data frames*: rectangular spreadsheets. They are representations of datasets in R where the rows correspond to *observations* and the columns correspond to *variables* that describe the observations. 
* *Lists* ...

<!-- * *Conditionals*: \index{conditionals} -->
<!--   + Testing for equality in R using `==` (and not `=`, which is typically used for assignment). For example, `2 + 1 == 3` compares `2 + 1` to `3` and is correct R code, while `2 + 1 = 3` will return an error. -->
<!--   + Boolean algebra: `TRUE/FALSE` statements and mathematical operators such as `<` (less than), `<=` (less than or equal), and `!=` (not equal to). \index{Boolean algebra} For example, `4 + 2 >= 3` will return `TRUE`, but `3 + 5 <= 1` will return `FALSE`. -->
<!--   + Logical operators: `&` representing "and" as well as `|` representing "or." For example, `(2 + 1 == 3) & (2 + 1 == 4)` returns `FALSE` since both clauses are not `TRUE` (only the first clause is `TRUE`). On the other hand, `(2 + 1 == 3) | (2 + 1 == 4)` returns `TRUE` since at least one of the two clauses is `TRUE`. \index{operators!logical} -->
<!-- * *Functions*, also called *commands*: Functions perform tasks in R. They take in inputs called *arguments* and return outputs. You can either manually specify a function's arguments or use the function's *default values*. \index{functions}  -->
<!--   + For example, the function `seq()` in R generates a sequence of numbers. If you just run `seq()` it will return the value 1. That doesn't seem very useful! This is because the default arguments are set as `seq(from = 1, to = 1)`. Thus, if you don't pass in different values for `from` and `to` to change this behavior, R just assumes all you want is the number 1. You can change the argument values by updating the values after the `=` sign. If we try out `seq(from = 2, to = 5)` we get the result `2 3 4 5` that we might expect.  -->
<!--   + We'll work with functions a lot throughout this book and you'll get lots of practice in understanding their behaviors. To further assist you in understanding when a function is mentioned in the book, we'll also include the `()` after them as we did with `seq()` above. -->







```{r end_rbasics, include = FALSE}
file.remove(c("avg_x.txt", "toy_line_plot.pdf"))
```

```{r, include = FALSE}
source("common.R")
```



## Exercises

Exercises are numbered using [module number].[section number].[exercise number]. 

### Exercise (install packages)

This exercise is done from the Console in RStudio. 

   1) Install the package `devtools` using function `install.packages`. Note you can always get help/see documentation by typing `?install.packages` or typing `install.packages` and press F1. 
   
You now have install the package from the default repository ([CRAN][cran]). You may also install packages from other repositories (e.g. GitHub)
   
   1) Have a look at the documentation for function `install_github` in the package `devtools`. This can be done in different ways:
   
```r
library(devtools)    # we here load all the functions in devtools 
?install_github

?devtools::install_github     # we here use the namespace devtools to load only one function
```

   1) Install the package `tfa` from github using path ``

```{r filter}
# filter the flights table to include only United and
# American flights

```

```{r}
{
sink("tmp.md")
cat('
Vi tester
```r
cat("hello")
cat("world")
```')
sink()
}
bs_modal(id = "hint", title = "Hint", 
         body = includeMarkdown("tmp.md"))
```

```{r}
bs_button("Hint") %>%
  bs_attach_modal(id_modal = "hint")
```


### Exercise

[Add text]

### Exercise ()

[Add text]

### Exercise (string management)



[Add text]

   
   
   





```{r links, child="links.md"}
```


--- 
title: "Tools for Analytics (TFA)"
subtitle: "Course notes"
author: 
- Lars Relund Nielsen
knit: "bookdown::render_book"
site: bookdown::bookdown_site
url: 'https\://bss-osca.github.io/tfa/'
github-repo: bss-osca/tfa
cover-image: assets/logo.png
documentclass: book
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
description: "Course notes for the 'Tools for Analytics' course"
favicon: assets/favicon.ico
date: "2022-08-08"
editor_options: 
  chunk_output_type: console
---


            
# Introduction to the course {#mod-intro}







This site contains course notes for the course "Tools for Analytics" held at [Aarhus BSS][BSS]. The notes show the learning path for each week and contain. The course is an introductory course at the [Operations and Supply Chain Analytics programme][osca-programme] and intended to give knowledge about IT tools for Analytics. Expect the notes to be updated when the course runs. The date listed above is the last time the notes was updated.

#### Learning path diagram {-}

Click/hover the nodes to follow links and see details.


```{=html}
<div id="htmlwidget-5f54edb3e57724c40917" style="width:100%;height:150px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-5f54edb3e57724c40917">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"📖 Book purpose\", URL = \"#purpose\", tooltip = \"Purpose for the book.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"0,2!\"] \n  \"2\" [label = \"📖 R vs Excel/VBA\", URL = \"#r-vs-vba\", tooltip = \"R vs Excel/VBA.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"3,2!\"] \n  \"3\" [label = \"📖 How a computer works\", URL = \"#computer\", tooltip = \"How a computer works.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"6,2!\"] \n  \"4\" [label = \"📖 Book organization\", URL = \"#organization\", tooltip = \"How this book is organized.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"9,2!\"] \n  \"5\" [label = \"📖 What is Business Analytics\", URL = \"sec-ba.html\", tooltip = \"A detailed description of Business Analytics.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"PeachPuff3\", pos = \"0,1!\"] \n\"1\"->\"2\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"5\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"3\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"4\" [color = \"black\", arrowhead = \"vee\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
```

A detailed description of Business Analytics have been pointed out as an extra supplement in the learning path diagram. You may have a look at it if you like.

## Learning outcomes {#lo-intro}

By the end of this module, you are expected to:

* Memorize the purpose of the course.
* Describe what the term Business Analytics mean.
* Identify pros and cons of using Excel, VBA and R.
* Describe how a computer works.
* Describe what an algorithm is.
* Know how the course is organized.

The learning outcomes relate to the [overall learning goals](#lg-course) number 1, 3 and 5 of the course.

<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->

## Purpose for the course {#purpose}

Since the amount of available data has increased extensively in many companies, there is a need for analysts with the ability to do tasks within Analytics. For instance, extract relevant data and perform valid quantitative analysis. Clearly, it is also important that the analyst can communicate the results of the analysis to their surroundings. This requires for the analyst to be particularly qualified in handling IT based tools beyond e.g. basic Excel. 

Business Analytics (BA) (or just Analytics) refers to the scientific process of transforming data into insight for making better decisions in business. BA can both be seen as the complete decision making process for solving a business problem and the creation of business value by integration of concepts, methods and data. As a process, it can be characterized by descriptive, predictive, and prescriptive model building using data sources. For a full definition see the [appendix](#sec:ba).

Within a Business Analytics (BA) framework the course focuses on giving you an introduction to programming, handeling data and doing descriptive analytics. Descriptive analytics categorizes, characterizes, consolidates, and classifies data. Examples are standard reporting and dashboards (key performance indicators (KPIs), what happened or is happening now?) and ad-hoc reporting (how many/often?). Descriptive analytics often serves as a first step in the successful application of predictive or prescriptive analytics. Predictive and prescriptive analytics are covered in other courses of the [programme][osca-programme].

Analytics may be seen as a data driven process:

<div class="figure" style="text-align: center">
<img src="img/process.png" alt="Analytics as a data driven process." width="658" />
<p class="caption">(\#fig:process)Analytics as a data driven process.</p>
</div>

For doing data driven analytics you first must __import__ your data. That is, take data from a database, file, web API etc. and transform it into a data frame/table. In general raw data may be messy and need to be structured in a __tidy__ way. Tidying your data means storing it in a structured form suitable for analysis. In brief, when your data is __tidy__, each column is a variable, and each row is an observation. Tidy data is important because the consistent structure lets you focus your struggle on questions about the data. 
Once you have tidy data, a common first step is to __transform__ it. Transformation includes narrowing in on observations of interest (e.g. only observations from a specific year or warehouse), creating new variables based on existing variables (e.g. the cost of using the machine that day given idle time). Together, tidying and transforming are called __wrangling__, because 
it can be a hard process to get your data in the right form.

The next step is to do a simple __exploration__ of you data such as calculating a set of summary statistics (like counts, means or KPIs). A good way to get an overview over your data is by __visualization__. A good visualisation will show you things that you did not expect, raise new questions about the data or confirm your hypothesis. A good visualization might also hint that you're asking the wrong question, or you need to collect different data. Exploration and visualization are descriptive analytics and used to answer questions such as: What happened? How many, how often, where? Where exactly is the problem? What actions are needed?
__Models__ are complementary tools to visualization. Once you have made your questions sufficiently precise, you can use a model to answer them. A model is a description of a system using mathematical concepts and a simplification of the real system. That is, the results of a model are based on a set of assumptions. Models for statistical analysis, forecasting, system behavior are predictive analytics and answer questions like: Why is this happening? What if these trends continue? What will happen next? Models for prescriptive analytics use optimization and other decision modeling techniques to suggest decision options with the goal of improving business performance and answer questions like: What is the best that can happen?

Exploration, visualization and modeling may be seen as different steps which can be used for __analyzing__ the data and answer the overall questions. This course will focus on the two first steps. 

Given an analysis, __communication__ is an absolutely critical part. It does not matter how well your models and visualization have led you to understand the data unless you can also communicate your results to decision makers. 

Note that analytics is not a one-way process, it is common that you several times have to tidy and transform your data, explore and visualize based on the results of a model, rerun the model based on feedback from the decision makers etc. Common connections are visualized using directed arrows in Figure \@ref(fig:process). 

Surrounding the process is __programming__. Programming is the Swiss army knife you use during parts of the process. An introduction to programming is given using both VBA in Excel and the programming language and free software environment [R]. Programming focus on writing algorithms. An __algorithm__ is a finite sequence of well-defined instructions to solve a specific problem or to perform a computation. That is, we use a programming language to program an algorithm that solves a specific task, e.g. find the best route, sort words, make a plot, etc.

## R vs Excel/VBA {#r-vs-vba}

This course gives you an introduction to programming using both VBA and R. The two programming languages are different and here are some comparisons:

__Excel__ 

Pros:

  * Initial learning curve is quite minimal.
  * Analysis can be done via point-and-click. 
  * Useful for fast analysis (you can change a cell and see effects on other cells, plots etc.)
  * It is not exceedingly hard to make basic graphs and charts. 
  * Data can be stored inside the sheets.

Cons:

  * The mixture of data entries, analysis, and visualization makes it easy to confuse cells that contain raw data from those that are the product of analysis.
  * The analysis directly manipulates the only copy of the raw data.
  * Using mouse clicks means that a mistaken click or drag action can lead to errors or the overwriting of data.
  * Do not handle non-tabular data well.

__VBA__

VBA is a [compiled language](https://en.wikipedia.org/wiki/Compiled_language) implemented using compilers (translators that generate machine code from source code). That is, code need to be compiled first before running it.

Pros: 

  * Can be used inside MS Office applications e.g. Excel.
  * Already contained in Excel, i.e. if you have Excel installed you can start coding.
  * The VBA code is stored within the spreadsheet, allowing any user with access to the spreadsheet to easily run the code.
  * VBA is easy to learn. Especially if you are already experienced in Excel.
  * Good for automating tasks in Excel.
  * Still used in many companies.

Cons:

  * A programming language, meaning the initial learning curve is steeper.
  * It will take you some time to become familiar with the interface and master the various functions. 
  * Since a compiled language, compiling code may take time.
  * Powerful inside Excel but other programming languages are better to learn for general tasks.
  * An old programming language (Microsoft stopped investing in VBA in 2008).

__R__

R is an [interpreted language](https://en.wikipedia.org/wiki/Interpreter_(computing)) with step-by-step execution of source code (no pre-runtime translation takes place) from the command line or using a script file.

Pros: 

  * There is a clear division between data entry and analysis. You import the data, create an object that is a copy of the raw data and do manipulations on this copy. That is, the original data are never altered in any way and there is no way to mess up the raw data. 
  * Manipulating a copy of the data enables you to experiment. A line of code that fails to produce the expected result can be tweaked and rerun.
  * All manipulations can be done in code.
  * The process of analysis are easily reproduced by the code. That is, the use of code for data analysis enables the creation of more reproducible research.    
  * With code all analysis is documented instead of being hidden behind mouse clicks. 
  * Saving analysis in code has the immediate benefit that it can be easily rerun anytime that new data is added or the code can also be applied to a completely new data set. 
  * Free and with a large community that promotes sharing of libraries for data analysis.
  * Can produce complex and advanced data visualizations.

Cons:

  * R is a  programming language, meaning the initial learning curve is steeper. 
  * It will take you some time to become familiar with the interface and master the various functions. 


## How a computer works {#computer}

As a prerequisite for this course you need some basic knowledge about what a computer is. Have a look at these [slides](https://www.cs.princeton.edu/courses/archive/fall11/cos109/02inside.pdf) or this [video](https://youtu.be/p3q5zWCw8J4).


## How the notes are organized {#organization}

Module \@ref(mod-intro) (this module) gives a short introduction to the course. The course notes consists of different parts each containing teaching modules about specific topics:

   * [Part I](#mod-vba-intro) consider tools for analytics using VBA in Excel (mainly programming). Module \@ref(mod-vba-intro) gives you an introduction to VBA so you can get started programming. In Module \@ref(mod-vba-loops-cond) loop and conditional statements are introduced and Module \@ref(mod-vba-procedures) focus on how to make procedures. Next, we consider advanced data types and usage in Module \@ref(mod-vba-datatypes). Finally, Module \@ref(#mod-vba-random-numbers) considers generation of random numbers in VBA and how they can be used for simulation. 

   * [Part II](#mod-r-install) consider tools for analytics using R. 
   
   <!-- focuses on helping you install the needed programs on your computer (Module \@ref(mod-r-install)) and gives you a short introduction to R (Module \@ref(mod-r-workflow)). -->
   <!-- * [Part VI](#mod-r-loops-cond) gives you an overview over programming in R including loops and conditionals (Module \@ref(mod-r-loops-cond)) and functions (Module \@ref(mod-r-functions)). -->

   <!-- * [Part VII](#mod-r-tidyverse-intro) the focus is on import/export, tidy and transformation of data. Module \@ref(mod-r-tidyverse-intro) first gives you an introduction to the [tidyverse][tidyverse-main-page] packages and introduces you to literal programming using R Markdown. Next, Module \@ref(mod-r-io) shows you how to export and import data. Finally, Module \@ref(mod-r-transform) focuses on transformation of data. -->
   <!-- * [Part VIII](#mod-r-plot) considers visualization of data in R (Module \@ref(mod-r-plot)). -->
   <!-- * [Part IX](#mod-project) presents the mandatory R project. -->
   <!-- * [Part X](#mod-r-maps) contains extra modules useful when coding in R.  -->

The appendix contains different modules that may be helpful for you including hints on [how to work in groups](#groups), [how to get help](#help) if you are stuck and [how to annotate](#annotate) the course notes.
   


## Acknowledgements {#ack} 

Some of the materials in these notes are taken from various places

* The bookdown skeleton and some notes are based on the [Stat545][stat-545] course.
* Some parts in Module \@ref(mod-intro) are inspired by [Chapter 1](https://r4ds.had.co.nz/introduction.html) in @r4ds.
* The VBA modules are inspired by the book @vba-book. This also holds for some of the exercises. 
* Module \@ref(mod-r-install) is inspired by [Chapter 1](https://stat545.com/block000_r-rstudio-install.html) in @stat545.
* Module \@ref(mod-r-workflow) is using some text and images from [Chapter 1](https://moderndive.netlify.app/1-getting-started.html) in @moderndrive and [Chapter 2](https://stat545.com/block002_hello-r-workspace-wd-project.html) in @stat545. A few exercises are inspired by [Chapter 2](https://rafalab.github.io/dsbook/r-basics.html) in @dsbook.
* Notes about git and GitHub in the appendix are based on @hgit.
* Exercise \@ref(ex-gapminder1) is a revision of Chapters 6-7 in @stat545.
* Exercise \@ref(ex-babynames1) is a revision of [Session 3](https://github.com/rstudio-education/welcome-to-the-tidyverse/blob/master/03-Transform/03-Transform-Exercises.Rmd) in the [Welcome to the tidyverse][course-welcome-to-the-tidyverse] course.
* Exercise \@ref(ex-gapminder2) is a revision of [Chapter 9](https://rafalab.github.io/dsbook/gapminder.html) in @dsbook.
* Exercise \@ref(ex-covid19) is inspired by the COVID19 application [exercise](https://raw.githubusercontent.com/rstudio-education/datascience-box/master/course-materials/application-exercises/ae-01b-covid/covid.Rmd) at the [data science in a box](https://github.com/rstudio-education/datascience-box) course.
* Exercise \@ref(ex-lego) is inspired by the Lego homework [exercise](https://github.com/rstudio-education/datascience-box/blob/master/course-materials/hw-instructions/hw-04/hw-04-legos-instructors.Rmd) at the [data science in a box](https://github.com/rstudio-education/datascience-box) course.
* Exercise \@ref(ex-fish) is inspired by the Fisheries application [exercise](https://github.com/rstudio-education/datascience-box/blob/master/course-materials/application-exercises/ae-05-fisheries-datajoins/fisheries.Rmd) at the [data science in a box](https://github.com/rstudio-education/datascience-box) course.




I would like to thank all for their inspiration. Also thanks to Solveig for proofreading the draft. 

This work is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/).


## Exercises {#ex-intro}

### Exercise - How to annotate {#ex-annotate}

The online course notes can be annotated using [hypothes.is]. You can create both private and public annotations. Collaborative annotation helps people connect to each other and what they’re reading, even when they’re keeping their distance. You may also use public notes to help indicate spell errors, unclear content etc. in the notes. 

<!-- <img src="img/annotate.png" align="right" alt="Hypothes.is icons" title="Hypothes.is icons" style = "float: right; margin: 0 0 0 15px;"> -->

   1) Sign-up at [hypothes.is]. If you are using Chrome you may also install the [Chrome extension](https://chrome.google.com/webstore/detail/hypothesis-web-pdf-annota/bjfhmglciegochdpefhhlphglcehbmek).
   2) Go back to this page and login in the upper right corner (there should be some icons e.g. `<`).
   3) Select some text and try to annotate it using both a private and public annotation (you may delete it again afterwards). 
   4) Go to the [slides for this module](https://bss-osca.github.io/tfa/slides/01_intro-slides.html#9) and try to annotate the page with a private comment. 
   

[BSS]: https://bss.au.dk/en/

[course-help]: https://github.com/bss-osca/tfa/issues
[cran]: https://cloud.r-project.org
[cheatsheet-readr]: https://rawgit.com/rstudio/cheatsheets/master/data-import.pdf
[course-welcome-to-the-tidyverse]: https://github.com/rstudio-education/welcome-to-the-tidyverse

[DataCamp]: https://www.datacamp.com/
[datacamp-signup]: https://www.datacamp.com/groups/shared_links/cbaee6c73e7d78549a9e32a900793b2d5491ace1824efc1760a6729735948215
[datacamp-r-intro]: https://learn.datacamp.com/courses/free-introduction-to-r
[datacamp-r-rmarkdown]: https://campus.datacamp.com/courses/reporting-with-rmarkdown
[datacamp-r-communicating]: https://learn.datacamp.com/courses/communicating-with-data-in-the-tidyverse
[datacamp-r-communicating-chap3]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/introduction-to-rmarkdown
[datacamp-r-communicating-chap4]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/customizing-your-rmarkdown-report
[datacamp-r-intermediate]: https://learn.datacamp.com/courses/intermediate-r
[datacamp-r-intermediate-chap1]: https://campus.datacamp.com/courses/intermediate-r/chapter-1-conditionals-and-control-flow
[datacamp-r-intermediate-chap2]: https://campus.datacamp.com/courses/intermediate-r/chapter-2-loops
[datacamp-r-intermediate-chap3]: https://campus.datacamp.com/courses/intermediate-r/chapter-3-functions
[datacamp-r-intermediate-chap4]: https://campus.datacamp.com/courses/intermediate-r/chapter-4-the-apply-family
[datacamp-r-functions]: https://learn.datacamp.com/courses/introduction-to-writing-functions-in-r
[datacamp-r-tidyverse]: https://learn.datacamp.com/courses/introduction-to-the-tidyverse
[datacamp-r-strings]: https://learn.datacamp.com/courses/string-manipulation-with-stringr-in-r
[datacamp-r-dplyr]: https://learn.datacamp.com/courses/data-manipulation-with-dplyr
[datacamp-r-dplyr-bakeoff]: https://learn.datacamp.com/courses/working-with-data-in-the-tidyverse
[datacamp-r-ggplot2-intro]: https://learn.datacamp.com/courses/introduction-to-data-visualization-with-ggplot2
[datacamp-r-ggplot2-intermediate]: https://learn.datacamp.com/courses/intermediate-data-visualization-with-ggplot2
[dplyr-cran]: https://CRAN.R-project.org/package=dplyr
[debug-in-r]: https://rstats.wtf/debugging-r-code.html

[excel-vs-r]: https://www.jessesadler.com/post/excel-vs-r/

[google-form]: https://forms.gle/s39GeDGV9AzAXUo18
[google-grupper]: https://docs.google.com/spreadsheets/d/1DHxthd5AQywAU4Crb3hM9rnog2GqGQYZ2o175SQgn_0/edit?usp=sharing
[GitHub]: https://github.com/
[git-install]: https://git-scm.com/downloads
[github-actions]: https://github.com/features/actions
[github-pages]: https://pages.github.com/

[happy-git]: https://happygitwithr.com
[hg-install-git]: https://happygitwithr.com/install-git.html
[hg-why]: https://happygitwithr.com/big-picture.html#big-picture
[hg-github-reg]: https://happygitwithr.com/github-acct.html#github-acct
[hg-git-install]: https://happygitwithr.com/install-git.html#install-git
[hg-exist-github-first]: https://happygitwithr.com/existing-github-first.html
[hg-exist-github-last]: https://happygitwithr.com/existing-github-last.html
[hg-credential-helper]: https://happygitwithr.com/credential-caching.html
[hypothes.is]: https://web.hypothes.is/

[osca-programme]: https://kandidat.au.dk/en/operationsandsupplychainanalytics/

[Peergrade]: https://peergrade.io
[peergrade-signup]: https://app.peergrade.io/join
[point-and-click]: https://en.wikipedia.org/wiki/Point_and_click
[pkg-bookdown]: https://bookdown.org/yihui/bookdown/
[pkg-openxlsx]: https://ycphs.github.io/openxlsx/index.html
[pkg-ropensci-writexl]: https://docs.ropensci.org/writexl/
[pkg-jsonlite]: https://cran.r-project.org/web/packages/jsonlite/index.html

[R]: https://www.r-project.org
[RStudio]: https://rstudio.com
[rstudio-cloud]: https://rstudio.cloud/spaces/176810/join?access_code=LSGnG2EXTuzSyeYaNXJE77vP33DZUoeMbC0xhfCz
[r-cloud-mod12]: https://rstudio.cloud/spaces/176810/project/2963819
[r-cloud-mod13]: https://rstudio.cloud/spaces/176810/project/3020139
[r-cloud-mod14]: https://rstudio.cloud/spaces/176810/project/3020322
[r-cloud-mod15]: https://rstudio.cloud/spaces/176810/project/3020509
[r-cloud-mod16]: https://rstudio.cloud/spaces/176810/project/3026754
[r-cloud-mod17]: https://rstudio.cloud/spaces/176810/project/3034015
[r-cloud-mod18]: https://rstudio.cloud/spaces/176810/project/3130795
[r-cloud-mod19]: https://rstudio.cloud/spaces/176810/project/3266132
[rstudio-download]: https://rstudio.com/products/rstudio/download/#download
[rstudio-customizing]: https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio
[rstudio-key-shortcuts]: https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts
[rstudio-workbench]: https://www.rstudio.com/wp-content/uploads/2014/04/rstudio-workbench.png
[r-markdown]: https://rmarkdown.rstudio.com/
[ropensci-writexl]: https://docs.ropensci.org/writexl/
[r4ds-pipes]: https://r4ds.had.co.nz/pipes.html
[r4ds-factors]: https://r4ds.had.co.nz/factors.html
[r4ds-strings]: https://r4ds.had.co.nz/strings.html
[r4ds-iteration]: https://r4ds.had.co.nz/iteration.html

[stat-545]: https://stat545.com
[stat-545-functions-part1]: https://stat545.com/functions-part1.html
[stat-545-functions-part2]: https://stat545.com/functions-part2.html
[stat-545-functions-part3]: https://stat545.com/functions-part3.html
[slides-welcome]: https://bss-osca.github.io/tfa/slides/00-tfa_welcome.html
[slides-m1-3]: https://bss-osca.github.io/tfa/slides/01-welcome_r_part.html
[slides-m4-5]: https://bss-osca.github.io/tfa/slides/02-programming.html
[slides-m6-8]: https://bss-osca.github.io/tfa/slides/03-transform.html
[slides-m9]: https://bss-osca.github.io/tfa/slides/04-plot.html
[slides-m83]: https://bss-osca.github.io/tfa/slides/05-joins.html

[tidyverse-main-page]: https://www.tidyverse.org
[tidyverse-packages]: https://www.tidyverse.org/packages/
[tidyverse-core]: https://www.tidyverse.org/packages/#core-tidyverse
[tidyverse-ggplot2]: https://ggplot2.tidyverse.org/
[tidyverse-dplyr]: https://dplyr.tidyverse.org/
[tidyverse-tidyr]: https://tidyr.tidyverse.org/
[tidyverse-readr]: https://readr.tidyverse.org/
[tidyverse-purrr]: https://purrr.tidyverse.org/
[tidyverse-tibble]: https://tibble.tidyverse.org/
[tidyverse-stringr]: https://stringr.tidyverse.org/
[tidyverse-forcats]: https://forcats.tidyverse.org/
[tidyverse-readxl]: https://readxl.tidyverse.org
[tidyverse-googlesheets4]: https://googlesheets4.tidyverse.org/index.html
[tutorial-markdown]: https://commonmark.org/help/tutorial/

[Udemy]: https://www.udemy.com/

[vba-yt-course1]: https://www.youtube.com/playlist?list=PLpOAvcoMay5S_hb2D7iKznLqJ8QG_pde0
[vba-course1-hello]: https://youtu.be/f42OniDWaIo

[vba-yt-course2]: https://www.youtube.com/playlist?list=PL3A6U40JUYCi4njVx59-vaUxYkG0yRO4m
[vba-course2-devel-tab]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-editor]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-project]: https://youtu.be/fp6PTbU7bXo
[vba-course2-devel-properties]: https://youtu.be/ks2QYKAd9Xw
[vba-course2-devel-hello]: https://youtu.be/EQ6tDWBc8G4

[video-install]: https://vimeo.com/415501284
[video-rstudio-intro]: https://vimeo.com/416391353
[video-packages]: https://vimeo.com/416743698
[video-projects]: https://vimeo.com/319318233
[video-r-intro-p1]: https://www.youtube.com/watch?v=vGY5i_J2c-c
[video-r-intro-p2]: https://www.youtube.com/watch?v=w8_XdYI3reU
[video-r-intro-p3]: https://www.youtube.com/watch?v=NuY6jY4qE7I
[video-subsetting]: https://www.youtube.com/watch?v=hWbgqzsQJF0&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10&t=0s
[video-datatypes]: https://www.youtube.com/watch?v=5AQM-yUX9zg&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10
[video-control-structures]: https://www.youtube.com/watch?v=s_h9ruNwI_0
[video-conditional-loops]: https://www.youtube.com/watch?v=2evtsnPaoDg
[video-functions]: https://www.youtube.com/watch?v=ffPeac3BigM
[video-tibble-vs-df]: https://www.youtube.com/watch?v=EBk6PnvE1R4
[video-dplyr]: https://www.youtube.com/watch?v=aywFompr1F4

[wiki-snake-case]: https://en.wikipedia.org/wiki/Snake_case
[wiki-camel-case]: https://en.wikipedia.org/wiki/Camel_case
[wiki-interpreted]: https://en.wikipedia.org/wiki/Interpreted_language
[wiki-literate-programming]: https://en.wikipedia.org/wiki/Literate_programming
[wiki-csv]: https://en.wikipedia.org/wiki/Comma-separated_values
[wiki-json]: https://en.wikipedia.org/wiki/JSON

<!--chapter:end:index.Rmd-->

---
output: html_document
editor_options: 
  chunk_output_type: console
---






# (PART) VBA {-}


# An introduction to VBA {#mod-vba-intro}

This module gives a short introduction to VBA, so you can get started programming and run your code.


```{=html}
<div>
A template with VBA code for this module is given in the file
<a href="https://github.com/bss-osca/tfa/blob/master/vba/02-vba-intro-template.xlsm" target="_blank">02-vba-intro-template.xlsm</a>
(open it and use it while reading the notes). Have a look inside the module
<i>TM2_ex</i>
in the VBA editor for examples used in the notes and during lectures. Have a look at module
<i>TM2_exercises</i>
for exercises. The template file for next teaching module will contain guiding answers for the exercises to this teaching module.
</div>
```

#### Learning path diagram {-}

Click/hover the nodes to follow links and see details.


```{=html}
<div id="htmlwidget-5b73b3374df69eb81427" style="width:100%;height:300px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-5b73b3374df69eb81427">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"📖 What is VBA\", URL = \"#vba-what\", tooltip = \"\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"0,6!\"] \n  \"2\" [label = \"💡 Setup Excel for VBA\", URL = \"#vba-setup\", tooltip = \"\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"2.5,6!\"] \n  \"3\" [label = \"💡 Your first program\", URL = \"#vba-hello\", tooltip = \"\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"6,6!\"] \n  \"4\" [label = \"💡 The macro recorder\", URL = \"#vba-macro\", tooltip = \"\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"9.5,6!\"] \n  \"5\" [label = \"💡 VBA a short overview\", URL = \"#vba-overview\", tooltip = \"\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"13,6!\"] \n  \"6\" [label = \"📖 Good coding pratice\", URL = \"#vba-coding-practice\", tooltip = \"\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"16,6!\"] \n  \"7\" [label = \"💻 Exercises\", URL = \"#ex-vba-intro\", tooltip = \"\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"18.5,6!\"] \n  \"8\" [label = \"🎬 Developer Tab\", URL = \"https://youtu.be/awEOUaw9q58\", tooltip = \"A short intro to the developer tab.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"PeachPuff3\", pos = \"2.5,5!\"] \n  \"9\" [label = \"🎬 The VBA Editor\", URL = \"https://youtu.be/utfS_8sWfF8\", tooltip = \"A short intro to the VBA editor.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"PeachPuff3\", pos = \"2.5,4!\"] \n  \"10\" [label = \"🎬 The Project Explorer\", URL = \"https://youtu.be/fp6PTbU7bXo\", tooltip = \"A short intro to the project explorer.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"PeachPuff3\", pos = \"2.5,3!\"] \n  \"11\" [label = \"🎬 The Properties Window\", URL = \"https://youtu.be/ks2QYKAd9Xw\", tooltip = \"A short intro to the properties window.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"PeachPuff3\", pos = \"2.5,2!\"] \n  \"12\" [label = \"🎬 Your First Macro\", URL = \"https://youtu.be/EQ6tDWBc8G4\", tooltip = \"How to write a sub procedure (macro).\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"PeachPuff3\", pos = \"6,5!\"] \n  \"13\" [label = \"🎬 The macro recorder\", URL = \"https://youtu.be/J42AlhUGHH8\", tooltip = \"An introduction to the macro recorder.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"PeachPuff3\", pos = \"9.5,5!\"] \n\"1\"->\"2\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"3\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"8\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"4\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"12\" [color = \"black\", arrowhead = \"vee\"] \n\"4\"->\"5\" [color = \"black\", arrowhead = \"vee\"] \n\"4\"->\"13\" [color = \"black\", arrowhead = \"vee\"] \n\"5\"->\"6\" [color = \"black\", arrowhead = \"vee\"] \n\"6\"->\"7\" [color = \"black\", arrowhead = \"vee\"] \n\"8\"->\"9\" [color = \"black\", arrowhead = \"vee\"] \n\"9\"->\"10\" [color = \"black\", arrowhead = \"vee\"] \n\"10\"->\"11\" [color = \"black\", arrowhead = \"vee\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
```

If you like a different learning style there is a lot for videos about VBA online such as course [14-Hour VBA Course][vba-yt-course2]. The videos have been pointed out as extra online supplements in the learning path diagram. However, they are not necessary for the course. Since Excel change as new versions arrive and it work on different operating systems, the look in the screenshots and videos might be a bit different from your version. However, you still should be able to understand it. 

## Learning outcomes {#lo-vba-intro}

By the end of this module, you are expected to:

* Describe what VBA is.
* Setup Excel for VBA.
* Know how the macro recorder works.
* Make your first program.
* Have an overview over what VBA can do.
* Describe what a variable is.
* Name different data types and how they effect memory size.
* Declare a variable as a data type.
* Make a simple procedure.
* Do simple loops and conditional statements.
* Recorded you first macro using the macro recorder

The learning outcomes relate to the [overall learning goals](#lg-course) number 2 and 4 of the course.

<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->

## What is VBA {#vba-what}

Visual Basic for Applications (VBA) is an implementation of the BASIC programming language intended to control and automate Microsoft Office applications, developed by Microsoft. For instance, you can automatically create sheets, delete objects, create user-defined functions or read/write data to a sheet. It is not a standalone program, it can only run in the host application. In this course we will focus on running VBA from Excel. VBA is widely used in the industry (specially linked to Excel) and easy to learn. Microsoft stopped investing in VBA in 2008. It only update it for small changes. However, VBA is still a vital part of desktop Office applications, and will continue to be so in the future. 

VBA is a [compiled language](https://en.wikipedia.org/wiki/Compiled_language#:~:text=A%20compiled%20language%20is%20a,%2Druntime%20translation%20takes%20place) implemented using compilers (translators that generate machine code from source code). That is, code need to be compiled first before running it. You can only run VBA using the desktop version of Excel. That is, you can't create, run, or edit VBA in Excel for the web. 

With VBA you can extend Excel and automate tasks by coding different algorithms that for instance can be run by pressing a button. Since VBA is a programming language, the initial learning curve is steeper compared to Excel. However, you will get started fast because you already know Excel.


## Setup Excel for VBA {#vba-setup}

For running VBA code the **Developer** tab needs to be visible in Excel. This can be done by check marking the **Developer** tab under the 'Ribbon and Toolbar' options in Excel. You add it by choosing **Excel -> Preferences -> Ribbon and toolbar** (<svg viewBox="0 0 384 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 49.9-11.4 69.5-34.3z"></path></svg>) or right click a tab and choose **Customize ribbon ...** (<svg viewBox="0 0 448 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"></path></svg>). 

<div class="figure" style="text-align: center">
<img src="img/vba-editor.png" alt="The VBA editor." width="100%" />
<p class="caption">(\#fig:vba-editor)The VBA editor.</p>
</div>

In the **Developer** tab you open the VBA editor by pressing the **Visual basic** button (<svg viewBox="0 0 448 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"></path></svg> Alt + F11, <svg viewBox="0 0 384 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 49.9-11.4 69.5-34.3z"></path></svg> ⌥ + F11). The VBA editor is where you write your VBA code. A screenshot of the VBA editor can be seen in Figure \@ref(fig:vba-editor). You can setup the editor so it consists of a set of different sub-windows. Here we will highlight the ones you will use the most:

   * *Code*: The code window is where you can see the code of your modules. 
   * *Process Explorer*: Gives you an overview over all your open workbooks (a Excel file) and the VBA modules (a place to write VBA code) inside each workbook. 
   * *Properties*: Each element in the Process Explorer can be seen as an object and each object has a set of properties. For instance a module have a property called `Name` containing the name of the module. You can edit the name by modifying the field in the Properties window. Similar a worksheet has a set of properties (try selecting one of the sheets in the Process Explorer).
   * *Locals*: This is a window which can be used for debugging. During debugging you can run your code line by line by inserting breakpoints. You can then observe the values of your variables in the Locals window.
   
   <!-- * *Immediate*: This is a window which can be used for debugging (checking your code during development). Here you can output checks and run pieces of code. -->
   
If you do not see the sub-windows in the editor. Then you can open them using the icons in the toolbar (hoover over the icons to find them). Finally, let us set the preferences for the VBA editor. Open the preferences/options **Excel -> Preferences -> Editor** (<svg viewBox="0 0 384 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 49.9-11.4 69.5-34.3z"></path></svg>) or **Tools -> Options -> Editor** (<svg viewBox="0 0 448 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"></path></svg>). Uncheck mark 'Auto Syntax Check' and check mark 'Require Variable Declaration'. 

  
## Your first program {#vba-hello}

Let us try to make your first piece of code. Download the template file `<a href="https://github.com/bss-osca/tfa/blob/master/vba/02-vba-intro-template.xlsm" target="_blank">02-vba-intro-template.xlsm</a>`{=html}, open the file and open the VBA editor under the **Developer** tab. 

   1) Add a new module by clicking the *Insert Module* icon (upper left corner - note you can hoover over the icons to see what they do).
   2) Rename the module (named *Module1*) to *TM2_hello* (note you have to use underscores).
   3) Open the module by double clicking on the module in the Process Explorer 
   4) Add the code 
   
      ```
      ' Your first program/macro
      Sub TM2_SayHello()
          MsgBox ("Say hello world :-)")
      End Sub
      ```
      
      The code is a procedure (sub) and since it does not have any input arguments it is called a *macro* and can be run directly. Note if a line starts with a `'` then the line is considered as a comment and not used by the program.
   5) Run the macro by pressing the *Play* icon or using the shortcut F5. What happend?
   6) Go to the worksheet *TM2* in Excel. 
      * In the **Developer** tab press the *Button* icon and click on cell G3. 
      * In the popup window select macro name *TM2_SayHello* and click OK.
      * Rename the button by clicking the text and call it 'Say Hello'. Click besides the button to finish.
      * Run the button by clicking it.
      * Try right clicking the button and move/resize it.
   7) Save the workbook (Excel file). Note the Excel file has extension `.xlsm` and not `.xlsx` because it contains VBA code. 

You have now finished your first program by saying hello to the world using a message box.


## The macro recorder {#vba-macro}

It is possible to use the Macro recorder to turn your actions in Excel into VBA code. This can be particularly useful if you have forgotten the code for a specific color, the name of a function or need to plot a graph. Unfortunately, you cannot record if-statements or loops, so the recorder is not an easy way out of learning to code. But it is a handy tool for getting pieces of code. 

Let us try to record a macro that make a scatter plot of cells D8:E12 and change the title:

   1) Click the **Record Macro** icon under under the **Developer** tab.
   2) Name the macro *TM2_Plot* and click OK (the recorder is now running).
   3) Go to the worksheet *TM2* and select cells D8:E12.
   4) Add a scatter plot of the points.
   5) Rename the title to 'A line'.
   6) Click the **Stop Recording** icon under under the **Developer** tab.

You have now finished recording your macro. Let us have a look at the code by going to the `TM2_Plot` sub in the VBA editor. You should have something similar to:

```
Sub TM2_Plot()
'
' TM2_Plot Macro
'
    Worksheets("TM2").Activate
    Range("D8:E12").Select
    ActiveSheet.Shapes.AddChart2(240, xlXYScatterSmooth).Select
    ActiveChart.SetSourceData Source:=Range("'TM2'!$D$8:$E$12")
    ActiveChart.ChartTitle.Select
    ActiveChart.ChartTitle.Select
    ActiveChart.ChartTitle.Text = "A line"
    Selection.Format.TextFrame2.TextRange.Characters.Text = "A line"
    With Selection.Format.TextFrame2.TextRange.Characters(1, 6).ParagraphFormat
        .TextDirection = msoTextDirectionLeftToRight
        .Alignment = msoAlignCenter
    End With
    With Selection.Format.TextFrame2.TextRange.Characters(1, 1).Font
        .BaselineOffset = 0
        .Bold = msoFalse
        .NameComplexScript = "+mn-cs"
        .NameFarEast = "+mn-ea"
        .Fill.Visible = msoTrue
        .Fill.ForeColor.RGB = RGB(89, 89, 89)
        .Fill.Transparency = 0
        .Fill.Solid
        .Size = 14
        .Italic = msoFalse
        .Kerning = 12
        .Name = "+mn-lt"
        .UnderlineStyle = msoNoUnderline
        .Spacing = 0
        .Strike = msoNoStrike
    End With
    With Selection.Format.TextFrame2.TextRange.Characters(2, 5).Font
        .BaselineOffset = 0
        .Bold = msoFalse
        .NameComplexScript = "+mn-cs"
        .NameFarEast = "+mn-ea"
        .Fill.Visible = msoTrue
        .Fill.ForeColor.RGB = RGB(89, 89, 89)
        .Fill.Transparency = 0
        .Fill.Solid
        .Size = 14
        .Italic = msoFalse
        .Kerning = 12
        .Name = "+mn-lt"
        .UnderlineStyle = msoNoUnderline
        .Spacing = 0
        .Strike = msoNoStrike
    End With
    ActiveChart.ChartArea.Select
End Sub
```

In general a recorded macro contains a lot of unnecessary code which can be removed. For instance, here we just want to make a scatter plot of cells D8:E12 and change the title. That is, the code can be reduced to:

```
' Add a scatter plot
Sub TM2_Plot()
    Worksheets("TM2").Activate
    Range("D8:E12").Select
    ActiveSheet.Shapes.AddChart2(240, xlXYScatterSmooth).Select
    ActiveChart.SetSourceData Source:=Range("'TM2'!$D$8:$E$12")
    ActiveChart.ChartTitle.Text = "A line"
End Sub
```

Which code to remove can sometimes be hard to realize. However, you may try to remove small parts of code, run the macro and check if the results still are as wanted.

Finally, try to add a button 'Make plot' that run the macro. Go to the worksheet *TM2* and do steps:

   * In the **Developer** tab press the *Button* icon and click on cell G8. 
   * In the popup window select macro name *TM2_Plot* and click OK.
   * Rename the button by clicking the text and call it 'Make plot'. Click besides the button to finish.
   * Run the button by clicking it.


## VBA - A short overview {#vba-overview}

Let us have a short overview over some VBA features so you can get started coding. Basic building blocks in programming are:

- _Variables_ store stuff in memory.
- _Procedures_ (functions and subs) execute a set of instructions.
- _Input and output_ are needed to read data and output the result.
- _Conditional statements_ are used to execute different instructions depending on a true/false value.
- _Loops_ are used to execute code repeatedly. 


### Variables

Variables are used to store information that is saved in memory. You may visualize a variable as a box in memory (see Figure \@ref(fig:vba-memory)). The variable name can be seen as the label on the box. 

<div class="figure" style="text-align: center">
<img src="./img/storage.jpg" alt="Visualization of computer memory" width="700px" />
<p class="caption">(\#fig:vba-memory)Visualization of computer memory</p>
</div>

The box can contain for instance a number, a date or a boolean. That is, any data type defined by VBA. Some of the basic data types used by VBA are:

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>(\#tab:unnamed-chunk-9)Basic data types.</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> Name </th>
   <th style="text-align:left;"> Type </th>
   <th style="text-align:left;"> Details </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Byte </td>
   <td style="text-align:left;"> Numerical </td>
   <td style="text-align:left;"> Whole number between 0 and 255. </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Integer </td>
   <td style="text-align:left;"> Numerical </td>
   <td style="text-align:left;"> Whole number between -32768 and 32767. </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Long </td>
   <td style="text-align:left;"> Numerical </td>
   <td style="text-align:left;"> Whole number between - 2147483648 and 2147483647. </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Double </td>
   <td style="text-align:left;"> Numerical </td>
   <td style="text-align:left;"> Floating decimal number between -1.79769313486232E308 and 1.79769313486232E308. </td>
  </tr>
  <tr>
   <td style="text-align:left;"> String </td>
   <td style="text-align:left;"> Text </td>
   <td style="text-align:left;"> Text. </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Date </td>
   <td style="text-align:left;"> Date </td>
   <td style="text-align:left;"> Date and time. </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Boolean </td>
   <td style="text-align:left;"> Boolean </td>
   <td style="text-align:left;"> True or False. </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Variant </td>
   <td style="text-align:left;"> Any type </td>
   <td style="text-align:left;"> Any kind of data (default type if the variable is not declared). </td>
  </tr>
</tbody>
</table>

All basic data types can be seen in the [VBA documentation](https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/data-type-summary).  Note that some data types are numericals, i.e. they represent a number (either an integer or a decimal number), other data types represent a set of characters (a string), a boolean or a date. 

More advanced data types such as a group of numbers (a numeric array), a range of cells in a worksheet (an object) or a set of numbers (a collection) will be considered in Module \@ref(mod-vba-datatypes).

Your memory contains a limited amount of storage and it is therefore important to use it wisely. The computer memory can be seen as a group of bits (zero and ones) and we can measure the memory size by counting the number of bits or bytes (8 bits = 1 byte). Different data types take up different amounts of memory. For example, the memory requirements for some of the basic data types are:

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;border-bottom: 0;">
<caption>(\#tab:unnamed-chunk-10)Memory requirements for some data types.</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> Data type </th>
   <th style="text-align:left;"> Storage size </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Byte </td>
   <td style="text-align:left;"> 1 byte </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Boolean </td>
   <td style="text-align:left;"> 2 bytes </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Integer </td>
   <td style="text-align:left;"> 2 bytes </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Long  (long integer) </td>
   <td style="text-align:left;"> 4 bytes </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Double  (double-precision floating-point) </td>
   <td style="text-align:left;"> 8 bytes </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Date </td>
   <td style="text-align:left;"> 8 bytes </td>
  </tr>
  <tr>
   <td style="text-align:left;"> String </td>
   <td style="text-align:left;"> 10 bytes + string length * 2 bytes </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Variant  (a number) </td>
   <td style="text-align:left;"> 16 bytes </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Variant  (a string) </td>
   <td style="text-align:left;"> 22 bytes + string length * 2 bytes </td>
  </tr>
</tbody>
<tfoot><tr><td style="padding: 0; " colspan="100%">
<sup></sup> 8 Bits = 1 Byte, 1024 Bytes = 1 Kilobyte, 1024 Kilobytes = 1 Megabyte, 1024 Megabytes = 1 Gigabyte and 1024 Gigabytes = 1 Terabyte.</td></tr></tfoot>
</table>

<!-- Arrays require 20 bytes of memory plus 4 bytes for each array dimension plus the number of bytes occupied by the data itself. A Variant containing an array requires 12 bytes more than the array alone. -->

Always declare your variables explicit in VBA. If you can add `Option Explicit` in the top of your module, undefined variables will raise an error. You can add it by default by modifying the preferences for the VBA editor (see Section \@ref(vba-setup)). Declaring variables is good coding practice since it reduces the memory requirements and avoid type errors such as

```
Option Explicit

Dim intCtr as integer

intCtr = 10
intCtr = intCtg + 10
```

This will raise an error because `intCtg` is not defined (you have made a typo and meant `intCtr`). Without `Option Explicit` the code will run and assume that `intCtg` is another variable (initialized to zero). 

As can be seen a double takes 4 times the memory compared to an integer. That is, you can save memory by considering what data type you need. Consider an example where you have 10000 customer locations on a map and you want to store the distance between customer $i$ and $j$. That is, you have to store $10000 \cdot 10000 = 100.000.000$ numbers. The memory 
requirements given different data types are:

Data type | Memory requirements
-------- | -------------------------------------------------------
Variant  | $(10000\cdot 10000\cdot 16)/1024/1024 \approx 1526$ MB 
Double   | $(10000\cdot 10000\cdot 8)/1024/1024 \approx 763$ MB                                     
Integer  | $(10000\cdot 10000\cdot 2)/1024/1024 \approx 191$ MB  

If you do not think about memory usage a Variant data type would have been used taking up the double the size compared to using a Double (a decimal number). Moreover, if it is enough to measure the distance using an Integer between 0 and 32767, then we can reduce the memory requirements to only 191 MB. Often the free memory in your computer is around 5 GB, i.e. think about which data type you need! 

You declare variables using the `Dim` keyword:

```
'' Declare some variables
Sub TM03_DeclareVariables()
    ' Always declare variables in the top of a procedure (memory is allocated)
    Dim intPersons As Integer
    Dim dblAmount As Double
    Dim strText As String
    
    ' Here we assign values to the variables (modify the memory)
    intPersons = 10
    dblAmount = 27.4
    strText = "Number of persons are "
    
    MsgBox (strText & intPersons & " which own " & dblAmount & "$")
End Sub
```

Three variables are declared on the first three lines in the sub (good coding practice). Variables can be of different data types (here an integer, a double and a string). We allocate values to the variables on the next lines and finally output the result in a message box. Note VBA code is case-insensitive, i.e. `strText` and `strtext` is the same variable. It is good coding practice to be consistent and often the VBA editor will help you by changing `strtext` to `strText` automatically.


### Procedures 

In VBA we deal with two kinds of procedures: A `Sub` which can work as a “macro” in Excel, i.e. we can call it using e.g. a button and a `Function` which can work like Excel functions, i.e. return a value. We already have declared some subs. Let us try to make a function:

```
'' A function joining two strings
Function TM2_StringJoin(strF As String, strL As String) As String
    Dim strJ As String
    strJ = strF & " " & strL
    TM2_StringJoin = strJ
End Function
```

First observe that the function have two string input arguments `strF` and `strL`. These two strings are joined into one string (saved in the variable `strJ`) by using the string concatenate symbol `&`. Finally, the value is returned by assigning the value to same variable as the function name `TM2_StringJoin`. The function can be called from Excel like any other function by using the function name (have a look at cell D5 in the worksheet *TM2*). 

You may also use all the built-in Excel functions in VBA:

```
'' Call an Excel function
Sub TM2_ExcelFunction()
    MsgBox ("The sum of cells D9:D12 are " & WorksheetFunction.Sum(Worksheets("TM2").Range("D9:D12")))
End Sub
```

Note all Excel functions are accessed using the `WorksheetFunction` object. That is, we write `WorksheetFunction.<function name>`. VBA also has a set of [built-in functions](https://www.techonthenet.com/excel/formulas/index_vba.php) which can be used. For instance the `Date` and `InStr` function:

```
'' Call VBA functions (run it using F5)
Sub TM2_VBAFunction()
    MsgBox ("The current date is " & Date)
    MsgBox ("Jen is found at char number: " & InStr("Hi Jen how are you", "Jen"))
End Sub
```

We will have a closer look on procedures in Module \@ref(mod-vba-procedures).


### Input and output

Input and output are needed to read data and output the result. Examples on input/output are dialog boxes which can be created using `MsgBox` or `InputBox`:

```
Sub TM2_Dialog()
    Dim strName As String

    strName = InputBox("Type your name:")
    MsgBox "Your name is " & strName
End Sub
```

First, a string is declared. Next, a value is read to the string using an input box. Finally, the result is output using a message box.

You can also write/read values from a sheet using `Range` or `Cells`. Note it is always a good idea to know which sheet you are considering by using the `Worksheets` function:

```
'' Read and write to sheet
Sub TM2_ReadWriteSheet()
    Dim str1 As String
    Dim int1 As Integer
    
    Worksheets("TM2").Activate  ' We activate a sheet so know use this sheet
    ' Input values from sheet
    str1 = Range("D4")  ' read cell D4
    int1 = Cells(9, 4)  ' read row 9 and col 4 (cell D9)
    ' Output values
    Range("B7") = str1 & "(" & int1 & ")"
    Cells(8, 2) = str1
End Sub
```

After declaring variables, the worksheet TM2 is activated and we input/output values using the `Range` and `Cells` functions. We will have a closer look on the range object in Module \@ref(mod-vba-datatypes).


### Conditional statements

Conditional statements execute different instructions depending on a true/false value.

```
'' Conditional statements example
Sub TM2_CondStatement()
    Dim strName As String
    Dim intAnswer As Integer
    
    Worksheets("TM2").Activate
    strName = InputBox("Type your name:")
    intAnswer = MsgBox("Do you want to display your name in a message box?", vbYesNo)  ' you can use vbYes and vbNo in your code
    If intAnswer = vbYes Then
        ' Make the message box:
        MsgBox ("Your name is " & strName)
    Else
        ' Write to the sheet:
        Range("B10") = strName
        MsgBox ("Your name is in cell B10")
    End If
End Sub
```

After declaring variables and activating the worksheet, a dialog box is used for reading your name. Next, based on your answer we use an `If`/`Else` statement to do two different tasks. We will have a closer look on conditional statements in Module \@ref(mod-vba-loops-cond).


### Loops

Loops can be used to execute code repeatedly:

```
'' Loops example
Sub TM2_Loops()
    Dim k As Integer
    
    Worksheets("TM2").Activate
    For k = 2 To 5
        Cells(k, 10) = "Row " & k
    Next
End Sub
```

Here a `For` loop is used to write out values to cells J2:J5. We will have a closer look on loops in Module ??.


<!-- ## An example -->

## Good coding pratice {#vba-coding-practice}

It is always a good idea to maintain a consistent coding practice. The main reason for using a consistent set of coding conventions is to standardize the structure and coding style of an application so that you and others can easily read and understand the code. Good coding conventions result in precise, readable, and unambiguous source code that is consistent with other language conventions and as intuitive as possible. 

As you already have seen the code in this teaching module has been structured in VBA modules (we use the prefix TM2_ for all modules related to this teaching module). Each procedure starts with a capital letter and we use code indention to read the code easier. 

Different ways of naming variables exists (naming convention). Some use [snake case][wiki-snake-case] others use [camel case][wiki-camel-case]. The [Leszynski naming convention](https://en.wikipedia.org/wiki/Leszynski_naming_convention) define variables with a consistent prefix that makes it easy to identify its data type. Some common prefixes used for the Leszynski naming convention are:

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>(\#tab:unnamed-chunk-11)Prefixes for some variables.</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> Type </th>
   <th style="text-align:left;"> Prefix </th>
   <th style="text-align:left;"> Example </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Boolean </td>
   <td style="text-align:left;"> bln </td>
   <td style="text-align:left;"> blnFound </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Currency </td>
   <td style="text-align:left;"> cur </td>
   <td style="text-align:left;"> curRevenue </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Date (Time) </td>
   <td style="text-align:left;"> dtm&lt; </td>
   <td style="text-align:left;"> dtmStart </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Double </td>
   <td style="text-align:left;"> dbl </td>
   <td style="text-align:left;"> dblTolerance </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Integer </td>
   <td style="text-align:left;"> int </td>
   <td style="text-align:left;"> intQuantity </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Long </td>
   <td style="text-align:left;"> lng </td>
   <td style="text-align:left;"> lngDistance </td>
  </tr>
  <tr>
   <td style="text-align:left;"> String </td>
   <td style="text-align:left;"> str </td>
   <td style="text-align:left;"> strFName </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Variant </td>
   <td style="text-align:left;"> vnt </td>
   <td style="text-align:left;"> vntCheckSum </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Array </td>
   <td style="text-align:left;"> ary </td>
   <td style="text-align:left;"> aryNumbers (optional) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Worksheet </td>
   <td style="text-align:left;"> wst </td>
   <td style="text-align:left;"> wstDistances </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Workbook </td>
   <td style="text-align:left;"> wbk </td>
   <td style="text-align:left;"> wbkData </td>
  </tr>
</tbody>
</table>


Many [other prefixes](https://msdn.microsoft.com/en-us/library/aa263493(v=vs.60).aspx) can be used also. It is common to use Leszynski convention within the VBA community. A few examples:

```
this_is_snake_case   # note you do not use capital letters here (not used)
thisIsCamelCase      # you start each word with a capital letter 
intAmount            # Lezynski convention naming an integer (int) variable
strFullName          # Lezynski naming a string (str) variable
```

We adapt the Leszynski naming convention together with camel case. One exception is that we add the suffix `TM2_` when we name procedures so that we can easy find procedures related to a given teaching module. When defining variables and functions, it is in general good practice to use nouns for variables and verbs for functions.

It is always good practice to comment your code. Such that others can get a fast overview and understand your code easier. We will use [roxygen documentation](https://roxygen2.r-lib.org/) comments which are widely known. For example in the top of a module file you may write:

```
'' Module description.
'  Can be more than one line.
' @author Lars Relund <junk@relund.dk>
```

Before each `sub`, `function` etc. write something like:

```
'' Sub description
' 
' @pre Precondition 
' @post Postcondition
'
' @param strA	Explanation of input parameter strA
' @param intB Explanation of input parameter intB
' @return Return value (if a function)
' @remarks Further remarks 
Function MyFunc(strA As String, intB As Integer) As Integer {
   ...
}
```

For further details about coding/naming convention see Section \@ref(coding-convention).


## Recap {#rc-vba-intro}

This module gives a short introduction to VBA: 

- A programming language intended to control and automate Microsoft Office applications (we use Excel).
- VBA (Visual Basic for Applications) is an implementation of BASIC developed by Microsoft. 
- A [compiled language](https://en.wikipedia.org/wiki/Compiled_language#:~:text=A%20compiled%20language%20is%20a,%2Druntime%20translation%20takes%20place). That is, code need to be compiled first before running it. 
- You can only run VBA using the desktop version of Excel (not the web version).
- With VBA you can extend Excel and automate tasks by coding different algorithms that for instance can be run by pressing a button. 

For running VBA code the **Developer** tab needs to be visible in Excel. This can be done by check marking the **Developer** tab under the 'Ribbon and Toolbar' options in Excel. You add it by choosing **Excel -> Preferences -> Ribbon and toolbar** (<svg viewBox="0 0 384 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 49.9-11.4 69.5-34.3z"></path></svg>) or right click a tab and choose **Customize ribbon ...** (<svg viewBox="0 0 448 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"></path></svg>).

In the **Developer** tab you open the VBA editor by pressing the **Visual basic** button (<svg viewBox="0 0 448 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"></path></svg> Alt + F11, <svg viewBox="0 0 384 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 49.9-11.4 69.5-34.3z"></path></svg> ⌥ + F11).

A few useful shortcuts:

- Toggle VBA editor and Excel (<svg viewBox="0 0 448 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"></path></svg> Alt + F11, <svg viewBox="0 0 384 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 49.9-11.4 69.5-34.3z"></path></svg> ⌘⇧´).
- Run current procedure or continues execution after pausing (F5).
<!-- - Terminate a procedure and reset all variables to their default values (Shift + F5). -->
- Auto complete code (Ctrl + Space). On a mac you may have to disable the default shortcut (Ctrl + Space) for switching input sources. You can go to the System Preferences -> Keyboard -> Shortcuts -> Input Sources and disable it.
- Use the debugger and go to next line of code (<svg viewBox="0 0 448 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"></path></svg> F8, <svg viewBox="0 0 384 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 49.9-11.4 69.5-34.3z"></path></svg> ⇧⌘I).
<!-- - Open the Object Browser (F2). -->
- Switch between subs/functions (<svg viewBox="0 0 448 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"></path></svg>  Ctrl + Up/Down, <svg viewBox="0 0 384 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 49.9-11.4 69.5-34.3z"></path></svg> ⌘ + Up/Down).
<!-- - Run Debugger to this line (Ctrl + F8). -->

Basic building blocks in programming:

- _Variables_ store stuff in memory.
- _Procedures_ (functions and subs) execute a set of instructions.
- _Conditional statements_ are used to execute different instructions depending on a true/false statement.
- _Loops_ are used to execute code repeatedly. 
- _Input/output_ are needed to read data and output the result.

Variables are used to store information in the program. Think of it as a box that can contain e.g. a number, a string or a date. The variable name is the label on the box.

In VBA we deal with two kinds of procedures: A `Sub` which can work as a “macro” in Excel, i.e. we can call it using e.g. a button and a `Function` which can work like Excel functions, i.e. return a value.

Examples on input/output are dialog boxes which can be created using `MsgBox` or `InputBox`. You can also write/read values from a sheet using `Range` or `Cells`. Note it is always a good idea to know which sheet you are considering by using `Worksheets("<sheet name>").Activate`.

Conditional statements (decisions) execute different instructions depending on a true/false. 

Loops can be used to execute code repeatedly.

Excel functions can be called with the `WorksheetFunction` e.g. `WorksheetFunction.Sum(Range("D2:E5"))`

Always remember to save workbooks with VBA code using the file has extension `.xlsm` and not `.xlsx` otherwise the VBA code will be removed from the file! 


```{=html}
<div>
You may also have a look at the
<a href="https://bss-osca.github.io/tfa/slides/02_vba-intro-slides.html" target="_blank">slides for this module</a>
.
</div>
```


## Exercises {#ex-vba-intro}

Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the [help page](#help). Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution!


```{=html}
<div>
A template with VBA code for this module is given in the file
<a href="https://github.com/bss-osca/tfa/blob/master/vba/02-vba-intro-template.xlsm" target="_blank">02-vba-intro-template.xlsm</a>
(open it and use it while reading the notes). Have a look inside the module
<i>TM2_ex</i>
in the VBA editor for examples used in the notes and during lectures. Have a look at module
<i>TM2_exercises</i>
for exercises. The template file for next teaching module will contain guiding answers for the exercises to this teaching module.
</div>
```

### Exercise - Hello {#ex-vba-hello}

Consider the procedure `TM2_SayHello` in Section \@ref(vba-hello) and modify it into procedure `TM2_SayHelloAdv` with features: 
 
   (1) Use an input box to ask for your name.
   (2) Output *Hello <your name>* in cell B11 in worksheet *TM2*.
   (3) Run it using the shortcut F5. 


### Exercise - Record a macro {#ex-vba-macro}
   
Do the following steps:

   (1) Type 'My name is:' in cell B12. 
   (2) Type you name in cell B13 and activate it (click on it).
   (3) Start the macro recorder and call the macro `TM2_ChangeLayout`.
   (4) Change the color to blue and font size to 14.
   (5) Stop the macro recorder.
   (6) Activate cell B12 and run the macro.
   (7) Open the VBA editor and inspect the macro. 
   (8) Cleanup the macro so only stuff about color and size are maintained.
   (9) Add a button to run the macro.
   (10) Select cells D15:E17 and run the macro.
   (11) Modify the macro in the editor so the font size is 10 and test it.


### Exercise - User input {#ex-vba-user-input}

Write a procedure (sub) `TM2_CheckNumber` that:

   (1) Ask for an integer using an input box.
   (2) Make a message box telling if the number is above or at most 10.
   (3) Write the number to cell B14.
   (4) What happens if you do type in a string in the input box?


### Exercise - Max and min number {#ex-vba-max-min}

The worksheet *TM2_Numbers* contains a button to a procedure that generate 40 random numbers.

<!-- Q1 -->

<div class="modal fade bs-example-modal-lg" id="Y9d8KKah0KxPjjI8SyMl" tabindex="-1" role="dialog" aria-labelledby="Y9d8KKah0KxPjjI8SyMl-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Y9d8KKah0KxPjjI8SyMl-title">Hint</h4></div><div class="modal-body">

```r
Sub TM2_FindMax()
    Dim intM As Integer
    Dim r As Integer
    
    Worksheets("TM2_Numbers").Activate
    intM = 0
    For r = 1 To 40
        If Cells(r, 1) ___ intM Then
            intM = ___
        End If
    Next
    Range("D1") = ___
End Sub
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Y9d8KKah0KxPjjI8SyMl">Hint</button>

   (1) Create a procedure that use loops and conditional statements to find the maximum number and write it to cell D1. Assign the procedure to button _Find max_.
   (2) Create a procedure that use loops and conditional statements to find the minimum number and write it to cell D2. Assign the procedure to button _Find min_.
   
   
<!-- Q3 -->

<div class="modal fade bs-example-modal-lg" id="x71ZyXwvYIUC9VHSVxUZ" tabindex="-1" role="dialog" aria-labelledby="x71ZyXwvYIUC9VHSVxUZ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="x71ZyXwvYIUC9VHSVxUZ-title">Hint</h4></div><div class="modal-body">

```r
Sub TM2_FindRange()
    Dim intM1 As Integer
    Dim intM2 As Integer
    Dim r As Integer
    
    Worksheets("TM2_Numbers").Activate
    intM1 = 1001
    intM2 = 0
    For r = 1 To 40
        ___
    Next
    Range("D3") = "[" & intM1 & "," & intM2 & "]"
End Sub
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#x71ZyXwvYIUC9VHSVxUZ">Hint</button>
   
   (3) Create a procedure that use loops and conditional statements to find the number range and write it to cell D3. Assign the procedure to button _Find range_. Given two numbers `m1` and `m2`, you can concatenate them to a string using `&` e.g. `"[" & m1 & "," & m2 & "]"`.
   (4) Create a procedure that use loops and conditional statements to count the number of positives and write it to cell D4. Assign the procedure to button _Count positives_.
   
It may often be nice to know the row number of the minimum and maximum values.

   (5) Create a procedure that finds the maximum row number and write it to cell D5. Assign the procedure to button _Find max row_.
   (6) Create a procedure that finds the minimum row number and write it to cell D6. Assign the procedure to button _Find min row_.
   
The procedure `TM2_RunAll` which is already linked to button _Run All_, runs all the procedures. Have a look at the code and try it out.




[BSS]: https://bss.au.dk/en/

[course-help]: https://github.com/bss-osca/tfa/issues
[cran]: https://cloud.r-project.org
[cheatsheet-readr]: https://rawgit.com/rstudio/cheatsheets/master/data-import.pdf
[course-welcome-to-the-tidyverse]: https://github.com/rstudio-education/welcome-to-the-tidyverse

[DataCamp]: https://www.datacamp.com/
[datacamp-signup]: https://www.datacamp.com/groups/shared_links/cbaee6c73e7d78549a9e32a900793b2d5491ace1824efc1760a6729735948215
[datacamp-r-intro]: https://learn.datacamp.com/courses/free-introduction-to-r
[datacamp-r-rmarkdown]: https://campus.datacamp.com/courses/reporting-with-rmarkdown
[datacamp-r-communicating]: https://learn.datacamp.com/courses/communicating-with-data-in-the-tidyverse
[datacamp-r-communicating-chap3]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/introduction-to-rmarkdown
[datacamp-r-communicating-chap4]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/customizing-your-rmarkdown-report
[datacamp-r-intermediate]: https://learn.datacamp.com/courses/intermediate-r
[datacamp-r-intermediate-chap1]: https://campus.datacamp.com/courses/intermediate-r/chapter-1-conditionals-and-control-flow
[datacamp-r-intermediate-chap2]: https://campus.datacamp.com/courses/intermediate-r/chapter-2-loops
[datacamp-r-intermediate-chap3]: https://campus.datacamp.com/courses/intermediate-r/chapter-3-functions
[datacamp-r-intermediate-chap4]: https://campus.datacamp.com/courses/intermediate-r/chapter-4-the-apply-family
[datacamp-r-functions]: https://learn.datacamp.com/courses/introduction-to-writing-functions-in-r
[datacamp-r-tidyverse]: https://learn.datacamp.com/courses/introduction-to-the-tidyverse
[datacamp-r-strings]: https://learn.datacamp.com/courses/string-manipulation-with-stringr-in-r
[datacamp-r-dplyr]: https://learn.datacamp.com/courses/data-manipulation-with-dplyr
[datacamp-r-dplyr-bakeoff]: https://learn.datacamp.com/courses/working-with-data-in-the-tidyverse
[datacamp-r-ggplot2-intro]: https://learn.datacamp.com/courses/introduction-to-data-visualization-with-ggplot2
[datacamp-r-ggplot2-intermediate]: https://learn.datacamp.com/courses/intermediate-data-visualization-with-ggplot2
[dplyr-cran]: https://CRAN.R-project.org/package=dplyr
[debug-in-r]: https://rstats.wtf/debugging-r-code.html

[excel-vs-r]: https://www.jessesadler.com/post/excel-vs-r/

[google-form]: https://forms.gle/s39GeDGV9AzAXUo18
[google-grupper]: https://docs.google.com/spreadsheets/d/1DHxthd5AQywAU4Crb3hM9rnog2GqGQYZ2o175SQgn_0/edit?usp=sharing
[GitHub]: https://github.com/
[git-install]: https://git-scm.com/downloads
[github-actions]: https://github.com/features/actions
[github-pages]: https://pages.github.com/

[happy-git]: https://happygitwithr.com
[hg-install-git]: https://happygitwithr.com/install-git.html
[hg-why]: https://happygitwithr.com/big-picture.html#big-picture
[hg-github-reg]: https://happygitwithr.com/github-acct.html#github-acct
[hg-git-install]: https://happygitwithr.com/install-git.html#install-git
[hg-exist-github-first]: https://happygitwithr.com/existing-github-first.html
[hg-exist-github-last]: https://happygitwithr.com/existing-github-last.html
[hg-credential-helper]: https://happygitwithr.com/credential-caching.html
[hypothes.is]: https://web.hypothes.is/

[osca-programme]: https://kandidat.au.dk/en/operationsandsupplychainanalytics/

[Peergrade]: https://peergrade.io
[peergrade-signup]: https://app.peergrade.io/join
[point-and-click]: https://en.wikipedia.org/wiki/Point_and_click
[pkg-bookdown]: https://bookdown.org/yihui/bookdown/
[pkg-openxlsx]: https://ycphs.github.io/openxlsx/index.html
[pkg-ropensci-writexl]: https://docs.ropensci.org/writexl/
[pkg-jsonlite]: https://cran.r-project.org/web/packages/jsonlite/index.html

[R]: https://www.r-project.org
[RStudio]: https://rstudio.com
[rstudio-cloud]: https://rstudio.cloud/spaces/176810/join?access_code=LSGnG2EXTuzSyeYaNXJE77vP33DZUoeMbC0xhfCz
[r-cloud-mod12]: https://rstudio.cloud/spaces/176810/project/2963819
[r-cloud-mod13]: https://rstudio.cloud/spaces/176810/project/3020139
[r-cloud-mod14]: https://rstudio.cloud/spaces/176810/project/3020322
[r-cloud-mod15]: https://rstudio.cloud/spaces/176810/project/3020509
[r-cloud-mod16]: https://rstudio.cloud/spaces/176810/project/3026754
[r-cloud-mod17]: https://rstudio.cloud/spaces/176810/project/3034015
[r-cloud-mod18]: https://rstudio.cloud/spaces/176810/project/3130795
[r-cloud-mod19]: https://rstudio.cloud/spaces/176810/project/3266132
[rstudio-download]: https://rstudio.com/products/rstudio/download/#download
[rstudio-customizing]: https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio
[rstudio-key-shortcuts]: https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts
[rstudio-workbench]: https://www.rstudio.com/wp-content/uploads/2014/04/rstudio-workbench.png
[r-markdown]: https://rmarkdown.rstudio.com/
[ropensci-writexl]: https://docs.ropensci.org/writexl/
[r4ds-pipes]: https://r4ds.had.co.nz/pipes.html
[r4ds-factors]: https://r4ds.had.co.nz/factors.html
[r4ds-strings]: https://r4ds.had.co.nz/strings.html
[r4ds-iteration]: https://r4ds.had.co.nz/iteration.html

[stat-545]: https://stat545.com
[stat-545-functions-part1]: https://stat545.com/functions-part1.html
[stat-545-functions-part2]: https://stat545.com/functions-part2.html
[stat-545-functions-part3]: https://stat545.com/functions-part3.html
[slides-welcome]: https://bss-osca.github.io/tfa/slides/00-tfa_welcome.html
[slides-m1-3]: https://bss-osca.github.io/tfa/slides/01-welcome_r_part.html
[slides-m4-5]: https://bss-osca.github.io/tfa/slides/02-programming.html
[slides-m6-8]: https://bss-osca.github.io/tfa/slides/03-transform.html
[slides-m9]: https://bss-osca.github.io/tfa/slides/04-plot.html
[slides-m83]: https://bss-osca.github.io/tfa/slides/05-joins.html

[tidyverse-main-page]: https://www.tidyverse.org
[tidyverse-packages]: https://www.tidyverse.org/packages/
[tidyverse-core]: https://www.tidyverse.org/packages/#core-tidyverse
[tidyverse-ggplot2]: https://ggplot2.tidyverse.org/
[tidyverse-dplyr]: https://dplyr.tidyverse.org/
[tidyverse-tidyr]: https://tidyr.tidyverse.org/
[tidyverse-readr]: https://readr.tidyverse.org/
[tidyverse-purrr]: https://purrr.tidyverse.org/
[tidyverse-tibble]: https://tibble.tidyverse.org/
[tidyverse-stringr]: https://stringr.tidyverse.org/
[tidyverse-forcats]: https://forcats.tidyverse.org/
[tidyverse-readxl]: https://readxl.tidyverse.org
[tidyverse-googlesheets4]: https://googlesheets4.tidyverse.org/index.html
[tutorial-markdown]: https://commonmark.org/help/tutorial/

[Udemy]: https://www.udemy.com/

[vba-yt-course1]: https://www.youtube.com/playlist?list=PLpOAvcoMay5S_hb2D7iKznLqJ8QG_pde0
[vba-course1-hello]: https://youtu.be/f42OniDWaIo

[vba-yt-course2]: https://www.youtube.com/playlist?list=PL3A6U40JUYCi4njVx59-vaUxYkG0yRO4m
[vba-course2-devel-tab]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-editor]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-project]: https://youtu.be/fp6PTbU7bXo
[vba-course2-devel-properties]: https://youtu.be/ks2QYKAd9Xw
[vba-course2-devel-hello]: https://youtu.be/EQ6tDWBc8G4

[video-install]: https://vimeo.com/415501284
[video-rstudio-intro]: https://vimeo.com/416391353
[video-packages]: https://vimeo.com/416743698
[video-projects]: https://vimeo.com/319318233
[video-r-intro-p1]: https://www.youtube.com/watch?v=vGY5i_J2c-c
[video-r-intro-p2]: https://www.youtube.com/watch?v=w8_XdYI3reU
[video-r-intro-p3]: https://www.youtube.com/watch?v=NuY6jY4qE7I
[video-subsetting]: https://www.youtube.com/watch?v=hWbgqzsQJF0&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10&t=0s
[video-datatypes]: https://www.youtube.com/watch?v=5AQM-yUX9zg&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10
[video-control-structures]: https://www.youtube.com/watch?v=s_h9ruNwI_0
[video-conditional-loops]: https://www.youtube.com/watch?v=2evtsnPaoDg
[video-functions]: https://www.youtube.com/watch?v=ffPeac3BigM
[video-tibble-vs-df]: https://www.youtube.com/watch?v=EBk6PnvE1R4
[video-dplyr]: https://www.youtube.com/watch?v=aywFompr1F4

[wiki-snake-case]: https://en.wikipedia.org/wiki/Snake_case
[wiki-camel-case]: https://en.wikipedia.org/wiki/Camel_case
[wiki-interpreted]: https://en.wikipedia.org/wiki/Interpreted_language
[wiki-literate-programming]: https://en.wikipedia.org/wiki/Literate_programming
[wiki-csv]: https://en.wikipedia.org/wiki/Comma-separated_values
[wiki-json]: https://en.wikipedia.org/wiki/JSON

<script src="//unpkg.com/@highlightjs/cdn-assets@11.5.1/highlight.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/highlightjs-vba/dist/vba.min.js"></script>
<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script> -->
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
  // hljs.initLineNumbersOnLoad({singleLine: true}); 
</script> 

<!--chapter:end:02_vba-intro.Rmd-->

---
output: html_document
editor_options: 
  chunk_output_type: console
---




# Loops and conditional statements {#mod-vba-loops-cond}

This module gives an introduction to loops and conditional statements. Loops are used to repeat code and conditional statements are used to redirect code execution based on the conditions. Both are basic building blocks in programming.


```{=html}
<div>
A template with VBA code for this module is given in the file
<a href="https://github.com/bss-osca/tfa/blob/master/vba/03-vba-loops-cond-template.xlsm" target="_blank">03-vba-loops-cond-template.xlsm</a>
(open it and use it while reading the notes). Have a look inside the module
<i>TM3_ex</i>
in the VBA editor for examples used in the notes and during lectures. Have a look at module
<i>TM3_exercises</i>
for exercises. The template file for next teaching module will contain guiding answers for the exercises to this teaching module.
</div>
```
 
#### Learning path diagram {-}

Click/hover the nodes to follow links and see details.


```{=html}
<div id="htmlwidget-eedff74aeb9992bfa498" style="width:100%;height:220px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-eedff74aeb9992bfa498">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"📖 Relational and\\nlogical operators\", URL = \"#vba-operators\", tooltip = \"\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"0,3!\"] \n  \"2\" [label = \"💡 Loops\", URL = \"#vba-loops\", tooltip = \"Loops\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"2,3!\"] \n  \"3\" [label = \"💡 Conditional\\nstatements\", URL = \"#vba-cond\", tooltip = \"Conditional\\nstatements\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"4.5,3!\"] \n  \"4\" [label = \"💡 Example\\nFind Jen\", URL = \"#vba-ex-jen\", tooltip = \"Example using loops and conditinal statements\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"7,3!\"] \n  \"5\" [label = \"💡 Example\\nA distance matrix\", URL = \"#vba-ex-dist-mat\", tooltip = \"Example using loops and conditinal statements\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"10,3!\"] \n  \"6\" [label = \"💻 Exercises\", URL = \"#ex-vba-loops-cond\", tooltip = \"Exercises\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"13,3!\"] \n  \"7\" [label = \"🎬 Relational Operators\", URL = \"https://youtu.be/d1nmq2Huz44\", tooltip = \"Relational Operators\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"PeachPuff3\", pos = \"0,2!\"] \n  \"8\" [label = \"🎬 Logical Operators\", URL = \"https://youtu.be/IYy9LKyAaCs\", tooltip = \"Logical Operators\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"PeachPuff3\", pos = \"0,1!\"] \n  \"9\" [label = \"🎬 Do While loop\", URL = \"https://youtu.be/QZd8SPovofU\", tooltip = \"Do While loop\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"PeachPuff3\", pos = \"2,1!\"] \n  \"10\" [label = \"🎬 For Next loop\", URL = \"https://youtu.be/hfdjZlknAI8\", tooltip = \"For Next loop\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"PeachPuff3\", pos = \"2,2!\"] \n  \"11\" [label = \"🎬 IF statements\", URL = \"https://youtu.be/bsQbgoSf7Ig\", tooltip = \"IF statements\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"PeachPuff3\", pos = \"4.5,2!\"] \n\"1\"->\"2\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"7\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"3\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"10\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"4\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"11\" [color = \"black\", arrowhead = \"vee\"] \n\"4\"->\"5\" [color = \"black\", arrowhead = \"vee\"] \n\"5\"->\"6\" [color = \"black\", arrowhead = \"vee\"] \n\"7\"->\"8\" [color = \"black\", arrowhead = \"vee\"] \n\"10\"->\"9\" [color = \"black\", arrowhead = \"vee\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
```

If you like a different learning style there is a lot for videos about VBA online such as course [14-Hour VBA Course][vba-yt-course2]. The videos have been pointed out as online supplements in the learning path diagram. However, they are not necessary for the course. Since Excel change as new versions arrive and it work on different operating systems, the look in the screenshots and videos might be a bit different from your version. However, you still should be able to understand it. 

## Learning outcomes {#lo-vba-loops-cond}

By the end of this module, you are expected to be able to:

* Describe what a conditional statement is.
* Test a condition built using relational/logical operators.
* Declare a conditional statement.
* Describe what a loop is.
* Declare a loop.
* Declare nested loops.
* Exit a loop.

The learning outcomes relate to the [overall learning goals](#lg-course) number 1, 2, 4, 8, 9-12 and 16 of the course.

<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->


## Relational and logical operators {#vba-operators}

Often you will need to compare a variable with another one. For this you need the *relational operators* given in Table \@ref(tab:comp-ope) (also called comparison operators).

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;border-bottom: 0;">
<caption>(\#tab:comp-ope)Comparison/relational operators.</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> Operator </th>
   <th style="text-align:left;"> Description </th>
   <th style="text-align:left;"> Example </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> = </td>
   <td style="text-align:left;"> Equal to. </td>
   <td style="text-align:left;"> A = B ' False </td>
  </tr>
  <tr>
   <td style="text-align:left;"> &lt;&gt; </td>
   <td style="text-align:left;"> Not equal to </td>
   <td style="text-align:left;"> A &lt;&gt; B ' True </td>
  </tr>
  <tr>
   <td style="text-align:left;"> &gt; </td>
   <td style="text-align:left;"> Greater than. </td>
   <td style="text-align:left;"> A &gt; B ' False </td>
  </tr>
  <tr>
   <td style="text-align:left;"> &lt; </td>
   <td style="text-align:left;"> Less than. </td>
   <td style="text-align:left;"> A &lt; B ' True </td>
  </tr>
  <tr>
   <td style="text-align:left;"> &gt;= </td>
   <td style="text-align:left;"> Greater than or equal to. </td>
   <td style="text-align:left;"> A &lt; B ' True </td>
  </tr>
  <tr>
   <td style="text-align:left;"> &lt;= </td>
   <td style="text-align:left;"> Less than or equal to. </td>
   <td style="text-align:left;"> A &lt;= B ' True </td>
  </tr>
</tbody>
<tfoot><tr><td style="padding: 0; " colspan="100%">
<sup></sup> Assume that A = 2 and B=4.</td></tr></tfoot>
</table>

Let us consider an example (try to guess the output before running the procedure):

```
'' Comparison of two variables
Sub TM3_Comparison()
   Dim intA As Integer
   Dim intB As Integer

   intA = 10
   intB = 20
   
   If intA = intB Then
      MsgBox ("A = B is True")
   Else
      MsgBox ("A = B is False")
   End If
   
   If intA <> intB Then
      MsgBox ("A not equal B is True")
   Else
      MsgBox ("A not equal B is False")
   End If

   If intA > intB Then
      MsgBox ("A greter then B is True")
   Else
      MsgBox ("A greter then B is False")
   End If

   If intA <= intB Then
      MsgBox ("A less than or equal to B is True")
   Else
      MsgBox ("A less than or equal to B is False")
   End If
End Sub
```

Given two boolean expressions we use *logical operators* to compare them (see Table \@ref(tab:logi-ope)) 

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;border-bottom: 0;">
<caption>(\#tab:logi-ope)Logical operators.</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> Operator </th>
   <th style="text-align:left;"> Description </th>
   <th style="text-align:left;"> Example </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> AND </td>
   <td style="text-align:left;"> If both the conditions are True, then the expression is true. </td>
   <td style="text-align:left;"> A&lt;&gt;0 AND B&lt;&gt;0 ' False </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OR </td>
   <td style="text-align:left;"> If any of the two conditions are True, then the expression is true. </td>
   <td style="text-align:left;"> A&lt;&gt;0 OR B&lt;&gt;0 ' True </td>
  </tr>
  <tr>
   <td style="text-align:left;"> NOT </td>
   <td style="text-align:left;"> Reverse logical: if the expression is true, then the NOT operator returns false. </td>
   <td style="text-align:left;"> NOT(A&lt;&gt;0 OR B&lt;&gt;0) ' False </td>
  </tr>
  <tr>
   <td style="text-align:left;"> XOR </td>
   <td style="text-align:left;"> Logical Exclusion. If exactly one condition is True, the result is True. </td>
   <td style="text-align:left;"> A&lt;&gt;0 XOR B&lt;&gt;0 ' True </td>
  </tr>
</tbody>
<tfoot><tr><td style="padding: 0; " colspan="100%">
<sup></sup> Assume that A = 0 and B=4.</td></tr></tfoot>
</table>

Let us consider an example (try to guess the output before running the procedure):

```
Sub TM3_Logical()
    If 5 > 4 And 6 > 2 Then
        MsgBox ("5 > 4 And 6 > 2 is True")
    Else
        MsgBox ("5 > 4 And 6 > 2 is False")
    End If
    
    If 1 > 4 Or 1 > 2 Then
        MsgBox ("1 > 4 Or 1 > 2 is True")
    Else
        MsgBox ("1 > 4 Or 1 > 2 is False")
    End If
    
    If 6 > 4 Or 1 > 2 Then
        MsgBox ("6 > 4 Or 1 > 2 is True")
    Else
        MsgBox ("6 > 4 Or 1 > 2 is False")
    End If
    
    If 5 > 4 And Not 6 > 2 Then
        MsgBox ("5 > 4 And Not 6 > 2 is True")
    Else
        MsgBox ("5 > 4 And Not 6 > 2 is False")
    End If
    
    ' If more than two boolean expressions remember parenthesis
    If (5 > 4 Xor 6 > 2) And 7 > 10 Then   ' Xor (exactly one is true)
        MsgBox ("(5 > 4 Xor 6 > 2) And 7 > 10 is True")
    Else
        MsgBox ("(5 > 4 Xor 6 > 2) And 7 > 10 is False")
    End If
    
    If 5 > 4 Xor (6 > 2 And 7 > 10) Then
        MsgBox ("5 > 4 Xor (6 > 2 And 7 > 10) is True")
    Else
        MsgBox ("5 > 4 Xor (6 > 2 And 7 > 10) is False")
    End If
End Sub
```

Note parentheses have an impact on the result. Remember to use them correctly. 



## Loops {#vba-loops}

Loops are used to repeat pieces of code. There are many types of loops statements but here we will consider `For` and `While` loops. The structure of a `For` loop is:

```
For i = 1 To 10 
    <code>
Next
```

Here `i` is a counter used to repeat the code inside the loop 10 times. In general we do not use a suffix for counter variables (`i` should have been named `intI` according to our naming convention). An example on a simple for loop is:

```
Sub TM3_Loop1()
    Dim i As Integer
    
    For i = 1 To 3
        MsgBox (i) ' What will the output be?
    Next
End Sub
```

You can use the `Step` keyword to increment the counter by more than one:

```
Sub TM3_Loop2()
    Dim i As Integer
    
    For i = 2 To 9 Step 2
        If i <> 4 Then
            MsgBox (i) ' What will the output be?
        End If
    Next
End Sub
```

You can use `Exit For` to end a for loop prematurely (jump to the code after the loop):

```
'' Write the row number in column A and exit after row 10 even though the loop runs to 20
Sub TM3_WriteNumbers1()
   Dim r As Integer
   
   Worksheets("TM3").Activate  ' activate the sheet we want to use
   For r = 6 To 20
      If r > 10 Then
         Exit For
      End If
      Cells(r, 1) = r  ' write to row r, col 1 (A)
   Next
End Sub
```

Loops may be nested inside each other. For instance if some action needs to be performed for each day and each employee or for each project and each work package of that project.

```
Sub TM3_NestedLoops()
    Dim i As Integer
    Dim j As Integer
    
    For i = 1 To 2
        For j = 1 To 3
            MsgBox ("(" & i & "," & j & ")")
        Next
    Next
End Sub
```

The structure of a `While` loop is:
      
```
Do While <condition true>  
    <code>
Loop
```

Here the loops runs until the condition is not true. While loops are useful when you do not know how many times to do the loop in advance. An example on a simple while loop is:

```
'' Write the row number in column B and exit after row 10
Sub TM3_WriteNumbers2()
    Dim r As Integer
    
    Worksheets("TM3").Activate
    r = 6
    Do While r < 11
        Cells(r, 2) = r ' write to row r, col 2 (B)
        r = r + 1
    Loop
End Sub
```

You can use `Exit Do` to end a while loop prematurely (jump to the code after the loop):

```
'' Write 2, 4, ... in column C and exit after 21 or if equals 12
Sub TM3_WriteNumbers3()
    Dim i As Integer, r As Integer
    
    Worksheets("TM3").Activate
    r = 6
    i = 2
    Do While i < 21
        Cells(r, 3) = i ' write to row r, col 3 (C)
        If i = 12 Then
            Exit Do
        End If
        r = r + 1
        i = i + 2
    Loop
End Sub
```

Beware of endless loops. If the stopping criteria is NOT reached when using a while loop, the computer will keep going:

```
' An endless loop. Do not run if you don't know how to stop
Sub TM3_EndlessLoop()
    Dim i As Integer
    While i >= 0
        i = i + 1
    Wend
End Sub
```

An endless loop can be hard to stop depending on the operating system you use. Therefore always “save” before you “run” the code. Make sure the stopping criterion will be reached. You may try to stop the program using a shortcut (<svg viewBox="0 0 448 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"></path></svg> try Ctrl + Break or Ctrl + Alt + Delete. <svg viewBox="0 0 384 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 49.9-11.4 69.5-34.3z"></path></svg> try ⌘., ⌃ +  Esc or  ⌘⌥ + Esc.)

Finally, the `For Each` loop has to be mentioned:

```
Sub TM3_ForEach()
   Dim rngC As Range
   Dim i As Integer
   
   Worksheets("TM3").Activate
   i = 1
   For Each rngC In Range("D6:E9")
      rngC = i
      i = i + 1
   Next
End Sub
```

The loop is used for running trough a set of objects (we will have a closer look at objects in Section \@ref(vba-objects)). Here `rngC` is used to run through all the cells in the range and set values. Note a range is scanned left-down.


## Conditional statements {#vba-cond}

Conditional statements are used to redirect code execution based on the conditions. If the condition is met then the code is executed. The general layout of an if-then-else conditional statement is:

```
If <condition> Then
 <code>
ElseIf <condition> Then
 <code>
ElseIf <condition> Then
 <code>
Else
 <code>
End If

If <condition> Then <code> Else <code>  ' single line form
```

You can drop the `ElseIf` and `Else` code chunks. Other conditional statements exists but in general you can formulate them using an if-then-else statement. Let us try to use a conditional statement to separate persons in two groups:

```
'' Seperate persons into two groups (names are written in 2 columns)
Sub TM3_SeparatePersons1()
    Dim r As Integer
    
    Worksheets("TM3_Separate1").Activate ' activate the correct sheet
    For r = 2 To 12 ' scan rows 2-12
        If Cells(r, 2) = "Professor" Then
            Cells(r, 3) = Cells(r, 1)  ' output in row C
        Else
            Cells(r, 4) = Cells(r, 1)  ' output in row D
        End If
    Next
End Sub
```

We use variable `r` to store the row number we want to write to and then an if statement to separate professors from others. The output will be:

<div class="figure" style="text-align: center">
<img src="./img/sep-persons-1.png" alt="Separate into two groups." width="400px" />
<p class="caption">(\#fig:sep-2)Separate into two groups.</p>
</div>

If you want to separate both professors and associate professors from others, you may modify the if statement and use an `ElseIf`:

```
'' Seperate persons into 3 groups (names are written in 3 columns)
Sub TM3_SeparatePersons2()
    Dim r As Integer
    
    Worksheets("TM3_Separate2").Activate ' activate the correct sheet
    For r = 2 To 12
        If Cells(r, 2) = "Professor" Then
            Cells(r, 3) = Cells(r, 1)
        ElseIf Cells(r, 2) = "Associate Professor" Then
            Cells(r, 4) = Cells(r, 1)
        Else
            Cells(r, 5) = Cells(r, 1)
        End If
    Next
End Sub
```

Finally, let us try to separate into five groups: 

```
'' Seperate persons into 5 groups (names are written in 5 columns)
Sub TM3_SeparatePersons3()
    Dim r As Integer
    
    Worksheets("TM3_Separate3").Activate ' activate the correct sheet
    For r = 2 To 12
        If Cells(r, 2) = "Professor" Then
            Cells(r, 3) = Cells(r, 1)
        ElseIf Sheet1.Cells(r, 2) = "Associate Professor" Then
            Cells(r, 4) = Cells(r, 1)
        ElseIf Sheet1.Cells(r, 2) = "Post Doc" Then
            Cells(r, 5) = Cells(r, 1)
        ElseIf Sheet1.Cells(r, 2) = "PhD student" Then
            Cells(r, 6) = Cells(r, 1)
        Else
            Cells(r, 7) = Cells(r, 1)
        End If
    Next
End Sub
```

Here the output will be:

<div class="figure" style="text-align: center">
<img src="./img/sep-persons-3.png" alt="Separate into five groups." width="600px" />
<p class="caption">(\#fig:sep-5)Separate into five groups.</p>
</div>


## Example - Find Jen {#vba-ex-jen}

Consider column A in Figure \@ref(fig:sep-5). Assume we want to check if Jen is in a name and output her position. We can use a for loop for this:

```
'' Find cell with Jen using a For loop
Sub TM3_FindJen1()
    Dim r As Integer
    
    Worksheets("TM3_Separate1").Activate ' activate the correct sheet
    For r = 2 To 12
        If InStr(Cells(r, 1), "Jen ") > 0 Then  ' InStr returns first char position at which match is found (0 if no match)
            MsgBox "Jen is a " & Cells(r, 2) & " (Row " & r & ")"
            Exit For   ' exit the loop
        End If
    Next
End Sub
```

We scan all rows for Jen and return her position. If we found her, then we exit the for loop (no need to search further). What happens if we search for `"Jen"` and not `"Jen "`? 

<div class="figure" style="text-align: center">
<img src="./img/tm3-jen.png" alt="Search for Jen." width="300px" />
<p class="caption">(\#fig:jen1)Search for Jen.</p>
</div>
 
The same can be done using a while loop:

```
'' Find cell with Jen using a While loop
Sub TM3_FindJen2()
    Dim r As Integer
    
    r = 2
    Do While InStr(Cells(r, 1), "Jen ") = 0
        r = r + 1
    Loop
    MsgBox "Jen is a " & Cells(r, 2) & " (Row " & r & ")"
End Sub
```

Beware of endless looping here. What happens if Jen is not present in column A? A more error safe while loop is:

```
'' Find cell with Jen using a While loop and better stopping criteria
Sub TM3_FindJen3()
    Dim r As Integer
    
    r = 2
    Do While InStr(Cells(r, 1), "Jen ") = 0 And r < 13
        r = r + 1
    Loop
    If (r = 13) Then
        MsgBox ("Jen not found")
    Else
        MsgBox "Jen is a " & Cells(r, 2) & " (Cell A" & r & ")"
    End If
End Sub
```


## Example - A distance matrix {#vba-ex-dist-mat}

Assume that you have a set of $n=10$ locations: 

<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>(\#tab:unnamed-chunk-20)A set of locations</caption>
 <thead>
  <tr>
   <th style="text-align:center;"> Location number </th>
   <th style="text-align:center;"> $x$-coordinate </th>
   <th style="text-align:center;"> $y$-coordinate </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> 6 </td>
   <td style="text-align:center;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 2 </td>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> 5 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 3 </td>
   <td style="text-align:center;"> 6 </td>
   <td style="text-align:center;"> 3 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 4 </td>
   <td style="text-align:center;"> 7 </td>
   <td style="text-align:center;"> 4 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 5 </td>
   <td style="text-align:center;"> 4 </td>
   <td style="text-align:center;"> 6 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 6 </td>
   <td style="text-align:center;"> 4 </td>
   <td style="text-align:center;"> 7 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 7 </td>
   <td style="text-align:center;"> 5 </td>
   <td style="text-align:center;"> 2 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 8 </td>
   <td style="text-align:center;"> 1 </td>
   <td style="text-align:center;"> 4 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 9 </td>
   <td style="text-align:center;"> 4 </td>
   <td style="text-align:center;"> 2 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> 10 </td>
   <td style="text-align:center;"> 6 </td>
   <td style="text-align:center;"> 5 </td>
  </tr>
</tbody>
</table>

The euclidean distance $d$ between location $l_1 = (x_1, y_1)$ and $l_2 = (x_2, y_2)$ are: $$d(1,2)=\sqrt{(x_1-x_2)^2 + (y_1-y_2)^2}.$$ In VBA the function becomes:

```
'' Calculate distance between two points
'
' @param x1 x-coordinate of first point.
' @param y1 y-coordinate of first point.
' @param x2 x-coordinate of second point.
' @param y2 y-coordinate of second point.
Private Function TM3_Distance(x1, y1, x2, y2)
    Dim x As Double
    Dim y As Double
    
    x = x1 - x2
    y = y1 - y2
    TM3_Distance = Sqr((x * x) + (y * y))
End Function
```

Assume that you want to calculate the *distance matrix* $D$ where entry $(i,j)$ contains the distance between location $i$ and location $j$.

Consider the locations in columns B and C:

<div class="figure" style="text-align: center">
<img src="./img/dist-mat.png" alt="Distance matrix worksheet." width="100%" />
<p class="caption">(\#fig:dist-mat)Distance matrix worksheet.</p>
</div>

We want to fill out the cells F1:P11 with the distances. This have been done using procedure:

```
'' Create a distance matrix starting in column 6
'
' @pre Assume that coordinates are stored in column B and C starting from row 2
'      and that number of points are stored in E1.
Public Sub TM3_MakeDistanceMatrix()
    Dim n As Integer
    Dim i As Integer
    Dim j As Integer
      
    n = Range("E1")
    For i = 1 To n  ' add row and column headers
        Cells(i + 1, 6) = Cells(1 + i, 1) ' row equals i+1
        Cells(1, 6 + i) = Cells(1 + i, 1) ' column equals i+6
    Next
    
    ' add distances
    For i = 1 To n
        For j = 1 To n
           Cells(i + 1, j + 6) = TM3_Distance(Cells(i + 1, 2), Cells(i + 1, 3), Cells(j + 1, 2), Cells(j + 1, 3))
        Next
    Next
End Sub
```

First, row and column headers are written to the cells. Next, we use a nested for loop to calculate the distances and output them to the cells. Note we in fact calculate the same distance two times (the distance from $i$ to $j$ equals the distance from $j$ to $i$). Since we have symmetric distances there is no need to do this and it can be avoided by letting the inner loop in the nested loops be dependent on the outer loop: 

```
'' Create a symetric distance matrix with only the upper right part filled starting in column 6.
'
' @pre Assume that coordinates are stored in column B and C starting from row 2
'      and that number of points are stored in E1.
Public Sub TM3_MakeSymetricDistanceMatrix()
    Dim n As Integer
    Dim i As Integer
    Dim j As Integer
      
    n = Range("E1")
    For i = 1 To n
        Cells(i + 1, 6) = Cells(1 + i, 1)
        Cells(1, 6 + i) = Cells(1 + i, 1)
    Next
    
    For i = 1 To n
        For j = i + 1 To n
           Cells(i + 1, j + 6) = TM3_Distance(Cells(i + 1, 2), Cells(i + 1, 3), Cells(j + 1, 2), Cells(j + 1, 3))
        Next
    Next
End Sub
```

<div class="figure" style="text-align: center">
<img src="./img/dist-mat-sym.png" alt="Distance matrix worksheet with symmetric distances." width="100%" />
<p class="caption">(\#fig:dist-mat-sym)Distance matrix worksheet with symmetric distances.</p>
</div>


## Recap

- Loops are used to repeat pieces of code.
- For loops (repeat a number of times):
  ```
  For i = 1 To 10 
      <code>
  Next
  ```
      
- While loops (repeat until a condition is met):

   ```
   Do While <condition> ' repeat while true     
       <code>
   Loop
   ```
      
- Use `Exit for` and `Exit Do` to break a `For` and a `Do While` loop before it ends (jump to the code after the loop). 
- Loops may be nested inside each other:

   ```
   For i = 1 To 2     
     For j = 1 To 3  
         MsgBox ("(" & i & "," & j & ")")
     Next
   Next
   ```
   
- Conditional Statements are used to make decisions based on the conditions. If the condition is met then the code is executed. 
- An if-then-else statement: 

   ```
   If <condition> Then
    <code>
   ElseIf <condition> Then
    <code>
   Else
    <code>
   End If
   ```
   
   You may drop the `ElseIf` and `Else` code chunks. 


```{=html}
<div>
You may also have a look at the
<a href="https://bss-osca.github.io/tfa/slides/03_vba-loops-cond-slides.html" target="_blank">slides for this module</a>
.
</div>
```

## Exercises {#ex-vba-loops-cond}

Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the [help page](#help). Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution!


```{=html}
<div>
A template with VBA code for this module is given in the file
<a href="https://github.com/bss-osca/tfa/blob/master/vba/03-vba-loops-cond-template.xlsm" target="_blank">03-vba-loops-cond-template.xlsm</a>
(open it and use it while reading the notes). Have a look inside the module
<i>TM3_ex</i>
in the VBA editor for examples used in the notes and during lectures. Have a look at module
<i>TM3_exercises</i>
for exercises. The template file for next teaching module will contain guiding answers for the exercises to this teaching module.
</div>
```

### Exercise - Loops {#ex-vba-loops}

Use the sheet _TM3_ for output.

   (1) Create a for loop that writes numbers 1 to 4 in rows 25 to 28 in column A.  
   (2) Create a do while loop that writes numbers 1 to 4 in rows 25 to 28 in column B. 
   (3) Create a loop that writes numbers 1 to 4 in rows 27 to 30 in column C.
   (4) Create a loop that writes numbers -1 to -4 in rows 25 to 28 in column D.
   (5) Create a loop that writes numbers 1 to 4 in rows 28 to 31 in column E, except if the number is 3 then the output should to a string `missing`.
   (6) Create a do while loop that writes numbers i = 1, 2, ... in column G (starting in row 25) until i/5 + 3 = 8. Hint: you may use a `Exit Do` to quit the loop. 
   (7) Create a sub that runs all the loops.

### Exercise - Conditional statements {#ex-vba-cond}

Consider worksheet *TM3_Numbers*, which contains a set of numbers. 

   (1) Create a procedure with the following features
       * Make a copy of the numbers with the upper left cell starting G1.
       * Scan all the numbers and remove (clear the cell) all the negative numbers (you may use a `For Each` loop).
       * Highlight all the numbers above 20 (using e.g. `rngC.Interior.ColorIndex = 37`).
       * Add a button to worksheet *TM3_Numbers* that run the procedure. 

   (2) Create a procedure with the following features:
       * Scan the numbers and find
         - the sum of all non-negative numbers,
         - the mean of all negative numbers.
       * Use a message box to display the sum and mean calculated.
       * Add a button to worksheet *TM3_Numbers* that run the procedure. 

*This exercise is a slightly modified version an exam assignment (reexam 2022-A5).*


[BSS]: https://bss.au.dk/en/

[course-help]: https://github.com/bss-osca/tfa/issues
[cran]: https://cloud.r-project.org
[cheatsheet-readr]: https://rawgit.com/rstudio/cheatsheets/master/data-import.pdf
[course-welcome-to-the-tidyverse]: https://github.com/rstudio-education/welcome-to-the-tidyverse

[DataCamp]: https://www.datacamp.com/
[datacamp-signup]: https://www.datacamp.com/groups/shared_links/cbaee6c73e7d78549a9e32a900793b2d5491ace1824efc1760a6729735948215
[datacamp-r-intro]: https://learn.datacamp.com/courses/free-introduction-to-r
[datacamp-r-rmarkdown]: https://campus.datacamp.com/courses/reporting-with-rmarkdown
[datacamp-r-communicating]: https://learn.datacamp.com/courses/communicating-with-data-in-the-tidyverse
[datacamp-r-communicating-chap3]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/introduction-to-rmarkdown
[datacamp-r-communicating-chap4]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/customizing-your-rmarkdown-report
[datacamp-r-intermediate]: https://learn.datacamp.com/courses/intermediate-r
[datacamp-r-intermediate-chap1]: https://campus.datacamp.com/courses/intermediate-r/chapter-1-conditionals-and-control-flow
[datacamp-r-intermediate-chap2]: https://campus.datacamp.com/courses/intermediate-r/chapter-2-loops
[datacamp-r-intermediate-chap3]: https://campus.datacamp.com/courses/intermediate-r/chapter-3-functions
[datacamp-r-intermediate-chap4]: https://campus.datacamp.com/courses/intermediate-r/chapter-4-the-apply-family
[datacamp-r-functions]: https://learn.datacamp.com/courses/introduction-to-writing-functions-in-r
[datacamp-r-tidyverse]: https://learn.datacamp.com/courses/introduction-to-the-tidyverse
[datacamp-r-strings]: https://learn.datacamp.com/courses/string-manipulation-with-stringr-in-r
[datacamp-r-dplyr]: https://learn.datacamp.com/courses/data-manipulation-with-dplyr
[datacamp-r-dplyr-bakeoff]: https://learn.datacamp.com/courses/working-with-data-in-the-tidyverse
[datacamp-r-ggplot2-intro]: https://learn.datacamp.com/courses/introduction-to-data-visualization-with-ggplot2
[datacamp-r-ggplot2-intermediate]: https://learn.datacamp.com/courses/intermediate-data-visualization-with-ggplot2
[dplyr-cran]: https://CRAN.R-project.org/package=dplyr
[debug-in-r]: https://rstats.wtf/debugging-r-code.html

[excel-vs-r]: https://www.jessesadler.com/post/excel-vs-r/

[google-form]: https://forms.gle/s39GeDGV9AzAXUo18
[google-grupper]: https://docs.google.com/spreadsheets/d/1DHxthd5AQywAU4Crb3hM9rnog2GqGQYZ2o175SQgn_0/edit?usp=sharing
[GitHub]: https://github.com/
[git-install]: https://git-scm.com/downloads
[github-actions]: https://github.com/features/actions
[github-pages]: https://pages.github.com/

[happy-git]: https://happygitwithr.com
[hg-install-git]: https://happygitwithr.com/install-git.html
[hg-why]: https://happygitwithr.com/big-picture.html#big-picture
[hg-github-reg]: https://happygitwithr.com/github-acct.html#github-acct
[hg-git-install]: https://happygitwithr.com/install-git.html#install-git
[hg-exist-github-first]: https://happygitwithr.com/existing-github-first.html
[hg-exist-github-last]: https://happygitwithr.com/existing-github-last.html
[hg-credential-helper]: https://happygitwithr.com/credential-caching.html
[hypothes.is]: https://web.hypothes.is/

[osca-programme]: https://kandidat.au.dk/en/operationsandsupplychainanalytics/

[Peergrade]: https://peergrade.io
[peergrade-signup]: https://app.peergrade.io/join
[point-and-click]: https://en.wikipedia.org/wiki/Point_and_click
[pkg-bookdown]: https://bookdown.org/yihui/bookdown/
[pkg-openxlsx]: https://ycphs.github.io/openxlsx/index.html
[pkg-ropensci-writexl]: https://docs.ropensci.org/writexl/
[pkg-jsonlite]: https://cran.r-project.org/web/packages/jsonlite/index.html

[R]: https://www.r-project.org
[RStudio]: https://rstudio.com
[rstudio-cloud]: https://rstudio.cloud/spaces/176810/join?access_code=LSGnG2EXTuzSyeYaNXJE77vP33DZUoeMbC0xhfCz
[r-cloud-mod12]: https://rstudio.cloud/spaces/176810/project/2963819
[r-cloud-mod13]: https://rstudio.cloud/spaces/176810/project/3020139
[r-cloud-mod14]: https://rstudio.cloud/spaces/176810/project/3020322
[r-cloud-mod15]: https://rstudio.cloud/spaces/176810/project/3020509
[r-cloud-mod16]: https://rstudio.cloud/spaces/176810/project/3026754
[r-cloud-mod17]: https://rstudio.cloud/spaces/176810/project/3034015
[r-cloud-mod18]: https://rstudio.cloud/spaces/176810/project/3130795
[r-cloud-mod19]: https://rstudio.cloud/spaces/176810/project/3266132
[rstudio-download]: https://rstudio.com/products/rstudio/download/#download
[rstudio-customizing]: https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio
[rstudio-key-shortcuts]: https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts
[rstudio-workbench]: https://www.rstudio.com/wp-content/uploads/2014/04/rstudio-workbench.png
[r-markdown]: https://rmarkdown.rstudio.com/
[ropensci-writexl]: https://docs.ropensci.org/writexl/
[r4ds-pipes]: https://r4ds.had.co.nz/pipes.html
[r4ds-factors]: https://r4ds.had.co.nz/factors.html
[r4ds-strings]: https://r4ds.had.co.nz/strings.html
[r4ds-iteration]: https://r4ds.had.co.nz/iteration.html

[stat-545]: https://stat545.com
[stat-545-functions-part1]: https://stat545.com/functions-part1.html
[stat-545-functions-part2]: https://stat545.com/functions-part2.html
[stat-545-functions-part3]: https://stat545.com/functions-part3.html
[slides-welcome]: https://bss-osca.github.io/tfa/slides/00-tfa_welcome.html
[slides-m1-3]: https://bss-osca.github.io/tfa/slides/01-welcome_r_part.html
[slides-m4-5]: https://bss-osca.github.io/tfa/slides/02-programming.html
[slides-m6-8]: https://bss-osca.github.io/tfa/slides/03-transform.html
[slides-m9]: https://bss-osca.github.io/tfa/slides/04-plot.html
[slides-m83]: https://bss-osca.github.io/tfa/slides/05-joins.html

[tidyverse-main-page]: https://www.tidyverse.org
[tidyverse-packages]: https://www.tidyverse.org/packages/
[tidyverse-core]: https://www.tidyverse.org/packages/#core-tidyverse
[tidyverse-ggplot2]: https://ggplot2.tidyverse.org/
[tidyverse-dplyr]: https://dplyr.tidyverse.org/
[tidyverse-tidyr]: https://tidyr.tidyverse.org/
[tidyverse-readr]: https://readr.tidyverse.org/
[tidyverse-purrr]: https://purrr.tidyverse.org/
[tidyverse-tibble]: https://tibble.tidyverse.org/
[tidyverse-stringr]: https://stringr.tidyverse.org/
[tidyverse-forcats]: https://forcats.tidyverse.org/
[tidyverse-readxl]: https://readxl.tidyverse.org
[tidyverse-googlesheets4]: https://googlesheets4.tidyverse.org/index.html
[tutorial-markdown]: https://commonmark.org/help/tutorial/

[Udemy]: https://www.udemy.com/

[vba-yt-course1]: https://www.youtube.com/playlist?list=PLpOAvcoMay5S_hb2D7iKznLqJ8QG_pde0
[vba-course1-hello]: https://youtu.be/f42OniDWaIo

[vba-yt-course2]: https://www.youtube.com/playlist?list=PL3A6U40JUYCi4njVx59-vaUxYkG0yRO4m
[vba-course2-devel-tab]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-editor]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-project]: https://youtu.be/fp6PTbU7bXo
[vba-course2-devel-properties]: https://youtu.be/ks2QYKAd9Xw
[vba-course2-devel-hello]: https://youtu.be/EQ6tDWBc8G4

[video-install]: https://vimeo.com/415501284
[video-rstudio-intro]: https://vimeo.com/416391353
[video-packages]: https://vimeo.com/416743698
[video-projects]: https://vimeo.com/319318233
[video-r-intro-p1]: https://www.youtube.com/watch?v=vGY5i_J2c-c
[video-r-intro-p2]: https://www.youtube.com/watch?v=w8_XdYI3reU
[video-r-intro-p3]: https://www.youtube.com/watch?v=NuY6jY4qE7I
[video-subsetting]: https://www.youtube.com/watch?v=hWbgqzsQJF0&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10&t=0s
[video-datatypes]: https://www.youtube.com/watch?v=5AQM-yUX9zg&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10
[video-control-structures]: https://www.youtube.com/watch?v=s_h9ruNwI_0
[video-conditional-loops]: https://www.youtube.com/watch?v=2evtsnPaoDg
[video-functions]: https://www.youtube.com/watch?v=ffPeac3BigM
[video-tibble-vs-df]: https://www.youtube.com/watch?v=EBk6PnvE1R4
[video-dplyr]: https://www.youtube.com/watch?v=aywFompr1F4

[wiki-snake-case]: https://en.wikipedia.org/wiki/Snake_case
[wiki-camel-case]: https://en.wikipedia.org/wiki/Camel_case
[wiki-interpreted]: https://en.wikipedia.org/wiki/Interpreted_language
[wiki-literate-programming]: https://en.wikipedia.org/wiki/Literate_programming
[wiki-csv]: https://en.wikipedia.org/wiki/Comma-separated_values
[wiki-json]: https://en.wikipedia.org/wiki/JSON


<script src="//unpkg.com/@highlightjs/cdn-assets@11.5.1/highlight.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/highlightjs-vba/dist/vba.min.js"></script>
<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script> -->
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
  // hljs.initLineNumbersOnLoad({singleLine: true}); 
</script>

<!--chapter:end:03_vba-loops-cond.Rmd-->

---
output: html_document
editor_options: 
  chunk_output_type: console
---





# Procedures {#mod-vba-procedures}

This module gives a short introduction to procedures. A procedure is a piece of code stored in a module which contains a series of computational steps that will be carried out when the procedure is called. VBA has two kinds of procedures subs (short for subroutine) and functions. Both are basic building blocks in programming. The main differences between a sub and a function is:

**Subs**

  - Can make changes to the worksheet.
  - Can modify its surroundings.
  - Can be executed by a button (a macro - if no arguments).
  - Cannot return anything.

**Functions**

  - Can return something.
  - Can be used in Excel.
  - Cannot be used as a macro.


```{=html}
<div>
A template with VBA code for this module is given in the file
<a href="https://github.com/bss-osca/tfa/blob/master/vba/04-vba-procedures-template.xlsm" target="_blank">04-vba-procedures-template.xlsm</a>
(open it and use it while reading the notes). Have a look inside the module
<i>TM4_ex</i>
in the VBA editor for examples used in the notes and during lectures. Have a look at module
<i>TM4_exercises</i>
for exercises. The template file for next teaching module will contain guiding answers for the exercises to this teaching module.
</div>
```

During execution of procedures it may be useful to use the debugger to run the code step by step. A very short introduction to debugging in VBA is given in Section \@ref(vba-debug). Read it before continuing this teaching module.

#### Learning path diagram {-}

Click/hover the nodes to follow links and see details.


```{=html}
<div id="htmlwidget-ac6cd67e192c42577391" style="width:100%;height:100px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-ac6cd67e192c42577391">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"💡 Subs and functions\\nThe basics\", URL = \"#vba-subs-functions\", tooltip = \"Subs and functions\\nThe basics (interactive)\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"2,0!\"] \n  \"2\" [label = \"💡 Optional\\narguments\", URL = \"#vba-optional-arg\", tooltip = \"Optional\\narguments (interactive)\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"4.7,0!\"] \n  \"3\" [label = \"📖 Public and private\\nprocedures\", URL = \"#vba-pub-priv\", tooltip = \"Public and private\\nprocedures (reading)\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"7,0!\"] \n  \"4\" [label = \"💡 Passing arguments\\nby reference\\nor by value\", URL = \"#vba-byref\", tooltip = \"Passing arguments\\nby reference\\nor by value (interactive)\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"10,0!\"] \n  \"5\" [label = \"💡 Built-in\\nfunctions\", URL = \"#vba-built-in\", tooltip = \"Built-in\\nfunctions (interactive)\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"12.7,0!\"] \n  \"6\" [label = \"💡 Example\\nSelection\\nof test persons\", URL = \"#vba-test-persons\", tooltip = \"Example\\nSelection\\nof test persons (interactive)\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"15,0!\"] \n  \"7\" [label = \"💻 Exercises\", URL = \"#ex-vba-procedures\", tooltip = \"Exercises (interactive)\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"17.5,0!\"] \n\"1\"->\"2\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"3\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"4\" [color = \"black\", arrowhead = \"vee\"] \n\"4\"->\"5\" [color = \"black\", arrowhead = \"vee\"] \n\"5\"->\"6\" [color = \"black\", arrowhead = \"vee\"] \n\"6\"->\"7\" [color = \"black\", arrowhead = \"vee\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
```


## Learning outcomes {#lo-vba-procedures}

By the end of this module, you are expected to be able to:

* Describe what a procedure is.
* Explain what kind of procedures there are in VBA and what they can be used for.
* Declare and call a procedure.
* Explain what the difference is by using input arguments _by reference_ or _by value_ in a procedure. 
* Set the scope of a procedure using private or public procedures.
* Set default input arguments.
* Call built-in functions for VBA and Excel.

The learning outcomes relate to the [overall learning goals](#lg-course) number 1, 2, 4, 8 and 9 of the course.

<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->


## Subs and functions - The basics {#vba-subs-functions}

A sub is declared using:

```
Sub SubName(arg1 As <datatype>, arg2 As <datatype>)
   <code>
End Sub
```

The name of the sub is `SubName` and it takes two *arguments* `arg1` and `arg2`. A sub can take an arbitrary number of arguments. Until now we have mostly considered subs with no arguments often called a macro. Macros can be called using a button in Excel. 

A function is declared using:

```
Function FunctionName(arg1 As <datatype>, arg2 As <datatype>) As <return datatype>
 <code>
 FunctionName = value  ' assign a return value to the function
End Sub
```

The name of the function is `FunctionName` and it takes two *arguments* `arg1` and `arg2`. A function can take an arbitrary number of arguments. A function always return a value of a data type (a sub do not return anything). You return a value by assigning it to the variable `FunctionName` (same as the function name). 

Let us consider a simple sub with one argument: 

```
Sub TM4_SimpleSub(str As String)
   MsgBox (str)
End Sub
```

and a simple function with two arguments:

```
Function TM4_SimpleFunc(dblA As Double, dblB As Double) As Integer
   TM4_SimpleFunc = dblA + dblB  ' return variable equals function name
End Function
```

You call a sub from another procedure using the `Call` keyword and a another function by assigning its return value to a variable:

```
' Try running it using the debugger (Ctrl + F8 (win) or cmd + shift + I (mac))
Sub TM4_CallSimpleProc()
   Dim dblV As Double
   
   MsgBox ("Ready")
   Call TM4_SimpleSub("SimpleSub")  ' call a sub within a procedure
   dblV = TM4_SimpleFunc(3, 4)      ' call a function within a procedure
   MsgBox ("Value is " & intV)
End Sub
```

It is always good coding practice to document you procedures:

```
'' Product of two numbers
' @param i First number
' @param j Second number
' @return The product i * j
' @remarks The numbers are doubles.
Function TM4_ProductFunc(i As Double, j As Double) As Double
    TM4_ProductFunc = i * j
End Function

'' Product of two numbers which are stored in dblV (since ByRef is the default).
' @param i First number
' @param j Second number
' @param dblV Stores the product
' @remarks The numbers are doubles.
Private Sub TM4_ProductSub(i As Double, j As Double, dblV As Double)
    dblV = i * j
End Sub
```

Note both procedures above do the same thing. The function returns the product and the procedure stores the product in argument `dblV` which is modified when the function call is returned:

```
'' Use TM4_ProductSub (TM4_ProductFunc produce the same result)
' Try running it using the debugger (Ctrl + F8 (win) or cmd + shift + I (mac))
Sub TM4_RunProductSub()
    Dim dblV As Double
    
    dblV = 4
    MsgBox ("Current value is " & dblV)  ' Current value is 4
    Call TM4_ProductSub(7, 3, dblV)      ' dblV = TM4_ProductFunc(7, 3) (same result)
    MsgBox ("Current value is " & dblV)  ' Current value is 21
End Sub
```

The reason is that arguments are per default references pointing to the same place in memory (we will look at the details in Section \@ref(vba-byref)).

You can use `Exit Sub`/`Exit Function` to exit the sub/function early in the code:

```
'' Division of two numbers
' @param i First number.
' @param j Second number.
' @return Divison i / j.
' @remarks The numbers are doubles.
Sub TM4_DivisionSub(i As Double, j As Double)
    If j = 0 Then
      MsgBox ("Error: division with zero!")
      Exit Sub
    End If
    MsgBox ("Value is " & i / j)
End Sub

'' Run using F5
Sub TM4_TestDivisionSub()
    Call TM4_DivisionSub(8, 2)  ' no error
    Call TM4_DivisionSub(8, 0)  ' gives an error message
End Sub
```


## Optional arguments {#vba-optional-arg}

Often you define procedures that have arguments with a default value. You can do this using the `Optional` keyword:

```
'' Convert kilograms to grams or pounds
' @param dblKg Kilograms.
' @param blnToGrams Convert to grams (if true) otherwise to pounds.
' @return Converted value.
Function TM4_ConvertKg(dblKg As Double, Optional blnToGrams As Boolean = True)
   If blnToGrams Then
      TM4_ConvertKg = dblKg * 1000
      Exit Function
   End If
   TM4_ConvertKg = dblKg * 2.20462
End Function

'' Run using F5
Sub TM4_TestConvertKg()
   MsgBox (TM4_ConvertKg(10))         ' use default value (to grams)
   MsgBox (TM4_ConvertKg(10, False))  ' to pounds
End Sub
```

Here we have one optional argument with default value equal to true. Now the function can be called with one argument (use the default value of the second argument) or with two arguments. Have a look at cells A8:C13 in worksheet *TM4* (Figure \@ref(fig:tm4-sheet)) where we use the function to find convert to grams (`TM4_ConvertKg(A8)`) and pounds (`TM4_ConvertKg(A8; FALSE)`).

Let us try to define a sub that format some cells (the content have been found using the macro recorder and then cleaned):

```
'' Format a range
'@param rng Range to format.
'@param intInteriorColor Interior color index.
'@param intFontColor Font color index.
'@param intFontSize Font size.
Sub TM4_FormatCell(rng As Range, Optional intInteriorColor As Integer = 0, _
 Optional intFontColor As Integer = 44, Optional intFontSize As Integer = 12)
    rng.Interior.ColorIndex = intInteriorColor
    rng.Font.ColorIndex = intFontColor
    rng.Font.Size = intFontSize
End Sub

'' Run using F5
Sub TestingFormatCell()
    Dim rng As Range
    
    Worksheets("TM4").Activate
    Call FormatCell(Range("A16"))       ' use default values
    Call FormatCell(Range("B16"), 46)   ' use background color index 46
    Call FormatCell(Range("C16"), , 21) ' set font color
    Call FormatCell(rng:=Range("D16"), intFontSize:=16, intFontColor:=23)  ' call sub using argument names explicit
End Sub
```

Observe that there is different ways to call a procedure with optional arguments. If you have may optional arguments it is best to use the last where you explicit state the argument names (here the order of the arguments do not matter either). Note that every argument following an optional argument in the procedure definition must also be optional. Moreover, if lines are to long you may split them using `_` (underscore).

In the example above we use the color index values in VBA (56 different ones). Let us have a look at them:

```
'' Run using F5
Sub TM4_SeeColorIndex()
   Dim r As Integer
   Dim c As Integer
   Dim i As Integer
   
   Worksheets("TM4").Activate
   i = 1
   For r = 18 To 40
      For c = 2 To 5
         Cells(r, c) = i
         Call TM4_FormatCell(rng:=Cells(r, c), intInteriorColor:=i, intFontColor:=1 + i Mod 4)
         If i = 56 Then
            Exit Sub
         End If
         i = i + 1
      Next
   Next
End Sub
```

The output will be outputted from row 18 (column B-E):

<div class="figure" style="text-align: center">
<img src="./img/tm4-sheet.png" alt="TM4 worksheet." width="400px" />
<p class="caption">(\#fig:tm4-sheet)TM4 worksheet.</p>
</div>


## Public and private procedures {#vba-pub-priv}

You may use the keyword `Private` or `Public` (default) when you define a procedure. For instance:

```
Private Sub SubName(arg1 As <datatype>, arg2 As <datatype>)
   <code>
End Sub
```

A private procedure can only be used by other procedures in the module. This may be useful if you want to define 'internal' procedures that you only want to use in the module. This also imply that a private sub can not be called from a button and a private function can not be called from a cell. Note the default value is `Public`. That is, if `Private` or `Public` is excluded, VBA will always treat the sub as if it were Public:

```
Sub SubName(arg1 As <datatype>, arg2 As <datatype>)  ' VBA assumes it is public (the default)
   <code>
End Sub

Public Sub SubName(arg1 As <datatype>, arg2 As <datatype>) ' same result as above
   <code>
End Sub
```


## Passing arguments by reference or by value {#vba-byref}

There are two ways of passing arguments to procedures:

```
Sub SubName(ByRef arg1 As <datatype>, ByVal arg2 As <datatype>)
 <code>
End Sub
```

Argument `arg1` is passed **by reference** (default). That is, no new memory is allocated when the procedure is called and as a result the procedure can have changed the value of `arg1` when the procedure stops. Note since the default, the result is the same if we omitted the keyword `ByRef`. Argument `arg2` is passed **by value**. That is, a copy of the variable is created in memory. Hence the procedure cannot change the value of `arg2` when the procedure stops (the copy is deleted). 

Using `ByRef` is faster and saves memory since we do not have to allocate new memory. We may use `ByRef` to return updated values of the input arguments (sub `TM4_ProductSub` did that). In fact you may have multiple arguments which when the sub finished have been modified. See it as the arguments have been modified with the result of the sub. Using `ByVal` is safer if you want be sure that the argument is not modified inside the procedure.

Try guessing the result of running sub `TM4_TestingBy`:

```
Private Function TM4_ByVal(ByVal i As Integer) As Integer
    i = i * 2
    MsgBox ("In ByVal i is " & i)
    TM4_ByVal = i * 5
End Function

'' Note "Function TM4_ByRef(i As Integer) As Integer" gives same result
Private Function TM4_ByRef(ByRef i As Integer) As Integer
    i = i * 2
    MsgBox ("In ByRef i is " & i)
    TM4_ByRef = i * 5
End Function


' Try running it using F5 or the debugger (Ctrl + F8 (win) or cmd + shift + I (mac))
Private Sub TM4_TestBy()
    Dim n As Integer
    Dim i As Integer
    
    i = 5
    MsgBox ("In the start i is " & i)
    n = TM4_ByVal(i)
    MsgBox ("Try gussing the values of n and i")
    MsgBox ("After TM4_ByVal i is " & i & " and " & n & " is returned.")
    n = TM4_ByRef(i)
    MsgBox ("Try gussing the values of n and i")
    MsgBox ("After TM4_ByRef i is " & i & " and " & n & " is returned.")
End Sub
```

### Return values from a sub

Since `ByRef` does not create a new copy of the argument in memory. We can return multiple values from a sub by

   1) Pass arguments (variables) by reference in the sub.
   2) Modify the variables inside the sub.
   
When the sub returns after it has been called the variables used a arguments contain the new updated values. See e.g `TM4_ProductSub` which returns the product in variable `dblV`. 


## Built-in functions {#vba-built-in}

VBA has a set of [built-in functions](https://bettersolutions.com/vba/functions/complete-list.htm) such as `Abs`, `Log` and `Date`. You call them by just writing their name:

```
'' Test VBA functions
' You can always get help by putting the crusor in the function name and press F1
Sub TM4_TestVBAfunctions()
   MsgBox ("Absolute value: " & Abs(-4.2))
   MsgBox ("Integer part: " & Fix(-4.2))
   MsgBox ("Floor of the number: " & Int(-4.2))
   MsgBox ("Natural logarithm: " & Log(16))
   MsgBox ("Random number [0,1[: " & Rnd())
   MsgBox ("Current date: " & Date)
   MsgBox ("Days from now: " & DateDiff("d", Date, DateValue("October, 28, 2022")))
End Sub
```

You can also use the [worksheet functions](https://bettersolutions.com/excel/functions/vba-or-excel.htm) in Excel. You call them using the `WorksheetFunction` object. A few examples:

```
'' Test worksheetfunctions
' You can always get help by putting the crusor in the function name and press F1
Sub TM4_TestWorksheetfunctions()
   Dim r As Integer
   Dim c As Integer
   
   Worksheets("TM4").Activate
   MsgBox ("Numbers above 80: " & WorksheetFunction.CountIf(Range("B33:E38"), ">80")) ' count numbers above
   MsgBox ("Sumproduct: " & WorksheetFunction.SumProduct(Range("B33:E33"), Range("B34:E34")))
   MsgBox ("Max: " & WorksheetFunction.Max(Range("B33:E38")))
   
   For r = 40 To 45
      For c = 2 To 4
         Cells(r, c) = WorksheetFunction.RandBetween(0, 9)
      Next
   Next
End Sub
```

## Example - Selection of test persons {#vba-test-persons}

*This example is a slightly modified version an exam assignment (exam 2021-A6).*

A virus has infected a number of persons. A possible cure has been developed, but the effect of it is expected to be dependent on the persons’ height. The cure can be tested on non-infected persons and the findings of this test can be directly transferred to any infected person whose height is within a range of 2 cm from the height of the tested person. For example, if the cure is tested on a non-infected person of height $172.2$, then any infected person whose height is in the interval $[170.2 ; 174.2]$ is *covered* by the test. 

<div class="figure" style="text-align: center">
<img src="./img/tm4-test-persons.png" alt="Infected and test persons." width="500px" />
<p class="caption">(\#fig:test-persons)Infected and test persons.</p>
</div>

Figure \@ref(fig:test-persons) shows the data in worksheet *TM4_Virus*:

   * Cell D1 states the number of infected persons. Columns A and B provide the person’s ID and height for each person.
   * Cell D2 states the number of non-infected persons volunteering to be test persons. Columns F and G provide their ID and height. 
   * The testing process is extremely resource demanding, and thus it is only possible to test a limited number of test volunteers. This number is stated in cell D3.
   
Given a test person we make a function `TM4_TestCover` that takes person id as argument and return the number of new infected persons covered. A person is already covered, if that person has a 1 in the *Covered* column.

```
Function TM4_TestCover(intId As Integer) As Integer
   Dim intI As Integer     ' number of infected
   Dim intC As Integer     ' number of covered
   Dim dblHeight As Double ' height of test person
   Dim r As Integer
   
   intI = Range("D1")
   dblHeight = Range("G" & intId + 6)
   intC = 0
   For r = 7 To intI + 6    ' loop through all infected
      If Cells(r, 2) >= dblHeight - 2 And Cells(r, 2) <= dblHeight + 2 And Cells(r, 3) <> 1 Then
         intC = intC + 1
      End If
   Next
   TM4_TestCover = intC
End Function
```

First, note that given a test person id, the height is found in row `id + 6` and column G. Next, we use the counter `intC` to count new covered persons. This result is returned by the function.

To find the right test persons the following greedy strategy is used:

<div class="box">
**Step 1**:	Select the test person (not already selected) that can cover most new infected persons (not yet covered). If more than one test person have the same cover, select the one with the smallest ID. 

**Step 2**: Add ones to the *Covered* column for all infected persons covered by the test person.

**Step 3**: Go to Step 1 until found the test persons needed.
</div>

We implement the the greedy strategy:

```
Sub TM4_FindTestPersons()
   Dim intI As Integer  ' number of infected
   Dim intT As Integer  ' number of test volunteers
   Dim intS As Integer  ' number of selected persons
   Dim intC As Integer  ' number of covered
   Dim intBestId As Integer ' best id found
   Dim intBestC As Integer  ' best cover value found
   Dim r As Integer

   Worksheets("TM4_Virus").Activate
   intI = Range("D1")
   intT = Range("D2")
   intS = 0   ' no selected yet
   Do While intS < Range("D3")    ' stop when have found needed test persons
      intBestId = -1
      intBestC = -1
      For r = 7 To intT + 6       ' loop through all test volunteers
         If Cells(r, 8) <> 1 Then ' not selected already
            intC = TM4_TestCover(Cells(r, 6))
            If intBestC < intC Then ' found a better person
               intBestC = intC
               intBestId = Cells(r, 6)
            End If
         End If
      Next
      Cells(intBestId + 6, 8) = 1  ' select best
      For r = 7 To intI + 6  ' add ones in covered column
          If Abs(Cells(r, 2) - Cells(intBestId + 6, 7)) <= 2 Then
              Cells(r, 3) = 1
          End If
      Next
      intS = intS + 1
   Loop
End Sub
```

First, the number of persons are stored in variables. Next, a `Do While` loop is used to find the test persons. We use two variables to store the best id and cover value. The first inner for loop scan the test persons and for each person (not yet selected) we find the cover (using `TM4_TestCover`), check if better than current and update. The second inner for loop add ones to the *Covered* column. The output is given in Figure \@ref(fig:test-persons-res).

<div class="figure" style="text-align: center">
<img src="./img/tm4-test-persons-res.png" alt="Infected and test persons." width="500px" />
<p class="caption">(\#fig:test-persons-res)Infected and test persons.</p>
</div>

In total 13 infected persons are covered by 3 test persons.


## Recap

- A procedure is a piece of code stored in a module. 
- A procedure contains a series of computational steps that will be carried out when the procedure is called. 
- VBA has two kinds of procedures:
  
  Subs:
  - Can make changes to the worksheet.
  - Can modify its surroundings.
  - Can be executed by a button (if no arguments).
  - Cannot return anything.
  
  
  Functions:
  - Can return something.
  - Can be used in Excel.
  - Cannot be used as a macro.


- You declare a procedure using
  ```
   Sub SubName(arg1 As <datatype>, arg2 As <datatype>)
      <code>
   End Sub
   
   Function FunctionName(arg1 As <datatype>, arg2 As <datatype>) As <return datatype>
    <code>
    FunctionName = value  ' assign a return value to the function
   End Sub
  ```
- You can use `Exit Sub`/`Exit Function` to exit the sub/function early in the code.
- Procedures can be either public or private:
  - Public (default): Can be used from other modules, from other files and from Excel.
    ```
    Public Sub SubName()
    ...
    End Sub
    ```
  - Private: Can only be used from within its own module.
    ```
    Private Sub SubName()
    ...
    End Sub
    ```
- Use the `Call` keyword to call a sub:
  ```
  Call SubName(arg1, arg2)
  ```
- Call a function by assigning its return value to a variable
  ```
  result = FunctionName(arg1, arg2)
  ```
- There are two ways of passing arguments to procedures:
  ```
  Sub SubName(ByRef arg1 As <datatype>, ByVal arg2 As <datatype>)
    <code>
  End Sub
  ```
  - Argument `arg1` is passed **by reference** (default). That is, no new memory is allocated when the procedure is called and hence the procedure can have changed the value of `arg1` when the procedure stops. 
  - Since the default is `ByRef`, the result is the same if we omitted the keyword `ByRef`. 
  - Argument `arg2` is passed **by value**. That is, a copy of the variable is created in memory with local scope. Hence the procedure cannot change the value of `arg2` when the procedure stops (the local variables is deleted). 

  - Using `ByRef` is faster and saves memory since we do not have to allocate new memory. 
  - We may use `ByRef` to return updated values of the input arguments.
- Use the `Optional` keyword to indicate default input arguments:
  ```
  Sub SubName(arg1 As <datatype>, Optional arg2 As <datatype> = <defaultValue>)  
  ```
  You can now call the procedure using:
  ```
  Call SubName(arg1)  ' assume that arg2 = defaultValue
  ```
  Every parameter following an optional parameter in the procedure definition must also be optional.
- VBA has a set of [built-in functions](https://bettersolutions.com/vba/functions/complete-list.htm) such as `Abs`, `Log` and `Date`. You call them by just writing their name:
  ```
  dtm as Date
  dtm = Date()
  ```
- You can also use the [worksheet functions](https://docs.microsoft.com/en-us/office/vba/excel/concepts/events-worksheetfunctions-shapes/list-of-worksheet-functions-available-to-visual-basic) in Excel. You call them using the `WorksheetFunction` object:
  ```
  sum = WorksheetFunction.Sum(Range("A1:D5"))
  ```
  

```{=html}
<div>
You may also have a look at the
<a href="https://bss-osca.github.io/tfa/slides/04_vba-procedures-slides.html" target="_blank">slides for this module</a>
.
</div>
```


## Exercises {#ex-vba-procedures}

Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the [help page](#help). Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution!


```{=html}
<div>
A template with VBA code for this module is given in the file
<a href="https://github.com/bss-osca/tfa/blob/master/vba/04-vba-procedures-template.xlsm" target="_blank">04-vba-procedures-template.xlsm</a>
(open it and use it while reading the notes). Have a look inside the module
<i>TM4_ex</i>
in the VBA editor for examples used in the notes and during lectures. Have a look at module
<i>TM4_exercises</i>
for exercises. The template file for next teaching module will contain guiding answers for the exercises to this teaching module.
</div>
```

### Exercise - Subs {#ex-vba-subs}

   (1) Create a sub `GetMsg` that takes a string and a Boolean as input and create a message box with the string content if the Boolean is true. Test the procedure using the `TestGetMsg` sub.
   (2) Modify the procedure so the Boolean have a default value equal to true.
   (3) Create a sub `PrintNameAge` that takes two arguments as input (name and age) and create a message box with the persons name and age.
   (4) Write a sub `TestPrintNameAge` that uses two input boxes to ask for name and age and then call sub `PrintNameAge`.


### Exercise - Temperatures

*This exercise is a slightly modified version an exam assignment (reexam 2022-A4).*

Temperatures in Fahrenheit can be converted to Celsius using $$C = \frac{5(F-32)}{9}$$ 
Similar temperatures in Celsius can be converted to Fahrenheit using $$F = \frac{9C}{5} + 32$$

   (1) Make functions:
       - `TM4_CelsiusToFahrenheit` that takes a double `dblVal` in Celsius as input argument and returns the number converted to Fahrenheit.
       - `TM4_FahrenheitToCelsius` that takes a double `dblVal` in Fahrenheit as input argument and returns the number converted to Celsius.
   (2) Make a function `TM4_ConvertTemp` with the following features:
       - Input arguments are a double `dblVal` and a string `strIUnit`.
       - If the input unit `strIUnit` equals "c" then the returned number is converted to Fahrenheit.
       - If the input unit `strIUnit` equals "f" then the returned number is converted to Celsius.
       - If the input unit `strIUnit` does not equals "f" or "c" then a message box is given with an error.
   (3) Test function `TM4_ConvertTemp` on worksheet *TM4* (row 66).


### Exercise - Functions {#ex-vba-functions}

   (1) Write a function `TM4_Discount` which takes a two input arguments (doubles): the discount percentage and the amount. The function returns the discounted value. For instance if the discount is 10 percent and amount 100 then the discounted value is $90 = 100\cdot(1-0.1)$. Have a look at the unfinished sub `TM4_Discount` for hints. Note the comments describing the function using the [coding convention](#coding-convention). Check the test results starting from row 47 in worksheet *TM4*.
   (2) Write a function `Larger` which takes two integer arguments and returns true if the first is larger than the last; otherwise false. Check the test results starting from row 53 in worksheet *TM4*.
   (3) Write a function `NumbDays` that takes a date as argument and return the number of days from today. Hint: Have a look at the [`DateDiff`](https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/datediff-function) function. Check the test results starting from row 59 in worksheet *TM4*.
   (4) Write a sub that uses an input box to ask for an amount a then returns the discounted amount when the discount is 20%. The sub should use the function in Question 1. Test it using the button in worksheet *TM4* (row 49).


### Exercise - Worksheet functions {#ex-vba-worksheet-functions}

The worksheet *TM4_Numbers* contains a button that runs a procedure which generate a set of numbers. Create a procedure `TM4_Summary` that uses worksheet functions to:

- Find the maximum number and write it to cell D1. 
- Find the minimum number and write it to cell D2. 
- Find the sum of the numbers and write it to cell D3. 
- Count the number of positives and write it to cell D4.
- Find the row number with maximum value and write it to cell D5. 

Google is a good place to start if you want to find a specific Excel function, e.g. try to search 'excel row with max value'. Test the procedure using the *Summary* button in worksheet *TM4_Numbers*.



[BSS]: https://bss.au.dk/en/

[course-help]: https://github.com/bss-osca/tfa/issues
[cran]: https://cloud.r-project.org
[cheatsheet-readr]: https://rawgit.com/rstudio/cheatsheets/master/data-import.pdf
[course-welcome-to-the-tidyverse]: https://github.com/rstudio-education/welcome-to-the-tidyverse

[DataCamp]: https://www.datacamp.com/
[datacamp-signup]: https://www.datacamp.com/groups/shared_links/cbaee6c73e7d78549a9e32a900793b2d5491ace1824efc1760a6729735948215
[datacamp-r-intro]: https://learn.datacamp.com/courses/free-introduction-to-r
[datacamp-r-rmarkdown]: https://campus.datacamp.com/courses/reporting-with-rmarkdown
[datacamp-r-communicating]: https://learn.datacamp.com/courses/communicating-with-data-in-the-tidyverse
[datacamp-r-communicating-chap3]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/introduction-to-rmarkdown
[datacamp-r-communicating-chap4]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/customizing-your-rmarkdown-report
[datacamp-r-intermediate]: https://learn.datacamp.com/courses/intermediate-r
[datacamp-r-intermediate-chap1]: https://campus.datacamp.com/courses/intermediate-r/chapter-1-conditionals-and-control-flow
[datacamp-r-intermediate-chap2]: https://campus.datacamp.com/courses/intermediate-r/chapter-2-loops
[datacamp-r-intermediate-chap3]: https://campus.datacamp.com/courses/intermediate-r/chapter-3-functions
[datacamp-r-intermediate-chap4]: https://campus.datacamp.com/courses/intermediate-r/chapter-4-the-apply-family
[datacamp-r-functions]: https://learn.datacamp.com/courses/introduction-to-writing-functions-in-r
[datacamp-r-tidyverse]: https://learn.datacamp.com/courses/introduction-to-the-tidyverse
[datacamp-r-strings]: https://learn.datacamp.com/courses/string-manipulation-with-stringr-in-r
[datacamp-r-dplyr]: https://learn.datacamp.com/courses/data-manipulation-with-dplyr
[datacamp-r-dplyr-bakeoff]: https://learn.datacamp.com/courses/working-with-data-in-the-tidyverse
[datacamp-r-ggplot2-intro]: https://learn.datacamp.com/courses/introduction-to-data-visualization-with-ggplot2
[datacamp-r-ggplot2-intermediate]: https://learn.datacamp.com/courses/intermediate-data-visualization-with-ggplot2
[dplyr-cran]: https://CRAN.R-project.org/package=dplyr
[debug-in-r]: https://rstats.wtf/debugging-r-code.html

[excel-vs-r]: https://www.jessesadler.com/post/excel-vs-r/

[google-form]: https://forms.gle/s39GeDGV9AzAXUo18
[google-grupper]: https://docs.google.com/spreadsheets/d/1DHxthd5AQywAU4Crb3hM9rnog2GqGQYZ2o175SQgn_0/edit?usp=sharing
[GitHub]: https://github.com/
[git-install]: https://git-scm.com/downloads
[github-actions]: https://github.com/features/actions
[github-pages]: https://pages.github.com/

[happy-git]: https://happygitwithr.com
[hg-install-git]: https://happygitwithr.com/install-git.html
[hg-why]: https://happygitwithr.com/big-picture.html#big-picture
[hg-github-reg]: https://happygitwithr.com/github-acct.html#github-acct
[hg-git-install]: https://happygitwithr.com/install-git.html#install-git
[hg-exist-github-first]: https://happygitwithr.com/existing-github-first.html
[hg-exist-github-last]: https://happygitwithr.com/existing-github-last.html
[hg-credential-helper]: https://happygitwithr.com/credential-caching.html
[hypothes.is]: https://web.hypothes.is/

[osca-programme]: https://kandidat.au.dk/en/operationsandsupplychainanalytics/

[Peergrade]: https://peergrade.io
[peergrade-signup]: https://app.peergrade.io/join
[point-and-click]: https://en.wikipedia.org/wiki/Point_and_click
[pkg-bookdown]: https://bookdown.org/yihui/bookdown/
[pkg-openxlsx]: https://ycphs.github.io/openxlsx/index.html
[pkg-ropensci-writexl]: https://docs.ropensci.org/writexl/
[pkg-jsonlite]: https://cran.r-project.org/web/packages/jsonlite/index.html

[R]: https://www.r-project.org
[RStudio]: https://rstudio.com
[rstudio-cloud]: https://rstudio.cloud/spaces/176810/join?access_code=LSGnG2EXTuzSyeYaNXJE77vP33DZUoeMbC0xhfCz
[r-cloud-mod12]: https://rstudio.cloud/spaces/176810/project/2963819
[r-cloud-mod13]: https://rstudio.cloud/spaces/176810/project/3020139
[r-cloud-mod14]: https://rstudio.cloud/spaces/176810/project/3020322
[r-cloud-mod15]: https://rstudio.cloud/spaces/176810/project/3020509
[r-cloud-mod16]: https://rstudio.cloud/spaces/176810/project/3026754
[r-cloud-mod17]: https://rstudio.cloud/spaces/176810/project/3034015
[r-cloud-mod18]: https://rstudio.cloud/spaces/176810/project/3130795
[r-cloud-mod19]: https://rstudio.cloud/spaces/176810/project/3266132
[rstudio-download]: https://rstudio.com/products/rstudio/download/#download
[rstudio-customizing]: https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio
[rstudio-key-shortcuts]: https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts
[rstudio-workbench]: https://www.rstudio.com/wp-content/uploads/2014/04/rstudio-workbench.png
[r-markdown]: https://rmarkdown.rstudio.com/
[ropensci-writexl]: https://docs.ropensci.org/writexl/
[r4ds-pipes]: https://r4ds.had.co.nz/pipes.html
[r4ds-factors]: https://r4ds.had.co.nz/factors.html
[r4ds-strings]: https://r4ds.had.co.nz/strings.html
[r4ds-iteration]: https://r4ds.had.co.nz/iteration.html

[stat-545]: https://stat545.com
[stat-545-functions-part1]: https://stat545.com/functions-part1.html
[stat-545-functions-part2]: https://stat545.com/functions-part2.html
[stat-545-functions-part3]: https://stat545.com/functions-part3.html
[slides-welcome]: https://bss-osca.github.io/tfa/slides/00-tfa_welcome.html
[slides-m1-3]: https://bss-osca.github.io/tfa/slides/01-welcome_r_part.html
[slides-m4-5]: https://bss-osca.github.io/tfa/slides/02-programming.html
[slides-m6-8]: https://bss-osca.github.io/tfa/slides/03-transform.html
[slides-m9]: https://bss-osca.github.io/tfa/slides/04-plot.html
[slides-m83]: https://bss-osca.github.io/tfa/slides/05-joins.html

[tidyverse-main-page]: https://www.tidyverse.org
[tidyverse-packages]: https://www.tidyverse.org/packages/
[tidyverse-core]: https://www.tidyverse.org/packages/#core-tidyverse
[tidyverse-ggplot2]: https://ggplot2.tidyverse.org/
[tidyverse-dplyr]: https://dplyr.tidyverse.org/
[tidyverse-tidyr]: https://tidyr.tidyverse.org/
[tidyverse-readr]: https://readr.tidyverse.org/
[tidyverse-purrr]: https://purrr.tidyverse.org/
[tidyverse-tibble]: https://tibble.tidyverse.org/
[tidyverse-stringr]: https://stringr.tidyverse.org/
[tidyverse-forcats]: https://forcats.tidyverse.org/
[tidyverse-readxl]: https://readxl.tidyverse.org
[tidyverse-googlesheets4]: https://googlesheets4.tidyverse.org/index.html
[tutorial-markdown]: https://commonmark.org/help/tutorial/

[Udemy]: https://www.udemy.com/

[vba-yt-course1]: https://www.youtube.com/playlist?list=PLpOAvcoMay5S_hb2D7iKznLqJ8QG_pde0
[vba-course1-hello]: https://youtu.be/f42OniDWaIo

[vba-yt-course2]: https://www.youtube.com/playlist?list=PL3A6U40JUYCi4njVx59-vaUxYkG0yRO4m
[vba-course2-devel-tab]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-editor]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-project]: https://youtu.be/fp6PTbU7bXo
[vba-course2-devel-properties]: https://youtu.be/ks2QYKAd9Xw
[vba-course2-devel-hello]: https://youtu.be/EQ6tDWBc8G4

[video-install]: https://vimeo.com/415501284
[video-rstudio-intro]: https://vimeo.com/416391353
[video-packages]: https://vimeo.com/416743698
[video-projects]: https://vimeo.com/319318233
[video-r-intro-p1]: https://www.youtube.com/watch?v=vGY5i_J2c-c
[video-r-intro-p2]: https://www.youtube.com/watch?v=w8_XdYI3reU
[video-r-intro-p3]: https://www.youtube.com/watch?v=NuY6jY4qE7I
[video-subsetting]: https://www.youtube.com/watch?v=hWbgqzsQJF0&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10&t=0s
[video-datatypes]: https://www.youtube.com/watch?v=5AQM-yUX9zg&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10
[video-control-structures]: https://www.youtube.com/watch?v=s_h9ruNwI_0
[video-conditional-loops]: https://www.youtube.com/watch?v=2evtsnPaoDg
[video-functions]: https://www.youtube.com/watch?v=ffPeac3BigM
[video-tibble-vs-df]: https://www.youtube.com/watch?v=EBk6PnvE1R4
[video-dplyr]: https://www.youtube.com/watch?v=aywFompr1F4

[wiki-snake-case]: https://en.wikipedia.org/wiki/Snake_case
[wiki-camel-case]: https://en.wikipedia.org/wiki/Camel_case
[wiki-interpreted]: https://en.wikipedia.org/wiki/Interpreted_language
[wiki-literate-programming]: https://en.wikipedia.org/wiki/Literate_programming
[wiki-csv]: https://en.wikipedia.org/wiki/Comma-separated_values
[wiki-json]: https://en.wikipedia.org/wiki/JSON

<script src="//unpkg.com/@highlightjs/cdn-assets@11.5.1/highlight.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/highlightjs-vba/dist/vba.min.js"></script>
<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script> -->
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
  // hljs.initLineNumbersOnLoad({singleLine: true}); 
</script>

<!--chapter:end:04_vba-procedures.Rmd-->

---
output: html_document
editor_options: 
  chunk_output_type: console
---






# Advanced data types and usage {#mod-vba-datatypes}

Recall that variables are used to store information that is saved in memory. A variable may store different data types. Until now we have mostly considered basic data types such as an integer, a double or a string. In this module a short introduction to some of the more advanced data types is given such as a group of integers (an array), a range of cells in a worksheet (a range object) or a set of numbers (a collection). 


```{=html}
<div>
A template with VBA code for this module is given in the file
<a href="https://github.com/bss-osca/tfa/blob/master/vba/05-vba-datatypes-template.xlsm" target="_blank">05-vba-datatypes-template.xlsm</a>
(open it and use it while reading the notes). Have a look inside the module
<i>TM5_ex</i>
in the VBA editor for examples used in the notes and during lectures. Have a look at module
<i>TM5_exercises</i>
for exercises. The template file for next teaching module will contain guiding answers for the exercises to this teaching module.
</div>
```

#### Learning path diagram {-}

Click/hover the nodes to follow links and see details.


```{=html}
<div id="htmlwidget-4abf39ddbbc825cefb83" style="width:100%;height:200px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-4abf39ddbbc825cefb83">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"💡 Strings\", URL = \"#vba-strings\", tooltip = \"Strings (interactive)\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"2,1!\"] \n  \"2\" [label = \"📖 Objects\", URL = \"#vba-objects\", tooltip = \"Objects (reading)\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"3.7,1!\"] \n  \"3\" [label = \"💡 Worksheets\", URL = \"#vba-wst\", tooltip = \"Worksheets (interactive)\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"5.5,1!\"] \n  \"4\" [label = \"💡 Ranges\", URL = \"#vba-rng\", tooltip = \"Ranges (interactive)\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"7.6,1!\"] \n  \"5\" [label = \"💡 Arrays\", URL = \"#vba-ary\", tooltip = \"Arrays (interactive)\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"9.6,1!\"] \n  \"6\" [label = \"💡 Collections\", URL = \"#vba-coll\", tooltip = \"Collections (interactive)\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"11.6,1!\"] \n  \"7\" [label = \"💡 Example\", URL = \"#vba-ex-job-seq\", tooltip = \"Example (interactive)\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"13.7,1!\"] \n  \"8\" [label = \"💻 Exercises\", URL = \"#ex-vba-datatypes\", tooltip = \"Exercises\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"15.8,1!\"] \n  \"9\" [label = \"🎬 Arrays\", URL = \"https://youtu.be/ELFrOYNTxEU\", tooltip = \"Arrays\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"PeachPuff3\", pos = \"8.6,0!\"] \n  \"10\" [label = \"🎬 Dynamic arrays\", URL = \"https://youtu.be/AqYDI2Vt1mw\", tooltip = \"Dynamic arrays\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"PeachPuff3\", pos = \"10.6,0!\"] \n\"1\"->\"2\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"3\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"4\" [color = \"black\", arrowhead = \"vee\"] \n\"4\"->\"5\" [color = \"black\", arrowhead = \"vee\"] \n\"5\"->\"6\" [color = \"black\", arrowhead = \"vee\"] \n\"5\"->\"9\" [color = \"black\", arrowhead = \"vee\"] \n\"5\"->\"10\" [color = \"black\", arrowhead = \"vee\"] \n\"6\"->\"7\" [color = \"black\", arrowhead = \"vee\"] \n\"7\"->\"8\" [color = \"black\", arrowhead = \"vee\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
```

If you like a different learning style there is a lot for videos about VBA online such as course [14-Hour VBA Course][vba-yt-course2]. The videos have been pointed out as extra online supplements in the learning path diagram. However, they are not necessary for the course. Since Excel change as new versions arrive and it work on different operating systems, the look in the screenshots and videos might be a bit different from your version. However, you still should be able to understand it. 

## Learning outcomes {#lo-vba-datatypes}

By the end of this module, you are expected to be able to:

* Name different data types and how they effect memory size.
* Declare a variable as a data type.
* Declare and manipulate strings.
* Describe what the object is.
* Declare and set an object.
* Manipulate worksheets (add, delete, clear).
* Understand what a range is and extract info about it such as rows, start row, address, start column etc. 
* Use the current region of a range to get information about the size for data.
* Sort, paste and modify a range.
* Declare and use an array with both fixed and dynamic dimension.
* Sort, read and modify an array.
* Explain why using arrays is often better than ranges.
* Declare and use a collection.
* Explain what a collection of objects are. 
* Use a `For Each` loop to iterate though a collection of objects. 

The learning outcomes relate to the [overall learning goals](#lg-course) number 1, 2, 4, 8 and 9 of the course.

<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->


## Strings {#vba-strings}

Strings contain a group of characters (an empty string is of length zero). Memory requirements vary with the length of the string (10 bytes + length $\cdot$ 2 byte). We use the symbol `&` to concatenate strings (glue strings together):

```
'' Concatenate two strings
Sub TM5_StrConcat()
    Dim strX As String
    Dim strY As String
    Dim strRes As String
    
    strX = "VBA"
    strY = "Strings"
    strRes = strX & " " & strY
    MsgBox (strRes)
    MsgBox (strX & vbCr & strY)   ' use vbCr to insert a new line
End Sub
```

Note you can use constant `vbCr` to add a new line.

There are many [VBA functions that can be used to manipulate strings](https://docs.microsoft.com/en-us/dotnet/visual-basic/language-reference/functions/string-functions). Some examples:

```
'' String functions
Sub TM5_StrFunc()
    Dim str As String
    
    str = "VBA Strings"
    MsgBox ("The length is: " & Len(str))
    MsgBox ("In lowercase: " & LCase(str))
    MsgBox ("Last 7 char: " & Right(str, 7))
    MsgBox ("Replace: " & Replace(str, "Strings", "Rules"))
    MsgBox ("Compare: " & StrComp(str, "VBA Strings"))  ' result is 0 (equal)
    MsgBox ("Compare: " & StrComp(str, "Apple"))        ' result is 1 (str alfabetically after)
    MsgBox ("Compare: " & StrComp(str, "Wait"))         ' result is -1 (str alfabetically before)
    MsgBox ("String is starting at char number: " & InStr(str, "String"))  ' result is 0 if not found
End Sub
```


## Objects {#vba-objects}

VBA have a lot of predefined objects you can use. Think of an object as a datatype that holds a group of variables. Examples of some objects are `Range`, `Worksheet`, and `WorksheetFunction`. Objects are grouped, nested and you refer to an object by specifying the path, e.g.:

```
Workbooks("Jobs.xlsm").Worksheets("Data values").Range("D4").value
```

Here we refer to the value in cell D4 in worksheet *Data values* in the file *Jobs.xlsm*. You may skip parts of the path (VBA then uses the current active one):

```
Workbooks("Jobs.xlsm").Worksheets("Data values").Range("D4").value  ' full specification
Worksheets("Data values").Range("D4").value  ' same result if Excel file "Jobs.xlsm" is active
Range("D4")  ' same result if Excel sheet "Data values" is active and "Jobs.xlsm" file
```

Note `.value` has been dropped in the last line because it is the default, i.e. you do not have to write it explicit. 

Object variables are declared like any other variables:

```
Dim rng As Range
Dim wst As Worksheet
```

Use `Set` to allocate the Object:

```
Set rng = Range("F7")
Set wst = Worksheets("Data values")
```

Now `rng` is a reference to cell F7 and `wst` is a reference to worksheet *Data values*. Think of a reference as a value that identify where in memory the object is. 

<!-- You may declare and set in one go using the `New` keyword: -->

<!-- ``` -->
<!-- Dim col as New Collection  ' col is now an empty collection (0 items) -->
<!-- ``` -->

In the next sections let us have a look at some relevant objects.


## The Worksheet object {#vba-wst}

The `Worksheet` object refer to a worksheet in the Excel file and you can use it to e.g. modify cells:

```
Sub TM5_TestWorksheet()
   ThisWorkbook.Activate  ' activate this workbook
   Worksheets("TM5_Test1").Range("B2") = "Testing Worksheet"  ' write to cell in sheet TM5_Test1
   Sheet_TM5_Test1.Range("B3") = "Use the sheets code name"   ' use the code name (also work if sheet renamed)
   'ThisWorkbook.Worksheets("Test3").Range("B5") = "Test"     ' Error since there is no sheet Test3 in this workbook
   Range("B4") = "Do you know which sheet is active?"         ' Active sheet
   ' Good coding pratice is always to specify the full path (as above) or make the sheet under considration active
   Worksheets("TM5_Test1").Activate  ' Make sheet active so know where is
   Range("B5") = "I know which sheet is active!"
End Sub
```

It is always good practice to make sure that you are working with the correct Excel file. Otherwise you will get errors if another file is active. This can be done using the `ThisWorkbook` object. Similar you either refer to a worksheet directly using its name or its code name. The code name can be set in the Properties window in the VBA editor. An alternative is to activate the worksheet. 

You can use `Worksheet` variables:

```
Sub TM5_TestWorksheetVar()
  Dim wst1 As Worksheet  ' define a variable which hold a reference to a Worksheet object
  Dim wst2 As Worksheet  ' define a variable which hold a reference to a Worksheet object
  Dim rng As Range
  
  Set wst1 = ThisWorkbook.Worksheets("TM5_Test1")  ' set the reference
  Set wst2 = ThisWorkbook.Worksheets("TM5_Test2")  ' set the reference
  wst1.Range("B6") = "Writing using wst1"
  wst2.Range("B2") = "Writing using wst2"
  wst1.Activate   ' just to have a look
End Sub
```

Here by having two worksheet variables we can write directly to cells in different worksheets without activating the worksheet.

You may check if a worksheet exists using:

```
'' Check if a worksheet exists
' @param strName Name of worksheet.
' @return True if exists.
Function WstExists(strName As String) As Boolean
    WstExists = Evaluate("ISREF('" & strName & "'!A1)")
End Function
```

The worksheet object has a lot of *methods/properties* (think of methods as procedures defined inside the object) for instance `wst.Add` and `wst.Delete`. Let us try to define a function that delete a worksheet:

```
'' Delete a worksheet if it exists
' @param strName Name of worksheet.
' @return True if deleted.
' @author Lars Relund <lars@relund.dk>
Function WstDelete(strName As String) As Boolean
    Dim wst As Worksheet
    Dim bln As Boolean
    
    bln = Application.DisplayAlerts
    Application.DisplayAlerts = False   ' no "really want to delete" alert
    If WstExists(strName) Then
        Worksheets(strName).Delete
        WstDelete = True
    Else
        WstDelete = False
    End If
    Application.DisplayAlerts = bln     ' restore value
End Function
```

We first use the function `WstExists` to check if there is a worksheet. If there is, we call the `.delete` method and delete the worksheet. Note since we do not want an alert stating if we really want to delete the worksheet this is disabled using the `Application` object. The function returns true if the worksheet has been deleted.

Let us try to define a function that create a worksheet:

```
'' Create a worksheet
' @param strName Name of worksheet.
' @param blnForce Force deletion of worksheet if exists.
' @return True if created.
Function WstCreate(strName As String, Optional blnForce As Boolean = False) As Boolean
    Dim wst As Worksheet
    
    If blnForce And WstExists(strName) Then Call WstDelete(strName)
    If Not WstExists(strName) Then
        Set wst = Worksheets.Add
        wst.Name = strName
        WstCreate = True
    Else
        WstCreate = False
    End If
End Function
```

We use an optional argument to force deletion of the old worksheet (if a worksheet with the same name). Next, we create the worksheet using the `.Add` method and rename it using the `.Name` method. The function returns true if the worksheet has been created.

Finally, let us create a function that clear a worksheet:

```
'' Clear a worksheet if it exists
' @param strName Name of worksheet.
' @param blnCells Delete cell contents, formats, comments, etc. (default).
' @param blnContents Delete cell contents.
' @param blnFormat Delete cell format.
' @param blnObjects Delete cell buttons and charts.
' @return True if cleared.
Function WstClear(strName As String, _
  Optional blnCells As Boolean = True, _
  Optional blnContents As Boolean = False, _
  Optional blnFormat As Boolean = False, _
  Optional blnObjects As Boolean = False) As Boolean
    Dim wst As Worksheet
    
    On Error Resume Next
    If WstExists(strName) Then
        Set wst = Worksheets(strName)
        If blnCells Then wst.UsedRange.Clear
        If blnContents Then wst.Cells.ClearContents
        If blnFormat Then wst.Cells.ClearFormats
        If blnObjects Then
            wst.ChartObjects.Delete
            wst.Buttons.Delete
        End If
        WstClear = True
    Else
        WstClear = False
    End If
End Function
```

First note that we have a lot of optional arguments depending on what we want to clear. Next the `On Error Resume Next` statement is used to make the program not stop even if an error happens. Finally, depending on the setting of the optional arguments we e.g. clear the format in all cells if `blnFormat` is true.

All the functions above is part of the *[course procedures](#vba-course-procedures)* that you may use 'as is' during the course and at the exam. I will explicitly state if you are not allowed to use them otherwise. All the worksheet procedures start with `Wst` so you easy can find them using auto complete in the VBA editor. All worksheet procedures are stored in the `ModWst` module. You may open the module to have a look at the procedures.

Let us see them in action:

```
'' Test the worksheet functions
Sub TM5_TestWorksheetFunc()
    If WstCreate("Test", blnForce:=True) Then MsgBox ("Created Test")  
    If WstRename("Test", "Test1") Then MsgBox ("Renamed the Test to Test1")  ' only work if no Test1 sheet
    If WstClear("Test8") Then MsgBox ("Cleared Test8") ' no clearing since on sheet with that name
    If WstDelete("Test1") Then MsgBox ("Deleted Test1")
End Sub
```


## The Range object {#wst-rng}

Ranges are objects that refer to parts of a worksheet e.g. a cell, a row, a column, or a rectangular selection of cells. Ranges can be used to read and write to cells

```
Sub TM5_RangeEx1()
   Dim rng As Range
   Dim cell As Range
   Dim i As Integer
   
   Call TM5_ClearTestTM5    ' clear test cells so have empty cells
   ThisWorkbook.Worksheets("TM5").Activate
   ' Modify a range to a fixed value
   Set rng = Range("G4:I6")
   rng = 145   ' cell value in rng
   MsgBox rng.Address   ' range address 
   ' Use for each to scan range (direction left-down)
   Set rng = Range("G8:I10")
   i = 1
   For Each cell In rng
      cell = "Entry " & i
      i = i + 1
   Next
   ' Use Cells to set a range
   Set rng = Range(Cells(23, 3), Cells(25, 6))
   MsgBox rng.Address
End Sub
```

The method `.Address` is used to return the cell address. 

<div class="figure" style="text-align: center">
<img src="./img/tm5-sheet.png" alt="TM5 worksheet." width="700px" />
<p class="caption">(\#fig:tm5-sheet)TM5 worksheet.</p>
</div>

Similar the number of rows can by found using `.rows.Count`:

```
'' Rows in range
' @param rng A range.
Function RngGetRows(rng As Range) As Long
    RngGetRows = rng.rows.Count
End Function
```

We can also find number of columns, address of upper left cell or lower right cell etc. In the [course procedures](#vba-course-procedures) (module *ModRng*) all these have been defined. Let us try to use them:

```
Sub TM5_RangeEx2()
  Dim rng As Range
  
  Set rng = ThisWorkbook.Worksheets("TM5").Range("C4:E19")
  MsgBox ("Number of rows: " & RngGetRows(rng))
  MsgBox ("Number of cols: " & RngGetCols(rng))
  MsgBox ("First column number: " & RngGetFirstCol(rng))
  MsgBox ("First column letter: " & RngGetFirstCol(rng, asLetter:=True))
  MsgBox ("Lower right cell: " & RngGetLowerRight(rng, asString:=True))
  MsgBox ("Upper right cell: " & RngGetUpperRight(rng, asString:=True))
End Sub
```

### Current region of a range

An important method is the current region `.CurrentRegion` which expands the range until all cells surrounding the range is empty. This is very useful if don't know the size for data. Let us make a function that return the current region:

```
'' Return the current region of a range.
' @param rng The range to get the current region from.
Function RngCurRegion(rng As Range) As Range
    Set RngCurRegion = rng.CurrentRegion
End Function
```

Note we have to use the `Set` keyword since the return value is a range (object). We can now test the course procedures starting with prefix `RngGet`:

```
Sub TM5_CurrentRegionEx1()
    Dim rng As Range

    ThisWorkbook.Worksheets("TM5").Activate
    ' Try to guess the output
    Set rng = RngCurRegion(Range("D7"))  ' rng now is the current region
    MsgBox ("Address: " & RngGetAddress(rng))
    MsgBox ("Rows = " & RngGetRows(rng) & " cols = " & RngGetCols(rng))
    MsgBox ("First row number = " & RngGetFirstRow(rng) & ". Last row number = " & RngGetLastRow(rng) & ".")
    MsgBox ("First col number = " & RngGetFirstCol(rng) & ". Last col number = " & RngGetLastCol(rng) & ".")
    MsgBox ("First col letter = " & RngGetFirstCol(rng, True) & ". Last col letter = " & RngGetLastCol(rng, True) & ".")
    ' Try to guess the output
    Set rng = RngCurRegion(Range("C23"))  ' assume we know that data contains cell C23
    MsgBox ("Address: " & RngGetAddress(rng))
End Sub
```

The same result can be obtained using the course procedures starting with `RngGetCurRegion`:

```
Sub TM5_CurrentRegionEx2()
    Dim rng As Range

    ThisWorkbook.Worksheets("TM5").Activate
    ' Try to guess the output
    Set rng = Range("D7")  ' assume we know that data contains cell D7
    MsgBox ("Address: " & RngGetCurRegionAddress(rng))
    MsgBox ("Rows = " & RngGetCurRegionRows(rng) & " cols = " & RngGetCurRegionCols(rng))
    MsgBox ("First row number = " & RngGetCurRegionFirstRow(rng) & ". Last row number = " & RngGetCurRegionLastRow(rng) & ".")
    MsgBox ("First col number = " & RngGetCurRegionFirstCol(rng) & ". Last col number = " & RngGetCurRegionLastCol(rng) & ".")
    MsgBox ("First col letter = " & RngGetCurRegionFirstCol(rng, True) & ". Last col letter = " & RngGetCurRegionLastCol(rng, True) & ".")
    
    Set rng = Range("C23")  ' assume we know that data contains cell C23
    MsgBox ("Address: " & RngGetCurRegionAddress(rng))
End Sub
```

Note the difference in how `rng` is defined.

### Input and output

You can read/write and copy/paste values to a range using the course procedures:

```
Sub TM5_RangeEx3()
    Dim rng As Range
    Dim rngNew As Range
    
    Set rng = RngCurRegion(Range("D7"))         ' get current region
    MsgBox ("Copy to H14 (upper left corner).")
    Set rngNew = RngPaste(rng, Range("H14"))    ' rngNew is now the new range
    MsgBox ("Make yellow.")
    Call RngFormat(rngNew, "yellow")
    MsgBox ("Remove format.")
    Call RngClear(rngNew, blnCells:=False, blnFormat:=True)
    MsgBox ("Clear range.")
    Call RngClear(rngNew)
End Sub
```

Here `RngPaste` is used to copy a range and paste it to another range. Note you may use `RngFormat` to format cells of a range.

Moreover, you can read/write values from/to a csv file. A [comma-separated values (csv) file](https://en.wikipedia.org/wiki/Comma-separated_values) is a delimited text file that uses a delimiter to separate values. Each line of the file is a data record. Each record consists of one or more fields, separated by the delimiter. The file format is not fully standardized, i.e. the delimiter may be a semicolon, a colon or another delimiter. Moreover, a field may be surrounded with quotation marks. Let us have a look at a csv file `data1.csv` with a header using a semicolon as delimiter:

```
Year;Brand;Model
1997;Ford;E350
2000;Mercury;Cougar
```

and the csv file `data2.csv` without a header using a semicolon as delimiter:

```
55,18,34,1,81,26,90,11,46,32,93
49,95,73,82,53,40,99,10,52,38,92
59,90,97,100,59,73,88,33,78,61,24
96,84,32,36,94,82,49,94,48,49,1
59,21,24,57,3,78,54,79,57,42,8
```

Let us try to read the two files:

```
Sub TM5_RngFromCSVEx()
    Dim rng As Range
    
    ThisWorkbook.Worksheets("TM5").Activate
    Call TM5_ClearTestTM5    ' clear test cells so have empty cells
    '' Read data1.csv file (NOTE you must know the separator in the csv file beforehand!)
    Range("G3") = "Content of data1.csv:"
    Set rng = RngFromCSV("data1.csv", Range("G4"), ";") ' paste file in range with upper left cell G4
    MsgBox (RngGetAddress(rng))
    '' Read data2.csv file (NOTE you must know the separator in the csv file beforehand!)
    Range("G8") = "Content of data2.csv:"
    Set rng = RngFromCSV("data2.csv", Range("G9"), ",") ' paste file in range with upper left cell G9
    MsgBox (RngGetAddress(rng))
End Sub
```

Here we use the course procedure `RngFromCSV` to read the file and specify the upper left corner cell of where to paste. Note the function returns the pasted range.  

You can write the content of a range to a csv file using:

```
Sub TM5_RngToCSVEx()
    Dim rng As Range
    
    ThisWorkbook.Worksheets("TM5").Activate
    Call TM5_ClearTestTM5    ' clear test cells so have empty cells
    '' Write to csv file
    Set rng = Range("C4:E19")
    Call RngToCSV("test.csv", rng, ";")     ' semicolon (;) separated file
    '' Read test.csv file to check
    Range("G3") = "Content of test.csv:"
    Set rng = RngFromCSV("test.csv", Range("G4"), ";")
End Sub
```

Here we use the course procedure `RngToCSV` to write the range to the file. Note you can specify different delimiters (here we use a semicolon).


### Sorting a range

Ranges can be sorted using the [`.Sort`](https://docs.microsoft.com/en-us/office/vba/api/excel.range.sort) method:

```
Sub TM5_SortRangeEx()
    Dim rng As Range
    Dim rngCur As Range
    
    ThisWorkbook.Worksheets("TM5").Activate
    Call TM5_ClearTestTM5    ' clear test cells so have empty cells
    Set rng = RngCurRegion(Range("C4"))
   
    '' Sort based on second column ascending
    Set rngCur = RngPaste(rng, Range("G4"), withFormat:=True)  ' make a copy to work with
    Call rngCur.Sort(Key1:=rngCur.Columns(2), Header:=xlYes)
    rngCur(1).Offset(-1, 0) = "Sort 2. column"  ' offset first cell in range by -1 row and 0 col

    '' Sort based on second column and afterwards 3. column (descending)
    Set rngCur = RngPaste(rng, Range("K4"), True)
    Call rngCur.Sort(Key1:=rngCur.Columns(2), Header:=xlYes, Key2:=rngCur.Columns(3), Order2:=xlDescending)
    rngCur(1).Offset(-1, 0) = "Sort 2. and next 3. column"
End Sub
```

We use the `Key` arguments to identify which columns we want to sort and the `Header` argument to identify if the first row in the range is a header. Finally the ordering is given using the `Order` argument (either xlAscending (default) or xlDescending).


## Arrays {#vba-ary}

Arrays are used to store groups of variables of a specific datatype: 

```
'' Define an array (run using the debugger - step into)
' How to check the content of an array?
' Use the Locals window together with debug mode or a message box
Sub TM5_ArrayEx1()
   Dim intAry(4) As Integer      ' define array with index 0-4
   Dim strAry(3 To 5) As String  ' define array with index 3-5
   Dim i As Integer
   
   ' Set values
   intAry(0) = 9
   intAry(1) = 12
   intAry(2) = 222
   intAry(3) = 4
   intAry(4) = 100
   ' Information about the array
   MsgBox ("Lowest index: " & LBound(intAry))
   MsgBox ("Largest index: " & UBound(intAry))
   MsgBox ("Number of elements: " & UBound(intAry) - LBound(intAry) + 1)
   MsgBox ("Array as a string: " & AryToStr(intAry))
   ' Read and assign values
    For i = 3 To 5
        strAry(i) = ThisWorkbook.Worksheets("TM5").Cells(23 + i, 3)
    Next
    MsgBox ("Array values: " & AryToStr(strAry))
End Sub
```

Array `intAry` contain 5 elements which can be accessed using index 0, 1, 2, ..., 4. In memory this is done by allocating memory for 5 integers (see Figure \@ref(fig:vba-ary)) with index 0-4. The lower and upper index bounds can be found using `LBound` and `UBound` and we can use the course procedure `AryToStr` to print it. 

<div class="figure" style="text-align: center">
<img src="./img/array.png" alt="An array in memory." width="60%" />
<p class="caption">(\#fig:vba-ary)An array in memory.</p>
</div>

Note the default start index is 0. If you want another start index you can use e.g. `Dim strAry(3 To 5) As String` which use indices 3-5 ($3 = 5-3+1$ elements). Moreover, if you want to start with index 1 as default then add `Option Base 1` to the top of your module.

Arrays require 20 bytes of memory plus 4 bytes for each array dimension plus the number of bytes occupied by the data itself. A Variant containing an array requires 12 bytes more than the array alone.



### Multi-dimensional arrays

<div class="figure" style="text-align: center">
<img src="./img/3d-array.png" alt="Arrays with different dimensions." width="100%" />
<p class="caption">(\#fig:vba-ary-3d)Arrays with different dimensions.</p>
</div>

An array can have different dimensions (see Figure \@ref(fig:vba-ary-3d)) e.g. and array with three dimensions is declared using: 

```
Dim intOrderSize(52, 100, 50) As Integer  
```

where indices may be (week, customer, product) number. Let us assume that index start from 1 then we have an array with $52 \cdot 100 \cdot 50$ elements which can be accessed using e.g.

```
MsgBox(intOrderSize(2, 10, 20))  ' order size week 2, customer 10, product 20 
```

Let us consider an example:

```
Sub TM5_MultiDimArrayEx()
    Dim intA(20, 10) As Integer
    Dim i As Integer, j As Integer
    
    ThisWorkbook.Worksheets("TM5").Activate
    Call TM5_ClearTestTM5    ' clear test cells so have empty cells
    ' Assign some values
    For i = LBound(intA, 1) To UBound(intA, 1)
        For j = LBound(intA, 2) To UBound(intA, 2)
            intA(i, j) = WorksheetFunction.RandBetween(1, 1000)
        Next
    Next
    ' print results from G4
    For i = LBound(intA, 1) To UBound(intA, 1)
        For j = LBound(intA, 2) To UBound(intA, 2)
            Cells(i + 4, j + 7) = intA(i, j)
        Next
    Next
    ' Call AryPaste(intA, Range("G4")) ' same result
End Sub
```

We first assign random values to `intA` in the first loop. Note we use `LBound` and `UBound` to find the range of the indices (the second argument is the dimension we consider). Next, the results are printed to the sheet with upper left equal to G4. Here you may also have used the course procedure `AryPaste` instead.


### Dynamic arrays

Often we do not know the size of the array we need when we start the program. For this we use dynamic arrays:

```
Sub TM5_DynArrayEx()
    Dim ary() As String   ' dynamic array, note use empty ()
    Dim i As Integer
    
    ThisWorkbook.Worksheets("TM5_Test3").Activate
    ReDim ary(2 To 5)  ' create entries a(2) to a(5)
    For i = 2 To 5
        ary(i) = Cells(i + 1, 1)   ' read from Array sheet
    Next
    MsgBox ("Values are: " & AryToStr(ary))
    MsgBox ("The lowest and higest index are " & LBound(ary) & " and " & UBound(ary))
    
    ReDim ary(3 To 5)  ' reallocate array, all values are set to default (empty string)
    MsgBox ("Values are: " & AryToStr(ary))
    For i = 3 To 5
        ary(i) = Cells(i + 1, 1)
    Next
    MsgBox ("Values are: " & AryToStr(ary))
    MsgBox ("The lowest and higest index are " & LBound(ary) & " and " & UBound(ary))
End Sub
```

First, the dynamic array is declared using empty parenthesis `Dim ary() As String`. Next the `ReDim` keyword is used to set the dimension.


### Input and output 

A set of [course procedures](#vba-course-procedures) (module *ModAry*)  have been defined to read/set the values in an array and output the values of an array:

```
Sub TM5_IOAryEx()
    Dim ary() As Integer
    Dim strAry() As String
    
    ThisWorkbook.Worksheets("TM5").Activate
    Call TM5_ClearTestTM5
    '' Set to value single value
    ReDim ary(2)
    Call AryToVal(ary, 5)
    Range("G4") = "A fixed value:"
    Call AryPaste(ary, Range("G5")) ' the upper left cell is G5
    '' Paste vertical
    Range("K4") = "Paste vertical:"
    Call AryPaste(ary, Range("K5"), False)
    '' Set to sequence
    Call AryToSeq(ary, 1, 6)
    Range("G10") = "A sequence:"
    Call AryPaste(ary, Range("G11"))
    '' Read strings from a range
    Call AryRead(strAry, Range("C31:D33"))  ' read a 2D array
    Range("G31") = "Names in the " & AryDim(strAry) & "D array:"
    Call AryPaste(strAry, Range("G32"))
End Sub
```

You set all entries in the array to a single value using `AryToVal` and a sequence using `AryToSeq`. Moreover, use `AryRead` to read the values of a range into an array. Finally, `AryPaste` can be used to paste values of an array to a sheet. You just have to specify the upper left cell where you want to paste.

Procedure `AryRead` can both read values into 1D and 2D arrays:

```
Sub TM5_AryReadEx()
    Dim ary() As Integer

    ThisWorkbook.Worksheets("TM5").Activate
    Call TM5_ClearTestTM5
    '' Read values from a range with only 1 column
    Call AryRead(ary, Range("C5:C9"))
    Range("G4") = AryDim(ary) & "D array:"
    Call AryPaste(ary, Range("G5"), False)
    '' Read values from a range with only 1 row
    Call AryRead(ary, Range("C5:E5"))
    Range("I4") = AryDim(ary) & "D array:"
    Call AryPaste(ary, Range("I5"))
    '' Read values from a range with only 1 column/row but use 2D array
    Call AryRead(ary, Range("C11:C14"), blnReduceDim:=False)
    Range("G10") = AryDim(ary) & "D array:"
    Call AryPaste(ary, Range("G11"), False)
    '' Use other start and end index
    Call AryRead(ary, Range("C17:E19"), intStartIdx1:=2, intStartIdx2:=5)
    Range("G16") = AryDim(ary) & "D array with start index " & LBound(ary, 1) & " and " & LBound(ary, 2) & ":"
    Call AryPaste(ary, Range("G17"))
End Sub
```

First, note that if the optional argument `blnReduceDim` is not set to false the array automatically becomes a 1D array if a range with one row or column is read. Next, you can use another start index of the array (default is 1) by specifying the optional arguments `intStartIdx1` and `intStartIdx2`.

Procedure `AryRead` fails if we want to set values for arrays with more than 2 dimensions. For this the `AryReadLong` can be used which can read arrays until five dimensions:    

```
Sub TM5_AryReadLongEx()
    Dim ary() As Integer
    
    ThisWorkbook.Worksheets("TM5").Activate
    Call TM5_ClearTestTM5
    '' Read 1D array
    Call AryReadLong(ary, Range("A36:B38"), 3)   ' default value = 3
    Range("G35") = "Values in the " & AryDim(ary) & "D array:"
    Call AryPaste(ary, Range("G36"))
    '' Read 2D array
    Call AryReadLong(ary, Range("A41:C47"), 4)   ' default value = 4
    Range("G40") = "Values in the " & AryDim(ary) & "D array:"
    Call AryPaste(ary, Range("G41"))
    '' Read 3D array (cannot be pasted to the sheet, have a look at it using the debugger)
    Call AryReadLong(ary, Range("A50:D56"), 5)   ' default value = 5
End Sub
```

Procedure `AryReadLong` assumes that you specify the values in long format, i.e. there is index values in all columns except the last which contains the values (see Figure \@ref(fig:tm5-arylong)). For instance, if we consider row 54, then the specification says that `ary(1,3,1) = 49`. Note we do not have to specify all combination of indices, e.g. in the specification A41:C47 the index (2,4) is missing and set to the default value 4. It is assumed that indices start from the lowest to highest index in each dimension.

<div class="figure" style="text-align: center">
<img src="./img/tm5-arylong.png" alt="Reading values to an array using a long format (TM5 worksheet)." width="800px" />
<p class="caption">(\#fig:tm5-arylong)Reading values to an array using a long format (TM5 worksheet).</p>
</div>

You can also read a csv file into an array. Let us have a look at a csv file `data2.csv` using a semicolon as delimiter:

```
55,18,34,1,81,26,90,11,46,32,93
49,95,73,82,53,40,99,10,52,38,92
59,90,97,100,59,73,88,33,78,61,24
96,84,32,36,94,82,49,94,48,49,1
59,21,24,57,3,78,54,79,57,42,8
```

You can read the values into an array using `AryFromCSV`:

```
Sub TM5_AryReadCSVEx()
    Dim rng As Range
    Dim ary() As Integer
    
    ThisWorkbook.Worksheets("TM5").Activate
    Call TM5_ClearTestTM5
    '' Read csv file (NOTE you must know the separator in the csv file beforehand!)
    Range("G3") = "Array values:"
    Call AryFromCSV(ary, "data2.csv", ",")   ' know that it contains integers (otherwise use variant)
    Call AryPaste(ary, Range("G4"))
End Sub
```

### Sorting arrays

Arrays can be sorted using `AryQuickSort`:

```
Sub TM5_ArySortEx()
    Dim ary() As Integer
    
    ThisWorkbook.Worksheets("TM5").Activate
    Call TM5_ClearTestTM5
    
    '' Read from a range and sort
    Call AryRead(ary, Range("C5:E19"))
    Call AryQuickSort(ary, 2)
    Range("G3") = "Sort w.r.t. 2. column:"
    Call RngPaste(Range("C4:E4"), Range("G4"))  ' copy header
    Call AryPaste(ary, Range("G5"))
End Sub
```

Here we sort based on the 2. column in the array.


### Use arrays instead of ranges

Since a range represent a block of cells in a sheet, one may think of a range a some kind of 1D or 2D array. Hence one may use a range directly to read/write values instead of an array (we did that in Section \@ref(vba-test-persons)). However, often arrays are better to use than ranges:

   * You can set indices as you like so they give a meaning to you, e.g. `intOrderSize(2, 10, 20)` denote the order size of product 20, in week 2 for customer 10.
   * Arrays are much faster to update than ranges, More specific, it is much faster to update the values many times in an array compared to a range.
   * You worksheet and ranges may be seen as a place where you keep your data. Hence, when you run an algorithm, you first read the data into some arrays. Next, do some calculations (update the arrays) and finally output the result to a worksheet again. 

Consider for example the distance matrix calculations in Section \@ref(vba-ex-dist-mat). Here it would be faster to store the distance matrix in a 2D array:

```
Sub TM5_MakeDistArray()
    Dim n As Integer
    Dim aryDist() As Double
    Dim i As Integer
    Dim j As Integer
    
    ThisWorkbook.Worksheets("TM3_DistanceMatrix").Activate
    n = Range("E1")
    ReDim aryDist(1 To n, 1 To n)
    For i = 1 To n
        For j = i + 1 To n
           aryDist(i, j) = TM3_Distance(Cells(i + 1, 2), Cells(i + 1, 3), Cells(j + 1, 2), Cells(j + 1, 3))
           aryDist(j, i) = aryDist(i, j)  ' set symetric value
        Next
    Next
End Sub
```

Afterwards `aryDist` can be used during in an algorithm. 


## Collections {#vba-coll}

Collections are a way of storing a group of items together (think of it as a set). Collections and arrays are both used to group variables. They both store a set of items e.g. a list of student marks or country names. If we compare collections against arrays:

- Collections are similar to arrays but better to use when the number of items is not fixed. With an array you normally set the size once. On the contrary you often add or remove items from a collection.
- Collections are better when adding and removing items.
- An item in a collection are read-only whereas an entry in an array are read/write.
- Collection can be accessed using a key or an index (starting from 1).
- Items of a collection do not have to share the same data type.

Collections are a part of the predefined objects in VBA and hence a collection have to be defined in a special way. Let us consider an example:

```
Sub TM5_ColEx()
    Dim col As New Collection   ' declare and create
    Dim e As Variant
    
    ThisWorkbook.Worksheets("TM5").Activate
    Call TM5_ClearTestTM5
    '' Add items
    Call col.Add("Apple")
    Call col.Add("Pear")
    Call col.Add(123)
    Cells(4, 7) = "The collection now contains " & col.Count & " items: " & Col2Str(col)
    '' Use For Each to scan elements
    For Each e In col
      MsgBox (e)
    Next e
    '' Access values in the collection using index
    Cells(5, 7) = "The 1. item is: " & col(1)
    Cells(6, 7) = "The 3. item is: " & col(3)
    ' Remove items
    Call col.Remove(2)
    Cells(7, 7) = "The collection now contains " & col.Count & " items: " & Col2Str(col)
    '' Note index of items has now changed (the 3. item has become the 2. item)
    Cells(8, 7) = "The 1. item is: " & col(1)
    Cells(9, 7) = "The 2. item is: " & col(2)
    '' Clear collection
    Set col = Nothing
    Cells(10, 7) = "The collection now contains " & col.Count & " items."
End Sub
```

First we declare and create a collection:
```
Dim col As New Collection
```
The collection (or set) is now defined with zero items. You can add items using
```
Call col.Add("Apple")
Call col.Add("Pear")
Call col.Add(123)
```
Let us create a function that prints the items of a collection as string:
```
Function Col2Str(col As Collection, Optional strSep As String = ", ") As String
    Dim e As Variant
    Dim str As String
    
    For Each e In col
        str = str & e & strSep
    Next e
    Col2Str = Left(str, Len(str) - Len(strSep))
End Function
```
Then the output of 
```
"The collection now contains " & col.Count & " items: " & Col2Str(col)
```
becomes
```
The collection now contains 3 items: Apple, Pear, 123
```
You can access values in the collection using index:
```
"The 1. item is: " & col(1)
"The 3. item is: " & col(3)
```
```
The 1. item is: Apple
The 3. item is: 123
```
Items are removed using:
```
Call col.Remove (2)
"The collection now contains " & col.Count & " items: " & Col2Str(col)
```

```
The collection now contains 2 items: Apple, 123
```

Note index of items has now changed (the 3. item has become the 2. item):
```
"The 1. item is: " & col(1)
"The 2. item is: " & col(2)
```

```
The 1. item is: Apple
The 2. item is: 123
```

You clear a collection using:
```
Set col = Nothing
"The collection now contains " & col.Count & " items."
```

```
The collection now contains 0 items.
```

An item in a collection can be given a key (think af a key as a name tag given to each item):

```
Sub TM5_ColKeyEx()
    Dim col As New Collection   ' declare and create
    Dim k As Variant
    
    ThisWorkbook.Worksheets("TM5").Activate
    '' Add using keys
    Call col.Add("Hans Jørgensen", "ID123")   ' value, key
    Call col.Add("Jens Hansen", "ID234")
    Call col.Add("Lone Nielsen", "ID456")
    ' col.Add "Sine Mikkelsen", "ID456" ' gives an error since already used the key
    Cells(12, 7) = "The collection now contains " & col.Count & " items: " & Col2Str(col)
    '' Access values using keys
    Cells(13, 7) = "The item with key ID123 is: " & col("ID123")
    ' Remove items using keys
    col.Remove "ID123"
    Cells(14, 7) = "The collection now contains " & col.Count & " items: " & Col2Str(col)
End Sub
```

Here we add items using a key:

```
Call col.Add("Hans Jørgensen", "ID123")   ' value, key
Call col.Add("Jens Hansen", "ID234")
Call col.Add("Lone Nielsen", "ID456")
"The collection now contains " & col.Count & " items: " & Col2Str(col)
```

```
The collection now contains 3 items: Hans Jørgensen, Jens Hansen, Lone Nielsen
```
You can now access the item using the key:
```
"The item with key ID123 is: " & col("ID123")
```

```
The item with key ID123 is: Hans Jørgensen
```
Similar you can remove an item using a key:
```
Call col.Remove("ID123")
"The collection now contains " & col.Count & " items: " & Col2Str(col)
```

```
The collection now contains 2 items: Jens Hansen, Lone Nielsen
```

It is recommended to use keys since using keys has three advantages:

- If the order changes your code will still access the correct item
- You can directly access the item without reading through the entire collection
- It can make you code more readable

For more information about collections you may have a look at this [webpage](http://excelmacromastery.com/excel-vba-collections/).


## Example - Job sequencing {#vba-ex-job-seq}

Consider $i = 1,...,n$ jobs that has to be done on a machine and let $c_{ij}$ denote the setup cost of switching from job $i$ to job $j$. Moreover, let $c_{0i}$ denote the setup cost of setting up job $i$ when the machine is idle (index 0). Let $s = (0, s_1, \ldots, s_n)$ denote the sequence of jobs and $C$ the total setup costs, e.g. if $s = (0,1,3,2,6,5,4)$, then $C = c_{01} + c_{13} + c_{32} + c_{26} + c_{65} + c_{54}$. Different algorithms for finding a good strategy minimizing the total setup costs exists. A greedy algorithm is:

<div class="box">
**Step 0**: Select the first job as one with minimal idle setup cost.

**Step 1**: Given current job $i$ select the unscheduled with minimal setup cost. 

**Step 2**: If no unscheduled jobs then stop and output the found job sequence else go to Step 1.
</div>

Often a better algorithm is:

<div class="box">
**Step 0**: For each column $j$ find $\bar{c}_j = min(c_{0j},\ldots,c_{j-1,j},c_{j+1,j},\ldots,c_{nj})$ and define relative setup costs $\hat{c}_{ij} = c_{ij}-\bar{c}_{j}$ (the cost is subtracted the minimum value in that column).

**Step 1**: Call the greedy algorithm using costs $\hat{c}_{ij}$.
</div>

Examples on how data could look like can be seen in worksheet *TM5_JobSeq* that contains the setup costs (Figure \@ref(fig:tm5-job-seq)). Columns M-T contain three datasets for which we want to calculate a job sequence.

<div class="figure" style="text-align: center">
<img src="./img/tm5-job-seq.png" alt="Worksheet *TM5_JobSeq*." width="100%" />
<p class="caption">(\#fig:tm5-job-seq)Worksheet *TM5_JobSeq*.</p>
</div>

Let us try to implement the greedy algorithm which takes the cost array `costs` as arguments and output the job sequence and cost:

```
'' Job sequeceing using a cost array
'
' @param costs An array with setup costs
' @param strSeq The job sequence found (returned ByRef).
' @param dblCosts The total setup costs (returned ByRef).
Sub TM5_GreedyAlg(costs() As Double, strSeq As String, dblCosts As Double)
    Dim intJobs As Integer          ' number of jobs
    Dim used() As Integer           ' an entry equals 1 if already scheduled
    Dim intCurJob As Integer        ' current job
    Dim intNextJob As Integer       ' best candidate for next job (= intM if not found yet)
    Dim dblNextCost As Double       ' setup cost current to next job
    Dim c As Integer                ' iterators
    Dim intM As Integer             ' big number

    '' Allocate arrays
    intJobs = UBound(costs, 1)
    ReDim used(1 To intJobs)    ' set size
    Call AryToVal(used, 0)      ' set to 0
    
    '' Run greedy
    strSeq = "0"  ' start idle
    intM = 1000   ' a number bigger than largest cost
    intCurJob = 0  ' start idle
    dblCosts = 0
    Do While True ' find next job given current
        intNextJob = intM
        dblNextCost = intM
        For c = 1 To intJobs ' scan row in array to find next unused job with minimal cost
            If used(c) <> 1 And costs(intCurJob, c) < dblNextCost Then
                intNextJob = c
                dblNextCost = costs(intCurJob, c)
            End If
        Next
        If intNextJob = intM Then Exit Do  ' no new job found (all jobs used)
        dblCosts = dblCosts + dblNextCost
        used(intNextJob) = 1
        intCurJob = intNextJob
        strSeq = strSeq & ", " & intNextJob
    Loop
End Sub
```

First observe that the procedure have three arguments `costs`, `strSeq` and `dblCosts`. The array `costs` contain the setup costs and is an input argument to the algorithm. The last two arguments are output arguments. Since arguments are passed by reference by default (no new memory is allocated), we modify them with the solution. Next, to run the algorithm we need to keep track of which jobs have been used. We use the array `used` for this and set it to 0 (not used) and 1 (used). Finally, the `Do While` loop is used to scan a row in the cost array. We want to find the minimum cost and hence use a big number as starting value, then scan all unused jobs and choose the one with minimum cost. If no new job is found we finish; otherwise we update `strSeq` and `dblCosts`.

Note that the procedure do not have any interaction with a worksheet. It simply takes an array as input argument and store the result in two output arguments. That is, the procedure is independent of where the data is from (could e.g. be an csv file instead of a worksheet).

Let us try to link the greedy algorithm to the data in workheet *TM5_JobSeq*. Columns M-T contain three datasets for which we want to calculate a job sequence. First, let us make a procedure that copies a dataset to A4 (upper left cell):

```
Sub TM5_CopyData()
   Dim str As String
   
   ThisWorkbook.Worksheets("TM5_JobSeq").Activate   ' so use the correct sheet
   str = InputBox("Specify cell in data (e.g. N7)") ' get a cell value
   Call TM5_CleanJobSeq                             ' delete previous data
   Call RngPaste(RngCurRegion(Range(str)), Range("A4"), withFormat:=True) ' paste the current region
End Sub
```

Note we use the current region of the cell value to retrieve the dataset. We can now run the greedy algorithm using the data starting in A4:

```
Sub TM5_RunGreedy()
    Dim costs() As Double  ' setup costs
    Dim strSeq As String   ' job seq
    Dim dblCosts As Double ' total setup costs
    Dim rng As Range

    ThisWorkbook.Worksheets("TM5_JobSeq").Activate
    ' Allocate costs to array
    Set rng = RngCurRegion(Range("A4")) ' rng now is the whole dataset with headers
    Set rng = Range("B5:" & RngGetLastCol(rng, asLetter:=True) & RngGetLastRow(rng)) ' rng now is the costs
    Call AryRead(costs, rng, 0, 1) ' start index from 0 (first dim) and 1 (second dim)
    ' Run algorithm
    Call TM5_GreedyAlg(costs, strSeq, dblCosts)
    ' Write results to sheet
    Range("C1") = UBound(costs, 1)
    Range("C2") = strSeq
    Range("F1") = dblCosts
End Sub
```

First, observe how we allocate values to the 'costs' array. We use the course procedure `AryRead` and hence first have to find the range containing the setup costs. This can be done may ways, but we know that the upper left cell is B5 and the lower right is found using the `RngGet` functions. Next, we call `AryRead` and set the index to start from 0 (first dimension) and 1 (second dimension). Given setup costs, we call the greedy algorithm which returns updated `strSeq` and `dblCosts`. Finally, we output the results to the worksheet. 

To implement the 'better' algorithm we need to modify the `costs` array and subtract the minimum column value:

```
Sub TM5_RunBetter()
    Dim minCol() As Double ' min value in col c
    Dim intJobs As Integer ' number of jobs
    Dim costs() As Double  ' setup costs
    Dim strSeq As String   ' job seq
    Dim dblCosts As Double ' total setup costs
    Dim rng As Range
    Dim dbl As Double
    Dim r As Integer, c As Integer
    
    ThisWorkbook.Worksheets("TM5_JobSeq").Activate
    ' Allocate costs to array
    Set rng = RngCurRegion(Range("A4")) ' rng now is the whole dataset with headers
    Set rng = Range("B5:" & RngGetLastCol(rng, asLetter:=True) & RngGetLastRow(rng)) ' rng now is the costs
    Call AryRead(costs, rng, 0, 1) ' start index from 0 (first dim) and 1 (second dim)
    ' Calc min value in each col
    intJobs = UBound(costs, 1)
    ReDim minCol(1 To intJobs)
    For c = 1 To intJobs
        dbl = 10000000   ' a big number
        For r = 0 To intJobs
            If costs(r, c) < dbl And r <> c Then dbl = costs(r, c)
        Next
        minCol(c) = dbl
    Next
    ' Calc relative
    For c = 1 To intJobs
        For r = 0 To intJobs
            costs(r, c) = costs(r, c) - minCol(c)
        Next
    Next
    ' Run algorithm
    Call TM5_GreedyAlg(costs, strSeq, dblCosts)
    ' Write results to sheet
    Range("C1") = intJobs
    Range("C2") = strSeq
    Range("F1") = dblCosts + WorksheetFunction.Sum(minCol)
End Sub
```

First, an array `minCol` is used to store the minimum values for each column. Next, we update the `costs` array with the relative values and the greedy algorithm is run with the relative setup cost values. Finally, we output the results. Note we have to add the minimum costs back to `dblCosts` (the sum of the `minCol` values). 


## Recap

- Variables are used to store information that is saved in memory. A variable may store different data types such an integer, a double, a group of doubles (an array), a range of cells in a worksheet (a range object) or a set of numbers (a collection). 

- Strings are special variables with varying length.

- Use the `&` to concatenate strings (glue strings together).

- An empty string is of length zero.

- VBA have a lot of predefined objects you can use. Think of an object as a datatype that holds a group of variables. Examples of some objects are `Range`, `Worksheet`, and `WorksheetFunction`. 

- Refer to an object by specifying the path in the hierarchy e.g. 
  ```
  Workbooks("Jobs.xlsm").Worksheets("Data values").Range("D4").value
  ```
  You may skip parts of the path (VBA then uses the current active one).
- Warning, you must know which sheet is active. Always specify what you want to be active	
  ```
  ThisWorkbook.Worksheets("Data values").Activate  ' activate the sheet
  dbl = Range("D4")
  ```
- Declare object variables using:
  ```
  Dim rng As Range
  Dim wst As Worksheet
  ```
- Set a reference to object variables using the keyword `Set`:
  ```
  Set rng = Range("F7")
  Set wst = Worksheets("Data values")
  ```
- A `Worksheet` object refer to a worksheet and you can use it to e.g. modify cells:
  ```
  Worksheets("TM5_Test1").Range("B2") = "Testing Worksheet"  ' write to cell in sheet TM5_Test1
  Set wst1 = ThisWorkbook.Worksheets("TM5_Test1")  ' set a reference to a worksheet
  wst1.Range("B6") = "Writing using wst1"
  ```
- Different functions for worksheets is part of the *[course procedures](#vba-course-procedures)*. All the worksheet procedures start with `Wst` so you easy can find them using auto complete in the VBA editor. All worksheet procedures are stored in the `ModWst` module. You may open the module to have a look at the procedures. Examples:
  ```
  If WstCreate("Test", blnForce:=True) Then MsgBox ("Created Test")  
  If WstRename("Test", "Test1") Then MsgBox ("Renamed the Test to Test1")  ' only work if no Test1 sheet
  If WstClear("Test8") Then MsgBox ("Cleared Test8") ' clear sheet Test8 if exists
  If WstDelete("Test1") Then MsgBox ("Deleted Test1")
  ```

- Ranges are objects that refer to parts of a worksheet e.g. a cell, a row, a column, or a rectangular selection of cells. 

- Ranges can be used to read and write to cells
  ```
  Dim rng As Range
  Set rng = Range("A1:D5")
  rng = 145   ' cell value
  MsgBox rng.Address   ' range address ($A$1:$D$5)
  ```

- You can use the [course procedures](#vba-course-procedures) (module *ModRng*) with prefix `RngGet` to retrieve info about the range: 
  ```
  Set rng = ThisWorkbook.Worksheets("TM5").Range("C4:E19")
  MsgBox ("Number of rows: " & RngGetRows(rng))
  MsgBox ("Number of cols: " & RngGetCols(rng))
  MsgBox ("First column number: " & RngGetFirstCol(rng))
  MsgBox ("First column letter: " & RngGetFirstCol(rng, asLetter:=True))
  MsgBox ("Lower right cell: " & RngGetLowerRight(rng, asString:=True))
  MsgBox ("Upper right cell: " & RngGetUpperRight(rng, asString:=True))
  ```
  
- The current region of a range is found by expanding the range until all cells surrounding the range is empty
  ```
  rng = Range("D23").CurrentRegion
  ```
  This is useful if don't know the size for data.

- You can use the [course procedures](#vba-course-procedures) (module *ModRng*) with prefix `RngGetCurRegion` to retrieve info about the current region of a range: 
  ```
  Set rng = Range("D7")  ' assume we know that data contains cell D7
  MsgBox ("Address: " & RngGetCurRegionAddress(rng))
  MsgBox ("Rows = " & RngGetCurRegionRows(rng) & " cols = " & RngGetCurRegionCols(rng))
  MsgBox ("First row number = " & RngGetCurRegionFirstRow(rng) & ". Last row number = " & RngGetCurRegionLastRow(rng) & ".")
  MsgBox ("First col number = " & RngGetCurRegionFirstCol(rng) & ". Last col number = " & RngGetCurRegionLastCol(rng) & ".")
  MsgBox ("First col letter = " & RngGetCurRegionFirstCol(rng, True) & ". Last col letter = " & RngGetCurRegionLastCol(rng, True) & ".")
  ```
  
- You copy/paste a range using:
  ```
  Set rng = Range("D7:E10")      
  Set rngNew = RngPaste(rng, Range("H14"))    ' paste with upper left = H14, rngNew is now the new range
  ```
- You can read values from a csv file using:
  ```
  Set rng = RngFromCSV("data1.csv", Range("G4"), ";") ' paste file in range with upper left cell G4
  ```
- You can write values from a range to a csv file using:
  ```
  Call RngToCSV("test.csv", rng, ";")     ' semicolon (;) separated file
  ```
  
- The columns in a range can be [sorted](https://docs.microsoft.com/en-us/office/vba/api/excel.range.sort). For instance sort a range ascending with respect to the second column and next descending with respect to the first column.
  ```
  Call rng.Sort(Key1:=rng.Columns(2), Order1:=xlAscending, _
           Key2:=rng.Columns(1), Order2:=xlDescending, Header:=xlYes)
  ```

- An array store groups of variables of a specific data type. For example
  ```
  Dim intValues(8) As Integer
  ```
  The variable `intValues` is an array with 9 elements which can be accessed using index 0, 1, 2, ..., 8. 

- The default start index of an array is 0. If you want to start with index 1 then add `Option Base 1` to the top of your module or use:
  ```
  Dim strAry(3 To 5) As String  ' define array with index 3-5
  ```
  
- An array can have different dimensions, e.g. three:
  ```
  Dim intOrderSize(52, 100, 50) As Integer  
  ```
  where indices may be (week, customer, product) number. Let us assume that index start from 1 then we have an array with $52 \cdot 100 \cdot 50$ elements which can be accessed using e.g.
  
  ```
  intOrderSize(2,10, 20)  ' order size week 2, customer 10, product 20 
  ```

- Arrays require 20 bytes of memory plus 4 bytes for each array dimension plus the number of bytes occupied by the data itself. A Variant containing an array requires 12 bytes more than the array alone.

- Dynamic arrays are arrays where the dimension is unknown when they are declared. Use `ReDim` to set the dimension later:
  ```
  Dim strPeople() As String
  ...
  n = 8
  ReDim strPeople(n)
  ```

- You can set values for an array by reading from a range:
  ```
  Dim ary() As Integer
  Call AryRead(ary, Range("C5:E9"))
  ```

- You can paste values of an array to a range:
  ```
  Call AryPaste(ary, Range("G5")) ' the upper left cell is G5
  ```

- You can set values for an array with more than 2 dimensions by reading from a range:
  ```
  Dim ary() As Integer
  Call AryReadLong(ary, Range("A36:B38"), 3)   ' default value = 3
  ```
  The procedure `AryReadLong` assumes that you specify the values in long format, i.e. there is index values in all columns except the last which contains the values. 

- You can read a csv file into an array using:
  ```
  Dim ary() As Integer
  Call AryFromCSV(ary, "data2.csv", ",")   ' know that it contains integers (otherwise use variant)
  ```

- Arrays can be sorted using:
  ```
  Dim ary() As Integer
  Call AryQuickSort(ary, 2) ' sort w.r.t. 2. column
  ```
- Often arrays are better to use than ranges:
  * You can set indices as you like so they give a meaning to you, e.g. `intOrderSize(2, 10, 20)` denote the order size of product 20, in week 2 for customer 10.
  * Arrays are much faster to update that ranges. It is much faster to  update the values many times in an array compared to a range.
  * You worksheet and ranges may be seen as a place where you keep your data. Hence, when you run an algorithm, you first read the data into some arrays. Next, do some calculations (update the arrays) and finally output the result to a worksheet again. 

- Collections are used for storing a group of items together (think of it as a set). 

- Collections and arrays are both used to group variables. If we compare collections against arrays:
  - Collections are similar to arrays but better to use when the number of items is not fixed. With an array you normally set the size once. On the contrary you often add or remove items from a collection.
  - Collections are better when adding and removing items.
  - An item in a collection are read-only whereas an entry in an array are read/write.
  - Collection can be accessed using a key or an index (starting from 1).
  - Items of a collection do not have to share the same data type.

- Declare and create a collection:
  ```
  Dim col As New Collection
  ```
 
- Add items using:
  ```
  Call col.Add("Apple")
  Call col.Add("Pear")
  ```
  
- Items are removed using:
  ```
  Call col.Remove (2)
  ```

- Clear a collection using:
  ```
  Set col = Nothing
  ```

- An item in a collection can be given a key (think af a key as a name tag given to each item):
  ```
  Call col.Add("Hans Jørgensen", "ID123")   ' value, key
  Call col.Add("Jens Hansen", "ID234")
  ```

- You can now access the item using the key:
  ```
  "The item with key ID123 is: " & col("ID123")
  ```

- You can remove an item using a key:
  ```
  Call col.Remove("ID123")
  ```

- It is recommended to use keys since using keys has three advantages:
  - If the order changes your code will still access the correct item
  - You can directly access the item without reading through the entire collection
  - It can make you code more readable


```{=html}
<div>
You may also have a look at the
<a href="https://bss-osca.github.io/tfa/slides/05_vba-datatypes-slides.html" target="_blank">slides for this module</a>
.
</div>
```


## Exercises {#ex-vba-datatypes}

Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the [help page](#help). Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution!


```{=html}
<div>
A template with VBA code for this module is given in the file
<a href="https://github.com/bss-osca/tfa/blob/master/vba/05-vba-datatypes-template.xlsm" target="_blank">05-vba-datatypes-template.xlsm</a>
(open it and use it while reading the notes). Have a look inside the module
<i>TM5_ex</i>
in the VBA editor for examples used in the notes and during lectures. Have a look at module
<i>TM5_exercises</i>
for exercises. The template file for next teaching module will contain guiding answers for the exercises to this teaching module.
</div>
```

### Exercise - Equal entries {#ex-vba-equal}

*This exercise is a slightly modified version an exam assignment (exam 2021-A4).*

Consider worksheet *TM5_Equal* with seven data sets. Each data set consists of a list of integer values and is contained in a single column. Your code should be able to run on any of these data sets, but only on one data set at a time. 

The value in cell C1 states the column to use, so you can change the data set by changing this value (the values can be 1, 3, 5, ...). The data sets vary in size. If you need to know the number of values in the data set, it should be done as part of your vba code.

Write a sub *TM5_Equal* that 

   - stores the values of the data set indicated in cell C1 in an array;
   - creates an array `equal`, where `equal(k,j)` is 1, if the k’th and j’th values are equal, and 0 otherwise.


### Exercise - Product search {#ex-vba-search-products}

Consider the worksheet *TM5_Products* containing a set of products with product code and price. 

   (1) Create a sub `TM5_FindProduct` that 
       * Declare two arrays to store the price and product code.
       * Assign values to the arrays.
       * Use an input box to ask for a product code.
       * Use a for loop to search for the product and output the price in a message box. Hint: the [`Exit sub`](https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/exit-statement) may be useful.
   (3) Add a button to the worksheet that run the procedure.
   (2) Test you code using different product codes.
   (4) What happens if you write the product code without capital letters? If your code do not work, have a look at the [`UCase`](https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/ucase-function) function.
   (5) Modify your code so that if the product is not found then "Product not found!" is given in a message box. 
   
   
### Exercise - Read collections {#ex-vba-read-collections}

Consider worksheet *TM5_Col* with numbers in column A to be read into a collection. Create a procedure `TM5_ColNoKeys` that:

   (1) Create a collection `col` and add all the numbers.
   (2) Print the collection in a message box (you may use the function `Col2Str` here).
   (3) Create another collection `colC` and add all the items in `col` with value below 5.

Consider worksheet *TM5_Col*  with some ID numbers and prices for a set of products in columns C-D. Create a procedure `TM5_ColKeys` that:

   (1) Create a collection `col` and add all the prices using ID as key.
   (2) Print the price of the product with ID92011 in a message box.
   (3) What happens if you try to print the price of ID92?
   

### Exercise - Read arrays {#ex-vba-read-arrays}

Consider the worksheet *TM5_Array* containing 3 datasets to be read into an array. The first two are in long format and the last in range format. 

Write a procedure `TM5_ReadArrays` that use course procedures `AryRead` and `AryReadLong` to read the values into three arrays. Assume that 

   * For the first dataset is the default array value 10. 
   * For the second dataset is the default array value 5. 
   * For the third dataset index must start from 3 (first dimension) and 5 (second dimension).
   
Use the debugger to inspect if the values have been read correctly into the arrays.


### Exercise - Process numbers {#ex-vba-process}

*This exercise is a slightly modified version an exam assignment (reexam 2022-A5).*

Consider worksheet *TM5_ProcessData*, which contains a set of numbers. 

(1) Create a procedure `TM5_Process` with the following features:
   * Copy the numbers to worksheet *TM5_Process*.
   * Scan all the numbers and remove (clear the cell) all the negative numbers.
   * Highlight all the numbers above 20.
   * Add a button to the worksheet *TM5_Process* that run the procedure. 
   * The procedure should work for other datasets with a different size. You may assume that the data starts in cell A1.
  
(2) Create a procedure `TM5_Stat` with the following features:
   * Scan the numbers and find
      - the sum of all non-negative numbers,
      - the mean of all negative numbers.
   * Use a message box to display the sum and mean calculated.
   * Add a button to the worksheet *TM5_ProcessData* that run the procedure. 
   * The procedure should work for other datasets with a different size. You may assume that the data starts in cell A1.


### Exercise - Search payments {#ex-vba-search-pay}

*This exercise is a slightly modified version an exam assignment (reexam 2022-A6).*

Consider worksheet *TM5_PaymentsData* which contains a table with three columns. The table contains data about payments for clients at a set of dates.

Create a procedure `TM5_SearchPayments` that searches the table with the following features:

  * Read the _payment boolean_ in cell _B1_ (_TRUE_ or _FALSE_) and the _grouping string_ in cell _B2_ (_None_ or _Year_) on worksheet *TM5_Payments*.
  * Only consider payments where cells in the _Payment_ column equals the payment boolean.
  * If the grouping string equals _None_ then count the number of payments for each client. Next, output the results on worksheet *TM5_Payments*. See worksheet *TM5_PaymentsEx1* for an example.
  * If the grouping string equals _Year_ then count the number of payments for each client and year. Next, output the results on worksheet *TM5_Payments*. See worksheet *TM5_PaymentsEx2*_ for an example.
  * Add a button to worksheet *TM5_Payments* that run the procedure. 

The procedure should work for other datasets with different number of rows too. 


### Exercise - Flight search {#ex-vba-flight}

The worksheet *TM5_FlightData* contains a set of flights between different destinations. You task is to create a procedure `TM5_SearchFlights` that can search for matching flights given a set of origins and destinations. 

   (1) Have a look at the results in worksheet *TM5_FlightData*. The origin and destinations to search for are given in columns A and B and the search result in columns D, E and F. 
   (2) Try pressing the **Clear Search** button and see what happens. Have a look at the code in the VBA editor for this sub and get an overview. 
 


<div class="modal fade bs-example-modal-lg" id="V5b6AQDqJss9fxYqcGz8" tabindex="-1" role="dialog" aria-labelledby="V5b6AQDqJss9fxYqcGz8-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="V5b6AQDqJss9fxYqcGz8-title">Hint</h4></div><div class="modal-body">

<p>Set the range you want to read and use AryRead</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#V5b6AQDqJss9fxYqcGz8">Hint</button>
   
   (3) Try to finish the first part of the `TM5_SearchFlights` sub and store the flights in arrays. Use the debugger to check if the values are stored correctly. 


   (4) Try to finish the second part of the `SearchFlights` sub and search for matching origin-destination pairs. Note origins and destinations listed to be searched for are also matching origin-destination pairs if they are not in the same row.
   


       


   

<!-- ### Exercise - `ByRef` {#ex-vba-byref} -->

<!-- The [file](https://github.com/bss-osca/tfa/blob/master/vba/vba-byref-template.xlsm) should be used as a starting point for this exercise.  -->

<!--   (1) Create a procedure `AryToVal` satisfying: -->
<!--       - Arguments are `ByRef ary As Variant, value As Variant`. -->
<!--       - All entries in the array are set to `value`.  -->
<!--       - The procedure work both if the dimension of the array is 1 or 2. You may use `AryDim` to find the dimension. -->

<!--       Test the procedure using the `Main` procedure. -->
<!--   (2) Create a procedure `AryToValByVal` equal to `AryToVal` except that arguments are `ByVal ary As Variant, value As Variant`. Test the procedure using the `Main` procedure. What is the difference? -->
<!--   (3) Create a procedure `AryToSeq` satisfying: -->
<!--       - Arguments are `ByRef ary As Variant, lngFrom As Long, lngTo As Long, Optional lngIdx As Long = 1`. -->
<!--       - Entries in the array is set to values `lngFrom` to `lngTo`. -->
<!--       - Use `ReDim` to resize the array. -->

<!--       Test the procedure using the `Main` procedure. -->
<!--   (4) Create a procedure `AryRead` satisfying: -->
<!--       - Arguments are `ByRef ary As Variant, ByRef rng As Range, Optional intStartIdx1 As Integer = 1, Optional intStartIdx2 As Integer = 1` -->
<!--       - Entries in the range `rng` are stored in the array `ary`.  -->
<!--       - Use `ReDim` to resize the array. -->

<!--       Test the procedure using the `Main` procedure. -->





<!-- ### Exercise - Job sequencing {#ex-vba-job-seq} -->

<!-- The [file](https://github.com/bss-osca/tfa/blob/master/vba/vba-job-sequence-template.xlsm) should be used as a starting point for this exercise.  -->

<!-- Consider $i = 1,...,n$ jobs that has to be done on a machine and let $c_{ij}$ denote the setup cost of switching from job $i$ to job $j$. Moreover, let $c_{0i}$ denote the setup cost of setting up job $i$ when the machine is idle (index 0). Let $s = (0, s_1, \ldots, s_n)$ denote the sequence of jobs and $C$ the total setup costs, e.g. if $s = (0,1,3,2,6,5,4)$, then $C = c_{01} + c_{13} + c_{32} + c_{26} + c_{65} + c_{54}$. Different algorithms for finding a good strategy minimizing the total setup costs exists. A greedy algorithm is: -->

<!-- <div class="box"> -->
<!-- **Step 0**: Select the first job as one with minimal idle setup cost. -->

<!-- **Step 1**: Given current job $i$ select the unscheduled with minimal setup cost.  -->

<!-- **Step 2**: If no unscheduled jobs then stop and output the found job sequence else go to Step 1. -->
<!-- </div> -->

<!-- Often a better algorithm is: -->

<!-- <div class="box"> -->
<!-- **Step 0**: For each column $j$ find $\bar{c}_j = min(c_{0j},\ldots,c_{j-1,j},c_{j+1,j},\ldots,c_{nj})$ and define relative setup costs $\hat{c}_{ij} = c_{ij}-\bar{c}_{j}$ (the cost is subtracted the minimum value in that column). -->

<!-- **Step 1**: Call the greedy algorithm using costs $\hat{c}_{ij}$. -->
<!-- </div> -->

<!-- Consider sheet _Main_ that contains the setup costs for a scheduling problem. -->

<!--    (1) Implement the greedy algorithm in a sub `Greedy` that store the setup costs in an ($n+1 \times n$) 2D array `costs` assuming the setup costs table start in cell A4. Next, call the sub `GreedyAlg(costs)` that takes the costs as input argument. The sub must -->
<!--        - Store the job sequence in an 1D array. -->
<!--        - Output the number of jobs in cell C1, the job sequence in cell C2 and the total setup costs in cell F1. -->
<!--        - Highlight the cells with setup costs used in the sequence. -->

<!--    (2) Implement the better algorithm in a sub `Better` that -->
<!--        - Find and store the minimum setup costs for each column. -->
<!--        - Calculate the relative costs. -->
<!--        - Call the greedy algorithm using the relative costs. -->
<!--        - Correct the total setup costs by adding the minimum costs. -->
<!--    (3) Add three buttons to _Main_ that remove the solution, run greedy and run better. -->
<!--    (4) Try to use different datasets from the sheet _Data_ and paste it into A4 in _Main_. -->



[BSS]: https://bss.au.dk/en/

[course-help]: https://github.com/bss-osca/tfa/issues
[cran]: https://cloud.r-project.org
[cheatsheet-readr]: https://rawgit.com/rstudio/cheatsheets/master/data-import.pdf
[course-welcome-to-the-tidyverse]: https://github.com/rstudio-education/welcome-to-the-tidyverse

[DataCamp]: https://www.datacamp.com/
[datacamp-signup]: https://www.datacamp.com/groups/shared_links/cbaee6c73e7d78549a9e32a900793b2d5491ace1824efc1760a6729735948215
[datacamp-r-intro]: https://learn.datacamp.com/courses/free-introduction-to-r
[datacamp-r-rmarkdown]: https://campus.datacamp.com/courses/reporting-with-rmarkdown
[datacamp-r-communicating]: https://learn.datacamp.com/courses/communicating-with-data-in-the-tidyverse
[datacamp-r-communicating-chap3]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/introduction-to-rmarkdown
[datacamp-r-communicating-chap4]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/customizing-your-rmarkdown-report
[datacamp-r-intermediate]: https://learn.datacamp.com/courses/intermediate-r
[datacamp-r-intermediate-chap1]: https://campus.datacamp.com/courses/intermediate-r/chapter-1-conditionals-and-control-flow
[datacamp-r-intermediate-chap2]: https://campus.datacamp.com/courses/intermediate-r/chapter-2-loops
[datacamp-r-intermediate-chap3]: https://campus.datacamp.com/courses/intermediate-r/chapter-3-functions
[datacamp-r-intermediate-chap4]: https://campus.datacamp.com/courses/intermediate-r/chapter-4-the-apply-family
[datacamp-r-functions]: https://learn.datacamp.com/courses/introduction-to-writing-functions-in-r
[datacamp-r-tidyverse]: https://learn.datacamp.com/courses/introduction-to-the-tidyverse
[datacamp-r-strings]: https://learn.datacamp.com/courses/string-manipulation-with-stringr-in-r
[datacamp-r-dplyr]: https://learn.datacamp.com/courses/data-manipulation-with-dplyr
[datacamp-r-dplyr-bakeoff]: https://learn.datacamp.com/courses/working-with-data-in-the-tidyverse
[datacamp-r-ggplot2-intro]: https://learn.datacamp.com/courses/introduction-to-data-visualization-with-ggplot2
[datacamp-r-ggplot2-intermediate]: https://learn.datacamp.com/courses/intermediate-data-visualization-with-ggplot2
[dplyr-cran]: https://CRAN.R-project.org/package=dplyr
[debug-in-r]: https://rstats.wtf/debugging-r-code.html

[excel-vs-r]: https://www.jessesadler.com/post/excel-vs-r/

[google-form]: https://forms.gle/s39GeDGV9AzAXUo18
[google-grupper]: https://docs.google.com/spreadsheets/d/1DHxthd5AQywAU4Crb3hM9rnog2GqGQYZ2o175SQgn_0/edit?usp=sharing
[GitHub]: https://github.com/
[git-install]: https://git-scm.com/downloads
[github-actions]: https://github.com/features/actions
[github-pages]: https://pages.github.com/

[happy-git]: https://happygitwithr.com
[hg-install-git]: https://happygitwithr.com/install-git.html
[hg-why]: https://happygitwithr.com/big-picture.html#big-picture
[hg-github-reg]: https://happygitwithr.com/github-acct.html#github-acct
[hg-git-install]: https://happygitwithr.com/install-git.html#install-git
[hg-exist-github-first]: https://happygitwithr.com/existing-github-first.html
[hg-exist-github-last]: https://happygitwithr.com/existing-github-last.html
[hg-credential-helper]: https://happygitwithr.com/credential-caching.html
[hypothes.is]: https://web.hypothes.is/

[osca-programme]: https://kandidat.au.dk/en/operationsandsupplychainanalytics/

[Peergrade]: https://peergrade.io
[peergrade-signup]: https://app.peergrade.io/join
[point-and-click]: https://en.wikipedia.org/wiki/Point_and_click
[pkg-bookdown]: https://bookdown.org/yihui/bookdown/
[pkg-openxlsx]: https://ycphs.github.io/openxlsx/index.html
[pkg-ropensci-writexl]: https://docs.ropensci.org/writexl/
[pkg-jsonlite]: https://cran.r-project.org/web/packages/jsonlite/index.html

[R]: https://www.r-project.org
[RStudio]: https://rstudio.com
[rstudio-cloud]: https://rstudio.cloud/spaces/176810/join?access_code=LSGnG2EXTuzSyeYaNXJE77vP33DZUoeMbC0xhfCz
[r-cloud-mod12]: https://rstudio.cloud/spaces/176810/project/2963819
[r-cloud-mod13]: https://rstudio.cloud/spaces/176810/project/3020139
[r-cloud-mod14]: https://rstudio.cloud/spaces/176810/project/3020322
[r-cloud-mod15]: https://rstudio.cloud/spaces/176810/project/3020509
[r-cloud-mod16]: https://rstudio.cloud/spaces/176810/project/3026754
[r-cloud-mod17]: https://rstudio.cloud/spaces/176810/project/3034015
[r-cloud-mod18]: https://rstudio.cloud/spaces/176810/project/3130795
[r-cloud-mod19]: https://rstudio.cloud/spaces/176810/project/3266132
[rstudio-download]: https://rstudio.com/products/rstudio/download/#download
[rstudio-customizing]: https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio
[rstudio-key-shortcuts]: https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts
[rstudio-workbench]: https://www.rstudio.com/wp-content/uploads/2014/04/rstudio-workbench.png
[r-markdown]: https://rmarkdown.rstudio.com/
[ropensci-writexl]: https://docs.ropensci.org/writexl/
[r4ds-pipes]: https://r4ds.had.co.nz/pipes.html
[r4ds-factors]: https://r4ds.had.co.nz/factors.html
[r4ds-strings]: https://r4ds.had.co.nz/strings.html
[r4ds-iteration]: https://r4ds.had.co.nz/iteration.html

[stat-545]: https://stat545.com
[stat-545-functions-part1]: https://stat545.com/functions-part1.html
[stat-545-functions-part2]: https://stat545.com/functions-part2.html
[stat-545-functions-part3]: https://stat545.com/functions-part3.html
[slides-welcome]: https://bss-osca.github.io/tfa/slides/00-tfa_welcome.html
[slides-m1-3]: https://bss-osca.github.io/tfa/slides/01-welcome_r_part.html
[slides-m4-5]: https://bss-osca.github.io/tfa/slides/02-programming.html
[slides-m6-8]: https://bss-osca.github.io/tfa/slides/03-transform.html
[slides-m9]: https://bss-osca.github.io/tfa/slides/04-plot.html
[slides-m83]: https://bss-osca.github.io/tfa/slides/05-joins.html

[tidyverse-main-page]: https://www.tidyverse.org
[tidyverse-packages]: https://www.tidyverse.org/packages/
[tidyverse-core]: https://www.tidyverse.org/packages/#core-tidyverse
[tidyverse-ggplot2]: https://ggplot2.tidyverse.org/
[tidyverse-dplyr]: https://dplyr.tidyverse.org/
[tidyverse-tidyr]: https://tidyr.tidyverse.org/
[tidyverse-readr]: https://readr.tidyverse.org/
[tidyverse-purrr]: https://purrr.tidyverse.org/
[tidyverse-tibble]: https://tibble.tidyverse.org/
[tidyverse-stringr]: https://stringr.tidyverse.org/
[tidyverse-forcats]: https://forcats.tidyverse.org/
[tidyverse-readxl]: https://readxl.tidyverse.org
[tidyverse-googlesheets4]: https://googlesheets4.tidyverse.org/index.html
[tutorial-markdown]: https://commonmark.org/help/tutorial/

[Udemy]: https://www.udemy.com/

[vba-yt-course1]: https://www.youtube.com/playlist?list=PLpOAvcoMay5S_hb2D7iKznLqJ8QG_pde0
[vba-course1-hello]: https://youtu.be/f42OniDWaIo

[vba-yt-course2]: https://www.youtube.com/playlist?list=PL3A6U40JUYCi4njVx59-vaUxYkG0yRO4m
[vba-course2-devel-tab]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-editor]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-project]: https://youtu.be/fp6PTbU7bXo
[vba-course2-devel-properties]: https://youtu.be/ks2QYKAd9Xw
[vba-course2-devel-hello]: https://youtu.be/EQ6tDWBc8G4

[video-install]: https://vimeo.com/415501284
[video-rstudio-intro]: https://vimeo.com/416391353
[video-packages]: https://vimeo.com/416743698
[video-projects]: https://vimeo.com/319318233
[video-r-intro-p1]: https://www.youtube.com/watch?v=vGY5i_J2c-c
[video-r-intro-p2]: https://www.youtube.com/watch?v=w8_XdYI3reU
[video-r-intro-p3]: https://www.youtube.com/watch?v=NuY6jY4qE7I
[video-subsetting]: https://www.youtube.com/watch?v=hWbgqzsQJF0&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10&t=0s
[video-datatypes]: https://www.youtube.com/watch?v=5AQM-yUX9zg&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10
[video-control-structures]: https://www.youtube.com/watch?v=s_h9ruNwI_0
[video-conditional-loops]: https://www.youtube.com/watch?v=2evtsnPaoDg
[video-functions]: https://www.youtube.com/watch?v=ffPeac3BigM
[video-tibble-vs-df]: https://www.youtube.com/watch?v=EBk6PnvE1R4
[video-dplyr]: https://www.youtube.com/watch?v=aywFompr1F4

[wiki-snake-case]: https://en.wikipedia.org/wiki/Snake_case
[wiki-camel-case]: https://en.wikipedia.org/wiki/Camel_case
[wiki-interpreted]: https://en.wikipedia.org/wiki/Interpreted_language
[wiki-literate-programming]: https://en.wikipedia.org/wiki/Literate_programming
[wiki-csv]: https://en.wikipedia.org/wiki/Comma-separated_values
[wiki-json]: https://en.wikipedia.org/wiki/JSON

<script src="//unpkg.com/@highlightjs/cdn-assets@11.5.1/highlight.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/highlightjs-vba/dist/vba.min.js"></script>
<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script> -->
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
  // hljs.initLineNumbersOnLoad({singleLine: true}); 
</script>

<!--chapter:end:05_vba-datatypes.Rmd-->

---
output: html_document
editor_options: 
  chunk_output_type: console
---





# Generating random numbers {#mod-vba-random-numbers}

This module gives a short introduction on how to generate random numbers and using them in a simulation. Simulation studies that you do in Excel may be done easier using VBA toggeather with Excel. For more advanced simulation studies you may use dedicated programs (such as Arena) or Excel plugins (such as \@Risk).


```{=html}
<div>
A template with VBA code for this module is given in the file
<a href="https://github.com/bss-osca/tfa/blob/master/vba/06-vba-random-numbers-template.xlsm" target="_blank">06-vba-random-numbers-template.xlsm</a>
(open it and use it while reading the notes). Have a look inside the module
<i>TM6_ex</i>
in the VBA editor for examples used in the notes and during lectures. Have a look at module
<i>TM6_exercises</i>
for exercises. The template file for next teaching module will contain guiding answers for the exercises to this teaching module.
</div>
```

#### Learning path diagram {-}

Click/hover the nodes to follow links and see details.


```{=html}
<div id="htmlwidget-3c0ed4b3fb19dcf70071" style="width:100%;height:100px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-3c0ed4b3fb19dcf70071">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"💡 Random numbers\", URL = \"#vba-random-numbers\", tooltip = \"Random numbers (interactive)\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"2,1!\"] \n  \"2\" [label = \"💡 Simulation\", URL = \"#vba-simulation\", tooltip = \"Simulation (interactive)\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"5,1!\"] \n  \"3\" [label = \"💻 Exercises\", URL = \"#ex-vba-random-numbers\", tooltip = \"Exercises\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"8,1!\"] \n\"1\"->\"2\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"3\" [color = \"black\", arrowhead = \"vee\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
```

## Learning outcomes {#lo-vba-random-numbers}

By the end of this module, you are expected to be able to:

* Describe what a random number is.
* Generate a random number from a distribution.
* Run a simulation and compare/analyse results.


The learning outcomes relate to the [overall learning goals](#lg-course) number 2-4, 8-14 and 16 of the course.

<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->


## Generating random numbers {#vba-random-numbers}

Often we want to model a system where some of the elements are uncertain. To simulate the system we want to generate some random numbers following different distributions. This can be done using the built-in VBA and Excel functions for most distributions. The [course procedures](#vba-course-procedures) (module *ModRand*) contain a set of procedures for generating random numbers. Let us have a look at how to generate random numbers from a uniform distribution:

```
'' Generate random numbers from an uniform distribution
' @param intSize Random numbers generated
' @param dblMin Minimum number.
' @param dblMax Maximum number.
' @param ary Array to store the values in.
Sub RandGenUniform(intSize As Integer, dblMin As Double, dblMax As Double, ary() As Double)
    Dim i As Integer
    ReDim ary(intSize) As Double
    
    Randomize ' initialize random-number generator
    For i = 1 To intSize
        ary(i) = dblMin + (dblMax - dblMin) * Rnd()
    Next
End Sub
```

First, observe that in the start of the procedure, the `Randomize` procedure is called. `Randomize` initialize the random-number generator and it is always a good idea to call it if you want true random numbers. Next, the `Rnd` function is used to generate random numbers in the interval $[0,1[$, i.e. a continuous uniform distribution. The `Rnd` function is a built-in VBA function. Finally, to generate random numbers between [`dblMin`, `dblMax`[, we use the formula `dblMin + (dblMax - dblMin) * Rnd()`. An array `ary` of `intSize` is used to store the random numbers. Similar you can generate random integers using the `RandBetween` Excel function.

You can generate random numbers from a normal distribution using:

```
'' Generate random numbers from a normal distribution
' @param intSize Random numbers generated
' @param dblMean Mean.
' @param dblSD Standard deviation.
' @param ary Array to store the values in.
Sub RandGenNormal(intSize As Integer, dblMean As Double, dblSD As Double, ary() As Double)
    Dim i As Integer
    ReDim ary(intSize) As Double
    
    Randomize
    For i = 1 To intSize
        ary(i) = Application.WorksheetFunction.NormInv(Rnd, dblMean, dblSD)
    Next
End Sub
```

The procedure takes the mean and standard deviation as arguments and store `intSize` random numbers in the output array `ary`. 

Similar procedures can be found for the uniform, binomial, poisson and a custom discrete distribution. Let us try some examples:

```
Sub TM6_RandDistEx()
    Dim ary() As Double
    Dim aryDens() As Double
    Dim intSize As Integer
    
    ThisWorkbook.Worksheets("TM6").Activate
    Call TM6_ClearTestTM6
    Randomize    ' initialize random-number generator
    intSize = 20 ' generate 20 numbers for each distribution
    ' Normal
    Call RandGenNormal(intSize, 100, 20, ary)
    Range("A1") = "Normal"
    Call AryPaste(ary, Range("A2"), False)
    ' Cont. uniform [10,500[
    Call RandGenUniformCont(intSize, 10, 500, ary)
    Range("B1") = "Uniform"
    Call AryPaste(ary, Range("B2"), False)
    ' Discrete uniform 10,...,500
    Call RandGenUniformDisc(intSize, 10, 500, ary)
    Range("B1") = "Uniform"
    Call AryPaste(ary, Range("B2"), False)
    ' Binomial 100 trials, pr = 0.2
    Call RandGenBinomial(intSize, 100, 0.2, ary)
    Range("C1") = "Binomial"
    Call AryPaste(ary, Range("C2"), False)
    ' Poisson lambda = 5
    Call RandGenPoisson(intSize, 5, ary)
    Range("D1") = "Poisson"
    Call AryPaste(ary, Range("D2"), False)
    ' Custom discrete
    ReDim aryDens(1 To 4, 1 To 2)
    aryDens(1, 1) = 3
    aryDens(2, 1) = 4
    aryDens(3, 1) = 5
    aryDens(4, 1) = 6
    aryDens(1, 2) = 0.1
    aryDens(2, 2) = 0.3
    aryDens(3, 2) = 0.5
    aryDens(4, 2) = 0.1
    Call RandGenDiscrete(intSize, aryDens, ary)
    Range("E1") = "Custom"
    Call AryPaste(ary, Range("E2"), False)
    Range("G3") = "Custom distribution:"
    Range("G4") = "Value"
    Range("H4") = "Prob."
    Call AryPaste(aryDens, Range("G5"))
End Sub
```

We generate 20 random numbers for the different distributions. For generating random numbers from a custom discrete distribution we need a 2D array where each row store the outcome and the probability. For instance here the probability of outcome 5 is 50%. 




## Simulation {#vba-simulation}

Given an uncertain system we simulate the system by:

   1) constructing a deterministic model (that is we assume the random numbers have some specific values) and algorithms for solving it. 
   2) Generate random numbers and use them to solve the model and store the results. 
   3) Repeat a number of times and gather statistics such as min, mean, standard deviation or max value.

Let us consider some examples in the next sections.


### Example - Traveling salesman problem {#sec-vba-tsp}

The [travelling salesman problem](https://en.wikipedia.org/wiki/Travelling_salesman_problem) (TSP) asks the following question: 

> Given a list of cities and the distances between each pair of the cities, 
> what is the shortest possible route that visits each city exactly once 
> and returns to the origin city?

The problem is an NP-hard problem (worst case solution time grows exponential with the number of cities) in combinatorial optimization, important in theoretical computer science and operations research. The problem was first formulated in 1930 and is one of the most intensively studied problems in optimization. Even though the problem is computationally difficult, many heuristics and exact algorithms are known. 

The goal with this example is to test different heuristics on a set of problem instances. To see which one works best.

Let us first create a procedure `TM6_GenTSPData` that generate a TSP instance:

```
'' Generate cities for the TSP (a TSP problem instance)
' @param dblCoord A (cities x 3) array to store the generated id and coordinates in (output ByRef).
' @param intCities Number of cities to generate. If 0 then ask.
' @param blnPrint If true then print out the data in columns A:C in the TM6_TSP sheet.
Sub TM6_GenTSPData(dblCoord() As Double, Optional intCities As Integer = 0, _
                       Optional blnPrint As Boolean = False)
    Dim dblMin As Double
    Dim dblMax As Double
    Dim i As Integer
    Dim ary1() As Double, ary2() As Double
    
    Randomize
    ' Min and max values for uniform distribution
    dblMin = 0
    dblMax = 10
    ' Reallocate
    If intCities = 0 Then intCities = InputBox("How many points should I generate?")
    ReDim dblCoord(1 To intCities, 1 To 3)
    ' Generate random numbers
    Call RandGenUniformCont(intCities, dblMin, dblMax, ary1)
    Call RandGenUniformCont(intCities, dblMin, dblMax, ary2)
    For i = 1 To intCities
        dblCoord(i, 1) = i
        dblCoord(i, 2) = ary1(i)
        dblCoord(i, 3) = ary2(i)
    Next
    '' Print data
    If blnPrint Then
        ThisWorkbook.Worksheets("TM6_TSP").Activate
        Call TM6_ClearTestTSP
        Cells(1, 1).value = "City"
        Cells(1, 2).value = "x-coord"
        Cells(1, 3).value = "y-coord"
        For i = 1 To intCities
            Cells(i + 1, 1).value = dblCoord(i, 1)
            Cells(i + 1, 2).value = dblCoord(i, 2)
            Cells(i + 1, 3).value = dblCoord(i, 3)
        Next
    End If
End Sub
```

Note we specify the number of cities as an input argument. Each city has an id number and a $x$ and $y$-coordinate and the result is stored in array `dblCoord` with `intCities` rows and three columns (column 1 store the city id, column 2 the $x$-coordinate and column 3 the $y$-coordinate). The $x$ and $y$-coordinates are random numbers from an uniform distribution between 0 and 10. If `blnPrint` is true then coordinates are printed to the sheet and if `intCities` is zero then use an input box to ask for the number of cities. 

<div class="figure" style="text-align: center">
<img src="./img/tm6-tsp.png" alt="TSP algorithms and cost (*TM6_TSP* worksheet)." width="600px" />
<p class="caption">(\#fig:tm6-tsp)TSP algorithms and cost (*TM6_TSP* worksheet).</p>
</div>

We now can create a procedure `BtnGenTSPData` that calls `GenTSPData`, ask for the number of cities and print the result to the sheet. A button linking to the procedure is made in worksheet *TM6_TSP* (see Figure \@ref(fig:tm6-tsp)):

```
Sub TM6_BtnGenTSPData()
    Dim dblCoord() As Double
    Call TM6_GenTSPData(dblCoord, 0, True)
End Sub
```

Given the $x$ and $y$-coordinates of a problem instance (stored in `dblCoord`) we need to calculate the distance matrix:

```
'' Calculate distance matrix
' @param dblDist The distance matrix to store distances (output ByRef).
' @param dblCoord A (cities x 3) array with id and coordinates.
' @pre Assume that dblCoord has not been sorted yet!
' @post Distances stored in dblDist.
Sub TM6_CalcDistArray(ByRef dblDist() As Double, dblCoord() As Double)
    Dim i As Integer, j As Integer
    Dim dblDiffX As Double, dblDiffY As Double
    Dim intCities As Integer
    
    intCities = UBound(dblCoord, 1)
    ReDim dblDist(intCities, intCities)
    For i = 1 To intCities
        For j = i + 1 To intCities
            dblDiffX = dblCoord(i, 2) - dblCoord(j, 2)
            dblDiffY = dblCoord(i, 3) - dblCoord(j, 3)
            dblDist(i, j) = Sqr((dblDiffX * dblDiffX) + (dblDiffY * dblDiffY))
            dblDist(j, i) = dblDist(i, j)  ' assume symetric
        Next
    Next
End Sub
```

The procedure takes the $x$ and $y$-coordinates (stored in `dblCoord`) and calculate the distance matrix stored in `dblDist`, i.e. `dblDist(i, j)` store the euclidean distance between city `i` and `j`. Symmetric distances are assumed, i.e. `dblDist(i, j) = dblDist(j, i)`.

We are now ready to consider algorithms for calculating a TSP route. Let us first consider a procedure `TM6_SolveTSPIncX` that sort the array `dblCoord` increasing in the x-coordinate and visit the cities in the order of the sorted array and return to the starting city:

```
'' Calculate visiting sequence based on increasing x-coord
' @param dblCoord A (cities x 3) array with id and coordinates.
' @param dblDist The distance matrix.
' @param dblCost Total cost (output ByRef).
' @param intSeq The visiting sequence (output ByRef).
' @post The total cost and sequence returned.
 Sub TM6_SolveTSPIncX(dblCoord() As Double, dblDist() As Double, _
                      dblCost As Double, intSeq() As Integer)
    Dim j As Integer
    Dim intCities As Integer
    
    ' Sort
    intCities = UBound(dblDist, 1)
    ReDim intSeq(intCities)
    Call AryQuickSort(dblCoord, 2)
    ' Store visiting sequence
    For j = 1 To intCities
        intSeq(j) = dblCoord(j, 1)
    Next
    dblCost = TM6_CalcCost(dblDist, intSeq)
End Sub
```

First, observe that we sort the array using course procedure `ArySort`. Next, the visiting city sequence are stored in `intSeq`. Finally, the total cost are stored in `dblCost` which call the function `TM6_CalcCost`:

```
'' Calculate the cost of a route
' @param dblDist The distance matrix.
' @param intSeq The visiting sequence (output ByRef).
' @return The cost of a route.
Function TM6_CalcCost(dblDist() As Double, intSeq() As Integer) As Double
    Dim dblCost As Double
    Dim intCities As Integer
    Dim j As Integer
    
    intCities = UBound(intSeq)
    dblCost = 0
    For j = 1 To intCities - 1
        dblCost = dblCost + dblDist(intSeq(j), intSeq(j + 1))
    Next
    TM6_CalcCost = dblCost + dblDist(intSeq(intCities), intSeq(1))   ' cost + cost of returning to start
End Function
```

If we want to use the algorithm on the data in sheet *TM6_TSP* we first need a procedure reading the data:

```
'' Read the coordinates into an 2D array
' @param dblCoord A (cities x 3) array to store the generated id and coordinates in.
' @post Generated data stored in dblCoord.
Sub TM6_ReadCoord(dblCoord() As Double)
    Dim rng As Range
    
    ThisWorkbook.Worksheets("TM6_TSP").Activate
    Set rng = RngGetCurRegionRange(Range("A1"), 2) 'current region except the header
    Call AryRead(dblCoord, rng)
End Sub
```

and then a procedure `TM6_BtnSolveTSPIncX` that calls `TM6_SolveTSPIncX` using the TSP data in the sheet and print out the total cost in cell H4. We include a button linking to the procedure (see Figure \@ref(fig:tm6-tsp)):

```
Sub TM6_BtnSolveTSPIncX()
    Dim dblCoord() As Double
    Dim dblDist() As Double
    Dim intSeq() As Integer
    Dim dblCost As Double
    
    Call TM6_ReadCoord(dblCoord)
    Call AryQuickSort(dblCoord, 1)  ' so sure sorted by id
    Call TM6_CalcDistArray(dblDist, dblCoord)
    Call TM6_SolveTSPIncX(dblCoord, dblDist, dblCost, intSeq)
    Range("H3") = "Cost:"
    Range("H5") = dblCost
End Sub
```

Another algorithm `TM6_SolveTSPIncY` that sort the array `dblCoord` increasing in the $y$-coordinate and visit the cities in the order of the sorted array and return to the starting city can be made similar to above (see Figure \@ref(fig:tm6-tsp)). A possibility is also an algorithm that visit the cities in the order of the `dblCoord` array and return to the starting city. This may seen as we visit the cities in random order since we generate the $x$ and $y$-coordinate random.

Finally, we will consider a nearest neighbour algorithm. We start in City 1. Given the current city, the next city (not already visited) is the city with the shortest distance:

```
'' Calculate visiting sequence based on nearest neighbour
' @param dblCoord A (cities x 3) array with id and coordinates.
' @param dblDist The distance matrix.
' @param dblCost Total cost.
' @param intSeq The visiting sequence.
' @post The total cost and sequence returned.
 Sub TM6_SolveTSPNN(dblCoord() As Double, dblDist() As Double, ByRef dblCost As Double, ByRef intSeq() As Integer)
    Dim i As Integer, id As Integer
    Dim intCities As Integer, intCurCity As Integer, intBestCity As Integer
    Dim dblMinDist As Double
    Dim intUsed() As Integer       ' intUsed(id) = 1 if city id have been used in sequence
    
    intCities = UBound(dblDist, 1)
    ReDim intSeq(intCities)
    ReDim intUsed(intCities)
    ' Find nearst neighbor
    id = 1
    intSeq(1) = id  ' start in city id = 1
    intUsed(id) = 1
    For i = 2 To intCities        ' find next city to add to intSeq(i)
        dblMinDist = 1000000      ' large number
        intCurCity = intSeq(i - 1)
        For id = 2 To intCities   ' scan for next candidate (id = 1 already used)
            If intUsed(id) = 0 And dblDist(intCurCity, id) < dblMinDist Then   ' shorter distance found
                intBestCity = id
                dblMinDist = dblDist(intCurCity, id)
            End If
        Next
        intSeq(i) = intBestCity
        intUsed(intBestCity) = 1
    Next
    dblCost = TM6_CalcCost(dblDist, intSeq)
End Sub
```

Here we need to have an array `intUsed` to store if a city already visited (equal 1 if yes). Nested loops is used to scan for the not-visited city nearest to the current one. The results for all the algorithms on an problem instance with 20 cities can be seen in Figure \@ref(fig:tm6-tsp).

We now have a set of algorithms which can be tested on some problem instances that we can generate. On the problem instance we used above the nearest neighbour algorithm seems to find the best route (shortest cost). However, we can not state that this holds in general without testing on many problem instances. Hence we want to do a simulation study with steps:

- Generate a problem instance with `intCities` cities which are chosen random between 10 and 500.
- Calculate the distance matrix.
- Solve the instance using all of the above algorithms.
- Store the result in a row in the *TM6_TSPSim* sheet. 
- Repeat 100 times and calculate min, mean and max values for each solution algorithm.

This is done in procedure `TM6_TSPSim`:

```
Sub TM6_TSPSim()
    Dim intCities As Integer
    Dim s As Integer
    Dim dblCoord() As Double
    Dim dblDist() As Double
    Dim intSeq() As Integer
    Dim dblCost As Double
    Dim intRow As Integer
    
    ' Setup sheet
    ThisWorkbook.Worksheets("TM6_TSPSim").Activate
    Call RngClear(Range("A:F"))
    Cells(1, 1) = "Simulation results"
    Cells(3, 2) = "Min"
    Cells(4, 2) = "Mean"
    Cells(5, 2) = "Max"
    intRow = 7
    Cells(intRow, 1) = "Run"
    Cells(intRow, 2) = "Cities"
    Cells(intRow, 3) = "IncX"
    Cells(intRow, 4) = "IncY"
    Cells(intRow, 5) = "Random"
    Cells(intRow, 6) = "NN"
    ' Run simulation
    For s = 1 To 100
        Cells(s + intRow, 1) = s
        intCities = WorksheetFunction.RandBetween(10, 500) ' number of cities
        Cells(s + intRow, 2) = intCities
        Call TM6_GenTSPData(dblCoord, intCities, False)
        Call TM6_CalcDistArray(dblDist, dblCoord)
        Call TM6_SolveTSPIncX(dblCoord, dblDist, dblCost, intSeq)
        Cells(s + intRow, 3) = dblCost
        Call TM6_SolveTSPIncY(dblCoord, dblDist, dblCost, intSeq)
        Cells(s + intRow, 4) = dblCost
        Call TM6_SolveTSPRand(dblCoord, dblDist, dblCost, intSeq)
        Cells(s + intRow, 5) = dblCost
        Call TM6_SolveTSPNN(dblCoord, dblDist, dblCost, intSeq)
        Cells(s + intRow, 6) = dblCost
    Next
    ' Calc statistics
    For s = 3 To 6
        Cells(3, s) = WorksheetFunction.Min(Range(Cells(intRow + 1, s), Cells(intRow + 100, s)))
        Cells(4, s) = WorksheetFunction.Average(Range(Cells(intRow + 1, s), Cells(intRow + 100, s)))
        Cells(5, s) = WorksheetFunction.Max(Range(Cells(intRow + 1, s), Cells(intRow + 100, s)))
    Next
    ' Format cells
    Call RngFormat(Cells(3, 2).CurrentRegion, "green")
    Call RngFormat(Cells(intRow, 1).CurrentRegion, "orange", True)
End Sub
```

First, we setup the worksheet *TM6_TSPSim* so it is ready for the results. Next, we run the simulation 100 times in a for loop. In each loop we first generate the number of instances, then a problem instance for which we find the distance matrix. The algorithms is then run on the problem instance and results are added to the worksheet. After the loop we calculate statistics for all the runs. Finally, the results are formatted for nice appearance. 

<div class="figure" style="text-align: center">
<img src="./img/tm6-tsp-sim.png" alt="Simulation comparing TSP algorithms (*TM6_TSPSim* worksheet)." width="600px" />
<p class="caption">(\#fig:tm6-tsp-sim)Simulation comparing TSP algorithms (*TM6_TSPSim* worksheet).</p>
</div>
       
The results are given in Figure \@ref(fig:tm6-tsp-sim). As can be seen the nearest naighbour algorith is best and gives the shortest average distance.  




## Recap

- Often we want to model a system where some of the elements are uncertain. To simulate the system we want to generate some random numbers following different distributions. This can be done using the built-in VBA and Excel functions.
- Initialize generation of random numbers using 
  ```
  Randomize()     ' chooses a random seed 
  ```
  Or
  ```
  Randomize(100)     ' generate the same random numbers
  ```
  We normally use the first option.
- When generating random numbers in VBA and writing them to the worksheet, they will NOT be changed when the worksheet is updated! Only when the code is executed!
- Examples on some distributions are
   - Uniform between 0 and 1: `Rnd()`
   - Uniform between i and j:  `i + (j - i) * Rnd`
   - Normal distribution: `WorksheetFunction.NormInv(Rnd, dblMean, dblSD)`
   - Binomial distribution: `WorksheetFunction.Binom_Inv(intTrials, dblPr, Rnd)`
- The [course procedures](#vba-course-procedures) (module *ModRand*) contain a set of procedures for generating random numbers that are stored in an array. 
   
   
- Given an uncertain system we simulate the system by constructing a 
   - Deterministic model (that is we assume the random numbers have some specific values) and algorithms for solving it. 
   - Generate random numbers and used to solve the model and store the results. 
   - Repeat a number of times and calculate statistics such as min, mean and standard deviation.

You may also have a look at the [slides for this module](https://bss-osca.github.io/tfa/slides/03-01_vba-random-numbers-slides.html).


## Exercises {#ex-vba-random-numbers}

Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the [help page](#help). Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution!


```{=html}
<div>
A template with VBA code for this module is given in the file
<a href="https://github.com/bss-osca/tfa/blob/master/vba/06-vba-random-numbers-template.xlsm" target="_blank">06-vba-random-numbers-template.xlsm</a>
(open it and use it while reading the notes). Have a look inside the module
<i>TM6_ex</i>
in the VBA editor for examples used in the notes and during lectures. Have a look at module
<i>TM6_exercises</i>
for exercises. The template file for next teaching module will contain guiding answers for the exercises to this teaching module.
</div>
```


### Exercise - Two random integers {#ex-vba-random-int}

*This exercise is a slightly modified version an exam assignment (reexam 2021-A4).*

Consider worksheet *TM6*.

   (1) Write a sub `TM6_RandInt1` that reads two integer numbers, $a$ and $b$ (assume that $a < b$) from cells B24 and B25, and generates two random integer numbers, $r_1$ and $r_2$, uniformly between $a$ and $b$ such that $r_1 \neq r_2$. The sub should write $r_1$ and $r_2$ in cells D24 and D25 with the smaller of the two numbers in D24.

   (2) Write a sub `TM6_RandInt2` that should take two integer arguments, $a$ and $b$, and generate two random numbers $r_1$ and $r_2$ following the same rules as in Question 1. However, $r_1$ and $r_2$ may not be written to the spreadsheet. Instead, they should be given as output to the sub calling `TM6_RandInt2`. 
   
   (3) Write a sub `TM6_RandInt2Main` that call `TM6_RandInt2` using $a=2$ and $b=17$ and output $r_1$ and $r_2$ in a message box.
   
   (4) Is your code robust? What happens if $a=b$?
   
   
### Exercise - Swap entries {#ex-vba-swap}

*This exercise is a slightly modified version an exam assignment (reexam 2021-A5).*

Consider worksheet *TM6_Swap* which contains a list of names (from A4) and two numbers between 1 and 20 (in B1 and B2). You may assume that the number in B2 is strictly larger than the one in B1. In the following, let $r_1$ and $r_2$ represent these two numbers. Sometimes, we need to change the order of the items in such lists, and in this assignment, you will be asked to do that in three different ways. 

   (1) Write a sub `TM6_Swap1` that, given values of $r_1$ and $r_2$ (to be read from B1 and B2), swaps the $r_1$‘th and the $r_2$’th name in the list. Print the result in column D.
   
   (2) Write a sub `TM6_Swap2` that, given values of $r_1$ and $r_2$ (to be read from B1 and B2), reverses the sequence from the $r_1$‘th to the $r_2$’th name in the list. Print the result in column E.
  
   (3) Write a sub `TM6_Swap3` that changes the order of the names so they appear in random order. Print the result in column F. 

Figure \@ref(fig:exc-swap) gives an example on the swap operations.

<div class="figure" style="text-align: center">
<img src="./img/exc-swap.png" alt="Swap entries (*TM6_Swap* worksheet)." width="500px" />
<p class="caption">(\#fig:exc-swap)Swap entries (*TM6_Swap* worksheet).</p>
</div>

  
### Exercise - Dan's bakery {#ex-vba-bakery}

Dan owns a small bakery baking a single cold-rised bread. The demand level $l$ for bread is uncertain and on a given day the demand level equals $l=1$ (low) with probability 0.2, $l=2$ (medium) with probability 0.5 and $l=3$ (high) with probability 0.3. The actual demand (number of customers) depends on the demand level and is Poisson distributed with mean $50 + 60l$. 

Currently, the sales price per bread is 45 DKK and production cost 7 DKK. If a customer arrives and Dan has no bread left then he estimates the loss of goodwill to be 10 DKK. 

A customer always buy one bread. Dan can have 20 breads in the oven a time and hence always produce a multiple of 20 breads.

   (1) Create a function `TM6_DanProfit` that returns the daily profit given a specific demand and production. The profit given demand $d$ and production $p$ using the current prices and costs is $$(45-7)\min(d,p) - 7\max(0,p-d) - 10\max(0,d-p).$$ Let the arguments of the function be:
   
       ```
       ' @param dblDemand Demand.
       ' @param dblProd Production.
       ' @param dblPrice Sales price.
       ' @param dblCost Production costs.
       ' @param dblGW Lost goodwill cost.
       ```

   (2) Create a procedure `TM6_DanSim` that simulate the system for $y$ days given that Dan choose to produce $x$ breads each day. The procedure arguments are:
   
       ```
       ' @param dblProd Production (x).
       ' @param dblPrice Sales price.
       ' @param dblCost Production costs.
       ' @param dblGW Lost goodwill cost.
       ' @param aryDens Demand level density array (needed for RandGenDiscrete).
       ' @param intDays Days to simulate (y).
       ' @param aryStat Array to store the output statistics (output ByRef).
       ```
   
       The result array `aryProfit` has entries:
       * number of runs (days), 
       * production
       * sales price
       * production cost
       * lost goodwill cost
       * average profit
       * standard deviation
       * min and max profit 
       
   (3) Create a procedure `TM6_DanBtnSim` that calls `TM6_DanSim` for production levels 20, 40, ..., 400 and output the results in worksheet _TM6_DanSim_. The procedure must use the demand level distribution, prices and cost given in the worksheet.
   
   (4) What is the best production level?
   
   (5) What is the best production level if the demand levels changes to low with probability 0.7, medium with probability 0.2 and high with probability 0.1?


### Exercise - Generating random numbers {#ex-vba-generate}

Create a procedure `TM6_GenRandNumb` that generate 5000 random numbers of 

   - A normal distribution with mean 100 and standard deviation 20.
   - An continuous uniform distribution with range 10 to 500.
   - A binomial distribution with 100 trials and a 0.2 probability of success.
   - A poisson distribution with mean 5.
   - Plot the results for each distribution using `TM6_PlotFreq` (given).


  
  

[BSS]: https://bss.au.dk/en/

[course-help]: https://github.com/bss-osca/tfa/issues
[cran]: https://cloud.r-project.org
[cheatsheet-readr]: https://rawgit.com/rstudio/cheatsheets/master/data-import.pdf
[course-welcome-to-the-tidyverse]: https://github.com/rstudio-education/welcome-to-the-tidyverse

[DataCamp]: https://www.datacamp.com/
[datacamp-signup]: https://www.datacamp.com/groups/shared_links/cbaee6c73e7d78549a9e32a900793b2d5491ace1824efc1760a6729735948215
[datacamp-r-intro]: https://learn.datacamp.com/courses/free-introduction-to-r
[datacamp-r-rmarkdown]: https://campus.datacamp.com/courses/reporting-with-rmarkdown
[datacamp-r-communicating]: https://learn.datacamp.com/courses/communicating-with-data-in-the-tidyverse
[datacamp-r-communicating-chap3]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/introduction-to-rmarkdown
[datacamp-r-communicating-chap4]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/customizing-your-rmarkdown-report
[datacamp-r-intermediate]: https://learn.datacamp.com/courses/intermediate-r
[datacamp-r-intermediate-chap1]: https://campus.datacamp.com/courses/intermediate-r/chapter-1-conditionals-and-control-flow
[datacamp-r-intermediate-chap2]: https://campus.datacamp.com/courses/intermediate-r/chapter-2-loops
[datacamp-r-intermediate-chap3]: https://campus.datacamp.com/courses/intermediate-r/chapter-3-functions
[datacamp-r-intermediate-chap4]: https://campus.datacamp.com/courses/intermediate-r/chapter-4-the-apply-family
[datacamp-r-functions]: https://learn.datacamp.com/courses/introduction-to-writing-functions-in-r
[datacamp-r-tidyverse]: https://learn.datacamp.com/courses/introduction-to-the-tidyverse
[datacamp-r-strings]: https://learn.datacamp.com/courses/string-manipulation-with-stringr-in-r
[datacamp-r-dplyr]: https://learn.datacamp.com/courses/data-manipulation-with-dplyr
[datacamp-r-dplyr-bakeoff]: https://learn.datacamp.com/courses/working-with-data-in-the-tidyverse
[datacamp-r-ggplot2-intro]: https://learn.datacamp.com/courses/introduction-to-data-visualization-with-ggplot2
[datacamp-r-ggplot2-intermediate]: https://learn.datacamp.com/courses/intermediate-data-visualization-with-ggplot2
[dplyr-cran]: https://CRAN.R-project.org/package=dplyr
[debug-in-r]: https://rstats.wtf/debugging-r-code.html

[excel-vs-r]: https://www.jessesadler.com/post/excel-vs-r/

[google-form]: https://forms.gle/s39GeDGV9AzAXUo18
[google-grupper]: https://docs.google.com/spreadsheets/d/1DHxthd5AQywAU4Crb3hM9rnog2GqGQYZ2o175SQgn_0/edit?usp=sharing
[GitHub]: https://github.com/
[git-install]: https://git-scm.com/downloads
[github-actions]: https://github.com/features/actions
[github-pages]: https://pages.github.com/

[happy-git]: https://happygitwithr.com
[hg-install-git]: https://happygitwithr.com/install-git.html
[hg-why]: https://happygitwithr.com/big-picture.html#big-picture
[hg-github-reg]: https://happygitwithr.com/github-acct.html#github-acct
[hg-git-install]: https://happygitwithr.com/install-git.html#install-git
[hg-exist-github-first]: https://happygitwithr.com/existing-github-first.html
[hg-exist-github-last]: https://happygitwithr.com/existing-github-last.html
[hg-credential-helper]: https://happygitwithr.com/credential-caching.html
[hypothes.is]: https://web.hypothes.is/

[osca-programme]: https://kandidat.au.dk/en/operationsandsupplychainanalytics/

[Peergrade]: https://peergrade.io
[peergrade-signup]: https://app.peergrade.io/join
[point-and-click]: https://en.wikipedia.org/wiki/Point_and_click
[pkg-bookdown]: https://bookdown.org/yihui/bookdown/
[pkg-openxlsx]: https://ycphs.github.io/openxlsx/index.html
[pkg-ropensci-writexl]: https://docs.ropensci.org/writexl/
[pkg-jsonlite]: https://cran.r-project.org/web/packages/jsonlite/index.html

[R]: https://www.r-project.org
[RStudio]: https://rstudio.com
[rstudio-cloud]: https://rstudio.cloud/spaces/176810/join?access_code=LSGnG2EXTuzSyeYaNXJE77vP33DZUoeMbC0xhfCz
[r-cloud-mod12]: https://rstudio.cloud/spaces/176810/project/2963819
[r-cloud-mod13]: https://rstudio.cloud/spaces/176810/project/3020139
[r-cloud-mod14]: https://rstudio.cloud/spaces/176810/project/3020322
[r-cloud-mod15]: https://rstudio.cloud/spaces/176810/project/3020509
[r-cloud-mod16]: https://rstudio.cloud/spaces/176810/project/3026754
[r-cloud-mod17]: https://rstudio.cloud/spaces/176810/project/3034015
[r-cloud-mod18]: https://rstudio.cloud/spaces/176810/project/3130795
[r-cloud-mod19]: https://rstudio.cloud/spaces/176810/project/3266132
[rstudio-download]: https://rstudio.com/products/rstudio/download/#download
[rstudio-customizing]: https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio
[rstudio-key-shortcuts]: https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts
[rstudio-workbench]: https://www.rstudio.com/wp-content/uploads/2014/04/rstudio-workbench.png
[r-markdown]: https://rmarkdown.rstudio.com/
[ropensci-writexl]: https://docs.ropensci.org/writexl/
[r4ds-pipes]: https://r4ds.had.co.nz/pipes.html
[r4ds-factors]: https://r4ds.had.co.nz/factors.html
[r4ds-strings]: https://r4ds.had.co.nz/strings.html
[r4ds-iteration]: https://r4ds.had.co.nz/iteration.html

[stat-545]: https://stat545.com
[stat-545-functions-part1]: https://stat545.com/functions-part1.html
[stat-545-functions-part2]: https://stat545.com/functions-part2.html
[stat-545-functions-part3]: https://stat545.com/functions-part3.html
[slides-welcome]: https://bss-osca.github.io/tfa/slides/00-tfa_welcome.html
[slides-m1-3]: https://bss-osca.github.io/tfa/slides/01-welcome_r_part.html
[slides-m4-5]: https://bss-osca.github.io/tfa/slides/02-programming.html
[slides-m6-8]: https://bss-osca.github.io/tfa/slides/03-transform.html
[slides-m9]: https://bss-osca.github.io/tfa/slides/04-plot.html
[slides-m83]: https://bss-osca.github.io/tfa/slides/05-joins.html

[tidyverse-main-page]: https://www.tidyverse.org
[tidyverse-packages]: https://www.tidyverse.org/packages/
[tidyverse-core]: https://www.tidyverse.org/packages/#core-tidyverse
[tidyverse-ggplot2]: https://ggplot2.tidyverse.org/
[tidyverse-dplyr]: https://dplyr.tidyverse.org/
[tidyverse-tidyr]: https://tidyr.tidyverse.org/
[tidyverse-readr]: https://readr.tidyverse.org/
[tidyverse-purrr]: https://purrr.tidyverse.org/
[tidyverse-tibble]: https://tibble.tidyverse.org/
[tidyverse-stringr]: https://stringr.tidyverse.org/
[tidyverse-forcats]: https://forcats.tidyverse.org/
[tidyverse-readxl]: https://readxl.tidyverse.org
[tidyverse-googlesheets4]: https://googlesheets4.tidyverse.org/index.html
[tutorial-markdown]: https://commonmark.org/help/tutorial/

[Udemy]: https://www.udemy.com/

[vba-yt-course1]: https://www.youtube.com/playlist?list=PLpOAvcoMay5S_hb2D7iKznLqJ8QG_pde0
[vba-course1-hello]: https://youtu.be/f42OniDWaIo

[vba-yt-course2]: https://www.youtube.com/playlist?list=PL3A6U40JUYCi4njVx59-vaUxYkG0yRO4m
[vba-course2-devel-tab]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-editor]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-project]: https://youtu.be/fp6PTbU7bXo
[vba-course2-devel-properties]: https://youtu.be/ks2QYKAd9Xw
[vba-course2-devel-hello]: https://youtu.be/EQ6tDWBc8G4

[video-install]: https://vimeo.com/415501284
[video-rstudio-intro]: https://vimeo.com/416391353
[video-packages]: https://vimeo.com/416743698
[video-projects]: https://vimeo.com/319318233
[video-r-intro-p1]: https://www.youtube.com/watch?v=vGY5i_J2c-c
[video-r-intro-p2]: https://www.youtube.com/watch?v=w8_XdYI3reU
[video-r-intro-p3]: https://www.youtube.com/watch?v=NuY6jY4qE7I
[video-subsetting]: https://www.youtube.com/watch?v=hWbgqzsQJF0&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10&t=0s
[video-datatypes]: https://www.youtube.com/watch?v=5AQM-yUX9zg&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10
[video-control-structures]: https://www.youtube.com/watch?v=s_h9ruNwI_0
[video-conditional-loops]: https://www.youtube.com/watch?v=2evtsnPaoDg
[video-functions]: https://www.youtube.com/watch?v=ffPeac3BigM
[video-tibble-vs-df]: https://www.youtube.com/watch?v=EBk6PnvE1R4
[video-dplyr]: https://www.youtube.com/watch?v=aywFompr1F4

[wiki-snake-case]: https://en.wikipedia.org/wiki/Snake_case
[wiki-camel-case]: https://en.wikipedia.org/wiki/Camel_case
[wiki-interpreted]: https://en.wikipedia.org/wiki/Interpreted_language
[wiki-literate-programming]: https://en.wikipedia.org/wiki/Literate_programming
[wiki-csv]: https://en.wikipedia.org/wiki/Comma-separated_values
[wiki-json]: https://en.wikipedia.org/wiki/JSON

<script src="//unpkg.com/@highlightjs/cdn-assets@11.5.1/highlight.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/highlightjs-vba/dist/vba.min.js"></script>
<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script> -->
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
  // hljs.initLineNumbersOnLoad({singleLine: true}); 
</script>

<!--chapter:end:06_vba-random-numbers.Rmd-->



# (PART) R {-} 

# Setting up R {#mod-r-install}

[R] is a programming language and free software environment. The R language is widely used among statisticians and data miners for developing statistical software and data analysis. For a further overview and description of the history of R see [Chapter 2](https://bookdown.org/rdpeng/rprogdatascience/history-and-overview-of-r.html) in @rdpeng. R can be run from a terminal but in general you use an IDE (integrated development environment) [RStudio] for running R and to saving your work.

R and RStudio can either be run from your laptop or using [RStudio Cloud][rstudio-cloud] which run R in the cloud using your browser. During this course it is recommend to use RStudio Cloud at much as possible; however, you also need to have R and RStudio installed on your laptop in case that the cloud service is down/not working. Some pros and cons of using R in the cloud vs on the laptop are

__Cloud ([RStudio Cloud][rstudio-cloud])__

Pros:

- Log in and you are ready to use R.
- No need to download anything.
- Packages easier to install.
- Everything can be run using a browser.

Cons:

- There is a limit on user time and CPU time. You need to pay if need more time. 
- Often slower than the desktop version. 
- Need an internet connection. 
- Risky to use at the exam if the internet connection is slow or is down. Use the laptop version instead.

__Laptop ([R] and [RStudio])__

Pros:

- Can be used without any internet connection.
- No limit on user time and CPU usage.
- Good if computations takes a lot of time.

Cons:

- You need to install R and RStudio to get started.
- Packages must be installed.
- Other needed programs may have to be installed.
- Updates must be installed.

We are all different and you may like different learning styles compared to others. In the learning path diagram, there may be links to alternative online content. Note this is an alternative to the standard learning path that you may use instead. The learning path may also have extra content, that is not a part of syllabus, you can have a look at. 

__Learning path diagram__

Click/hover the nodes to follow links and see details.


```{=html}
<div id="htmlwidget-1528df91c79b3302dfb0" style="width:100%;height:300px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-1528df91c79b3302dfb0">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"💡 Install R and RStudio\", URL = \"#r-install\", tooltip = \"\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"0,1!\"] \n  \"2\" [label = \"💡 Setup and test RStudio Cloud\", URL = \"#r-cloud\", tooltip = \"\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", fillcolor = \"DarkSeaGreen4\", pos = \"5,1!\"] \n  \"3\" [label = \"🎬 Install R and RStudio\", URL = \"https://vimeo.com/415501284\", tooltip = \"Install R and RStudio\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"DarkOrange4\", pos = \"0,2!\"] \n  \"4\" [label = \"🎬 Introduction to RStudio\", URL = \"https://vimeo.com/416391353\", tooltip = \"Introduction to RStudio\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"DarkOrange4\", pos = \"0,3!\"] \n  \"5\" [label = \"🎬 Installing R packages\", URL = \"https://vimeo.com/416743698\", tooltip = \"Installing R packages\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", fillcolor = \"DarkOrange4\", pos = \"0,4!\"] \n\"1\"->\"2\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"3\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"4\" [color = \"black\", arrowhead = \"vee\"] \n\"4\"->\"5\" [color = \"black\", arrowhead = \"vee\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
```


## Learning outcomes {#lo-r-install}

By the end of this module, you are expected to have:

* Installed R and RStudio on your laptop.
* Tested R and RStudio on your laptop. <!--  and Git. -->
* Installed some packages on your laptop
<!-- * Installed Git. -->
* Signed up on [RStudio Cloud][rstudio-cloud] and tested it. 

The learning outcomes relate to the [overall learning goal](#lg-course) number 5 of the course.



## Install R and RStudio {#r-install}

<!-- 
some Content from: https://stat545.com/block000_r-rstudio-install.html
-->

[R] is a programming language and free software environment. The R language is widely used among statisticians and data miners for developing statistical software and data analysis. For a further overview and description of the history of R see [Chapter 2](https://bookdown.org/rdpeng/rprogdatascience/history-and-overview-of-r.html) in @rdpeng. To run R you need to install it on your computer. Moreover, you need the IDE (integrated development environment) [RStudio] to save your work.

<div class = "boxTask"><svg viewBox="0 0 512 512" style="position:relative;display:inline-block;top:.1em;fill:darkkhaki;height:8em;float:right;" xmlns="http://www.w3.org/2000/svg">  <path d="M139.61 35.5a12 12 0 0 0-17 0L58.93 98.81l-22.7-22.12a12 12 0 0 0-17 0L3.53 92.41a12 12 0 0 0 0 17l47.59 47.4a12.78 12.78 0 0 0 17.61 0l15.59-15.62L156.52 69a12.09 12.09 0 0 0 .09-17zm0 159.19a12 12 0 0 0-17 0l-63.68 63.72-22.7-22.1a12 12 0 0 0-17 0L3.53 252a12 12 0 0 0 0 17L51 316.5a12.77 12.77 0 0 0 17.6 0l15.7-15.69 72.2-72.22a12 12 0 0 0 .09-16.9zM64 368c-26.49 0-48.59 21.5-48.59 48S37.53 464 64 464a48 48 0 0 0 0-96zm432 16H208a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h288a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H208a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h288a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H208a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h288a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"></path></svg>  

* Install R from [CRAN][cran] (Comprehensive R Archive Network). Install the latest precompiled binary distribution for your operating system (use the links up at the top of the CRAN page).
* Install the desktop version of [RStudio][rstudio-download], a powerful user interface for R. 
<!-- * Install the latest version of [Git][git-install]. If you have problems, see [here][hg-install-git]. -->
* Under Windows it is a good idea to always open R with administrator rights: 
   - Add a shortcut for RStudio (e.g. to the taskbar or desktop).
   - Ctrl+Shift+Right-Click the shortcut and choose **Properties**:
     
     ![Choose Properties](img/win_admin1.png)
   - Under **Shortcut** click **Advanced** and set **Run as administrator** 
     
     ![](img/win_admin3.png)
     
     You now always can open RStudio with this shortcut. 
</div>
    
If you have a pre-existing installation of R and/or RStudio, reinstall both to the latest versions. It can be considerably harder to run old software than new. To update your R version you may use the [intallr](https://www.r-project.org/nosvn/pandoc/installr.html) package.


### Test your installation

<div class = "boxTask"><svg viewBox="0 0 512 512" style="position:relative;display:inline-block;top:.1em;fill:darkkhaki;height:8em;float:right;" xmlns="http://www.w3.org/2000/svg">  <path d="M139.61 35.5a12 12 0 0 0-17 0L58.93 98.81l-22.7-22.12a12 12 0 0 0-17 0L3.53 92.41a12 12 0 0 0 0 17l47.59 47.4a12.78 12.78 0 0 0 17.61 0l15.59-15.62L156.52 69a12.09 12.09 0 0 0 .09-17zm0 159.19a12 12 0 0 0-17 0l-63.68 63.72-22.7-22.1a12 12 0 0 0-17 0L3.53 252a12 12 0 0 0 0 17L51 316.5a12.77 12.77 0 0 0 17.6 0l15.7-15.69 72.2-72.22a12 12 0 0 0 .09-16.9zM64 368c-26.49 0-48.59 21.5-48.59 48S37.53 464 64 464a48 48 0 0 0 0-96zm432 16H208a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h288a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H208a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h288a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H208a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h288a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"></path></svg>  

* Do whatever is appropriate for your OS to launch RStudio. You should get a window similar to the screenshot you have [here][rstudio-workbench], but yours will be more boring because you have not written any code or made any figures yet.

* Put your cursor in the pane labeled Console, which is where you interact with the live R process. Create a simple object using code like `x <- 2 * 4` (followed by enter or return). Then inspect the `x` object by typing `x` followed by enter or return. You should see the value 8 print to screen. If yes, you have succeeded in installing R and RStudio.

* Try to open a new file **File > New File > New RMarkdown...**. Use the defaults and press **OK**. Next save the file and compile it using **Knit** (Ctrl+Shift+K). You have now compiled a document with R code embedded. 
</div>

### Add-on packages

R is an extensible system and many people share useful codes they have developed as a _package_ via CRAN or GitHub. To install a package from CRAN, for example the [dplyr][dplyr-cran] package for data manipulation, one way to do it is in the R console.

```r
install.packages("dplyr", dependencies = TRUE)
```

By including `dependencies = TRUE`, we are being explicit and extra careful to install any additional packages the target package, `dplyr` in the example above is dependent on. 

<div class = "boxTask"><svg viewBox="0 0 512 512" style="position:relative;display:inline-block;top:.1em;fill:darkkhaki;height:8em;float:right;" xmlns="http://www.w3.org/2000/svg">  <path d="M139.61 35.5a12 12 0 0 0-17 0L58.93 98.81l-22.7-22.12a12 12 0 0 0-17 0L3.53 92.41a12 12 0 0 0 0 17l47.59 47.4a12.78 12.78 0 0 0 17.61 0l15.59-15.62L156.52 69a12.09 12.09 0 0 0 .09-17zm0 159.19a12 12 0 0 0-17 0l-63.68 63.72-22.7-22.1a12 12 0 0 0-17 0L3.53 252a12 12 0 0 0 0 17L51 316.5a12.77 12.77 0 0 0 17.6 0l15.7-15.69 72.2-72.22a12 12 0 0 0 .09-16.9zM64 368c-26.49 0-48.59 21.5-48.59 48S37.53 464 64 464a48 48 0 0 0 0-96zm432 16H208a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h288a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H208a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h288a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H208a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h288a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"></path></svg>  

* Install the package [tidyverse][tidyverse-main-page] which is in fact a bundle of packages by running (note this operation may take a long time):

```r
install.packages("tidyverse", dependencies = TRUE)
```

* Check if you have successfully installed tidyverse by loading the package:

```r
library(tidyverse)
```

* If your install was unsuccessful try to install the packages who fails one by one.
</div>

You may also see this short [video][video-packages] explaining what packages are.


## Setup and test RStudio Cloud {#r-cloud}

RStudio Cloud works as your laptop version except that a workspace with projects for each module already is created. 

<div class = "boxTask"><svg viewBox="0 0 512 512" style="position:relative;display:inline-block;top:.1em;fill:darkkhaki;height:8em;float:right;" xmlns="http://www.w3.org/2000/svg">  <path d="M139.61 35.5a12 12 0 0 0-17 0L58.93 98.81l-22.7-22.12a12 12 0 0 0-17 0L3.53 92.41a12 12 0 0 0 0 17l47.59 47.4a12.78 12.78 0 0 0 17.61 0l15.59-15.62L156.52 69a12.09 12.09 0 0 0 .09-17zm0 159.19a12 12 0 0 0-17 0l-63.68 63.72-22.7-22.1a12 12 0 0 0-17 0L3.53 252a12 12 0 0 0 0 17L51 316.5a12.77 12.77 0 0 0 17.6 0l15.7-15.69 72.2-72.22a12 12 0 0 0 .09-16.9zM64 368c-26.49 0-48.59 21.5-48.59 48S37.53 464 64 464a48 48 0 0 0 0-96zm432 16H208a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h288a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H208a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h288a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H208a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h288a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"></path></svg>  

* Join the _Tools for Analytics_ workspace on [RStudio Cloud][rstudio-cloud] (signup if you have not done it yet).
* Click the _Projects_ link (in the top) and open the project _00-module-11_. A personal copy of the project is loaded for you.
* Put your cursor in the pane labeled Console, which is where you interact with the live R process. Create a simple object using code like `x <- 2 * 4` (followed by enter or return). Then inspect the `x` object by typing `x` followed by enter or return. You should see the value 8 print to screen. 
* Try to open a new file **File > New File > New RMarkdown...**. Use the defaults and press **OK**. Next save the file and compile it using **Knit** (Ctrl+Shift+K). You have now compiled a document with R code embedded. 
</div>



[BSS]: https://bss.au.dk/en/

[course-help]: https://github.com/bss-osca/tfa/issues
[cran]: https://cloud.r-project.org
[cheatsheet-readr]: https://rawgit.com/rstudio/cheatsheets/master/data-import.pdf
[course-welcome-to-the-tidyverse]: https://github.com/rstudio-education/welcome-to-the-tidyverse

[DataCamp]: https://www.datacamp.com/
[datacamp-signup]: https://www.datacamp.com/groups/shared_links/cbaee6c73e7d78549a9e32a900793b2d5491ace1824efc1760a6729735948215
[datacamp-r-intro]: https://learn.datacamp.com/courses/free-introduction-to-r
[datacamp-r-rmarkdown]: https://campus.datacamp.com/courses/reporting-with-rmarkdown
[datacamp-r-communicating]: https://learn.datacamp.com/courses/communicating-with-data-in-the-tidyverse
[datacamp-r-communicating-chap3]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/introduction-to-rmarkdown
[datacamp-r-communicating-chap4]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/customizing-your-rmarkdown-report
[datacamp-r-intermediate]: https://learn.datacamp.com/courses/intermediate-r
[datacamp-r-intermediate-chap1]: https://campus.datacamp.com/courses/intermediate-r/chapter-1-conditionals-and-control-flow
[datacamp-r-intermediate-chap2]: https://campus.datacamp.com/courses/intermediate-r/chapter-2-loops
[datacamp-r-intermediate-chap3]: https://campus.datacamp.com/courses/intermediate-r/chapter-3-functions
[datacamp-r-intermediate-chap4]: https://campus.datacamp.com/courses/intermediate-r/chapter-4-the-apply-family
[datacamp-r-functions]: https://learn.datacamp.com/courses/introduction-to-writing-functions-in-r
[datacamp-r-tidyverse]: https://learn.datacamp.com/courses/introduction-to-the-tidyverse
[datacamp-r-strings]: https://learn.datacamp.com/courses/string-manipulation-with-stringr-in-r
[datacamp-r-dplyr]: https://learn.datacamp.com/courses/data-manipulation-with-dplyr
[datacamp-r-dplyr-bakeoff]: https://learn.datacamp.com/courses/working-with-data-in-the-tidyverse
[datacamp-r-ggplot2-intro]: https://learn.datacamp.com/courses/introduction-to-data-visualization-with-ggplot2
[datacamp-r-ggplot2-intermediate]: https://learn.datacamp.com/courses/intermediate-data-visualization-with-ggplot2
[dplyr-cran]: https://CRAN.R-project.org/package=dplyr
[debug-in-r]: https://rstats.wtf/debugging-r-code.html

[excel-vs-r]: https://www.jessesadler.com/post/excel-vs-r/

[google-form]: https://forms.gle/s39GeDGV9AzAXUo18
[google-grupper]: https://docs.google.com/spreadsheets/d/1DHxthd5AQywAU4Crb3hM9rnog2GqGQYZ2o175SQgn_0/edit?usp=sharing
[GitHub]: https://github.com/
[git-install]: https://git-scm.com/downloads
[github-actions]: https://github.com/features/actions
[github-pages]: https://pages.github.com/

[happy-git]: https://happygitwithr.com
[hg-install-git]: https://happygitwithr.com/install-git.html
[hg-why]: https://happygitwithr.com/big-picture.html#big-picture
[hg-github-reg]: https://happygitwithr.com/github-acct.html#github-acct
[hg-git-install]: https://happygitwithr.com/install-git.html#install-git
[hg-exist-github-first]: https://happygitwithr.com/existing-github-first.html
[hg-exist-github-last]: https://happygitwithr.com/existing-github-last.html
[hg-credential-helper]: https://happygitwithr.com/credential-caching.html
[hypothes.is]: https://web.hypothes.is/

[osca-programme]: https://kandidat.au.dk/en/operationsandsupplychainanalytics/

[Peergrade]: https://peergrade.io
[peergrade-signup]: https://app.peergrade.io/join
[point-and-click]: https://en.wikipedia.org/wiki/Point_and_click
[pkg-bookdown]: https://bookdown.org/yihui/bookdown/
[pkg-openxlsx]: https://ycphs.github.io/openxlsx/index.html
[pkg-ropensci-writexl]: https://docs.ropensci.org/writexl/
[pkg-jsonlite]: https://cran.r-project.org/web/packages/jsonlite/index.html

[R]: https://www.r-project.org
[RStudio]: https://rstudio.com
[rstudio-cloud]: https://rstudio.cloud/spaces/176810/join?access_code=LSGnG2EXTuzSyeYaNXJE77vP33DZUoeMbC0xhfCz
[r-cloud-mod12]: https://rstudio.cloud/spaces/176810/project/2963819
[r-cloud-mod13]: https://rstudio.cloud/spaces/176810/project/3020139
[r-cloud-mod14]: https://rstudio.cloud/spaces/176810/project/3020322
[r-cloud-mod15]: https://rstudio.cloud/spaces/176810/project/3020509
[r-cloud-mod16]: https://rstudio.cloud/spaces/176810/project/3026754
[r-cloud-mod17]: https://rstudio.cloud/spaces/176810/project/3034015
[r-cloud-mod18]: https://rstudio.cloud/spaces/176810/project/3130795
[r-cloud-mod19]: https://rstudio.cloud/spaces/176810/project/3266132
[rstudio-download]: https://rstudio.com/products/rstudio/download/#download
[rstudio-customizing]: https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio
[rstudio-key-shortcuts]: https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts
[rstudio-workbench]: https://www.rstudio.com/wp-content/uploads/2014/04/rstudio-workbench.png
[r-markdown]: https://rmarkdown.rstudio.com/
[ropensci-writexl]: https://docs.ropensci.org/writexl/
[r4ds-pipes]: https://r4ds.had.co.nz/pipes.html
[r4ds-factors]: https://r4ds.had.co.nz/factors.html
[r4ds-strings]: https://r4ds.had.co.nz/strings.html
[r4ds-iteration]: https://r4ds.had.co.nz/iteration.html

[stat-545]: https://stat545.com
[stat-545-functions-part1]: https://stat545.com/functions-part1.html
[stat-545-functions-part2]: https://stat545.com/functions-part2.html
[stat-545-functions-part3]: https://stat545.com/functions-part3.html
[slides-welcome]: https://bss-osca.github.io/tfa/slides/00-tfa_welcome.html
[slides-m1-3]: https://bss-osca.github.io/tfa/slides/01-welcome_r_part.html
[slides-m4-5]: https://bss-osca.github.io/tfa/slides/02-programming.html
[slides-m6-8]: https://bss-osca.github.io/tfa/slides/03-transform.html
[slides-m9]: https://bss-osca.github.io/tfa/slides/04-plot.html
[slides-m83]: https://bss-osca.github.io/tfa/slides/05-joins.html

[tidyverse-main-page]: https://www.tidyverse.org
[tidyverse-packages]: https://www.tidyverse.org/packages/
[tidyverse-core]: https://www.tidyverse.org/packages/#core-tidyverse
[tidyverse-ggplot2]: https://ggplot2.tidyverse.org/
[tidyverse-dplyr]: https://dplyr.tidyverse.org/
[tidyverse-tidyr]: https://tidyr.tidyverse.org/
[tidyverse-readr]: https://readr.tidyverse.org/
[tidyverse-purrr]: https://purrr.tidyverse.org/
[tidyverse-tibble]: https://tibble.tidyverse.org/
[tidyverse-stringr]: https://stringr.tidyverse.org/
[tidyverse-forcats]: https://forcats.tidyverse.org/
[tidyverse-readxl]: https://readxl.tidyverse.org
[tidyverse-googlesheets4]: https://googlesheets4.tidyverse.org/index.html
[tutorial-markdown]: https://commonmark.org/help/tutorial/

[Udemy]: https://www.udemy.com/

[vba-yt-course1]: https://www.youtube.com/playlist?list=PLpOAvcoMay5S_hb2D7iKznLqJ8QG_pde0
[vba-course1-hello]: https://youtu.be/f42OniDWaIo

[vba-yt-course2]: https://www.youtube.com/playlist?list=PL3A6U40JUYCi4njVx59-vaUxYkG0yRO4m
[vba-course2-devel-tab]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-editor]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-project]: https://youtu.be/fp6PTbU7bXo
[vba-course2-devel-properties]: https://youtu.be/ks2QYKAd9Xw
[vba-course2-devel-hello]: https://youtu.be/EQ6tDWBc8G4

[video-install]: https://vimeo.com/415501284
[video-rstudio-intro]: https://vimeo.com/416391353
[video-packages]: https://vimeo.com/416743698
[video-projects]: https://vimeo.com/319318233
[video-r-intro-p1]: https://www.youtube.com/watch?v=vGY5i_J2c-c
[video-r-intro-p2]: https://www.youtube.com/watch?v=w8_XdYI3reU
[video-r-intro-p3]: https://www.youtube.com/watch?v=NuY6jY4qE7I
[video-subsetting]: https://www.youtube.com/watch?v=hWbgqzsQJF0&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10&t=0s
[video-datatypes]: https://www.youtube.com/watch?v=5AQM-yUX9zg&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10
[video-control-structures]: https://www.youtube.com/watch?v=s_h9ruNwI_0
[video-conditional-loops]: https://www.youtube.com/watch?v=2evtsnPaoDg
[video-functions]: https://www.youtube.com/watch?v=ffPeac3BigM
[video-tibble-vs-df]: https://www.youtube.com/watch?v=EBk6PnvE1R4
[video-dplyr]: https://www.youtube.com/watch?v=aywFompr1F4

[wiki-snake-case]: https://en.wikipedia.org/wiki/Snake_case
[wiki-camel-case]: https://en.wikipedia.org/wiki/Camel_case
[wiki-interpreted]: https://en.wikipedia.org/wiki/Interpreted_language
[wiki-literate-programming]: https://en.wikipedia.org/wiki/Literate_programming
[wiki-csv]: https://en.wikipedia.org/wiki/Comma-separated_values
[wiki-json]: https://en.wikipedia.org/wiki/JSON

<!--chapter:end:07_r-install.Rmd-->

---
output: html_document
editor_options: 
  chunk_output_type: console
---


# R basics and workflows {#mod-r-workflow}

This module contains an introduction to using R, the syntax, data types etc. Coding in R is, as VBA, best learnt by trying it out and learn by trial and error. Hence the modules often contains links to interactive tutorials.

We are all different and you may like different learning styles compared to others. In the learning path diagram, there may be links to alternative online content. Note this is an alternative to the standard learning path that you may use instead. The learning path may also have extra content, that is not a part of syllabus, you can have a look at. 


```{=html}
<div id="htmlwidget-756311aa99702330b0a8" style="width:100%;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-756311aa99702330b0a8">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"📖 Command line\\noperatons\", URL = \"#working-with-r-at-the-command-line-in-rstudio\", tooltip = \"Command line operatons\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"0,2!\"] \n  \"2\" [label = \"💡 Intro to R\", URL = \"#your-first-datacamp-course\", tooltip = \"Datacamp tutorial\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"2,2!\"] \n  \"3\" [label = \"📖 Pipes\", URL = \"#pipes\", tooltip = \"Pipes\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"4,2!\"] \n  \"4\" [label = \"📖 RStudio\\nProjects\", URL = \"#rprojs\", tooltip = \"RStudio\\nProjects\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"5.5,2!\"] \n  \"5\" [label = \"📖 Global\\nOptions\", URL = \"#global-options\", tooltip = \"Global\\nOptions\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"7,2!\"] \n  \"6\" [label = \"📖 Working Dir\", URL = \"#working-directory\", tooltip = \"Working Dir\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"8.5,2!\"] \n  \"7\" [label = \"🎬 Intro to R (I)\", URL = \"https://www.youtube.com/watch?v=vGY5i_J2c-c&ab_channel=RogerPeng\", tooltip = \"Introduction by Roger Peng on YouTube about data types and basic operations.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkOrange4\", pos = \"1,3!\"] \n  \"8\" [label = \"🎬 Intro to R (II)\", URL = \"https://www.youtube.com/watch?v=w8_XdYI3reU&ab_channel=RogerPeng\", tooltip = \"Introduction by Roger Peng on YouTube about data types (vectors, matrices and lists).\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkOrange4\", pos = \"1,4!\"] \n  \"9\" [label = \"🎬 Intro to R (III)\", URL = \"https://www.youtube.com/watch?v=NuY6jY4qE7I&ab_channel=RogerPeng\", tooltip = \"Introduction by Roger Peng on YouTube about data types (factors, missing values and data frames).\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkOrange4\", pos = \"1,5!\"] \n  \"10\" [label = \"💻 Exercises\", URL = \"#ex-r-basics\", tooltip = \"\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"10.5,2!\"] \n  \"11\" [label = \"📖 Intro to R\", URL = \"https://bookdown.org/rdpeng/rprogdatascience/r-nuts-and-bolts.html\", tooltip = \"An introduction to R is given in Chapter 4 of Peng (2018).\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkOrange4\", pos = \"3,3!\"] \n  \"12\" [label = \"📖 Subsetting\", URL = \"https://bookdown.org/rdpeng/rprogdatascience/subsetting-r-objects.html\", tooltip = \"A detailed tutorial given in Chapter 9 of Peng (2018).\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"1.5,1!\"] \n  \"13\" [label = \"📖 Factors\", URL = \"https://r4ds.had.co.nz/factors.html\", tooltip = \"A longer tutorial given in Chapter 15 of H. Wickham (2017).\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"2.75,1!\"] \n  \"14\" [label = \"📖 Pipes\", URL = \"https://r4ds.had.co.nz/pipes.html\", tooltip = \"A detailed introduction to pipes in Chapter 18 in H. Wickham (2017).\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"4,1!\"] \n  \"15\" [label = \"💡 String\\nManipulation\", URL = \"https://learn.datacamp.com/courses/string-manipulation-with-stringr-in-r\", tooltip = \"DataCamp - String Manipulation with stringr in R.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"10.5,0.75!\"] \n  \"16\" [label = \"📖 Coding\\nConvention\", URL = \"https://discdown.org/rprogramming/style-guide.html\", tooltip = \"An introduction to good coding conventions (Chapter 16 of Stauffer, Simon, and Zeileis, 2020).\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"0,1!\"] \n  \"17\" [label = \"\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"0.5\", fontname = \"Helvetica\", shape = \"rect\", height = \"1\", width = \"6\", fillcolor = \"#F0F8FF\", pos = \"7.4,4.81!\"] \n  \"18\" [label = \"Color:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"0.8\", fillcolor = \"#FFFFFE\", pos = \"4.77,5.15!\"] \n  \"19\" [label = \"mandatory\", URL = \"\", tooltip = \"Mandatory syllabus.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkSeaGreen4\", pos = \"5,4.75!\"] \n  \"20\" [label = \"alternative\", URL = \"\", tooltip = \"Alternative syllabus if you prefer another learning style.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkOrange4\", pos = \"6,4.75!\"] \n  \"21\" [label = \"extra\", URL = \"\", tooltip = \"Extra learning if you are interested (not part of syllabus).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"PeachPuff3\", pos = \"7,4.75!\"] \n  \"22\" [label = \"Shape:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"1\", fillcolor = \"#FFFFFE\", pos = \"8.2,5.15!\"] \n  \"23\" [label = \"non-interactive\", URL = \"\", tooltip = \"Non-interactive learning content (e.g. reading).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"1\", fillcolor = \"Grey40\", pos = \"8.5,4.75!\"] \n  \"24\" [label = \"interactive\", URL = \"\", tooltip = \"Interactive learning content (tutorial, exercises etc.).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"egg\", width = \"1\", fillcolor = \"Grey40\", pos = \"9.75,4.75!\"] \n\"1\"->\"2\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"16\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"11\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"7\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"3\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"12\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"13\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"4\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"14\" [color = \"black\", arrowhead = \"vee\"] \n\"4\"->\"5\" [color = \"black\", arrowhead = \"vee\"] \n\"5\"->\"6\" [color = \"black\", arrowhead = \"vee\"] \n\"6\"->\"10\" [color = \"black\", arrowhead = \"vee\"] \n\"7\"->\"8\" [color = \"black\", arrowhead = \"vee\"] \n\"8\"->\"9\" [color = \"black\", arrowhead = \"vee\"] \n\"10\"->\"15\" [color = \"black\", arrowhead = \"vee\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
```

<!-- ## Different learning paths {#lp-r-workflow} -->

<!-- We are all different and you may like different learning styles compared to others. You may prefer a different learning path than suggested. Here is a list of possible different learning paths that may be useful for you. Note these suggestions are not a part of syllabus! -->

<!-- * Roger Peng has a lot of [videos](https://www.youtube.com/playlist?list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od) on YouTube about R. Of special interest are -->

<!--    - An introduction to the R language ([Part 1][video-r-intro-p1], [Part 2][video-r-intro-p2], [Part 3][video-r-intro-p3]) including data types and basic operations. -->
<!--    - [An introduction to subsetting in R][video-subsetting]. -->
<!--    - [A detailed description af data types][video-datatypes]. -->

<!-- * An introduction to R is given in [Chapter 4](https://bookdown.org/rdpeng/rprogdatascience/r-nuts-and-bolts.html) of @rdpeng. -->
<!-- * A detailed tutorial on subsetting is given in [Chapter 9](https://bookdown.org/rdpeng/rprogdatascience/subsetting-r-objects.html) of @rdpeng. -->
<!-- * A longer tutorial to factors is given in [Chapter 15][r4ds-factors] of @r4ds. -->
<!-- * For a more detailed introduction to pipes see [Chapter 18][r4ds-pipes] in @r4ds. -->
<!-- * For a detailed introduction to strings (see exercise below) check out the DataCamp course [String Manipulation with stringr in R][datacamp-r-strings]. -->
<!-- * An introduction to good coding conventions in given in [Chapter 16](https://eeecon.uibk.ac.at/~discdown/rprogramming/style-guide.html) of @discdown. -->


## Learning outcomes {#lo-r-workflow}

By the end of this module, you are expected to have:

* Tried R and RStudio.
* Learned how the RStudio IDE works.
* Finished your first course on DataCamp.
* Solved your first exercises.

The learning outcomes relate to the [overall learning goals](#lg-course) number 2, 5, 6, 8, 11, 13 and 15 of the course.


## Working with R at the command line in RStudio 

R is a programming language and free software environment. The R language is widely used among statisticians and data miners for data analysis. To run R you need to install it on your laptop or use a cloud version. We will use R via RStudio. First time users often confuse the two. At its simplest, R is like a car's engine while RStudio is like a car's dashboard as illustrated in Figure \@ref(fig:R-vs-RStudio-1).

<div class="figure" style="text-align: center">
<img src="img/R_vs_RStudio_1.png" alt="Analogy of difference between R and RStudio." width="95%" />
<p class="caption">(\#fig:R-vs-RStudio-1)Analogy of difference between R and RStudio.</p>
</div>

More precisely, R is a programming language that runs computations, while RStudio is an *integrated development environment (IDE)* that provides an interface by adding many convenient features and tools. So just as the way of having access to a speedometer, rearview mirrors, and a navigation system makes driving much easier, using RStudio's interface makes using R much easier as well. RStudio can be accessed using both your laptop version or [RStudio Cloud][rstudio-cloud]. We will assume that you are using R via [RStudio Cloud][rstudio-cloud] if not stated otherwise.

Compared to Excel, the benefit of using Excel is that the initial learning curve is quite minimal, and most analysis can be done via point-and-click on the top panel. Once a user imports their data into the program, it's not exceedingly hard to make basic graphs and charts. R is a programming language, however, meaning the initial learning curve is steeper. It will take you some time to become familiar with the interface and master the various functions. Luckily, using R can quickly become second-nature with practice. For a detailed comparison you may see [Excel vs R: A Brief Introduction to R][excel-vs-r] by Jesse Sadler.

Compared to VBA, R is an [interpreted language][wiki-interpreted]; users typically access it through a command-line or script file. To run VBA you need to compile and execute it.   

<!-- Recall our car analogy from earlier. As we do not drive a car by interacting directly with the engine but rather by interacting with elements on the car's dashboard, we will not be using R directly but rather we will use RStudio's interface. After you install R and RStudio on your laptop, you will have two new *programs* (also called *applications*) you can open. We will always work in RStudio on your laptop or in RStudio Cloud (except when you do online tutorials) and not in the R application. Figure \@ref(fig:R-vs-RStudio-2) shows what icon you should be clicking on your laptop.  -->


<!-- ```{r R-vs-RStudio-2, echo=FALSE, fig.align="center", fig.cap="Icons of R versus RStudio on your laptop.", out.width="90%", purl=FALSE} -->
<!-- knitr::include_graphics("img/R_vs_RStudio.png") -->
<!-- ``` -->

Launch [RStudio][r-cloud-mod12] (follow this link to get to the correct project). An personal copy of the _01-module-12_ project is now created for you. Consider the panes:

* Console (left)
* Environment/History (tabbed in upper right)
* Files/Plots/Packages/Help (tabbed in lower right)

FYI: you can change the default location of the panes, among many other things: [Customizing RStudio][rstudio-customizing].

Now that you are set up with R and RStudio, you are probably asking yourself, "OK - now how do I use R?". The first thing to note is that unlike other software programs like Excel or SPSS that provide [point-and-click] interfaces, R is an [interpreted language][wiki-interpreted]. This means you have to type in commands written in *R code*. In other words, you have to code/program in R. Note that we will use the terms "coding" and "programming" interchangeably.

Go into the Console, where we interact with the live R process.

Make an assignment and then inspect the object you just created:


```r
x <- 3 * 4
x
#> [1] 12
```

All R statements where you create objects -- "assignments" -- have this form:

```r
object_name <- value
```
and in my head I hear, e.g., "x equals 12". You will make lots of assignments and the operator `<-` is a pain to type. Do not be lazy and use `=`, although it would work, because it will just sow confusion later. Instead, utilize RStudio's keyboard shortcut: Alt+- (the minus sign).

Note that RStudio automatically surrounds `<-` with spaces, which demonstrates a useful code formatting practice. Give your eyes a break and use spaces.

RStudio offers many handy [keyboard shortcuts][rstudio-key-shortcuts]. Also, Alt+Shift+K brings up a keyboard shortcut reference card.

Object names cannot start with a digit and cannot contain certain other characters such as a comma or a space. You are advised to adopt a naming convention; some use [snake case][wiki-snake-case] others use [camel case][wiki-camel-case]. Choose the naming convention you like best in your study group. But stick only to one of them.

```
this_is_snake_case   # note you do not use capital letters here
thisIsCamelCase      # you start each word with a capital letter
```

Make another assignment:

```r
this_is_a_long_name <- 2.5
```

To inspect this, try out RStudio's completion facility: type the first few characters, press TAB, add characters until you agree, then press return.

In VBA you have procedures and functions. In R we only use functions which always return an object. R has a mind-blowing collection of built-in functions that are accessed like so:


```r
function_name(arg1 = val1, arg2 = val2, ...)
```

Let's try function `seq()` which makes regular sequences of numbers and at the same time demo more helpful features of RStudio.

Type `se` and hit TAB. A pop-up shows you possible completions. Specify `seq()` by typing more or use the up/down arrows to select. Note the floating tool-tip-type help that pops up, reminding you of a function's arguments. If you want even more help, press F1 as directed to get the full documentation in the help tab of the lower right pane. Now open the parentheses and note the automatic addition of the closing parenthesis and the placement of the cursor in the middle. Type the arguments `1, 10` and hit return.  


```r
seq(1, 10)
#>  [1]  1  2  3  4  5  6  7  8  9 10
```

The above also demonstrates something about how R resolves function arguments. Type seq and press F1 or type:


```r
?seq
```

The Help tab of the lower right pane will show the help documentation of function `seq` with a description of usage, arguments, return value etc. Note all function arguments have names. You can always specify arguments using `name = value` form. But if you do not, R attempts to resolve by position. So above, it is assumed that we want a sequence `from = 1` that goes `to = 10`. Since we did not specify step size, the default value of `by` in the function definition is used, which ends up being 1 in this case. Note since the default value for `from` is 1, the same result is obtained by typing:


```r
seq(to = 10)
#>  [1]  1  2  3  4  5  6  7  8  9 10
```

Make this assignment and note similar help with quotation marks.

```r
yo <- "hello world"
```

If you just create an assignment, you do not see the value. You may see the value by:


```r
yo          # same as print(yo)
#> [1] "hello world"
print(yo)  
#> [1] "hello world"
```

Now look at your Environment tab in the upper right pane where user-defined objects accumulate. You can also get a listing of these objects with commands:


```r
objects()
#>  [1] "add_graph_legend"     "addIconOld"           "addIconTasks"         "addSolution"         
#>  [5] "create_learning_path" "ctrSol"               "dat"                  "g"                   
#>  [9] "link_excel_file"      "link_excel_file_text" "link_slide_file_text" "module_name"         
#> [13] "module_number"        "module_number_prefix" "sheet_name_prefix"    "strExercises"        
#> [17] "strLPath"             "this_is_a_long_name"  "x"                    "yo"
ls()
#>  [1] "add_graph_legend"     "addIconOld"           "addIconTasks"         "addSolution"         
#>  [5] "create_learning_path" "ctrSol"               "dat"                  "g"                   
#>  [9] "link_excel_file"      "link_excel_file_text" "link_slide_file_text" "module_name"         
#> [13] "module_number"        "module_number_prefix" "sheet_name_prefix"    "strExercises"        
#> [17] "strLPath"             "this_is_a_long_name"  "x"                    "yo"
```

If you want to remove the object named `yo`, you can do this:


```r
rm(yo)
```

To remove everything:


```r
rm(list = ls())
```

or click the broom in RStudio's Environment pane.


## Your first DataCamp course

[DataCamp] is an online platform for learning data science. We are going to use the platform for online tutorials. First, sign up to the organization __Tools for analytics__ at DataCamp __using your university e-mail__ [here](https://www.datacamp.com/groups/shared_links/27a2552c6f9759a23e473bf403548817d731fde6478552ff871c65dc4350ef30) (IMPORTANT do this before running the course/tutorial below!). 

DataCamp runs all the courses in your browser. That is, R is run on a server and you do not use RStudio here. The first course gives an [Introduction to R][datacamp-r-intro]. You are expected to have completed [the course][datacamp-r-intro] before continuing this module! 


## Pipes

Most functions support the pipe operator which is a powerful tool for clearly expressing a sequence of multiple operations. The pipe operator `%>%`, comes from the magrittr package and is loaded automatically when you load tidyverse. You may use the RStudio keyboard shortcut Ctrl+Shift+M.

Consider the following code:


```r
# calculate x as a sequence of operations
x <- 16
x <- sqrt(x)
x <- log2(x)
x
#> [1] 2
# same as
y <- log2(sqrt(16))
y
#> [1] 2
```

Note we here calculate `x` using a sequence of operations:

$$ \mbox{original data (x)}
\rightarrow \mbox{ sqrt }
\rightarrow \mbox{ log2 }. $$

That is, we take what is left of the arrow (the object `x`) and put it into the function on the right of the arrow. These operations can be done using the pipe operator:


```r
library(tidyverse)
x <- 16
x <- x %>%
   sqrt() %>%
   log2()
x
#> [1] 2
```
In general, the pipe _sends_ the result of the left side of the pipe to be the first argument of the function on the right side of the pipe. That is, you may have other arguments in your functions:


```r
16 %>% sqrt() %>% log2()
#> [1] 2
16 %>% sqrt() %>% log(base = 2)   # equivalent
#> [1] 2
```

The above example is simple but illustrates that you can use pipes to skip intermediate assignment operations. Later you will do more complex pipes when we consider data wrangling. For instance,


```r
mtcars %>% select(cyl, gear, hp, mpg) %>% filter(gear == 4, cyl == 4)
#>                cyl gear  hp  mpg
#> Datsun 710       4    4  93 22.8
#> Merc 240D        4    4  62 24.4
#> Merc 230         4    4  95 22.8
#> Fiat 128         4    4  66 32.4
#> Honda Civic      4    4  52 30.4
#> Toyota Corolla   4    4  65 33.9
#> Fiat X1-9        4    4  66 27.3
#> Volvo 142E       4    4 109 21.4
```

selects the columns related to cylinders, gears, horse power and miles, and then rows with cars having four cylinders and gears. For a more detailed introduction to pipes see [Chapter 18][r4ds-pipes] in @r4ds.



## RStudio projects {#rprojs}

One day you will need to quit R, do something else and return to your analysis later.

One day you will have multiple analyses going that use R and you want to keep them separate.

One day you will need to bring data from the outside world into R and send numerical results and figures from R back out into the world.

To handle these real life situations, you need to store your work in a project that keeps all the files associated with a project organized together (such as input data, R scripts, analytical results and figures). RStudio has built-in support for this via its [_projects_][rstudio-using-projects]. You may think of a project as a folder where you store all you work. 

On RStudio Cloud you create a project inside a workspace. Projects have already been made for most modules. However, let us try to create a project in your _Your Workspace_ workspace. Expand the left menu and select your _Your Workspace_ workspace. Press the _New Project_ button and select _New RStudio Project_. The project is now created and you can rename it in the upper left corner. Go back to the project _01-module-12_ in the _Tools for Analytics_ workspace that we will use for the remaining of the module.

For RStudio on your laptop you create a project for the rest of this module by doing this: **File > New Project... > New Directory > New Project >**. The directory name you choose here will be the project name. Call it whatever you want (or follow me for convenience). I used `tfa_testing` in my `tmp` directory (that is `tfa_testing` is now a subfolder of `tmp`.

You now need a way to store R code in your project. We will use 2 ways of storing your code. An R script file or an R Markdown document. Normally you store lines of R code in a script file that you need to run. 

R Markdown provides an easy way to produce a rich, fully-documented reproducible analysis. Here you combine text, figures and metadata needed to reproduce the analysis from the beginning to the end in a single file. R Markdown compiles to nicely formatted HTML, PDF, or Word. We are going to use R Markdown for larger projects (e.g. the mandatory R report). We will come back to R Markdown later.


### Storing your code in a script file

R code can be stored in a script file with file suffix `.R`. A script file contains a line for each R command to run (think of each line as a command added to the console). Create a new script file **File > New File > R Script**. Let us add some R code to the file:


```r
# this is a comment
a <- 2
b <- -3
sig_sq <- 0.5
x <- runif(40)
y <- a + b * x + rnorm(40, sd = sqrt(sig_sq))
(avg_x <- mean(x))
write(avg_x, "avg_x.txt")
plot(x, y)
abline(a, b, col = "purple")
dev.print(pdf, "toy_line_plot.pdf")
```

Save the file as `testing.R` Now run each line by setting the cursor at the first line, hit Ctrl+Enter (runs the line in the Console and moves the cursor to the next line). Repeat Ctrl+Enter until you have run all the lines. Alternatively you may select all the code and hit Ctrl+Enter. 

Change some things in your code. For instance set a sample size `n` at the top, e.g. `n <- 40`, and then replace all the hard-wired 40's with `n`. Change some other minor, but detectable, stuff, e.g. alter the sample size `n`, the slope of the line `b`, the color of the line etc. Practice the different ways to rerun the code:

* Walk through line by line by keyboard shortcut (Ctrl+Enter) or mouse (click "Run" in the upper right corner of editor pane).
  
* Source the entire document by entering `source('testing.R')` in the Console or use keyboard shortcut (Shift+Ctrl+S) or mouse (click "Source" in the upper right corner of editor pane or select from the mini-menu accessible from the associated down triangle).
  
* Source with echo from the Source mini-menu.
  
Try to get an overview of the different planes and tabs. For instance in the Files tab (lower right plane) you can get an overview of your project files. You may also see this [video about projects][video-projects].


<!-- ## Global options -->

<!-- This section is relevant if you use RStudio on your laptop. Quit RStudio. Inspect the folder associated with your project if you wish. Maybe view the PDF in an external viewer. Restart RStudio. Note that things, by default, restore to where we were earlier. Check the Environment tap (top-right plane). The environment should be empty. If it contains objects you defined before you closed R, it is because they have been restored. This is in general not advisable and should be changed by opening **Tools > Global Options ...**. Under **General** set the check marks as:   -->

<!-- ```{r echo=FALSE, out.width='60%'} -->
<!-- knitr::include_graphics('img/global_options_general.png') -->
<!-- ``` -->

<!-- Quit RStudio and reopen it. The Environment tab should now be empty.  -->


<!-- ## Working directory -->

<!-- Any process running on your laptop has a notion of its "working directory". In R, this is where R will look, by default, for files you ask it to load. It is also where, by default, any files you write to disk will go. Chances are your current working directory is the directory we inspected above, i.e. the one where RStudio wanted to save the workspace. -->

<!-- You can explicitly check your working directory with: -->

<!-- ```{r, eval = FALSE} -->
<!-- getwd() -->
<!-- ``` -->

<!-- It is also displayed at the top of the RStudio console. In general it should be the directory of your R project. You can set R's working directory at the command line like so: -->

<!-- ```{r, eval = FALSE} -->
<!-- setwd("./subfolder")  # sets the working dir to a subfolder of you project folder -->
<!-- ``` -->

<!-- You can also use RStudio's Files pane to navigate to a directory and then set it as working directory from the menu: **Session > Set Working Directory > To Files Pane Location**. -->



## Recap {#rc-r-workflow}

R is a programming language that runs computations, while RStudio is an integrated development environment (IDE) that provides an interface by adding many convenient features and tools. 

Adopt a naming convention. Either use snake case or use camel case. Choose the naming convention you like best in your study group. But stick only to one of them.

Store your work in a project that keeps all the files associated with a project organized together (such as input data, R scripts, analytical results and figures). You may think of a project as a folder where you store all your work. 

This workflow will serve you well in the future:

* Create an RStudio project for an analytical project (a project for most modules is already created in RStudio Cloud)
* Keep inputs there (we will soon talk about importing)
* Keep scripts there; edit them, run them in bits or as a whole from there
* Keep outputs there (like the PDF written above)

Avoid using the mouse for pieces of your analytical workflow, such as loading a dataset or saving a figure. This is extremely important for the reproducibility and for making it possible to retrospectively determine how a numerical table or PDF was actually produced.

Learn and use shortcuts as much as possible. For instance Alt+- for the assignment operator and Ctrl+Shift+M for the pipe operator. A reference card of shortcuts can be seen using Alt+Shift+K.

Store your R commands in a script file and R scripts with a `.R` suffix. 

Comments start with one or more `#` symbols. Use them. RStudio helps you (de)comment selected lines with Ctrl+Shift+C (Windows and Linux) or Cmd+Shift+C (Mac).

Values saved in R are stored in *Objects*. 

The interactive DataCamp course gave an introduction to some basic programming concepts and terminology:

* *Data types*: integers, doubles/numerics, logicals, and characters.  Integers are values like -1, 0, 2, 4092. Doubles or numerics are a larger set of values containing both the integers but also fractions and decimal values like -24.932 and 0.8. Logicals are either `TRUE` or `FALSE` while characters are text such as "Hamilton", "The Wire is the greatest TV show ever", and "This ramen is delicious." Note that characters are often denoted with the quotation marks around them.
* *Vectors*: a series of values. These are created using the `c()` function, where `c()` stands for "combine" or "concatenate." For example, `c(6, 11, 13, 31, 90, 92)` creates a six element series of positive integer values \index{vectors}.
* *Factors*: *categorical data* are commonly represented in R as factors. Categorical data can also be represented as *strings*. 
* *Data frames*: rectangular spreadsheets. They are representations of datasets in R where the rows correspond to *observations* and the columns correspond to *variables* that describe the observations. 
* *Lists* are general containers that can be used to store a set of different objects under one name (that is, the name of the list) in an ordered way. These objects can be matrices, vectors, data frames, even other lists, etc. It is not even required that these objects are related to each other in any way.
* *Comparison operators* known to R are:

   - `<` for less than,
   - `>` for greater than,
   - `<=` for less than or equal to,
   - `>=` for greater than or equal to,
   - `==` for equal to each other (and not `=` which is typically used for assignment!),
   - `!=` not equal to each other.

<!--   + Logical operators: `&` representing "and" as well as `|` representing "or." For example, `(2 + 1 == 3) & (2 + 1 == 4)` returns `FALSE` since both clauses are not `TRUE` (only the first clause is `TRUE`). On the other hand, `(2 + 1 == 3) | (2 + 1 == 4)` returns `TRUE` since at least one of the two clauses is `TRUE`. \index{operators!logical} -->
<!-- * *Functions*, also called *commands*: Functions perform tasks in R. They take in inputs called *arguments* and return outputs. You can either manually specify a function's arguments or use the function's *default values*. \index{functions} -->

A *pipe* (`%>%`) sends the result of the left side of the pipe to be the first argument of the function on the right side of the pipe. Use pipes if you have many intermediate assignment operations.




You may also have a look at the [slides for this module](https://bss-osca.github.io/tfa/slides/05-02_r-workflow-slides.html).


## Exercises {#ex-r-workflow}

Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the [help page](#help). Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution! 

Practice using shortcuts in RStudio (use Shift+Alt+K to get an overview). [Link to the project on RStudio Cloud for this module][r-cloud-mod12]. 

### Exercise (group work)

_You are not expected to start solving this exercise before you meet in your group._

You have all been allocated into groups. During the course, you are expected to solve the R exercises in these groups. Before you start, it is a good idea to agree on a set of group rules:

   1) It is a good idea to have a shared place for your code. Have a look at the section [Working in groups](#groups) and decide on a place to share your code.
   1) Create a shared folder and project for your group.
   1) Agree on a coding convention.



<!-- ### Exercise (install packages) -->

<!-- *This exercise is done from the Console in RStudio (under Windows, [remember to have admin rights](#install-r)).* -->

<!-- ```{r, solution=TRUE, eval=FALSE, include=FALSE} -->
<!-- install.packages("devtools") -->
<!-- ``` -->

<!--    1) Install the package `devtools` using function `install.packages`. Note you can always get help/see documentation of a function by typing `?install.packages` or typing `install.packages` and press F1. -->

<!-- You now have installed the package from the default repository ([CRAN][cran]). -->

<!-- You may also install packages from other repositories (e.g. GitHub): -->

   <!-- 2) Have a look at the documentation for function `install_github` in the package `devtools`. This can be done in different ways: -->

   <!-- r -->
   <!-- library(devtools)    # we here load all the functions in devtools -->
   <!-- ?install_github -->

   <!-- ?devtools::install_github     # we here use the namespace devtools to load only one function -->


<!-- ```{r, echo=FALSE, eval=FALSE, include=FALSE} -->
<!-- devtools::install_github("bss-osca/tfa/tfa-package") -->
<!-- ``` -->

   <!-- 3) Install the package `tfa` from GitHub using path `bss-osca/tfa/tfa-package`. --> 



### Exercise (piping)

*Solve this exercise using a script file (e.g. `exercises/pipe.R` which already has been created). Remember that you can run a line in the file using Ctrl+Enter.* 

The pipe `%>%` can be used to perform operations sequentially without having to define intermediate objects (Ctrl+Shift+M). Have a look at the dataset `mtcars`: 


```r
head(mtcars)
?mtcars
```

The pipe


```r
library(tidyverse)
mtcars %>% select(cyl, gear, hp, mpg) %>% filter(gear == 4 & cyl == 4)
#>                cyl gear  hp  mpg
#> Datsun 710       4    4  93 22.8
#> Merc 240D        4    4  62 24.4
#> Merc 230         4    4  95 22.8
#> Fiat 128         4    4  66 32.4
#> Honda Civic      4    4  52 30.4
#> Toyota Corolla   4    4  65 33.9
#> Fiat X1-9        4    4  66 27.3
#> Volvo 142E       4    4 109 21.4
```

selects the columns related to cylinders, gears, horse power and miles, and then rows with cars having four cylinders and (operator `&`) gears. 


<div class="modal fade bs-example-modal-lg" id="YvM6THmpSftAz0A0bF9B" tabindex="-1" role="dialog" aria-labelledby="YvM6THmpSftAz0A0bF9B-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="YvM6THmpSftAz0A0bF9B-title">Solution</h4></div><div class="modal-body">

```r
mtcars %>% 
   select(mpg, hp, am, gear)
#>                      mpg  hp am gear
#> Mazda RX4           21.0 110  1    4
#> Mazda RX4 Wag       21.0 110  1    4
#> Datsun 710          22.8  93  1    4
#> Hornet 4 Drive      21.4 110  0    3
#> Hornet Sportabout   18.7 175  0    3
#> Valiant             18.1 105  0    3
#> Duster 360          14.3 245  0    3
#> Merc 240D           24.4  62  0    4
#> Merc 230            22.8  95  0    4
#> Merc 280            19.2 123  0    4
#> Merc 280C           17.8 123  0    4
#> Merc 450SE          16.4 180  0    3
#> Merc 450SL          17.3 180  0    3
#> Merc 450SLC         15.2 180  0    3
#> Cadillac Fleetwood  10.4 205  0    3
#> Lincoln Continental 10.4 215  0    3
#> Chrysler Imperial   14.7 230  0    3
#> Fiat 128            32.4  66  1    4
#> Honda Civic         30.4  52  1    4
#> Toyota Corolla      33.9  65  1    4
#> Toyota Corona       21.5  97  0    3
#> Dodge Challenger    15.5 150  0    3
#> AMC Javelin         15.2 150  0    3
#> Camaro Z28          13.3 245  0    3
#> Pontiac Firebird    19.2 175  0    3
#> Fiat X1-9           27.3  66  1    4
#> Porsche 914-2       26.0  91  1    5
#> Lotus Europa        30.4 113  1    5
#> Ford Pantera L      15.8 264  1    5
#> Ferrari Dino        19.7 175  1    5
#> Maserati Bora       15.0 335  1    5
#> Volvo 142E          21.4 109  1    4
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#YvM6THmpSftAz0A0bF9B">Solution</button>

<div class="modal fade bs-example-modal-lg" id="OpA43OXKkLzinvCVn03E" tabindex="-1" role="dialog" aria-labelledby="OpA43OXKkLzinvCVn03E-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="OpA43OXKkLzinvCVn03E-title">Hint</h4></div><div class="modal-body">

```r
mtcars %>% 
   select(___, ___, ___, ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#OpA43OXKkLzinvCVn03E">Hint</button>

1) Create a pipe that selects columns related to miles, horsepower, transmission and gears.



<div class="modal fade bs-example-modal-lg" id="YRhBtifoPHxtqYRoomHO" tabindex="-1" role="dialog" aria-labelledby="YRhBtifoPHxtqYRoomHO-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="YRhBtifoPHxtqYRoomHO-title">Solution</h4></div><div class="modal-body">

```r
mtcars %>% 
   select(mpg, hp, am, gear) %>% 
   filter(mpg < 20, gear == 4)
#>            mpg  hp am gear
#> Merc 280  19.2 123  0    4
#> Merc 280C 17.8 123  0    4
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#YRhBtifoPHxtqYRoomHO">Solution</button>

<div class="modal fade bs-example-modal-lg" id="wGv1JIG9x9XZFlitHo9b" tabindex="-1" role="dialog" aria-labelledby="wGv1JIG9x9XZFlitHo9b-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="wGv1JIG9x9XZFlitHo9b-title">Hint</h4></div><div class="modal-body">

```r
mtcars %>% 
   select(mpg, hp, am, gear) %>% 
   filter(___, ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#wGv1JIG9x9XZFlitHo9b">Hint</button>

2) Given the answer in 1), filter so cars have miles less than 20 and 4 gears.




<div class="modal fade bs-example-modal-lg" id="NqMkEln4ravXJIJKj5vP" tabindex="-1" role="dialog" aria-labelledby="NqMkEln4ravXJIJKj5vP-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="NqMkEln4ravXJIJKj5vP-title">Solution</h4></div><div class="modal-body">

```r
mtcars %>% 
   select(mpg, hp, am, gear) %>% 
   filter(mpg < 20 | gear == 4)
#>                      mpg  hp am gear
#> Mazda RX4           21.0 110  1    4
#> Mazda RX4 Wag       21.0 110  1    4
#> Datsun 710          22.8  93  1    4
#> Hornet Sportabout   18.7 175  0    3
#> Valiant             18.1 105  0    3
#> Duster 360          14.3 245  0    3
#> Merc 240D           24.4  62  0    4
#> Merc 230            22.8  95  0    4
#> Merc 280            19.2 123  0    4
#> Merc 280C           17.8 123  0    4
#> Merc 450SE          16.4 180  0    3
#> Merc 450SL          17.3 180  0    3
#> Merc 450SLC         15.2 180  0    3
#> Cadillac Fleetwood  10.4 205  0    3
#> Lincoln Continental 10.4 215  0    3
#> Chrysler Imperial   14.7 230  0    3
#> Fiat 128            32.4  66  1    4
#> Honda Civic         30.4  52  1    4
#> Toyota Corolla      33.9  65  1    4
#> Dodge Challenger    15.5 150  0    3
#> AMC Javelin         15.2 150  0    3
#> Camaro Z28          13.3 245  0    3
#> Pontiac Firebird    19.2 175  0    3
#> Fiat X1-9           27.3  66  1    4
#> Ford Pantera L      15.8 264  1    5
#> Ferrari Dino        19.7 175  1    5
#> Maserati Bora       15.0 335  1    5
#> Volvo 142E          21.4 109  1    4
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#NqMkEln4ravXJIJKj5vP">Solution</button>

<div class="modal fade bs-example-modal-lg" id="KunRH2QjS9aY1OW6pY2v" tabindex="-1" role="dialog" aria-labelledby="KunRH2QjS9aY1OW6pY2v-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="KunRH2QjS9aY1OW6pY2v-title">Hint</h4></div><div class="modal-body">

```r
mtcars %>% 
   select(mpg, hp, am, gear) %>% 
   filter(___ | ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#KunRH2QjS9aY1OW6pY2v">Hint</button>

3) Given the answer in 1), filter so cars have miles less than 20 or 4 gears. The "or" operator in R is `|`.



<div class="modal fade bs-example-modal-lg" id="OI6Ss1lgS9X7x35HQbhk" tabindex="-1" role="dialog" aria-labelledby="OI6Ss1lgS9X7x35HQbhk-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="OI6Ss1lgS9X7x35HQbhk-title">Solution</h4></div><div class="modal-body">

```r
mtcars %>% 
   filter(mpg < 20, gear == 4) %>% 
   select(wt, vs) 
#>             wt vs
#> Merc 280  3.44  1
#> Merc 280C 3.44  1
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#OI6Ss1lgS9X7x35HQbhk">Solution</button>

<div class="modal fade bs-example-modal-lg" id="BNac5byrecp8rQLllpLO" tabindex="-1" role="dialog" aria-labelledby="BNac5byrecp8rQLllpLO-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="BNac5byrecp8rQLllpLO-title">Hint</h4></div><div class="modal-body">

```r
mtcars %>% 
   filter(mpg < 20, gear == 4) %>% 
   select(___, ___) 
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#BNac5byrecp8rQLllpLO">Hint</button>

4) Create a pipe that filters the cars having miles less than 20 and 4 gears and selects columns related to weight and engine.




<div class="modal fade bs-example-modal-lg" id="0x9p8AHaU4TEB7J3GxOM" tabindex="-1" role="dialog" aria-labelledby="0x9p8AHaU4TEB7J3GxOM-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="0x9p8AHaU4TEB7J3GxOM-title">Solution</h4></div><div class="modal-body">

```r
dat <- mtcars 
dat <- filter(dat, mpg < 20, gear == 4) 
dat <- select(dat, wt, vs) 
dat
#>             wt vs
#> Merc 280  3.44  1
#> Merc 280C 3.44  1
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#0x9p8AHaU4TEB7J3GxOM">Solution</button>

<div class="modal fade bs-example-modal-lg" id="rEUGbsbdmJJlD0WvQXpn" tabindex="-1" role="dialog" aria-labelledby="rEUGbsbdmJJlD0WvQXpn-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="rEUGbsbdmJJlD0WvQXpn-title">Hint</h4></div><div class="modal-body">

```r
dat <- mtcars 
dat <- filter(dat, ___) 
dat <- select(dat, ___) 
dat
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#rEUGbsbdmJJlD0WvQXpn">Hint</button>

5) Solve Question 4 without the pipe operator. 




### Exercise (working dir)

*Do this exercise from the Console in RStudio.*

When reading and writing to local files, your working directory becomes important. You can get and set the working directory using functions `getwd` and `setwd`. 

Set the working directory to the project directory using the menu: **Session > Set Working Directory > To Project Directory**. Now let us create some files:


```r
   library(tidyverse)
   dir.create("subfolder", showWarnings = FALSE) 
   write_file("Some text in a file", file = "test1.txt")
   write_file("Some other text in a file", file = "subfolder/test2.txt")
```

1) Which folders and files have been created? You may have a look in the **Files** tab in RStudio.

We can read the file again using:


```r
read_file("test1.txt")
```



<div class="modal fade bs-example-modal-lg" id="0h0Hscnp0X1fCkQB3aMP" tabindex="-1" role="dialog" aria-labelledby="0h0Hscnp0X1fCkQB3aMP-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="0h0Hscnp0X1fCkQB3aMP-title">Solution</h4></div><div class="modal-body">

```r
read_file("subfolder/test2.txt")
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#0h0Hscnp0X1fCkQB3aMP">Solution</button>

<div class="modal fade bs-example-modal-lg" id="JjKfAl3l7pr7ZLi5aGrR" tabindex="-1" role="dialog" aria-labelledby="JjKfAl3l7pr7ZLi5aGrR-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="JjKfAl3l7pr7ZLi5aGrR-title">Hint</h4></div><div class="modal-body">

```r
read_file("subfolder/___")
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#JjKfAl3l7pr7ZLi5aGrR">Hint</button>

2) Read the file `test2.txt`.



3) Set the working directory to `subfolder` using function `setwd`. Note that `setwd` supports relative paths. Check that you are in the right working directory using `getwd`. You may also have a look at the files in the directory using function `list.files`.




<div class="modal fade bs-example-modal-lg" id="Qedl291Kc9MIZwF5R65J" tabindex="-1" role="dialog" aria-labelledby="Qedl291Kc9MIZwF5R65J-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Qedl291Kc9MIZwF5R65J-title">Solution</h4></div><div class="modal-body">

```r
setwd("subfolder")  # done in Q3
read_file("../test1.txt")
read_file("test2.txt")
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Qedl291Kc9MIZwF5R65J">Solution</button>

<div class="modal fade bs-example-modal-lg" id="1Q0xdPAVnX6Wy6FZgWe1" tabindex="-1" role="dialog" aria-labelledby="1Q0xdPAVnX6Wy6FZgWe1-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="1Q0xdPAVnX6Wy6FZgWe1-title">Hint</h4></div><div class="modal-body">

```r
setwd("subfolder")  # done in Q3
read_file("../___")
read_file("___")
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#1Q0xdPAVnX6Wy6FZgWe1">Hint</button>

4) Read files `test1.txt` and `test2.txt`. Note that in relative paths `../` means going to the parent folder.  What is different compared to Question 2?






### Exercise (vectors)

*Solve this exercise using a script file.*


<div class="modal fade bs-example-modal-lg" id="rTIspztLt5rvFIJtrEe5" tabindex="-1" role="dialog" aria-labelledby="rTIspztLt5rvFIJtrEe5-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="rTIspztLt5rvFIJtrEe5-title">Solution</h4></div><div class="modal-body">

```r
n <- 100
n * (n+1) / 2
#> [1] 5050
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#rTIspztLt5rvFIJtrEe5">Solution</button>

1) What is the sum of the first 100 positive integers? The formula for the sum of integers $1$ through $n$ is $n(n+1)/2$. Define $n=100$ and then use R to compute the sum of $1$ through $100$ using the formula. What is the sum?



<div class="modal fade bs-example-modal-lg" id="9RqtL7UBnR5ZrEnZ5YyH" tabindex="-1" role="dialog" aria-labelledby="9RqtL7UBnR5ZrEnZ5YyH-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="9RqtL7UBnR5ZrEnZ5YyH-title">Solution</h4></div><div class="modal-body">

```r
n <- 1000
n * (n+1) / 2
#> [1] 5e+05
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#9RqtL7UBnR5ZrEnZ5YyH">Solution</button>

2) Now use the same formula to compute the sum of the integers from 1 through 1000.




<div class="modal fade bs-example-modal-lg" id="0xJpoCr57lK4ITfkFa30" tabindex="-1" role="dialog" aria-labelledby="0xJpoCr57lK4ITfkFa30-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="0xJpoCr57lK4ITfkFa30-title">Solution</h4></div><div class="modal-body">

<p>The answer is b).</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#0xJpoCr57lK4ITfkFa30">Solution</button>

3) Look at the result of typing the following code into R:

   
   ```r
   n <- 1000
   x <- seq(1, n)
   sum(x)
   ```

   Based on the result, what do you think the functions `seq` and `sum` do?  You can use e.g `help("sum")` or `?sum`.

   a. `sum` creates a list of numbers and `seq` adds them up.
   b. `seq` creates a list of numbers and `sum` adds them up.
   c. `seq` creates a random list and `sum` computes the sum of 1 through 1,000.
   d. `sum` always returns the same number.



<div class="modal fade bs-example-modal-lg" id="8d1ItWeY41SAw5ZzXFTK" tabindex="-1" role="dialog" aria-labelledby="8d1ItWeY41SAw5ZzXFTK-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="8d1ItWeY41SAw5ZzXFTK-title">Solution</h4></div><div class="modal-body">

<p>Sample 30 integers in the range [1, 100].</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#8d1ItWeY41SAw5ZzXFTK">Solution</button>

4) Run code. What does `sample.int` do (try running `?sample.int`)?

   
   ```r
   set.seed(123)
   v <- sample.int(100,30)
   v
   #>  [1] 31 79 51 14 67 42 50 43 97 25 90 69 57  9 72 26  7 95 87 36 78 93 76 15 32 84 82 41 23 27
   ```



<div class="modal fade bs-example-modal-lg" id="2Rn7YC7ktNf5NHoRoonR" tabindex="-1" role="dialog" aria-labelledby="2Rn7YC7ktNf5NHoRoonR-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="2Rn7YC7ktNf5NHoRoonR-title">Solution</h4></div><div class="modal-body">

```r
sum(v)
#> [1] 1598
mean(v)
#> [1] 53.3
sd(v)
#> [1] 28.8
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#2Rn7YC7ktNf5NHoRoonR">Solution</button>

5) What is the sum, mean, and standard deviation of `v`? 



<div class="modal fade bs-example-modal-lg" id="kdi0TDNbL6FfPm6QztsA" tabindex="-1" role="dialog" aria-labelledby="kdi0TDNbL6FfPm6QztsA-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="kdi0TDNbL6FfPm6QztsA-title">Solution</h4></div><div class="modal-body">

```r
v[c(1, 6, 4, 15)]
#> [1] 31 42 14 72
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#kdi0TDNbL6FfPm6QztsA">Solution</button>

<div class="modal fade bs-example-modal-lg" id="8eLeJBm5SVbKUxTtubP9" tabindex="-1" role="dialog" aria-labelledby="8eLeJBm5SVbKUxTtubP9-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="8eLeJBm5SVbKUxTtubP9-title">Hint</h4></div><div class="modal-body">

```r
v[c(1, ___, ___, ___)]
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#8eLeJBm5SVbKUxTtubP9">Hint</button>

6) Select elements 1, 6, 4, and 15 of `v`.



<div class="modal fade bs-example-modal-lg" id="vI3wi8YxaPeJJDMz958g" tabindex="-1" role="dialog" aria-labelledby="vI3wi8YxaPeJJDMz958g-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="vI3wi8YxaPeJJDMz958g-title">Solution</h4></div><div class="modal-body">

```r
v[v > 50]
#>  [1] 79 51 67 97 90 69 57 72 95 87 78 93 76 84 82
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#vI3wi8YxaPeJJDMz958g">Solution</button>

7) Select elements with value above 50.



<div class="modal fade bs-example-modal-lg" id="ctfjWeomyRJP0BqEE4Fj" tabindex="-1" role="dialog" aria-labelledby="ctfjWeomyRJP0BqEE4Fj-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="ctfjWeomyRJP0BqEE4Fj-title">Solution</h4></div><div class="modal-body">

```r
v[v > 75 | v < 25]
#>  [1] 79 14 97 90  9  7 95 87 78 93 76 15 84 82 23
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ctfjWeomyRJP0BqEE4Fj">Solution</button>

<div class="modal fade bs-example-modal-lg" id="qUOF6OZDRDVLeNMXjDPG" tabindex="-1" role="dialog" aria-labelledby="qUOF6OZDRDVLeNMXjDPG-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="qUOF6OZDRDVLeNMXjDPG-title">Hint</h4></div><div class="modal-body">

```r
v[___ | ___]
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#qUOF6OZDRDVLeNMXjDPG">Hint</button>

8) Select elements with value above 75 or below 25.



<div class="modal fade bs-example-modal-lg" id="dBrkfcNWsaqJhGaTGZut" tabindex="-1" role="dialog" aria-labelledby="dBrkfcNWsaqJhGaTGZut-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="dBrkfcNWsaqJhGaTGZut-title">Solution</h4></div><div class="modal-body">

```r
v[v == 43]
#> [1] 43
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#dBrkfcNWsaqJhGaTGZut">Solution</button>

9) Select elements with value 43.



<div class="modal fade bs-example-modal-lg" id="GJzcwSPe9ZExbVOsMHAA" tabindex="-1" role="dialog" aria-labelledby="GJzcwSPe9ZExbVOsMHAA-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="GJzcwSPe9ZExbVOsMHAA-title">Solution</h4></div><div class="modal-body">

```r
v[is.na(v)]
#> integer(0)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#GJzcwSPe9ZExbVOsMHAA">Solution</button>

<div class="modal fade bs-example-modal-lg" id="TFDf2hLPouHxjg3OTYhu" tabindex="-1" role="dialog" aria-labelledby="TFDf2hLPouHxjg3OTYhu-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="TFDf2hLPouHxjg3OTYhu-title">Hint</h4></div><div class="modal-body">

```r
v[is.na(___)]
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#TFDf2hLPouHxjg3OTYhu">Hint</button>

10) Select elements with value `NA`.



<div class="modal fade bs-example-modal-lg" id="cQX3GOCp9nXfAdJiOyxj" tabindex="-1" role="dialog" aria-labelledby="cQX3GOCp9nXfAdJiOyxj-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="cQX3GOCp9nXfAdJiOyxj-title">Solution</h4></div><div class="modal-body">

```r
which(v > 75 | v < 25)
#>  [1]  2  4  9 11 14 17 18 19 21 22 23 24 26 27 29
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#cQX3GOCp9nXfAdJiOyxj">Solution</button>

<div class="modal fade bs-example-modal-lg" id="FDaGWmAPTrvsfwWZKL1V" tabindex="-1" role="dialog" aria-labelledby="FDaGWmAPTrvsfwWZKL1V-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="FDaGWmAPTrvsfwWZKL1V-title">Hint</h4></div><div class="modal-body">

```r
which(___ | ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#FDaGWmAPTrvsfwWZKL1V">Hint</button>

11) Which elements have value above 75 or below 25? Hint: see the documentation of function `which` (`?which`).




### Exercise (matrices)

*Solve this exercise using a script file.*

Consider matrices


```r
m1 <- matrix(c(37, 8, 51, NA, 50, 97, 86, NA, 84, 46, 17, 62L), nrow = 3)
m2 <- matrix(c(37, 8, 51, NA, 50, 97, 86, NA, 84, 46, 17, 62L), nrow = 3, byrow = TRUE)
m3 <- matrix(c(37, 8, 51, NA, 50, 97, 86, NA, 84, 46, 17, 62L), ncol = 3)
```

1) What is the difference between the three matrices (think/discuss before running the code).



<div class="modal fade bs-example-modal-lg" id="s04AljyS4el8OD3O4E3f" tabindex="-1" role="dialog" aria-labelledby="s04AljyS4el8OD3O4E3f-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="s04AljyS4el8OD3O4E3f-title">Solution</h4></div><div class="modal-body">

```r
rowSums(m1, na.rm = T)
#> [1] 169  75 294
colSums(m2, na.rm = T)
#> [1] 171 151 154  62
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#s04AljyS4el8OD3O4E3f">Solution</button>

<div class="modal fade bs-example-modal-lg" id="I64skoy66nm0mjdT90SU" tabindex="-1" role="dialog" aria-labelledby="I64skoy66nm0mjdT90SU-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="I64skoy66nm0mjdT90SU-title">Hint</h4></div><div class="modal-body">

```r
rowSums(___, na.rm = ___)
colSums(___, na.rm = ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#I64skoy66nm0mjdT90SU">Hint</button>

2) Calculate the row sums of `m1` and column sums of `m2` ignoring `NA` values. Hint: have a look at the documentation of `rowSums`.



<div class="modal fade bs-example-modal-lg" id="OSi3LnpELrqI9h62z2Ku" tabindex="-1" role="dialog" aria-labelledby="OSi3LnpELrqI9h62z2Ku-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="OSi3LnpELrqI9h62z2Ku-title">Solution</h4></div><div class="modal-body">

```r
rbind(m1, c(1, 2, 3, 4))
#>      [,1] [,2] [,3] [,4]
#> [1,]   37   NA   86   46
#> [2,]    8   50   NA   17
#> [3,]   51   97   84   62
#> [4,]    1    2    3    4
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#OSi3LnpELrqI9h62z2Ku">Solution</button>

<div class="modal fade bs-example-modal-lg" id="cHjpJUhddyP7WDUMyOEc" tabindex="-1" role="dialog" aria-labelledby="cHjpJUhddyP7WDUMyOEc-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="cHjpJUhddyP7WDUMyOEc-title">Hint</h4></div><div class="modal-body">

```r
rbind(___, ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#cHjpJUhddyP7WDUMyOEc">Hint</button>

3) Add row `c(1, 2, 3, 4)` as last row to `m1`. 



<div class="modal fade bs-example-modal-lg" id="8xVAczfPKp8BtJMmB1PT" tabindex="-1" role="dialog" aria-labelledby="8xVAczfPKp8BtJMmB1PT-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="8xVAczfPKp8BtJMmB1PT-title">Solution</h4></div><div class="modal-body">

```r
rbind(c(1, 2, 3, 4), m1)
#>      [,1] [,2] [,3] [,4]
#> [1,]    1    2    3    4
#> [2,]   37   NA   86   46
#> [3,]    8   50   NA   17
#> [4,]   51   97   84   62
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#8xVAczfPKp8BtJMmB1PT">Solution</button>

<div class="modal fade bs-example-modal-lg" id="QLrSXxmCJyalNlXuBH5D" tabindex="-1" role="dialog" aria-labelledby="QLrSXxmCJyalNlXuBH5D-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="QLrSXxmCJyalNlXuBH5D-title">Hint</h4></div><div class="modal-body">

```r
rbind(___, ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#QLrSXxmCJyalNlXuBH5D">Hint</button>

4) Add row `c(1, 2, 3, 4)` as first row to `m1`. 



<div class="modal fade bs-example-modal-lg" id="yIjm6EG67zz8uZORh5Lg" tabindex="-1" role="dialog" aria-labelledby="yIjm6EG67zz8uZORh5Lg-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="yIjm6EG67zz8uZORh5Lg-title">Solution</h4></div><div class="modal-body">

```r
cbind(m3, c(1, 2, 3, 4))
#>      [,1] [,2] [,3] [,4]
#> [1,]   37   50   84    1
#> [2,]    8   97   46    2
#> [3,]   51   86   17    3
#> [4,]   NA   NA   62    4
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#yIjm6EG67zz8uZORh5Lg">Solution</button>

<div class="modal fade bs-example-modal-lg" id="JpDUHBwJT1XdaJtcIO9r" tabindex="-1" role="dialog" aria-labelledby="JpDUHBwJT1XdaJtcIO9r-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="JpDUHBwJT1XdaJtcIO9r-title">Hint</h4></div><div class="modal-body">

```r
cbind(___, ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#JpDUHBwJT1XdaJtcIO9r">Hint</button>

5) Add column `c(1, 2, 3, 4)` as last column to `m3`.



<div class="modal fade bs-example-modal-lg" id="xYKzEb6U69HajArhl9Mf" tabindex="-1" role="dialog" aria-labelledby="xYKzEb6U69HajArhl9Mf-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="xYKzEb6U69HajArhl9Mf-title">Solution</h4></div><div class="modal-body">

```r
m1[2,4]
#> [1] 17
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#xYKzEb6U69HajArhl9Mf">Solution</button>

6) Select the element in row 2 and column 4 of `m1`. 



<div class="modal fade bs-example-modal-lg" id="WLE3Etok97yRSAaGEgHo" tabindex="-1" role="dialog" aria-labelledby="WLE3Etok97yRSAaGEgHo-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="WLE3Etok97yRSAaGEgHo-title">Solution</h4></div><div class="modal-body">

```r
m1[2:3,1:2]
#>      [,1] [,2]
#> [1,]    8   50
#> [2,]   51   97
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#WLE3Etok97yRSAaGEgHo">Solution</button>

<div class="modal fade bs-example-modal-lg" id="5oQkfRc0DhDoJgv77gQp" tabindex="-1" role="dialog" aria-labelledby="5oQkfRc0DhDoJgv77gQp-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="5oQkfRc0DhDoJgv77gQp-title">Hint</h4></div><div class="modal-body">

```r
m1[2:3,___]
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#5oQkfRc0DhDoJgv77gQp">Hint</button>

7) Select elements in rows 2-3 and columns 1-2 of `m1`. 



<div class="modal fade bs-example-modal-lg" id="y4Sh5zF3gmLMH4MBXVwL" tabindex="-1" role="dialog" aria-labelledby="y4Sh5zF3gmLMH4MBXVwL-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="y4Sh5zF3gmLMH4MBXVwL-title">Solution</h4></div><div class="modal-body">

```r
m1[3, c(1,3,4)]
#> [1] 51 84 62
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#y4Sh5zF3gmLMH4MBXVwL">Solution</button>

<div class="modal fade bs-example-modal-lg" id="S5rOjASl3oIMJ2Wgu1zI" tabindex="-1" role="dialog" aria-labelledby="S5rOjASl3oIMJ2Wgu1zI-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="S5rOjASl3oIMJ2Wgu1zI-title">Hint</h4></div><div class="modal-body">

```r
m1[3,___]
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#S5rOjASl3oIMJ2Wgu1zI">Hint</button>

8) Select elements in row 3 and columns 1, 3 and 4 of `m1`. 



<div class="modal fade bs-example-modal-lg" id="wgRo2jLpXHn5pHkx5qnN" tabindex="-1" role="dialog" aria-labelledby="wgRo2jLpXHn5pHkx5qnN-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="wgRo2jLpXHn5pHkx5qnN-title">Solution</h4></div><div class="modal-body">

```r
m1[3,]
#> [1] 51 97 84 62
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#wgRo2jLpXHn5pHkx5qnN">Solution</button>

9) Select elements in row 3 of `m1`. 



<div class="modal fade bs-example-modal-lg" id="KCZtWafWV12vlCeeOoXs" tabindex="-1" role="dialog" aria-labelledby="KCZtWafWV12vlCeeOoXs-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="KCZtWafWV12vlCeeOoXs-title">Solution</h4></div><div class="modal-body">

```r
m2[is.na(m2)]
#> [1] NA NA
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#KCZtWafWV12vlCeeOoXs">Solution</button>

<div class="modal fade bs-example-modal-lg" id="YuaQwhP1ZUsoqMs9Hfya" tabindex="-1" role="dialog" aria-labelledby="YuaQwhP1ZUsoqMs9Hfya-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="YuaQwhP1ZUsoqMs9Hfya-title">Hint</h4></div><div class="modal-body">

```r
m2[is.na(___)]
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#YuaQwhP1ZUsoqMs9Hfya">Hint</button>

10) Select all `NA` elements in `m2`. 



<div class="modal fade bs-example-modal-lg" id="W3y75sVKt1EgEJAn9pKN" tabindex="-1" role="dialog" aria-labelledby="W3y75sVKt1EgEJAn9pKN-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="W3y75sVKt1EgEJAn9pKN-title">Solution</h4></div><div class="modal-body">

```r
m2[m2 > 50]
#> [1] 84 97 51 86 NA NA 62
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#W3y75sVKt1EgEJAn9pKN">Solution</button>

11) Select all elements greater that 50 in `m2`. 



### Exercise (data frames)

*Solve this exercise using a script file.*

Data frames may be seen as cell blocks in Excel. They are representations of datasets in R where the rows correspond to *observations* and the columns correspond to *variables* that describe the observations. 

We consider the data frame `mtcars`:


```r
str(mtcars)
glimpse(mtcars)
?mtcars
```

1) Use the `head` and `tail` functions to have a look at the data.



<div class="modal fade bs-example-modal-lg" id="d51zamtky2urmN2MGqMI" tabindex="-1" role="dialog" aria-labelledby="d51zamtky2urmN2MGqMI-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="d51zamtky2urmN2MGqMI-title">Solution</h4></div><div class="modal-body">

```r
mtcars[,4]
#>  [1] 110 110  93 110 175 105 245  62  95 123 123 180 180 180 205 215 230  66  52  65  97 150 150 245
#> [25] 175  66  91 113 264 175 335 109
mtcars[,"hp"]
#>  [1] 110 110  93 110 175 105 245  62  95 123 123 180 180 180 205 215 230  66  52  65  97 150 150 245
#> [25] 175  66  91 113 264 175 335 109
mtcars$hp
#>  [1] 110 110  93 110 175 105 245  62  95 123 123 180 180 180 205 215 230  66  52  65  97 150 150 245
#> [25] 175  66  91 113 264 175 335 109
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#d51zamtky2urmN2MGqMI">Solution</button>

<div class="modal fade bs-example-modal-lg" id="lqSj6DxkoPantN5ck5Ic" tabindex="-1" role="dialog" aria-labelledby="lqSj6DxkoPantN5ck5Ic-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="lqSj6DxkoPantN5ck5Ic-title">Hint</h4></div><div class="modal-body">

```r
mtcars[,___]
mtcars[,"___"]
mtcars$___
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#lqSj6DxkoPantN5ck5Ic">Hint</button>

2) Select column `hp` using index (column 4), its name, and the `$` operator.




<div class="modal fade bs-example-modal-lg" id="kuTZjru3VLqn7iE4w9eA" tabindex="-1" role="dialog" aria-labelledby="kuTZjru3VLqn7iE4w9eA-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="kuTZjru3VLqn7iE4w9eA-title">Solution</h4></div><div class="modal-body">

```r
mtcars <- rbind(mtcars, 
   c(34, 3, 87, 112, 4.5, 1.515, 167, 1, 1, 5, 3))
rownames(mtcars)[33] <- "Phantom XE"
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#kuTZjru3VLqn7iE4w9eA">Solution</button>

<div class="modal fade bs-example-modal-lg" id="1W5HQaoCSRjipsxYWATF" tabindex="-1" role="dialog" aria-labelledby="1W5HQaoCSRjipsxYWATF-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="1W5HQaoCSRjipsxYWATF-title">Hint</h4></div><div class="modal-body">

```r
mtcars <- rbind(mtcars, ___)
rownames(mtcars)[___] <- "Phantom XE"
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#1W5HQaoCSRjipsxYWATF">Hint</button>

3) Update `mtcars` by adding row `c(34, 3, 87, 112, 4.5, 1.515, 167, 1, 1, 5, 3)`. Name the row 'Phantom XE'.



<div class="modal fade bs-example-modal-lg" id="2dX8HaA5QMqG1rKdXNBQ" tabindex="-1" role="dialog" aria-labelledby="2dX8HaA5QMqG1rKdXNBQ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="2dX8HaA5QMqG1rKdXNBQ-title">Solution</h4></div><div class="modal-body">

```r
col <- c(NA, "green", "blue", "red", NA, "blue", "green", "blue", "red", "red", 
   "blue", "green", "blue", "blue", "green", "red", "red", NA, NA, "red", 
   "green", "red", "red", NA, "green", NA, "blue", "green", "green", "red", 
   "green", "blue", NA)
mtcars <- cbind(mtcars, col)
class(mtcars$col)
#> [1] "character"
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#2dX8HaA5QMqG1rKdXNBQ">Solution</button>

<div class="modal fade bs-example-modal-lg" id="dWejUN00z6Piksbkqbn1" tabindex="-1" role="dialog" aria-labelledby="dWejUN00z6Piksbkqbn1-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="dWejUN00z6Piksbkqbn1-title">Hint</h4></div><div class="modal-body">

```r
col <- c(NA, "green", ......)
mtcars <- cbind(mtcars, ___)
class(mtcars$___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#dWejUN00z6Piksbkqbn1">Hint</button>

4) Update `mtcars` by adding column:

   
   ```r
   col <- c(NA, "green", "blue", "red", NA, "blue", "green", "blue", "red", "red", 
            "blue", "green", "blue", "blue", "green", "red", "red", NA, NA, "red", 
            "green", "red", "red", NA, "green", NA, "blue", "green", "green", 
            "red", "green", "blue", NA)
   ```
   
   What class is column `col`?




<div class="modal fade bs-example-modal-lg" id="PsevAJnzJ0z93bJWn4hw" tabindex="-1" role="dialog" aria-labelledby="PsevAJnzJ0z93bJWn4hw-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="PsevAJnzJ0z93bJWn4hw-title">Solution</h4></div><div class="modal-body">

```r
mtcars[mtcars$vs == 0,]
#>                      mpg cyl disp  hp drat   wt qsec vs am gear carb   col
#> Mazda RX4           21.0   6  160 110 3.90 2.62 16.5  0  1    4    4  <NA>
#> Mazda RX4 Wag       21.0   6  160 110 3.90 2.88 17.0  0  1    4    4 green
#> Hornet Sportabout   18.7   8  360 175 3.15 3.44 17.0  0  0    3    2  <NA>
#> Duster 360          14.3   8  360 245 3.21 3.57 15.8  0  0    3    4 green
#> Merc 450SE          16.4   8  276 180 3.07 4.07 17.4  0  0    3    3 green
#> Merc 450SL          17.3   8  276 180 3.07 3.73 17.6  0  0    3    3  blue
#> Merc 450SLC         15.2   8  276 180 3.07 3.78 18.0  0  0    3    3  blue
#> Cadillac Fleetwood  10.4   8  472 205 2.93 5.25 18.0  0  0    3    4 green
#> Lincoln Continental 10.4   8  460 215 3.00 5.42 17.8  0  0    3    4   red
#> Chrysler Imperial   14.7   8  440 230 3.23 5.34 17.4  0  0    3    4   red
#> Dodge Challenger    15.5   8  318 150 2.76 3.52 16.9  0  0    3    2   red
#> AMC Javelin         15.2   8  304 150 3.15 3.44 17.3  0  0    3    2   red
#> Camaro Z28          13.3   8  350 245 3.73 3.84 15.4  0  0    3    4  <NA>
#> Pontiac Firebird    19.2   8  400 175 3.08 3.85 17.1  0  0    3    2 green
#> Porsche 914-2       26.0   4  120  91 4.43 2.14 16.7  0  1    5    2  blue
#> Ford Pantera L      15.8   8  351 264 4.22 3.17 14.5  0  1    5    4 green
#> Ferrari Dino        19.7   6  145 175 3.62 2.77 15.5  0  1    5    6   red
#> Maserati Bora       15.0   8  301 335 3.54 3.57 14.6  0  1    5    8 green
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#PsevAJnzJ0z93bJWn4hw">Solution</button>

<div class="modal fade bs-example-modal-lg" id="HF94YUUt2CVEZTZ89Pge" tabindex="-1" role="dialog" aria-labelledby="HF94YUUt2CVEZTZ89Pge-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="HF94YUUt2CVEZTZ89Pge-title">Hint</h4></div><div class="modal-body">

```r
mtcars[mtcars$___ == 0,]
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#HF94YUUt2CVEZTZ89Pge">Hint</button>

5) Select cars with a V-shaped engine.




### Exercise (lists)

*Solve this exercise using a script file.*

Lists are general containers that can be used to store a set of different objects under one name (that is, the name of the list) in an ordered way. These objects can be matrices, vectors, data frames, even other lists, etc.

Let us define a list:


```r
lst <- list(45, "Lars", TRUE, 80.5)
lst
#> [[1]]
#> [1] 45
#> 
#> [[2]]
#> [1] "Lars"
#> 
#> [[3]]
#> [1] TRUE
#> 
#> [[4]]
#> [1] 80.5
```

Elements can be accessed using brackets:


```r
x <- lst[2]
x
#> [[1]]
#> [1] "Lars"
y <- lst[[2]]
y
#> [1] "Lars"
```


<div class="modal fade bs-example-modal-lg" id="uofo7FKPdoGo0eoSC1Hu" tabindex="-1" role="dialog" aria-labelledby="uofo7FKPdoGo0eoSC1Hu-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="uofo7FKPdoGo0eoSC1Hu-title">Solution</h4></div><div class="modal-body">

```r
class(x)
#> [1] "list"
class(y)
#> [1] "character"
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#uofo7FKPdoGo0eoSC1Hu">Solution</button>

<div class="modal fade bs-example-modal-lg" id="vXDUnP6HMGTM72GyUTkf" tabindex="-1" role="dialog" aria-labelledby="vXDUnP6HMGTM72GyUTkf-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="vXDUnP6HMGTM72GyUTkf-title">Hint</h4></div><div class="modal-body">

```r
class(___)
class(___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#vXDUnP6HMGTM72GyUTkf">Hint</button>

1) What is the class of the two objects `x` and `y`? What is the difference between using one or two brackets?



<div class="modal fade bs-example-modal-lg" id="3hMsm8I7aYgJbzk4R3Lj" tabindex="-1" role="dialog" aria-labelledby="3hMsm8I7aYgJbzk4R3Lj-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="3hMsm8I7aYgJbzk4R3Lj-title">Solution</h4></div><div class="modal-body">

```r
names(lst) <- c("age", "name", "male", "weight")
lst
#> $age
#> [1] 45
#> 
#> $name
#> [1] "Lars"
#> 
#> $male
#> [1] TRUE
#> 
#> $weight
#> [1] 80.5
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#3hMsm8I7aYgJbzk4R3Lj">Solution</button>

<div class="modal fade bs-example-modal-lg" id="0lSifZheH6xjb7YGt0E8" tabindex="-1" role="dialog" aria-labelledby="0lSifZheH6xjb7YGt0E8-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="0lSifZheH6xjb7YGt0E8-title">Hint</h4></div><div class="modal-body">

```r
names(lst) <- c("age", ___, ___, ___)
lst
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#0lSifZheH6xjb7YGt0E8">Hint</button>

2) Add names *age, name, male and weight* to the 4 components of the list.



<div class="modal fade bs-example-modal-lg" id="KjziVRw74tQ2eTcG97VX" tabindex="-1" role="dialog" aria-labelledby="KjziVRw74tQ2eTcG97VX-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="KjziVRw74tQ2eTcG97VX-title">Solution</h4></div><div class="modal-body">

```r
lst$name
#> [1] "Lars"
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#KjziVRw74tQ2eTcG97VX">Solution</button>

3) Extract the name component using the `$` operator.


You can add/change/remove components using:


```r
lst$height <- 173  # add component
lst$name <- list(first = "Lars", last = "Nielsen")  # change the name component
lst$male <- NULL   # remove male component
lst
#> $age
#> [1] 45
#> 
#> $name
#> $name$first
#> [1] "Lars"
#> 
#> $name$last
#> [1] "Nielsen"
#> 
#> 
#> $weight
#> [1] 80.5
#> 
#> $height
#> [1] 173
```



<div class="modal fade bs-example-modal-lg" id="8AlWrf0gtd6vf9kwQIGD" tabindex="-1" role="dialog" aria-labelledby="8AlWrf0gtd6vf9kwQIGD-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="8AlWrf0gtd6vf9kwQIGD-title">Solution</h4></div><div class="modal-body">

```r
lst$name$last
#> [1] "Nielsen"
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#8AlWrf0gtd6vf9kwQIGD">Solution</button>

<div class="modal fade bs-example-modal-lg" id="ZkfXol1N3nvXqafVluo4" tabindex="-1" role="dialog" aria-labelledby="ZkfXol1N3nvXqafVluo4-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="ZkfXol1N3nvXqafVluo4-title">Hint</h4></div><div class="modal-body">

```r
lst$name$___
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ZkfXol1N3nvXqafVluo4">Hint</button>

4) Extract the last name component using the `$` operator.


### Exercise (string management) {#ex-strings}

Strings in R can be defined using single or double quotes:


```r
str1 <- "Business Analytics (BA) refers to the scientific process of transforming data into insight for making better decisions in business."

str2 <- 'BA can both be seen as the complete decision making process for solving a business problem or as a set of methodologies that enable the creation of business value.'

str3 <- c(str1, str2)  # vector of strings
```

The stringr package in tidyverse provides many useful functions for string manipulation. We will consider a few. 


```r
str4 <- str_c(str1, 
      str2, 
      "As a process it can be characterized by descriptive, predictive, and prescriptive model building using data sources.",
      sep = " ")   # join strings
str4
#> [1] "Business Analytics (BA) refers to the scientific process of transforming data into insight for making better decisions in business. BA can both be seen as the complete decision making process for solving a business problem or as a set of methodologies that enable the creation of business value. As a process it can be characterized by descriptive, predictive, and prescriptive model building using data sources."
str_c(str3, collapse = " ")    # collapse vector to a string
#> [1] "Business Analytics (BA) refers to the scientific process of transforming data into insight for making better decisions in business. BA can both be seen as the complete decision making process for solving a business problem or as a set of methodologies that enable the creation of business value."

str_replace(str2, "BA", "Business Analytics")  # replace first occurrence
#> [1] "Business Analytics can both be seen as the complete decision making process for solving a business problem or as a set of methodologies that enable the creation of business value."
str_replace_all(str2, "the", "a")              # replace all occurrences
#> [1] "BA can both be seen as a complete decision making process for solving a business problem or as a set of methodologies that enable a creation of business value."

str_remove(str1, " for making better decisions in business")
#> [1] "Business Analytics (BA) refers to the scientific process of transforming data into insight."

str_detect(str2, "BA")  # detect a pattern
#> [1] TRUE
```



<div class="modal fade bs-example-modal-lg" id="03rZJxaWNJo2MrhgLY8m" tabindex="-1" role="dialog" aria-labelledby="03rZJxaWNJo2MrhgLY8m-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="03rZJxaWNJo2MrhgLY8m-title">Solution</h4></div><div class="modal-body">

```r
str_detect(str1, "Business")
#> [1] TRUE
str_detect(str2, "Business")
#> [1] FALSE
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#03rZJxaWNJo2MrhgLY8m">Solution</button>

<div class="modal fade bs-example-modal-lg" id="sClax9Wsr1yUOP5APLPI" tabindex="-1" role="dialog" aria-labelledby="sClax9Wsr1yUOP5APLPI-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="sClax9Wsr1yUOP5APLPI-title">Hint</h4></div><div class="modal-body">

```r
str_detect(str1, ___)
str_detect(___, ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#sClax9Wsr1yUOP5APLPI">Hint</button>

1) Is `Business` (case sensitive) contained in `str1` and `str2`?



<div class="modal fade bs-example-modal-lg" id="Y9x2Nxe3PQVRc8uZX7lT" tabindex="-1" role="dialog" aria-labelledby="Y9x2Nxe3PQVRc8uZX7lT-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Y9x2Nxe3PQVRc8uZX7lT-title">Solution</h4></div><div class="modal-body">

```r
str5 <- str_replace(str2, "BA", "Business Analytics") 
str5
#> [1] "Business Analytics can both be seen as the complete decision making process for solving a business problem or as a set of methodologies that enable the creation of business value."
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Y9x2Nxe3PQVRc8uZX7lT">Solution</button>

<div class="modal fade bs-example-modal-lg" id="m2oGHdw0LPSivctk89BQ" tabindex="-1" role="dialog" aria-labelledby="m2oGHdw0LPSivctk89BQ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="m2oGHdw0LPSivctk89BQ-title">Hint</h4></div><div class="modal-body">

```r
str5 <- str_replace(str2, ___, ___) 
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#m2oGHdw0LPSivctk89BQ">Hint</button>

2) Define a new string that replace `BA` with `Business Analytics` in `str2`



<div class="modal fade bs-example-modal-lg" id="5DZOZpdOh6Ga9qqTlI4R" tabindex="-1" role="dialog" aria-labelledby="5DZOZpdOh6Ga9qqTlI4R-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="5DZOZpdOh6Ga9qqTlI4R-title">Solution</h4></div><div class="modal-body">

```r
str5 <- str_remove(str5, " or as a set of methodologies that enable the creation of business value")
str5
#> [1] "Business Analytics can both be seen as the complete decision making process for solving a business problem."
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#5DZOZpdOh6Ga9qqTlI4R">Solution</button>

<div class="modal fade bs-example-modal-lg" id="SLBV1lYdTHSnaOoJaSGY" tabindex="-1" role="dialog" aria-labelledby="SLBV1lYdTHSnaOoJaSGY-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="SLBV1lYdTHSnaOoJaSGY-title">Hint</h4></div><div class="modal-body">

```r
str5 <- str_remove(str5, ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#SLBV1lYdTHSnaOoJaSGY">Hint</button>

3) In the string from Question 2, remove ` or as a set of methodologies that enable the creation of business value`.



<div class="modal fade bs-example-modal-lg" id="EXR8cX9YQRpiSWF4O0rz" tabindex="-1" role="dialog" aria-labelledby="EXR8cX9YQRpiSWF4O0rz-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="EXR8cX9YQRpiSWF4O0rz-title">Solution</h4></div><div class="modal-body">

```r
str5 <- str_c(str5, "This course will focus on programming and descriptive analytics.", sep= " ")
str5
#> [1] "Business Analytics can both be seen as the complete decision making process for solving a business problem. This course will focus on programming and descriptive analytics."
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#EXR8cX9YQRpiSWF4O0rz">Solution</button>

<div class="modal fade bs-example-modal-lg" id="hptXYHeFHijAIM4iY8yY" tabindex="-1" role="dialog" aria-labelledby="hptXYHeFHijAIM4iY8yY-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="hptXYHeFHijAIM4iY8yY-title">Hint</h4></div><div class="modal-body">

```r
str5 <- str_c(str5, ___, sep= ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#hptXYHeFHijAIM4iY8yY">Hint</button>

4) In the string from Question 3, add `This course will focus on programming and descriptive analytics.`.



<div class="modal fade bs-example-modal-lg" id="mqsndcG1QMOAJPlG71oT" tabindex="-1" role="dialog" aria-labelledby="mqsndcG1QMOAJPlG71oT-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="mqsndcG1QMOAJPlG71oT-title">Solution</h4></div><div class="modal-body">

```r
str5 <- str_replace(str5, "analytics", "business analytics")
str5
#> [1] "Business Analytics can both be seen as the complete decision making process for solving a business problem. This course will focus on programming and descriptive business analytics."
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#mqsndcG1QMOAJPlG71oT">Solution</button>

<div class="modal fade bs-example-modal-lg" id="n478jkzcHCnjDkrWbwwe" tabindex="-1" role="dialog" aria-labelledby="n478jkzcHCnjDkrWbwwe-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="n478jkzcHCnjDkrWbwwe-title">Hint</h4></div><div class="modal-body">

```r
str5 <- str_replace(str5, ___, ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#n478jkzcHCnjDkrWbwwe">Hint</button>

5) In the string from Question 4, replace `analytics` with `business analytics`.



<div class="modal fade bs-example-modal-lg" id="4pTOIFQwGZCBiJ83vZ7Z" tabindex="-1" role="dialog" aria-labelledby="4pTOIFQwGZCBiJ83vZ7Z-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="4pTOIFQwGZCBiJ83vZ7Z-title">Solution</h4></div><div class="modal-body">

```r
str_replace(str2, "BA", "Business Analytics") %>% 
   str_remove(" or as a set of methodologies that enable the creation of business value") %>% 
   str_c("This course will focus on programming and descriptive analytics.", sep= " ") %>% 
   str_replace("analytics", "business analytics")
#> [1] "Business Analytics can both be seen as the complete decision making process for solving a business problem. This course will focus on programming and descriptive business analytics."
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#4pTOIFQwGZCBiJ83vZ7Z">Solution</button>

<div class="modal fade bs-example-modal-lg" id="XohZikNHWGpP4xDPccK8" tabindex="-1" role="dialog" aria-labelledby="XohZikNHWGpP4xDPccK8-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="XohZikNHWGpP4xDPccK8-title">Hint</h4></div><div class="modal-body">

```r
str_replace(str2, ___, ___) %>% 
   str_remove(___) %>% 
   str_c(___) %>% 
   str_replace(___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#XohZikNHWGpP4xDPccK8">Hint</button>

6) Do all calculations in Question 2-5 using pipes.












[BSS]: https://bss.au.dk/en/

[course-help]: https://github.com/bss-osca/tfa/issues
[cran]: https://cloud.r-project.org
[cheatsheet-readr]: https://rawgit.com/rstudio/cheatsheets/master/data-import.pdf
[course-welcome-to-the-tidyverse]: https://github.com/rstudio-education/welcome-to-the-tidyverse

[DataCamp]: https://www.datacamp.com/
[datacamp-signup]: https://www.datacamp.com/groups/shared_links/cbaee6c73e7d78549a9e32a900793b2d5491ace1824efc1760a6729735948215
[datacamp-r-intro]: https://learn.datacamp.com/courses/free-introduction-to-r
[datacamp-r-rmarkdown]: https://campus.datacamp.com/courses/reporting-with-rmarkdown
[datacamp-r-communicating]: https://learn.datacamp.com/courses/communicating-with-data-in-the-tidyverse
[datacamp-r-communicating-chap3]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/introduction-to-rmarkdown
[datacamp-r-communicating-chap4]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/customizing-your-rmarkdown-report
[datacamp-r-intermediate]: https://learn.datacamp.com/courses/intermediate-r
[datacamp-r-intermediate-chap1]: https://campus.datacamp.com/courses/intermediate-r/chapter-1-conditionals-and-control-flow
[datacamp-r-intermediate-chap2]: https://campus.datacamp.com/courses/intermediate-r/chapter-2-loops
[datacamp-r-intermediate-chap3]: https://campus.datacamp.com/courses/intermediate-r/chapter-3-functions
[datacamp-r-intermediate-chap4]: https://campus.datacamp.com/courses/intermediate-r/chapter-4-the-apply-family
[datacamp-r-functions]: https://learn.datacamp.com/courses/introduction-to-writing-functions-in-r
[datacamp-r-tidyverse]: https://learn.datacamp.com/courses/introduction-to-the-tidyverse
[datacamp-r-strings]: https://learn.datacamp.com/courses/string-manipulation-with-stringr-in-r
[datacamp-r-dplyr]: https://learn.datacamp.com/courses/data-manipulation-with-dplyr
[datacamp-r-dplyr-bakeoff]: https://learn.datacamp.com/courses/working-with-data-in-the-tidyverse
[datacamp-r-ggplot2-intro]: https://learn.datacamp.com/courses/introduction-to-data-visualization-with-ggplot2
[datacamp-r-ggplot2-intermediate]: https://learn.datacamp.com/courses/intermediate-data-visualization-with-ggplot2
[dplyr-cran]: https://CRAN.R-project.org/package=dplyr
[debug-in-r]: https://rstats.wtf/debugging-r-code.html

[excel-vs-r]: https://www.jessesadler.com/post/excel-vs-r/

[google-form]: https://forms.gle/s39GeDGV9AzAXUo18
[google-grupper]: https://docs.google.com/spreadsheets/d/1DHxthd5AQywAU4Crb3hM9rnog2GqGQYZ2o175SQgn_0/edit?usp=sharing
[GitHub]: https://github.com/
[git-install]: https://git-scm.com/downloads
[github-actions]: https://github.com/features/actions
[github-pages]: https://pages.github.com/

[happy-git]: https://happygitwithr.com
[hg-install-git]: https://happygitwithr.com/install-git.html
[hg-why]: https://happygitwithr.com/big-picture.html#big-picture
[hg-github-reg]: https://happygitwithr.com/github-acct.html#github-acct
[hg-git-install]: https://happygitwithr.com/install-git.html#install-git
[hg-exist-github-first]: https://happygitwithr.com/existing-github-first.html
[hg-exist-github-last]: https://happygitwithr.com/existing-github-last.html
[hg-credential-helper]: https://happygitwithr.com/credential-caching.html
[hypothes.is]: https://web.hypothes.is/

[osca-programme]: https://kandidat.au.dk/en/operationsandsupplychainanalytics/

[Peergrade]: https://peergrade.io
[peergrade-signup]: https://app.peergrade.io/join
[point-and-click]: https://en.wikipedia.org/wiki/Point_and_click
[pkg-bookdown]: https://bookdown.org/yihui/bookdown/
[pkg-openxlsx]: https://ycphs.github.io/openxlsx/index.html
[pkg-ropensci-writexl]: https://docs.ropensci.org/writexl/
[pkg-jsonlite]: https://cran.r-project.org/web/packages/jsonlite/index.html

[R]: https://www.r-project.org
[RStudio]: https://rstudio.com
[rstudio-cloud]: https://rstudio.cloud/spaces/176810/join?access_code=LSGnG2EXTuzSyeYaNXJE77vP33DZUoeMbC0xhfCz
[r-cloud-mod12]: https://rstudio.cloud/spaces/176810/project/2963819
[r-cloud-mod13]: https://rstudio.cloud/spaces/176810/project/3020139
[r-cloud-mod14]: https://rstudio.cloud/spaces/176810/project/3020322
[r-cloud-mod15]: https://rstudio.cloud/spaces/176810/project/3020509
[r-cloud-mod16]: https://rstudio.cloud/spaces/176810/project/3026754
[r-cloud-mod17]: https://rstudio.cloud/spaces/176810/project/3034015
[r-cloud-mod18]: https://rstudio.cloud/spaces/176810/project/3130795
[r-cloud-mod19]: https://rstudio.cloud/spaces/176810/project/3266132
[rstudio-download]: https://rstudio.com/products/rstudio/download/#download
[rstudio-customizing]: https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio
[rstudio-key-shortcuts]: https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts
[rstudio-workbench]: https://www.rstudio.com/wp-content/uploads/2014/04/rstudio-workbench.png
[r-markdown]: https://rmarkdown.rstudio.com/
[ropensci-writexl]: https://docs.ropensci.org/writexl/
[r4ds-pipes]: https://r4ds.had.co.nz/pipes.html
[r4ds-factors]: https://r4ds.had.co.nz/factors.html
[r4ds-strings]: https://r4ds.had.co.nz/strings.html
[r4ds-iteration]: https://r4ds.had.co.nz/iteration.html

[stat-545]: https://stat545.com
[stat-545-functions-part1]: https://stat545.com/functions-part1.html
[stat-545-functions-part2]: https://stat545.com/functions-part2.html
[stat-545-functions-part3]: https://stat545.com/functions-part3.html
[slides-welcome]: https://bss-osca.github.io/tfa/slides/00-tfa_welcome.html
[slides-m1-3]: https://bss-osca.github.io/tfa/slides/01-welcome_r_part.html
[slides-m4-5]: https://bss-osca.github.io/tfa/slides/02-programming.html
[slides-m6-8]: https://bss-osca.github.io/tfa/slides/03-transform.html
[slides-m9]: https://bss-osca.github.io/tfa/slides/04-plot.html
[slides-m83]: https://bss-osca.github.io/tfa/slides/05-joins.html

[tidyverse-main-page]: https://www.tidyverse.org
[tidyverse-packages]: https://www.tidyverse.org/packages/
[tidyverse-core]: https://www.tidyverse.org/packages/#core-tidyverse
[tidyverse-ggplot2]: https://ggplot2.tidyverse.org/
[tidyverse-dplyr]: https://dplyr.tidyverse.org/
[tidyverse-tidyr]: https://tidyr.tidyverse.org/
[tidyverse-readr]: https://readr.tidyverse.org/
[tidyverse-purrr]: https://purrr.tidyverse.org/
[tidyverse-tibble]: https://tibble.tidyverse.org/
[tidyverse-stringr]: https://stringr.tidyverse.org/
[tidyverse-forcats]: https://forcats.tidyverse.org/
[tidyverse-readxl]: https://readxl.tidyverse.org
[tidyverse-googlesheets4]: https://googlesheets4.tidyverse.org/index.html
[tutorial-markdown]: https://commonmark.org/help/tutorial/

[Udemy]: https://www.udemy.com/

[vba-yt-course1]: https://www.youtube.com/playlist?list=PLpOAvcoMay5S_hb2D7iKznLqJ8QG_pde0
[vba-course1-hello]: https://youtu.be/f42OniDWaIo

[vba-yt-course2]: https://www.youtube.com/playlist?list=PL3A6U40JUYCi4njVx59-vaUxYkG0yRO4m
[vba-course2-devel-tab]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-editor]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-project]: https://youtu.be/fp6PTbU7bXo
[vba-course2-devel-properties]: https://youtu.be/ks2QYKAd9Xw
[vba-course2-devel-hello]: https://youtu.be/EQ6tDWBc8G4

[video-install]: https://vimeo.com/415501284
[video-rstudio-intro]: https://vimeo.com/416391353
[video-packages]: https://vimeo.com/416743698
[video-projects]: https://vimeo.com/319318233
[video-r-intro-p1]: https://www.youtube.com/watch?v=vGY5i_J2c-c
[video-r-intro-p2]: https://www.youtube.com/watch?v=w8_XdYI3reU
[video-r-intro-p3]: https://www.youtube.com/watch?v=NuY6jY4qE7I
[video-subsetting]: https://www.youtube.com/watch?v=hWbgqzsQJF0&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10&t=0s
[video-datatypes]: https://www.youtube.com/watch?v=5AQM-yUX9zg&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10
[video-control-structures]: https://www.youtube.com/watch?v=s_h9ruNwI_0
[video-conditional-loops]: https://www.youtube.com/watch?v=2evtsnPaoDg
[video-functions]: https://www.youtube.com/watch?v=ffPeac3BigM
[video-tibble-vs-df]: https://www.youtube.com/watch?v=EBk6PnvE1R4
[video-dplyr]: https://www.youtube.com/watch?v=aywFompr1F4

[wiki-snake-case]: https://en.wikipedia.org/wiki/Snake_case
[wiki-camel-case]: https://en.wikipedia.org/wiki/Camel_case
[wiki-interpreted]: https://en.wikipedia.org/wiki/Interpreted_language
[wiki-literate-programming]: https://en.wikipedia.org/wiki/Literate_programming
[wiki-csv]: https://en.wikipedia.org/wiki/Comma-separated_values
[wiki-json]: https://en.wikipedia.org/wiki/JSON


<!--chapter:end:08_r-workflow.Rmd-->

---
output: html_document
editor_options: 
  chunk_output_type: console
---



<!-- Exercises from: https://rafalab.github.io/dsbook/programming-basics.html -->


# Loops and conditionals {#mod-r-loops-cond}

This module considers programming with loops and conditional statements in R.

We are all different and you may like different learning styles compared to others. In the learning path diagram, there may be links to alternative online content. Note this is an alternative to the standard learning path that you may use instead. The learning path may also have extra content, that is not a part of syllabus, you can have a look at. 


```{=html}
<div id="htmlwidget-fa6abf914b25b5d6ba6a" style="width:100%;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-fa6abf914b25b5d6ba6a">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"💡 Conditionals\\n& control flow\", URL = \"https://campus.datacamp.com/courses/intermediate-r/chapter-1-conditionals-and-control-flow\", tooltip = \"Chapter 1 of the interactive DataCamp course Intermediate R.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"0,2!\"] \n  \"2\" [label = \"📖 Logical\\nfunctions\", URL = \"#r-dc-loops-cond\", tooltip = \"Useful logical functions.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"2,2!\"] \n  \"3\" [label = \"💡 Loops\", URL = \"https://campus.datacamp.com/courses/intermediate-r/chapter-2-loops\", tooltip = \"Chapter 2 of the interactive DataCamp course Intermediate R.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"4,2!\"] \n  \"4\" [label = \"📖 Loops\\n(further)\", URL = \"#r-loops\", tooltip = \"Further tools for looping\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"6,2!\"] \n  \"5\" [label = \"💻 Exercises\", URL = \"#ex-r-loops-cond\", tooltip = \"Exercises of the module\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"8,2!\"] \n  \"6\" [label = \"🎬 Control\\nstructures\", URL = \"https://www.youtube.com/watch?v=s_h9ruNwI_0&ab_channel=RogerPeng\", tooltip = \"Roger Peng has an introduction to control structures including if, for and while on YouTube.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkOrange4\", pos = \"0,4!\"] \n  \"7\" [label = \"📖 Iteration\", URL = \"https://r4ds.had.co.nz/iteration.html\", tooltip = \"A more detailed introduction to loops (Chapter 21 in H. Wickham, 2017).\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"4,0!\"] \n  \"8\" [label = \"💡 Loops\\nusing apply\", URL = \"https://campus.datacamp.com/courses/intermediate-r/chapter-4-the-apply-family?ex=1\", tooltip = \"An introduction to loops using the apply family of functions (Chapter 4 of the interactive DataCamp course Intermediate R).\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"6,0!\"] \n  \"9\" [label = \"🎬 Conditionals\\n& loops\", URL = \"https://youtu.be/2evtsnPaoDg\", tooltip = \"Hefin Rhys has a video about conditional statements and loops with examples.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"1,0!\"] \n  \"10\" [label = \"\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"0.5\", fontname = \"Helvetica\", shape = \"rect\", height = \"1\", width = \"6\", fillcolor = \"#F0F8FF\", pos = \"5.9,3.91!\"] \n  \"11\" [label = \"Color:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"0.8\", fillcolor = \"#FFFFFE\", pos = \"3.27,4.25!\"] \n  \"12\" [label = \"mandatory\", URL = \"\", tooltip = \"Mandatory syllabus.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkSeaGreen4\", pos = \"3.5,3.85!\"] \n  \"13\" [label = \"alternative\", URL = \"\", tooltip = \"Alternative syllabus if you prefer another learning style.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkOrange4\", pos = \"4.5,3.85!\"] \n  \"14\" [label = \"extra\", URL = \"\", tooltip = \"Extra learning if you are interested (not part of syllabus).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"PeachPuff3\", pos = \"5.5,3.85!\"] \n  \"15\" [label = \"Shape:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"1\", fillcolor = \"#FFFFFE\", pos = \"6.7,4.25!\"] \n  \"16\" [label = \"non-interactive\", URL = \"\", tooltip = \"Non-interactive learning content (e.g. reading).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"1\", fillcolor = \"Grey40\", pos = \"7,3.85!\"] \n  \"17\" [label = \"interactive\", URL = \"\", tooltip = \"Interactive learning content (tutorial, exercises etc.).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"egg\", width = \"1\", fillcolor = \"Grey40\", pos = \"8.25,3.85!\"] \n\"1\"->\"2\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"6\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"9\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"3\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"4\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"7\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"9\" [color = \"black\", arrowhead = \"vee\"] \n\"4\"->\"5\" [color = \"black\", arrowhead = \"vee\"] \n\"4\"->\"8\" [color = \"black\", arrowhead = \"vee\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
```


## Learning outcomes {#lo-loops}

By the end of this module, you are expected to be able to:

* Formulate conditional statements.
* Use functions `any` and `all`.
* Formulate loops in R using for and while statements.
* Use function `if_else`.

The learning outcomes relate to the [overall learning goals](#lg-course) number 2, 4 and 10 of the course.

<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->


## Conditionals and control flow {#r-dc-loops-cond}

An excellent introduction to conditionals and if statements is given in [Chapter 1][datacamp-r-intermediate-chap1] of the interactive DataCamp course [Intermediate R][datacamp-r-intermediate]. Please complete the chapter before continuing. 

Some functions are also useful for comparing logical data types. Consider this example: 


```r
x <- c(1, 3, 5, 10, 2, 17, 11, NA, 4)
x > 10  # are the elements greater that 10
#> [1] FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE    NA FALSE
any(x > 10)  # are any of the elements greater that 10
#> [1] TRUE
all(x > 10)  # are all of the elements greater that 10
#> [1] FALSE
all(x < 20)  # are all of the elements greater that 20
#> [1] NA
all(x < 20, na.rm = TRUE)  # are all of the elements greater that 20
#> [1] TRUE
```
That is, functions `any` and `all` can be used to join logical values in vectors. 

Some if statements can be written alternatively using function `if_else`:

```r
if_else(condition, true, false, missing = NULL)
```

For example:


```r
x <- c(-5:5, NA)
x
#>  [1] -5 -4 -3 -2 -1  0  1  2  3  4  5 NA

## using if and for
res <- rep("", length(x))
for (i in seq_along(x)) {
  if (is.na(x[i])) res[i] <- "missing"
  else if (x[i] < 0) res[i] <- "negative"
  else res[i] <- "positive"
}
res
#>  [1] "negative" "negative" "negative" "negative" "negative" "positive" "positive" "positive"
#>  [9] "positive" "positive" "positive" "missing"

## implicit if statement
res <- rep("", length(x))
res
#>  [1] "" "" "" "" "" "" "" "" "" "" "" ""
res[x < 0] <- "negative"
res[x >= 0] <- "positive"
res[is.na(x)] <- "missing"
res
#>  [1] "negative" "negative" "negative" "negative" "negative" "positive" "positive" "positive"
#>  [9] "positive" "positive" "positive" "missing"

## using if_else
res <- if_else(x < 0, "negative", "positive", "missing")
res
#>  [1] "negative" "negative" "negative" "negative" "negative" "positive" "positive" "positive"
#>  [9] "positive" "positive" "positive" "missing"
```




## Loops {#r-loops}

An excellent introduction to conditionals and if statements is given in [Chapter 2][datacamp-r-intermediate-chap2] of the interactive DataCamp course [Intermediate R][datacamp-r-intermediate]. Please complete the chapter before continuing (stop when Chapter 2 finishes). 

Loops in R may be slow. However, not if you follow some golden rules:

* Do not use a loop when a vectorized alternative exists.
* Do not grow objects (via `c`, `cbind`, etc) during the loop - R has to create a new object and copy across the information just to add a new element or row/column. Instead, allocate an object to hold the results and fill it in during the loop.

As an example, consider the for loop with 4 iterations:


```r
i_val <- c(1,2,6,9)
res <- rep(NA,4)
res
#> [1] NA NA NA NA
for (idx in 1:length(i_val)) {
  res[idx] <- 6 * i_val[idx] + 9
}
res
#> [1] 15 21 45 63
```

Note we allocate memory for the result vector before the loop so we do not have to grow the result object. Next, we calculate results $6i+9$ using a loop. Be careful here! This is not the same:


```r
res <- rep(NA,4)
for (i in i_val) {
  res[i] <- 6 * i + 9
}
res
#> [1] 15 21 NA NA NA 45 NA NA 63
```

In this example, however, we can use a vectorized alternative:


```r
res <- 6 * i_val + 9
res
#> [1] 15 21 45 63
```

where the operation is applied to each element in the vector.

Nested for loops is also possible. A simple example of a nested loop:


```r
for (i in 1:3) {
  for (j in 1:2) {
    cat(str_c("i =", i, " j = ",j, "\n"))
  }
}
#> i =1 j = 1
#> i =1 j = 2
#> i =2 j = 1
#> i =2 j = 2
#> i =3 j = 1
#> i =3 j = 2
```

We here use the function `cat` to print out a string (`\n` indicates new line). Note how the nested loops are executed:

* Set `i = 1` (outer loop)
   - Set `j = 1` (inner loop), `i` stays 1
   - Set `j = 2` (inner loop), `i` stays 1
   - Inner loop finishes, proceed with outer loop.
* Increase `i = 2` (outer loop)
   - Set `j = 1` (inner loop), `i` stays 2
   - Set `j = 2` (inner loop), `i` stays 2
   - Inner loop finishes, proceed with outer loop.
* Increase `i = 3` (outer loop)
   - Set `j = 1` (inner loop), `i` stays 3
   - Set `j = 2` (inner loop), `i` stays 3
   - Inner loop finishes, proceed with outer loop.
* Outer loop finishes as well (we looped over `i in 1:3`). Job done.

Nested loops can be used to iterate over matrices or data frames:


```r
mat <- matrix(NA, nrow = 2, ncol = 3)
mat
#>      [,1] [,2] [,3]
#> [1,]   NA   NA   NA
#> [2,]   NA   NA   NA
for (i in 1:nrow(mat)) {
  for (j in 1:ncol(mat)) {
     mat[i,j] <- (i-1)*ncol(mat) + j
     cat(str_c("Entry (", i, ", ", j, ") = ", mat[i,j], "\n"))
  }
}
#> Entry (1, 1) = 1
#> Entry (1, 2) = 2
#> Entry (1, 3) = 3
#> Entry (2, 1) = 4
#> Entry (2, 2) = 5
#> Entry (2, 3) = 6
mat
#>      [,1] [,2] [,3]
#> [1,]    1    2    3
#> [2,]    4    5    6
```

Often you can replace nested loops with a single loop by using `expand_grid`:


```r
library(tidyverse)  # load function expand_grid
mat <- matrix(NA, nrow = 2, ncol = 3)
ite <- expand_grid(i = 1:2, j=1:3)
ite
#> # A tibble: 6 × 2
#>       i     j
#>   <int> <int>
#> 1     1     1
#> 2     1     2
#> 3     1     3
#> 4     2     1
#> 5     2     2
#> 6     2     3
for (r in 1:nrow(ite)) { # iterate over rows
   i <- ite$i[r]
   j <- ite$j[r]
   mat[i,j] <- (i-1)*ncol(mat) + j
   cat(str_c("Entry (", i, ", ", j, ") = ", mat[i,j], "\n"))
}
#> Entry (1, 1) = 1
#> Entry (1, 2) = 2
#> Entry (1, 3) = 3
#> Entry (2, 1) = 4
#> Entry (2, 2) = 5
#> Entry (2, 3) = 6
mat
#>      [,1] [,2] [,3]
#> [1,]    1    2    3
#> [2,]    4    5    6
```

Note `expand_grid` creates a data frame with all combinations. This way of looping is a more flexible approach since you can

* nest more loops by adding more columns to `ite`,
* add different values in each column.

For instance, if you only want to calculate values for row 2 and columns 1 and 3 the code becomes:


```r
mat <- matrix(NA, nrow = 2, ncol = 3)
ite <- expand_grid(i = 2, j = c(1,3))
ite
#> # A tibble: 2 × 2
#>       i     j
#>   <dbl> <dbl>
#> 1     2     1
#> 2     2     3
for (r in 1:nrow(ite)) { # iterate over rows
   i <- ite$i[r]
   j <- ite$j[r]
   mat[i,j] <- (i-1)*ncol(mat) + j
   cat(str_c("Entry (", i, ", ", j, ") = ", mat[i,j], "\n"))
}
#> Entry (2, 1) = 4
#> Entry (2, 3) = 6
mat
#>      [,1] [,2] [,3]
#> [1,]   NA   NA   NA
#> [2,]    4   NA    6
```


## Recap {#rc-r-loops-cond}

*Comparison/relational operators* known to R are:

- `<` for less than,
- `>` for greater than,
- `<=` for less than or equal to,
- `>=` for greater than or equal to,
- `==` for equal to each other (and not `=` which is typically used for assignment!),
- `!=` not equal to each other.
   
*Logical operators* known to R are:

- `&` and,
- `|` or,
- `!` not.

If you use `&&` and `||` only the first element in vectors are compared. In general this is used rarely. 

Useful functions that return a logical are `any` and `all` which can be used to join logical values in vectors.

Conditional Statements can be constructed using for instance `if` and `while` statements. Moreover, function `if_else` is a vectorized alternative.

*Loops* can be created using `for` and `while` statements. 

You can break out of a loop using `break` and jump to the next iteration (skipping the remainder of the code in the loop) using `next`.

Do not use a loop when a vectorized alternative exists.

Do not grow objects during the loop. Instead, allocate an object to hold the results and fill it in during the loop.

Nested loops are possible in R. However, often they can be converted into a single loop by defining a data frame having the values of the nested loops in each row. Here function `expand_grid` may be useful to create the data frame. 

You may also have a look at the [slides for this module](https://bss-osca.github.io/tfa/slides/06-01_r-loops-cond-slides.html).


## Exercises {#ex-r-loops-cond}

Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the [help page](#help). Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution!

[Link to the project on RStudio Cloud for this module][r-cloud-mod13]. 

### Exercise (conditional expressions)

*Solve this exercise using a script file*

1) Consider object `x`:

   
   ```r
   x <- c(1,2,-3,4)
   ```
  
   What will this conditional expression return?

   
   ```r
   if(all(x>0)){
    print("All Postives")
   } else {
    print("Not all positives")
   }
   ```

2) What will the following expressions return?

   
   ```r
   x <- c(TRUE, FALSE, TRUE, TRUE)
   all(x)
   any(x)
   any(!x)
   all(!x)
   ```

3) Which of the expressions above is always `FALSE` when at least one entry of a logical vector `x` is TRUE?

Consider vector:


```r
library(tidyverse)
x <- 1:15
x
#>  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15
```


<div class="modal fade bs-example-modal-lg" id="VDNCSE74gH9yPOeuDXiO" tabindex="-1" role="dialog" aria-labelledby="VDNCSE74gH9yPOeuDXiO-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="VDNCSE74gH9yPOeuDXiO-title">Solution</h4></div><div class="modal-body">

```r
if_else(x < 7, as.integer(0), x)
#>  [1]  0  0  0  0  0  0  7  8  9 10 11 12 13 14 15
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#VDNCSE74gH9yPOeuDXiO">Solution</button>

<div class="modal fade bs-example-modal-lg" id="5d0Dgrn8Omga7YRl1Cs6" tabindex="-1" role="dialog" aria-labelledby="5d0Dgrn8Omga7YRl1Cs6-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="5d0Dgrn8Omga7YRl1Cs6-title">Hint</h4></div><div class="modal-body">

```r
if_else(x < 7, as.integer(___), ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#5d0Dgrn8Omga7YRl1Cs6">Hint</button>

4) Use the `if_else` function to set elements with value below 7 to 0.




<div class="modal fade bs-example-modal-lg" id="yNrtUiUz49mXPzFV4oNn" tabindex="-1" role="dialog" aria-labelledby="yNrtUiUz49mXPzFV4oNn-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="yNrtUiUz49mXPzFV4oNn-title">Solution</h4></div><div class="modal-body">

```r
if_else(x < 7 | x > 10, NA_integer_, x)
#>  [1] NA NA NA NA NA NA  7  8  9 10 NA NA NA NA NA
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#yNrtUiUz49mXPzFV4oNn">Solution</button>

<div class="modal fade bs-example-modal-lg" id="CwLW6sx2UErW0HKaF26h" tabindex="-1" role="dialog" aria-labelledby="CwLW6sx2UErW0HKaF26h-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="CwLW6sx2UErW0HKaF26h-title">Hint</h4></div><div class="modal-body">

```r
if_else(___, NA_integer_, ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#CwLW6sx2UErW0HKaF26h">Hint</button>

5) Use the `if_else` function to set elements with value below 7 or above 10 to `NA_integer_` (which is the NA/missing value of an integer).




<div class="modal fade bs-example-modal-lg" id="wJ4JcRnHZ2BjpVZ08r5F" tabindex="-1" role="dialog" aria-labelledby="wJ4JcRnHZ2BjpVZ08r5F-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="wJ4JcRnHZ2BjpVZ08r5F-title">Solution</h4></div><div class="modal-body">

```r
x <- sample(c(1:10,NA,5.5), 1)
if (is.na(x)) {
  y <- "missing"
} else if (x %% 2 == 0) {
  y <- "even"
} else if (x %% 2 == 1) {
  y <- "odd"
} else if (x %% 1 > 0) {
  y <- "decimal"
} 
x
#> [1] 7
y
#> [1] "odd"
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#wJ4JcRnHZ2BjpVZ08r5F">Solution</button>

<div class="modal fade bs-example-modal-lg" id="ZFc19h4cw5y1iSZsYjcJ" tabindex="-1" role="dialog" aria-labelledby="ZFc19h4cw5y1iSZsYjcJ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="ZFc19h4cw5y1iSZsYjcJ-title">Hint</h4></div><div class="modal-body">

```r
x <- sample(c(1:10,NA,5.5), 1)
if (is.na(x)) {
  y <- ___
} else if (x %% 2 == 0) {
  ___
} else if (___) {
  ___
} else if (___) {
  y <- "decimal"
} 
x
y
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ZFc19h4cw5y1iSZsYjcJ">Hint</button>

6) Consider code

   
   ```r
   x <- sample(c(1:10,NA,5.5), 1)
   x
   #> [1] 7
   ```

   which generates a number from the vector `c(1:10,NA,5.5)`. 

   Write code which set object `y` equal to "even" if `x` is even, "odd" if `x` is odd, "decimal" if `x` has a decimal not zero and "missing" if `x` is `NA`. Hint: have a look at `?'%%'` (the modulo operator).





### Exercise (loops)


<div class="modal fade bs-example-modal-lg" id="CqbkYHjYLVoWCqMIljqZ" tabindex="-1" role="dialog" aria-labelledby="CqbkYHjYLVoWCqMIljqZ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="CqbkYHjYLVoWCqMIljqZ-title">Solution</h4></div><div class="modal-body">

```r
x <- rep(NA,4)
for (i in 1:4) {
  x[i] <- 2 * i + 4
}
x
#> [1]  6  8 10 12
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#CqbkYHjYLVoWCqMIljqZ">Solution</button>

<div class="modal fade bs-example-modal-lg" id="1UXpjY48g6CMqEh6mFX2" tabindex="-1" role="dialog" aria-labelledby="1UXpjY48g6CMqEh6mFX2-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="1UXpjY48g6CMqEh6mFX2-title">Hint</h4></div><div class="modal-body">

```r
x <- rep(NA,4)
for (i in 1:4) {
  x[i] <- ___
}
x
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#1UXpjY48g6CMqEh6mFX2">Hint</button>

1) Using a `for` loop, create a vector having values $2i + 4$ given $i=1\ldots 4$.




<div class="modal fade bs-example-modal-lg" id="nKuMyNUU0dVJacRAikqX" tabindex="-1" role="dialog" aria-labelledby="nKuMyNUU0dVJacRAikqX-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="nKuMyNUU0dVJacRAikqX-title">Solution</h4></div><div class="modal-body">

```r
i_val <- c(2, 5, 6, 12)
x <- rep(NA, length(i_val))
for (idx in 1:length(i_val)) {
  x[idx] <- 2 * i_val[idx] + 4
}
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#nKuMyNUU0dVJacRAikqX">Solution</button>

<div class="modal fade bs-example-modal-lg" id="ISNFexIeXb10815TCoFU" tabindex="-1" role="dialog" aria-labelledby="ISNFexIeXb10815TCoFU-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="ISNFexIeXb10815TCoFU-title">Hint</h4></div><div class="modal-body">

```r
i_val <- c(2, 5, 6, 12)
x <- rep(NA, length(i_val))
for (idx in 1:length(i_val)) {
  x[idx] <- ___
}
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ISNFexIeXb10815TCoFU">Hint</button>

2) Using a `for` loop, create a vector having values $2i + 4$ given $i=2,5,6,12$.




<div class="modal fade bs-example-modal-lg" id="e9pREI9a9BLBPcgpNx1b" tabindex="-1" role="dialog" aria-labelledby="e9pREI9a9BLBPcgpNx1b-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="e9pREI9a9BLBPcgpNx1b-title">Solution</h4></div><div class="modal-body">

```r
i_val <- c(2, 5, 6, 12)
x <- rep(NA, length(i_val))
idx <- 1
while (idx < 5) {
  x[idx] <- 2 * i_val[idx] + 4
  idx <- idx + 1
}
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#e9pREI9a9BLBPcgpNx1b">Solution</button>

<div class="modal fade bs-example-modal-lg" id="SLs4sBDr3EzgRNSnfS3E" tabindex="-1" role="dialog" aria-labelledby="SLs4sBDr3EzgRNSnfS3E-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="SLs4sBDr3EzgRNSnfS3E-title">Hint</h4></div><div class="modal-body">

```r
i_val <- c(2, 5, 6, 12)
x <- rep(NA, length(i_val))
idx <- 1
while (idx < 5) {
  x[idx] <- ___
  idx <- ___
}
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#SLs4sBDr3EzgRNSnfS3E">Hint</button>

3) Solve Question 2 using a `while` loop.




<div class="modal fade bs-example-modal-lg" id="EE3UFlXw5wivc9BjaJlK" tabindex="-1" role="dialog" aria-labelledby="EE3UFlXw5wivc9BjaJlK-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="EE3UFlXw5wivc9BjaJlK-title">Solution</h4></div><div class="modal-body">

```r
2 * 1:4 + 4             # Q1
#> [1]  6  8 10 12
2* c(2, 5, 6, 12) + 4   # Q2
#> [1]  8 14 16 28
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#EE3UFlXw5wivc9BjaJlK">Solution</button>

<div class="modal fade bs-example-modal-lg" id="rZPvS6SzvQrInnNNereW" tabindex="-1" role="dialog" aria-labelledby="rZPvS6SzvQrInnNNereW-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="rZPvS6SzvQrInnNNereW-title">Hint</h4></div><div class="modal-body">

```r
2 * ___ + 4             # Q1
___   # Q2
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#rZPvS6SzvQrInnNNereW">Hint</button>

4) Solve Questions 1 and 2 using a vectorized alternative. 




### Exercise (calculating distances) {#ex-dist}

Consider zip codes in Jutland:


```r
# remotes::install_github("bss-osca/tfa/tfa-package", upgrade = FALSE)  # run to upgrade
library(tidyverse)
library(tfa)   
zips
#> # A tibble: 376 × 2
#>      Zip Area           
#>    <dbl> <chr>          
#>  1  5320 "Agedrup"      
#>  2  6753 "Agerb\xe6k"   
#>  3  6534 "Agerskov"     
#>  4  8961 "Alling\xe5bro"
#>  5  6051 "Almind"       
#>  6  8592 "Anholt"       
#>  7  8643 "Ans By"       
#>  8  6823 "Ansager"      
#>  9  9510 "Arden"        
#> 10  5466 "Asperup"      
#> # … with 366 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```

We want to calculate distances between a subset of zip areas:


```r
idx <- 1:5
dat <- zips[idx,]
dat
#> # A tibble: 5 × 2
#>     Zip Area           
#>   <dbl> <chr>          
#> 1  5320 "Agedrup"      
#> 2  6753 "Agerb\xe6k"   
#> 3  6534 "Agerskov"     
#> 4  8961 "Alling\xe5bro"
#> 5  6051 "Almind"
distanceMat <- matrix(NA, nrow = length(idx), ncol = length(idx))
colnames(distanceMat) <- str_c(dat$Zip[idx], dat$Area[idx], sep = " ") 
rownames(distanceMat) <- colnames(distanceMat)
distanceMat
#>                    5320 Agedrup 6753 Agerb\xe6k 6534 Agerskov 8961 Alling\xe5bro 6051 Almind
#> 5320 Agedrup                 NA              NA            NA                 NA          NA
#> 6753 Agerb\xe6k              NA              NA            NA                 NA          NA
#> 6534 Agerskov                NA              NA            NA                 NA          NA
#> 8961 Alling\xe5bro           NA              NA            NA                 NA          NA
#> 6051 Almind                  NA              NA            NA                 NA          NA
```

We can find average distances between two zip codes (here rows 1 and 2 in `dat`) using Bing maps:


```r
key <- "AlUJdApmvPe8y2_IMrC4j4x8fzytbD2M0SvlmpemL09ae_CWS6-IuNSgrAtXoyeP"
url <- str_c("http://dev.virtualearth.net/REST/V1/Routes/Driving?wp.0=",
             dat$Zip[1], ",Denmark",
             "&wp.1=",
             dat$Zip[2], ",Denmark",
             "&avoid=minimizeTolls&key=", key)
library(jsonlite)
lst <- jsonlite::fromJSON(url)
dist <- lst$resourceSets$resources[[1]]$travelDistance
dist
#> [1] 140
lst$statusCode
#> [1] 200
lst$statusDescription
#> [1] "OK"
```

Note we call the Bing maps API with the two zip codes. A [json file](https://en.wikipedia.org/wiki/JSON) is returned and stored in a list. To get the average travel distance we access `travelDistance`. The status code should be 200 if the calculation returned is okay.


<div class="modal fade bs-example-modal-lg" id="9b2Ujk3RVGbji7ZnEip7" tabindex="-1" role="dialog" aria-labelledby="9b2Ujk3RVGbji7ZnEip7-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="9b2Ujk3RVGbji7ZnEip7-title">Solution</h4></div><div class="modal-body">

```r
key <- "AlUJdApmvPe8y2_IMrC4j4x8fzytbD2M0SvlmpemL09ae_CWS6-IuNSgrAtXoyeP"
for(i in 1:nrow(distanceMat)) {
   for(j in 1:ncol(distanceMat)) {
      if (i>j) {distanceMat[i,j] <- distanceMat[j,i]; next}   # assume symmetric distances
      if (!is.na(distanceMat[i,j])) next   # value already calculated 
      if (i==j) {distanceMat[i,j] <- 0; next}
      
      url <- str_c("http://dev.virtualearth.net/REST/V1/Routes/Driving?wp.0=",
                   dat$Zip[i], ",Denmark",
                   "&wp.1=",
                   dat$Zip[j], ",Denmark",
                   "&avoid=minimizeTolls&key=", key)
      lst <- jsonlite::fromJSON(url)
      if (lst$statusCode == 200) {
         distanceMat[i,j] <- lst$resourceSets$resources[[1]]$travelDistance
      }
   }
}
distanceMat
#>                    5320 Agedrup 6753 Agerb\xe6k 6534 Agerskov 8961 Alling\xe5bro 6051 Almind
#> 5320 Agedrup                0.0           140.1         144.5                215        88.5
#> 6753 Agerb\xe6k           140.1             0.0         107.0                180        61.3
#> 6534 Agerskov             144.5           107.0           0.0                204        65.6
#> 8961 Alling\xe5bro        215.2           180.4         204.3                  0       150.8
#> 6051 Almind                88.5            61.3          65.6                151         0.0
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#9b2Ujk3RVGbji7ZnEip7">Solution</button>

<div class="modal fade bs-example-modal-lg" id="xkoB1ru8TSh4jOSiTzqp" tabindex="-1" role="dialog" aria-labelledby="xkoB1ru8TSh4jOSiTzqp-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="xkoB1ru8TSh4jOSiTzqp-title">Hint</h4></div><div class="modal-body">

```r
key <- "AlUJdApmvPe8y2_IMrC4j4x8fzytbD2M0SvlmpemL09ae_CWS6-IuNSgrAtXoyeP"
for(i in 1:nrow(distanceMat)) {
   for(j in 1:ncol(___)) {
      if (i>j) {distanceMat[i,j] <- ___; next}   # assume symmetric distances
      if (!is.na(distanceMat[i,j])) next   # value already calculated 
      if (i==j) {distanceMat[i,j] <- ___; next}
      
      url <- str_c("http://dev.virtualearth.net/REST/V1/Routes/Driving?wp.0=",
                   dat$Zip[i], ",Denmark",
                   "&wp.1=",
                   dat$Zip[j], ",Denmark",
                   "&avoid=minimizeTolls&key=", key)
      lst <- jsonlite::fromJSON(url)
      if (lst$statusCode == ___) {
         distanceMat[i,j] <- ___
      }
   }
}
distanceMat
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#xkoB1ru8TSh4jOSiTzqp">Hint</button>

Use nested for loops to fill `distanceMat` with distances. Assume that the distance from a to b is the same as from b to a. That is, you only have to call the API once for two zip codes. Use an if statement to check if the status code is okay.


### Exercise (`expand_grid`)


<div class="modal fade bs-example-modal-lg" id="l6qoz2kPap00zlJozCeR" tabindex="-1" role="dialog" aria-labelledby="l6qoz2kPap00zlJozCeR-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="l6qoz2kPap00zlJozCeR-title">Solution</h4></div><div class="modal-body">

```r
ite <- expand_grid(i = c(1,5), j = 2:3)
ite
#> # A tibble: 4 × 2
#>       i     j
#>   <dbl> <int>
#> 1     1     2
#> 2     1     3
#> 3     5     2
#> 4     5     3
key <- "AlUJdApmvPe8y2_IMrC4j4x8fzytbD2M0SvlmpemL09ae_CWS6-IuNSgrAtXoyeP"
for (r in 1:nrow(ite)) { # iterate over rows
   i <- ite$i[r]
   j <- ite$j[r]
   if (i==j) {distanceMat[i,j] <- 0; next}
   url <- str_c("http://dev.virtualearth.net/REST/V1/Routes/Driving?wp.0=",
                dat$Zip[i], ",Denmark",
                "&wp.1=",
                dat$Zip[j], ",Denmark",
                "&avoid=minimizeTolls&key=", key)
   lst <- jsonlite::fromJSON(url)
   if (lst$statusCode == 200) {
      distanceMat[i,j] <- lst$resourceSets$resources[[1]]$travelDistance
      distanceMat[j,i] <- distanceMat[i,j]
   }
}
distanceMat
#>                    5320 Agedrup 6753 Agerb\xe6k 6534 Agerskov 8961 Alling\xe5bro 6051 Almind
#> 5320 Agedrup                0.0           140.1         144.5                215        88.5
#> 6753 Agerb\xe6k           140.1             0.0         107.0                180        58.8
#> 6534 Agerskov             144.5           107.0           0.0                204        62.4
#> 8961 Alling\xe5bro        215.2           180.4         204.3                  0       150.8
#> 6051 Almind                88.5            58.8          62.4                151         0.0
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#l6qoz2kPap00zlJozCeR">Solution</button>

<div class="modal fade bs-example-modal-lg" id="wzSEhYaQQbSxqDQQ1NQB" tabindex="-1" role="dialog" aria-labelledby="wzSEhYaQQbSxqDQQ1NQB-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="wzSEhYaQQbSxqDQQ1NQB-title">Hint</h4></div><div class="modal-body">

```r
ite <- expand_grid(i = ___, j = ___)
ite
key <- "AlUJdApmvPe8y2_IMrC4j4x8fzytbD2M0SvlmpemL09ae_CWS6-IuNSgrAtXoyeP"
for (r in 1:nrow(ite)) { # iterate over rows
   i <- ite$i[r]
   j <- ite$j[r]
   if (i==j) {distanceMat[i,j] <- 0; next}
   url <- str_c("http://dev.virtualearth.net/REST/V1/Routes/Driving?wp.0=",
                dat$Zip[i], ",Denmark",
                "&wp.1=",
                dat$Zip[j], ",Denmark",
                "&avoid=minimizeTolls&key=", key)
   lst <- jsonlite::fromJSON(url)
   if (lst$statusCode == ___) {
      distanceMat[i,j] <- lst$resourceSets$resources[[1]]$travelDistance
      distanceMat[j,i] <- ___
   }
}
distanceMat
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#wzSEhYaQQbSxqDQQ1NQB">Hint</button>

Consider the solution of Exercise \@ref(ex-dist) and assume that you only want to calculate the distance from rows 1 and 5 to rows 2 and 3 in `dat`. Modify the solution using `expand_grid` so only one loop is used.


[BSS]: https://bss.au.dk/en/

[course-help]: https://github.com/bss-osca/tfa/issues
[cran]: https://cloud.r-project.org
[cheatsheet-readr]: https://rawgit.com/rstudio/cheatsheets/master/data-import.pdf
[course-welcome-to-the-tidyverse]: https://github.com/rstudio-education/welcome-to-the-tidyverse

[DataCamp]: https://www.datacamp.com/
[datacamp-signup]: https://www.datacamp.com/groups/shared_links/cbaee6c73e7d78549a9e32a900793b2d5491ace1824efc1760a6729735948215
[datacamp-r-intro]: https://learn.datacamp.com/courses/free-introduction-to-r
[datacamp-r-rmarkdown]: https://campus.datacamp.com/courses/reporting-with-rmarkdown
[datacamp-r-communicating]: https://learn.datacamp.com/courses/communicating-with-data-in-the-tidyverse
[datacamp-r-communicating-chap3]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/introduction-to-rmarkdown
[datacamp-r-communicating-chap4]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/customizing-your-rmarkdown-report
[datacamp-r-intermediate]: https://learn.datacamp.com/courses/intermediate-r
[datacamp-r-intermediate-chap1]: https://campus.datacamp.com/courses/intermediate-r/chapter-1-conditionals-and-control-flow
[datacamp-r-intermediate-chap2]: https://campus.datacamp.com/courses/intermediate-r/chapter-2-loops
[datacamp-r-intermediate-chap3]: https://campus.datacamp.com/courses/intermediate-r/chapter-3-functions
[datacamp-r-intermediate-chap4]: https://campus.datacamp.com/courses/intermediate-r/chapter-4-the-apply-family
[datacamp-r-functions]: https://learn.datacamp.com/courses/introduction-to-writing-functions-in-r
[datacamp-r-tidyverse]: https://learn.datacamp.com/courses/introduction-to-the-tidyverse
[datacamp-r-strings]: https://learn.datacamp.com/courses/string-manipulation-with-stringr-in-r
[datacamp-r-dplyr]: https://learn.datacamp.com/courses/data-manipulation-with-dplyr
[datacamp-r-dplyr-bakeoff]: https://learn.datacamp.com/courses/working-with-data-in-the-tidyverse
[datacamp-r-ggplot2-intro]: https://learn.datacamp.com/courses/introduction-to-data-visualization-with-ggplot2
[datacamp-r-ggplot2-intermediate]: https://learn.datacamp.com/courses/intermediate-data-visualization-with-ggplot2
[dplyr-cran]: https://CRAN.R-project.org/package=dplyr
[debug-in-r]: https://rstats.wtf/debugging-r-code.html

[excel-vs-r]: https://www.jessesadler.com/post/excel-vs-r/

[google-form]: https://forms.gle/s39GeDGV9AzAXUo18
[google-grupper]: https://docs.google.com/spreadsheets/d/1DHxthd5AQywAU4Crb3hM9rnog2GqGQYZ2o175SQgn_0/edit?usp=sharing
[GitHub]: https://github.com/
[git-install]: https://git-scm.com/downloads
[github-actions]: https://github.com/features/actions
[github-pages]: https://pages.github.com/

[happy-git]: https://happygitwithr.com
[hg-install-git]: https://happygitwithr.com/install-git.html
[hg-why]: https://happygitwithr.com/big-picture.html#big-picture
[hg-github-reg]: https://happygitwithr.com/github-acct.html#github-acct
[hg-git-install]: https://happygitwithr.com/install-git.html#install-git
[hg-exist-github-first]: https://happygitwithr.com/existing-github-first.html
[hg-exist-github-last]: https://happygitwithr.com/existing-github-last.html
[hg-credential-helper]: https://happygitwithr.com/credential-caching.html
[hypothes.is]: https://web.hypothes.is/

[osca-programme]: https://kandidat.au.dk/en/operationsandsupplychainanalytics/

[Peergrade]: https://peergrade.io
[peergrade-signup]: https://app.peergrade.io/join
[point-and-click]: https://en.wikipedia.org/wiki/Point_and_click
[pkg-bookdown]: https://bookdown.org/yihui/bookdown/
[pkg-openxlsx]: https://ycphs.github.io/openxlsx/index.html
[pkg-ropensci-writexl]: https://docs.ropensci.org/writexl/
[pkg-jsonlite]: https://cran.r-project.org/web/packages/jsonlite/index.html

[R]: https://www.r-project.org
[RStudio]: https://rstudio.com
[rstudio-cloud]: https://rstudio.cloud/spaces/176810/join?access_code=LSGnG2EXTuzSyeYaNXJE77vP33DZUoeMbC0xhfCz
[r-cloud-mod12]: https://rstudio.cloud/spaces/176810/project/2963819
[r-cloud-mod13]: https://rstudio.cloud/spaces/176810/project/3020139
[r-cloud-mod14]: https://rstudio.cloud/spaces/176810/project/3020322
[r-cloud-mod15]: https://rstudio.cloud/spaces/176810/project/3020509
[r-cloud-mod16]: https://rstudio.cloud/spaces/176810/project/3026754
[r-cloud-mod17]: https://rstudio.cloud/spaces/176810/project/3034015
[r-cloud-mod18]: https://rstudio.cloud/spaces/176810/project/3130795
[r-cloud-mod19]: https://rstudio.cloud/spaces/176810/project/3266132
[rstudio-download]: https://rstudio.com/products/rstudio/download/#download
[rstudio-customizing]: https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio
[rstudio-key-shortcuts]: https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts
[rstudio-workbench]: https://www.rstudio.com/wp-content/uploads/2014/04/rstudio-workbench.png
[r-markdown]: https://rmarkdown.rstudio.com/
[ropensci-writexl]: https://docs.ropensci.org/writexl/
[r4ds-pipes]: https://r4ds.had.co.nz/pipes.html
[r4ds-factors]: https://r4ds.had.co.nz/factors.html
[r4ds-strings]: https://r4ds.had.co.nz/strings.html
[r4ds-iteration]: https://r4ds.had.co.nz/iteration.html

[stat-545]: https://stat545.com
[stat-545-functions-part1]: https://stat545.com/functions-part1.html
[stat-545-functions-part2]: https://stat545.com/functions-part2.html
[stat-545-functions-part3]: https://stat545.com/functions-part3.html
[slides-welcome]: https://bss-osca.github.io/tfa/slides/00-tfa_welcome.html
[slides-m1-3]: https://bss-osca.github.io/tfa/slides/01-welcome_r_part.html
[slides-m4-5]: https://bss-osca.github.io/tfa/slides/02-programming.html
[slides-m6-8]: https://bss-osca.github.io/tfa/slides/03-transform.html
[slides-m9]: https://bss-osca.github.io/tfa/slides/04-plot.html
[slides-m83]: https://bss-osca.github.io/tfa/slides/05-joins.html

[tidyverse-main-page]: https://www.tidyverse.org
[tidyverse-packages]: https://www.tidyverse.org/packages/
[tidyverse-core]: https://www.tidyverse.org/packages/#core-tidyverse
[tidyverse-ggplot2]: https://ggplot2.tidyverse.org/
[tidyverse-dplyr]: https://dplyr.tidyverse.org/
[tidyverse-tidyr]: https://tidyr.tidyverse.org/
[tidyverse-readr]: https://readr.tidyverse.org/
[tidyverse-purrr]: https://purrr.tidyverse.org/
[tidyverse-tibble]: https://tibble.tidyverse.org/
[tidyverse-stringr]: https://stringr.tidyverse.org/
[tidyverse-forcats]: https://forcats.tidyverse.org/
[tidyverse-readxl]: https://readxl.tidyverse.org
[tidyverse-googlesheets4]: https://googlesheets4.tidyverse.org/index.html
[tutorial-markdown]: https://commonmark.org/help/tutorial/

[Udemy]: https://www.udemy.com/

[vba-yt-course1]: https://www.youtube.com/playlist?list=PLpOAvcoMay5S_hb2D7iKznLqJ8QG_pde0
[vba-course1-hello]: https://youtu.be/f42OniDWaIo

[vba-yt-course2]: https://www.youtube.com/playlist?list=PL3A6U40JUYCi4njVx59-vaUxYkG0yRO4m
[vba-course2-devel-tab]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-editor]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-project]: https://youtu.be/fp6PTbU7bXo
[vba-course2-devel-properties]: https://youtu.be/ks2QYKAd9Xw
[vba-course2-devel-hello]: https://youtu.be/EQ6tDWBc8G4

[video-install]: https://vimeo.com/415501284
[video-rstudio-intro]: https://vimeo.com/416391353
[video-packages]: https://vimeo.com/416743698
[video-projects]: https://vimeo.com/319318233
[video-r-intro-p1]: https://www.youtube.com/watch?v=vGY5i_J2c-c
[video-r-intro-p2]: https://www.youtube.com/watch?v=w8_XdYI3reU
[video-r-intro-p3]: https://www.youtube.com/watch?v=NuY6jY4qE7I
[video-subsetting]: https://www.youtube.com/watch?v=hWbgqzsQJF0&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10&t=0s
[video-datatypes]: https://www.youtube.com/watch?v=5AQM-yUX9zg&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10
[video-control-structures]: https://www.youtube.com/watch?v=s_h9ruNwI_0
[video-conditional-loops]: https://www.youtube.com/watch?v=2evtsnPaoDg
[video-functions]: https://www.youtube.com/watch?v=ffPeac3BigM
[video-tibble-vs-df]: https://www.youtube.com/watch?v=EBk6PnvE1R4
[video-dplyr]: https://www.youtube.com/watch?v=aywFompr1F4

[wiki-snake-case]: https://en.wikipedia.org/wiki/Snake_case
[wiki-camel-case]: https://en.wikipedia.org/wiki/Camel_case
[wiki-interpreted]: https://en.wikipedia.org/wiki/Interpreted_language
[wiki-literate-programming]: https://en.wikipedia.org/wiki/Literate_programming
[wiki-csv]: https://en.wikipedia.org/wiki/Comma-separated_values
[wiki-json]: https://en.wikipedia.org/wiki/JSON






<!--chapter:end:09_r-loops-cond.Rmd-->

---
output: html_document
editor_options: 
  chunk_output_type: console
---



# Functions {#mod-r-functions}

> To understand computations in R, two slogans are helpful:
>
>    Everything that exists is an object.
>
>    Everything that happens is a function call.
>
>   John Chambers

Writing functions is a core activity of an R programmer. It represents the key step of the transition from a user to a programmer. Functions have inputs and outputs. Functions (and control structures) are what makes your code more dynamic.

Functions are often used to encapsulate a sequence of expressions that needs to be executed numerous times, perhaps under slightly different conditions. In programming, functional programming is a programming paradigm, a style of how code is written. Rather than repeating the code, functions and control structures allow one to build code in blocks. As a result, your code becomes more structured, more readable and much easier to maintain and debug (find errors).

We are all different and you may like different learning styles compared to others. In the learning path diagram, there may be links to alternative online content. Note this is an alternative to the standard learning path that you may use instead. The learning path may also have extra content, that is not a part of syllabus, you can have a look at. 


```{=html}
<div id="htmlwidget-4f89fb35545f090cb77b" style="width:100%;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-4f89fb35545f090cb77b">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"💡 Functions\", URL = \"#r-dc-functions\", tooltip = \"Functions\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"0,2!\"] \n  \"2\" [label = \"📖 Functions\\n(further)\", URL = \"#r-functions-extra\", tooltip = \"Functions returning multiple objects\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"2,2!\"] \n  \"3\" [label = \"📖 The ...\\nargument\", URL = \"#r-functions-arg\", tooltip = \"The `...` argument\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"4,2!\"] \n  \"4\" [label = \"📖 Documentation\", URL = \"#r-functions-doc\", tooltip = \"Documenting your functions\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"6,2!\"] \n  \"5\" [label = \"💻 Exercises\", URL = \"#ex-r-functions\", tooltip = \"Exercises\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"8,2!\"] \n  \"6\" [label = \"💡 Functions\\n(detailed)\", URL = \"https://app.datacamp.com/learn/courses/introduction-to-writing-functions-in-r\", tooltip = \"A detailed interactive tutorial about functions.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"2,0.5!\"] \n  \"7\" [label = \"🎬 Functions\", URL = \"https://www.youtube.com/watch?v=ffPeac3BigM\", tooltip = \"Hefin Rhys has a video about writing functions with examples.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkOrange4\", pos = \"0,4!\"] \n  \"8\" [label = \"📖 Functions\", URL = \"https://bookdown.org/rdpeng/rprogdatascience/functions.html\", tooltip = \"An introduction to functions given in Chapter 14 of the book by Peng (2018).\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkOrange4\", pos = \"2,4!\"] \n  \"9\" [label = \"📖 Functions (Part 1)\", URL = \"https://stat545.com/functions-part1.html\", tooltip = \"A detailed tutorial on functions is given in Chapters 18, 19 and 20 of Bryan (2017).\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"0,0.5!\"] \n  \"10\" [label = \"📖 Functions (Part 2)\", URL = \"https://stat545.com/functions-part2.html\", tooltip = \"A detailed tutorial on functions is given in Chapters 18, 19 and 20 of Bryan (2017).\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"0,-0.5!\"] \n  \"11\" [label = \"📖 Functions (Part 3)\", URL = \"https://stat545.com/functions-part3.html\", tooltip = \"A detailed tutorial on functions is given in Chapters 18, 19 and 20 of Bryan (2017).\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"0,-1.5!\"] \n  \"12\" [label = \"\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"0.5\", fontname = \"Helvetica\", shape = \"rect\", height = \"1\", width = \"6\", fillcolor = \"#F0F8FF\", pos = \"5.9,3.91!\"] \n  \"13\" [label = \"Color:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"0.8\", fillcolor = \"#FFFFFE\", pos = \"3.27,4.25!\"] \n  \"14\" [label = \"mandatory\", URL = \"\", tooltip = \"Mandatory syllabus.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkSeaGreen4\", pos = \"3.5,3.85!\"] \n  \"15\" [label = \"alternative\", URL = \"\", tooltip = \"Alternative syllabus if you prefer another learning style.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkOrange4\", pos = \"4.5,3.85!\"] \n  \"16\" [label = \"extra\", URL = \"\", tooltip = \"Extra learning if you are interested (not part of syllabus).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"PeachPuff3\", pos = \"5.5,3.85!\"] \n  \"17\" [label = \"Shape:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"1\", fillcolor = \"#FFFFFE\", pos = \"6.7,4.25!\"] \n  \"18\" [label = \"non-interactive\", URL = \"\", tooltip = \"Non-interactive learning content (e.g. reading).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"1\", fillcolor = \"Grey40\", pos = \"7,3.85!\"] \n  \"19\" [label = \"interactive\", URL = \"\", tooltip = \"Interactive learning content (tutorial, exercises etc.).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"egg\", width = \"1\", fillcolor = \"Grey40\", pos = \"8.25,3.85!\"] \n\"1\"->\"2\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"7\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"8\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"9\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"3\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"6\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"4\" [color = \"black\", arrowhead = \"vee\"] \n\"4\"->\"5\" [color = \"black\", arrowhead = \"vee\"] \n\"9\"->\"10\" [color = \"black\", arrowhead = \"vee\"] \n\"10\"->\"11\" [color = \"black\", arrowhead = \"vee\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
```



<!-- We are all different and you may like different learning styles compared to others. You may prefer a different learning path than suggested. Here is a list of possible different learning paths that may be useful for you. Note these suggestions are not a part of syllabus! -->

<!-- * For a more detailed interactive tutorial about functions see the DataCamp course [Introduction to Writing Functions in R][datacamp-r-functions]. -->
<!-- * Hefin Rhys has a video about [Writing functions in R][video-functions] giving examples in RStudio. -->
<!-- * An introduction to functions is also given in [Chapter 14](https://bookdown.org/rdpeng/rprogdatascience/functions.html) of @rdpeng. -->
<!-- * A detailed tutorial on functions is given in Chapters [18][stat-545-functions-part1], [19][stat-545-functions-part2] and [20][stat-545-functions-part3] of @stat545. -->



## Learning outcomes {#lo-r-functions}

By the end of this module, you are expected to be able to:

* Call a function.
* Formulate a function with different input arguments.
* Describe why functions are important in R.
* Set defaults for input arguments. 
* Return values from functions.
* Explain how variable scope and precedence works.
* Document functions. 

The learning outcomes relate to the [overall learning goals](#lg-course) number 2, 3, 4 and 10 of the course.

<!-- SOLO increasing: identify · memorize · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyze · relate · derive · -->
<!-- evaluate · apply · argue · theorize · generalize · hypothesis · solve · reflect -->


## DataCamp course {#r-dc-functions}

An excellent introduction to functions is given in [Chapter 3][datacamp-r-intermediate-chap3] in the DataCamp course [Intermediate R][datacamp-r-intermediate]. Please complete the chapter before continuing. 


## Functions returning multiple objects {#r-functions-extra}

Functions in R only return a single object. However, note that the object may be a list. That is, if you want to return multiple arguments, store them in a list. A simple example:


```r
test <- function() {
  # the function does some stuff and calculate some results
  res1 <- 45
  res2 <- "Success"
  res3 <- c(4, 7, 9)
  res4 <- list(cost = 23, profit = 200)
  lst <- list(days = res1, run = res2, id = res3, money = res4)
  return(lst)
}
test()
#> $days
#> [1] 45
#> 
#> $run
#> [1] "Success"
#> 
#> $id
#> [1] 4 7 9
#> 
#> $money
#> $money$cost
#> [1] 23
#> 
#> $money$profit
#> [1] 200
```


## The `...` argument {#r-functions-arg}

The special argument `...` indicates a variable number of arguments and is usually used to pass arguments to nested functions used inside the function. Consider example:


```r
my_name <- function(first = "Lars", last = "Nielsen") {
  str_c(first, last, sep = " ")
}
my_name()
#> [1] "Lars Nielsen"

cite_text <- function(text, ...) {
  str_c(text, ', -', my_name(...))
}
cite_text("Learning by doing is the best way to learn how to program!")
#> [1] "Learning by doing is the best way to learn how to program!, -Lars Nielsen"
cite_text("Learning by doing is the best way to learn how to program!", last = "Relund")
#> [1] "Learning by doing is the best way to learn how to program!, -Lars Relund"
cite_text("To be or not to be", first = "Shakespeare", last = "")
#> [1] "To be or not to be, -Shakespeare "
```

Note in the first function run, we use the defaults in `my_name`. In the second run, we change the default last name and in the last run, we change both arguments.

If you need to retrieve/capture the content of the `...` argument, put it in a list:


```r
test <- function(...) {
  return(list(...))
}
test(x = 4, y = "hey", z = 1:5)
#> $x
#> [1] 4
#> 
#> $y
#> [1] "hey"
#> 
#> $z
#> [1] 1 2 3 4 5
```



## Documenting your functions {#r-functions-doc}

It is always a good idea to document your functions. This is in fact always done in functions of a package. For instance try `?mutate` and see the documentation in the **Help** tab.

Assume that you have written a function


```r
subtract <- function(x, y) {
  return(x-y)
}
```

In RStudio you can insert a [Roxygen](https://cran.r-project.org/web/packages/roxygen2/vignettes/roxygen2.html) documentation skeleton by having the cursor at the first line of the function and go to **Code > Insert Roxygen Skeleton** (Ctrl+Alt+Shift+R):


```r
#' Title
#'
#' @param x 
#' @param y 
#'
#' @return
#' @export
#'
#' @examples
subtract <- function(x, y) {
  return(x-y)
}
```

You now can modify your documentation to


```r
#' Subtract two vectors
#'
#' @param x First vector.
#' @param y Vector to be subtracted.
#'
#' @return The difference.
#' @export
#'
#' @examples
#' subtract(x = c(5,5), y = c(2,3))
subtract <- function(x, y) {
  return(x-y)
}
```

Note 

* Parameters/function arguments are documented using the `@param` tag.
* Return value is documented using the `@return` tag. 
* Under the `@examples` tag you can insert some examples. 
* Ignore the `@export` tag. This is used if you include your function in your own package. Package development is beyond the scope of this course. If you are interested, have a look at the book @r-pkgs. 

A list of further tags can be seen in the vignette [Rd (documentation) tags](https://roxygen2.r-lib.org/articles/rd.html).


## Recap {#rc-functions}

Writing functions is a core activity of an R programmer. It represents the key step of the transition from a user to a programmer. Functions have inputs and outputs. Functions (and control structures) are what makes your code more dynamic.

Functions are often used to encapsulate a sequence of expressions that need to be executed numerous times, perhaps under slightly different conditions. In programming, functional programming is a programming paradigm, a style of how code is written. Rather than repeating the code, functions and control structures allow one to build code in blocks. As a result, your code becomes more structured, more readable and much easier to maintain and debug (find errors).

Functions can be defined using the `function()` directive. 

The named arguments (input values) can have default values. Moreover, R passes arguments by value. That is, an R function cannot change the variable that you input to that function. 

A function can be called using its name and its arguments can be specified by name or by position in the argument list.

Functions always return the last expression evaluated in the function body or when you use the `return` flow control statement (good coding practice). 

Scoping refers to the rules R use to look up the value of variables. A function will first look inside the body of the function to identify all the variables. If all variables exist, no further search is required. Otherwise, R will look one level up to see if the variable exists. 

Functions can be assigned to R objects just like any other R object.

Document your functions using the Roxygen skeleton!

You may also have a look at the [slides for this module](https://bss-osca.github.io/tfa/slides/06-02_r-functions-slides.html).



## Exercises {#ex-r-functions}

Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the [help page](#help). Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution!

[Link to the project on RStudio Cloud for this module][r-cloud-mod14]. 

### Exercise (defining functions)

*Solve this exercise using a script file.*


<div class="modal fade bs-example-modal-lg" id="dDphtPPFNEvT2lKYfH3Q" tabindex="-1" role="dialog" aria-labelledby="dDphtPPFNEvT2lKYfH3Q-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="dDphtPPFNEvT2lKYfH3Q-title">Solution</h4></div><div class="modal-body">

```r
#' Computes the sum of the integers from 1 to n (inclusive).
#'
#' @param n Max value in the sum.
#'
#' @return Sum of the integers from 1 to n.
#'
#' @examples
#' sum_n(30)
sum_n <- function(n) {
  return(sum(1:n))
}
sum_n(5000)
#> [1] 12502500
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#dDphtPPFNEvT2lKYfH3Q">Solution</button>

<div class="modal fade bs-example-modal-lg" id="byy5UOOJgHOznJoDVA7t" tabindex="-1" role="dialog" aria-labelledby="byy5UOOJgHOznJoDVA7t-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="byy5UOOJgHOznJoDVA7t-title">Hint</h4></div><div class="modal-body">

```r
#' Computes the sum of the integers from 1 to n (inclusive).
#'
#' @param n Max value in the sum.
#'
#' @return Sum of the integers from 1 to n.
#'
#' @examples
#' sum_n(30)
sum_n <- function(n) {
  return(___)
}
sum_n(5000)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#byy5UOOJgHOznJoDVA7t">Hint</button>

1) Create a function `sum_n` that for any given value, say $n$, computes the sum of the integers from 1 to n (inclusive). Use the function to determine the sum of integers from 1 to 5000. Document your function too.



<div class="modal fade bs-example-modal-lg" id="5rH1mM1k1QFUe5B6ocdO" tabindex="-1" role="dialog" aria-labelledby="5rH1mM1k1QFUe5B6ocdO-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="5rH1mM1k1QFUe5B6ocdO-title">Solution</h4></div><div class="modal-body">

```r
#' Computes the sum S_n = 1^2 + 2^2 + 3^2 + ... + n^2
#'
#' @param n Max input in sum.
#'
#' @return S_n
compute_s_n <- function(n) {
  return(sum((1:n)^2))
}
compute_s_n(10)
#> [1] 385
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#5rH1mM1k1QFUe5B6ocdO">Solution</button>

2) Write a function `compute_s_n` that for any given $n$ computes the sum $S_n = 1^2 + 2^2 + 3^2 + \dots + n^2$. Report the value of the sum when $n=10$.



<div class="modal fade bs-example-modal-lg" id="QLnseaK4aBjId7Fon2s7" tabindex="-1" role="dialog" aria-labelledby="QLnseaK4aBjId7Fon2s7-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="QLnseaK4aBjId7Fon2s7-title">Solution 1</h4></div><div class="modal-body">

```r
s_n <- vector('numeric', 25)
for (n in 1:25) {
  s_n[n] <- compute_s_n(n)
}
s_n
#>  [1]    1    5   14   30   55   91  140  204  285  385  506  650  819 1015 1240 1496 1785 2109 2470
#> [20] 2870 3311 3795 4324 4900 5525
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#QLnseaK4aBjId7Fon2s7">Solution 1</button>

<div class="modal fade bs-example-modal-lg" id="bTYjTzzObLRE013lTqaB" tabindex="-1" role="dialog" aria-labelledby="bTYjTzzObLRE013lTqaB-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="bTYjTzzObLRE013lTqaB-title">Hint 1</h4></div><div class="modal-body">

```r
s_n <- vector('numeric', 25)
for (n in 1:25) {
  s_n[n] <- ___
}
s_n
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#bTYjTzzObLRE013lTqaB">Hint 1</button>

<div class="modal fade bs-example-modal-lg" id="btnVQettBF7n6plwSwms" tabindex="-1" role="dialog" aria-labelledby="btnVQettBF7n6plwSwms-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="btnVQettBF7n6plwSwms-title">Solution 2</h4></div><div class="modal-body">

```r
compute_s_n_alt <- function(n) {
  return(n*(n+1)*(2*n+1)/6)
}
for (n in 1:25) {
  if (s_n[n] != compute_s_n_alt(n)) {
    cat('Error!')
    break
  }
}
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#btnVQettBF7n6plwSwms">Solution 2</button>

<div class="modal fade bs-example-modal-lg" id="O6HiMN1W7s4mq2HdmOvO" tabindex="-1" role="dialog" aria-labelledby="O6HiMN1W7s4mq2HdmOvO-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="O6HiMN1W7s4mq2HdmOvO-title">Hint 2</h4></div><div class="modal-body">

```r
compute_s_n_alt <- function(n) {
  return(n*(n+1)*___)
}
for (n in 1:25) {
  if (s_n[n] != ___) {
    cat('Error!')
    break
  }
}
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#O6HiMN1W7s4mq2HdmOvO">Hint 2</button>

3) Define an empty numerical vector `s_n` of size 25 using `s_n <- vector("numeric", 25)` and store in the results of $S_1, S_2, \dots S_{25}$ using a for-loop. 
   Confirm that the formula for the sum is $S_n= n(n+1)(2n+1)/6$ for $n = 1, \ldots, 25$.






<div class="modal fade bs-example-modal-lg" id="QHbY2kCeWdcHDXzKK2Wb" tabindex="-1" role="dialog" aria-labelledby="QHbY2kCeWdcHDXzKK2Wb-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="QHbY2kCeWdcHDXzKK2Wb-title">Solution</h4></div><div class="modal-body">

```r
biggest <- function(a, b) {
  if (a > b) return(1)
  return(0)
}
biggest(3,4)
#> [1] 0
biggest(3,3)
#> [1] 0
biggest(8,2)
#> [1] 1
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#QHbY2kCeWdcHDXzKK2Wb">Solution</button>

<div class="modal fade bs-example-modal-lg" id="kxU5GsqqweUBi5Swqi7a" tabindex="-1" role="dialog" aria-labelledby="kxU5GsqqweUBi5Swqi7a-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="kxU5GsqqweUBi5Swqi7a-title">Hint</h4></div><div class="modal-body">

```r
biggest <- function(a, b) {
  if (a > b) ___
  return(0)
}
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#kxU5GsqqweUBi5Swqi7a">Hint</button>

4) Write a function `biggest` which takes two integers as arguments.  Let the 
function  return  1  if  the  first argument  is  larger  than  the second and return  0 
otherwise. 



<div class="modal fade bs-example-modal-lg" id="zcG34sMwYVw6oNYJ5mBe" tabindex="-1" role="dialog" aria-labelledby="zcG34sMwYVw6oNYJ5mBe-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="zcG34sMwYVw6oNYJ5mBe-title">Solution</h4></div><div class="modal-body">

```r
shipping_cost <- function(total) {
  return(0.1 * total)
}
shipping_cost(450)
#> [1] 45
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#zcG34sMwYVw6oNYJ5mBe">Solution</button>

<div class="modal fade bs-example-modal-lg" id="QCzR1wsbIoxq7yY080om" tabindex="-1" role="dialog" aria-labelledby="QCzR1wsbIoxq7yY080om-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="QCzR1wsbIoxq7yY080om-title">Hint</h4></div><div class="modal-body">

```r
shipping_cost <- function(total) {
  return(___)
}
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#QCzR1wsbIoxq7yY080om">Hint</button>

5) Write a function that returns the shipping cost as 10% of the total cost of an 
order (input argument).   




<div class="modal fade bs-example-modal-lg" id="vMypmcxUtORwg1AUQztL" tabindex="-1" role="dialog" aria-labelledby="vMypmcxUtORwg1AUQztL-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="vMypmcxUtORwg1AUQztL-title">Solution</h4></div><div class="modal-body">

```r
shipping_cost <- function(total, pct = 0.1) {
  return(pct * total)
}
shipping_cost(450)
#> [1] 45
shipping_cost(450, pct = 0.2)
#> [1] 90
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#vMypmcxUtORwg1AUQztL">Solution</button>

<div class="modal fade bs-example-modal-lg" id="hufd9bGSDFeT9Gic84xM" tabindex="-1" role="dialog" aria-labelledby="hufd9bGSDFeT9Gic84xM-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="hufd9bGSDFeT9Gic84xM-title">Hint</h4></div><div class="modal-body">

```r
shipping_cost <- function(total, pct = ___) {
  ___
}
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#hufd9bGSDFeT9Gic84xM">Hint</button>

6) Given Question 5, rewrite the function so the percentage is an input argument with a default of 10%. 



<div class="modal fade bs-example-modal-lg" id="gqE2apMKdxaV9qDfc3wa" tabindex="-1" role="dialog" aria-labelledby="gqE2apMKdxaV9qDfc3wa-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="gqE2apMKdxaV9qDfc3wa-title">Solution</h4></div><div class="modal-body">

```r
shipping_cost <- function(total) {
  return(0.1 * total)
}

gasoline_cost <- function(total) {
  return(shipping_cost(total) * 0.5)
}
gasoline_cost(450)
#> [1] 22.5
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#gqE2apMKdxaV9qDfc3wa">Solution</button>

<div class="modal fade bs-example-modal-lg" id="rWGbngTScRb0zP7rXs2s" tabindex="-1" role="dialog" aria-labelledby="rWGbngTScRb0zP7rXs2s-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="rWGbngTScRb0zP7rXs2s-title">Hint</h4></div><div class="modal-body">

```r
gasoline_cost <- function(total) {
  return(shipping_cost(___) * ___)
}
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#rWGbngTScRb0zP7rXs2s">Hint</button>

7) Given Question 5, the shipping cost can be split into parts. One part is gasoline which is 50% of the shipping cost. Write a function that has total cost as input argument and calculate the gasoline cost and use the function defined in Question 5 inside it.   
  
  
  

<div class="modal fade bs-example-modal-lg" id="ilrVvC1JeJwmLTPmU0dE" tabindex="-1" role="dialog" aria-labelledby="ilrVvC1JeJwmLTPmU0dE-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="ilrVvC1JeJwmLTPmU0dE-title">Solution</h4></div><div class="modal-body">

```r
shipping_cost <- function(total, pct = 0.1) {
  return(pct * total)
}

gasoline_cost <- function(total, ...) {
  return(shipping_cost(total, ...) * 0.5)
}
gasoline_cost(450)
#> [1] 22.5
gasoline_cost(450, pct = 0.2)
#> [1] 45
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ilrVvC1JeJwmLTPmU0dE">Solution</button>

<div class="modal fade bs-example-modal-lg" id="kIuqS4ZZzKfwZg5rVDPs" tabindex="-1" role="dialog" aria-labelledby="kIuqS4ZZzKfwZg5rVDPs-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="kIuqS4ZZzKfwZg5rVDPs-title">Hint</h4></div><div class="modal-body">

```r
gasoline_cost <- function(total, ...) {
  return(shipping_cost(___) * ___)
}
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#kIuqS4ZZzKfwZg5rVDPs">Hint</button>

8) Given Question 6, the shipping cost can be split into parts. One part is gasoline which is 50% of the shipping cost. Write a function that has total cost a input argument and calculate the gasoline cost and use the function defined in Question 6 inside it. Hint: Use the `...` argument to pass arguments to `shipping_cost`.




<div class="modal fade bs-example-modal-lg" id="UfHoFMEwP8uLq8MF2mCO" tabindex="-1" role="dialog" aria-labelledby="UfHoFMEwP8uLq8MF2mCO-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="UfHoFMEwP8uLq8MF2mCO-title">Solution</h4></div><div class="modal-body">

```r
shipping_cost <- function(total, pct = 0.1) {
  return(pct * total)
}

gasoline_cost <- function(total, ...) {
  return(shipping_cost(total, ...) * 0.5)
}

costs <- function(total, ...) {
  lst <- list(total = total, shipping = shipping_cost(total, ...), gasoline = gasoline_cost(total, ...))
  return(lst)
}
costs(450)
#> $total
#> [1] 450
#> 
#> $shipping
#> [1] 45
#> 
#> $gasoline
#> [1] 22.5
costs(450, pct = 0.15)
#> $total
#> [1] 450
#> 
#> $shipping
#> [1] 67.5
#> 
#> $gasoline
#> [1] 33.8
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#UfHoFMEwP8uLq8MF2mCO">Solution</button>

<div class="modal fade bs-example-modal-lg" id="KbXzFjyYOp6XRG9sYYaj" tabindex="-1" role="dialog" aria-labelledby="KbXzFjyYOp6XRG9sYYaj-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="KbXzFjyYOp6XRG9sYYaj-title">Hint</h4></div><div class="modal-body">

```r
shipping_cost <- function(total, pct = 0.1) {
  return(pct * total)
}

gasoline_cost <- function(total, ...) {
  return(shipping_cost(total, ...) * 0.5)
}

costs <- function(total, ...) {
  lst <- list(total = ___, shipping = ___, gasoline = ___)
  return(lst)
}
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#KbXzFjyYOp6XRG9sYYaj">Hint</button>

9) Given Question 8, write a function `costs` that, given total cost, returns the total cost, shipping cost and gasoline cost.

  
  
  
### Exercise (scope)


<div class="modal fade bs-example-modal-lg" id="dc3Zacc54gp9mUzUYNW4" tabindex="-1" role="dialog" aria-labelledby="dc3Zacc54gp9mUzUYNW4-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="dc3Zacc54gp9mUzUYNW4-title">Solution</h4></div><div class="modal-body">

<p>That value is still 3 since <code>x</code> defined inside the function is a local variable.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#dc3Zacc54gp9mUzUYNW4">Solution</button>

1) After running the code below, what is the value of variable `x`?


```r
x <- 3
my_func <- function(y){
  x <- 5
  return(y + 5)
}
my_func(7)
```


<div class="modal fade bs-example-modal-lg" id="XxWR2229TnHkWH1f4p8e" tabindex="-1" role="dialog" aria-labelledby="XxWR2229TnHkWH1f4p8e-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="XxWR2229TnHkWH1f4p8e-title">Solution</h4></div><div class="modal-body">

<p>The code runs. But it is not good coding practice to call global variables inside a function (<code>x</code>). Instead <code>x</code> should have been an argument to the function.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#XxWR2229TnHkWH1f4p8e">Solution</button>

2) Is there any problems with the following code?


```r
x <- 3
my_func <- function(y){
  return(y + x) 
}
my_func(7)
```


<div class="modal fade bs-example-modal-lg" id="pF8lDGWTNmY9zF8DNMI2" tabindex="-1" role="dialog" aria-labelledby="pF8lDGWTNmY9zF8DNMI2-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="pF8lDGWTNmY9zF8DNMI2-title">Solution</h4></div><div class="modal-body">

<p>That value is still 3 since <code>my_func</code> has not been called yet.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#pF8lDGWTNmY9zF8DNMI2">Solution</button>

3) Have a look at the documentation for operator `<<-` (run `?'<<-'`). After running the code below, what is the value of variable `x`?


```r
x <- 3
my_func <- function(y){
  x <- 4
  x <<- 5
  return(y + 5)
}
```


<div class="modal fade bs-example-modal-lg" id="vZDsSXme8JwBkS8Cf8PR" tabindex="-1" role="dialog" aria-labelledby="vZDsSXme8JwBkS8Cf8PR-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="vZDsSXme8JwBkS8Cf8PR-title">Solution</h4></div><div class="modal-body">

<p>That value of <code>x</code> is 5 since <code>&lt;&lt;-</code> is used to look at the parent environment. The function call returns 11 since the <code>x</code> used is the local variable. In general avoid using <code>&lt;&lt;-</code> and give local variables different names compared to global ones.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#vZDsSXme8JwBkS8Cf8PR">Solution</button>

4) After running the code below, what is the value of variable `x` and output of the function call?


```r
x <- 3
my_func <- function(y){
  x <- 4
  x <<- 5
  return(y + x)
}
my_func(7)
```


### Exercise (job sequencing)

*Solve this exercise using a script file.*

This exercise is based on Exercise 6.12 in @vba-book. 

Consider a problem of determining the best sequencing of jobs on a machine. A set of startup costs are given for 5 machines:


```r
startup_costs <- c(27, 28, 32, 35, 26)
startup_costs
#> [1] 27 28 32 35 26
```

Moreover, when changing from one job to another job, the setup costs are given as:


```r
setup_costs <- matrix(c(
  NA, 35, 22, 44, 12,
  49, NA, 46, 38, 17,
  46, 12, NA, 29, 41,
  23, 37, 31, NA, 26,
  17, 23, 28, 34, NA), 
  byrow = T, nrow = 5)
setup_costs
#>      [,1] [,2] [,3] [,4] [,5]
#> [1,]   NA   35   22   44   12
#> [2,]   49   NA   46   38   17
#> [3,]   46   12   NA   29   41
#> [4,]   23   37   31   NA   26
#> [5,]   17   23   28   34   NA
```

The goal of the problem is to determine a sequence of jobs which minimizes the total setup cost including the startup cost.

One possible way to find a sequence is the use a greedy strategy:

```
Greedy Algorithm
Step 0: Start with the job which has minimal startup cost.
Step 1: Select the next job as the job not already done 
        with minimal setup cost given current job. 
Step 2: Set next job in Step 1 to current job and 
        go to Step 1 if not all jobs are done.
```

In R the greedy algorithm can be implemented as:


```r
greedy <- function(startup, setup) {
  jobs <- nrow(setup)
  cur_job <- which.min(startup)
  cost <- startup[cur_job]
  # cat("Start job:", cur_job, "\n")
  job_seq <- cur_job
  setup[, cur_job] <- NA
  for (i in 1:(jobs-1)) {
    next_job <- which.min(setup[cur_job, ])
    # cat("Next job:", next_job, "\n") 
    cost <- cost + setup[cur_job, next_job]
    job_seq <- c(job_seq, next_job)
    cur_job <- next_job
    setup[, cur_job] <- NA
  }
  # print(setup)
  return(list(seq = job_seq, cost = cost))
}
greedy(startup_costs, setup_costs)
#> $seq
#> [1] 5 1 3 2 4
#> 
#> $cost
#> [1] 115
```

First, the job with minimum startup cost is found using function `which.min` and we define cost as the startup cost. We use `cat` to make some debugging statements and initialize `job_seq` with the first job. Next, we have to find a way of ignoring jobs already done. We do that here by setting the columns of setup cost equal to NA for jobs already done. Hence, they will not be selected by `which.min`. The `for` loop runs 4 times and selects jobs and accumulate the total cost.

A well-known better strategy is to:

```
Better Algorithm
Step 0: Subtract minimum of startup and setup cost for each job from setup and 
        startup costs (that is columnwise)
Step 1: Call the greedy algorithm with the modified costs. Note that the total 
        cost returned has to be modified a bit.
```


<div class="modal fade bs-example-modal-lg" id="cFSAr95tIkOR989VUcR3" tabindex="-1" role="dialog" aria-labelledby="cFSAr95tIkOR989VUcR3-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="cFSAr95tIkOR989VUcR3-title">Solution</h4></div><div class="modal-body">

```r
better <- function(startup, setup) {
  jobs <- nrow(setup)
  min_col_val <- apply(rbind(startup, setup), 2, min, na.rm = T)
  startup <- startup - min_col_val
  min_mat <- matrix(rep(min_col_val, jobs), 
                    ncol = jobs, byrow = T)
  setup <- setup - min_mat
  lst <- greedy(startup, setup)
  lst$cost <- lst$cost + sum(min_col_val)
  return(lst)
}
better(startup_costs, setup_costs)
#> $seq
#> [1] 4 1 3 2 5
#> 
#> $cost
#> [1] 109
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#cFSAr95tIkOR989VUcR3">Solution</button>

<div class="modal fade bs-example-modal-lg" id="0DqGbbzBkFK0zRzC6FgZ" tabindex="-1" role="dialog" aria-labelledby="0DqGbbzBkFK0zRzC6FgZ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="0DqGbbzBkFK0zRzC6FgZ-title">Hint 2</h4></div><div class="modal-body">

```r
better <- function(startup, setup) {
  jobs <- nrow(setup)
  min_col_val <- apply(rbind(startup, setup), 2, min, na.rm = T)
  startup <- startup - min_col_val
  min_mat <- matrix(rep(min_col_val, jobs), 
                    ncol = jobs, byrow = T)
  setup <- setup - ___
  lst <- greedy(startup, setup)
  lst$cost <- lst$cost + sum(___)
  return(lst)
}
better(startup_costs, setup_costs)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#0DqGbbzBkFK0zRzC6FgZ">Hint 2</button>

<div class="modal fade bs-example-modal-lg" id="PjZZaD6jbwxkQAQluuoC" tabindex="-1" role="dialog" aria-labelledby="PjZZaD6jbwxkQAQluuoC-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="PjZZaD6jbwxkQAQluuoC-title">Hint 1</h4></div><div class="modal-body">

```r
better <- function(startup, setup) {
  jobs <- nrow(setup)
  min_col_val <- apply(___)
  startup <- startup - ___
  min_mat <- matrix(rep(min_col_val, jobs), 
                    ncol = ___, byrow = T)
  setup <- setup - ___
  lst <- greedy(___, ___)
  lst$cost <- lst$cost + ___
  return(lst)
}
better(startup_costs, setup_costs)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#PjZZaD6jbwxkQAQluuoC">Hint 1</button>

Implement a `better` function calculating a better strategy. Hint: to find the minimum column costs, you may use `apply(rbind(startup, setup), 2, min, na.rm = T)`.



[BSS]: https://bss.au.dk/en/

[course-help]: https://github.com/bss-osca/tfa/issues
[cran]: https://cloud.r-project.org
[cheatsheet-readr]: https://rawgit.com/rstudio/cheatsheets/master/data-import.pdf
[course-welcome-to-the-tidyverse]: https://github.com/rstudio-education/welcome-to-the-tidyverse

[DataCamp]: https://www.datacamp.com/
[datacamp-signup]: https://www.datacamp.com/groups/shared_links/cbaee6c73e7d78549a9e32a900793b2d5491ace1824efc1760a6729735948215
[datacamp-r-intro]: https://learn.datacamp.com/courses/free-introduction-to-r
[datacamp-r-rmarkdown]: https://campus.datacamp.com/courses/reporting-with-rmarkdown
[datacamp-r-communicating]: https://learn.datacamp.com/courses/communicating-with-data-in-the-tidyverse
[datacamp-r-communicating-chap3]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/introduction-to-rmarkdown
[datacamp-r-communicating-chap4]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/customizing-your-rmarkdown-report
[datacamp-r-intermediate]: https://learn.datacamp.com/courses/intermediate-r
[datacamp-r-intermediate-chap1]: https://campus.datacamp.com/courses/intermediate-r/chapter-1-conditionals-and-control-flow
[datacamp-r-intermediate-chap2]: https://campus.datacamp.com/courses/intermediate-r/chapter-2-loops
[datacamp-r-intermediate-chap3]: https://campus.datacamp.com/courses/intermediate-r/chapter-3-functions
[datacamp-r-intermediate-chap4]: https://campus.datacamp.com/courses/intermediate-r/chapter-4-the-apply-family
[datacamp-r-functions]: https://learn.datacamp.com/courses/introduction-to-writing-functions-in-r
[datacamp-r-tidyverse]: https://learn.datacamp.com/courses/introduction-to-the-tidyverse
[datacamp-r-strings]: https://learn.datacamp.com/courses/string-manipulation-with-stringr-in-r
[datacamp-r-dplyr]: https://learn.datacamp.com/courses/data-manipulation-with-dplyr
[datacamp-r-dplyr-bakeoff]: https://learn.datacamp.com/courses/working-with-data-in-the-tidyverse
[datacamp-r-ggplot2-intro]: https://learn.datacamp.com/courses/introduction-to-data-visualization-with-ggplot2
[datacamp-r-ggplot2-intermediate]: https://learn.datacamp.com/courses/intermediate-data-visualization-with-ggplot2
[dplyr-cran]: https://CRAN.R-project.org/package=dplyr
[debug-in-r]: https://rstats.wtf/debugging-r-code.html

[excel-vs-r]: https://www.jessesadler.com/post/excel-vs-r/

[google-form]: https://forms.gle/s39GeDGV9AzAXUo18
[google-grupper]: https://docs.google.com/spreadsheets/d/1DHxthd5AQywAU4Crb3hM9rnog2GqGQYZ2o175SQgn_0/edit?usp=sharing
[GitHub]: https://github.com/
[git-install]: https://git-scm.com/downloads
[github-actions]: https://github.com/features/actions
[github-pages]: https://pages.github.com/

[happy-git]: https://happygitwithr.com
[hg-install-git]: https://happygitwithr.com/install-git.html
[hg-why]: https://happygitwithr.com/big-picture.html#big-picture
[hg-github-reg]: https://happygitwithr.com/github-acct.html#github-acct
[hg-git-install]: https://happygitwithr.com/install-git.html#install-git
[hg-exist-github-first]: https://happygitwithr.com/existing-github-first.html
[hg-exist-github-last]: https://happygitwithr.com/existing-github-last.html
[hg-credential-helper]: https://happygitwithr.com/credential-caching.html
[hypothes.is]: https://web.hypothes.is/

[osca-programme]: https://kandidat.au.dk/en/operationsandsupplychainanalytics/

[Peergrade]: https://peergrade.io
[peergrade-signup]: https://app.peergrade.io/join
[point-and-click]: https://en.wikipedia.org/wiki/Point_and_click
[pkg-bookdown]: https://bookdown.org/yihui/bookdown/
[pkg-openxlsx]: https://ycphs.github.io/openxlsx/index.html
[pkg-ropensci-writexl]: https://docs.ropensci.org/writexl/
[pkg-jsonlite]: https://cran.r-project.org/web/packages/jsonlite/index.html

[R]: https://www.r-project.org
[RStudio]: https://rstudio.com
[rstudio-cloud]: https://rstudio.cloud/spaces/176810/join?access_code=LSGnG2EXTuzSyeYaNXJE77vP33DZUoeMbC0xhfCz
[r-cloud-mod12]: https://rstudio.cloud/spaces/176810/project/2963819
[r-cloud-mod13]: https://rstudio.cloud/spaces/176810/project/3020139
[r-cloud-mod14]: https://rstudio.cloud/spaces/176810/project/3020322
[r-cloud-mod15]: https://rstudio.cloud/spaces/176810/project/3020509
[r-cloud-mod16]: https://rstudio.cloud/spaces/176810/project/3026754
[r-cloud-mod17]: https://rstudio.cloud/spaces/176810/project/3034015
[r-cloud-mod18]: https://rstudio.cloud/spaces/176810/project/3130795
[r-cloud-mod19]: https://rstudio.cloud/spaces/176810/project/3266132
[rstudio-download]: https://rstudio.com/products/rstudio/download/#download
[rstudio-customizing]: https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio
[rstudio-key-shortcuts]: https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts
[rstudio-workbench]: https://www.rstudio.com/wp-content/uploads/2014/04/rstudio-workbench.png
[r-markdown]: https://rmarkdown.rstudio.com/
[ropensci-writexl]: https://docs.ropensci.org/writexl/
[r4ds-pipes]: https://r4ds.had.co.nz/pipes.html
[r4ds-factors]: https://r4ds.had.co.nz/factors.html
[r4ds-strings]: https://r4ds.had.co.nz/strings.html
[r4ds-iteration]: https://r4ds.had.co.nz/iteration.html

[stat-545]: https://stat545.com
[stat-545-functions-part1]: https://stat545.com/functions-part1.html
[stat-545-functions-part2]: https://stat545.com/functions-part2.html
[stat-545-functions-part3]: https://stat545.com/functions-part3.html
[slides-welcome]: https://bss-osca.github.io/tfa/slides/00-tfa_welcome.html
[slides-m1-3]: https://bss-osca.github.io/tfa/slides/01-welcome_r_part.html
[slides-m4-5]: https://bss-osca.github.io/tfa/slides/02-programming.html
[slides-m6-8]: https://bss-osca.github.io/tfa/slides/03-transform.html
[slides-m9]: https://bss-osca.github.io/tfa/slides/04-plot.html
[slides-m83]: https://bss-osca.github.io/tfa/slides/05-joins.html

[tidyverse-main-page]: https://www.tidyverse.org
[tidyverse-packages]: https://www.tidyverse.org/packages/
[tidyverse-core]: https://www.tidyverse.org/packages/#core-tidyverse
[tidyverse-ggplot2]: https://ggplot2.tidyverse.org/
[tidyverse-dplyr]: https://dplyr.tidyverse.org/
[tidyverse-tidyr]: https://tidyr.tidyverse.org/
[tidyverse-readr]: https://readr.tidyverse.org/
[tidyverse-purrr]: https://purrr.tidyverse.org/
[tidyverse-tibble]: https://tibble.tidyverse.org/
[tidyverse-stringr]: https://stringr.tidyverse.org/
[tidyverse-forcats]: https://forcats.tidyverse.org/
[tidyverse-readxl]: https://readxl.tidyverse.org
[tidyverse-googlesheets4]: https://googlesheets4.tidyverse.org/index.html
[tutorial-markdown]: https://commonmark.org/help/tutorial/

[Udemy]: https://www.udemy.com/

[vba-yt-course1]: https://www.youtube.com/playlist?list=PLpOAvcoMay5S_hb2D7iKznLqJ8QG_pde0
[vba-course1-hello]: https://youtu.be/f42OniDWaIo

[vba-yt-course2]: https://www.youtube.com/playlist?list=PL3A6U40JUYCi4njVx59-vaUxYkG0yRO4m
[vba-course2-devel-tab]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-editor]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-project]: https://youtu.be/fp6PTbU7bXo
[vba-course2-devel-properties]: https://youtu.be/ks2QYKAd9Xw
[vba-course2-devel-hello]: https://youtu.be/EQ6tDWBc8G4

[video-install]: https://vimeo.com/415501284
[video-rstudio-intro]: https://vimeo.com/416391353
[video-packages]: https://vimeo.com/416743698
[video-projects]: https://vimeo.com/319318233
[video-r-intro-p1]: https://www.youtube.com/watch?v=vGY5i_J2c-c
[video-r-intro-p2]: https://www.youtube.com/watch?v=w8_XdYI3reU
[video-r-intro-p3]: https://www.youtube.com/watch?v=NuY6jY4qE7I
[video-subsetting]: https://www.youtube.com/watch?v=hWbgqzsQJF0&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10&t=0s
[video-datatypes]: https://www.youtube.com/watch?v=5AQM-yUX9zg&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10
[video-control-structures]: https://www.youtube.com/watch?v=s_h9ruNwI_0
[video-conditional-loops]: https://www.youtube.com/watch?v=2evtsnPaoDg
[video-functions]: https://www.youtube.com/watch?v=ffPeac3BigM
[video-tibble-vs-df]: https://www.youtube.com/watch?v=EBk6PnvE1R4
[video-dplyr]: https://www.youtube.com/watch?v=aywFompr1F4

[wiki-snake-case]: https://en.wikipedia.org/wiki/Snake_case
[wiki-camel-case]: https://en.wikipedia.org/wiki/Camel_case
[wiki-interpreted]: https://en.wikipedia.org/wiki/Interpreted_language
[wiki-literate-programming]: https://en.wikipedia.org/wiki/Literate_programming
[wiki-csv]: https://en.wikipedia.org/wiki/Comma-separated_values
[wiki-json]: https://en.wikipedia.org/wiki/JSON



<!--chapter:end:10_r-functions.Rmd-->

---
output: html_document
editor_options: 
  chunk_output_type: console
---



[BSS]: https://bss.au.dk/en/

[course-help]: https://github.com/bss-osca/tfa/issues
[cran]: https://cloud.r-project.org
[cheatsheet-readr]: https://rawgit.com/rstudio/cheatsheets/master/data-import.pdf
[course-welcome-to-the-tidyverse]: https://github.com/rstudio-education/welcome-to-the-tidyverse

[DataCamp]: https://www.datacamp.com/
[datacamp-signup]: https://www.datacamp.com/groups/shared_links/cbaee6c73e7d78549a9e32a900793b2d5491ace1824efc1760a6729735948215
[datacamp-r-intro]: https://learn.datacamp.com/courses/free-introduction-to-r
[datacamp-r-rmarkdown]: https://campus.datacamp.com/courses/reporting-with-rmarkdown
[datacamp-r-communicating]: https://learn.datacamp.com/courses/communicating-with-data-in-the-tidyverse
[datacamp-r-communicating-chap3]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/introduction-to-rmarkdown
[datacamp-r-communicating-chap4]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/customizing-your-rmarkdown-report
[datacamp-r-intermediate]: https://learn.datacamp.com/courses/intermediate-r
[datacamp-r-intermediate-chap1]: https://campus.datacamp.com/courses/intermediate-r/chapter-1-conditionals-and-control-flow
[datacamp-r-intermediate-chap2]: https://campus.datacamp.com/courses/intermediate-r/chapter-2-loops
[datacamp-r-intermediate-chap3]: https://campus.datacamp.com/courses/intermediate-r/chapter-3-functions
[datacamp-r-intermediate-chap4]: https://campus.datacamp.com/courses/intermediate-r/chapter-4-the-apply-family
[datacamp-r-functions]: https://learn.datacamp.com/courses/introduction-to-writing-functions-in-r
[datacamp-r-tidyverse]: https://learn.datacamp.com/courses/introduction-to-the-tidyverse
[datacamp-r-strings]: https://learn.datacamp.com/courses/string-manipulation-with-stringr-in-r
[datacamp-r-dplyr]: https://learn.datacamp.com/courses/data-manipulation-with-dplyr
[datacamp-r-dplyr-bakeoff]: https://learn.datacamp.com/courses/working-with-data-in-the-tidyverse
[datacamp-r-ggplot2-intro]: https://learn.datacamp.com/courses/introduction-to-data-visualization-with-ggplot2
[datacamp-r-ggplot2-intermediate]: https://learn.datacamp.com/courses/intermediate-data-visualization-with-ggplot2
[dplyr-cran]: https://CRAN.R-project.org/package=dplyr
[debug-in-r]: https://rstats.wtf/debugging-r-code.html

[excel-vs-r]: https://www.jessesadler.com/post/excel-vs-r/

[google-form]: https://forms.gle/s39GeDGV9AzAXUo18
[google-grupper]: https://docs.google.com/spreadsheets/d/1DHxthd5AQywAU4Crb3hM9rnog2GqGQYZ2o175SQgn_0/edit?usp=sharing
[GitHub]: https://github.com/
[git-install]: https://git-scm.com/downloads
[github-actions]: https://github.com/features/actions
[github-pages]: https://pages.github.com/

[happy-git]: https://happygitwithr.com
[hg-install-git]: https://happygitwithr.com/install-git.html
[hg-why]: https://happygitwithr.com/big-picture.html#big-picture
[hg-github-reg]: https://happygitwithr.com/github-acct.html#github-acct
[hg-git-install]: https://happygitwithr.com/install-git.html#install-git
[hg-exist-github-first]: https://happygitwithr.com/existing-github-first.html
[hg-exist-github-last]: https://happygitwithr.com/existing-github-last.html
[hg-credential-helper]: https://happygitwithr.com/credential-caching.html
[hypothes.is]: https://web.hypothes.is/

[osca-programme]: https://kandidat.au.dk/en/operationsandsupplychainanalytics/

[Peergrade]: https://peergrade.io
[peergrade-signup]: https://app.peergrade.io/join
[point-and-click]: https://en.wikipedia.org/wiki/Point_and_click
[pkg-bookdown]: https://bookdown.org/yihui/bookdown/
[pkg-openxlsx]: https://ycphs.github.io/openxlsx/index.html
[pkg-ropensci-writexl]: https://docs.ropensci.org/writexl/
[pkg-jsonlite]: https://cran.r-project.org/web/packages/jsonlite/index.html

[R]: https://www.r-project.org
[RStudio]: https://rstudio.com
[rstudio-cloud]: https://rstudio.cloud/spaces/176810/join?access_code=LSGnG2EXTuzSyeYaNXJE77vP33DZUoeMbC0xhfCz
[r-cloud-mod12]: https://rstudio.cloud/spaces/176810/project/2963819
[r-cloud-mod13]: https://rstudio.cloud/spaces/176810/project/3020139
[r-cloud-mod14]: https://rstudio.cloud/spaces/176810/project/3020322
[r-cloud-mod15]: https://rstudio.cloud/spaces/176810/project/3020509
[r-cloud-mod16]: https://rstudio.cloud/spaces/176810/project/3026754
[r-cloud-mod17]: https://rstudio.cloud/spaces/176810/project/3034015
[r-cloud-mod18]: https://rstudio.cloud/spaces/176810/project/3130795
[r-cloud-mod19]: https://rstudio.cloud/spaces/176810/project/3266132
[rstudio-download]: https://rstudio.com/products/rstudio/download/#download
[rstudio-customizing]: https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio
[rstudio-key-shortcuts]: https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts
[rstudio-workbench]: https://www.rstudio.com/wp-content/uploads/2014/04/rstudio-workbench.png
[r-markdown]: https://rmarkdown.rstudio.com/
[ropensci-writexl]: https://docs.ropensci.org/writexl/
[r4ds-pipes]: https://r4ds.had.co.nz/pipes.html
[r4ds-factors]: https://r4ds.had.co.nz/factors.html
[r4ds-strings]: https://r4ds.had.co.nz/strings.html
[r4ds-iteration]: https://r4ds.had.co.nz/iteration.html

[stat-545]: https://stat545.com
[stat-545-functions-part1]: https://stat545.com/functions-part1.html
[stat-545-functions-part2]: https://stat545.com/functions-part2.html
[stat-545-functions-part3]: https://stat545.com/functions-part3.html
[slides-welcome]: https://bss-osca.github.io/tfa/slides/00-tfa_welcome.html
[slides-m1-3]: https://bss-osca.github.io/tfa/slides/01-welcome_r_part.html
[slides-m4-5]: https://bss-osca.github.io/tfa/slides/02-programming.html
[slides-m6-8]: https://bss-osca.github.io/tfa/slides/03-transform.html
[slides-m9]: https://bss-osca.github.io/tfa/slides/04-plot.html
[slides-m83]: https://bss-osca.github.io/tfa/slides/05-joins.html

[tidyverse-main-page]: https://www.tidyverse.org
[tidyverse-packages]: https://www.tidyverse.org/packages/
[tidyverse-core]: https://www.tidyverse.org/packages/#core-tidyverse
[tidyverse-ggplot2]: https://ggplot2.tidyverse.org/
[tidyverse-dplyr]: https://dplyr.tidyverse.org/
[tidyverse-tidyr]: https://tidyr.tidyverse.org/
[tidyverse-readr]: https://readr.tidyverse.org/
[tidyverse-purrr]: https://purrr.tidyverse.org/
[tidyverse-tibble]: https://tibble.tidyverse.org/
[tidyverse-stringr]: https://stringr.tidyverse.org/
[tidyverse-forcats]: https://forcats.tidyverse.org/
[tidyverse-readxl]: https://readxl.tidyverse.org
[tidyverse-googlesheets4]: https://googlesheets4.tidyverse.org/index.html
[tutorial-markdown]: https://commonmark.org/help/tutorial/

[Udemy]: https://www.udemy.com/

[vba-yt-course1]: https://www.youtube.com/playlist?list=PLpOAvcoMay5S_hb2D7iKznLqJ8QG_pde0
[vba-course1-hello]: https://youtu.be/f42OniDWaIo

[vba-yt-course2]: https://www.youtube.com/playlist?list=PL3A6U40JUYCi4njVx59-vaUxYkG0yRO4m
[vba-course2-devel-tab]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-editor]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-project]: https://youtu.be/fp6PTbU7bXo
[vba-course2-devel-properties]: https://youtu.be/ks2QYKAd9Xw
[vba-course2-devel-hello]: https://youtu.be/EQ6tDWBc8G4

[video-install]: https://vimeo.com/415501284
[video-rstudio-intro]: https://vimeo.com/416391353
[video-packages]: https://vimeo.com/416743698
[video-projects]: https://vimeo.com/319318233
[video-r-intro-p1]: https://www.youtube.com/watch?v=vGY5i_J2c-c
[video-r-intro-p2]: https://www.youtube.com/watch?v=w8_XdYI3reU
[video-r-intro-p3]: https://www.youtube.com/watch?v=NuY6jY4qE7I
[video-subsetting]: https://www.youtube.com/watch?v=hWbgqzsQJF0&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10&t=0s
[video-datatypes]: https://www.youtube.com/watch?v=5AQM-yUX9zg&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10
[video-control-structures]: https://www.youtube.com/watch?v=s_h9ruNwI_0
[video-conditional-loops]: https://www.youtube.com/watch?v=2evtsnPaoDg
[video-functions]: https://www.youtube.com/watch?v=ffPeac3BigM
[video-tibble-vs-df]: https://www.youtube.com/watch?v=EBk6PnvE1R4
[video-dplyr]: https://www.youtube.com/watch?v=aywFompr1F4

[wiki-snake-case]: https://en.wikipedia.org/wiki/Snake_case
[wiki-camel-case]: https://en.wikipedia.org/wiki/Camel_case
[wiki-interpreted]: https://en.wikipedia.org/wiki/Interpreted_language
[wiki-literate-programming]: https://en.wikipedia.org/wiki/Literate_programming
[wiki-csv]: https://en.wikipedia.org/wiki/Comma-separated_values
[wiki-json]: https://en.wikipedia.org/wiki/JSON

# (PART) R - IO, tidy and transform {-} 

# Introduction to tidyverse and RMarkdown {#mod-r-tidyverse-intro}

The [tidyverse][tidyverse-main-page] is a collection of R packages designed for data science. RMarkdown documents support the concept of [literate programming][wiki-literate-programming] where you weave R code together with text (written in Markdown) to produce elegantly formatted documents. 

We are all different and you may like different learning styles compared to others. In the learning path diagram, there may be links to alternative online content. Note this is an alternative to the standard learning path that you may use instead. The learning path may also have extra content, that is not a part of syllabus, you can have a look at. 


```{=html}
<div id="htmlwidget-9483e9bd9ffbdb444bbf" style="width:100%;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-9483e9bd9ffbdb444bbf">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"📖 Tidyverse\", URL = \"#r-tidyverse-intro\", tooltip = \"The tidyverse package\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"0,2!\"] \n  \"2\" [label = \"📖 Reproducible\\nreports\", URL = \"#r-markdown-intro\", tooltip = \"Writing reproducible reports\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"2,2!\"] \n  \"3\" [label = \"💡 RMarkdown\", URL = \"https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/introduction-to-rmarkdown?ex=1\", tooltip = \"An introduction to RMarkdown (do Chapters 3 and 4)\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"4.5,2!\"] \n  \"4\" [label = \"📖 Tibbles\", URL = \"#r-tibbles-intro\", tooltip = \"A short introduction to tibbles\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"7,2!\"] \n  \"5\" [label = \"💻 Exercises\", URL = \"#ex-tidyverse-intro\", tooltip = \"Exercises\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"9.5,2!\"] \n  \"6\" [label = \"📖 RMarkdown\", URL = \"https://rbasics.netlify.app/4-rmarkdown.html\", tooltip = \"Chapter 4 in Ismay and Kennedy (2019) gives an overview of R Markdown with videos included.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkOrange4\", pos = \"3,0!\"] \n  \"7\" [label = \"💡 RMarkdown\", URL = \"https://campus.datacamp.com/courses/reporting-with-rmarkdown/getting-started-with-r-markdown?ex=1\", tooltip = \"The interactive DataCamp course Reporting with R Markdown (a bit longer).\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkOrange4\", pos = \"5,0!\"] \n  \"8\" [label = \"💡 Markdown\", URL = \"https://commonmark.org/help/tutorial/\", tooltip = \"An interactive markdown tutorial.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"4.5,4!\"] \n  \"9\" [label = \"📖 Reproducible\\nreports\", URL = \"https://rpubs.com/glennwithtwons/reproducible-r-toolbox\", tooltip = \"Glenn Moncrieff gives a nice detailed overview on how to create reproducible projects.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"2,4!\"] \n  \"10\" [label = \"🎬 Tibbles\", URL = \"https://www.youtube.com/watch?v=EBk6PnvE1R4\", tooltip = \"An introduction to tibbles and differences to data frames is given in the video by Hefin Rhys.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkOrange4\", pos = \"7,4!\"] \n  \"11\" [label = \"📖 Tibbles\", URL = \"https://r4ds.had.co.nz/tibbles.html\", tooltip = \"Chapter 10 in Wickham (2017) gives an introduction to tibbles.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkOrange4\", pos = \"7,0!\"] \n  \"12\" [label = \"\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"0.5\", fontname = \"Helvetica\", shape = \"rect\", height = \"1\", width = \"6\", fillcolor = \"#F0F8FF\", pos = \"2.4,5.66!\"] \n  \"13\" [label = \"Color:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"0.8\", fillcolor = \"#FFFFFE\", pos = \"-0.23,6!\"] \n  \"14\" [label = \"mandatory\", URL = \"\", tooltip = \"Mandatory syllabus.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkSeaGreen4\", pos = \"0,5.6!\"] \n  \"15\" [label = \"alternative\", URL = \"\", tooltip = \"Alternative syllabus if you prefer another learning style.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkOrange4\", pos = \"1,5.6!\"] \n  \"16\" [label = \"extra\", URL = \"\", tooltip = \"Extra learning if you are interested (not part of syllabus).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"PeachPuff3\", pos = \"2,5.6!\"] \n  \"17\" [label = \"Shape:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"1\", fillcolor = \"#FFFFFE\", pos = \"3.2,6!\"] \n  \"18\" [label = \"non-interactive\", URL = \"\", tooltip = \"Non-interactive learning content (e.g. reading).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"1\", fillcolor = \"Grey40\", pos = \"3.5,5.6!\"] \n  \"19\" [label = \"interactive\", URL = \"\", tooltip = \"Interactive learning content (tutorial, exercises etc.).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"egg\", width = \"1\", fillcolor = \"Grey40\", pos = \"4.75,5.6!\"] \n\"1\"->\"2\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"3\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"9\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"4\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"6\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"7\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"8\" [color = \"black\", arrowhead = \"vee\"] \n\"4\"->\"5\" [color = \"black\", arrowhead = \"vee\"] \n\"4\"->\"10\" [color = \"black\", arrowhead = \"vee\"] \n\"4\"->\"11\" [color = \"black\", arrowhead = \"vee\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
```

<!-- * [Chapter 4](https://rbasics.netlify.app/4-rmarkdown.html) in @rbasics gives an overview of RMarkdown with videos included.  -->
<!-- * You may also do the interactive DataCamp [Reporting with RMarkdown][datacamp-r-rmarkdown] which is a bit longer than the suggested course.  -->
<!-- * If **Help > Markdown Quick Reference** not is enough, then try out this [interactive markdown tutorial][tutorial-markdown]. -->
<!-- * Glenn Moncrieff gives a nice detailed overview on how to create [reproducible projects](https://rpubs.com/glennwithtwons/reproducible-r-toolbox).   -->
<!-- * If you are interested in trying Git and GitHub, see @hgit for detailed help. -->
<!-- * An introduction to tibbles and differences to data frames is given in the video [Working with tibbles in R][video-tibble-vs-df] by Hefin Rhys. -->
<!-- * [Chapter 10](https://r4ds.had.co.nz/tibbles.html) in @r4ds gives an introduction to tibbles. -->


## Learning outcomes {#lo-tidyverse-intro}

By the end of this module, you are expected to be able to:

* Describe what the tidyverse package is.
* Explain the ideas behind reproducible reports and literal programming. 
* Create your first RMarkdown document and add some code and text.

The learning outcomes relate to the [overall learning goals](#lg-course) number 7, 17 and 18 of the course.

<!-- SOLO increasing: identify · memorize · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyze · relate · derive · -->
<!-- evaluate · apply · argue · theorize · generalize · hypothesis · solve · reflect -->


## The tidyverse package {#r-tidyverse-intro}

The [tidyverse][tidyverse-main-page] is a collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures.

The [core tidyverse][tidyverse-core] includes the packages that you are likely to use in everyday data analyses. In tidyverse 1.3.0, the following packages are included in the core tidyverse:

* [dplyr][tidyverse-dplyr] provides a grammar of data manipulation, providing a consistent set of verbs that solve the most common data manipulation challenges. We are going to use dplyr in Module \@ref(mod-r-transform).

* [ggplot2][tidyverse-ggplot2] is a system for declaratively creating graphics, based on The Grammar of Graphics. You provide the data, tell ggplot2 how to map variables to aesthetics, what graphical primitives to use, and it takes care of the details. We are going to use ggplot in Module \@ref(mod-r-plot).

* [tidyr][tidyverse-tidyr] provides a set of functions that help you get to tidy data. Tidy data is data with a consistent form: in brief, every variable goes in a column, and every column is a variable. 

* [readr][tidyverse-readr] provides a fast and friendly way to read rectangular data (like csv, tsv, and fwf). It is designed to flexibly parse many types of data found in the wild, while still cleanly failing when data unexpectedly changes.  We are going to use dplyr in Module \@ref(mod-r-io).

* [purrr][tidyverse-purrr] enhances R’s functional programming (FP) toolkit by providing a complete and consistent set of tools for working with functions and vectors. Once you master the basic concepts, purrr allows you to replace many for loops with code that is easier to write and more expressive. This package is not covered in this course.

* [tibble][tidyverse-tibble] is a modern re-imagining of the data frame, keeping what time has proven to be effective, and throwing out what has not. Tibbles are data frames that are lazy and surly: they do less and complain more forcing you to confront problems earlier, typically leading to cleaner, more expressive code. We are going to use tibbles in Module \@ref(mod-r-transform).

* [stringr][tidyverse-stringr] provides a cohesive set of functions designed to make working with strings as easy as possible. You have already worked a bit with stringr in Exercise \@ref(ex-strings)

* [forcats][tidyverse-forcats] provides a suite of useful tools that solve common problems with factors. R uses factors to handle categorical variables, variables that have a fixed and known set of possible values. This package is not covered in this course.

Small introductions (with examples) to the packages are given on their documentation pages (follow the links above). The tidyverse also includes many [other packages][tidyverse-packages] with more specialized usage. They are not loaded automatically with `library(tidyverse)`, so you will need to load each one with its own call to `library()`.



## Writing reproducible reports {#r-markdown-intro}

The concept of [literate programming][wiki-literate-programming] was originally introduced by Donald Knuth in 1984. In a nutshell, Knuth envisioned a new programming paradigm where computer scientists focus on weaving code together with text as documentation. 

That is, when we do an Analytics project, we are interested in writing reports containing both R code for importing data, wrangling and analysis. Moreover, at the same time, the document should contain our comments about the code, plots, analysis, results, etc. The document is then rendered to an output format such as html, pdf or Word which is presented to the decision maker. Note the document can be seen as the "the source code" for the report communicated to the decision maker. 

Some developers have created tools to enable others to write better literate programs. They use a markup language made for authoring. We are going to focus on [RMarkdown][r-markdown]. In RMarkdown documents you can weave R code together with text (written in Markdown) to produce elegantly formatted output. 

In fact this book is written in RMarkdown by using

* a set of RMarkdown documents bound together as a collection using the [bookdown][pkg-bookdown] package,
* rendered to a web page using RStudio,
* shared on [GitHub],
* built by [GitHub Actions][github-actions],
* and published on [GitHub Pages][github-pages].

This may seem complicated at first. However, after setup, it makes life much easier, since we can

* update the book easier,
* share and collaborate on the book easier,
* update the web page automatically,
* keep history of the book source,
* keep the book source at a single location. 

RMarkdown documents are reproducible. Anybody who works with data has at some point heard a colleague say ‘Well, it works on my computer’, expressing dismay at the fact that you cannot reproduce their results. Ultimately, reproducible means that the results can be reproduced given access to the original data, software, and code. In practice it may be hard to make your project totally reproducible. For instance, people may be using a different operating system, other versions of the software, etc. That is, there are different levels of reproducibility. In this course, we will focus on RMarkdown only. See Module \@ref(mod-r-tidyverse-intro) for more info about levels of reproducibility.

An introduction to RMarkdown is given in Chapters [3][datacamp-r-communicating-chap3] and [4][datacamp-r-communicating-chap4] of the [DataCamp] course [Communicating with Data in the Tidyverse][datacamp-r-communicating]. Note that you may skip Chapters 1 and 2 and still understand most of the questions in Chapters 3 and 4 (otherwise just see the solution). You are expected to have completed the chapters before continuing this module! 

The RMarkdown cheatsheet may be useful. Find the newest version in RStudio **Help > Cheatsheets**. All chunk options for R code can be seen [here](https://yihui.org/knitr/options/).


## Tibbles {#r-tibbles-intro}

Tibbles are a modern data frame, keeping what time has proven to be effective, and throwing out what is not. Tibbles are more strict compared to data frames e.g. they do not change variable names or types, do not do partial matching and complain more e.g. when a variable does not exist. This forces you to confront problems earlier, typically leading to cleaner, more expressive code. Moreover, tibbles have an enhanced `print` method and can have columns that are lists.

Let us see a few examples:


```r
tbl1 <- tibble(name = c("Lars", "Susan", "Hans"), age = c(23, 56, 45))
tbl1
#> # A tibble: 3 × 2
#>   name    age
#>   <chr> <dbl>
#> 1 Lars     23
#> 2 Susan    56
#> 3 Hans     45
tbl2 <- tibble(x = 1:3, y = list(1:5, 1:10, 1:20))
tbl2
#> # A tibble: 3 × 2
#>       x y         
#>   <int> <list>    
#> 1     1 <int [5]> 
#> 2     2 <int [10]>
#> 3     3 <int [20]>
tbl3 <- as_tibble(mtcars)
tbl3
#> # A tibble: 33 × 12
#>      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb col  
#>    <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <chr>
#>  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4 <NA> 
#>  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4 green
#>  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1 blue 
#>  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1 red  
#>  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2 <NA> 
#>  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1 blue 
#>  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4 green
#>  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2 blue 
#>  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2 red  
#> 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4 red  
#> # … with 23 more rows
#> # ℹ Use `print(n = ...)` to see more rows
tbl4 <- tribble(
  ~x, ~y, ~z,
  #--|--|----
  "a", 2, 3.6,
  "b", 1, 8.5
)
tbl4
#> # A tibble: 2 × 3
#>   x         y     z
#>   <chr> <dbl> <dbl>
#> 1 a         2   3.6
#> 2 b         1   8.5
```

Note that we can always coerce a data frame to a tibble (`tbl3`) or create it directly using `tibble`. Another way to create a tibble is with `tribble`. Here column headings are defined by formulas (i.e. they start with ~), and entries are separated by commas. This makes it possible to lay out small amounts of data in easy to read form.

Tibbles have a refined print method that shows only the first 10 rows along with the number of columns that will fit on your screen. This makes it much easier to work with large data. In addition to its name, each column reports its type. Hence, your console is not overwhelmed with data. To see a full view of the data, you can use RStudio's built-in data viewer:


```r
View(tbl3)
```



## Recap {#rc-tidyverse-intro}

* [tidyverse][tidyverse-main-page] is a collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures.

* RMarkdown is an example of literate programming. 

* The [core tidyverse][tidyverse-core] includes the packages that you are likely to use in everyday data analyses. 

* The concept of [literate programming][wiki-literate-programming] is a programming paradigm which focuses on weaving code together with text as documentation. That is, we are interested in writing reports containing both text and R code for importing data, wrangling and analysis. 

* Reproducibility means that the results can be reproduced given access to the original data, software, and code.

* In practice it may be hard to make your project totally reproducible. That is, there are different levels of reproducibility. 

* RMarkdown documents are an attempt to make reproducible documents and combine R code and markdown text.

* All chunk options for R code in RMarkdown documents can be seen [here](https://yihui.org/knitr/options/).

* The RMarkdown cheatsheet may be useful. Find the newest version in RStudio **Help > Cheatsheets**. For Markdown syntax see **Help > Markdown Quick Reference**.

* Tibbles are a modern data frame, keeping what time has proven to be effective, and throwing out what is not. 

* Tibbles are more strict compared to data frames e.g. they do not change variable names or types, do not do partial matching and complain more e.g. when a variable does not exist. 

* Tibbles have an enhanced `print` method and can have columns that are lists.

You may also have a look at the [slides for this module](https://bss-osca.github.io/tfa/slides/07-01_r-tidyverse-intro-slides.html).


## Exercises {#ex-tidyverse-intro}

Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the [help page](#help). Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution!

[Link to the project on RStudio Cloud for this module][r-cloud-mod15]. 


### Exercise (your first RMarkdown exercise)

Load the tfa package:


```r
# remotes::install_github("bss-osca/tfa/tfa-package", upgrade = FALSE)  # run to upgrade
library(tfa)
```

The package contains templates for exercises etc. Go to **File > New File > R Markdown...**. In the pop-up box select **From template** in the left column and then **TFA Exercise**. Press *Ok* and a new RMarkdown document will be opened. 

1) Change the meta text (e.g. the title and add your name) in the yaml.

2) Render/compile the document by pressing the *Knit* button (or Ctrl+Shift+K).  


<div class="modal fade bs-example-modal-lg" id="fmlf7qcpA0KGpv7ubOfl" tabindex="-1" role="dialog" aria-labelledby="fmlf7qcpA0KGpv7ubOfl-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="fmlf7qcpA0KGpv7ubOfl-title">Solution</h4></div><div class="modal-body">

<p>All the code is now hidden. But not the output.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#fmlf7qcpA0KGpv7ubOfl">Solution</button>

3) Change `echo = TRUE` to `echo = FALSE` in the first chunk `setup` and render the document. What has happened? 

You can easily go to a chunk using the navigation in the bottom left of the source window. 

<img src="img/win_chunk_selection.png" width="50%" style="display: block; margin: auto;" />

4) Try to change `fig.asp = 0.25` to e.g. 0.5 in Chunk 10. What happens? 

5) Create a new section `## Question 4` and add text in italic: *What is the sum of all setup costs?*


<div class="modal fade bs-example-modal-lg" id="WOx39hj6SdOzgJ9I51Jk" tabindex="-1" role="dialog" aria-labelledby="WOx39hj6SdOzgJ9I51Jk-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="WOx39hj6SdOzgJ9I51Jk-title">Solution</h4></div><div class="modal-body">

```r
total <- sum(setup_costs)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#WOx39hj6SdOzgJ9I51Jk">Solution</button>

6) Add a code chunk solving Question 5 above.


<div class="modal fade bs-example-modal-lg" id="xPW4dLQxgiACspiHDUWD" tabindex="-1" role="dialog" aria-labelledby="xPW4dLQxgiACspiHDUWD-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="xPW4dLQxgiACspiHDUWD-title">Solution</h4></div><div class="modal-body">

<p>The sum of all setup costs are &#768;r total &#768;.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#xPW4dLQxgiACspiHDUWD">Solution</button>

7) Add a line of text with the result.


### Exercise (tibbles)

Solve this exercise using an R script file.


<div class="modal fade bs-example-modal-lg" id="l1iqvfGDr1qWQvAN89fY" tabindex="-1" role="dialog" aria-labelledby="l1iqvfGDr1qWQvAN89fY-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="l1iqvfGDr1qWQvAN89fY-title">Solution</h4></div><div class="modal-body">

```r
airquality %>% as_tibble()
#> # A tibble: 153 × 6
#>    Ozone Solar.R  Wind  Temp Month   Day
#>    <int>   <int> <dbl> <int> <int> <int>
#>  1    41     190   7.4    67     5     1
#>  2    36     118   8      72     5     2
#>  3    12     149  12.6    74     5     3
#>  4    18     313  11.5    62     5     4
#>  5    NA      NA  14.3    56     5     5
#>  6    28      NA  14.9    66     5     6
#>  7    23     299   8.6    65     5     7
#>  8    19      99  13.8    59     5     8
#>  9     8      19  20.1    61     5     9
#> 10    NA     194   8.6    69     5    10
#> # … with 143 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#l1iqvfGDr1qWQvAN89fY">Solution</button>
   1) Convert the dataset `airquality` to a tibble.
   

<div class="modal fade bs-example-modal-lg" id="ToxVhBM396HOdhKxh9MI" tabindex="-1" role="dialog" aria-labelledby="ToxVhBM396HOdhKxh9MI-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="ToxVhBM396HOdhKxh9MI-title">Solution</h4></div><div class="modal-body">

```r
airquality %>% as_tibble()
#> # A tibble: 153 × 6
#>    Ozone Solar.R  Wind  Temp Month   Day
#>    <int>   <int> <dbl> <int> <int> <int>
#>  1    41     190   7.4    67     5     1
#>  2    36     118   8      72     5     2
#>  3    12     149  12.6    74     5     3
#>  4    18     313  11.5    62     5     4
#>  5    NA      NA  14.3    56     5     5
#>  6    28      NA  14.9    66     5     6
#>  7    23     299   8.6    65     5     7
#>  8    19      99  13.8    59     5     8
#>  9     8      19  20.1    61     5     9
#> 10    NA     194   8.6    69     5    10
#> # … with 143 more rows
#> # ℹ Use `print(n = ...)` to see more rows
airquality
#>     Ozone Solar.R Wind Temp Month Day
#> 1      41     190  7.4   67     5   1
#> 2      36     118  8.0   72     5   2
#> 3      12     149 12.6   74     5   3
#> 4      18     313 11.5   62     5   4
#> 5      NA      NA 14.3   56     5   5
#> 6      28      NA 14.9   66     5   6
#> 7      23     299  8.6   65     5   7
#> 8      19      99 13.8   59     5   8
#> 9       8      19 20.1   61     5   9
#> 10     NA     194  8.6   69     5  10
#> 11      7      NA  6.9   74     5  11
#> 12     16     256  9.7   69     5  12
#> 13     11     290  9.2   66     5  13
#> 14     14     274 10.9   68     5  14
#> 15     18      65 13.2   58     5  15
#> 16     14     334 11.5   64     5  16
#> 17     34     307 12.0   66     5  17
#> 18      6      78 18.4   57     5  18
#> 19     30     322 11.5   68     5  19
#> 20     11      44  9.7   62     5  20
#> 21      1       8  9.7   59     5  21
#> 22     11     320 16.6   73     5  22
#> 23      4      25  9.7   61     5  23
#> 24     32      92 12.0   61     5  24
#> 25     NA      66 16.6   57     5  25
#> 26     NA     266 14.9   58     5  26
#> 27     NA      NA  8.0   57     5  27
#> 28     23      13 12.0   67     5  28
#> 29     45     252 14.9   81     5  29
#> 30    115     223  5.7   79     5  30
#> 31     37     279  7.4   76     5  31
#> 32     NA     286  8.6   78     6   1
#> 33     NA     287  9.7   74     6   2
#> 34     NA     242 16.1   67     6   3
#> 35     NA     186  9.2   84     6   4
#> 36     NA     220  8.6   85     6   5
#> 37     NA     264 14.3   79     6   6
#> 38     29     127  9.7   82     6   7
#> 39     NA     273  6.9   87     6   8
#> 40     71     291 13.8   90     6   9
#> 41     39     323 11.5   87     6  10
#> 42     NA     259 10.9   93     6  11
#> 43     NA     250  9.2   92     6  12
#> 44     23     148  8.0   82     6  13
#> 45     NA     332 13.8   80     6  14
#> 46     NA     322 11.5   79     6  15
#> 47     21     191 14.9   77     6  16
#> 48     37     284 20.7   72     6  17
#> 49     20      37  9.2   65     6  18
#> 50     12     120 11.5   73     6  19
#> 51     13     137 10.3   76     6  20
#> 52     NA     150  6.3   77     6  21
#> 53     NA      59  1.7   76     6  22
#> 54     NA      91  4.6   76     6  23
#> 55     NA     250  6.3   76     6  24
#> 56     NA     135  8.0   75     6  25
#> 57     NA     127  8.0   78     6  26
#> 58     NA      47 10.3   73     6  27
#> 59     NA      98 11.5   80     6  28
#> 60     NA      31 14.9   77     6  29
#> 61     NA     138  8.0   83     6  30
#> 62    135     269  4.1   84     7   1
#> 63     49     248  9.2   85     7   2
#> 64     32     236  9.2   81     7   3
#> 65     NA     101 10.9   84     7   4
#> 66     64     175  4.6   83     7   5
#> 67     40     314 10.9   83     7   6
#> 68     77     276  5.1   88     7   7
#> 69     97     267  6.3   92     7   8
#> 70     97     272  5.7   92     7   9
#> 71     85     175  7.4   89     7  10
#> 72     NA     139  8.6   82     7  11
#> 73     10     264 14.3   73     7  12
#> 74     27     175 14.9   81     7  13
#> 75     NA     291 14.9   91     7  14
#> 76      7      48 14.3   80     7  15
#> 77     48     260  6.9   81     7  16
#> 78     35     274 10.3   82     7  17
#> 79     61     285  6.3   84     7  18
#> 80     79     187  5.1   87     7  19
#> 81     63     220 11.5   85     7  20
#> 82     16       7  6.9   74     7  21
#> 83     NA     258  9.7   81     7  22
#> 84     NA     295 11.5   82     7  23
#> 85     80     294  8.6   86     7  24
#> 86    108     223  8.0   85     7  25
#> 87     20      81  8.6   82     7  26
#> 88     52      82 12.0   86     7  27
#> 89     82     213  7.4   88     7  28
#> 90     50     275  7.4   86     7  29
#> 91     64     253  7.4   83     7  30
#> 92     59     254  9.2   81     7  31
#> 93     39      83  6.9   81     8   1
#> 94      9      24 13.8   81     8   2
#> 95     16      77  7.4   82     8   3
#> 96     78      NA  6.9   86     8   4
#> 97     35      NA  7.4   85     8   5
#> 98     66      NA  4.6   87     8   6
#> 99    122     255  4.0   89     8   7
#> 100    89     229 10.3   90     8   8
#> 101   110     207  8.0   90     8   9
#> 102    NA     222  8.6   92     8  10
#> 103    NA     137 11.5   86     8  11
#> 104    44     192 11.5   86     8  12
#> 105    28     273 11.5   82     8  13
#> 106    65     157  9.7   80     8  14
#> 107    NA      64 11.5   79     8  15
#> 108    22      71 10.3   77     8  16
#> 109    59      51  6.3   79     8  17
#> 110    23     115  7.4   76     8  18
#> 111    31     244 10.9   78     8  19
#> 112    44     190 10.3   78     8  20
#> 113    21     259 15.5   77     8  21
#> 114     9      36 14.3   72     8  22
#> 115    NA     255 12.6   75     8  23
#> 116    45     212  9.7   79     8  24
#> 117   168     238  3.4   81     8  25
#> 118    73     215  8.0   86     8  26
#> 119    NA     153  5.7   88     8  27
#> 120    76     203  9.7   97     8  28
#> 121   118     225  2.3   94     8  29
#> 122    84     237  6.3   96     8  30
#> 123    85     188  6.3   94     8  31
#> 124    96     167  6.9   91     9   1
#> 125    78     197  5.1   92     9   2
#> 126    73     183  2.8   93     9   3
#> 127    91     189  4.6   93     9   4
#> 128    47      95  7.4   87     9   5
#> 129    32      92 15.5   84     9   6
#> 130    20     252 10.9   80     9   7
#> 131    23     220 10.3   78     9   8
#> 132    21     230 10.9   75     9   9
#> 133    24     259  9.7   73     9  10
#> 134    44     236 14.9   81     9  11
#> 135    21     259 15.5   76     9  12
#> 136    28     238  6.3   77     9  13
#> 137     9      24 10.9   71     9  14
#> 138    13     112 11.5   71     9  15
#> 139    46     237  6.9   78     9  16
#> 140    18     224 13.8   67     9  17
#> 141    13      27 10.3   76     9  18
#> 142    24     238 10.3   68     9  19
#> 143    16     201  8.0   82     9  20
#> 144    13     238 12.6   64     9  21
#> 145    23      14  9.2   71     9  22
#> 146    36     139 10.3   81     9  23
#> 147     7      49 10.3   69     9  24
#> 148    14      20 16.6   63     9  25
#> 149    30     193  6.9   70     9  26
#> 150    NA     145 13.2   77     9  27
#> 151    14     191 14.3   75     9  28
#> 152    18     131  8.0   76     9  29
#> 153    20     223 11.5   68     9  30
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ToxVhBM396HOdhKxh9MI">Solution</button>
   2) Print the tibble and the original data frame and compare the difference.
   

<div class="modal fade bs-example-modal-lg" id="SpEOy7dhaz2zkR9RBQo3" tabindex="-1" role="dialog" aria-labelledby="SpEOy7dhaz2zkR9RBQo3-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="SpEOy7dhaz2zkR9RBQo3-title">Solution</h4></div><div class="modal-body">

```r
# here misc is a list with lists
dat <- tibble(name = c("Hans", "Ole"), 
              age = c(23, 45), 
              misc = list(
                 list(status = 1, comment = "To young"), 
                 list(comment = "Potential candidate")))
dat
#> # A tibble: 2 × 3
#>   name    age misc            
#>   <chr> <dbl> <list>          
#> 1 Hans     23 <named list [2]>
#> 2 Ole      45 <named list [1]>
dat$misc[[1]]
#> $status
#> [1] 1
#> 
#> $comment
#> [1] "To young"
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#SpEOy7dhaz2zkR9RBQo3">Solution</button>
   3) Create a tibble with 3 columns of data type string/character, double and list. 


<!--chapter:end:11_r-tidyverse-intro.Rmd-->

---
output: html_document
editor_options: 
  chunk_output_type: console
---



[BSS]: https://bss.au.dk/en/

[course-help]: https://github.com/bss-osca/tfa/issues
[cran]: https://cloud.r-project.org
[cheatsheet-readr]: https://rawgit.com/rstudio/cheatsheets/master/data-import.pdf
[course-welcome-to-the-tidyverse]: https://github.com/rstudio-education/welcome-to-the-tidyverse

[DataCamp]: https://www.datacamp.com/
[datacamp-signup]: https://www.datacamp.com/groups/shared_links/cbaee6c73e7d78549a9e32a900793b2d5491ace1824efc1760a6729735948215
[datacamp-r-intro]: https://learn.datacamp.com/courses/free-introduction-to-r
[datacamp-r-rmarkdown]: https://campus.datacamp.com/courses/reporting-with-rmarkdown
[datacamp-r-communicating]: https://learn.datacamp.com/courses/communicating-with-data-in-the-tidyverse
[datacamp-r-communicating-chap3]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/introduction-to-rmarkdown
[datacamp-r-communicating-chap4]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/customizing-your-rmarkdown-report
[datacamp-r-intermediate]: https://learn.datacamp.com/courses/intermediate-r
[datacamp-r-intermediate-chap1]: https://campus.datacamp.com/courses/intermediate-r/chapter-1-conditionals-and-control-flow
[datacamp-r-intermediate-chap2]: https://campus.datacamp.com/courses/intermediate-r/chapter-2-loops
[datacamp-r-intermediate-chap3]: https://campus.datacamp.com/courses/intermediate-r/chapter-3-functions
[datacamp-r-intermediate-chap4]: https://campus.datacamp.com/courses/intermediate-r/chapter-4-the-apply-family
[datacamp-r-functions]: https://learn.datacamp.com/courses/introduction-to-writing-functions-in-r
[datacamp-r-tidyverse]: https://learn.datacamp.com/courses/introduction-to-the-tidyverse
[datacamp-r-strings]: https://learn.datacamp.com/courses/string-manipulation-with-stringr-in-r
[datacamp-r-dplyr]: https://learn.datacamp.com/courses/data-manipulation-with-dplyr
[datacamp-r-dplyr-bakeoff]: https://learn.datacamp.com/courses/working-with-data-in-the-tidyverse
[datacamp-r-ggplot2-intro]: https://learn.datacamp.com/courses/introduction-to-data-visualization-with-ggplot2
[datacamp-r-ggplot2-intermediate]: https://learn.datacamp.com/courses/intermediate-data-visualization-with-ggplot2
[dplyr-cran]: https://CRAN.R-project.org/package=dplyr
[debug-in-r]: https://rstats.wtf/debugging-r-code.html

[excel-vs-r]: https://www.jessesadler.com/post/excel-vs-r/

[google-form]: https://forms.gle/s39GeDGV9AzAXUo18
[google-grupper]: https://docs.google.com/spreadsheets/d/1DHxthd5AQywAU4Crb3hM9rnog2GqGQYZ2o175SQgn_0/edit?usp=sharing
[GitHub]: https://github.com/
[git-install]: https://git-scm.com/downloads
[github-actions]: https://github.com/features/actions
[github-pages]: https://pages.github.com/

[happy-git]: https://happygitwithr.com
[hg-install-git]: https://happygitwithr.com/install-git.html
[hg-why]: https://happygitwithr.com/big-picture.html#big-picture
[hg-github-reg]: https://happygitwithr.com/github-acct.html#github-acct
[hg-git-install]: https://happygitwithr.com/install-git.html#install-git
[hg-exist-github-first]: https://happygitwithr.com/existing-github-first.html
[hg-exist-github-last]: https://happygitwithr.com/existing-github-last.html
[hg-credential-helper]: https://happygitwithr.com/credential-caching.html
[hypothes.is]: https://web.hypothes.is/

[osca-programme]: https://kandidat.au.dk/en/operationsandsupplychainanalytics/

[Peergrade]: https://peergrade.io
[peergrade-signup]: https://app.peergrade.io/join
[point-and-click]: https://en.wikipedia.org/wiki/Point_and_click
[pkg-bookdown]: https://bookdown.org/yihui/bookdown/
[pkg-openxlsx]: https://ycphs.github.io/openxlsx/index.html
[pkg-ropensci-writexl]: https://docs.ropensci.org/writexl/
[pkg-jsonlite]: https://cran.r-project.org/web/packages/jsonlite/index.html

[R]: https://www.r-project.org
[RStudio]: https://rstudio.com
[rstudio-cloud]: https://rstudio.cloud/spaces/176810/join?access_code=LSGnG2EXTuzSyeYaNXJE77vP33DZUoeMbC0xhfCz
[r-cloud-mod12]: https://rstudio.cloud/spaces/176810/project/2963819
[r-cloud-mod13]: https://rstudio.cloud/spaces/176810/project/3020139
[r-cloud-mod14]: https://rstudio.cloud/spaces/176810/project/3020322
[r-cloud-mod15]: https://rstudio.cloud/spaces/176810/project/3020509
[r-cloud-mod16]: https://rstudio.cloud/spaces/176810/project/3026754
[r-cloud-mod17]: https://rstudio.cloud/spaces/176810/project/3034015
[r-cloud-mod18]: https://rstudio.cloud/spaces/176810/project/3130795
[r-cloud-mod19]: https://rstudio.cloud/spaces/176810/project/3266132
[rstudio-download]: https://rstudio.com/products/rstudio/download/#download
[rstudio-customizing]: https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio
[rstudio-key-shortcuts]: https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts
[rstudio-workbench]: https://www.rstudio.com/wp-content/uploads/2014/04/rstudio-workbench.png
[r-markdown]: https://rmarkdown.rstudio.com/
[ropensci-writexl]: https://docs.ropensci.org/writexl/
[r4ds-pipes]: https://r4ds.had.co.nz/pipes.html
[r4ds-factors]: https://r4ds.had.co.nz/factors.html
[r4ds-strings]: https://r4ds.had.co.nz/strings.html
[r4ds-iteration]: https://r4ds.had.co.nz/iteration.html

[stat-545]: https://stat545.com
[stat-545-functions-part1]: https://stat545.com/functions-part1.html
[stat-545-functions-part2]: https://stat545.com/functions-part2.html
[stat-545-functions-part3]: https://stat545.com/functions-part3.html
[slides-welcome]: https://bss-osca.github.io/tfa/slides/00-tfa_welcome.html
[slides-m1-3]: https://bss-osca.github.io/tfa/slides/01-welcome_r_part.html
[slides-m4-5]: https://bss-osca.github.io/tfa/slides/02-programming.html
[slides-m6-8]: https://bss-osca.github.io/tfa/slides/03-transform.html
[slides-m9]: https://bss-osca.github.io/tfa/slides/04-plot.html
[slides-m83]: https://bss-osca.github.io/tfa/slides/05-joins.html

[tidyverse-main-page]: https://www.tidyverse.org
[tidyverse-packages]: https://www.tidyverse.org/packages/
[tidyverse-core]: https://www.tidyverse.org/packages/#core-tidyverse
[tidyverse-ggplot2]: https://ggplot2.tidyverse.org/
[tidyverse-dplyr]: https://dplyr.tidyverse.org/
[tidyverse-tidyr]: https://tidyr.tidyverse.org/
[tidyverse-readr]: https://readr.tidyverse.org/
[tidyverse-purrr]: https://purrr.tidyverse.org/
[tidyverse-tibble]: https://tibble.tidyverse.org/
[tidyverse-stringr]: https://stringr.tidyverse.org/
[tidyverse-forcats]: https://forcats.tidyverse.org/
[tidyverse-readxl]: https://readxl.tidyverse.org
[tidyverse-googlesheets4]: https://googlesheets4.tidyverse.org/index.html
[tutorial-markdown]: https://commonmark.org/help/tutorial/

[Udemy]: https://www.udemy.com/

[vba-yt-course1]: https://www.youtube.com/playlist?list=PLpOAvcoMay5S_hb2D7iKznLqJ8QG_pde0
[vba-course1-hello]: https://youtu.be/f42OniDWaIo

[vba-yt-course2]: https://www.youtube.com/playlist?list=PL3A6U40JUYCi4njVx59-vaUxYkG0yRO4m
[vba-course2-devel-tab]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-editor]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-project]: https://youtu.be/fp6PTbU7bXo
[vba-course2-devel-properties]: https://youtu.be/ks2QYKAd9Xw
[vba-course2-devel-hello]: https://youtu.be/EQ6tDWBc8G4

[video-install]: https://vimeo.com/415501284
[video-rstudio-intro]: https://vimeo.com/416391353
[video-packages]: https://vimeo.com/416743698
[video-projects]: https://vimeo.com/319318233
[video-r-intro-p1]: https://www.youtube.com/watch?v=vGY5i_J2c-c
[video-r-intro-p2]: https://www.youtube.com/watch?v=w8_XdYI3reU
[video-r-intro-p3]: https://www.youtube.com/watch?v=NuY6jY4qE7I
[video-subsetting]: https://www.youtube.com/watch?v=hWbgqzsQJF0&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10&t=0s
[video-datatypes]: https://www.youtube.com/watch?v=5AQM-yUX9zg&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10
[video-control-structures]: https://www.youtube.com/watch?v=s_h9ruNwI_0
[video-conditional-loops]: https://www.youtube.com/watch?v=2evtsnPaoDg
[video-functions]: https://www.youtube.com/watch?v=ffPeac3BigM
[video-tibble-vs-df]: https://www.youtube.com/watch?v=EBk6PnvE1R4
[video-dplyr]: https://www.youtube.com/watch?v=aywFompr1F4

[wiki-snake-case]: https://en.wikipedia.org/wiki/Snake_case
[wiki-camel-case]: https://en.wikipedia.org/wiki/Camel_case
[wiki-interpreted]: https://en.wikipedia.org/wiki/Interpreted_language
[wiki-literate-programming]: https://en.wikipedia.org/wiki/Literate_programming
[wiki-csv]: https://en.wikipedia.org/wiki/Comma-separated_values
[wiki-json]: https://en.wikipedia.org/wiki/JSON

# Importing and exporting data {#mod-r-io}

For doing data driven analytics, you first must __import__ some data. That is, take data from a database, file, web API etc. and transform it into a data frame/table. Moreover, after processing data, you often want to export or store some of the results. This module introduces you to different ways of importing and exporting data. 

We are all different and you may like different learning styles compared to others. In the learning path diagram, there may be links to alternative online content. Note this is an alternative to the standard learning path that you may use instead. The learning path may also have extra content, that is not a part of syllabus, you can have a look at. 


```{=html}
<div id="htmlwidget-97aec2c89fff800238b5" style="width:1000px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-97aec2c89fff800238b5">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"📖 CSV files\", URL = \"#r-io-csv\", tooltip = \"CSV files\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"0,2!\"] \n  \"2\" [label = \"📖 Excel\", URL = \"#r-io-excel\", tooltip = \"Excel\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"2,2!\"] \n  \"3\" [label = \"📖 Google\\nsheets\", URL = \"#r-io-google\", tooltip = \"Google\\nsheets\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"4,2!\"] \n  \"4\" [label = \"📖 Text\\nfiles\", URL = \"#r-io-text\", tooltip = \"Text\\nfiles\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"6,2!\"] \n  \"5\" [label = \"📖 R\", URL = \"#r-io-r\", tooltip = \"Rs native binary format\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"7.5,2!\"] \n  \"6\" [label = \"📖 Json\", URL = \"#r-io-json\", tooltip = \"Json\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"9,2!\"] \n  \"7\" [label = \"💻 Exercises\", URL = \"#ex-r-io\", tooltip = \"Exercises\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"11,2!\"] \n  \"8\" [label = \"📖 Importing\\ndata\", URL = \"https://rafalab.github.io/dsbook/importing-data.html\", tooltip = \"Chapter 5 in Irizarry (2020) gives an alternative introduction to importing data.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"4,0!\"] \n  \"9\" [label = \"\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"0.5\", fontname = \"Helvetica\", shape = \"rect\", height = \"1\", width = \"6\", fillcolor = \"#F0F8FF\", pos = \"2.4,3.66!\"] \n  \"10\" [label = \"Color:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"0.8\", fillcolor = \"#FFFFFE\", pos = \"-0.23,4!\"] \n  \"11\" [label = \"mandatory\", URL = \"\", tooltip = \"Mandatory syllabus.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkSeaGreen4\", pos = \"0,3.6!\"] \n  \"12\" [label = \"alternative\", URL = \"\", tooltip = \"Alternative syllabus if you prefer another learning style.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkOrange4\", pos = \"1,3.6!\"] \n  \"13\" [label = \"extra\", URL = \"\", tooltip = \"Extra learning if you are interested (not part of syllabus).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"PeachPuff3\", pos = \"2,3.6!\"] \n  \"14\" [label = \"Shape:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"1\", fillcolor = \"#FFFFFE\", pos = \"3.2,4!\"] \n  \"15\" [label = \"non-interactive\", URL = \"\", tooltip = \"Non-interactive learning content (e.g. reading).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"1\", fillcolor = \"Grey40\", pos = \"3.5,3.6!\"] \n  \"16\" [label = \"interactive\", URL = \"\", tooltip = \"Interactive learning content (tutorial, exercises etc.).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"egg\", width = \"1\", fillcolor = \"Grey40\", pos = \"4.75,3.6!\"] \n\"1\"->\"2\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"8\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"3\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"8\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"4\" [color = \"black\", arrowhead = \"vee\"] \n\"4\"->\"5\" [color = \"black\", arrowhead = \"vee\"] \n\"4\"->\"8\" [color = \"black\", arrowhead = \"vee\"] \n\"5\"->\"6\" [color = \"black\", arrowhead = \"vee\"] \n\"6\"->\"7\" [color = \"black\", arrowhead = \"vee\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
```

<!-- * [Chapter 5](https://rafalab.github.io/dsbook/importing-data.html) in @dsbook gives an alternative introduction to importing data. -->


## Learning outcomes {#lo-r-io}

By the end of this module, you are expected to be able to:

* Import and export csv files in different formats.
* Import and export data from Excel.
* Import and export data from Google Sheets.
* Write to a text file.
* Save data using R's native format.
* Read and write to a json file.

The learning outcomes relate to the [overall learning goals](#lg-course) number 7 and 13 of the course.

<!-- SOLO increasing: identify · memorize · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->


## CSV files {#r-io-csv}

[CSV files][wiki-csv] contain *comma separated values* (csv) in plain text and are often named using the file suffix `.csv`. Each line of the file is a data record. Each record consists of one or more fields, separated by a common delimiter (e.g. `,`, `;` or `_`). The CSV file format is not fully standardized. Different delimiters may be used, fields may be surrounded by quotation marks, text may contain escape characters and the encoding of the file may not be known. Despite these problems, CSV files are commonly used since they are easy to exchange and read.

We will use the [readr][tidyverse-readr] package for reading and writing. An overview over the functions can be seen in the [cheatsheet][cheatsheet-readr].


### Reading a CSV file

In general use the following functions

   * `read_csv`: Read a file with delimiter `,`.
   * `read_csv2`: Read a file with delimiter `;`.
   * `read_delim`: Read a file with a delimiter set by you.

#### Reading an unknown CSV file

For importing a CSV file properly, you need to know the delimiter, if the files has headers and the encoding. If you are not sure, you may have a look on the file by opening it in a text editor or try to read some lines:  


```r
csv_file <- readr_example("mtcars.csv") # csv file
lines <- read_lines(csv_file, n_max = 3)
lines
#> [1] "\"mpg\",\"cyl\",\"disp\",\"hp\",\"drat\",\"wt\",\"qsec\",\"vs\",\"am\",\"gear\",\"carb\""
#> [2] "21,6,160,110,3.9,2.62,16.46,0,1,4,4"                                                     
#> [3] "21,6,160,110,3.9,2.875,17.02,0,1,4,4"
cat(lines, sep = "\n")
#> "mpg","cyl","disp","hp","drat","wt","qsec","vs","am","gear","carb"
#> 21,6,160,110,3.9,2.62,16.46,0,1,4,4
#> 21,6,160,110,3.9,2.875,17.02,0,1,4,4
```
It seems that the delimiter is a `,` and we may try to read the file using `read_csv`:


```r
dat <- read_csv(csv_file)
head(dat)
#> # A tibble: 6 × 11
#>     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
#>   <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
#> 1  21       6   160   110  3.9   2.62  16.5     0     1     4     4
#> 2  21       6   160   110  3.9   2.88  17.0     0     1     4     4
#> 3  22.8     4   108    93  3.85  2.32  18.6     1     1     4     1
#> 4  21.4     6   258   110  3.08  3.22  19.4     1     0     3     1
#> 5  18.7     8   360   175  3.15  3.44  17.0     0     0     3     2
#> 6  18.1     6   225   105  2.76  3.46  20.2     1     0     3     1
```

CSV files should always be saved using encoding UTF-8. However, sometimes you may have encoding problems when you read a file:


```r
csv_file <- system.file("extdata/persons.csv", package = "tfa")
read_csv(csv_file)
#> # A tibble: 3 × 2
#>   first    last        
#>   <chr>    <chr>       
#> 1 "Hans"   "S\xf8gaard"
#> 2 "\xc5ge" "\xd8kse"   
#> 3 "Yvette" "L\xe6ske"
```

Note that some of the characters are not converted correctly. This is usually because the file encoding is not UTF-8. In this case, try to guess the encoding using:


```r
guess_encoding(csv_file)
#> # A tibble: 1 × 2
#>   encoding   confidence
#>   <chr>           <dbl>
#> 1 ISO-8859-1       0.27
dat <- read_csv(csv_file, locale = locale(encoding = "ISO-8859-1"))
dat
#> # A tibble: 3 × 2
#>   first  last   
#>   <chr>  <chr>  
#> 1 Hans   Søgaard
#> 2 Åge    Økse   
#> 3 Yvette Læske
```


### Writing to CSV files

Given a tibble/data frame export it using `write_csv`:


```r
csv_file <- "testing.csv"
write_csv(dat, file = csv_file) 
write_csv2(dat, file = "testing_semicolon.csv")   # use a semicolon as delimitor
```

You can now always import the data again using `read_csv`:


```r
read_csv(csv_file)
#> # A tibble: 3 × 2
#>   first  last   
#>   <chr>  <chr>  
#> 1 Hans   Søgaard
#> 2 Åge    Økse   
#> 3 Yvette Læske
guess_encoding(csv_file)
#> # A tibble: 3 × 2
#>   encoding     confidence
#>   <chr>             <dbl>
#> 1 UTF-8              1   
#> 2 windows-1252       0.31
#> 3 windows-1250       0.25
```
Note that `write_csv` always saves the file using encoding UTF-8. 

In a few cases, you may need to save a CSV file that can be read by Excel. For this purpose use:


```r
write_excel_csv2(dat, csv_file)
```

The CSV file can now be opened correctly in Excel. 




## Excel {#r-io-excel}

There are different packages in R for reading and writing to Excel. We will use the [readxl][tidyverse-readxl] package for reading Excel files which is a part of tidyverse. The package supports both the legacy `.xls` format and the modern xml-based `.xlsx` format. Let us use one of the example files provided by the package:


```r
xlsx_file <- system.file("extdata/datasets.xlsx", package = "readxl")
```

It is always a good idea to have a look at the file before you import from it. You can open it from R by using: 


```r
browseURL(xlsx_file)
```

Data can be read using:


```r
library(readxl)
xlsx <- read_excel(xlsx_file)   # reads the first sheet
xlsx
#> # A tibble: 150 × 5
#>    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
#>           <dbl>       <dbl>        <dbl>       <dbl> <chr>  
#>  1          5.1         3.5          1.4         0.2 setosa 
#>  2          4.9         3            1.4         0.2 setosa 
#>  3          4.7         3.2          1.3         0.2 setosa 
#>  4          4.6         3.1          1.5         0.2 setosa 
#>  5          5           3.6          1.4         0.2 setosa 
#>  6          5.4         3.9          1.7         0.4 setosa 
#>  7          4.6         3.4          1.4         0.3 setosa 
#>  8          5           3.4          1.5         0.2 setosa 
#>  9          4.4         2.9          1.4         0.2 setosa 
#> 10          4.9         3.1          1.5         0.1 setosa 
#> # … with 140 more rows
#> # ℹ Use `print(n = ...)` to see more rows
xlsx <- read_excel(xlsx_file, sheet = 2)   # reads the second sheet
xlsx
#> # A tibble: 32 × 11
#>      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
#>    <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
#>  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4
#>  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4
#>  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
#>  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
#>  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
#>  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
#>  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
#>  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
#>  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
#> 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
#> # … with 22 more rows
#> # ℹ Use `print(n = ...)` to see more rows
xlsx <- read_excel(xlsx_file, sheet = "quakes")   # reads a named sheet
xlsx
#> # A tibble: 1,000 × 5
#>      lat  long depth   mag stations
#>    <dbl> <dbl> <dbl> <dbl>    <dbl>
#>  1 -20.4  182.   562   4.8       41
#>  2 -20.6  181.   650   4.2       15
#>  3 -26    184.    42   5.4       43
#>  4 -18.0  182.   626   4.1       19
#>  5 -20.4  182.   649   4         11
#>  6 -19.7  184.   195   4         12
#>  7 -11.7  166.    82   4.8       43
#>  8 -28.1  182.   194   4.4       15
#>  9 -28.7  182.   211   4.7       35
#> 10 -17.5  180.   622   4.3       19
#> # … with 990 more rows
#> # ℹ Use `print(n = ...)` to see more rows
xlsx <- read_excel(xlsx_file, sheet = "mtcars", range = "A5:G11", col_names = F)   # reads a range
colnames(xlsx) <- read_excel(xlsx_file, sheet = "mtcars", range = "A1:G1", col_names = F)   # reads the column names
xlsx
#> # A tibble: 7 × 7
#>     mpg   cyl  disp    hp  drat    wt  qsec
#>   <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
#> 1  21.4     6  258    110  3.08  3.22  19.4
#> 2  18.7     8  360    175  3.15  3.44  17.0
#> 3  18.1     6  225    105  2.76  3.46  20.2
#> 4  14.3     8  360    245  3.21  3.57  15.8
#> 5  24.4     4  147.    62  3.69  3.19  20  
#> 6  22.8     4  141.    95  3.92  3.15  22.9
#> 7  19.2     6  168.   123  3.92  3.44  18.3
```

Writing to an Excel file can be done using the [openxlsx][pkg-openxlsx] package. To write to a new file use:


```r
library(openxlsx)
dat <- trees   # test dataset
head(dat)
#>   Girth Height Volume
#> 1   8.3     70   10.3
#> 2   8.6     65   10.3
#> 3   8.8     63   10.2
#> 4  10.5     72   16.4
#> 5  10.7     81   18.8
#> 6  10.8     83   19.7
write.xlsx(dat, "test1.xlsx", sheetName = "trees") # start at cell A1
write.xlsx(dat, "test2.xlsx", sheetName = "trees", startCol = "C", startRow = 3)
```

If you want to append a sheet to a file use:


```r
xlsx_file <- system.file("extdata/datasets.xlsx", package = "tfa")
file.copy(xlsx_file, "test.xlsx")         # copy the file so can make some tests
#> [1] TRUE
wb <- loadWorkbook(file = "test.xlsx")    # read the workbook
addWorksheet(wb = wb, sheetName = "trees")
writeData(wb, sheet = "trees", x = dat)
saveWorkbook(wb, file = "test.xlsx", overwrite = TRUE)
```




## Google Sheets {#r-io-google}

You can import and export to Google sheets using the [googlesheets4][tidyverse-googlesheets4] package in tidyverse. To read and write data, in general, you need to be logged in as a Google user. The package will ask you when needed. However, if you only want to read data from a public sheet, you can use `gs4_deauth` to skip this:


```r
library(googlesheets4)
gs4_deauth()
```

To read data use:


```r
url <- "https://docs.google.com/spreadsheets/d/1U6Cf_qEOhiR9AZqTqS3mbMF3zt2db48ZP5v3rkrAEJY/edit#gid=780868077"
read_sheet(url)
read_sheet(url, sheet = 3)
range_read(url, sheet = 2, n_max = 3)
range_read(url, range = "Africa!A5:C15")
```

To write data to a new file use:


```r
gs4_auth()
gs <- gs4_create("test", sheets = c("Sheet 1", "Sheet 2"))
write_sheet(dat, ss = gs)
range_write(gs, dat, sheet = "Sheet 1", range = "C4")
gs4_browse(gs)  # have a look at the file in a browser
```

To see the results, have a look at your Google sheet `test` in your browser.


## Text files {#r-io-text}

You can read and write to plain text files using the [readr][tidyverse-readr] package. However, mostly you want to write to a text file because you want to save some kind of log file when you run your script. Here `sink` is an excellent function to use, since it redirects your R output. To see the output without messages, errors and warnings use:


```r
sink(file = "ex1.log", split = TRUE)  # open the file for output
cat("This is a string\n... and on a new line\n\n")
print("This is another string")
head(mtcars)
rep(1, 4)
message("A message.")
warning("A warning.")
rep(3, f)  # a error
cat("\nLast line\n")
sink()  # close the file again
# file.show("ex1.log")   # to view in external viewer
```

Let us have a look at the content of the file (run `cat(read_file("ex1.log"))`):


```
This is a string
... and on a new line

[1] "This is another string"
                   mpg cyl disp  hp drat   wt qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.62 16.5  0  1    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.88 17.0  0  1    4    4
Datsun 710        22.8   4  108  93 3.85 2.32 18.6  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.21 19.4  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.44 17.0  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.46 20.2  1  0    3    1
[1] 1 1 1 1

Last line
```

Note that messages, errors and warnings are not included in the output. If you want to include it use:


```r
zz <- file("ex2.log", open = "wt")
sink(zz, type = "output")   # open the file for output
sink(zz, type = "message")  # open the same file for messages, errors and warnings
cat("This is a string\n... and on a new line\n\n")
print("This is another string")
head(mtcars)
rep(1, 4)
message("A message.")
warning("A warning.")
rep(3, f)  # a error
cat("\nLast line\n")
sink()  # close the file for output
sink()  # close the file for messages, errors and warnings
```

That is, we call sink two times. Let us have a look at the content of the file:


```
This is a string
... and on a new line

[1] "This is another string"
                   mpg cyl disp  hp drat   wt qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.62 16.5  0  1    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.88 17.0  0  1    4    4
Datsun 710        22.8   4  108  93 3.85 2.32 18.6  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.21 19.4  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.44 17.0  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.46 20.2  1  0    3    1
[1] 1 1 1 1
A message.
Warning message:
A warning. 
Error: object 'f' not found

Last line
Warning message:
In sink() : no sink to remove
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
Error: unexpected symbol in "By the"
Error: unexpected '*' in "*"
Error: unexpected '*' in "*"
Error: unexpected '*' in "*"
Error: unexpected '*' in "*"
Error: unexpected '*' in "*"
Error: unexpected symbol in "The learning"
Error: unexpected '<' in "<"
Error: unexpected '<' in "<"
Error: unexpected '<' in "<"
Error: unexpected '<' in "<"
Error: unexpected symbol in "An excellent"
Error: unexpected '<' in "<"
Error: unexpected '<' in "<"
Error: unexpected '<' in "<"
Error: unexpected '<' in "<"
Error: unexpected '<' in "<"
Error: unexpected symbol in "Mutating joins"
Error: attempt to use zero-length variable name
Error in curl::curl_fetch_memory(url, handle = handle) : 
  Error in the HTTP2 framing layer
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
x Request failed [429]. Retry 1 happens in 3.5 seconds ...
x Request failed [429]. Retry 2 happens in 3.5 seconds ...
x Request failed [429]. Retry 3 happens in 8.2 seconds ...

x Request failed [429]. Retry 1 happens in 2.5 seconds ...
x Request failed [429]. Retry 2 happens in 1.9 seconds ...
x Request failed [429]. Retry 3 happens in 26 seconds ...

x Request failed [429]. Retry 1 happens in 4.2 seconds ...
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
✓ Reading from "learning_paths".
✓ Range ''r-transform''.
```


## R's native binary format {#r-io-r}

In general, we can differ between two main types of data/files. Information is either binary encoded (basically just 0’s and 1’s) or stored as text files. What we have considered so far is storing data in text files. 

Text files can be read by humans and computers alike. The great thing about plain text is their simplicity and their ease of use: any programming language can read a plain text file. Text files are good for storing tabular data but lacks type-safety, and has limited precision for numeric values. Binary file formats cannot be read by humans but allow space-efficient data compression. Furthermore, binary formats may be difficult to read and write using other programs.

As most other programming languages, R comes with its own binary format. We will focus on the Rds data format which is optimized for speed and compression ratios. To save and read an R object use:


```r
dat <- list(x = c(2, 5, 6), y = "A string", z = mtcars)
saveRDS(dat, file = "test.rds")
readRDS("test.rds")
#> $x
#> [1] 2 5 6
#> 
#> $y
#> [1] "A string"
#> 
#> $z
#>                      mpg cyl  disp  hp drat   wt  qsec vs am gear carb   col
#> Mazda RX4           21.0   6 160.0 110 3.90 2.62  16.5  0  1    4    4  <NA>
#> Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.88  17.0  0  1    4    4 green
#> Datsun 710          22.8   4 108.0  93 3.85 2.32  18.6  1  1    4    1  blue
#> Hornet 4 Drive      21.4   6 258.0 110 3.08 3.21  19.4  1  0    3    1   red
#> Hornet Sportabout   18.7   8 360.0 175 3.15 3.44  17.0  0  0    3    2  <NA>
#> Valiant             18.1   6 225.0 105 2.76 3.46  20.2  1  0    3    1  blue
#> Duster 360          14.3   8 360.0 245 3.21 3.57  15.8  0  0    3    4 green
#> Merc 240D           24.4   4 146.7  62 3.69 3.19  20.0  1  0    4    2  blue
#> Merc 230            22.8   4 140.8  95 3.92 3.15  22.9  1  0    4    2   red
#> Merc 280            19.2   6 167.6 123 3.92 3.44  18.3  1  0    4    4   red
#> Merc 280C           17.8   6 167.6 123 3.92 3.44  18.9  1  0    4    4  blue
#> Merc 450SE          16.4   8 275.8 180 3.07 4.07  17.4  0  0    3    3 green
#> Merc 450SL          17.3   8 275.8 180 3.07 3.73  17.6  0  0    3    3  blue
#> Merc 450SLC         15.2   8 275.8 180 3.07 3.78  18.0  0  0    3    3  blue
#> Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.25  18.0  0  0    3    4 green
#> Lincoln Continental 10.4   8 460.0 215 3.00 5.42  17.8  0  0    3    4   red
#> Chrysler Imperial   14.7   8 440.0 230 3.23 5.34  17.4  0  0    3    4   red
#> Fiat 128            32.4   4  78.7  66 4.08 2.20  19.5  1  1    4    1  <NA>
#> Honda Civic         30.4   4  75.7  52 4.93 1.61  18.5  1  1    4    2  <NA>
#> Toyota Corolla      33.9   4  71.1  65 4.22 1.83  19.9  1  1    4    1   red
#> Toyota Corona       21.5   4 120.1  97 3.70 2.46  20.0  1  0    3    1 green
#> Dodge Challenger    15.5   8 318.0 150 2.76 3.52  16.9  0  0    3    2   red
#> AMC Javelin         15.2   8 304.0 150 3.15 3.44  17.3  0  0    3    2   red
#> Camaro Z28          13.3   8 350.0 245 3.73 3.84  15.4  0  0    3    4  <NA>
#> Pontiac Firebird    19.2   8 400.0 175 3.08 3.85  17.1  0  0    3    2 green
#> Fiat X1-9           27.3   4  79.0  66 4.08 1.94  18.9  1  1    4    1  <NA>
#> Porsche 914-2       26.0   4 120.3  91 4.43 2.14  16.7  0  1    5    2  blue
#> Lotus Europa        30.4   4  95.1 113 3.77 1.51  16.9  1  1    5    2 green
#> Ford Pantera L      15.8   8 351.0 264 4.22 3.17  14.5  0  1    5    4 green
#> Ferrari Dino        19.7   6 145.0 175 3.62 2.77  15.5  0  1    5    6   red
#> Maserati Bora       15.0   8 301.0 335 3.54 3.57  14.6  0  1    5    8 green
#> Volvo 142E          21.4   4 121.0 109 4.11 2.78  18.6  1  1    4    2  blue
#> Phantom XE          34.0   3  87.0 112 4.50 1.51 167.0  1  1    5    3  <NA>
```

Note we here have saved a non tabular R object (a list).




## Json {#r-io-json}

[JavaScript Object Notation][wiki-json] (json) is an open standard text file format, and data interchange format, that uses human-readable text to store and transmit data objects consisting of attribute–value pairs and array data types. It can be used to store non tabular data in text format. It is often used for data-exchange in web-apis. 

Let us try to read and write to a json file using the [jsonlite][pkg-jsonlite] package.


```r
library(jsonlite)
dat <- list(x = c(2, 5, 6), y = "A string", z = head(mtcars))
write_json(dat, "test.json", pretty = T)
lst <- read_json("test.json", simplifyDataFrame = T, simplifyVector = T)
lst
#> $x
#> [1] 2 5 6
#> 
#> $y
#> [1] "A string"
#> 
#> $z
#>                    mpg cyl disp  hp drat   wt qsec vs am gear carb   col
#> Mazda RX4         21.0   6  160 110 3.90 2.62 16.5  0  1    4    4  <NA>
#> Mazda RX4 Wag     21.0   6  160 110 3.90 2.88 17.0  0  1    4    4 green
#> Datsun 710        22.8   4  108  93 3.85 2.32 18.6  1  1    4    1  blue
#> Hornet 4 Drive    21.4   6  258 110 3.08 3.21 19.4  1  0    3    1   red
#> Hornet Sportabout 18.7   8  360 175 3.15 3.44 17.0  0  0    3    2  <NA>
#> Valiant           18.1   6  225 105 2.76 3.46 20.2  1  0    3    1  blue
```

The content of the json file look likes:


```
{
  "x": [2, 5, 6],
  "y": ["A string"],
  "z": [
    {
      "mpg": 21,
      "cyl": 6,
      "disp": 160,
      "hp": 110,
      "drat": 3.9,
      "wt": 2.62,
      "qsec": 16.46,
      "vs": 0,
      "am": 1,
      "gear": 4,
      "carb": 4,
      "_row": "Mazda RX4"
    },
    {
      "mpg": 21,
      "cyl": 6,
      "disp": 160,
      "hp": 110,
      "drat": 3.9,
      "wt": 2.875,
      "qsec": 17.02,
      "vs": 0,
      "am": 1,
      "gear": 4,
      "carb": 4,
      "col": "green",
      "_row": "Mazda RX4 Wag"
    },
    {
      "mpg": 22.8,
      "cyl": 4,
      "disp": 108,
      "hp": 93,
      "drat": 3.85,
      "wt": 2.32,
      "qsec": 18.61,
      "vs": 1,
      "am": 1,
      "gear": 4,
      "carb": 1,
      "col": "blue",
      "_row": "Datsun 710"
    },
    {
      "mpg": 21.4,
      "cyl": 6,
      "disp": 258,
      "hp": 110,
      "drat": 3.08,
      "wt": 3.215,
      "qsec": 19.44,
      "vs": 1,
      "am": 0,
      "gear": 3,
      "carb": 1,
      "col": "red",
      "_row": "Hornet 4 Drive"
    },
    {
      "mpg": 18.7,
      "cyl": 8,
      "disp": 360,
      "hp": 175,
      "drat": 3.15,
      "wt": 3.44,
      "qsec": 17.02,
      "vs": 0,
      "am": 0,
      "gear": 3,
      "carb": 2,
      "_row": "Hornet Sportabout"
    },
    {
      "mpg": 18.1,
      "cyl": 6,
      "disp": 225,
      "hp": 105,
      "drat": 2.76,
      "wt": 3.46,
      "qsec": 20.22,
      "vs": 1,
      "am": 0,
      "gear": 3,
      "carb": 1,
      "col": "blue",
      "_row": "Valiant"
    }
  ]
}
```




## Recap {#rc-r-io}

* For doing data driven analytics you first must import some data. That is, take data from a database, file, web API etc. and transform it into a data frame/table. 

* CSV files contain delimiter separated values in plain text and are often named using the file suffix `.csv`. 

* Each line of a csv file is a data record. Each record consists of one or more fields, separated by a common delimiter (e.g. `,`, `;` or `_`). 

* The [readxl][tidyverse-readxl] package can be used to read Excel files. 

* Writing to an Excel file can be done using the [openxlsx][pkg-openxlsx] package. 

* You can import and export to Google sheets using the [googlesheets4][tidyverse-googlesheets4] package in tidyverse. 

* Use `sink` to save output of you R script.

* There are two main types of data files. Information is either binary encoded or stored as text files. 

* Text files can be read by humans and computers alike. The great thing about plain text is their simplicity and their ease of use: any programming language can read a plain text file. 

* Text files are good for storing tabular data but lacks type-safety, and has limited precision for numeric values. 

* Binary file formats cannot be read by humans but allow space-efficient data compression. Moreover they can be used to save non tabular data.

* As most other programming languages, R comes with its own binary format. We will focus on the Rds data format which are optimized for speed and compression ratios. 

* Json is an open standard text file format, and data interchange format. It can be used to store non tabular data in text format. It is often used for data-exchange in web-api's. 

You may also have a look at the [slides for this module](https://bss-osca.github.io/tfa/slides/07-02_r-io-slides.html).



## Exercises {#ex-r-io}

Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the [help page](#help). Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution!

[Link to the project on RStudio Cloud for this module][r-cloud-mod16]. 

### Exercise (Statistikbanken)

Use the *exercise R markdown template* to solve this exercise (**File > New File > R Markdown...**, select **From template** and then **TFA Exercise**).

You can use the [API](https://api.statbank.dk/console) from [Statistikbanken](https://www.statistikbanken.dk/) to download a lot of data sets. Let us consider airports in Denmark (data set with table id FLYV41):


```r
url <- "https://api.statbank.dk/v1/data/FLYV41/CSV?lang=en&LUFTHAVN=*&Tid=*&Transport=*"
```

   1) Use `cat(read_lines(url, n_max = 3), sep = "\n")` to have a look at the delimiter used.
   
   
   

<div class="modal fade bs-example-modal-lg" id="i1qkGkfAfvqmgaP7oim1" tabindex="-1" role="dialog" aria-labelledby="i1qkGkfAfvqmgaP7oim1-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="i1qkGkfAfvqmgaP7oim1-title">Solution</h4></div><div class="modal-body">

```r
url <- 'https://api.statbank.dk/v1/data/FLYV41/CSV?lang=en&LUFTHAVN=*&Tid=*&Transport=*'
dat <- read_csv2(url)
dat
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#i1qkGkfAfvqmgaP7oim1">Solution</button>
   2) Import the csv file.
   
   
   3) Try to retrieve information and get an overview over the data by running:
      
      ```r
      library(jsonlite)
      url <- "https://api.statbank.dk/v1/tableinfo/FLYV41?lang=en"
      lst <- read_json(url, simplifyVector = T)
      View(lst)
      ```
      Note the data returned is in json format, so we use `read_json` to read the data into a list.
      
      

<div class="modal fade bs-example-modal-lg" id="Ab4hYHOfA6X65dYIGdp3" tabindex="-1" role="dialog" aria-labelledby="Ab4hYHOfA6X65dYIGdp3-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Ab4hYHOfA6X65dYIGdp3-title">Solution</h4></div><div class="modal-body">

```r
info <- function(tab_id) {
   url <- str_c("https://api.statbank.dk/v1/tableinfo/", tab_id, "?lang=en")
   lst <- read_json(url, simplifyVector = T) 
   return(list(description = lst$description, unit = lst$unit, variables = lst$variables[,1:2]))
}
info("FLYV41")
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Ab4hYHOfA6X65dYIGdp3">Solution</button>

<div class="modal fade bs-example-modal-lg" id="z1BKrBnrTeKSwF1xGe4y" tabindex="-1" role="dialog" aria-labelledby="z1BKrBnrTeKSwF1xGe4y-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="z1BKrBnrTeKSwF1xGe4y-title">Hint 2</h4></div><div class="modal-body">

```r
info <- function(tab_id) {
   url <- str_c(___)
   lst <- read_json(___) 
   return(list(description = lst$___, unit = ___, ___))
}
info("FLYV41")
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#z1BKrBnrTeKSwF1xGe4y">Hint 2</button>

<div class="modal fade bs-example-modal-lg" id="urQmIHzzTlKEcL3ygrS7" tabindex="-1" role="dialog" aria-labelledby="urQmIHzzTlKEcL3ygrS7-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="urQmIHzzTlKEcL3ygrS7-title">Hint 1</h4></div><div class="modal-body">

<p>You can modify the code in Question 3 to return only parts of the list.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#urQmIHzzTlKEcL3ygrS7">Hint 1</button>
   
   4) Create a function `info(tab_id)` that returns a list with components `description`, `unit` and `variables` from the information for a data set with table id `tab_id`. 
      
   5) Information about all the data sets can be retrieved using:
      
      ```r
      url <- "https://api.statbank.dk/v1/tables?lang=en"
      lst <- jsonlite::read_json(url, simplifyVector = T)
      View(lst)
      ```
      Have a look at the row for FLYV41.
   
   


<div class="modal fade bs-example-modal-lg" id="g1At9GFJD1txwSR3MtNV" tabindex="-1" role="dialog" aria-labelledby="g1At9GFJD1txwSR3MtNV-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="g1At9GFJD1txwSR3MtNV-title">Solution</h4></div><div class="modal-body">

```r
get_data <- function(tab_id, col_id = NULL) {
   url <- str_c("https://api.statbank.dk/v1/tableinfo/", tab_id, "?lang=en")
   lst <- read_json(url, simplifyVector = T) 
   cols <- lst$variables$id
   if (!is.null(col_id)) cols <- cols[col_id]
   url <- str_c("https://api.statbank.dk/v1/data/", tab_id, "/CSV?lang=en&", str_c(cols, collapse = "=*&"), "=*") %>% 
      URLencode()
   dat <- read_csv2(url)
   return(dat)
}
get_data("FLYV41", 3)
get_data("FLYV41", 1:2)
get_data("FLYV41")
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#g1At9GFJD1txwSR3MtNV">Solution</button>

<div class="modal fade bs-example-modal-lg" id="WAX6cXEtCQsEIscrTtAc" tabindex="-1" role="dialog" aria-labelledby="WAX6cXEtCQsEIscrTtAc-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="WAX6cXEtCQsEIscrTtAc-title">Hint</h4></div><div class="modal-body">

```r
get_data <- function(tab_id, col_id = NULL) {
   url <- ___
   lst <- ___
   cols <- lst$variables$id
   if (!is.null(col_id)) cols <- cols[___]
   url <- ___
   dat <- ___
   return(dat)
}
get_data("FLYV41", 3)
get_data("FLYV41", 1:2)
get_data("FLYV41")
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#WAX6cXEtCQsEIscrTtAc">Hint</button>
   6) Given the information about variables in a data set we can construct the url to retrieve the data in csv format:
      
      ```r
      tab_id <- "FLYV41"
      url <- str_c("https://api.statbank.dk/v1/tableinfo/", tab_id, "?lang=en")
      lst <- read_json(url, simplifyVector = T) 
      col_id <- c(1,3)  # column ids in lst$variables$id
      cols <- lst$variables$id[col_id]
      url <- str_c("https://api.statbank.dk/v1/data/", tab_id, "/CSV?lang=en&", str_c(cols, collapse = "=*&"), "=*") %>% 
         URLencode()
      url
      #> [1] "https://api.statbank.dk/v1/data/FLYV41/CSV?lang=en&LUFTHAVN=*&Tid=*"
      ```
      Create a function `get_data(tab_id, col_id)` that retrieve a data set.
      
      

<div class="modal fade bs-example-modal-lg" id="iBZfuKX0Mdbo7fCahWMh" tabindex="-1" role="dialog" aria-labelledby="iBZfuKX0Mdbo7fCahWMh-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="iBZfuKX0Mdbo7fCahWMh-title">Solution</h4></div><div class="modal-body">

```r
dat <- get_data("FOLK1A", c(2, 3, 5))
dat
write_csv(dat, "test.csv")
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#iBZfuKX0Mdbo7fCahWMh">Solution</button>
   
   7) Use the function `get_data` to retrieve data for `tab_id = "FOLK1A"` and `col_id = c(2, 3, 5)` and save it as a csv file with a comma as delimiter.
   
   

<div class="modal fade bs-example-modal-lg" id="TES4FY1Ddim46wvve9uv" tabindex="-1" role="dialog" aria-labelledby="TES4FY1Ddim46wvve9uv-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="TES4FY1Ddim46wvve9uv-title">Solution</h4></div><div class="modal-body">

```r
library(openxlsx)
write.xlsx(dat, "test.xlsx", sheetName = "FOLK1A") 

library(googlesheets4)
gs <- gs4_create("test")
write_sheet(dat, ss = gs, sheet = "FOLK1A")
gs4_browse(gs)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#TES4FY1Ddim46wvve9uv">Solution</button>

<div class="modal fade bs-example-modal-lg" id="A4ZMSSmpHjU42EDQYiEt" tabindex="-1" role="dialog" aria-labelledby="A4ZMSSmpHjU42EDQYiEt-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="A4ZMSSmpHjU42EDQYiEt-title">Hint</h4></div><div class="modal-body">

```r
library(openxlsx)
write.xlsx(___) 

library(googlesheets4)
gs <- gs4_create("test")
write_sheet(___, ss = ___, sheet = "FOLK1A")
gs4_browse(gs)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#A4ZMSSmpHjU42EDQYiEt">Hint</button>
   8) Save the data in an Excel file and a Google sheet.

### Exercise (tuples in OPL)
   
In the algebraic modeling language OPL (Optimization Programming Language) used by [IBM ILOG CPLEX Optimization Studio](https://www.ibm.com/products/ilog-cplex-optimization-studio), you can define tuples to contain various information. For example consider tuples defined as:

```java
tuple nurse {
  string name;
  int experience;   // higest best
}

tuple shift {
   string departmentName;
   string day;
   int startTime;
   int endTime;
}
```

A `nurse` tuple is then defined as `<"Anne", 11>` and a `shift` tuple as `<"Consultation", "Monday" 12, 18>.

A set of tuples can be defined using:

```java
{nurse} nurses = ...;
{shift} shifts = ...;
```

where the `...` operator means that the sets are read from a data text file:

```java
nurses = {
   <"Anne", 11>, 
   <"Bethanie", 4>, 
   <"Betsy", 2>
};

shifts = {
   <"Emergency", "Monday", 2, 8>,
   <"Emergency", Monday 8 12 4 7>, 
   <"Emergency", "Monday" 12 18 2 5> 
};
```

You can now use the sets to define decision variables $x_{ns}$ equal one if nurse $n$ is assigned to shift $s$. 

In this exercise we will try to generate the data text file given tibbles with data.



<div class="modal fade bs-example-modal-lg" id="TGJfjZsPCTNFvS0wN0yN" tabindex="-1" role="dialog" aria-labelledby="TGJfjZsPCTNFvS0wN0yN-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="TGJfjZsPCTNFvS0wN0yN-title">Solution</h4></div><div class="modal-body">

```r
file = "test.dat"
write_lines("nurses = {", file)
write_lines('   <"Anne", 11>', file, append = TRUE)
write_lines('};', file, append = TRUE)
cat(read_file("test.dat"))
#> nurses = {
#>    <"Anne", 11>
#> };
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#TGJfjZsPCTNFvS0wN0yN">Solution</button>

<div class="modal fade bs-example-modal-lg" id="z8YnCiZ0FTvzDXetjbDu" tabindex="-1" role="dialog" aria-labelledby="z8YnCiZ0FTvzDXetjbDu-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="z8YnCiZ0FTvzDXetjbDu-title">Hint</h4></div><div class="modal-body">

```r
file = "test.dat"
write_lines("nurses = {", file)
write_lines(___, ___, append = TRUE)
write_lines(___, ___, append = TRUE)
cat(read_file("test.dat"))  # to have a look 
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#z8YnCiZ0FTvzDXetjbDu">Hint</button>
1) Try to generate a text file named `test.dat` using function `write_lines` with content 

   ```java 
   nurses = {
      <"Anne", 11>
   };
   ```

Load datasets 


```r
# remotes::install_github("bss-osca/tfa/tfa-package", dependencies = FALSE)  # if tfa not installed
library(tfa)
library(tidyverse)
nurses <- read_csv(system.file("extdata/nurses.csv", package = "tfa"))
shifts <- read_csv(system.file("extdata/shifts.csv", package = "tfa"))
```





<div class="modal fade bs-example-modal-lg" id="nJEejSrfA0r6JQcLZpKN" tabindex="-1" role="dialog" aria-labelledby="nJEejSrfA0r6JQcLZpKN-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="nJEejSrfA0r6JQcLZpKN-title">Solution</h4></div><div class="modal-body">

```r
nurses %>%
   mutate(across(where(is.character), ~str_c('"', .x, '"'))) 
#> # A tibble: 32 × 2
#>    name           experience
#>    <chr>               <dbl>
#>  1 "\"Anne\""             11
#>  2 "\"Bethanie\""          4
#>  3 "\"Betsy\""             2
#>  4 "\"Cathy\""             2
#>  5 "\"Cecilia\""           9
#>  6 "\"Chris\""            11
#>  7 "\"Cindy\""             5
#>  8 "\"David\""             1
#>  9 "\"Debbie\""            7
#> 10 "\"Dee\""               3
#> # … with 22 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#nJEejSrfA0r6JQcLZpKN">Solution</button>

<div class="modal fade bs-example-modal-lg" id="bU6qRknO0k4W7f3nfF93" tabindex="-1" role="dialog" aria-labelledby="bU6qRknO0k4W7f3nfF93-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="bU6qRknO0k4W7f3nfF93-title">Hint 2</h4></div><div class="modal-body">

```r
nurses %>%
   mutate(across(where(___), ~str_c('___', .x, '___'))) 
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#bU6qRknO0k4W7f3nfF93">Hint 2</button>

<div class="modal fade bs-example-modal-lg" id="0pG3LZnL8lszeFdRCbyC" tabindex="-1" role="dialog" aria-labelledby="0pG3LZnL8lszeFdRCbyC-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="0pG3LZnL8lszeFdRCbyC-title">Hint 1</h4></div><div class="modal-body">

```r
v <- c("foo", "bar")
str_c('"', v, '"')  # use of str_c to add "
#> [1] "\"foo\"" "\"bar\""
str_c(v, collapse = ", ") # collapsing a vector
#> [1] "foo, bar"
tbl <- tribble(
   ~name, ~experience,
   "Anne", 11,
   "Bethanie", 4
)
tbl
#> # A tibble: 2 × 2
#>   name     experience
#>   <chr>         <dbl>
#> 1 Anne             11
#> 2 Bethanie          4
tbl %>% 
   mutate(across(where(is.character), # use across to find all character columns
                 ~str_c('(', .x, ')'))) # str_c is applied to each column where .x is the column values 
#> # A tibble: 2 × 2
#>   name       experience
#>   <chr>           <dbl>
#> 1 (Anne)             11
#> 2 (Bethanie)          4
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#0pG3LZnL8lszeFdRCbyC">Hint 1</button>

2) Transform all character columns in `nurses` so they start and end with `"`. Some hints are given in Hint 1. 



<div class="modal fade bs-example-modal-lg" id="QL26P21ANaKUkAqJEJmF" tabindex="-1" role="dialog" aria-labelledby="QL26P21ANaKUkAqJEJmF-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="QL26P21ANaKUkAqJEJmF-title">Solution</h4></div><div class="modal-body">

```r
nurses %>%
   mutate(across(where(is.character), ~str_c('"', .x, '"'))) %>% 
   unite("tuple", everything(), sep = ", ", remove = FALSE)
#> # A tibble: 32 × 3
#>    tuple             name           experience
#>    <chr>             <chr>               <dbl>
#>  1 "\"Anne\", 11"    "\"Anne\""             11
#>  2 "\"Bethanie\", 4" "\"Bethanie\""          4
#>  3 "\"Betsy\", 2"    "\"Betsy\""             2
#>  4 "\"Cathy\", 2"    "\"Cathy\""             2
#>  5 "\"Cecilia\", 9"  "\"Cecilia\""           9
#>  6 "\"Chris\", 11"   "\"Chris\""            11
#>  7 "\"Cindy\", 5"    "\"Cindy\""             5
#>  8 "\"David\", 1"    "\"David\""             1
#>  9 "\"Debbie\", 7"   "\"Debbie\""            7
#> 10 "\"Dee\", 3"      "\"Dee\""               3
#> # … with 22 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#QL26P21ANaKUkAqJEJmF">Solution</button>

<div class="modal fade bs-example-modal-lg" id="v9DcFhkGZuhqvIe8qfjJ" tabindex="-1" role="dialog" aria-labelledby="v9DcFhkGZuhqvIe8qfjJ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="v9DcFhkGZuhqvIe8qfjJ-title">Hint</h4></div><div class="modal-body">

```r
nurses %>%
   mutate(across(where(is.character), ~str_c('"', .x, '"'))) %>% 
   unite("tuple", everything(), sep = ___, remove = ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#v9DcFhkGZuhqvIe8qfjJ">Hint</button>

3) Unite all columns into a new column named `tuple` where each column is separated with `,`. Hint: have a look at the `unite` function. All columns can be selected using `everything()`.




<div class="modal fade bs-example-modal-lg" id="fSemtW9G8EicSdWKldmB" tabindex="-1" role="dialog" aria-labelledby="fSemtW9G8EicSdWKldmB-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="fSemtW9G8EicSdWKldmB-title">Solution</h4></div><div class="modal-body">

```r
nurses %>%
   mutate(across(where(is.character), ~str_c('"', .x, '"'))) %>% 
   unite("tuple", everything(), sep = ", ", remove = FALSE) %>% 
   mutate(tuple = str_c("<", tuple, ">"))
#> # A tibble: 32 × 3
#>    tuple               name           experience
#>    <chr>               <chr>               <dbl>
#>  1 "<\"Anne\", 11>"    "\"Anne\""             11
#>  2 "<\"Bethanie\", 4>" "\"Bethanie\""          4
#>  3 "<\"Betsy\", 2>"    "\"Betsy\""             2
#>  4 "<\"Cathy\", 2>"    "\"Cathy\""             2
#>  5 "<\"Cecilia\", 9>"  "\"Cecilia\""           9
#>  6 "<\"Chris\", 11>"   "\"Chris\""            11
#>  7 "<\"Cindy\", 5>"    "\"Cindy\""             5
#>  8 "<\"David\", 1>"    "\"David\""             1
#>  9 "<\"Debbie\", 7>"   "\"Debbie\""            7
#> 10 "<\"Dee\", 3>"      "\"Dee\""               3
#> # … with 22 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#fSemtW9G8EicSdWKldmB">Solution</button>

<div class="modal fade bs-example-modal-lg" id="OxN4WwrYfVv5Umrto9jl" tabindex="-1" role="dialog" aria-labelledby="OxN4WwrYfVv5Umrto9jl-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="OxN4WwrYfVv5Umrto9jl-title">Hint</h4></div><div class="modal-body">

```r
nurses %>%
   mutate(across(where(is.character), ~str_c('"', .x, '"'))) %>% 
   unite("tuple", everything(), sep = ", ", remove = FALSE) %>% 
   mutate(tuple = str_c(___, tuple, ___))
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#OxN4WwrYfVv5Umrto9jl">Hint</button>

4) Add `<` and `>` the start and end of the `tuple` column.




<div class="modal fade bs-example-modal-lg" id="euOxSCa9WPpYSBTEJrRQ" tabindex="-1" role="dialog" aria-labelledby="euOxSCa9WPpYSBTEJrRQ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="euOxSCa9WPpYSBTEJrRQ-title">Solution</h4></div><div class="modal-body">

```r
nurses %>%
   mutate(across(where(is.character), ~str_c('"', .x, '"'))) %>% 
   unite("tuple", everything(), sep = ", ", remove = FALSE) %>% 
   mutate(tuple = str_c("<", tuple, ">")) %>% 
   pull(tuple) %>% 
   str_c(collapse = ",\n")
#> [1] "<\"Anne\", 11>,\n<\"Bethanie\", 4>,\n<\"Betsy\", 2>,\n<\"Cathy\", 2>,\n<\"Cecilia\", 9>,\n<\"Chris\", 11>,\n<\"Cindy\", 5>,\n<\"David\", 1>,\n<\"Debbie\", 7>,\n<\"Dee\", 3>,\n<\"Gloria\", 8>,\n<\"Isabelle\", 3>,\n<\"Jane\", 3>,\n<\"Janelle\", 4>,\n<\"Janice\", 2>,\n<\"Jemma\", 2>,\n<\"Joan\", 5>,\n<\"Joyce\", 8>,\n<\"Jude\", 4>,\n<\"Julie\", 6>,\n<\"Juliet\", 7>,\n<\"Kate\", 5>,\n<\"Nancy\", 8>,\n<\"Nathalie\", 9>,\n<\"Nicole\", 0>,\n<\"Patricia\", 1>,\n<\"Patrick\", 6>,\n<\"Roberta\", 3>,\n<\"Suzanne\", 5>,\n<\"Vickie\", 7>,\n<\"Wendie\", 5>,\n<\"Zoe\", 8>"
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#euOxSCa9WPpYSBTEJrRQ">Solution</button>

<div class="modal fade bs-example-modal-lg" id="Tp0J5pTXOS7114Mlk6x8" tabindex="-1" role="dialog" aria-labelledby="Tp0J5pTXOS7114Mlk6x8-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Tp0J5pTXOS7114Mlk6x8-title">Hint</h4></div><div class="modal-body">

```r
nurses %>%
   mutate(across(where(is.character), ~str_c('"', .x, '"'))) %>% 
   unite("tuple", everything(), sep = ", ", remove = FALSE) %>% 
   mutate(tuple = str_c("<", tuple, ">")) %>% 
   pull(___) %>% 
   str_c(___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Tp0J5pTXOS7114Mlk6x8">Hint</button>

5) Extract the `tuple` column and transform it into a string with `collapse = ",\n"`.




<div class="modal fade bs-example-modal-lg" id="UZvoXNXnc6BqTmoIEcNs" tabindex="-1" role="dialog" aria-labelledby="UZvoXNXnc6BqTmoIEcNs-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="UZvoXNXnc6BqTmoIEcNs-title">Solution</h4></div><div class="modal-body">

```r
write_tuple <- function(dat, file) {
   write_lines("nurses = {", file, sep = "\n   ")
   tuples <- dat %>%
      mutate(across(where(is.character), ~str_c('"', .x, '"'))) %>% 
      unite("tuple", everything(), sep = ", ", remove = FALSE) %>% 
      mutate(tuple = str_c("<", tuple, ">")) %>% 
      pull(tuple) %>% 
      str_c(collapse = ",\n   ")
   write_lines(tuples, file, append = TRUE)
   write_lines("};", file, append = TRUE)
}
file <- "test.dat"
write_tuple(nurses, file)
cat(read_file("test.dat"))  # to have a look 
#> nurses = {
#>    <"Anne", 11>,
#>    <"Bethanie", 4>,
#>    <"Betsy", 2>,
#>    <"Cathy", 2>,
#>    <"Cecilia", 9>,
#>    <"Chris", 11>,
#>    <"Cindy", 5>,
#>    <"David", 1>,
#>    <"Debbie", 7>,
#>    <"Dee", 3>,
#>    <"Gloria", 8>,
#>    <"Isabelle", 3>,
#>    <"Jane", 3>,
#>    <"Janelle", 4>,
#>    <"Janice", 2>,
#>    <"Jemma", 2>,
#>    <"Joan", 5>,
#>    <"Joyce", 8>,
#>    <"Jude", 4>,
#>    <"Julie", 6>,
#>    <"Juliet", 7>,
#>    <"Kate", 5>,
#>    <"Nancy", 8>,
#>    <"Nathalie", 9>,
#>    <"Nicole", 0>,
#>    <"Patricia", 1>,
#>    <"Patrick", 6>,
#>    <"Roberta", 3>,
#>    <"Suzanne", 5>,
#>    <"Vickie", 7>,
#>    <"Wendie", 5>,
#>    <"Zoe", 8>
#> };
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#UZvoXNXnc6BqTmoIEcNs">Solution</button>

<div class="modal fade bs-example-modal-lg" id="79dBfVjK6OXjAaUwu9Jh" tabindex="-1" role="dialog" aria-labelledby="79dBfVjK6OXjAaUwu9Jh-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="79dBfVjK6OXjAaUwu9Jh-title">Hint 2</h4></div><div class="modal-body">

```r
write_tuple <- function(dat, file) {
   write_lines("nurses = {", file, sep = "\n   ")
   tuples <- dat %>%
      ___
   write_lines(tuples, file, append = TRUE)
   write_lines("};", file, append = TRUE)
}
file <- "test.dat"
write_tuple(nurses, file)
cat(read_file("test.dat"))  # to have a look 
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#79dBfVjK6OXjAaUwu9Jh">Hint 2</button>

<div class="modal fade bs-example-modal-lg" id="lVEAJ2fkFS26tcdSHw1A" tabindex="-1" role="dialog" aria-labelledby="lVEAJ2fkFS26tcdSHw1A-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="lVEAJ2fkFS26tcdSHw1A-title">Hint 1</h4></div><div class="modal-body">

```r
write_tuple <- function(dat, file) {
   write_lines(___)
   ___
   write_lines("};", ___, ___)
}
file <- "test.dat"
write_tuple(nurses, file)
cat(read_file("test.dat"))  # to have a look 
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#lVEAJ2fkFS26tcdSHw1A">Hint 1</button>

6) Create a function `write_tuple` that takes nurses as input and write the tuples to a file.

The name of an object can be extracted as a string using 


```r
deparse(substitute(nurses))
#> [1] "nurses"
```





<div class="modal fade bs-example-modal-lg" id="ynzGa4nst0EbMh2eEGjB" tabindex="-1" role="dialog" aria-labelledby="ynzGa4nst0EbMh2eEGjB-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="ynzGa4nst0EbMh2eEGjB-title">Solution</h4></div><div class="modal-body">

```r
write_tuple <- function(dat, file) {
   name <- deparse(substitute(dat))
   write_lines(str_c(name, " = {"), file, sep = "\n   ")
   tuples <- dat %>%
      mutate(across(where(is.character), ~str_c('"', .x, '"'))) %>% 
      unite("tuple", everything(), sep = ", ", remove = FALSE) %>% 
      mutate(tuple = str_c("<", tuple, ">")) %>% 
      pull(tuple) %>% 
      str_c(collapse = ",\n   ")
   write_lines(tuples, file, append = TRUE)
   write_lines("};", file, append = TRUE)
}
file <- "test.dat"
write_tuple(shifts, file)
cat(read_file("test.dat"))  # to have a look 
#> shifts = {
#>    <"Emergency", "Monday", 2, 8>,
#>    <"Emergency", "Monday", 8, 12>,
#>    <"Emergency", "Monday", 12, 18>,
#>    <"Emergency", "Monday", 18, 2>,
#>    <"Consultation", "Monday", 8, 12>,
#>    <"Consultation", "Monday", 12, 18>,
#>    <"Emergency", "Tuesday", 8, 12>,
#>    <"Emergency", "Tuesday", 12, 18>,
#>    <"Emergency", "Tuesday", 18, 2>,
#>    <"Consultation", "Tuesday", 8, 12>,
#>    <"Consultation", "Tuesday", 12, 18>,
#>    <"Emergency", "Wednesday", 2, 8>,
#>    <"Emergency", "Wednesday", 8, 12>,
#>    <"Emergency", "Wednesday", 12, 18>,
#>    <"Emergency", "Wednesday", 18, 2>,
#>    <"Consultation", "Wednesday", 8, 12>,
#>    <"Consultation", "Wednesday", 12, 18>,
#>    <"Emergency", "Thursday", 2, 8>,
#>    <"Emergency", "Thursday", 8, 12>,
#>    <"Emergency", "Thursday", 12, 18>,
#>    <"Emergency", "Thursday", 18, 2>,
#>    <"Consultation", "Thursday", 8, 12>,
#>    <"Consultation", "Thursday", 12, 18>,
#>    <"Emergency", "Friday", 2, 8>,
#>    <"Emergency", "Friday", 8, 12>,
#>    <"Emergency", "Friday", 12, 18>,
#>    <"Emergency", "Friday", 18, 2>,
#>    <"Consultation", "Friday", 8, 12>,
#>    <"Consultation", "Friday", 12, 18>,
#>    <"Emergency", "Saturday", 2, 12>,
#>    <"Emergency", "Saturday", 12, 20>,
#>    <"Emergency", "Saturday", 20, 2>,
#>    <"Emergency", "Sunday", 2, 12>,
#>    <"Emergency", "Sunday", 12, 20>,
#>    <"Emergency", "Sunday", 20, 2>
#> };
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ynzGa4nst0EbMh2eEGjB">Solution</button>

7) Modify `write_tuple` so it works if `shifts` are given as input instead of nurses.





<div class="modal fade bs-example-modal-lg" id="NgPXS71An841PqKRPLvv" tabindex="-1" role="dialog" aria-labelledby="NgPXS71An841PqKRPLvv-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="NgPXS71An841PqKRPLvv-title">Solution</h4></div><div class="modal-body">

```r
write_tuple <- function(dat, file, append = FALSE) {
   name <- deparse(substitute(dat))
   write_lines(str_c("\n", name, " = {"), file, sep = "\n   ", append = append)
   tuples <- dat %>%
      mutate(across(where(is.character), ~str_c('"', .x, '"'))) %>% 
      unite("tuple", everything(), sep = ", ", remove = FALSE) %>% 
      mutate(tuple = str_c("<", tuple, ">")) %>% 
      pull(tuple) %>% 
      str_c(collapse = ",\n   ")
   write_lines(tuples, file, append = TRUE)
   write_lines("};", file, append = TRUE)
}
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#NgPXS71An841PqKRPLvv">Solution</button>

8) Modify `write_tuple` with a new input argument `append` which is false by default. If true, then then the file is not overwritten.





<div class="modal fade bs-example-modal-lg" id="HjDw3zDJ7aezCoczRi4d" tabindex="-1" role="dialog" aria-labelledby="HjDw3zDJ7aezCoczRi4d-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="HjDw3zDJ7aezCoczRi4d-title">Solution</h4></div><div class="modal-body">

```r
file <- "test.dat"
write_tuple(nurses, file)
write_tuple(shifts, file, append = TRUE)
cat(read_file("test.dat"))  # to have a look 
#> 
#> nurses = {
#>    <"Anne", 11>,
#>    <"Bethanie", 4>,
#>    <"Betsy", 2>,
#>    <"Cathy", 2>,
#>    <"Cecilia", 9>,
#>    <"Chris", 11>,
#>    <"Cindy", 5>,
#>    <"David", 1>,
#>    <"Debbie", 7>,
#>    <"Dee", 3>,
#>    <"Gloria", 8>,
#>    <"Isabelle", 3>,
#>    <"Jane", 3>,
#>    <"Janelle", 4>,
#>    <"Janice", 2>,
#>    <"Jemma", 2>,
#>    <"Joan", 5>,
#>    <"Joyce", 8>,
#>    <"Jude", 4>,
#>    <"Julie", 6>,
#>    <"Juliet", 7>,
#>    <"Kate", 5>,
#>    <"Nancy", 8>,
#>    <"Nathalie", 9>,
#>    <"Nicole", 0>,
#>    <"Patricia", 1>,
#>    <"Patrick", 6>,
#>    <"Roberta", 3>,
#>    <"Suzanne", 5>,
#>    <"Vickie", 7>,
#>    <"Wendie", 5>,
#>    <"Zoe", 8>
#> };
#> 
#> shifts = {
#>    <"Emergency", "Monday", 2, 8>,
#>    <"Emergency", "Monday", 8, 12>,
#>    <"Emergency", "Monday", 12, 18>,
#>    <"Emergency", "Monday", 18, 2>,
#>    <"Consultation", "Monday", 8, 12>,
#>    <"Consultation", "Monday", 12, 18>,
#>    <"Emergency", "Tuesday", 8, 12>,
#>    <"Emergency", "Tuesday", 12, 18>,
#>    <"Emergency", "Tuesday", 18, 2>,
#>    <"Consultation", "Tuesday", 8, 12>,
#>    <"Consultation", "Tuesday", 12, 18>,
#>    <"Emergency", "Wednesday", 2, 8>,
#>    <"Emergency", "Wednesday", 8, 12>,
#>    <"Emergency", "Wednesday", 12, 18>,
#>    <"Emergency", "Wednesday", 18, 2>,
#>    <"Consultation", "Wednesday", 8, 12>,
#>    <"Consultation", "Wednesday", 12, 18>,
#>    <"Emergency", "Thursday", 2, 8>,
#>    <"Emergency", "Thursday", 8, 12>,
#>    <"Emergency", "Thursday", 12, 18>,
#>    <"Emergency", "Thursday", 18, 2>,
#>    <"Consultation", "Thursday", 8, 12>,
#>    <"Consultation", "Thursday", 12, 18>,
#>    <"Emergency", "Friday", 2, 8>,
#>    <"Emergency", "Friday", 8, 12>,
#>    <"Emergency", "Friday", 12, 18>,
#>    <"Emergency", "Friday", 18, 2>,
#>    <"Consultation", "Friday", 8, 12>,
#>    <"Consultation", "Friday", 12, 18>,
#>    <"Emergency", "Saturday", 2, 12>,
#>    <"Emergency", "Saturday", 12, 20>,
#>    <"Emergency", "Saturday", 20, 2>,
#>    <"Emergency", "Sunday", 2, 12>,
#>    <"Emergency", "Sunday", 12, 20>,
#>    <"Emergency", "Sunday", 20, 2>
#> };
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#HjDw3zDJ7aezCoczRi4d">Solution</button>

9) Write `nurses` and `shifts` to a single data file.






<!--chapter:end:12_r-io.Rmd-->

---
output: html_document
editor_options: 
  chunk_output_type: console
---



[BSS]: https://bss.au.dk/en/

[course-help]: https://github.com/bss-osca/tfa/issues
[cran]: https://cloud.r-project.org
[cheatsheet-readr]: https://rawgit.com/rstudio/cheatsheets/master/data-import.pdf
[course-welcome-to-the-tidyverse]: https://github.com/rstudio-education/welcome-to-the-tidyverse

[DataCamp]: https://www.datacamp.com/
[datacamp-signup]: https://www.datacamp.com/groups/shared_links/cbaee6c73e7d78549a9e32a900793b2d5491ace1824efc1760a6729735948215
[datacamp-r-intro]: https://learn.datacamp.com/courses/free-introduction-to-r
[datacamp-r-rmarkdown]: https://campus.datacamp.com/courses/reporting-with-rmarkdown
[datacamp-r-communicating]: https://learn.datacamp.com/courses/communicating-with-data-in-the-tidyverse
[datacamp-r-communicating-chap3]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/introduction-to-rmarkdown
[datacamp-r-communicating-chap4]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/customizing-your-rmarkdown-report
[datacamp-r-intermediate]: https://learn.datacamp.com/courses/intermediate-r
[datacamp-r-intermediate-chap1]: https://campus.datacamp.com/courses/intermediate-r/chapter-1-conditionals-and-control-flow
[datacamp-r-intermediate-chap2]: https://campus.datacamp.com/courses/intermediate-r/chapter-2-loops
[datacamp-r-intermediate-chap3]: https://campus.datacamp.com/courses/intermediate-r/chapter-3-functions
[datacamp-r-intermediate-chap4]: https://campus.datacamp.com/courses/intermediate-r/chapter-4-the-apply-family
[datacamp-r-functions]: https://learn.datacamp.com/courses/introduction-to-writing-functions-in-r
[datacamp-r-tidyverse]: https://learn.datacamp.com/courses/introduction-to-the-tidyverse
[datacamp-r-strings]: https://learn.datacamp.com/courses/string-manipulation-with-stringr-in-r
[datacamp-r-dplyr]: https://learn.datacamp.com/courses/data-manipulation-with-dplyr
[datacamp-r-dplyr-bakeoff]: https://learn.datacamp.com/courses/working-with-data-in-the-tidyverse
[datacamp-r-ggplot2-intro]: https://learn.datacamp.com/courses/introduction-to-data-visualization-with-ggplot2
[datacamp-r-ggplot2-intermediate]: https://learn.datacamp.com/courses/intermediate-data-visualization-with-ggplot2
[dplyr-cran]: https://CRAN.R-project.org/package=dplyr
[debug-in-r]: https://rstats.wtf/debugging-r-code.html

[excel-vs-r]: https://www.jessesadler.com/post/excel-vs-r/

[google-form]: https://forms.gle/s39GeDGV9AzAXUo18
[google-grupper]: https://docs.google.com/spreadsheets/d/1DHxthd5AQywAU4Crb3hM9rnog2GqGQYZ2o175SQgn_0/edit?usp=sharing
[GitHub]: https://github.com/
[git-install]: https://git-scm.com/downloads
[github-actions]: https://github.com/features/actions
[github-pages]: https://pages.github.com/

[happy-git]: https://happygitwithr.com
[hg-install-git]: https://happygitwithr.com/install-git.html
[hg-why]: https://happygitwithr.com/big-picture.html#big-picture
[hg-github-reg]: https://happygitwithr.com/github-acct.html#github-acct
[hg-git-install]: https://happygitwithr.com/install-git.html#install-git
[hg-exist-github-first]: https://happygitwithr.com/existing-github-first.html
[hg-exist-github-last]: https://happygitwithr.com/existing-github-last.html
[hg-credential-helper]: https://happygitwithr.com/credential-caching.html
[hypothes.is]: https://web.hypothes.is/

[osca-programme]: https://kandidat.au.dk/en/operationsandsupplychainanalytics/

[Peergrade]: https://peergrade.io
[peergrade-signup]: https://app.peergrade.io/join
[point-and-click]: https://en.wikipedia.org/wiki/Point_and_click
[pkg-bookdown]: https://bookdown.org/yihui/bookdown/
[pkg-openxlsx]: https://ycphs.github.io/openxlsx/index.html
[pkg-ropensci-writexl]: https://docs.ropensci.org/writexl/
[pkg-jsonlite]: https://cran.r-project.org/web/packages/jsonlite/index.html

[R]: https://www.r-project.org
[RStudio]: https://rstudio.com
[rstudio-cloud]: https://rstudio.cloud/spaces/176810/join?access_code=LSGnG2EXTuzSyeYaNXJE77vP33DZUoeMbC0xhfCz
[r-cloud-mod12]: https://rstudio.cloud/spaces/176810/project/2963819
[r-cloud-mod13]: https://rstudio.cloud/spaces/176810/project/3020139
[r-cloud-mod14]: https://rstudio.cloud/spaces/176810/project/3020322
[r-cloud-mod15]: https://rstudio.cloud/spaces/176810/project/3020509
[r-cloud-mod16]: https://rstudio.cloud/spaces/176810/project/3026754
[r-cloud-mod17]: https://rstudio.cloud/spaces/176810/project/3034015
[r-cloud-mod18]: https://rstudio.cloud/spaces/176810/project/3130795
[r-cloud-mod19]: https://rstudio.cloud/spaces/176810/project/3266132
[rstudio-download]: https://rstudio.com/products/rstudio/download/#download
[rstudio-customizing]: https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio
[rstudio-key-shortcuts]: https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts
[rstudio-workbench]: https://www.rstudio.com/wp-content/uploads/2014/04/rstudio-workbench.png
[r-markdown]: https://rmarkdown.rstudio.com/
[ropensci-writexl]: https://docs.ropensci.org/writexl/
[r4ds-pipes]: https://r4ds.had.co.nz/pipes.html
[r4ds-factors]: https://r4ds.had.co.nz/factors.html
[r4ds-strings]: https://r4ds.had.co.nz/strings.html
[r4ds-iteration]: https://r4ds.had.co.nz/iteration.html

[stat-545]: https://stat545.com
[stat-545-functions-part1]: https://stat545.com/functions-part1.html
[stat-545-functions-part2]: https://stat545.com/functions-part2.html
[stat-545-functions-part3]: https://stat545.com/functions-part3.html
[slides-welcome]: https://bss-osca.github.io/tfa/slides/00-tfa_welcome.html
[slides-m1-3]: https://bss-osca.github.io/tfa/slides/01-welcome_r_part.html
[slides-m4-5]: https://bss-osca.github.io/tfa/slides/02-programming.html
[slides-m6-8]: https://bss-osca.github.io/tfa/slides/03-transform.html
[slides-m9]: https://bss-osca.github.io/tfa/slides/04-plot.html
[slides-m83]: https://bss-osca.github.io/tfa/slides/05-joins.html

[tidyverse-main-page]: https://www.tidyverse.org
[tidyverse-packages]: https://www.tidyverse.org/packages/
[tidyverse-core]: https://www.tidyverse.org/packages/#core-tidyverse
[tidyverse-ggplot2]: https://ggplot2.tidyverse.org/
[tidyverse-dplyr]: https://dplyr.tidyverse.org/
[tidyverse-tidyr]: https://tidyr.tidyverse.org/
[tidyverse-readr]: https://readr.tidyverse.org/
[tidyverse-purrr]: https://purrr.tidyverse.org/
[tidyverse-tibble]: https://tibble.tidyverse.org/
[tidyverse-stringr]: https://stringr.tidyverse.org/
[tidyverse-forcats]: https://forcats.tidyverse.org/
[tidyverse-readxl]: https://readxl.tidyverse.org
[tidyverse-googlesheets4]: https://googlesheets4.tidyverse.org/index.html
[tutorial-markdown]: https://commonmark.org/help/tutorial/

[Udemy]: https://www.udemy.com/

[vba-yt-course1]: https://www.youtube.com/playlist?list=PLpOAvcoMay5S_hb2D7iKznLqJ8QG_pde0
[vba-course1-hello]: https://youtu.be/f42OniDWaIo

[vba-yt-course2]: https://www.youtube.com/playlist?list=PL3A6U40JUYCi4njVx59-vaUxYkG0yRO4m
[vba-course2-devel-tab]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-editor]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-project]: https://youtu.be/fp6PTbU7bXo
[vba-course2-devel-properties]: https://youtu.be/ks2QYKAd9Xw
[vba-course2-devel-hello]: https://youtu.be/EQ6tDWBc8G4

[video-install]: https://vimeo.com/415501284
[video-rstudio-intro]: https://vimeo.com/416391353
[video-packages]: https://vimeo.com/416743698
[video-projects]: https://vimeo.com/319318233
[video-r-intro-p1]: https://www.youtube.com/watch?v=vGY5i_J2c-c
[video-r-intro-p2]: https://www.youtube.com/watch?v=w8_XdYI3reU
[video-r-intro-p3]: https://www.youtube.com/watch?v=NuY6jY4qE7I
[video-subsetting]: https://www.youtube.com/watch?v=hWbgqzsQJF0&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10&t=0s
[video-datatypes]: https://www.youtube.com/watch?v=5AQM-yUX9zg&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10
[video-control-structures]: https://www.youtube.com/watch?v=s_h9ruNwI_0
[video-conditional-loops]: https://www.youtube.com/watch?v=2evtsnPaoDg
[video-functions]: https://www.youtube.com/watch?v=ffPeac3BigM
[video-tibble-vs-df]: https://www.youtube.com/watch?v=EBk6PnvE1R4
[video-dplyr]: https://www.youtube.com/watch?v=aywFompr1F4

[wiki-snake-case]: https://en.wikipedia.org/wiki/Snake_case
[wiki-camel-case]: https://en.wikipedia.org/wiki/Camel_case
[wiki-interpreted]: https://en.wikipedia.org/wiki/Interpreted_language
[wiki-literate-programming]: https://en.wikipedia.org/wiki/Literate_programming
[wiki-csv]: https://en.wikipedia.org/wiki/Comma-separated_values
[wiki-json]: https://en.wikipedia.org/wiki/JSON

# Transforming data {#mod-r-transform}

In this module, we consider transformation of data. In general raw data may be messy and need to be structured in a __tidy__ way. Tidying your data means storing it in a structured form suitable for analysis. This is done using a tibble (data frame) where each column is a variable, and each row is an observation. Tidy data is important because the consistent structure lets you focus your struggle on questions about the data.

Given a raw dataset the first step is to clean it and and transform it to a tidy format. Given tidy data, you next often need to __transform__ it. Transformation includes narrowing in on observations of interest (e.g. only observations from a specific year or warehouse), creating new variables based on existing variables (like the cost of using the machine that day given idle time). Together, tidying and transforming are called __wrangling__, because it can be a hard process to get your data in the right form.

In this chapter, you will learn how to work with tibbles using the [dplyr package][tidyverse-dplyr] which is a part of the [tidyverse][tidyverse-main-page]. 

We are all different and you may like different learning styles compared to others. In the learning path diagram, there may be links to alternative online content. Note this is an alternative to the standard learning path that you may use instead. The learning path may also have extra content, that is not a part of syllabus, you can have a look at. 


```{=html}
<div id="htmlwidget-70b3117750da0c1364be" style="width:100%;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-70b3117750da0c1364be">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"💡 Transform\\n(dplyr)\", URL = \"#r-transform-tidyverse\", tooltip = \"Working with data in the tidyverse\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"0,2!\"] \n  \"2\" [label = \"📖 Joins\", URL = \"#r-transform-joins\", tooltip = \"Mutating and filtering joins\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"2,2!\"] \n  \"3\" [label = \"💻 Exercises\", URL = \"#ex-r-transform\", tooltip = \"Exercises\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"4,2!\"] \n  \"4\" [label = \"🎬 dplyr\", URL = \"https://www.youtube.com/watch?v=aywFompr1F4\", tooltip = \"Roger Peng provides a good introduction to the dplyr R package\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"-0.75,4!\"] \n  \"5\" [label = \"📖 dplyr\", URL = \"https://bookdown.org/rdpeng/rprogdatascience/managing-data-frames-with-the-dplyr-package.html\", tooltip = \"Chapter 12 in Peng (2018) provides a nice introduction to dplyr\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkOrange4\", pos = \"0.75,4!\"] \n  \"6\" [label = \"💡 Working\\nwith data\", URL = \"https://app.datacamp.com/learn/courses/working-with-data-in-the-tidyverse\", tooltip = \"An alternative interactive DataCamp course is Working with Data in the Tidyverse which may be good to take if you need more training.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"2.5,4!\"] \n  \"7\" [label = \"\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"0.5\", fontname = \"Helvetica\", shape = \"rect\", height = \"1\", width = \"6\", fillcolor = \"#F0F8FF\", pos = \"1.9,-0.09!\"] \n  \"8\" [label = \"Color:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"0.8\", fillcolor = \"#FFFFFE\", pos = \"-0.73,0.25!\"] \n  \"9\" [label = \"mandatory\", URL = \"\", tooltip = \"Mandatory syllabus.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkSeaGreen4\", pos = \"-0.5,-0.15!\"] \n  \"10\" [label = \"alternative\", URL = \"\", tooltip = \"Alternative syllabus if you prefer another learning style.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkOrange4\", pos = \"0.5,-0.15!\"] \n  \"11\" [label = \"extra\", URL = \"\", tooltip = \"Extra learning if you are interested (not part of syllabus).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"PeachPuff3\", pos = \"1.5,-0.15!\"] \n  \"12\" [label = \"Shape:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"1\", fillcolor = \"#FFFFFE\", pos = \"2.7,0.25!\"] \n  \"13\" [label = \"non-interactive\", URL = \"\", tooltip = \"Non-interactive learning content (e.g. reading).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"1\", fillcolor = \"Grey40\", pos = \"3,-0.15!\"] \n  \"14\" [label = \"interactive\", URL = \"\", tooltip = \"Interactive learning content (tutorial, exercises etc.).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"egg\", width = \"1\", fillcolor = \"Grey40\", pos = \"4.25,-0.15!\"] \n\"1\"->\"2\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"4\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"5\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"6\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"3\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"6\" [color = \"black\", arrowhead = \"vee\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
```

<!-- * Roger Peng provides a good video giving an [Introduction to the dplyr R package][video-dplyr].  -->
<!-- * [Chapter 12](https://bookdown.org/rdpeng/rprogdatascience/managing-data-frames-with-the-dplyr-package.html) in @rdpeng provides a nice introduction to dplyr.  -->
<!-- * An alternative interactive DataCamp course is [Working with Data in the Tidyverse][datacamp-r-dplyr-bakeoff] which may be good to take if you need more training. -->



## Learning outcomes {#lo-r-transform}

By the end of this module, you are expected to be able to:

* Describe what tidy and wangling is.
* Apply the most common string functions.
* Apply tidy operations to data.
* Transform data.
* Clean data.

The learning outcomes relate to the [overall learning goals](#lg-course) number 7, 11-14 and 18 of the course.

<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->


## Working with data in the tidyverse {#r-transform-tidyverse}

An excellent introduction on how to transform data using the tidyverse is given in the interactive DataCamp course [Data Manipulation with dplyr][datacamp-r-dplyr]. Please complete the course before continuing. 

<!-- ## Tidy  -->


<!-- ## Wangling -->


<!-- https://learn.datacamp.com/projects/758 -->
<!-- https://learn.datacamp.com/courses/dealing-with-missing-data-in-r -->
<!-- https://learn.datacamp.com/courses/introduction-to-the-tidyverse -->


## Mutating joins {#r-transform-joins}

Mutating joins allow you to combine variables from multiple tables. There are four types of mutating join, which differ in their behavior when a match is not found. We'll illustrate each with a simple example:


```r
df1 <- tibble(x = c(1, 2), y = 2:1)
df2 <- tibble(x = c(3, 1), a = 10, b = "a")
df1
#> # A tibble: 2 × 2
#>       x     y
#>   <dbl> <int>
#> 1     1     2
#> 2     2     1
df2
#> # A tibble: 2 × 3
#>       x     a b    
#>   <dbl> <dbl> <chr>
#> 1     3    10 a    
#> 2     1    10 a
```

Note that column `x` is present in both tables and used when joining them.

  * `inner_join(df1, df2)` only includes observations that match in both `df1` and `df2`.
    
    
    ```r
    df1 %>% 
      inner_join(df2) 
    #> # A tibble: 1 × 4
    #>       x     y     a b    
    #>   <dbl> <int> <dbl> <chr>
    #> 1     1     2    10 a
    ```
    
  * `left_join(df1, df2)` includes all observations in `df1`, regardless of whether
    they match or not. This is the most commonly used join because it ensures 
    that you don't lose observations from your primary table.
  
    
    ```r
    df1 %>% 
      left_join(df2)
    #> # A tibble: 2 × 4
    #>       x     y     a b    
    #>   <dbl> <int> <dbl> <chr>
    #> 1     1     2    10 a    
    #> 2     2     1    NA <NA>
    ```
  
  * `right_join(df1, df2)` includes all observations in `df2`. It's equivalent to 
    `left_join(df2, df1)`, but the columns and rows will be ordered differently.
  
    
    ```r
    df1 %>% 
      right_join(df2)
    #> # A tibble: 2 × 4
    #>       x     y     a b    
    #>   <dbl> <int> <dbl> <chr>
    #> 1     1     2    10 a    
    #> 2     3    NA    10 a
    df2 %>% 
      left_join(df1)
    #> # A tibble: 2 × 4
    #>       x     a b         y
    #>   <dbl> <dbl> <chr> <int>
    #> 1     3    10 a        NA
    #> 2     1    10 a         2
    ```

  * `full_join()` includes all observations from `df1` and `df2`.

    
    ```r
    df1 %>% 
      full_join(df2)
    #> # A tibble: 3 × 4
    #>       x     y     a b    
    #>   <dbl> <int> <dbl> <chr>
    #> 1     1     2    10 a    
    #> 2     2     1    NA <NA> 
    #> 3     3    NA    10 a
    ```

The left, right and full joins are collectively know as __outer joins__. When a row doesn't match in an outer join, the new variables are filled in with missing values.

While mutating joins are primarily used to add new variables, they can also generate new observations. If a match is not unique, a join will add all possible combinations (the Cartesian product) of the matching observations:


```r
df1 <- tibble(x = c(1, 1, 2), y = 1:3)
df2 <- tibble(x = c(1, 1, 2), z = c("a", "b", "a"))
df1 %>% 
  left_join(df2)
#> # A tibble: 5 × 3
#>       x     y z    
#>   <dbl> <int> <chr>
#> 1     1     1 a    
#> 2     1     1 b    
#> 3     1     2 a    
#> 4     1     2 b    
#> 5     2     3 a
```

Filtering joins match observations in the same way as mutating joins, but affect the observations, not the variables. There are two types:

* `semi_join(df1, df2)` __keeps__ all observations in `df1` that have a match in `df2`.
* `anti_join(df1, df2)` __drops__ all observations in `df1` that have a match in `df2`.

These are most useful for diagnosing join mismatches. If you're worried about what observations your joins will match, start with a `semi_join()` or `anti_join()`. `semi_join()` and `anti_join()` never duplicate; they only remove observations. 


```r
df1 <- tibble(x = c(1, 1, 3, 4), y = 1:4)
df2 <- tibble(x = c(1, 1, 2), z = c("a", "b", "a"))

# Four rows to start with:
df1 %>% nrow()
#> [1] 4
# And we get four rows after the join
df1 %>% inner_join(df2, by = "x") %>% nrow()
#> [1] 4
# But only two rows actually match
df1 %>% semi_join(df2, by = "x") %>% nrow()
#> [1] 2
```


## Recap {#rc-r-transform}

* We consider transformation of tidy data where data are stored using a tibble (data frame) where each column is a variable, and each row is an observation/case.

* Tidy data is important because the consistent structure lets you focus your struggle on questions about the data. 

* Transformation includes narrowing in on observations of interest (e.g. only observations from a specific year or warehouse), creating new variables based on existing variables (like the cost of using the machine that day given idle time). 

* Tidying and transforming are called wrangling, because it can be a hard process to get your data in the right form.

* The package dplyr provides a consistent set of verbs that helps you solve the most common data manipulation challenges:
   - The `filter` function chooses rows (cases/observations) that meet a specific criteria. 
   - The `select` function chooses columns (variables) based on their names.
   - The `arrange` function reorders the rows. 
   - The `transmute` function adds/modifies columns (variables) and drops existing ones.
   - The `mutate` function adds/modifies columns (variables).
   - The `group_by` function groups variables for groupwise operations.
   - The `ungroup` function removes the current grouping.
   - The `count` function counts rows based on a grouping. 
   - The `summarise` function reduces multiple values down to a single summary.
   - The `distinct` function selects unique/distinct rows.
   - The `pull` function can be used to extract columns as vectors (it is similar to $).
   
* Some nice to know functions to use inside e.g. `summarise` or `mutate` are
   - The `n()` function counts the number of rows in a group.
   - The `n_distinct` counts the number of unique rows in a group.
   - The `first` function considers the first row in a group (remember to order it as needed).
   - The `slice_min` and `slice_max` functions select rows with highest or lowest values of a variable.
   - The `across` function makes it easy to apply the same transformation to multiple columns.
   
* Use `print(n = Inf)` in a pipe to print all rows.

* Use the pipe operator `%>%` to connect operations.  

* Use functions `glimpse`, `tail`, `head`, `View` to have a look at the data.

* The `skim` function in the skimr package provides an approach to summary statistics.

* Use `as.character`, `as.numeric`, etc. to convert data to a different type.

* Use `nrow` and `ncol` functions to get the number of rows and columns of the data.

* The 'Data transformation with dplyr' cheatsheet is very useful. Find the newest version in RStudio **Help > Cheatsheets**.

You may also have a look at the [slides for this module](https://bss-osca.github.io/tfa/slides/07-03_r-transform-slides.html).


## Exercises {#ex-r-transform}

Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the [help page](#help). Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution!

[Link to the project on RStudio Cloud for this module][r-cloud-mod17]. 

### Exercise (gapminder) {#ex-gapminder1}

Use the *exercise R markdown template* to solve this exercise (**File > New File > R Markdown...**, select **From template** and then **TFA Exercise**).

The gapminder data set provides values for life expectancy, GDP per capita, and population, every five years, from 1952 to 2007 for 142 countries. The data can be loaded using the gapminder package:


```r
library(gapminder)
gapminder
#> # A tibble: 1,704 × 6
#>    country     continent  year lifeExp      pop gdpPercap
#>    <fct>       <fct>     <int>   <dbl>    <int>     <dbl>
#>  1 Afghanistan Asia       1952    28.8  8425333      779.
#>  2 Afghanistan Asia       1957    30.3  9240934      821.
#>  3 Afghanistan Asia       1962    32.0 10267083      853.
#>  4 Afghanistan Asia       1967    34.0 11537966      836.
#>  5 Afghanistan Asia       1972    36.1 13079460      740.
#>  6 Afghanistan Asia       1977    38.4 14880372      786.
#>  7 Afghanistan Asia       1982    39.9 12881816      978.
#>  8 Afghanistan Asia       1987    40.8 13867957      852.
#>  9 Afghanistan Asia       1992    41.7 16317921      649.
#> 10 Afghanistan Asia       1997    41.8 22227415      635.
#> # … with 1,694 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```

Let us try to examine the dataset (use pipes `%>%` as much as possible). 


<div class="modal fade bs-example-modal-lg" id="UL4uDIeZy6XusumA77Qm" tabindex="-1" role="dialog" aria-labelledby="UL4uDIeZy6XusumA77Qm-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="UL4uDIeZy6XusumA77Qm-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% glimpse()
#> Rows: 1,704
#> Columns: 6
#> $ country   <fct> "Afghanistan", "Afghanistan", "Afghanistan", "Afghanistan", "Afghanistan", "Afgh…
#> $ continent <fct> Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Europe, …
#> $ year      <int> 1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 1992, 1997, 2002, 2007, 1952, 19…
#> $ lifeExp   <dbl> 28.8, 30.3, 32.0, 34.0, 36.1, 38.4, 39.9, 40.8, 41.7, 41.8, 42.1, 43.8, 55.2, 59…
#> $ pop       <int> 8425333, 9240934, 10267083, 11537966, 13079460, 14880372, 12881816, 13867957, 16…
#> $ gdpPercap <dbl> 779, 821, 853, 836, 740, 786, 978, 852, 649, 635, 727, 975, 1601, 1942, 2313, 27…
gapminder %>% summary()
#>         country        continent        year         lifeExp          pop          
#>  Afghanistan:  12   Africa  :624   Min.   :1952   Min.   :23.6   Min.   :6.00e+04  
#>  Albania    :  12   Americas:300   1st Qu.:1966   1st Qu.:48.2   1st Qu.:2.79e+06  
#>  Algeria    :  12   Asia    :396   Median :1980   Median :60.7   Median :7.02e+06  
#>  Angola     :  12   Europe  :360   Mean   :1980   Mean   :59.5   Mean   :2.96e+07  
#>  Argentina  :  12   Oceania : 24   3rd Qu.:1993   3rd Qu.:70.8   3rd Qu.:1.96e+07  
#>  Australia  :  12                  Max.   :2007   Max.   :82.6   Max.   :1.32e+09  
#>  (Other)    :1632                                                                  
#>    gdpPercap     
#>  Min.   :   241  
#>  1st Qu.:  1202  
#>  Median :  3532  
#>  Mean   :  7215  
#>  3rd Qu.:  9325  
#>  Max.   :113523  
#> 
gapminder %>% tail()
#> # A tibble: 6 × 6
#>   country  continent  year lifeExp      pop gdpPercap
#>   <fct>    <fct>     <int>   <dbl>    <int>     <dbl>
#> 1 Zimbabwe Africa     1982    60.4  7636524      789.
#> 2 Zimbabwe Africa     1987    62.4  9216418      706.
#> 3 Zimbabwe Africa     1992    60.4 10704340      693.
#> 4 Zimbabwe Africa     1997    46.8 11404948      792.
#> 5 Zimbabwe Africa     2002    40.0 11926563      672.
#> 6 Zimbabwe Africa     2007    43.5 12311143      470.
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#UL4uDIeZy6XusumA77Qm">Solution</button>

   (@) Use `glimpse`, `summary` and `tail` to examine the data.

   (@) Use `count` to count the number of
   

<div class="modal fade bs-example-modal-lg" id="uQoTglgqJB50tn46AWj7" tabindex="-1" role="dialog" aria-labelledby="uQoTglgqJB50tn46AWj7-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="uQoTglgqJB50tn46AWj7-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  count(country) %>% 
  nrow()
#> [1] 142
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#uQoTglgqJB50tn46AWj7">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a) countries, 
       

<div class="modal fade bs-example-modal-lg" id="6YIR7vjSfHfNfPiHjZ1M" tabindex="-1" role="dialog" aria-labelledby="6YIR7vjSfHfNfPiHjZ1M-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="6YIR7vjSfHfNfPiHjZ1M-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  count(continent) %>% 
  nrow()
#> [1] 5
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#6YIR7vjSfHfNfPiHjZ1M">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b) continents,
       

<div class="modal fade bs-example-modal-lg" id="RPXrl47JJj8yqat0mu6S" tabindex="-1" role="dialog" aria-labelledby="RPXrl47JJj8yqat0mu6S-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="RPXrl47JJj8yqat0mu6S-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  count(continent, country) %>% 
  count(continent)     # or
#> # A tibble: 5 × 2
#>   continent     n
#>   <fct>     <int>
#> 1 Africa       52
#> 2 Americas     25
#> 3 Asia         33
#> 4 Europe       30
#> 5 Oceania       2
gapminder %>% 
  distinct(continent, country) %>% 
  count(continent)
#> # A tibble: 5 × 2
#>   continent     n
#>   <fct>     <int>
#> 1 Africa       52
#> 2 Americas     25
#> 3 Asia         33
#> 4 Europe       30
#> 5 Oceania       2
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#RPXrl47JJj8yqat0mu6S">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c) countries per continent. 



   

<div class="modal fade bs-example-modal-lg" id="fSsOZeHt8YF4lbKuawtN" tabindex="-1" role="dialog" aria-labelledby="fSsOZeHt8YF4lbKuawtN-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="fSsOZeHt8YF4lbKuawtN-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  distinct(continent) %>% 
  pull(continent) %>% 
  as.character()
#> [1] "Asia"     "Europe"   "Africa"   "Americas" "Oceania"
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#fSsOZeHt8YF4lbKuawtN">Solution</button>

<div class="modal fade bs-example-modal-lg" id="ipu82zOiWNis7MmDcNbZ" tabindex="-1" role="dialog" aria-labelledby="ipu82zOiWNis7MmDcNbZ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="ipu82zOiWNis7MmDcNbZ-title">Hint</h4></div><div class="modal-body">

```r
gapminder %>% 
  distinct(___) %>% 
  pull(___) %>% 
  as.character()
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ipu82zOiWNis7MmDcNbZ">Hint</button>

   (@) Retrieve a vector with all distinct continent values.

   
   
   (@) Subset rows to find:
   

<div class="modal fade bs-example-modal-lg" id="hoSMpVjqRPqjchkGHCwG" tabindex="-1" role="dialog" aria-labelledby="hoSMpVjqRPqjchkGHCwG-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="hoSMpVjqRPqjchkGHCwG-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(lifeExp < 29)
#> # A tibble: 2 × 6
#>   country     continent  year lifeExp     pop gdpPercap
#>   <fct>       <fct>     <int>   <dbl>   <int>     <dbl>
#> 1 Afghanistan Asia       1952    28.8 8425333      779.
#> 2 Rwanda      Africa     1992    23.6 7290203      737.
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#hoSMpVjqRPqjchkGHCwG">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a) all rows with life expectancy less that 29 years,



<div class="modal fade bs-example-modal-lg" id="U2nPSvOkmC3Kglev0Nd6" tabindex="-1" role="dialog" aria-labelledby="U2nPSvOkmC3Kglev0Nd6-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="U2nPSvOkmC3Kglev0Nd6-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(country == "Rwanda", year > 1979)
#> # A tibble: 6 × 6
#>   country continent  year lifeExp     pop gdpPercap
#>   <fct>   <fct>     <int>   <dbl>   <int>     <dbl>
#> 1 Rwanda  Africa     1982    46.2 5507565      882.
#> 2 Rwanda  Africa     1987    44.0 6349365      848.
#> 3 Rwanda  Africa     1992    23.6 7290203      737.
#> 4 Rwanda  Africa     1997    36.1 7212583      590.
#> 5 Rwanda  Africa     2002    43.4 7852401      786.
#> 6 Rwanda  Africa     2007    46.2 8860588      863.
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#U2nPSvOkmC3Kglev0Nd6">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b) all rows for Rwanda after year 1979,



<div class="modal fade bs-example-modal-lg" id="09kqKGFxUhubGui2dq7x" tabindex="-1" role="dialog" aria-labelledby="09kqKGFxUhubGui2dq7x-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="09kqKGFxUhubGui2dq7x-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>%  
  filter(country %in% c("Rwanda", "Afghanistan", "France"))
#> # A tibble: 36 × 6
#>    country     continent  year lifeExp      pop gdpPercap
#>    <fct>       <fct>     <int>   <dbl>    <int>     <dbl>
#>  1 Afghanistan Asia       1952    28.8  8425333      779.
#>  2 Afghanistan Asia       1957    30.3  9240934      821.
#>  3 Afghanistan Asia       1962    32.0 10267083      853.
#>  4 Afghanistan Asia       1967    34.0 11537966      836.
#>  5 Afghanistan Asia       1972    36.1 13079460      740.
#>  6 Afghanistan Asia       1977    38.4 14880372      786.
#>  7 Afghanistan Asia       1982    39.9 12881816      978.
#>  8 Afghanistan Asia       1987    40.8 13867957      852.
#>  9 Afghanistan Asia       1992    41.7 16317921      649.
#> 10 Afghanistan Asia       1997    41.8 22227415      635.
#> # … with 26 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#09kqKGFxUhubGui2dq7x">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c) all rows for Rwanda, Afghanistan or France.



   (@) Select columns 
   

<div class="modal fade bs-example-modal-lg" id="2A1OheU5yYiHnduOJjhQ" tabindex="-1" role="dialog" aria-labelledby="2A1OheU5yYiHnduOJjhQ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="2A1OheU5yYiHnduOJjhQ-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  select(year, lifeExp)
#> # A tibble: 1,704 × 2
#>     year lifeExp
#>    <int>   <dbl>
#>  1  1952    28.8
#>  2  1957    30.3
#>  3  1962    32.0
#>  4  1967    34.0
#>  5  1972    36.1
#>  6  1977    38.4
#>  7  1982    39.9
#>  8  1987    40.8
#>  9  1992    41.7
#> 10  1997    41.8
#> # … with 1,694 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#2A1OheU5yYiHnduOJjhQ">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a) year and life expectancy,
    


<div class="modal fade bs-example-modal-lg" id="oIudmifhBblEg5jwffQ8" tabindex="-1" role="dialog" aria-labelledby="oIudmifhBblEg5jwffQ8-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="oIudmifhBblEg5jwffQ8-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  select(country, gdpPercap)
#> # A tibble: 1,704 × 2
#>    country     gdpPercap
#>    <fct>           <dbl>
#>  1 Afghanistan      779.
#>  2 Afghanistan      821.
#>  3 Afghanistan      853.
#>  4 Afghanistan      836.
#>  5 Afghanistan      740.
#>  6 Afghanistan      786.
#>  7 Afghanistan      978.
#>  8 Afghanistan      852.
#>  9 Afghanistan      649.
#> 10 Afghanistan      635.
#> # … with 1,694 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#oIudmifhBblEg5jwffQ8">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b) country and GDP per capita.
    
      


<div class="modal fade bs-example-modal-lg" id="T5kMZNCXNr53AwRf2T2c" tabindex="-1" role="dialog" aria-labelledby="T5kMZNCXNr53AwRf2T2c-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="T5kMZNCXNr53AwRf2T2c-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
   filter((gdpPercap > 40000 & continent == "Europe") | (gdpPercap < 400 & continent == "Africa")) %>% 
   # print(n=Inf) %>%   # if want to see the intermediate results
   select(continent, country, gdpPercap) # %>% print(n=Inf)
#> # A tibble: 21 × 3
#>    continent country           gdpPercap
#>    <fct>     <fct>                 <dbl>
#>  1 Africa    Burundi                339.
#>  2 Africa    Burundi                380.
#>  3 Africa    Burundi                355.
#>  4 Africa    Congo, Dem. Rep.       312.
#>  5 Africa    Congo, Dem. Rep.       241.
#>  6 Africa    Congo, Dem. Rep.       278.
#>  7 Africa    Equatorial Guinea      376.
#>  8 Africa    Eritrea                329.
#>  9 Africa    Eritrea                344.
#> 10 Africa    Eritrea                381.
#> # … with 11 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#T5kMZNCXNr53AwRf2T2c">Solution</button>

<div class="modal fade bs-example-modal-lg" id="rCHr1mS4uBkQfBs3DGlN" tabindex="-1" role="dialog" aria-labelledby="rCHr1mS4uBkQfBs3DGlN-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="rCHr1mS4uBkQfBs3DGlN-title">Hint</h4></div><div class="modal-body">

```r
gapminder %>% 
   filter((gdpPercap > ___ & continent == ___) | (___)) %>% 
   # print(n=Inf) %>%   # if want to see the intermediate results
   select(continent, ___, ___) # %>% print(n=Inf)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#rCHr1mS4uBkQfBs3DGlN">Hint</button>

   (@) Subset your data set to find all rows with GDP per capita greater than 40000 in Europe or with GDP per capita less than 500 in Africa.





<div class="modal fade bs-example-modal-lg" id="H4VRz8p1mE8BDvzJ8eaL" tabindex="-1" role="dialog" aria-labelledby="H4VRz8p1mE8BDvzJ8eaL-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="H4VRz8p1mE8BDvzJ8eaL-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>%
  mutate(gdp = pop * gdpPercap)
#> # A tibble: 1,704 × 7
#>    country     continent  year lifeExp      pop gdpPercap          gdp
#>    <fct>       <fct>     <int>   <dbl>    <int>     <dbl>        <dbl>
#>  1 Afghanistan Asia       1952    28.8  8425333      779.  6567086330.
#>  2 Afghanistan Asia       1957    30.3  9240934      821.  7585448670.
#>  3 Afghanistan Asia       1962    32.0 10267083      853.  8758855797.
#>  4 Afghanistan Asia       1967    34.0 11537966      836.  9648014150.
#>  5 Afghanistan Asia       1972    36.1 13079460      740.  9678553274.
#>  6 Afghanistan Asia       1977    38.4 14880372      786. 11697659231.
#>  7 Afghanistan Asia       1982    39.9 12881816      978. 12598563401.
#>  8 Afghanistan Asia       1987    40.8 13867957      852. 11820990309.
#>  9 Afghanistan Asia       1992    41.7 16317921      649. 10595901589.
#> 10 Afghanistan Asia       1997    41.8 22227415      635. 14121995875.
#> # … with 1,694 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#H4VRz8p1mE8BDvzJ8eaL">Solution</button>

   (@) Use `mutate` to calculate each country's GDP (population times GDP per capita).



In general GDP numbers are large and abstract. Let us try to calculate relative numbers.



<div class="modal fade bs-example-modal-lg" id="oHq8r4QgCwNcBejUrpyf" tabindex="-1" role="dialog" aria-labelledby="oHq8r4QgCwNcBejUrpyf-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="oHq8r4QgCwNcBejUrpyf-title">Solution</h4></div><div class="modal-body">

```r
mean_dk <- gapminder %>% 
  filter(country == "Denmark") %>% 
  pull(gdpPercap) %>% 
  mean()
dat <- gapminder %>% 
  mutate(gdpPercapRel = gdpPercap/mean_dk)
```


<p>The relative GDP per capita numbers are, in general, well below 1. We see that most of the countries covered by this dataset have substantially lower GDP per capita, relative to Denmark, across the entire time period.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#oHq8r4QgCwNcBejUrpyf">Solution</button>

<div class="modal fade bs-example-modal-lg" id="d2B2qQo9Pi3KmqrxNwhQ" tabindex="-1" role="dialog" aria-labelledby="d2B2qQo9Pi3KmqrxNwhQ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="d2B2qQo9Pi3KmqrxNwhQ-title">Hint 2</h4></div><div class="modal-body">

```r
dat <- gapminder %>% 
  mutate(gdpPercapRel = ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#d2B2qQo9Pi3KmqrxNwhQ">Hint 2</button>

<div class="modal fade bs-example-modal-lg" id="ODkRS5MtX1O7HiNdUoaA" tabindex="-1" role="dialog" aria-labelledby="ODkRS5MtX1O7HiNdUoaA-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="ODkRS5MtX1O7HiNdUoaA-title">Hint 1</h4></div><div class="modal-body">

```r
mean_dk <- gapminder %>% 
  filter(country == "Denmark") %>% 
  pull(___) %>% 
  mean()
```


<p>First you must calculate the mean of Danish <code>gdpPercap</code> and next use that to add a new column <code>gdpPercapRel</code>.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ODkRS5MtX1O7HiNdUoaA">Hint 1</button>

   (@) Use `mutate` to calculate GDP per capita relative to mean GDP per capita in Denmark over the whole period (`gdpPercap` divided by the mean of Danish `gdpPercap`). Have a look at the calculated data. Does the numbers seem reasonable? I perceive Denmark to be a "high GDP" country, so I predict that the distribution of `gdpPercapRel` is located below 1, possibly even well below. 




   (@) Use `arrange` to order 
   

<div class="modal fade bs-example-modal-lg" id="w35qQijzx8f2UnNweQpn" tabindex="-1" role="dialog" aria-labelledby="w35qQijzx8f2UnNweQpn-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="w35qQijzx8f2UnNweQpn-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  arrange(year, country)
#> # A tibble: 1,704 × 6
#>    country     continent  year lifeExp      pop gdpPercap
#>    <fct>       <fct>     <int>   <dbl>    <int>     <dbl>
#>  1 Afghanistan Asia       1952    28.8  8425333      779.
#>  2 Albania     Europe     1952    55.2  1282697     1601.
#>  3 Algeria     Africa     1952    43.1  9279525     2449.
#>  4 Angola      Africa     1952    30.0  4232095     3521.
#>  5 Argentina   Americas   1952    62.5 17876956     5911.
#>  6 Australia   Oceania    1952    69.1  8691212    10040.
#>  7 Austria     Europe     1952    66.8  6927772     6137.
#>  8 Bahrain     Asia       1952    50.9   120447     9867.
#>  9 Bangladesh  Asia       1952    37.5 46886859      684.
#> 10 Belgium     Europe     1952    68    8730405     8343.
#> # … with 1,694 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#w35qQijzx8f2UnNweQpn">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a) data by year then country, as opposed to current by country then year,



<div class="modal fade bs-example-modal-lg" id="QKZradlgr5bETHuOZ5wj" tabindex="-1" role="dialog" aria-labelledby="QKZradlgr5bETHuOZ5wj-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="QKZradlgr5bETHuOZ5wj-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>%
  filter(year == 2007) %>%
  arrange(lifeExp)
#> # A tibble: 142 × 6
#>    country                  continent  year lifeExp      pop gdpPercap
#>    <fct>                    <fct>     <int>   <dbl>    <int>     <dbl>
#>  1 Swaziland                Africa     2007    39.6  1133066     4513.
#>  2 Mozambique               Africa     2007    42.1 19951656      824.
#>  3 Zambia                   Africa     2007    42.4 11746035     1271.
#>  4 Sierra Leone             Africa     2007    42.6  6144562      863.
#>  5 Lesotho                  Africa     2007    42.6  2012649     1569.
#>  6 Angola                   Africa     2007    42.7 12420476     4797.
#>  7 Zimbabwe                 Africa     2007    43.5 12311143      470.
#>  8 Afghanistan              Asia       2007    43.8 31889923      975.
#>  9 Central African Republic Africa     2007    44.7  4369038      706.
#> 10 Liberia                  Africa     2007    45.7  3193942      415.
#> # … with 132 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#QKZradlgr5bETHuOZ5wj">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b) data from 2007, sorted on life expectancy,



<div class="modal fade bs-example-modal-lg" id="TBjc33SBUyDi9Wp7oF6A" tabindex="-1" role="dialog" aria-labelledby="TBjc33SBUyDi9Wp7oF6A-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="TBjc33SBUyDi9Wp7oF6A-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>%
  filter(year == 2007) %>%
  arrange(desc(lifeExp))
#> # A tibble: 142 × 6
#>    country          continent  year lifeExp       pop gdpPercap
#>    <fct>            <fct>     <int>   <dbl>     <int>     <dbl>
#>  1 Japan            Asia       2007    82.6 127467972    31656.
#>  2 Hong Kong, China Asia       2007    82.2   6980412    39725.
#>  3 Iceland          Europe     2007    81.8    301931    36181.
#>  4 Switzerland      Europe     2007    81.7   7554661    37506.
#>  5 Australia        Oceania    2007    81.2  20434176    34435.
#>  6 Spain            Europe     2007    80.9  40448191    28821.
#>  7 Sweden           Europe     2007    80.9   9031088    33860.
#>  8 Israel           Asia       2007    80.7   6426679    25523.
#>  9 France           Europe     2007    80.7  61083916    30470.
#> 10 Canada           Americas   2007    80.7  33390141    36319.
#> # … with 132 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#TBjc33SBUyDi9Wp7oF6A">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c) data from 2007, sorted on life expectancy in **desc**ending order. Hint: use `desc()` inside `arrange`.
 


   (@) Use `select` to 
   

<div class="modal fade bs-example-modal-lg" id="fg8y9whZFLqvVthQIx7g" tabindex="-1" role="dialog" aria-labelledby="fg8y9whZFLqvVthQIx7g-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="fg8y9whZFLqvVthQIx7g-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  select(yr = year, everything())
#> # A tibble: 1,704 × 6
#>       yr country     continent lifeExp      pop gdpPercap
#>    <int> <fct>       <fct>       <dbl>    <int>     <dbl>
#>  1  1952 Afghanistan Asia         28.8  8425333      779.
#>  2  1957 Afghanistan Asia         30.3  9240934      821.
#>  3  1962 Afghanistan Asia         32.0 10267083      853.
#>  4  1967 Afghanistan Asia         34.0 11537966      836.
#>  5  1972 Afghanistan Asia         36.1 13079460      740.
#>  6  1977 Afghanistan Asia         38.4 14880372      786.
#>  7  1982 Afghanistan Asia         39.9 12881816      978.
#>  8  1987 Afghanistan Asia         40.8 13867957      852.
#>  9  1992 Afghanistan Asia         41.7 16317921      649.
#> 10  1997 Afghanistan Asia         41.8 22227415      635.
#> # … with 1,694 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#fg8y9whZFLqvVthQIx7g">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a) rename `year` to `yr` and keep all other columns (the select helper `everything` may be used),
 
 

<div class="modal fade bs-example-modal-lg" id="oDaAPEWfuKFJE7Gv3Vnp" tabindex="-1" role="dialog" aria-labelledby="oDaAPEWfuKFJE7Gv3Vnp-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="oDaAPEWfuKFJE7Gv3Vnp-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  select(-pop)
#> # A tibble: 1,704 × 5
#>    country     continent  year lifeExp gdpPercap
#>    <fct>       <fct>     <int>   <dbl>     <dbl>
#>  1 Afghanistan Asia       1952    28.8      779.
#>  2 Afghanistan Asia       1957    30.3      821.
#>  3 Afghanistan Asia       1962    32.0      853.
#>  4 Afghanistan Asia       1967    34.0      836.
#>  5 Afghanistan Asia       1972    36.1      740.
#>  6 Afghanistan Asia       1977    38.4      786.
#>  7 Afghanistan Asia       1982    39.9      978.
#>  8 Afghanistan Asia       1987    40.8      852.
#>  9 Afghanistan Asia       1992    41.7      649.
#> 10 Afghanistan Asia       1997    41.8      635.
#> # … with 1,694 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#oDaAPEWfuKFJE7Gv3Vnp">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b) remove `pop`,
  


<div class="modal fade bs-example-modal-lg" id="ZEa8T5IfCOnE4mfVDBb2" tabindex="-1" role="dialog" aria-labelledby="ZEa8T5IfCOnE4mfVDBb2-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="ZEa8T5IfCOnE4mfVDBb2-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  select(year, pop, everything())
#> # A tibble: 1,704 × 6
#>     year      pop country     continent lifeExp gdpPercap
#>    <int>    <int> <fct>       <fct>       <dbl>     <dbl>
#>  1  1952  8425333 Afghanistan Asia         28.8      779.
#>  2  1957  9240934 Afghanistan Asia         30.3      821.
#>  3  1962 10267083 Afghanistan Asia         32.0      853.
#>  4  1967 11537966 Afghanistan Asia         34.0      836.
#>  5  1972 13079460 Afghanistan Asia         36.1      740.
#>  6  1977 14880372 Afghanistan Asia         38.4      786.
#>  7  1982 12881816 Afghanistan Asia         39.9      978.
#>  8  1987 13867957 Afghanistan Asia         40.8      852.
#>  9  1992 16317921 Afghanistan Asia         41.7      649.
#> 10  1997 22227415 Afghanistan Asia         41.8      635.
#> # … with 1,694 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ZEa8T5IfCOnE4mfVDBb2">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c) reorder columns in order `year`, `pop`, ... (remaining).


  (@) Use `group_by` and `summarize` to find the
  
  

<div class="modal fade bs-example-modal-lg" id="EpI0x5kp0qYLKd7JalYg" tabindex="-1" role="dialog" aria-labelledby="EpI0x5kp0qYLKd7JalYg-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="EpI0x5kp0qYLKd7JalYg-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  group_by(continent) %>% 
  summarize(n = n())
#> # A tibble: 5 × 2
#>   continent     n
#>   <fct>     <int>
#> 1 Africa      624
#> 2 Americas    300
#> 3 Asia        396
#> 4 Europe      360
#> 5 Oceania      24
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#EpI0x5kp0qYLKd7JalYg">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a) number of observations per continent,
     


<div class="modal fade bs-example-modal-lg" id="Nuyl0WnCNXkKKQHc2bP2" tabindex="-1" role="dialog" aria-labelledby="Nuyl0WnCNXkKKQHc2bP2-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Nuyl0WnCNXkKKQHc2bP2-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  group_by(continent) %>% 
  summarize(n = n(), n_countries = n_distinct(country))
#> # A tibble: 5 × 3
#>   continent     n n_countries
#>   <fct>     <int>       <int>
#> 1 Africa      624          52
#> 2 Americas    300          25
#> 3 Asia        396          33
#> 4 Europe      360          30
#> 5 Oceania      24           2
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Nuyl0WnCNXkKKQHc2bP2">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b) number of countries per continent (use `n_distinct` inside `summarize` to count the number of distinct observations),



<div class="modal fade bs-example-modal-lg" id="zcqOxNo0s4oagiHfIZ3L" tabindex="-1" role="dialog" aria-labelledby="zcqOxNo0s4oagiHfIZ3L-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="zcqOxNo0s4oagiHfIZ3L-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  group_by(continent) %>% 
  summarize(avg_lifeExp = mean(lifeExp))
#> # A tibble: 5 × 2
#>   continent avg_lifeExp
#>   <fct>           <dbl>
#> 1 Africa           48.9
#> 2 Americas         64.7
#> 3 Asia             60.1
#> 4 Europe           71.9
#> 5 Oceania          74.3
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#zcqOxNo0s4oagiHfIZ3L">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c) average life expectancy by continent,
     


<div class="modal fade bs-example-modal-lg" id="UWoVqaXcIZzvlqvbMkU0" tabindex="-1" role="dialog" aria-labelledby="UWoVqaXcIZzvlqvbMkU0-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="UWoVqaXcIZzvlqvbMkU0-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(continent == "Asia") %>% 
  group_by(year) %>% 
  summarize(min_lifeExp = min(lifeExp), max_lifeExp = max(lifeExp))
#> # A tibble: 12 × 3
#>     year min_lifeExp max_lifeExp
#>    <int>       <dbl>       <dbl>
#>  1  1952        28.8        65.4
#>  2  1957        30.3        67.8
#>  3  1962        32.0        69.4
#>  4  1967        34.0        71.4
#>  5  1972        36.1        73.4
#>  6  1977        31.2        75.4
#>  7  1982        39.9        77.1
#>  8  1987        40.8        78.7
#>  9  1992        41.7        79.4
#> 10  1997        41.8        80.7
#> 11  2002        42.1        82  
#> 12  2007        43.8        82.6
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#UWoVqaXcIZzvlqvbMkU0">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d) minimum and maximum life expectancies seen by year in Asia.

      


<div class="modal fade bs-example-modal-lg" id="fPx8NtnV1FIf6xrHQLLI" tabindex="-1" role="dialog" aria-labelledby="fPx8NtnV1FIf6xrHQLLI-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="fPx8NtnV1FIf6xrHQLLI-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  group_by(country) %>%                 # group by country
  select(country, year, lifeExp) %>%    # select relevant columns
  arrange(year, .by_group = TRUE) %>%   # make sure that data is sorted correct
  mutate(lifeExp_gain = lifeExp - first(lifeExp)) %>%       
  filter(year < 1963)                   # just for nice printing
#> # A tibble: 426 × 4
#> # Groups:   country [142]
#>    country      year lifeExp lifeExp_gain
#>    <fct>       <int>   <dbl>        <dbl>
#>  1 Afghanistan  1952    28.8         0   
#>  2 Afghanistan  1957    30.3         1.53
#>  3 Afghanistan  1962    32.0         3.20
#>  4 Albania      1952    55.2         0   
#>  5 Albania      1957    59.3         4.05
#>  6 Albania      1962    64.8         9.59
#>  7 Algeria      1952    43.1         0   
#>  8 Algeria      1957    45.7         2.61
#>  9 Algeria      1962    48.3         5.23
#> 10 Angola       1952    30.0         0   
#> # … with 416 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#fPx8NtnV1FIf6xrHQLLI">Solution</button>

<div class="modal fade bs-example-modal-lg" id="uHroBEfT69JbwQv6rGHA" tabindex="-1" role="dialog" aria-labelledby="uHroBEfT69JbwQv6rGHA-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="uHroBEfT69JbwQv6rGHA-title">Hint</h4></div><div class="modal-body">

```r
gapminder %>% 
  group_by(country) %>%                 # group by country
  select(country, year, lifeExp) %>%    # select relevant columns
  arrange(year, .by_group = TRUE) %>%   # make sure that data is sorted correct
  mutate(lifeExp_gain = ___) %>%        # define new variable
  filter(year < 1963)                   # just for nice printing
```


<p>The <code>first</code> function may be helpful to extract the first value from a vector in each group.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#uHroBEfT69JbwQv6rGHA">Hint</button>

  (@) Sometimes you do not want to collapse the $n$ rows for each group into one row. That is, you do not want to use `summarize` but `mutate` within your groups. Try to make a new variable that is the years of life expectancy gained (lost) relative to 1952, for each individual country. 
      
      



<div class="modal fade bs-example-modal-lg" id="167Cp0Nu0JQYvWjcCV3m" tabindex="-1" role="dialog" aria-labelledby="167Cp0Nu0JQYvWjcCV3m-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="167Cp0Nu0JQYvWjcCV3m-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>%
  select(country, year, continent, lifeExp) %>%     
  group_by(continent, country) %>%                  
  mutate(le_delta = lifeExp - lag(lifeExp)) %>%
  summarize(worst_le_delta = min(le_delta, na.rm = TRUE)) %>%
  slice_min(worst_le_delta) %>%
  arrange(worst_le_delta)
#> # A tibble: 5 × 3
#> # Groups:   continent [5]
#>   continent country     worst_le_delta
#>   <fct>     <fct>                <dbl>
#> 1 Africa    Rwanda             -20.4  
#> 2 Asia      Cambodia            -9.10 
#> 3 Americas  El Salvador         -1.51 
#> 4 Europe    Montenegro          -1.46 
#> 5 Oceania   Australia            0.170
```


<p>Mostly you are seeing what genocide looks like in dry statistics on average life expectancy.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#167Cp0Nu0JQYvWjcCV3m">Solution</button>

<div class="modal fade bs-example-modal-lg" id="CrVFo41aqSVCiX3pFWK6" tabindex="-1" role="dialog" aria-labelledby="CrVFo41aqSVCiX3pFWK6-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="CrVFo41aqSVCiX3pFWK6-title">Hint</h4></div><div class="modal-body">

```r
gapminder %>%
  select(country, year, continent, lifeExp) %>%             # select relevant columns
  group_by(continent, country) %>%                          # group
  mutate(le_delta = ___) %>%                                # within country, take (lifeExp in year i) - (lifeExp in year i - 1)
  summarize(worst_le_delta = min(___, na.rm = TRUE)) %>%    # find lowest value
  slice_min(worst_le_delta) %>%                             # find min in each continent
  arrange(worst_le_delta)                                   # arrange 
```


<p>The <code>lag</code> function is useful to select the value in the previous row. Positive values of <code>le_delta</code> means lifeExp went up, negative means it went down. Break the code into pieces, starting at the top, and inspect the intermediate results. These commands are built up gradually, with lots of errors and refinements along the way.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#CrVFo41aqSVCiX3pFWK6">Hint</button>
      
  (@) Which country experienced the sharpest 5-year drop in life expectancy in each continent? Recall that the Gapminder data only has data every five years, e.g. for 1952, 1957, etc. So this really means looking at life expectancy changes between adjacent timepoints. 

      
      



### Exercise (babynames) {#ex-babynames1}

Use the *exercise R markdown template* to solve this exercise (**File > New File > R Markdown...**, select **From template** and then **TFA Exercise**).

The package babynames contains the dataset `babynames` provided by the U.S. Social Security Administration. For each year from 1880 to 2017, the number of children of each sex given each name. All names with more than 5 uses are given (source: http://www.ssa.gov/oact/babynames/limits.html).

Install it using 

```r
install.packages("babynames")
```

We will use the skimr package to get an overview over `babynames`:


```r
library(babynames)
library(skimr)
skim(babynames)
```


<table style='width: auto;'
      class='table table-condensed'>
<caption>(\#tab:unnamed-chunk-339)Data summary</caption>
<tbody>
  <tr>
   <td style="text-align:left;"> Name </td>
   <td style="text-align:left;"> babynames </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Number of rows </td>
   <td style="text-align:left;"> 1924665 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Number of columns </td>
   <td style="text-align:left;"> 5 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> _______________________ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Column type frequency: </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> character </td>
   <td style="text-align:left;"> 2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> numeric </td>
   <td style="text-align:left;"> 3 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ________________________ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Group variables </td>
   <td style="text-align:left;"> None </td>
  </tr>
</tbody>
</table>


**Variable type: character**

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> skim_variable </th>
   <th style="text-align:right;"> n_missing </th>
   <th style="text-align:right;"> complete_rate </th>
   <th style="text-align:right;"> min </th>
   <th style="text-align:right;"> max </th>
   <th style="text-align:right;"> empty </th>
   <th style="text-align:right;"> n_unique </th>
   <th style="text-align:right;"> whitespace </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> sex </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> name </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 15 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 97310 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
</tbody>
</table>


**Variable type: numeric**

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> skim_variable </th>
   <th style="text-align:right;"> n_missing </th>
   <th style="text-align:right;"> complete_rate </th>
   <th style="text-align:right;"> mean </th>
   <th style="text-align:right;"> sd </th>
   <th style="text-align:right;"> p0 </th>
   <th style="text-align:right;"> p25 </th>
   <th style="text-align:right;"> p50 </th>
   <th style="text-align:right;"> p75 </th>
   <th style="text-align:right;"> p100 </th>
   <th style="text-align:left;"> hist </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> year </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1975 </td>
   <td style="text-align:right;"> 34 </td>
   <td style="text-align:right;"> 1880 </td>
   <td style="text-align:right;"> 1951 </td>
   <td style="text-align:right;"> 1985 </td>
   <td style="text-align:right;"> 2003 </td>
   <td style="text-align:right;"> 2017.00 </td>
   <td style="text-align:left;"> ▁▂▃▅▇ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> n </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 181 </td>
   <td style="text-align:right;"> 1533 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;"> 32 </td>
   <td style="text-align:right;"> 99686.00 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> prop </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.08 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
</tbody>
</table>


<div class="modal fade bs-example-modal-lg" id="qcq7fbwZIvqQUlFooPu4" tabindex="-1" role="dialog" aria-labelledby="qcq7fbwZIvqQUlFooPu4-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="qcq7fbwZIvqQUlFooPu4-title">Solution</h4></div><div class="modal-body">

<p>The last line only selects the <code>n</code> column.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#qcq7fbwZIvqQUlFooPu4">Solution</button>

  1) Which of these is NOT a way to select the `name` and `n` columns together?
  
      ```r
      select(babynames, -c(year, sex, prop))
      select(babynames, name:n)
      select(babynames, starts_with("n"))
      select(babynames, ends_with("n"))
      ```
  
  2) Use `filter` and the logical operators to find:
  

<div class="modal fade bs-example-modal-lg" id="oUIcJeuZdPnrMUtSCfje" tabindex="-1" role="dialog" aria-labelledby="oUIcJeuZdPnrMUtSCfje-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="oUIcJeuZdPnrMUtSCfje-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  filter(prop >= 0.08)
#> # A tibble: 3 × 5
#>    year sex   name        n   prop
#>   <dbl> <chr> <chr>   <int>  <dbl>
#> 1  1880 M     John     9655 0.0815
#> 2  1880 M     William  9532 0.0805
#> 3  1881 M     John     8769 0.0810
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#oUIcJeuZdPnrMUtSCfje">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a) all of the names where prop is greater than or equal to 0.08,


<div class="modal fade bs-example-modal-lg" id="Cx0t5pYboG286AxCKggH" tabindex="-1" role="dialog" aria-labelledby="Cx0t5pYboG286AxCKggH-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Cx0t5pYboG286AxCKggH-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  filter(name == "Sea")
#> # A tibble: 4 × 5
#>    year sex   name      n       prop
#>   <dbl> <chr> <chr> <int>      <dbl>
#> 1  1982 F     Sea       5 0.00000276
#> 2  1985 M     Sea       6 0.00000312
#> 3  1986 M     Sea       5 0.0000026 
#> 4  1998 F     Sea       5 0.00000258
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Cx0t5pYboG286AxCKggH">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b) all of the children named "Sea".



  3) Use Boolean operators to return only the rows that contain:
  

<div class="modal fade bs-example-modal-lg" id="IQNuXbVVQDJE0DyQxF8Y" tabindex="-1" role="dialog" aria-labelledby="IQNuXbVVQDJE0DyQxF8Y-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="IQNuXbVVQDJE0DyQxF8Y-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  filter(name == "Sue", sex == "M")
#> # A tibble: 52 × 5
#>     year sex   name      n       prop
#>    <dbl> <chr> <chr> <int>      <dbl>
#>  1  1917 M     Sue       7 0.0000073 
#>  2  1927 M     Sue       5 0.0000043 
#>  3  1928 M     Sue       5 0.00000438
#>  4  1930 M     Sue       5 0.00000443
#>  5  1931 M     Sue       6 0.00000561
#>  6  1932 M     Sue       7 0.00000652
#>  7  1933 M     Sue       7 0.00000686
#>  8  1934 M     Sue      14 0.0000132 
#>  9  1935 M     Sue      13 0.0000122 
#> 10  1936 M     Sue       9 0.00000846
#> # … with 42 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#IQNuXbVVQDJE0DyQxF8Y">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a) _boys_ named Sue,



<div class="modal fade bs-example-modal-lg" id="QrucqHt88ZzX7AmeYkLO" tabindex="-1" role="dialog" aria-labelledby="QrucqHt88ZzX7AmeYkLO-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="QrucqHt88ZzX7AmeYkLO-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  filter(year == 1880, n == 5 | n == 6)
#> # A tibble: 455 × 5
#>     year sex   name        n      prop
#>    <dbl> <chr> <chr>   <int>     <dbl>
#>  1  1880 F     Abby        6 0.0000615
#>  2  1880 F     Aileen      6 0.0000615
#>  3  1880 F     Alba        6 0.0000615
#>  4  1880 F     Alda        6 0.0000615
#>  5  1880 F     Alla        6 0.0000615
#>  6  1880 F     Alverta     6 0.0000615
#>  7  1880 F     Ara         6 0.0000615
#>  8  1880 F     Ardelia     6 0.0000615
#>  9  1880 F     Ardella     6 0.0000615
#> 10  1880 F     Arrie       6 0.0000615
#> # … with 445 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#QrucqHt88ZzX7AmeYkLO">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b) names that were used by exactly 5 or 6 children in 1880,



<div class="modal fade bs-example-modal-lg" id="Lc9FwzX2biaWL47MbE1J" tabindex="-1" role="dialog" aria-labelledby="Lc9FwzX2biaWL47MbE1J-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Lc9FwzX2biaWL47MbE1J-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  filter(name %in% c("Acura", "Lexus", "Yugo"))
#> # A tibble: 57 × 5
#>     year sex   name      n       prop
#>    <dbl> <chr> <chr> <int>      <dbl>
#>  1  1990 F     Lexus    36 0.0000175 
#>  2  1990 M     Lexus    12 0.00000558
#>  3  1991 F     Lexus   102 0.0000502 
#>  4  1991 M     Lexus    16 0.00000755
#>  5  1992 F     Lexus   193 0.0000963 
#>  6  1992 M     Lexus    25 0.0000119 
#>  7  1993 F     Lexus   285 0.000145  
#>  8  1993 M     Lexus    30 0.0000145 
#>  9  1994 F     Lexus   381 0.000195  
#> 10  1994 F     Acura     6 0.00000308
#> # … with 47 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Lc9FwzX2biaWL47MbE1J">Solution</button>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c) names that are one of Acura, Lexus, or Yugo.
      


<div class="modal fade bs-example-modal-lg" id="4F8M8ZXAwc4BfuoR9ATO" tabindex="-1" role="dialog" aria-labelledby="4F8M8ZXAwc4BfuoR9ATO-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="4F8M8ZXAwc4BfuoR9ATO-title">Solution</h4></div><div class="modal-body">

```r
min(babynames$n)
#> [1] 5
max(babynames$n)
#> [1] 99686
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#4F8M8ZXAwc4BfuoR9ATO">Solution</button>

  4) What is the smallest value of n? What is the largest?



<div class="modal fade bs-example-modal-lg" id="nlOdPMcxTcHPRHysohB3" tabindex="-1" role="dialog" aria-labelledby="nlOdPMcxTcHPRHysohB3-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="nlOdPMcxTcHPRHysohB3-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  filter(sex == "F", year == 2017) %>% 
  select(name, n) %>% 
  arrange(desc(n)) 
#> # A tibble: 18,309 × 2
#>    name          n
#>    <chr>     <int>
#>  1 Emma      19738
#>  2 Olivia    18632
#>  3 Ava       15902
#>  4 Isabella  15100
#>  5 Sophia    14831
#>  6 Mia       13437
#>  7 Charlotte 12893
#>  8 Amelia    11800
#>  9 Evelyn    10675
#> 10 Abigail   10551
#> # … with 18,299 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#nlOdPMcxTcHPRHysohB3">Solution</button>

<div class="modal fade bs-example-modal-lg" id="6qMmudc4EPoNRZ80gpw3" tabindex="-1" role="dialog" aria-labelledby="6qMmudc4EPoNRZ80gpw3-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="6qMmudc4EPoNRZ80gpw3-title">Hint</h4></div><div class="modal-body">

```r
babynames %>% 
  filter(___) %>% 
  select(name, n) %>% 
  arrange(desc(___)) 
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#6qMmudc4EPoNRZ80gpw3">Hint</button>

  5) Write a sequence of functions that filters babynames to just the girls that were born in 2017, then select the `name` and `n` columns, then arrange the results so that the most popular names are near the top.



<div class="modal fade bs-example-modal-lg" id="fNZ8FJiB8Z3QTSUjzq6r" tabindex="-1" role="dialog" aria-labelledby="fNZ8FJiB8Z3QTSUjzq6r-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="fNZ8FJiB8Z3QTSUjzq6r-title">Solution</h4></div><div class="modal-body">

```r
# for instance
babynames %>% 
  filter(sex == "M", name == "Lars")
#> # A tibble: 112 × 5
#>     year sex   name      n      prop
#>    <dbl> <chr> <chr> <int>     <dbl>
#>  1  1883 M     Lars      7 0.0000622
#>  2  1884 M     Lars      5 0.0000407
#>  3  1886 M     Lars      5 0.000042 
#>  4  1887 M     Lars      5 0.0000457
#>  5  1897 M     Lars      5 0.000041 
#>  6  1901 M     Lars      8 0.0000692
#>  7  1912 M     Lars      6 0.0000133
#>  8  1913 M     Lars      6 0.0000112
#>  9  1914 M     Lars     16 0.0000234
#> 10  1915 M     Lars     17 0.0000193
#> # … with 102 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#fNZ8FJiB8Z3QTSUjzq6r">Solution</button>

  6) Trim `babynames` to just the rows that contain your `name` and your `sex`.


 

<div class="modal fade bs-example-modal-lg" id="ZgmOqBU7EuTXyygm1jvR" tabindex="-1" role="dialog" aria-labelledby="ZgmOqBU7EuTXyygm1jvR-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="ZgmOqBU7EuTXyygm1jvR-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  filter(name == "Khaleesi") %>% 
  summarise(total = sum(n), first = min(year))
#> # A tibble: 1 × 2
#>   total first
#>   <int> <dbl>
#> 1  1964  2011
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ZgmOqBU7EuTXyygm1jvR">Solution</button>

<div class="modal fade bs-example-modal-lg" id="hoUqU1RTbRJfbyAyZjre" tabindex="-1" role="dialog" aria-labelledby="hoUqU1RTbRJfbyAyZjre-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="hoUqU1RTbRJfbyAyZjre-title">Hint</h4></div><div class="modal-body">

```r
babynames ___ 
  filter(____) ___
  ____(total = ___, first = ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#hoUqU1RTbRJfbyAyZjre">Hint</button>

  7) Extract the rows where `name == "Khaleesi"`. Then use `summarise()` to find the total number of children named Khaleesi and the first year Khaleesi appeared in the data.



<div class="modal fade bs-example-modal-lg" id="hzql85WBjU8qwH9hZ5Yc" tabindex="-1" role="dialog" aria-labelledby="hzql85WBjU8qwH9hZ5Yc-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="hzql85WBjU8qwH9hZ5Yc-title">Solution</h4></div><div class="modal-body">

```r
babynames %>%
  group_by(name, sex) %>% 
  summarize(total = sum(n)) %>% 
  arrange(desc(total))
#> # A tibble: 107,973 × 3
#> # Groups:   name [97,310]
#>    name    sex     total
#>    <chr>   <chr>   <int>
#>  1 James   M     5150472
#>  2 John    M     5115466
#>  3 Robert  M     4814815
#>  4 Michael M     4350824
#>  5 Mary    F     4123200
#>  6 William M     4102604
#>  7 David   M     3611329
#>  8 Joseph  M     2603445
#>  9 Richard M     2563082
#> 10 Charles M     2386048
#> # … with 107,963 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#hzql85WBjU8qwH9hZ5Yc">Solution</button>

<div class="modal fade bs-example-modal-lg" id="YOPufx9Y6cFTTptZwIcc" tabindex="-1" role="dialog" aria-labelledby="YOPufx9Y6cFTTptZwIcc-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="YOPufx9Y6cFTTptZwIcc-title">Hint</h4></div><div class="modal-body">

```r
babynames %>%
  _______(name, sex) %>% 
  _______(total = _____(n)) %>% 
  _______(desc(_____))
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#YOPufx9Y6cFTTptZwIcc">Hint</button>

  8) Use `group_by()`, `summarise()`, and `arrange()` to display the ten most popular names. Compute popularity as the *total* number of children of a single gender given a name. 
      
      

<div class="modal fade bs-example-modal-lg" id="eEPAWa4jcfIMdxMCFUPK" tabindex="-1" role="dialog" aria-labelledby="eEPAWa4jcfIMdxMCFUPK-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="eEPAWa4jcfIMdxMCFUPK-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  group_by(year) %>% 
  summarise(total = sum(n))
#> # A tibble: 138 × 2
#>     year  total
#>    <dbl>  <int>
#>  1  1880 201484
#>  2  1881 192696
#>  3  1882 221533
#>  4  1883 216946
#>  5  1884 243462
#>  6  1885 240854
#>  7  1886 255317
#>  8  1887 247394
#>  9  1888 299473
#> 10  1889 288946
#> # … with 128 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#eEPAWa4jcfIMdxMCFUPK">Solution</button>

  9) Use `group_by()` to calculate the total number of children born each year over time.



<div class="modal fade bs-example-modal-lg" id="MgrTaUfg66vQYxCDcpo9" tabindex="-1" role="dialog" aria-labelledby="MgrTaUfg66vQYxCDcpo9-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="MgrTaUfg66vQYxCDcpo9-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  group_by(year, sex) %>% 
  mutate(rank = min_rank(desc(n))) %>% 
  arrange(year, sex, desc(prop))
#> # A tibble: 1,924,665 × 6
#> # Groups:   year, sex [276]
#>     year sex   name          n   prop  rank
#>    <dbl> <chr> <chr>     <int>  <dbl> <int>
#>  1  1880 F     Mary       7065 0.0724     1
#>  2  1880 F     Anna       2604 0.0267     2
#>  3  1880 F     Emma       2003 0.0205     3
#>  4  1880 F     Elizabeth  1939 0.0199     4
#>  5  1880 F     Minnie     1746 0.0179     5
#>  6  1880 F     Margaret   1578 0.0162     6
#>  7  1880 F     Ida        1472 0.0151     7
#>  8  1880 F     Alice      1414 0.0145     8
#>  9  1880 F     Bertha     1320 0.0135     9
#> 10  1880 F     Sarah      1288 0.0132    10
#> # … with 1,924,655 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


<p>The same results if you use <code>n</code> since in the same order.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#MgrTaUfg66vQYxCDcpo9">Solution</button>

<div class="modal fade bs-example-modal-lg" id="5mxcRfrVWlMw2K8KTknP" tabindex="-1" role="dialog" aria-labelledby="5mxcRfrVWlMw2K8KTknP-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="5mxcRfrVWlMw2K8KTknP-title">Hint</h4></div><div class="modal-body">

```r
babynames %>% 
  group_by(___, ___) %>% 
  ___(rank = ___(desc(___))) %>% 
  arrange(year, sex, desc(prop))
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#5mxcRfrVWlMw2K8KTknP">Hint</button>

  10) Column `prop` denotes the proportion given year and sex. Use `mutate()` and `min_rank()` to rank each row in babynames from _largest_ `prop` to lowest `prop` given year and sex. What happens if you do the same using the `n` column?



<div class="modal fade bs-example-modal-lg" id="1wubuc78gv9sR2pxoICC" tabindex="-1" role="dialog" aria-labelledby="1wubuc78gv9sR2pxoICC-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="1wubuc78gv9sR2pxoICC-title">Solution</h4></div><div class="modal-body">

```r
babynames %>% 
  group_by(year, sex) %>% 
  mutate(rank = min_rank(desc(n))) %>% 
  filter(rank == 1, year > 2009)
#> # A tibble: 16 × 6
#> # Groups:   year, sex [16]
#>     year sex   name         n    prop  rank
#>    <dbl> <chr> <chr>    <int>   <dbl> <int>
#>  1  2010 F     Isabella 22905 0.0117      1
#>  2  2010 M     Jacob    22117 0.0108      1
#>  3  2011 F     Sophia   21837 0.0113      1
#>  4  2011 M     Jacob    20365 0.0100      1
#>  5  2012 F     Sophia   22304 0.0115      1
#>  6  2012 M     Jacob    19069 0.00941     1
#>  7  2013 F     Sophia   21213 0.0110      1
#>  8  2013 M     Noah     18241 0.00904     1
#>  9  2014 F     Emma     20924 0.0107      1
#> 10  2014 M     Noah     19286 0.00943     1
#> 11  2015 F     Emma     20435 0.0105      1
#> 12  2015 M     Noah     19613 0.00962     1
#> 13  2016 F     Emma     19471 0.0101      1
#> 14  2016 M     Noah     19082 0.00946     1
#> 15  2017 F     Emma     19738 0.0105      1
#> 16  2017 M     Liam     18728 0.00954     1
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#1wubuc78gv9sR2pxoICC">Solution</button>

  11) Filter the results to find all names with `rank == 1` after 2009.






### Exercise (profit) {#ex-profit1}



Use the *exercise R markdown template* to solve this exercise (**File > New File > R Markdown...**, select **From template** and then **TFA Exercise**).

Consider the dataset profit containing quarterly financial records for each costumer, product, etc.:


```r
library(skimr)
path <- system.file("extdata/profit_raw.csv", package = "tfa")
profit <- read_csv(path)
skim(profit)
```


<table style='width: auto;'
      class='table table-condensed'>
<caption>(\#tab:unnamed-chunk-359)Data summary</caption>
<tbody>
  <tr>
   <td style="text-align:left;"> Name </td>
   <td style="text-align:left;"> profit </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Number of rows </td>
   <td style="text-align:left;"> 24546 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Number of columns </td>
   <td style="text-align:left;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> _______________________ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Column type frequency: </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> character </td>
   <td style="text-align:left;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ________________________ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Group variables </td>
   <td style="text-align:left;"> None </td>
  </tr>
</tbody>
</table>


**Variable type: character**

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> skim_variable </th>
   <th style="text-align:right;"> n_missing </th>
   <th style="text-align:right;"> complete_rate </th>
   <th style="text-align:right;"> min </th>
   <th style="text-align:right;"> max </th>
   <th style="text-align:right;"> empty </th>
   <th style="text-align:right;"> n_unique </th>
   <th style="text-align:right;"> whitespace </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Quarter </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Channel </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Customer ID </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 18 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Country </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 47 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Product Line </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 25 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Revenue </td>
   <td style="text-align:right;"> 63 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1210 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Product Cost </td>
   <td style="text-align:right;"> 61 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1139 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Customer Service Cost </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 464 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Profit </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 966 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
</tbody>
</table>

Note that it seems that the dataset need to be cleaned. All columns are strings (some should be numbers) and there seems to be missing values. You may start by having a view of the dataset using:

```r
View(profit)
```

First focus on column `Quarter` which currently has 12 distinct values:


```r
profit %>% distinct(Quarter)
#> # A tibble: 12 × 1
#>    Quarter
#>    <chr>  
#>  1 Q3     
#>  2 1      
#>  3 Q4     
#>  4 Q1     
#>  5 Q2     
#>  6 2      
#>  7 4      
#>  8 q1     
#>  9 q4     
#> 10 q3     
#> 11 q2     
#> 12 3
```

You would like it to be a numeric with values 1-4. 


<div class="modal fade bs-example-modal-lg" id="LDA5dm3508vAzhKKmUUG" tabindex="-1" role="dialog" aria-labelledby="LDA5dm3508vAzhKKmUUG-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="LDA5dm3508vAzhKKmUUG-title">Solution</h4></div><div class="modal-body">

```r

profit <- profit %>%  
  mutate(Quarter = str_remove(Quarter, "q") %>% str_remove("Q") %>% as.numeric())
profit %>% distinct(Quarter)
#> # A tibble: 4 × 1
#>   Quarter
#>     <dbl>
#> 1       3
#> 2       1
#> 3       4
#> 4       2
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#LDA5dm3508vAzhKKmUUG">Solution</button>

<div class="modal fade bs-example-modal-lg" id="vgiHax2VrHMu4VQ9RArg" tabindex="-1" role="dialog" aria-labelledby="vgiHax2VrHMu4VQ9RArg-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="vgiHax2VrHMu4VQ9RArg-title">Hint</h4></div><div class="modal-body">

```r
profit <- profit %>%  
  mutate(Quarter = str_remove(___, "q") %>% str_remove(___) %>% as.numeric())
profit %>% distinct(Quarter)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#vgiHax2VrHMu4VQ9RArg">Hint</button>

  1) Use `mutate`, `str_remove` and `as.numeric` to convert the column to a numeric by removing all 'q' and 'Q' values.

Let us look at the next columns:


```r
profit %>% distinct(Channel) %>% pull()
#>  [1] "ATM" "BRH" "INT" "MAL" "EML" "CCT" "TEL" "MOP" "DSA" "EVE"
profit %>% distinct(`Customer ID`) %>% pull()
#>  [1] "FRT" "MRT" "PBI" "MAM" "EBP" "RPB" "WEB" "WEM" "HEC" "STF" "IAS" "CRE" "INB" "CAM" "AGR" "SBE"
#> [17] "AFF" "MFN"
profit %>% distinct(Country) %>% pull()
#>  [1] "USA"            "Canada"         "Great Britain"  "Finland"        "New Zealand"   
#>  [6] "Brazil"         "Mexico"         "Germany"        "Puerto Rico"    "Hong Kong"     
#> [11] "Japan"          "Columbia"       "Switzerland"    "Uruguay"        "Netherlands"   
#> [16] "Korea"          "Venezuela"      "Panama"         "Sweden"         "China"         
#> [21] "Guatemala"      "South Africa"   "Malaysia"       "Nigeria"        "Denmark"       
#> [26] "France"         "India"          "Taiwan"         "Norway"         "Chile"         
#> [31] "Indonesia"      "Ireland"        "Thailand"       "Peru"           "Spain"         
#> [36] "Belgium"        "Poland"         "Ecuador"        "Costa Rica"     "Australia"     
#> [41] "Israel"         "Guam"           "Oman"           "Singapore"      "Argentina"     
#> [46] "Czechoslovakia" "Philippines"
profit %>% distinct(`Product Line`) %>% pull()
#> [1] "Credit Products"           "Deposit Products"          "Revolving Credit Products"
#> [4] "Other Products"            "Third Party Products"      "Fee Based Products"
```

These seem to be okay. The last columns should be numbers. Let us consider `Revenue`. 


```r
profit %>% distinct(Revenue) %>% pull() %>% head(n = 100)
#>   [1] "$ 6044"  "$ 4686"  "$ 6063"  "$ 4682"  "$ 6320"  "$ 2993"  "$ 3355"  "$ 5716"  "$ 3347" 
#>  [10] "$ 2624"  "$ 3629"  "$ 5612"  "$ 4618"  "$ 2080"  "$ 2788"  "$ 2829"  "$ 2898"  "$ 5232" 
#>  [19] "$ 2949"  "$ 5565"  "$ 2153"  "$ 3097"  "$ 1920"  "$ 4041"  "$ 5931"  "$ 1605"  "$ 2026" 
#>  [28] "$ 1687"  "$ 5075"  "$ 4223"  "$ 2456"  "$ 1924"  "$ 1578"  "$ 3235"  "$ 5123"  "$ 1560" 
#>  [37] "$ 1945"  "$ 6060"  "$ 1222"  "$ 1660"  "$ 3000"  "$ 2970"  "$ 1631"  "$ 1215"  "$ 1759" 
#>  [46] "$ 3285"  "$ 2048"  "$ 2173"  "$ 3353"  "$ 1162"  "$ 1232"  "$ 1561"  "$ 1123"  "$ 1794" 
#>  [55] "$ 1202"  "$ 1510"  "$ 4472"  "$ 2370"  "$ 2581"  "$ 2761"  "$ 6371"  "$ 1972"  "$ 1562" 
#>  [64] "$ 2742"  "$ 4598"  "$ 5322"  "$ 3411"  NA        "$ 1569"  "$ 2852"  "$ 1622"  "$ 2505" 
#>  [73] "$ 1596"  "$ 1447"  "$ 1690"  "$ 2448"  "$ 1593"  "$ 1876"  "$ 6591"  "$ 1611"  "$ 1254" 
#>  [82] "Unknown" "$ 842"   "$ 1529"  "$ 1439"  "$ 762"   "$ 1959"  "$ 4382"  "$ 1407"  "$ 909"  
#>  [91] "$ 1549"  "$ 2161"  "$ 1331"  "$ 727"   "$ 1462"  "$ 1067"  "$ 833"   "$ 1675"  "$ 1524" 
#> [100] "$ 1285"
```

Most values start with a dollar sign. Let us have a look at the other ones:


```r
profit %>% filter(!str_starts(Revenue, fixed("$"))) 
#> # A tibble: 95 × 9
#>    Quarter Channel `Customer ID` Country       `Product Line`         Revenue Produ…¹ Custo…² Profit
#>      <dbl> <chr>   <chr>         <chr>         <chr>                  <chr>   <chr>   <chr>   <chr> 
#>  1       3 INT     MAM           USA           Deposit Products       Unknown $ 1008  $ 246   $ 418 
#>  2       3 MAL     RPB           USA           Credit Products        ?       $ 1420  $ 347   $ 30  
#>  3       1 MAL     WEM           Great Britain Other Products         ?       $ 87    $ 19    $ -34 
#>  4       3 ATM     MFN           Germany       Fee Based Products     unknown $ 47    $ 6     $ 9   
#>  5       3 ATM     PBI           Costa Rica    Third Party Products   Unknown $ 51    $ 9     $ 6   
#>  6       1 ATM     PBI           Chile         Deposit Products       Unknown $ 58    $ 7     $ -9  
#>  7       4 CCT     MRT           Great Britain Revolving Credit Prod… ?       $ 27    $ 5     $ 16  
#>  8       4 ATM     MAM           Taiwan        Third Party Products   unknown $ 55    $ 9     $ 75  
#>  9       4 MAL     WEB           Japan         Other Products         unknown $ 40    $ 7     $ 17  
#> 10       2 CCT     MAM           Netherlands   Credit Products        unknown $ 14    $ 3     $ 20  
#> # … with 85 more rows, and abbreviated variable names ¹​`Product Cost`, ²​`Customer Service Cost`
#> # ℹ Use `print(n = ...)` to see more rows
na_values <- profit %>% 
  filter(!str_starts(Revenue, fixed("$"))) %>% 
  distinct(Revenue) %>% 
  pull(Revenue)
na_values
#> [1] "Unknown" "?"       "unknown"
```

The expression is a bit complex. Let us break it up. Function `fixed` just returns the fixed string '$'. This is necessary since the dollar sign has a special meaning in regular expressions (beyond the scope here). Function `str_starts` checks if the string starts with a dollar sign. We use the logical negation (NOT) to find the complementary set. 

Note that different strings have been used to indicate `NA` values (Unknown, ?, unknown). Let us first use a single value to indicate `NA` (a question mark):

```r
profit <- profit %>% 
  mutate(Revenue = str_replace_all(Revenue, c("unknown" = "?", "Unknown" = "?")))
```

Next, we replace all `?` with `NA`:

```r
profit <- profit %>% 
  mutate(Revenue = na_if(Revenue, "?"))
profit %>% # check
  filter(!str_starts(Revenue, fixed("$"))) 
#> # A tibble: 0 × 9
#> # … with 9 variables: Quarter <dbl>, Channel <chr>, Customer ID <chr>, Country <chr>,
#> #   Product Line <chr>, Revenue <chr>, Product Cost <chr>, Customer Service Cost <chr>,
#> #   Profit <chr>
#> # ℹ Use `colnames()` to see all variable names
```

Finally, we remove all dollar signs:


```r
profit <- profit %>% 
  mutate(Revenue = str_remove(Revenue, fixed("$ ")) %>% as.numeric())
profit
#> # A tibble: 24,546 × 9
#>    Quarter Channel `Customer ID` Country `Product Line`            Revenue Product …¹ Custo…² Profit
#>      <dbl> <chr>   <chr>         <chr>   <chr>                       <dbl> <chr>      <chr>   <chr> 
#>  1       3 ATM     FRT           USA     Credit Products              6044 $ 3998     $ 413   $ 1633
#>  2       1 ATM     MRT           USA     Credit Products              4686 $ 3229     $ 643   $ 815 
#>  3       4 ATM     PBI           USA     Deposit Products             6063 $ 7440     $ 1842  $ -32…
#>  4       1 ATM     PBI           USA     Deposit Products             4682 $ 6127     $ 1118  $ -25…
#>  5       4 ATM     MRT           USA     Deposit Products             6320 $ 7913     $ 1854  $ -34…
#>  6       3 BRH     MAM           USA     Deposit Products             2993 $ 1034     $ 242   $ 1718
#>  7       4 BRH     PBI           USA     Revolving Credit Products    3355 $ 4355     $ 1027  $ -20…
#>  8       3 ATM     FRT           USA     Revolving Credit Products    5716 $ 5617     $ 876   $ -777
#>  9       4 BRH     PBI           USA     Deposit Products             3347 $ 4229     $ 425   $ -13…
#> 10       1 BRH     PBI           USA     Credit Products              2624 $ 1960     $ 264   $ 401 
#> # … with 24,536 more rows, and abbreviated variable names ¹​`Product Cost`, ²​`Customer Service Cost`
#> # ℹ Use `print(n = ...)` to see more rows
```

As one pipe: 

```r
profit <- profit %>% 
  mutate(Revenue = str_replace_all(Revenue, c("unknown" = "?", "Unknown" = "?"))) %>% 
  mutate(Revenue = na_if(Revenue, "?")) %>% 
  mutate(Revenue = str_remove(Revenue, fixed("$ ")) %>% as.numeric())
```



  2) Convert the remaining columns to numeric like shown for `Revenue` above. 
  


<div class="modal fade bs-example-modal-lg" id="77HwvBu4s3x9aiH1iJrT" tabindex="-1" role="dialog" aria-labelledby="77HwvBu4s3x9aiH1iJrT-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="77HwvBu4s3x9aiH1iJrT-title">Solution</h4></div><div class="modal-body">

```r
profit <- read_csv(path)
profit <- profit %>% 
  mutate(across(Revenue:Profit, ~str_replace_all(.x, c("unknown" = "?", "Unknown" = "?")) )) %>% 
  mutate(across(Revenue:Profit, ~na_if(.x, "?") )) %>% 
  mutate(across(Revenue:Profit, ~str_remove(.x, fixed("$ ")) %>% as.numeric() )) 
profit
#> # A tibble: 24,546 × 9
#>    Quarter Channel `Customer ID` Country `Product Line`            Revenue Product …¹ Custo…² Profit
#>    <chr>   <chr>   <chr>         <chr>   <chr>                       <dbl>      <dbl>   <dbl>  <dbl>
#>  1 Q3      ATM     FRT           USA     Credit Products              6044       3998     413   1633
#>  2 1       ATM     MRT           USA     Credit Products              4686       3229     643    815
#>  3 Q4      ATM     PBI           USA     Deposit Products             6063       7440    1842  -3219
#>  4 Q1      ATM     PBI           USA     Deposit Products             4682       6127    1118  -2563
#>  5 Q4      ATM     MRT           USA     Deposit Products             6320       7913    1854  -3447
#>  6 Q3      BRH     MAM           USA     Deposit Products             2993       1034     242   1718
#>  7 Q4      BRH     PBI           USA     Revolving Credit Products    3355       4355    1027  -2027
#>  8 Q3      ATM     FRT           USA     Revolving Credit Products    5716       5617     876   -777
#>  9 Q4      BRH     PBI           USA     Deposit Products             3347       4229     425  -1307
#> 10 Q1      BRH     PBI           USA     Credit Products              2624       1960     264    401
#> # … with 24,536 more rows, and abbreviated variable names ¹​`Product Cost`, ²​`Customer Service Cost`
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#77HwvBu4s3x9aiH1iJrT">Solution</button>

<div class="modal fade bs-example-modal-lg" id="z41Zb0k2Tw3xlqDzgHox" tabindex="-1" role="dialog" aria-labelledby="z41Zb0k2Tw3xlqDzgHox-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="z41Zb0k2Tw3xlqDzgHox-title">Hint</h4></div><div class="modal-body">

```r
profit <- read_csv(path) %>% 
  mutate(across(___:___, ~str_replace_all(.x, c("unknown" = "?", "Unknown" = "?")) )) %>% 
  mutate(across(___:___, ~na_if(.x, "?") )) %>% 
  mutate(across(___:___, ~str_remove(.x, fixed("$ ")) %>% as.numeric() )) 
profit
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#z41Zb0k2Tw3xlqDzgHox">Hint</button>
   3) Use the `across` function to apply the operations in Question 2 for a set of columns. Hint: see the examples on the help page of `across`. 




<div class="modal fade bs-example-modal-lg" id="t73or2Dh60u3s7PEmZCQ" tabindex="-1" role="dialog" aria-labelledby="t73or2Dh60u3s7PEmZCQ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="t73or2Dh60u3s7PEmZCQ-title">Solution</h4></div><div class="modal-body">

```r
profit <- read_csv(path) %>% 
  mutate(Quarter = str_remove(Quarter, "q") %>% str_remove("Q") %>% as.numeric()) %>% 
  mutate(across(Revenue:Profit, ~str_replace_all(.x, c("unknown" = "?", "Unknown" = "?")) )) %>% 
  mutate(across(Revenue:Profit, ~na_if(.x, "?") )) %>% 
  mutate(across(Revenue:Profit, ~str_remove(.x, fixed("$ ")) %>% as.numeric() )) 
skim(profit)
```


<table style='width: auto;'
      class='table table-condensed'>
<caption>(\#tab:unnamed-chunk-372)Data summary</caption>
<tbody>
  <tr>
   <td style="text-align:left;"> Name </td>
   <td style="text-align:left;"> profit </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Number of rows </td>
   <td style="text-align:left;"> 24546 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Number of columns </td>
   <td style="text-align:left;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> _______________________ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Column type frequency: </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> character </td>
   <td style="text-align:left;"> 4 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> numeric </td>
   <td style="text-align:left;"> 5 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ________________________ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Group variables </td>
   <td style="text-align:left;"> None </td>
  </tr>
</tbody>
</table>


**Variable type: character**

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> skim_variable </th>
   <th style="text-align:right;"> n_missing </th>
   <th style="text-align:right;"> complete_rate </th>
   <th style="text-align:right;"> min </th>
   <th style="text-align:right;"> max </th>
   <th style="text-align:right;"> empty </th>
   <th style="text-align:right;"> n_unique </th>
   <th style="text-align:right;"> whitespace </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Channel </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Customer ID </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 18 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Country </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 47 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Product Line </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 25 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
</tbody>
</table>


**Variable type: numeric**

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> skim_variable </th>
   <th style="text-align:right;"> n_missing </th>
   <th style="text-align:right;"> complete_rate </th>
   <th style="text-align:right;"> mean </th>
   <th style="text-align:right;"> sd </th>
   <th style="text-align:right;"> p0 </th>
   <th style="text-align:right;"> p25 </th>
   <th style="text-align:right;"> p50 </th>
   <th style="text-align:right;"> p75 </th>
   <th style="text-align:right;"> p100 </th>
   <th style="text-align:left;"> hist </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Quarter </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 2.50 </td>
   <td style="text-align:right;"> 1.12 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:left;"> ▇▇▁▇▇ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Revenue </td>
   <td style="text-align:right;"> 158 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 120.31 </td>
   <td style="text-align:right;"> 421.79 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;"> 41 </td>
   <td style="text-align:right;"> 74 </td>
   <td style="text-align:right;"> 7540 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Product Cost </td>
   <td style="text-align:right;"> 61 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 100.04 </td>
   <td style="text-align:right;"> 375.58 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 29 </td>
   <td style="text-align:right;"> 68 </td>
   <td style="text-align:right;"> 9256 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Customer Service Cost </td>
   <td style="text-align:right;"> 96 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 17.41 </td>
   <td style="text-align:right;"> 67.50 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;"> 1865 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Profit </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 2.71 </td>
   <td style="text-align:right;"> 154.89 </td>
   <td style="text-align:right;"> -4139 </td>
   <td style="text-align:right;"> -7 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 3664 </td>
   <td style="text-align:left;"> ▁▁▇▁▁ </td>
  </tr>
</tbody>
</table>


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#t73or2Dh60u3s7PEmZCQ">Solution</button>

  4) Write one pipe that does all the cleaning.
  




<div class="modal fade bs-example-modal-lg" id="RuSvOnlLwVKRUqwTNE0h" tabindex="-1" role="dialog" aria-labelledby="RuSvOnlLwVKRUqwTNE0h-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="RuSvOnlLwVKRUqwTNE0h-title">Solution</h4></div><div class="modal-body">

```r
profit <- profit %>% 
  mutate(Profit_calc = Revenue - `Product Cost` - `Customer Service Cost`, Diff = abs(Profit - Profit_calc)) %>%  
  mutate(Profit = if_else(Diff > 0 & Diff <= 1, Profit_calc, Profit, missing = Profit) ) 
profit %>% filter(Diff == 1, is.na(Profit_calc))  # check
#> # A tibble: 0 × 11
#> # … with 11 variables: Quarter <dbl>, Channel <chr>, Customer ID <chr>, Country <chr>,
#> #   Product Line <chr>, Revenue <dbl>, Product Cost <dbl>, Customer Service Cost <dbl>,
#> #   Profit <dbl>, Profit_calc <dbl>, Diff <dbl>
#> # ℹ Use `colnames()` to see all variable names
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#RuSvOnlLwVKRUqwTNE0h">Solution</button>

<div class="modal fade bs-example-modal-lg" id="h0BX9FvMzi9aqjSVYCt9" tabindex="-1" role="dialog" aria-labelledby="h0BX9FvMzi9aqjSVYCt9-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="h0BX9FvMzi9aqjSVYCt9-title">Hint</h4></div><div class="modal-body">

```r
profit <- profit %>% 
  mutate(Profit_calc = Revenue - `Product Cost` - `Customer Service Cost`, Diff = abs(___)) %>%  
  mutate(Profit = if_else(Diff > 0 & Diff <= 1, ___, Profit, Profit) ) 
profit %>% filter(Diff == 1, is.na(Profit_calc))  # check
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#h0BX9FvMzi9aqjSVYCt9">Hint</button>

  5) Validate that revenue - product costs - customer service cost equals profit. If you see small rounding errors (less than or equal one) then recalculate the profit.





<div class="modal fade bs-example-modal-lg" id="aTCyJ2kZ0IrE3iVPQutD" tabindex="-1" role="dialog" aria-labelledby="aTCyJ2kZ0IrE3iVPQutD-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="aTCyJ2kZ0IrE3iVPQutD-title">Solution</h4></div><div class="modal-body">

```r
profit <- profit %>% 
  rowwise() %>% 
  mutate(c_na = sum(is.na(c_across(Revenue:Profit)))) %>% 
  mutate(Revenue = if_else(is.na(Revenue) & c_na == 1, Profit + `Product Cost` + `Customer Service Cost`, Revenue, Revenue),
         `Product Cost` = if_else(is.na(`Product Cost`) & c_na == 1, - Profit + Revenue - `Customer Service Cost`, `Product Cost`), 
         `Customer Service Cost` = if_else(is.na(`Customer Service Cost`) & c_na == 1, - Profit + Revenue - `Product Cost`, `Customer Service Cost`)) %>% 
  select(Quarter:Profit)

# check - do numbers match
profit %>% 
  mutate(Profit_calc = Revenue - `Product Cost` - `Customer Service Cost`, Diff = abs(Profit - Profit_calc)) %>%  
  filter(Diff > 0)
#> # A tibble: 0 × 11
#> # Rowwise: 
#> # … with 11 variables: Quarter <dbl>, Channel <chr>, Customer ID <chr>, Country <chr>,
#> #   Product Line <chr>, Revenue <dbl>, Product Cost <dbl>, Customer Service Cost <dbl>,
#> #   Profit <dbl>, Profit_calc <dbl>, Diff <dbl>
#> # ℹ Use `colnames()` to see all variable names

# check - find NA values
profit %>% 
  rowwise() %>% 
  mutate(c_na = sum(is.na(c_across(Revenue:Profit)))) %>% 
  filter(c_na > 0)
#> # A tibble: 3 × 10
#> # Rowwise: 
#>   Quarter Channel `Customer ID` Country `Product Line`          Revenue Produ…¹ Custo…² Profit  c_na
#>     <dbl> <chr>   <chr>         <chr>   <chr>                     <dbl>   <dbl>   <dbl>  <dbl> <int>
#> 1       1 EML     FRT           France  Revolving Credit Produ…       3      NA      NA     -1     2
#> 2       2 BRH     EBP           Guam    Fee Based Products           NA      NA       0      1     2
#> 3       1 MAL     MFN           Japan   Fee Based Products           NA      NA       5     21     2
#> # … with abbreviated variable names ¹​`Product Cost`, ²​`Customer Service Cost`
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#aTCyJ2kZ0IrE3iVPQutD">Solution</button>

<div class="modal fade bs-example-modal-lg" id="Z2X6k6ClQXsjkb6pjs5p" tabindex="-1" role="dialog" aria-labelledby="Z2X6k6ClQXsjkb6pjs5p-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Z2X6k6ClQXsjkb6pjs5p-title">Hint 2</h4></div><div class="modal-body">

```r
profit <- profit %>% 
  rowwise() %>% 
  mutate(c_na = sum(is.na(c_across(Revenue:Profit)))) %>% 
  mutate(Revenue = if_else(is.na(___) & c_na == 1, ___, Revenue, Revenue),
         `Product Cost` = if_else(is.na(___) & c_na == 1, ___, `Product Cost`), 
         `Customer Service Cost` = if_else(is.na(___) & c_na == 1, ___, `Customer Service Cost`)) %>% 
  select(Quarter:Profit)
```


<p>You can check you calculations using your code from Question 5.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Z2X6k6ClQXsjkb6pjs5p">Hint 2</button>

<div class="modal fade bs-example-modal-lg" id="HKsB0h2ouACntFQOfInL" tabindex="-1" role="dialog" aria-labelledby="HKsB0h2ouACntFQOfInL-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="HKsB0h2ouACntFQOfInL-title">Hint 1</h4></div><div class="modal-body">

```r
# To find the number of missing values (`NA`) you can create a new column 
# counting the number of missing values:
profit <- profit %>% 
  rowwise() %>% 
  mutate(ct_na = sum(is.na(c_across(Revenue:Profit)))) %>% 
  ungroup()
profit %>% filter(ct_na >= 1)
```


<p>Recall that profit = revenue - product costs - customer service cost; that is, if a single value of these are missing then the value can be calculated using the other ones.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#HKsB0h2ouACntFQOfInL">Hint 1</button>

   6) Recalculate values in columns `Revenue` to `Profit` if possible. 

     
  




<div class="modal fade bs-example-modal-lg" id="F0NbLAzGY8gRMNPpulMg" tabindex="-1" role="dialog" aria-labelledby="F0NbLAzGY8gRMNPpulMg-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="F0NbLAzGY8gRMNPpulMg-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(Quarter) %>% 
  slice_max(Profit, n = 2)
#> # A tibble: 8 × 9
#> # Groups:   Quarter [4]
#>   Quarter Channel `Customer ID` Country `Product Line`            Revenue Product C…¹ Custo…² Profit
#>     <dbl> <chr>   <chr>         <chr>   <chr>                       <dbl>       <dbl>   <dbl>  <dbl>
#> 1       1 ATM     PBI           USA     Credit Products              4821        1808     233   2780
#> 2       1 ATM     PBI           USA     Revolving Credit Products    4268        1638     363   2267
#> 3       2 ATM     FRT           USA     Credit Products              5931        3137     406   2388
#> 4       2 ATM     RPB           USA     Deposit Products             4864        2156     533   2175
#> 5       3 ATM     WEM           USA     Credit Products              5682        2112     454   3116
#> 6       3 ATM     WEM           USA     Deposit Products             4850        2493     253   2104
#> 7       4 ATM     MAM           USA     Revolving Credit Products    6699        2506     530   3663
#> 8       4 ATM     WEM           USA     Revolving Credit Products    5836        2114     265   3457
#> # … with abbreviated variable names ¹​`Product Cost`, ²​`Customer Service Cost`
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#F0NbLAzGY8gRMNPpulMg">Solution</button>

  7) Find the two best rows with highest profit in each quarter.
  



<div class="modal fade bs-example-modal-lg" id="V1ecK1yz4Xy6MUuZ1rps" tabindex="-1" role="dialog" aria-labelledby="V1ecK1yz4Xy6MUuZ1rps-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="V1ecK1yz4Xy6MUuZ1rps-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(Quarter, `Customer ID`) %>% 
  summarise(Profit = sum(Profit)) %>% 
  slice_max(Profit, n = 2)
#> # A tibble: 8 × 3
#> # Groups:   Quarter [4]
#>   Quarter `Customer ID` Profit
#>     <dbl> <chr>          <dbl>
#> 1       1 MRT             3925
#> 2       1 WEB             3776
#> 3       2 FRT             7272
#> 4       2 MAM             6992
#> 5       3 WEM             6616
#> 6       3 RPB             3245
#> 7       4 EBP            10093
#> 8       4 WEM             8262
```


<p>The results are not the same since use another group by.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#V1ecK1yz4Xy6MUuZ1rps">Solution</button>

<div class="modal fade bs-example-modal-lg" id="o06pD1Zks3DPPZwz8Hpz" tabindex="-1" role="dialog" aria-labelledby="o06pD1Zks3DPPZwz8Hpz-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="o06pD1Zks3DPPZwz8Hpz-title">Hint</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(___, `Customer ID`) %>% 
  summarise(Profit = ___) %>% 
  slice_max(Profit, n = 2)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#o06pD1Zks3DPPZwz8Hpz">Hint</button>

  8) Find the two best customers with highest profit in each quarter. Is the result the same as in Question 7?





<div class="modal fade bs-example-modal-lg" id="f48KFFmAbgvgG02Aq2Gt" tabindex="-1" role="dialog" aria-labelledby="f48KFFmAbgvgG02Aq2Gt-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="f48KFFmAbgvgG02Aq2Gt-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Product Line`) %>% 
  summarise(Profit = sum(Profit)) %>% 
  slice_max(Profit)
#> # A tibble: 1 × 2
#>   `Product Line`  Profit
#>   <chr>            <dbl>
#> 1 Credit Products  31022
# ... repeat 

# Using a function
summarise_profit  <- function(data, group_var, summarise_var) {
  data %>%
    group_by(across({{ group_var }})) %>% 
    summarise(across({{ summarise_var }}, sum)) %>% 
    slice_max(Profit)
}
summarise_profit(profit, `Product Line`, Profit)
#> # A tibble: 1 × 2
#>   `Product Line`  Profit
#>   <chr>            <dbl>
#> 1 Credit Products  31022
summarise_profit(profit, `Customer ID`, Profit)
#> # A tibble: 1 × 2
#>   `Customer ID` Profit
#>   <chr>          <dbl>
#> 1 WEM            18942
# ... repeat

# Using purrr package to get a single tibble (if interested in the purrr package)
val <- names(profit)[1:5]
max_profit <- map_df(
  val, 
  ~{
      tmp <- profit %>% 
        group_by(.data[[.x]]) %>% 
        summarise(Profit = sum(Profit), .groups = "drop") %>% 
        slice_max(Profit)
      tibble(by = .x, 
        best = as.character(tmp[[1,1]]),
        profit = tmp[[1,2]] 
      )
    } 
  )
max_profit 
#> # A tibble: 5 × 3
#>   by           best            profit
#>   <chr>        <chr>            <dbl>
#> 1 Quarter      4                35268
#> 2 Channel      ATM              30433
#> 3 Customer ID  WEM              18942
#> 4 Country      USA              39693
#> 5 Product Line Credit Products  31022
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#f48KFFmAbgvgG02Aq2Gt">Solution</button>

<div class="modal fade bs-example-modal-lg" id="XnxgOywW8cp8byEP6HWJ" tabindex="-1" role="dialog" aria-labelledby="XnxgOywW8cp8byEP6HWJ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="XnxgOywW8cp8byEP6HWJ-title">Hint</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(___) %>% 
  summarise(Profit = ___) %>% 
  slice_max(Profit)
# ... repeat 
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#XnxgOywW8cp8byEP6HWJ">Hint</button>

  9) Find the product line, customer, channel, country and quarter with the highest profit. 
  




<div class="modal fade bs-example-modal-lg" id="bzb9hgKQIpaoI8t0ZxGz" tabindex="-1" role="dialog" aria-labelledby="bzb9hgKQIpaoI8t0ZxGz-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="bzb9hgKQIpaoI8t0ZxGz-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Customer ID`) %>% 
  distinct(Country) %>% 
  count(`Customer ID`)
#> # A tibble: 18 × 2
#> # Groups:   Customer ID [18]
#>    `Customer ID`     n
#>    <chr>         <int>
#>  1 AFF               1
#>  2 AGR              16
#>  3 CAM               1
#>  4 CRE               1
#>  5 EBP              47
#>  6 FRT              47
#>  7 HEC               1
#>  8 IAS               1
#>  9 INB               1
#> 10 MAM              47
#> 11 MFN              30
#> 12 MRT              47
#> 13 PBI              47
#> 14 RPB              47
#> 15 SBE               1
#> 16 STF               2
#> 17 WEB              47
#> 18 WEM              47
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#bzb9hgKQIpaoI8t0ZxGz">Solution</button>

  10) Are there rows with the same customer in different countries?
  




<div class="modal fade bs-example-modal-lg" id="2FGwyjHPClkUfklbOfrR" tabindex="-1" role="dialog" aria-labelledby="2FGwyjHPClkUfklbOfrR-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="2FGwyjHPClkUfklbOfrR-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  arrange(desc(Profit), desc(Revenue))
#> # A tibble: 24,546 × 9
#> # Rowwise: 
#>    Quarter Channel `Customer ID` Country `Product Line`            Revenue Product …¹ Custo…² Profit
#>      <dbl> <chr>   <chr>         <chr>   <chr>                       <dbl>      <dbl>   <dbl>  <dbl>
#>  1       4 ATM     MAM           USA     Revolving Credit Products    6699       2506     530   3663
#>  2       4 ATM     WEM           USA     Revolving Credit Products    5836       2114     265   3457
#>  3       4 ATM     MAM           USA     Credit Products              7540       3374     728   3438
#>  4       4 ATM     MRT           USA     Credit Products              6419       2669     618   3132
#>  5       3 ATM     WEM           USA     Credit Products              5682       2112     454   3116
#>  6       4 ATM     WEB           USA     Deposit Products             5145       1907     191   3047
#>  7       1 ATM     PBI           USA     Credit Products              4821       1808     233   2780
#>  8       4 ATM     RPB           USA     Credit Products              5828       2727     559   2542
#>  9       2 ATM     FRT           USA     Credit Products              5931       3137     406   2388
#> 10       1 ATM     PBI           USA     Revolving Credit Products    4268       1638     363   2267
#> # … with 24,536 more rows, and abbreviated variable names ¹​`Product Cost`, ²​`Customer Service Cost`
#> # ℹ Use `print(n = ...)` to see more rows
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#2FGwyjHPClkUfklbOfrR">Solution</button>

  11) Sort the data decreasing with respect to profit and next revenue.
  

  
  

<div class="modal fade bs-example-modal-lg" id="7cTvEmkfYbrUy4YBIqCa" tabindex="-1" role="dialog" aria-labelledby="7cTvEmkfYbrUy4YBIqCa-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="7cTvEmkfYbrUy4YBIqCa-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Product Line`) %>% 
  summarise(cost = sum(`Product Cost` + `Customer Service Cost`)) %>% 
  # print() %>%   # if want a peek before slicing 
  slice_max(cost)
#> # A tibble: 1 × 2
#>   `Product Line`    cost
#>   <chr>            <dbl>
#> 1 Credit Products 820665

profit %>% 
  group_by(`Product Line`) %>% 
  summarise(cost = sum(`Product Cost`)) %>% 
  slice_min(cost)
#> # A tibble: 1 × 2
#>   `Product Line`        cost
#>   <chr>                <dbl>
#> 1 Third Party Products 91796
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#7cTvEmkfYbrUy4YBIqCa">Solution</button>

<div class="modal fade bs-example-modal-lg" id="OITky98Z8CLGihnHBSYc" tabindex="-1" role="dialog" aria-labelledby="OITky98Z8CLGihnHBSYc-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="OITky98Z8CLGihnHBSYc-title">Hint</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Product Line`) %>% 
  summarise(cost = sum(___)) %>% 
  # print() %>%   # if want a peek before slicing 
  slice_max(___)

profit %>% 
  ___% 
  slice_min(cost)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#OITky98Z8CLGihnHBSYc">Hint</button>

  12) Which product line has the highest and lowest total cost?





<div class="modal fade bs-example-modal-lg" id="T8szrqNcW2kq3tNhigII" tabindex="-1" role="dialog" aria-labelledby="T8szrqNcW2kq3tNhigII-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="T8szrqNcW2kq3tNhigII-title">Solution</h4></div><div class="modal-body">

```r
profit %>%
  mutate(cust_cost_new = `Customer Service Cost` * 1.05, 
         profit_new = Revenue - cust_cost_new - `Product Cost`) %>% 
  group_by(`Product Line`) %>% 
  summarise(cust_cost = sum(`Customer Service Cost`), profit = sum(Profit), 
            cust_cost_new = sum(cust_cost_new), profit_new = sum(profit_new),
            profit_decrease = profit_new - profit)
#> # A tibble: 6 × 6
#>   `Product Line`            cust_cost profit cust_cost_new profit_new profit_decrease
#>   <chr>                         <dbl>  <dbl>         <dbl>      <dbl>           <dbl>
#> 1 Credit Products              119612  31022       125593.     25041.          -5981.
#> 2 Deposit Products             114526   5408       120252.      -318.          -5726.
#> 3 Fee Based Products            22900   4953        24045         NA              NA 
#> 4 Other Products                33282   7438        34946.      5774.          -1664.
#> 5 Revolving Credit Products        NA  15905           NA         NA              NA 
#> 6 Third Party Products          15970   2264        16768.      1465.           -799.
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#T8szrqNcW2kq3tNhigII">Solution</button>

<div class="modal fade bs-example-modal-lg" id="T3UaEx9ZQ7MznLwiUoeM" tabindex="-1" role="dialog" aria-labelledby="T3UaEx9ZQ7MznLwiUoeM-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="T3UaEx9ZQ7MznLwiUoeM-title">Hint</h4></div><div class="modal-body">

```r
profit %>%
  mutate(cust_cost_new = ___ * 1.05, 
         profit_new = ___) %>% 
  group_by(`Product Line`) %>% 
  summarise(cust_cost = sum(___), profit = sum(Profit), 
            cust_cost_new = ___, profit_new = ___,
            profit_decrease = ___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#T3UaEx9ZQ7MznLwiUoeM">Hint</button>

  13) Assume that customer service cost increases with 5%. How will that affect the profit for each product line?
  

```r
rm(profit)
```


### Exercise (fisheries) {#ex-fish}

Use the *exercise R markdown template* to solve this exercise (**File > New File > R Markdown...**, select **From template** and then **TFA Exercise**).

The dataset called `fisheries` contains world fisheries harvest for 2005. The tonnage from capture and aquaculture is listed by country.

You need the `tidyverse` package as usual:


```r
library(tidyverse)
# install tfa package using remotes::install_github("bss-osca/tfa/tfa-package", upgrade = FALSE)     
```

We load the needed datasets:


```r
fisheries <- read_csv(system.file("extdata/fisheries.csv", package = "tfa"))
fisheries
#> # A tibble: 216 × 4
#>    country             capture aquaculture  total
#>    <chr>                 <dbl>       <dbl>  <dbl>
#>  1 Afghanistan            1000        1200   2200
#>  2 Albania                7886         950   8836
#>  3 Algeria               95000        1361  96361
#>  4 American Samoa         3047          20   3067
#>  5 Andorra                   0           0      0
#>  6 Angola               486490         655 487145
#>  7 Antigua and Barbuda    3000          10   3010
#>  8 Argentina            755226        3673 758899
#>  9 Armenia                3758       16381  20139
#> 10 Aruba                   142           0    142
#> # … with 206 more rows
#> # ℹ Use `print(n = ...)` to see more rows
continents <- read_csv(system.file("extdata/continents.csv", package = "tfa"))
continents
#> # A tibble: 247 × 2
#>    country           continent
#>    <chr>             <chr>    
#>  1 Afghanistan       Asia     
#>  2 Åland Islands     Europe   
#>  3 Albania           Europe   
#>  4 Algeria           Africa   
#>  5 American Samoa    Oceania  
#>  6 Andorra           Europe   
#>  7 Angola            Africa   
#>  8 Anguilla          Americas 
#>  9 Antigua & Barbuda Americas 
#> 10 Argentina         Americas 
#> # … with 237 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```

Some mean statistics:


```r
fisheries %>%
  summarise(across(where(is.numeric), mean, na.rm = TRUE))
#> # A tibble: 1 × 3
#>   capture aquaculture   total
#>     <dbl>       <dbl>   <dbl>
#> 1 421916.     508368. 930284.
```




<div class="modal fade bs-example-modal-lg" id="TbjMaWatrpAKvvdnZ2HT" tabindex="-1" role="dialog" aria-labelledby="TbjMaWatrpAKvvdnZ2HT-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="TbjMaWatrpAKvvdnZ2HT-title">Solution</h4></div><div class="modal-body">

```r
fisheries %>% 
  anti_join(continents)      # countries not belonging to a continent
#> # A tibble: 20 × 4
#>    country                          capture aquaculture   total
#>    <chr>                              <dbl>       <dbl>   <dbl>
#>  1 Antigua and Barbuda                 3000          10    3010
#>  2 Bosnia and Herzegovina               305        4564    4869
#>  3 Czech Republic                      3507       20952   24459
#>  4 Democratic Republic of the Congo  237372        3161  240533
#>  5 Eswatini                              65         100     165
#>  6 Federated States of Micronesia     88397           0   88397
#>  7 Ivory Coast                        67500        4701   72201
#>  8 Jersey and Guernsey                 2985        1499    4484
#>  9 Macao                               1500           0    1500
#> 10 Myanmar                          2072390     1017644 3090034
#> 11 North Macedonia                      306         986    1292
#> 12 Palestine                           3306         280    3586
#> 13 Republic of the Congo              86748         177   86925
#> 14 Saint Kitts and Nevis              65734           1   65735
#> 15 Saint Lucia                         2097          32    2129
#> 16 Saint Vincent and the Grenadines   23077           0   23077
#> 17 São Tomé and Príncipe              11750           0   11750
#> 18 Trinidad and Tobago                13027          11   13038
#> 19 Turks and Caicos Islands            2780           0    2780
#> 20 US Virgin Islands                    551           8     559
fisheries <- fisheries %>% 
  print() %>% 
  left_join(continents) %>% 
  print()
#> # A tibble: 216 × 4
#>    country             capture aquaculture  total
#>    <chr>                 <dbl>       <dbl>  <dbl>
#>  1 Afghanistan            1000        1200   2200
#>  2 Albania                7886         950   8836
#>  3 Algeria               95000        1361  96361
#>  4 American Samoa         3047          20   3067
#>  5 Andorra                   0           0      0
#>  6 Angola               486490         655 487145
#>  7 Antigua and Barbuda    3000          10   3010
#>  8 Argentina            755226        3673 758899
#>  9 Armenia                3758       16381  20139
#> 10 Aruba                   142           0    142
#> # … with 206 more rows
#> # ℹ Use `print(n = ...)` to see more rows
#> # A tibble: 216 × 5
#>    country             capture aquaculture  total continent
#>    <chr>                 <dbl>       <dbl>  <dbl> <chr>    
#>  1 Afghanistan            1000        1200   2200 Asia     
#>  2 Albania                7886         950   8836 Europe   
#>  3 Algeria               95000        1361  96361 Africa   
#>  4 American Samoa         3047          20   3067 Oceania  
#>  5 Andorra                   0           0      0 Europe   
#>  6 Angola               486490         655 487145 Africa   
#>  7 Antigua and Barbuda    3000          10   3010 <NA>     
#>  8 Argentina            755226        3673 758899 Americas 
#>  9 Armenia                3758       16381  20139 Asia     
#> 10 Aruba                   142           0    142 Americas 
#> # … with 206 more rows
#> # ℹ Use `print(n = ...)` to see more rows
fisheries %>% filter(is.na(continent))   # same result - countries not belonging to a continent
#> # A tibble: 20 × 5
#>    country                          capture aquaculture   total continent
#>    <chr>                              <dbl>       <dbl>   <dbl> <chr>    
#>  1 Antigua and Barbuda                 3000          10    3010 <NA>     
#>  2 Bosnia and Herzegovina               305        4564    4869 <NA>     
#>  3 Czech Republic                      3507       20952   24459 <NA>     
#>  4 Democratic Republic of the Congo  237372        3161  240533 <NA>     
#>  5 Eswatini                              65         100     165 <NA>     
#>  6 Federated States of Micronesia     88397           0   88397 <NA>     
#>  7 Ivory Coast                        67500        4701   72201 <NA>     
#>  8 Jersey and Guernsey                 2985        1499    4484 <NA>     
#>  9 Macao                               1500           0    1500 <NA>     
#> 10 Myanmar                          2072390     1017644 3090034 <NA>     
#> 11 North Macedonia                      306         986    1292 <NA>     
#> 12 Palestine                           3306         280    3586 <NA>     
#> 13 Republic of the Congo              86748         177   86925 <NA>     
#> 14 Saint Kitts and Nevis              65734           1   65735 <NA>     
#> 15 Saint Lucia                         2097          32    2129 <NA>     
#> 16 Saint Vincent and the Grenadines   23077           0   23077 <NA>     
#> 17 São Tomé and Príncipe              11750           0   11750 <NA>     
#> 18 Trinidad and Tobago                13027          11   13038 <NA>     
#> 19 Turks and Caicos Islands            2780           0    2780 <NA>     
#> 20 US Virgin Islands                    551           8     559 <NA>
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#TbjMaWatrpAKvvdnZ2HT">Solution</button>

<div class="modal fade bs-example-modal-lg" id="Qve01IGpigNBDhGEa930" tabindex="-1" role="dialog" aria-labelledby="Qve01IGpigNBDhGEa930-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Qve01IGpigNBDhGEa930-title">Hint 2</h4></div><div class="modal-body">

```r
fisheries %>% 
  anti_join(___)      # countries not belonging to a continent
fisheries <- fisheries %>% 
  print() %>% 
  left_join(___) %>% 
  print()
fisheries %>% 
  filter(is.na(___))   # same result - countries not belonging to a continent
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Qve01IGpigNBDhGEa930">Hint 2</button>

<div class="modal fade bs-example-modal-lg" id="on0aJbDw678IbCSSNz0r" tabindex="-1" role="dialog" aria-labelledby="on0aJbDw678IbCSSNz0r-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="on0aJbDw678IbCSSNz0r-title">Hint 1</h4></div><div class="modal-body">

<p>You could use <code>anti_join</code> to find missing values. Use <code>left_join</code> to join the datasets.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#on0aJbDw678IbCSSNz0r">Hint 1</button>

1) Use a mutating join to add a continent column to the `fisheries` dataset. Are there some countries which do not belong to a continent? 




<div class="modal fade bs-example-modal-lg" id="5BRjB8DAqjZr9NJ1OhFe" tabindex="-1" role="dialog" aria-labelledby="5BRjB8DAqjZr9NJ1OhFe-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="5BRjB8DAqjZr9NJ1OhFe-title">Solution</h4></div><div class="modal-body">

```r
fisheries <- fisheries %>%
  filter(total > 100000)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#5BRjB8DAqjZr9NJ1OhFe">Solution</button>

<div class="modal fade bs-example-modal-lg" id="AlT3lsabQ3eVmXRpf37p" tabindex="-1" role="dialog" aria-labelledby="AlT3lsabQ3eVmXRpf37p-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="AlT3lsabQ3eVmXRpf37p-title">Hint</h4></div><div class="modal-body">

```r
fisheries <- ___ %>%
  filter(___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#AlT3lsabQ3eVmXRpf37p">Hint</button>

2) Filter out countries whose total harvest was less than 100,000 tons.




<div class="modal fade bs-example-modal-lg" id="OVKcZDdMRODFAQbPuHDY" tabindex="-1" role="dialog" aria-labelledby="OVKcZDdMRODFAQbPuHDY-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="OVKcZDdMRODFAQbPuHDY-title">Solution</h4></div><div class="modal-body">

```r
fisheries %>% filter(is.na(continent))
#> # A tibble: 2 × 5
#>   country                          capture aquaculture   total continent
#>   <chr>                              <dbl>       <dbl>   <dbl> <chr>    
#> 1 Democratic Republic of the Congo  237372        3161  240533 <NA>     
#> 2 Myanmar                          2072390     1017644 3090034 <NA>
fisheries <- fisheries %>%
  mutate(continent = case_when(
    country == "Democratic Republic of the Congo" ~ "Africa",
    country == "Hong Kong"                        ~ "Asia",
    country == "Myanmar"                          ~ "Asia",
    TRUE                                          ~ continent
    )
  )
fisheries %>% filter(is.na(continent))
#> # A tibble: 0 × 5
#> # … with 5 variables: country <chr>, capture <dbl>, aquaculture <dbl>, total <dbl>, continent <chr>
#> # ℹ Use `colnames()` to see all variable names
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#OVKcZDdMRODFAQbPuHDY">Solution</button>

<div class="modal fade bs-example-modal-lg" id="LwdRH2XJToD5nAn2qotN" tabindex="-1" role="dialog" aria-labelledby="LwdRH2XJToD5nAn2qotN-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="LwdRH2XJToD5nAn2qotN-title">Hint</h4></div><div class="modal-body">

```r
fisheries %>% filter(is.na(continent))
fisheries <- ___ %>%
  mutate(continent = case_when(
    country == ___ ~ "Africa",
    country == ___ ~ "Asia",
    country == ___ ~ "Asia",
    TRUE           ~ continent
    )
  )
fisheries %>% filter(is.na(continent))
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#LwdRH2XJToD5nAn2qotN">Hint</button>

3) If still any countries not belonging to a continent then add them to the closest continent.




<div class="modal fade bs-example-modal-lg" id="IuJvbajOMQKhGqvS0wQp" tabindex="-1" role="dialog" aria-labelledby="IuJvbajOMQKhGqvS0wQp-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="IuJvbajOMQKhGqvS0wQp-title">Solution</h4></div><div class="modal-body">

```r
fisheries <- fisheries %>% 
  mutate(aquaculture_perc = aquaculture / total)
```


<p>The percentage of fish harvest done using aquaculture.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#IuJvbajOMQKhGqvS0wQp">Solution</button>

<div class="modal fade bs-example-modal-lg" id="VT83eN14pj2i0bDcYVFM" tabindex="-1" role="dialog" aria-labelledby="VT83eN14pj2i0bDcYVFM-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="VT83eN14pj2i0bDcYVFM-title">Hint</h4></div><div class="modal-body">

```r
fisheries <- ___ %>% 
  mutate(___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#VT83eN14pj2i0bDcYVFM">Hint</button>

4) Add column `aquaculture_perc = aquaculture / total` and explain the variable.





<div class="modal fade bs-example-modal-lg" id="HBd08VSWgzwxgjxCf6Uk" tabindex="-1" role="dialog" aria-labelledby="HBd08VSWgzwxgjxCf6Uk-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="HBd08VSWgzwxgjxCf6Uk-title">Solution</h4></div><div class="modal-body">

```r
fisheries %>%                 
  group_by(continent) %>%                      
  summarize(mean_ap = mean(aquaculture_perc))           
#> # A tibble: 5 × 2
#>   continent mean_ap
#>   <chr>       <dbl>
#> 1 Africa     0.0943
#> 2 Americas   0.192 
#> 3 Asia       0.367 
#> 4 Europe     0.165 
#> 5 Oceania    0.150
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#HBd08VSWgzwxgjxCf6Uk">Solution</button>

<div class="modal fade bs-example-modal-lg" id="096nNdlFNLhZ8IOWaJMv" tabindex="-1" role="dialog" aria-labelledby="096nNdlFNLhZ8IOWaJMv-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="096nNdlFNLhZ8IOWaJMv-title">Hint</h4></div><div class="modal-body">

```r
fisheries %>%                  # start with the fisheries data frame
  ___ %>%                      # group by continent
  ___(mean_ap = ___)           # calculate mean aquaculture
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#096nNdlFNLhZ8IOWaJMv">Hint</button>

5) Calculate the mean aquaculture percentage (we'll call it `mean_ap` for short) for continents in the fisheries data.




<div class="modal fade bs-example-modal-lg" id="XaFOeMSATv1NFZ4e3IJR" tabindex="-1" role="dialog" aria-labelledby="XaFOeMSATv1NFZ4e3IJR-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="XaFOeMSATv1NFZ4e3IJR-title">Solution</h4></div><div class="modal-body">

```r
fisheries_summary_continent <- fisheries %>%                 
  group_by(continent) %>%                      
  summarize(mean_ap = mean(aquaculture_perc), min_ap = min(aquaculture_perc), max_ap = max(aquaculture_perc)) %>% 
  print()
#> # A tibble: 5 × 4
#>   continent mean_ap  min_ap max_ap
#>   <chr>       <dbl>   <dbl>  <dbl>
#> 1 Africa     0.0943 0        0.803
#> 2 Americas   0.192  0        0.529
#> 3 Asia       0.367  0        0.782
#> 4 Europe     0.165  0.00682  0.618
#> 5 Oceania    0.150  0.0197   0.357
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#XaFOeMSATv1NFZ4e3IJR">Solution</button>

<div class="modal fade bs-example-modal-lg" id="RzbJrKftq5IWNqrgVn2G" tabindex="-1" role="dialog" aria-labelledby="RzbJrKftq5IWNqrgVn2G-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="RzbJrKftq5IWNqrgVn2G-title">Hint</h4></div><div class="modal-body">

```r
fisheries_summary_continent <- fisheries %>%    # start with the fisheries data frame
  ___ %>%                                       # group by continent
  ___(mean_ap = ___, min_ap = ___, ___)         # calculate mean aquaculture
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#RzbJrKftq5IWNqrgVn2G">Hint</button>

6) Now expand your calculations to also calculate the minimum and maximum 
aquaculture percentage for continents in the fisheries data and store the summary table in a data frame called `fisheries_summary_continent`. 




<div class="modal fade bs-example-modal-lg" id="CoqpG1dkVMJMMXePahtw" tabindex="-1" role="dialog" aria-labelledby="CoqpG1dkVMJMMXePahtw-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="CoqpG1dkVMJMMXePahtw-title">Solution</h4></div><div class="modal-body">

```r
fisheries_summary_continent %>%      
  arrange(desc(mean_ap))                             
#> # A tibble: 5 × 4
#>   continent mean_ap  min_ap max_ap
#>   <chr>       <dbl>   <dbl>  <dbl>
#> 1 Asia       0.367  0        0.782
#> 2 Americas   0.192  0        0.529
#> 3 Europe     0.165  0.00682  0.618
#> 4 Oceania    0.150  0.0197   0.357
#> 5 Africa     0.0943 0        0.803
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#CoqpG1dkVMJMMXePahtw">Solution</button>

<div class="modal fade bs-example-modal-lg" id="QdB4ZolZzzJANXohtiFJ" tabindex="-1" role="dialog" aria-labelledby="QdB4ZolZzzJANXohtiFJ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="QdB4ZolZzzJANXohtiFJ-title">Hint</h4></div><div class="modal-body">

```r
fisheries_summary_continent %>%      # start with the fisheries_summary_continent data frame
  ___                                # order in descending order of mean_ap
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#QdB4ZolZzzJANXohtiFJ">Hint</button>

7) Take the `fisheries_summary_continent` data frame and order the results in descending 
order of mean aquaculture percentage.




<div class="modal fade bs-example-modal-lg" id="kCHtA8jXXhelHzx1kML1" tabindex="-1" role="dialog" aria-labelledby="kCHtA8jXXhelHzx1kML1-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="kCHtA8jXXhelHzx1kML1-title">Solution</h4></div><div class="modal-body">

```r
ggplot(fisheries_summary_continent, 
       aes(y = reorder(continent, mean_ap), x = mean_ap)) +
  geom_col() +
  labs(
    x = "",
    y = "",
    title = "Average share of aquaculture by continent",
    subtitle = "out of total fisheries harvest",
    caption = "Source: bit.ly/2VrawTt"
  ) 
```

<img src="TFA_files/figure-html/unnamed-chunk-408-1.png" width="672" style="display: block; margin: auto;" />
<p>An example plot</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#kCHtA8jXXhelHzx1kML1">Solution</button>

8) If you already have read the module about visualizations, then try to make some relevant plots.






<!--chapter:end:13_r-transform.Rmd-->

---
output: html_document
editor_options: 
  chunk_output_type: console
---



[BSS]: https://bss.au.dk/en/

[course-help]: https://github.com/bss-osca/tfa/issues
[cran]: https://cloud.r-project.org
[cheatsheet-readr]: https://rawgit.com/rstudio/cheatsheets/master/data-import.pdf
[course-welcome-to-the-tidyverse]: https://github.com/rstudio-education/welcome-to-the-tidyverse

[DataCamp]: https://www.datacamp.com/
[datacamp-signup]: https://www.datacamp.com/groups/shared_links/cbaee6c73e7d78549a9e32a900793b2d5491ace1824efc1760a6729735948215
[datacamp-r-intro]: https://learn.datacamp.com/courses/free-introduction-to-r
[datacamp-r-rmarkdown]: https://campus.datacamp.com/courses/reporting-with-rmarkdown
[datacamp-r-communicating]: https://learn.datacamp.com/courses/communicating-with-data-in-the-tidyverse
[datacamp-r-communicating-chap3]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/introduction-to-rmarkdown
[datacamp-r-communicating-chap4]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/customizing-your-rmarkdown-report
[datacamp-r-intermediate]: https://learn.datacamp.com/courses/intermediate-r
[datacamp-r-intermediate-chap1]: https://campus.datacamp.com/courses/intermediate-r/chapter-1-conditionals-and-control-flow
[datacamp-r-intermediate-chap2]: https://campus.datacamp.com/courses/intermediate-r/chapter-2-loops
[datacamp-r-intermediate-chap3]: https://campus.datacamp.com/courses/intermediate-r/chapter-3-functions
[datacamp-r-intermediate-chap4]: https://campus.datacamp.com/courses/intermediate-r/chapter-4-the-apply-family
[datacamp-r-functions]: https://learn.datacamp.com/courses/introduction-to-writing-functions-in-r
[datacamp-r-tidyverse]: https://learn.datacamp.com/courses/introduction-to-the-tidyverse
[datacamp-r-strings]: https://learn.datacamp.com/courses/string-manipulation-with-stringr-in-r
[datacamp-r-dplyr]: https://learn.datacamp.com/courses/data-manipulation-with-dplyr
[datacamp-r-dplyr-bakeoff]: https://learn.datacamp.com/courses/working-with-data-in-the-tidyverse
[datacamp-r-ggplot2-intro]: https://learn.datacamp.com/courses/introduction-to-data-visualization-with-ggplot2
[datacamp-r-ggplot2-intermediate]: https://learn.datacamp.com/courses/intermediate-data-visualization-with-ggplot2
[dplyr-cran]: https://CRAN.R-project.org/package=dplyr
[debug-in-r]: https://rstats.wtf/debugging-r-code.html

[excel-vs-r]: https://www.jessesadler.com/post/excel-vs-r/

[google-form]: https://forms.gle/s39GeDGV9AzAXUo18
[google-grupper]: https://docs.google.com/spreadsheets/d/1DHxthd5AQywAU4Crb3hM9rnog2GqGQYZ2o175SQgn_0/edit?usp=sharing
[GitHub]: https://github.com/
[git-install]: https://git-scm.com/downloads
[github-actions]: https://github.com/features/actions
[github-pages]: https://pages.github.com/

[happy-git]: https://happygitwithr.com
[hg-install-git]: https://happygitwithr.com/install-git.html
[hg-why]: https://happygitwithr.com/big-picture.html#big-picture
[hg-github-reg]: https://happygitwithr.com/github-acct.html#github-acct
[hg-git-install]: https://happygitwithr.com/install-git.html#install-git
[hg-exist-github-first]: https://happygitwithr.com/existing-github-first.html
[hg-exist-github-last]: https://happygitwithr.com/existing-github-last.html
[hg-credential-helper]: https://happygitwithr.com/credential-caching.html
[hypothes.is]: https://web.hypothes.is/

[osca-programme]: https://kandidat.au.dk/en/operationsandsupplychainanalytics/

[Peergrade]: https://peergrade.io
[peergrade-signup]: https://app.peergrade.io/join
[point-and-click]: https://en.wikipedia.org/wiki/Point_and_click
[pkg-bookdown]: https://bookdown.org/yihui/bookdown/
[pkg-openxlsx]: https://ycphs.github.io/openxlsx/index.html
[pkg-ropensci-writexl]: https://docs.ropensci.org/writexl/
[pkg-jsonlite]: https://cran.r-project.org/web/packages/jsonlite/index.html

[R]: https://www.r-project.org
[RStudio]: https://rstudio.com
[rstudio-cloud]: https://rstudio.cloud/spaces/176810/join?access_code=LSGnG2EXTuzSyeYaNXJE77vP33DZUoeMbC0xhfCz
[r-cloud-mod12]: https://rstudio.cloud/spaces/176810/project/2963819
[r-cloud-mod13]: https://rstudio.cloud/spaces/176810/project/3020139
[r-cloud-mod14]: https://rstudio.cloud/spaces/176810/project/3020322
[r-cloud-mod15]: https://rstudio.cloud/spaces/176810/project/3020509
[r-cloud-mod16]: https://rstudio.cloud/spaces/176810/project/3026754
[r-cloud-mod17]: https://rstudio.cloud/spaces/176810/project/3034015
[r-cloud-mod18]: https://rstudio.cloud/spaces/176810/project/3130795
[r-cloud-mod19]: https://rstudio.cloud/spaces/176810/project/3266132
[rstudio-download]: https://rstudio.com/products/rstudio/download/#download
[rstudio-customizing]: https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio
[rstudio-key-shortcuts]: https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts
[rstudio-workbench]: https://www.rstudio.com/wp-content/uploads/2014/04/rstudio-workbench.png
[r-markdown]: https://rmarkdown.rstudio.com/
[ropensci-writexl]: https://docs.ropensci.org/writexl/
[r4ds-pipes]: https://r4ds.had.co.nz/pipes.html
[r4ds-factors]: https://r4ds.had.co.nz/factors.html
[r4ds-strings]: https://r4ds.had.co.nz/strings.html
[r4ds-iteration]: https://r4ds.had.co.nz/iteration.html

[stat-545]: https://stat545.com
[stat-545-functions-part1]: https://stat545.com/functions-part1.html
[stat-545-functions-part2]: https://stat545.com/functions-part2.html
[stat-545-functions-part3]: https://stat545.com/functions-part3.html
[slides-welcome]: https://bss-osca.github.io/tfa/slides/00-tfa_welcome.html
[slides-m1-3]: https://bss-osca.github.io/tfa/slides/01-welcome_r_part.html
[slides-m4-5]: https://bss-osca.github.io/tfa/slides/02-programming.html
[slides-m6-8]: https://bss-osca.github.io/tfa/slides/03-transform.html
[slides-m9]: https://bss-osca.github.io/tfa/slides/04-plot.html
[slides-m83]: https://bss-osca.github.io/tfa/slides/05-joins.html

[tidyverse-main-page]: https://www.tidyverse.org
[tidyverse-packages]: https://www.tidyverse.org/packages/
[tidyverse-core]: https://www.tidyverse.org/packages/#core-tidyverse
[tidyverse-ggplot2]: https://ggplot2.tidyverse.org/
[tidyverse-dplyr]: https://dplyr.tidyverse.org/
[tidyverse-tidyr]: https://tidyr.tidyverse.org/
[tidyverse-readr]: https://readr.tidyverse.org/
[tidyverse-purrr]: https://purrr.tidyverse.org/
[tidyverse-tibble]: https://tibble.tidyverse.org/
[tidyverse-stringr]: https://stringr.tidyverse.org/
[tidyverse-forcats]: https://forcats.tidyverse.org/
[tidyverse-readxl]: https://readxl.tidyverse.org
[tidyverse-googlesheets4]: https://googlesheets4.tidyverse.org/index.html
[tutorial-markdown]: https://commonmark.org/help/tutorial/

[Udemy]: https://www.udemy.com/

[vba-yt-course1]: https://www.youtube.com/playlist?list=PLpOAvcoMay5S_hb2D7iKznLqJ8QG_pde0
[vba-course1-hello]: https://youtu.be/f42OniDWaIo

[vba-yt-course2]: https://www.youtube.com/playlist?list=PL3A6U40JUYCi4njVx59-vaUxYkG0yRO4m
[vba-course2-devel-tab]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-editor]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-project]: https://youtu.be/fp6PTbU7bXo
[vba-course2-devel-properties]: https://youtu.be/ks2QYKAd9Xw
[vba-course2-devel-hello]: https://youtu.be/EQ6tDWBc8G4

[video-install]: https://vimeo.com/415501284
[video-rstudio-intro]: https://vimeo.com/416391353
[video-packages]: https://vimeo.com/416743698
[video-projects]: https://vimeo.com/319318233
[video-r-intro-p1]: https://www.youtube.com/watch?v=vGY5i_J2c-c
[video-r-intro-p2]: https://www.youtube.com/watch?v=w8_XdYI3reU
[video-r-intro-p3]: https://www.youtube.com/watch?v=NuY6jY4qE7I
[video-subsetting]: https://www.youtube.com/watch?v=hWbgqzsQJF0&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10&t=0s
[video-datatypes]: https://www.youtube.com/watch?v=5AQM-yUX9zg&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10
[video-control-structures]: https://www.youtube.com/watch?v=s_h9ruNwI_0
[video-conditional-loops]: https://www.youtube.com/watch?v=2evtsnPaoDg
[video-functions]: https://www.youtube.com/watch?v=ffPeac3BigM
[video-tibble-vs-df]: https://www.youtube.com/watch?v=EBk6PnvE1R4
[video-dplyr]: https://www.youtube.com/watch?v=aywFompr1F4

[wiki-snake-case]: https://en.wikipedia.org/wiki/Snake_case
[wiki-camel-case]: https://en.wikipedia.org/wiki/Camel_case
[wiki-interpreted]: https://en.wikipedia.org/wiki/Interpreted_language
[wiki-literate-programming]: https://en.wikipedia.org/wiki/Literate_programming
[wiki-csv]: https://en.wikipedia.org/wiki/Comma-separated_values
[wiki-json]: https://en.wikipedia.org/wiki/JSON

# (PART) Visualization {-} 

# Data visualization using ggplot {#mod-r-plot}

This module considers visualization of your data using the [ggplot2][tidyverse-ggplot2] package which is a part of [tidyverse][tidyverse-main-page]. R has several systems for making plots, but ggplot2 is one of the most elegant and most versatile. Using ggplot2 you can make plots faster by learning one system and applying it in many different plot types.

We are all different and you may like different learning styles compared to others. In the learning path diagram, there may be links to alternative online content. Note this is an alternative to the standard learning path that you may use instead. The learning path may also have extra content, that is not a part of syllabus, you can have a look at. 


```{=html}
<div id="htmlwidget-1b9cc4e3583eabe2e2cf" style="width:100%;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-1b9cc4e3583eabe2e2cf">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"💡 Plot intro\", URL = \"#r-plot-intro\", tooltip = \"The interactive DataCamp course Introduction to data visualization with ggplot2.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"0,2!\"] \n  \"2\" [label = \"📖 Multiple plots\", URL = \"#r-plot-multi\", tooltip = \"Multiple plots\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"2,2!\"] \n  \"3\" [label = \"📖 Saving plots\", URL = \"#r-plot-save\", tooltip = \"Saving plots\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"4,2!\"] \n  \"4\" [label = \"💻 Exercises\", URL = \"#ex-r-plot\", tooltip = \"Exercises\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"6,2!\"] \n  \"5\" [label = \"📖 Plotting\", URL = \"https://stat545.com/\", tooltip = \"A detailed introduction to visualization using ggplot2 is given in Chapters 22-29 in Bryan (2017).\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"0,4!\"] \n  \"6\" [label = \"📖 Plotting\", URL = \"https://r4ds.had.co.nz/data-visualisation.html\", tooltip = \"A short introduction is given in Chapter 3 in Wickham (2017).\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkOrange4\", pos = \"0,0!\"] \n  \"7\" [label = \"💡 Adv. plotting\", URL = \"https://app.datacamp.com/learn/courses/intermediate-data-visualization-with-ggplot2\", tooltip = \"The interactive DataCamp course Intermediate Data Visualization with ggplot2.\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"PeachPuff3\", pos = \"2,4!\"] \n  \"8\" [label = \"\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"0.5\", fontname = \"Helvetica\", shape = \"rect\", height = \"1\", width = \"6\", fillcolor = \"#F0F8FF\", pos = \"4.15,0.21!\"] \n  \"9\" [label = \"Color:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"0.8\", fillcolor = \"#FFFFFE\", pos = \"1.52,0.55!\"] \n  \"10\" [label = \"mandatory\", URL = \"\", tooltip = \"Mandatory syllabus.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkSeaGreen4\", pos = \"1.75,0.15!\"] \n  \"11\" [label = \"alternative\", URL = \"\", tooltip = \"Alternative syllabus if you prefer another learning style.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkOrange4\", pos = \"2.75,0.15!\"] \n  \"12\" [label = \"extra\", URL = \"\", tooltip = \"Extra learning if you are interested (not part of syllabus).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"PeachPuff3\", pos = \"3.75,0.15!\"] \n  \"13\" [label = \"Shape:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"1\", fillcolor = \"#FFFFFE\", pos = \"4.95,0.55!\"] \n  \"14\" [label = \"non-interactive\", URL = \"\", tooltip = \"Non-interactive learning content (e.g. reading).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"1\", fillcolor = \"Grey40\", pos = \"5.25,0.15!\"] \n  \"15\" [label = \"interactive\", URL = \"\", tooltip = \"Interactive learning content (tutorial, exercises etc.).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"egg\", width = \"1\", fillcolor = \"Grey40\", pos = \"6.5,0.15!\"] \n\"1\"->\"2\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"5\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"6\" [color = \"black\", arrowhead = \"vee\"] \n\"1\"->\"7\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"3\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"4\" [color = \"black\", arrowhead = \"vee\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
```

<!-- * A detailed introduction to visualization using ggplot2 is given in Chapters 22-29 in @stat545.  -->
<!-- * A short introduction is given in [Chapter 3](https://r4ds.had.co.nz/data-visualisation.html) in @r4ds. -->
<!-- * Further advanded possibilities for ggplot2 are given in the interactive DataCamp course [Intermediate Data Visualization with ggplot2][datacamp-r-ggplot2-intermediate]. -->


## Learning outcomes {#lo-plot}

By the end of this module, you are expected to:

* Know how to create basic plots using ggplot.
* Formulate the ideas behind the grammar of graphics.
* Explain the idea behind aesthetics such as color, fill, and line type.
* Add geometries to a plot such as a histogram, a boxplot, a barplot, a scatter plot, and a line.
* Understand how themes can be used to modify the overall look of a plot.
* Combine multiple plots into a single graphic.
* Save plots as variables and different image files.

The learning outcomes relate to the [overall learning goals](#lg-course) number 7, 11-14 and 18 of the course.

<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->

## Introduction to data visualization {#r-plot-intro}

The package [ggplot2][tidyverse-ggplot2] is a plotting package that makes it simple to create complex plots from data in a data frame. It provides an interface for specifying which variables to plot, how they are displayed, and general visual properties. Hence, only minimal changes are needed, if the underlying data change or if we decide to change from a bar plot to a scatterplot. 

The package implements the grammar of graphics, a coherent system for describing and building layered plots. A plot is built step by step by adding new layers. Adding layers in this fashion allows for extensive flexibility and customization of plots.

An excellent introduction to data visualization using [ggplot2][tidyverse-ggplot2] is given in the interactive DataCamp course [Introduction to data visualization with ggplot2][datacamp-r-ggplot2-intro]. Please complete the course before continuing. 

Note that there is a difference between using the pipe `%>%` operator which passes the output of the previous line of code as the first input of the next line of code and the `+` operator used between **ggplot2** functions for "layering". That is, you create the plot in layers, separated by `+`.


## Combining plots into one using _patchwork_  {#r-plot-multi}

You can combine separate ggplots into the same graphic using the _patchwork_ package. You can install _patchwork_ from CRAN using `install.packages('patchwork')`. 

The usage is simple. Plots in two rows: 




```r
library(ggplot2)
library(patchwork)
p1 <- ggplot(mtcars) + geom_point(aes(mpg, disp))
p2 <- ggplot(mtcars) + geom_boxplot(aes(gear, disp, group = gear))
p1 + p2
```

<img src="TFA_files/figure-html/unnamed-chunk-412-1.png" width="672" style="display: block; margin: auto;" />

The package provides rich support for arbitrarily complex layouts. Code for nesting three 
plots on top of a third:


```r
p3 <- ggplot(mtcars) + geom_smooth(aes(disp, qsec))
p4 <- ggplot(mtcars) + geom_bar(aes(carb))
(p1 | p2 | p3) /
      p4
```

<img src="TFA_files/figure-html/unnamed-chunk-413-1.png" width="672" style="display: block; margin: auto;" />

For further examples see the [documentation pages](https://patchwork.data-imaginist.com/).


## Saving graphics {#r-plot-save}

In general, when you do analytics using R Markdown, there is no need to save your graphics. This is done automatically. However, in a few cases you may need to save you graphics in different formats. Let us consider a simple plot:


```r
library(tidyverse)
p <- ggplot(mpg, aes(displ, hwy, colour = class)) + 
  geom_point()
p  # print it out
```

<img src="TFA_files/figure-html/unnamed-chunk-414-1.png" width="672" style="display: block; margin: auto;" />

To save the plot as a bitmap image (png, jpeg etc) have a look at the documentation (`?png`). Let us try to save the plot as a png file.


```r
png("test1.png")  # open png device for writing 
p
dev.off()        # close device
#> quartz_off_screen 
#>                 2
png("test2.png", width = 1200, height = 600)   # use other output width and height in px
p
dev.off()
#> quartz_off_screen 
#>                 2
png("test3.png", width = 1200, height = 900)   # save a patchwork plot
(p1 | p2 | p3) /
      p4
dev.off()
#> quartz_off_screen 
#>                 2
# browseURL("test1.png")  # to have a look at the file
# browseURL("test3.png")  # to have a look at the file
```

To save the plot as a pdf use


```r
pdf("test1.pdf")  # open pdf device for writing 
p
dev.off()        # close device
#> quartz_off_screen 
#>                 2
# browseURL("test1.pdf")  # to have a look at the file
```

If you use LaTeX you may use the _tikzDevice_ package to save plots as TikZ.




## Recap {#rc-r-plot}

* The tidyverse package [ggplot2][tidyverse-ggplot2] is an R package for producing data visualizations. It is based on the Grammar of Graphics by @gramma. 
* The grammar of graphics is a coherent system for describing and building layered plots.
  - Graphics are made by grammatical elements such as data, aesthetics, geometries, scales, facets, and themes.
  - Plots are made though aesthetic mappings. That is, variables are mapped to x or y position using aesthetics attributes such as color, shape, or size.
  - A plot is built step by step by adding new layers. Adding layers in this fashion allows for extensive flexibility and customization of plots.
  - Together, the data, aesthetic mappings, and geometric object form a layer.
  - A plot may have multiple layers, for example, when we overlay a scatterplot with a smoothed line.
* Aesthetics are add in `ggplot` using the `aes` function or alternatively in `geom_` functions.
* Geometries (e.g. a boxplot or line) are added to a plot using the `geom_` functions.
* Themes can be applied to the plot using the `theme_` functions and control all the non-data ink used to modify the overall look of a plot.
* Separate ggplots can be combined into the same graphic using the _patchwork_ package. 
* Save plots as variables and different image files using the device functions such as `png` and `pdf`.
* The pipe `%>%` operator is used to "pipe" the output of the previous line of code as the first input of the next line of code.
* The `+` operator in **ggplot2** functions is used for "layering". This means you create the plot in layers, separated by `+`.
* The 'Data visualization with ggplot2' cheatsheet is very useful. Find the newest version in RStudio **Help > Cheatsheets**.
* A good place to see examples are on the [main reference page](https://ggplot2.tidyverse.org/reference/index.html). Follow the link to the function of interest and have a look at the examples.

You may also have a look at the [slides for this module](https://bss-osca.github.io/tfa/slides/08-01_r-plot-slides.html).


## Exercises {#ex-r-plot}

Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the [help page](#help). Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution! 

[Link to the project on RStudio Cloud for this module][r-cloud-mod18]. 



### Exercise (gapminder) {#ex-gapminder2}

Use the *exercise R Markdown template* to solve this exercise (**File > New File > R Markdown...**, select **From template** and then **TFA Exercise**).

In this exercise, we will demonstrate how relatively simple ggplot2 code can create insightful and aesthetically pleasing plots. As motivation we will create plots that help us better understand trends in world health and economics. 

[Hans Rosling](https://en.wikipedia.org/wiki/Hans_Rosling) was the co-founder of the [Gapminder Foundation](http://www.gapminder.org/), an organization dedicated to educating the public by using data to dispel common myths about the so-called developing world. Hans Rosling conveyed actual data-based trends in a dramatic way of his own, using effective data visualization. Here we will try to answer two questions:

* Is it a fair characterization of today's world to say it is divided into Western rich nations and the developing world in Africa, Asia, and Latin America? 
* Has income inequality across countries worsened during the last 40 years? 

To answer these questions, we will be using the `gapminder` dataset provided in the dslabs package. This dataset was created using a number of spreadsheets available from the Gapminder Foundation. You can access the table like this:


```r
library(tidyverse)
library(dslabs)
data(gapminder)
gapminder %>% as_tibble()
#> # A tibble: 10,545 × 9
#>    country              year infant_mortality life_expecta…¹ ferti…² popul…³      gdp conti…⁴ region
#>    <fct>               <int>            <dbl>          <dbl>   <dbl>   <dbl>    <dbl> <fct>   <fct> 
#>  1 Albania              1960            115.            62.9    6.19  1.64e6 NA       Europe  South…
#>  2 Algeria              1960            148.            47.5    7.65  1.11e7  1.38e10 Africa  North…
#>  3 Angola               1960            208             36.0    7.32  5.27e6 NA       Africa  Middl…
#>  4 Antigua and Barbuda  1960             NA             63.0    4.43  5.47e4 NA       Americ… Carib…
#>  5 Argentina            1960             59.9           65.4    3.11  2.06e7  1.08e11 Americ… South…
#>  6 Armenia              1960             NA             66.9    4.55  1.87e6 NA       Asia    Weste…
#>  7 Aruba                1960             NA             65.7    4.82  5.42e4 NA       Americ… Carib…
#>  8 Australia            1960             20.3           70.9    3.45  1.03e7  9.67e10 Oceania Austr…
#>  9 Austria              1960             37.3           68.8    2.7   7.07e6  5.24e10 Europe  Weste…
#> 10 Azerbaijan           1960             NA             61.3    5.57  3.90e6 NA       Asia    Weste…
#> # … with 10,535 more rows, and abbreviated variable names ¹​life_expectancy, ²​fertility,
#> #   ³​population, ⁴​continent
#> # ℹ Use `print(n = ...)` to see more rows
```

We start by testing our knowledge regarding differences in child mortality across different countries. For each of the six pairs of countries below, which country do you think had the highest child mortality rates in 2015? Which pairs do you think are most similar?

* Sri Lanka or Turkey
* Poland or South Korea
* Malaysia or Russia
* Pakistan or Vietnam
* Thailand or South Africa

When answering these questions without data, the non-European countries are typically picked as having higher child mortality rates: Sri Lanka over Turkey, South Korea over Poland, and Malaysia over Russia. It is also common to assume that countries considered to be part of the developing world: Pakistan, Vietnam, Thailand, and South Africa, have similarly high mortality rates. 

To answer these questions __with data__, we can use __dplyr__. For example, for the first comparison we see that:


```r
gapminder %>%
  filter(year == 2015 & country %in% c("Sri Lanka","Turkey")) %>%
  select(country, infant_mortality)
#>     country infant_mortality
#> 1 Sri Lanka              8.4
#> 2    Turkey             11.6
```
Turkey has the higher infant mortality rate.

We can use this code on all comparisons and find the following:
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> country </th>
   <th style="text-align:right;"> infant mortality </th>
   <th style="text-align:left;"> country </th>
   <th style="text-align:right;"> infant mortality </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Sri Lanka </td>
   <td style="text-align:right;"> 8.4 </td>
   <td style="text-align:left;"> Turkey </td>
   <td style="text-align:right;"> 11.6 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Poland </td>
   <td style="text-align:right;"> 4.5 </td>
   <td style="text-align:left;"> South Korea </td>
   <td style="text-align:right;"> 2.9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Malaysia </td>
   <td style="text-align:right;"> 6.0 </td>
   <td style="text-align:left;"> Russia </td>
   <td style="text-align:right;"> 8.2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pakistan </td>
   <td style="text-align:right;"> 65.8 </td>
   <td style="text-align:left;"> Vietnam </td>
   <td style="text-align:right;"> 17.3 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Thailand </td>
   <td style="text-align:right;"> 10.5 </td>
   <td style="text-align:left;"> South Africa </td>
   <td style="text-align:right;"> 33.6 </td>
  </tr>
</tbody>
</table>

We see that the European countries on this list have higher child mortality rates: Poland has a higher rate than South Korea, and Russia has a higher rate than Malaysia. We also see that Pakistan has a much higher rate than Vietnam, and South Africa has a much higher rate than Thailand. It turns out that when Hans Rosling gave this quiz to educated groups of people, the average score was less than 2.5 out of 5, worse than what they would have obtained had they guessed randomly. This implies that we are misinformed. We will try to use visualization to help us being more informed.



#### The west vs. the developing world {-}

There is a preconceived notion that the world is divided into two groups: the Western world (Western Europe and North America), characterized by long life spans and small families, versus the developing world (Africa, Asia, and Latin America) characterized by short life spans and large families. But do the data support this dichotomous view?



<div class="modal fade bs-example-modal-lg" id="8oiPA0LBYaHvhHibPA19" tabindex="-1" role="dialog" aria-labelledby="8oiPA0LBYaHvhHibPA19-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="8oiPA0LBYaHvhHibPA19-title">Solution</h4></div><div class="modal-body">

```r
filter(gapminder, year == 1962) %>%
  ggplot( aes(fertility, life_expectancy, color = continent)) +
  geom_point() 
```

<img src="TFA_files/figure-html/unnamed-chunk-420-1.png" width="672" style="display: block; margin: auto;" />
<p>Most points fall into two distinct categories:</p>

<ol>
<li>Life expectancy around 70 years and 3 or fewer children per family.</li>
<li>Life expectancy lower than 65 years and more than 5 children per family.</li>
<li>Countries are from the regions we expect.</li>
</ol>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#8oiPA0LBYaHvhHibPA19">Solution</button>


<div class="modal fade bs-example-modal-lg" id="aD2urpbinrhKUmPaI9HC" tabindex="-1" role="dialog" aria-labelledby="aD2urpbinrhKUmPaI9HC-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="aD2urpbinrhKUmPaI9HC-title">Hint</h4></div><div class="modal-body">

```r
filter(gapminder, year == ___) %>%
  ggplot( aes(___, ___, color = ___)) +
  geom_point() 
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#aD2urpbinrhKUmPaI9HC">Hint</button>

   1) Make a scatterplot of life expectancy versus fertility rates (average number of children per woman) in 1962. Use continent as color aesthetic. 
   
   


<div class="modal fade bs-example-modal-lg" id="DWvaGNY9f10fCN9hc3P6" tabindex="-1" role="dialog" aria-labelledby="DWvaGNY9f10fCN9hc3P6-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="DWvaGNY9f10fCN9hc3P6-title">Solution</h4></div><div class="modal-body">

```r
filter(gapminder, year %in% c(1962, 2012)) %>%
  ggplot(aes(fertility, life_expectancy, col = continent)) +
  geom_point() +
  facet_grid(cols = vars(year))
```

<img src="TFA_files/figure-html/unnamed-chunk-422-1.png" width="672" style="display: block; margin: auto;" />
<p>This plot clearly shows that the majority of countries have moved from the <em>developing world</em> cluster to the <em>western world</em> one. In 2012, the western versus developing world view no longer makes sense. This is particularly clear when comparing Europe to Asia, the latter of which includes several countries that have made great improvements.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#DWvaGNY9f10fCN9hc3P6">Solution</button>


<div class="modal fade bs-example-modal-lg" id="OSc4L1Lmjo39eOB77cVU" tabindex="-1" role="dialog" aria-labelledby="OSc4L1Lmjo39eOB77cVU-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="OSc4L1Lmjo39eOB77cVU-title">Hint</h4></div><div class="modal-body">

```r
filter(gapminder, ___ %in% c(1962, 2012)) %>%
  ggplot(aes(___, ___, col = ___)) +
  geom_point() +
  facet_grid(cols = vars(___))
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#OSc4L1Lmjo39eOB77cVU">Hint</button>

2) In 1962, "the West versus developing world" view was grounded in some reality. Is this still the case 50 years later? We could easily plot the 2012 data in the same way we did for 1962. To make comparisons, side by side plots are preferable. In __ggplot2__, we can achieve this by _faceting_ variables and making a plot for each year. That is, you must filter by years 1962 and 2012 and add the layer `facet_grid`, which automatically separates the plots.


   

<div class="modal fade bs-example-modal-lg" id="sBlD98sfSiheuCQ29hjQ" tabindex="-1" role="dialog" aria-labelledby="sBlD98sfSiheuCQ29hjQ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="sBlD98sfSiheuCQ29hjQ-title">Solution</h4></div><div class="modal-body">

```r
years <- c(1962, 1970, 1980, 1990, 2000, 2012)
continents <- c("Europe", "Asia")
gapminder %>% 
  filter(year %in% years & continent %in% continents) %>%
  ggplot( aes(fertility, life_expectancy, col = continent)) +
  geom_point() +
  facet_wrap(vars(year)) 
```

<img src="TFA_files/figure-html/unnamed-chunk-424-1.png" width="672" style="display: block; margin: auto;" />
<p>The plot clearly shows how most Asian countries have improved at a much faster rate than European ones.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#sBlD98sfSiheuCQ29hjQ">Solution</button>


<div class="modal fade bs-example-modal-lg" id="LU1qeBXsELmE4PCecP9B" tabindex="-1" role="dialog" aria-labelledby="LU1qeBXsELmE4PCecP9B-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="LU1qeBXsELmE4PCecP9B-title">Hint</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(year %in% ___ & continent %in% ___) %>%
  ggplot(aes(___)) +
  geom_point() +
  facet_wrap(___) 
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#LU1qeBXsELmE4PCecP9B">Hint</button>
   
   3) To explore the transformation through the years, make a plot for the years 1962, 1970, 1980, 1990, 2000, and 2012 considering Europe and Asia. How has Asia transformed through the years compared to Europe? Since we consider many years, we will not want all the plots on the same row. Instead, we will want to use multiple rows and columns. The function `facet_wrap` permits us to do this by automatically wrapping the series of plots.
      
  
<div class = "box">

#### Infobox - Scales {-}

The default choice of the range of the axes is important. When not using `facet`, this range is determined by the data shown in the plot. When using `facet`, this range is determined by the data shown in all plots and therefore kept fixed across plots. This makes comparisons across plots much easier. For example, in the above plot, we can see that life expectancy has increased and the fertility has decreased across most countries. We see this because the cloud of points moves. This is not the case if we adjust the scales:

<img src="TFA_files/figure-html/unnamed-chunk-426-1.png" width="672" style="display: block; margin: auto;" />

In the plot above, we have to pay special attention to the range to notice that the plot on the right has a larger life expectancy. 
</div>



<div class="modal fade bs-example-modal-lg" id="QO30sIxfqQvkHgvjfk72" tabindex="-1" role="dialog" aria-labelledby="QO30sIxfqQvkHgvjfk72-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="QO30sIxfqQvkHgvjfk72-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(continent == "Asia") %>%
  ggplot(aes(fertility, life_expectancy, col = year)) +
  geom_point()  
```

<img src="TFA_files/figure-html/unnamed-chunk-427-1.png" width="672" style="display: block; margin: auto;" />
</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#QO30sIxfqQvkHgvjfk72">Solution</button>

<div class="modal fade bs-example-modal-lg" id="NVwwdJXfrY5ipOCG2Waa" tabindex="-1" role="dialog" aria-labelledby="NVwwdJXfrY5ipOCG2Waa-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="NVwwdJXfrY5ipOCG2Waa-title">Hint</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(___) %>%
  ggplot(aes(___)) +
  geom_point() 
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#NVwwdJXfrY5ipOCG2Waa">Hint</button>

  4) Illustrate the transformation for Asia using a single plot where year is used as color aesthetic. 


#### Time series plots {-}

The visualizations above effectively illustrate that data no longer supports the Western versus developing world view. Once we see these plots, new questions emerge. For example, which countries are improving more and which ones less? Was the improvement constant during the last 50 years or was it more accelerated during certain periods? For a closer look that may help answer these questions, we introduce _time series plots_.

Time series plots have time in the x-axis and an outcome or measurement of interest on the y-axis. For example, here is a trend plot of United States fertility rates:


```r
gapminder %>% 
  filter(country == "United States") %>% 
  ggplot(aes(year, fertility)) +
  geom_point()
```

<img src="TFA_files/figure-html/fertility-time-series-plot-points-1.png" width="672" style="display: block; margin: auto;" />

We see that the trend is not linear at all. Instead there is sharp drop during the 1960s and 1970s to below 2. Then the trend comes back to 2 and stabilizes during the 1990s.

When the points are regularly and densely spaced, as they are here, we create curves by joining the points with lines, to convey that these data are from a single series, here a country. To do this, we use the `geom_line` function instead of `geom_point`. 



<div class="modal fade bs-example-modal-lg" id="tQEV4ejDBsIzjvkKN2tW" tabindex="-1" role="dialog" aria-labelledby="tQEV4ejDBsIzjvkKN2tW-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="tQEV4ejDBsIzjvkKN2tW-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(country == "United States") %>% 
  ggplot(aes(year, fertility)) +
  geom_line()
```

<img src="TFA_files/figure-html/unnamed-chunk-429-1.png" width="672" style="display: block; margin: auto;" />
</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#tQEV4ejDBsIzjvkKN2tW">Solution</button>

  5) Make a lineplot showing the time series of fertility versus year for United States.
  
  

<div class="modal fade bs-example-modal-lg" id="LonmW6t8pYYjOoqnPAi5" tabindex="-1" role="dialog" aria-labelledby="LonmW6t8pYYjOoqnPAi5-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="LonmW6t8pYYjOoqnPAi5-title">Solution</h4></div><div class="modal-body">

```r
countries <- c("South Korea", "Germany")
gapminder %>% filter(country %in% countries) %>% 
  ggplot(aes(year, fertility, col = country)) +
  geom_line() 
```

<img src="TFA_files/figure-html/unnamed-chunk-430-1.png" width="672" style="display: block; margin: auto;" />
<p>The plot clearly shows how South Korea&#39;s fertility rate dropped drastically during the 1960s and 1970s, and by 1990 had a similar rate to that of Germany.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#LonmW6t8pYYjOoqnPAi5">Solution</button>


<div class="modal fade bs-example-modal-lg" id="31egBnndx83wqMOx6hYs" tabindex="-1" role="dialog" aria-labelledby="31egBnndx83wqMOx6hYs-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="31egBnndx83wqMOx6hYs-title">Hint</h4></div><div class="modal-body">

```r
gapminder %>% filter(country %in% ___) %>% 
  ggplot(aes(year, fertility, col = ___)) +
  geom_line()
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#31egBnndx83wqMOx6hYs">Hint</button>

  6) Lineplots is particularly helpful when we look at more countries. Make a lineplot showing the time series of fertility versus year for South Korea and Germany. Use country as color aesthetic. 
  
  

<div class="modal fade bs-example-modal-lg" id="jd9TQ9pHdTZb6UAQfZGI" tabindex="-1" role="dialog" aria-labelledby="jd9TQ9pHdTZb6UAQfZGI-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="jd9TQ9pHdTZb6UAQfZGI-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(country %in% countries) %>% 
  ggplot(aes(year, life_expectancy, col = country)) +
  geom_line() 
```

<img src="TFA_files/figure-html/unnamed-chunk-432-1.png" width="672" style="display: block; margin: auto;" />
<p>The plot clearly shows how an improvement in life expectancy followed the drops in fertility rates. In 1960, Germans lived 15 years longer than South Koreans, although by 2010 the gap is completely closed. It exemplifies the improvement that many non-western countries have achieved in the last 40 years.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#jd9TQ9pHdTZb6UAQfZGI">Solution</button>

  7) Make a lineplot showing the time series of life expectancy versus year for South Korea and Germany. Use country as color aesthetic. 
  
  
  
#### Data transformations {-}

We now shift our attention to the second question related to the commonly held notion that wealth distribution across the world has become worse during the last decades. When general audiences are asked if poor countries have become poorer and rich countries become richer, the majority answers yes. By using stratification, histograms, smooth densities, and boxplots, we will be able to understand if this is in fact the case. First we learn how transformations can sometimes help provide more informative summaries and plots.

The `gapminder` data table includes a column with the countries' gross domestic product (GDP). GDP measures the market value of goods and services produced by a country in a year. The GDP per person is often used as a rough summary of a country's wealth. Here we divide this quantity by 365 to obtain the more interpretable measure _dollars per day_.  Using current U.S. dollars as a unit, a person surviving on an income of less than $2 a day, is defined to be living in _absolute poverty_. We add this variable to the data table:


```r
gapminder <- gapminder %>%  
  mutate(dollars_per_day = gdp/population/365)
```

The GDP values are adjusted for inflation and represent current U.S. dollar, so these values are meant to be comparable across the years. Of course, these are country averages and within each country there is much variability. All the graphs and insights described below relate to country averages and not to individuals.

Here is a histogram of per day incomes from 1970:


```r
past_year <- 1970
gapminder %>% 
  filter(year == past_year & !is.na(gdp)) %>%
  ggplot(aes(dollars_per_day)) + 
  geom_histogram(binwidth = 1, color = "black")
```

<img src="TFA_files/figure-html/dollars-per-day-distribution-1.png" width="672" style="display: block; margin: auto;" />

We use the `color = "black"` argument to draw a boundary and clearly distinguish the bins.

In this plot, we see that for the majority of countries, averages are below \$10 a day. However, the majority of the x-axis is dedicated to the 35 countries with averages above \$10. So the plot is not very informative about countries with values below \$10 a day.

It might be more informative to quickly be able to see how many countries have average daily incomes of about $1 (extremely poor), \$2 (very poor), \$4 (poor), \$8 (middle), \$16 (well off), \$32 (rich), \$64 (very rich) per day. These changes are multiplicative and log transformations convert multiplicative changes into additive ones: when using base 2, a doubling of a value turns into an increase by 1. 



<div class="modal fade bs-example-modal-lg" id="0Ih4yntWLS6ENOf8S9Y1" tabindex="-1" role="dialog" aria-labelledby="0Ih4yntWLS6ENOf8S9Y1-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="0Ih4yntWLS6ENOf8S9Y1-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(year == past_year & !is.na(gdp)) %>%
  ggplot(aes(log2(dollars_per_day))) + 
  geom_histogram(binwidth = 1, color = "black")
```

<img src="TFA_files/figure-html/unnamed-chunk-434-1.png" width="672" style="display: block; margin: auto;" />
<p>This provides a <em>close-up</em> of the mid to lower income countries.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#0Ih4yntWLS6ENOf8S9Y1">Solution</button>

  8) Make a histogram of `log2(dollars_per_day)` from 1970. 

<div class = "box">

#### Infobox - Which base? {-}

In the case above, we used base 2 in the log transformations. Other common choices are base $\mathrm{e}$ (the natural log) and base 10.

In general, we do not recommend using the natural log for data exploration and visualization. This is because while $2^2, 2^3, 2^4, \dots$ or $10^2, 10^3, \dots$ are easy to compute in our heads, the same is not true for  $\mathrm{e}^2, \mathrm{e}^3, \dots$, so the scale is not intuitive or easy to interpret.

In the dollars per day example, we used base 2 instead of base 10 because the resulting range is easier to interpret. The range of the values being plotted is 0.327, 48.885. 

In base 10, this turns into a range that includes very few integers: just 0 and 1. 
With base two, our range includes -2, -1, 0, 1, 2, 3, 4, and 5. It is easier to compute $2^x$ and $10^x$ when $x$ is an integer and between -10 and 10, so we prefer to have smaller integers in the scale. Another consequence of a limited range is that choosing the binwidth is more challenging. With log base 2, we know that a binwidth of 1 will translate to a bin with range $x$ to $2x$.

For an example in which base 10 makes more sense, consider population sizes. A log base 10 is preferable since the range for these is:


```r
filter(gapminder, year == past_year) %>%
  summarize(min = min(population), max = max(population))
#>     min      max
#> 1 46075 8.09e+08
```

Here is the histogram of the transformed values:


```r
gapminder %>% 
  filter(year == past_year) %>%
  ggplot(aes(log10(population))) +
  geom_histogram(binwidth = 0.5, color = "black")
```

<img src="TFA_files/figure-html/population-histogram-log10-1.png" width="672" style="display: block; margin: auto;" />

In the above, we quickly see that country populations range between ten thousand and ten billion.
</div>

There are two ways we can use log transformations in plots. We can log the values before plotting them or use log scales on the axes. Both approaches are useful and have different strengths. If we log the data, we can more easily interpret intermediate values in the scale. For example, if we see:  

`----1----x----2--------3----`

for log transformed data, we know that the value of $x$ is about 1.5. If the scales are logged:

`----1----x----10------100---`

then, to determine `x`, we need to compute $10^{1.5}$, which is not easy to do in our heads. The advantage of using logged scales is that we see the original values on the axes. However, the advantage of showing logged scales is that the original values are displayed in the plot, which are easier to interpret. For example, we would see "32 dollars a day" instead of "5 log base 2 dollars a day".



<div class="modal fade bs-example-modal-lg" id="npCYc8hswj0lLP0KKSpe" tabindex="-1" role="dialog" aria-labelledby="npCYc8hswj0lLP0KKSpe-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="npCYc8hswj0lLP0KKSpe-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(year == past_year & !is.na(gdp)) %>%
  ggplot(aes(dollars_per_day)) + 
  geom_histogram(binwidth = 1, color = "black") +
  scale_x_continuous(trans = "log2")
```

<img src="TFA_files/figure-html/unnamed-chunk-436-1.png" width="672" style="display: block; margin: auto;" />
<p>The plot from Q8 is the same except the values on the x-axis.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#npCYc8hswj0lLP0KKSpe">Solution</button>

  9) Make a histogram of `dollars_per_day` from 1970 using a log2 scale on the x-axis. Compare it to the plot from Question 8. _Hint: you can use the `scale_x_continuous` function with `trans = "log2"`._

The histograms in Questions 8 and 9 have two _bumps_: one at about 4 and another at about 32. In statistics these bumps are sometimes referred to as _modes_. The mode of a distribution is the value with the highest frequency. The mode of the normal distribution is the average. When a distribution, like the one above, does not monotonically decrease from the mode, we call the locations where it goes up and down again _local modes_ and say that the distribution has _multiple modes_ indicating different distributions for different groups.

The histogram above suggests that the 1970 country income distribution has two modes: one at about 2 dollars per day (1 in the log 2 scale) and another at about 32 dollars per day (5 in the log 2 scale). However, the histogram does not show us if the two groups of countries are _west_ versus the _rest_. Let us create the `group` column:


```r
gapminder <- gapminder %>% 
  mutate(group = case_when(
    region %in% c("Western Europe", "Northern Europe","Southern Europe", 
                  "Northern America", "Australia and New Zealand") ~ "West",
    TRUE ~ "Rest")) %>% 
  as_tibble()
```




<div class="modal fade bs-example-modal-lg" id="MmNwlIE9tXuzYKfsyPjJ" tabindex="-1" role="dialog" aria-labelledby="MmNwlIE9tXuzYKfsyPjJ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="MmNwlIE9tXuzYKfsyPjJ-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(year == past_year & !is.na(gdp)) %>%
  ggplot(aes(dollars_per_day)) + 
  geom_histogram(binwidth = 1, color = "black") +
  facet_grid(cols = vars(group)) +
  scale_x_continuous(trans = "log2")
```

<img src="TFA_files/figure-html/unnamed-chunk-438-1.png" width="672" style="display: block; margin: auto;" />
<p>The plot confirms the west vs the rest dichotomy.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#MmNwlIE9tXuzYKfsyPjJ">Solution</button>


<div class="modal fade bs-example-modal-lg" id="SEgPgw3ckgsnsyYmZ4T9" tabindex="-1" role="dialog" aria-labelledby="SEgPgw3ckgsnsyYmZ4T9-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="SEgPgw3ckgsnsyYmZ4T9-title">Hint</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(year == past_year & !is.na(gdp)) %>%
  ggplot(aes(dollars_per_day)) + 
  geom_histogram(binwidth = 1, color = "black") +
  facet_grid(cols = ___) +
  scale_x_continuous(trans = "log2")
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#SEgPgw3ckgsnsyYmZ4T9">Hint</button>

  10) Make a histogram of `dollars_per_day` from 1970 using a log2 scale and _facet_ it by group. Is there a _west_ versus the _rest_ dichotomy?
  
The exploratory data analysis above has revealed two characteristics about average income distribution in 1970. Using a histogram, we found a bimodal distribution with the modes relating to poor and rich countries. We will try to visualize these summaries in one plot. 



<div class="modal fade bs-example-modal-lg" id="Y3j05tyJdebsmI3RQdka" tabindex="-1" role="dialog" aria-labelledby="Y3j05tyJdebsmI3RQdka-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Y3j05tyJdebsmI3RQdka-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(year == past_year & !is.na(gdp)) %>%
  ggplot(aes(group, dollars_per_day)) +
  geom_boxplot() +
  scale_y_continuous(trans = "log2") + 
  geom_point()
```

<img src="TFA_files/figure-html/unnamed-chunk-440-1.png" width="672" style="display: block; margin: auto;" />
</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Y3j05tyJdebsmI3RQdka">Solution</button>


<div class="modal fade bs-example-modal-lg" id="SDSlGhmNJ6TjWv0uZoQJ" tabindex="-1" role="dialog" aria-labelledby="SDSlGhmNJ6TjWv0uZoQJ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="SDSlGhmNJ6TjWv0uZoQJ-title">Hint</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(year == past_year & !is.na(gdp)) %>%
  ggplot(aes(group, dollars_per_day)) +
  geom____() +
  scale_y_continuous(trans = "log2") + 
  geom____()
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#SDSlGhmNJ6TjWv0uZoQJ">Hint</button>

  11) Make a boxplot (`geom_boxplot`) of `dollars_per_day` (y-axis) versus `group` (x-axis) from 1970 using a log2 scale. Also add a the data using `geom_point()`.
  

Data exploration clearly shows that in 1970 there was a "west versus the rest" dichotomy. But does this dichotomy persist? We first have to be a little careful here since there are more countries represented in 2010 than in 1970: the total counts are larger. One reason for this is that several countries were founded after 1970. For example, the Soviet Union divided into several countries during the 1990s. Another reason is that data was available for more countries in 2010. Hence we only have to consider the countries with data available for both years:


```r
past_year <- 1970
present_year <- 2010
years <- c(past_year, present_year)
country_list_1 <- gapminder %>% 
  filter(year == past_year & !is.na(dollars_per_day)) %>% 
  pull(country)

country_list_2 <- gapminder %>% 
  filter(year == present_year & !is.na(dollars_per_day)) %>% 
  pull(country)
      
country_list <- intersect(country_list_1, country_list_2)
```

We can now filter the rows by `years` and `country_list`.




<div class="modal fade bs-example-modal-lg" id="PI7HHL1lRb61B1wUnY60" tabindex="-1" role="dialog" aria-labelledby="PI7HHL1lRb61B1wUnY60-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="PI7HHL1lRb61B1wUnY60-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(year %in% years & country %in% country_list) %>%
  ggplot(aes(dollars_per_day)) +
  geom_histogram(binwidth = 1, color = "black") +
  scale_x_continuous(trans = "log2") + 
  facet_grid(year ~ group)
```

<img src="TFA_files/figure-html/unnamed-chunk-443-1.png" width="672" style="display: block; margin: auto;" />
<p>The income gap between rich and poor countries has narrowed considerably during the last 40 years</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#PI7HHL1lRb61B1wUnY60">Solution</button>


<div class="modal fade bs-example-modal-lg" id="QCnVXv41Y6G89Z3djNh3" tabindex="-1" role="dialog" aria-labelledby="QCnVXv41Y6G89Z3djNh3-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="QCnVXv41Y6G89Z3djNh3-title">Hint</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(year %in% ___ & country %in% ___) %>%
  ggplot(aes(dollars_per_day)) +
  geom_histogram(binwidth = 1, color = "black") +
  scale_x_continuous(trans = "log2") + 
  facet_grid(___)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#QCnVXv41Y6G89Z3djNh3">Hint</button>

  12) Make a histogram of `dollars_per_day` from 1970 and 2010 using a log2 scale and _facet_ it by group and year. Does the dichotomy persist? 
  


<div class="modal fade bs-example-modal-lg" id="aGBHbQdwWFkW8E76ejR9" tabindex="-1" role="dialog" aria-labelledby="aGBHbQdwWFkW8E76ejR9-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="aGBHbQdwWFkW8E76ejR9-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(year %in% years & country %in% country_list) %>%
  mutate(year = factor(year)) %>%
  ggplot(aes(group, dollars_per_day, fill = year)) +
  geom_boxplot() +
  scale_y_continuous(trans = "log2") 
```

<img src="TFA_files/figure-html/unnamed-chunk-445-1.png" width="672" style="display: block; margin: auto;" />
<p>We now see that the rich countries have become a bit richer, but percentage-wise, the poor countries appear to have improved more. In particular, we see that the proportion of <em>developing</em> countries earning more than $16 a day increased substantially.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#aGBHbQdwWFkW8E76ejR9">Solution</button>


<div class="modal fade bs-example-modal-lg" id="qz1XnWFTIxhk0OS7F9PD" tabindex="-1" role="dialog" aria-labelledby="qz1XnWFTIxhk0OS7F9PD-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="qz1XnWFTIxhk0OS7F9PD-title">Hint</h4></div><div class="modal-body">

```r
gapminder %>% 
  filter(year %in% years & country %in% country_list) %>%
  mutate(year = factor(___)) %>%
  ggplot(aes(group, dollars_per_day, fill = ___)) +
  geom_boxplot() +
  scale_y_continuous(trans = "log2") 
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#qz1XnWFTIxhk0OS7F9PD">Hint</button>

  13) Make a boxplot of `dollars_per_day` versus `group` from 1970 and 2010 using a log2 scale. Use year as fill aesthetic. 
  
      _Hint: you must convert year to a factor using `mutate(year = factor(year))`._



The previous data exploration suggested that the income gap between rich and poor countries has narrowed considerably during the last 40 years. 
We used a series of histograms and boxplots to see this. Let us now shift to density plots. Let us start by noting that density plots for income distribution in 1970 and 2010 deliver the message that the gap is closing:


```r
gapminder %>% 
  filter(year %in% years & country %in% country_list) %>%
  ggplot(aes(dollars_per_day)) +
  geom_density(fill = "grey") + 
  scale_x_continuous(trans = "log2") + 
  facet_grid(cols = vars(year))
```

<img src="TFA_files/figure-html/income-smooth-density-by-year-1.png" width="672" style="display: block; margin: auto;" />

In the 1970 plot, we see two clear modes: poor and rich countries. In 2010, it appears that some of the poor countries have shifted towards the right, closing the gap. 




The next message we need to convey is that the reason for this change in distribution is that several poor countries became richer, rather than some rich countries becoming poorer. To do this, we can assign a color to the groups we identified during data exploration. 


```r
gapminder %>% 
  filter(year %in% years & country %in% country_list) %>%
  ggplot(aes(dollars_per_day, fill = group)) +
  scale_x_continuous(trans = "log2") +
  geom_density(alpha = 0.2) + 
  facet_grid(cols = vars(year))
```

<img src="TFA_files/figure-html/income-smooth-density-by-year-west-v-developing-1.png" width="672" style="display: block; margin: auto;" />

Note the default is to have the area represented by each distribution add up to 1, regardless of the size of each group: the number of countries in the 'west' group is 21 and in the 'rest' group is 87. We may use count on the y-axis instead:



```r
p <- gapminder %>% 
  filter(year %in% years & country %in% country_list) %>%
  ggplot(aes(dollars_per_day, y = ..count.., fill = group)) +
  scale_x_continuous(trans = "log2", limit = c(0.125, 300)) +
  facet_grid(cols = vars(year))
p + geom_density(alpha = 0.2) 
```

<img src="TFA_files/figure-html/income-smooth-density-counts-1.png" width="672" style="display: block; margin: auto;" />



<div class="modal fade bs-example-modal-lg" id="WtWQID3mxuIFJKcd6U2e" tabindex="-1" role="dialog" aria-labelledby="WtWQID3mxuIFJKcd6U2e-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="WtWQID3mxuIFJKcd6U2e-title">Solution</h4></div><div class="modal-body">

```r
p + geom_density(alpha = 0.2, bw = 0.75)
```

<img src="TFA_files/figure-html/unnamed-chunk-448-1.png" width="672" style="display: block; margin: auto;" />
<p>This plot now shows that the developing world distribution is changing.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#WtWQID3mxuIFJKcd6U2e">Solution</button>

  14) To get densities smoother, use `bw = 0.75` argument so that the same bandwidth is used in each density. Comment on the plot.


As a final point, we note that in these distributions the weight of every country is the same. So if most of the population is improving, but living in a very large country, such as China, we might not appreciate this. We can actually weight the smooth densities using the `weight` mapping argument. We modify the dataset:


```r
gapminder <- gapminder %>% 
  filter(year %in% years & country %in% country_list) %>%
  group_by(year) %>%
  mutate(weight = population/sum(population)*2) %>%
  ungroup() 
```




<div class="modal fade bs-example-modal-lg" id="xxuTMOwgPTkjTPOfg3SV" tabindex="-1" role="dialog" aria-labelledby="xxuTMOwgPTkjTPOfg3SV-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="xxuTMOwgPTkjTPOfg3SV-title">Solution</h4></div><div class="modal-body">

```r
gapminder %>% 
  ggplot(aes(dollars_per_day, fill = group, weight = weight)) +
  scale_x_continuous(trans = "log2", limit = c(0.125, 300)) + 
  geom_density(alpha = 0.2, bw = 0.75) + 
  facet_grid(cols = vars(year))
```

<img src="TFA_files/figure-html/unnamed-chunk-450-1.png" width="672" style="display: block; margin: auto;" />
<p>We now see that the rich countries have become a bit richer, but percentage-wise, the poor countries appear to have improved more. In particular, we see that the proportion of <em>developing</em> countries earning more than $16 a day increased substantially.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#xxuTMOwgPTkjTPOfg3SV">Solution</button>


<div class="modal fade bs-example-modal-lg" id="9IC7qL3dlXVkspVnBNP5" tabindex="-1" role="dialog" aria-labelledby="9IC7qL3dlXVkspVnBNP5-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="9IC7qL3dlXVkspVnBNP5-title">Hint</h4></div><div class="modal-body">

```r
gapminder %>% 
  ggplot(aes(dollars_per_day, fill = group, weight = ___)) +
  scale_x_continuous(trans = "log2", limit = c(0.125, 300)) + 
  geom_density(alpha = 0.2, bw = 0.75) + 
  facet_grid(cols = vars(year))
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#9IC7qL3dlXVkspVnBNP5">Hint</button>

  15) Modify the ggplot function with a weight argument and plot the density (with area equal 1). 




### Exercise (profit) {#ex-profit2}

Use the *exercise R Markdown template* to solve this exercise (**File > New File > R Markdown...**, select **From template** and then **TFA Exercise**).

Consider the dataset profit (provided by the tfa package) containing quarterly financial records for each costumer, product, etc.:


```r
# remotes::install_github("bss-osca/tfa/tfa-package", upgrade = FALSE)   # upgrade first
library(tfa)
library(skimr)
glimpse(profit)
#> Rows: 24,546
#> Columns: 9
#> $ Quarter                 <dbl> 3, 1, 4, 1, 4, 3, 4, 3, 4, 1, 1, 3, 3, 3, 2, 2, 1, 2, 3, 2, 2, 2, …
#> $ Channel                 <chr> "ATM", "ATM", "ATM", "ATM", "ATM", "BRH", "BRH", "ATM", "BRH", "BR…
#> $ `Customer ID`           <chr> "FRT", "MRT", "PBI", "PBI", "MRT", "MAM", "PBI", "FRT", "PBI", "PB…
#> $ Country                 <chr> "USA", "USA", "USA", "USA", "USA", "USA", "USA", "USA", "USA", "US…
#> $ `Product Line`          <chr> "Credit Products", "Credit Products", "Deposit Products", "Deposit…
#> $ Revenue                 <dbl> 6044, 4686, 6063, 4682, 6320, 2993, 3355, 5716, 3347, 2624, 3629, …
#> $ `Product Cost`          <dbl> 3998, 3229, 7440, 6127, 7913, 1034, 4355, 5617, 4229, 1960, 4650, …
#> $ `Customer Service Cost` <dbl> 413, 643, 1842, 1118, 1854, 242, 1027, 876, 425, 264, 700, 1482, 4…
#> $ Profit                  <dbl> 1633, 815, -3219, -2563, -3447, 1718, -2027, -777, -1307, 401, -17…
skim(profit)
```


<table style='width: auto;'
      class='table table-condensed'>
<caption>(\#tab:unnamed-chunk-452)Data summary</caption>
<tbody>
  <tr>
   <td style="text-align:left;"> Name </td>
   <td style="text-align:left;"> profit </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Number of rows </td>
   <td style="text-align:left;"> 24546 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Number of columns </td>
   <td style="text-align:left;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> _______________________ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Column type frequency: </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> character </td>
   <td style="text-align:left;"> 4 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> numeric </td>
   <td style="text-align:left;"> 5 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ________________________ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Group variables </td>
   <td style="text-align:left;"> None </td>
  </tr>
</tbody>
</table>


**Variable type: character**

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> skim_variable </th>
   <th style="text-align:right;"> n_missing </th>
   <th style="text-align:right;"> complete_rate </th>
   <th style="text-align:right;"> min </th>
   <th style="text-align:right;"> max </th>
   <th style="text-align:right;"> empty </th>
   <th style="text-align:right;"> n_unique </th>
   <th style="text-align:right;"> whitespace </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Channel </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Customer ID </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 18 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Country </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 47 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Product Line </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 25 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
</tbody>
</table>


**Variable type: numeric**

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> skim_variable </th>
   <th style="text-align:right;"> n_missing </th>
   <th style="text-align:right;"> complete_rate </th>
   <th style="text-align:right;"> mean </th>
   <th style="text-align:right;"> sd </th>
   <th style="text-align:right;"> p0 </th>
   <th style="text-align:right;"> p25 </th>
   <th style="text-align:right;"> p50 </th>
   <th style="text-align:right;"> p75 </th>
   <th style="text-align:right;"> p100 </th>
   <th style="text-align:left;"> hist </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Quarter </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 2.50 </td>
   <td style="text-align:right;"> 1.12 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:left;"> ▇▇▁▇▇ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Revenue </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 120.22 </td>
   <td style="text-align:right;"> 420.96 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;"> 41 </td>
   <td style="text-align:right;"> 74 </td>
   <td style="text-align:right;"> 7540 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Product Cost </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 100.07 </td>
   <td style="text-align:right;"> 375.51 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 29 </td>
   <td style="text-align:right;"> 68 </td>
   <td style="text-align:right;"> 9256 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Customer Service Cost </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 17.42 </td>
   <td style="text-align:right;"> 67.43 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;"> 1865 </td>
   <td style="text-align:left;"> ▇▁▁▁▁ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Profit </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 2.71 </td>
   <td style="text-align:right;"> 154.89 </td>
   <td style="text-align:right;"> -4139 </td>
   <td style="text-align:right;"> -7 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 3664 </td>
   <td style="text-align:left;"> ▁▁▇▁▁ </td>
  </tr>
</tbody>
</table>

  1) Make a barplot that shows the total profitability of the product lines. Use the following steps:


<div class="modal fade bs-example-modal-lg" id="0O9saSX3kg7beLgZHu2t" tabindex="-1" role="dialog" aria-labelledby="0O9saSX3kg7beLgZHu2t-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="0O9saSX3kg7beLgZHu2t-title">Solution</h4></div><div class="modal-body">

```r
profit <- profit %>%
  mutate(across(where(is.character), as.factor))
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#0O9saSX3kg7beLgZHu2t">Solution</button>

<div class="modal fade bs-example-modal-lg" id="oKPVY4JE6yLvoPnFm5Dy" tabindex="-1" role="dialog" aria-labelledby="oKPVY4JE6yLvoPnFm5Dy-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="oKPVY4JE6yLvoPnFm5Dy-title">Hint</h4></div><div class="modal-body">

```r
profit <- profit %>%
  mutate(across(where(is.___), as.___))
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#oKPVY4JE6yLvoPnFm5Dy">Hint</button>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
a) Convert all character columns to factor columns.



<div class="modal fade bs-example-modal-lg" id="2XfHUrU8Jl2vgP8vEj0F" tabindex="-1" role="dialog" aria-labelledby="2XfHUrU8Jl2vgP8vEj0F-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="2XfHUrU8Jl2vgP8vEj0F-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Product Line`) %>% 
  summarise(Profit = sum(Profit)) %>% 
  ggplot(aes(x = `Product Line`, y = Profit)) +
  geom_col()
```

<img src="TFA_files/figure-html/unnamed-chunk-455-1.png" width="672" style="display: block; margin: auto;" />
</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#2XfHUrU8Jl2vgP8vEj0F">Solution</button>

<div class="modal fade bs-example-modal-lg" id="zieE5IXmGJwUyqy7Jwdy" tabindex="-1" role="dialog" aria-labelledby="zieE5IXmGJwUyqy7Jwdy-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="zieE5IXmGJwUyqy7Jwdy-title">Hint</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(___) %>% 
  summarise(Profit = sum(___)) %>% 
  ggplot(aes(x = ___, y = ___)) +
  geom_col()
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#zieE5IXmGJwUyqy7Jwdy">Hint</button>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
b) Group by product line, calculate the total profit and plot profit for each product line.



<div class="modal fade bs-example-modal-lg" id="yjOfFJqgmJdcEFsm1ktt" tabindex="-1" role="dialog" aria-labelledby="yjOfFJqgmJdcEFsm1ktt-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="yjOfFJqgmJdcEFsm1ktt-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Product Line`) %>% 
  summarise(Profit = sum(Profit)) %>% 
  ggplot(aes(x = reorder(`Product Line`, Profit), y = Profit)) +
  geom_col()

# Alternatively you can reorder the data frame before calling ggplot
profit %>% 
  group_by(`Product Line`) %>% 
  summarise(Profit = sum(Profit)) %>% 
  arrange(Profit) %>% 
  mutate(`Product Line` = factor(`Product Line`, levels = `Product Line`, ordered = TRUE)) %>% 
  ggplot(aes(x = reorder(`Product Line`, Profit), y = Profit)) +
  geom_col() + 
  labs(title = "Total profit for each product line") 
```

<img src="TFA_files/figure-html/unnamed-chunk-457-1.png" width="672" style="display: block; margin: auto;" /><img src="TFA_files/figure-html/unnamed-chunk-457-2.png" width="672" style="display: block; margin: auto;" />
</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#yjOfFJqgmJdcEFsm1ktt">Solution</button>

<div class="modal fade bs-example-modal-lg" id="7yuGtpR4rKEpzE5drBVM" tabindex="-1" role="dialog" aria-labelledby="7yuGtpR4rKEpzE5drBVM-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="7yuGtpR4rKEpzE5drBVM-title">Hint 2</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Product Line`) %>% 
  summarise(Profit = sum(Profit)) %>% 
  ggplot(aes(x = reorder(___), y = Profit)) +
  geom_col()
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#7yuGtpR4rKEpzE5drBVM">Hint 2</button>

<div class="modal fade bs-example-modal-lg" id="pTEGp1PaWgVYqJ2omr40" tabindex="-1" role="dialog" aria-labelledby="pTEGp1PaWgVYqJ2omr40-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="pTEGp1PaWgVYqJ2omr40-title">Hint 1</h4></div><div class="modal-body">

<p>See the last section on this <a href="https://sebastiansauer.github.io/ordering-bars/">webpage</a>.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#pTEGp1PaWgVYqJ2omr40">Hint 1</button>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
c) Plot profit for each product line where product line is reordered based on total profit.



<div class="modal fade bs-example-modal-lg" id="arR2PMT8TGUuVh3gn12Z" tabindex="-1" role="dialog" aria-labelledby="arR2PMT8TGUuVh3gn12Z-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="arR2PMT8TGUuVh3gn12Z-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Product Line`) %>% 
  summarise(Profit = sum(Profit)) %>% 
  ggplot(aes(x = reorder(`Product Line`, Profit), y = Profit)) +
  geom_col() + 
  labs(title = "Total profit for each product line") 
```

<img src="TFA_files/figure-html/unnamed-chunk-460-1.png" width="672" style="display: block; margin: auto;" />
</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#arR2PMT8TGUuVh3gn12Z">Solution</button>

<div class="modal fade bs-example-modal-lg" id="mjGnQAbpm54x5DRmqcO8" tabindex="-1" role="dialog" aria-labelledby="mjGnQAbpm54x5DRmqcO8-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="mjGnQAbpm54x5DRmqcO8-title">Hint</h4></div><div class="modal-body">

<p>Try to google &#39;ggplot add title&#39;.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#mjGnQAbpm54x5DRmqcO8">Hint</button>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
d) Add a title to the plot using `labs`.



<div class="modal fade bs-example-modal-lg" id="ssKVUnuapoHVIriMzhEe" tabindex="-1" role="dialog" aria-labelledby="ssKVUnuapoHVIriMzhEe-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="ssKVUnuapoHVIriMzhEe-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Product Line`) %>% 
  summarise(Profit = sum(Profit)) %>% 
  ggplot(aes(x = reorder(`Product Line`, Profit), y = Profit)) +
  geom_col() +
  labs(title = "Total profit for each product line") + 
  xlab("Product line") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

<img src="TFA_files/figure-html/unnamed-chunk-462-1.png" width="672" style="display: block; margin: auto;" />
</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#ssKVUnuapoHVIriMzhEe">Solution</button>

<div class="modal fade bs-example-modal-lg" id="LnKG4Z0HHo7GRxJm8UWs" tabindex="-1" role="dialog" aria-labelledby="LnKG4Z0HHo7GRxJm8UWs-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="LnKG4Z0HHo7GRxJm8UWs-title">Hint</h4></div><div class="modal-body">

<p>Try to google &#39;ggplot2 rotate axis labels&#39;.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#LnKG4Z0HHo7GRxJm8UWs">Hint</button>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
e) Rotate the x-axis labels 90 degrees.



<div class="modal fade bs-example-modal-lg" id="MSRi3hffUHN6F2TKDkFP" tabindex="-1" role="dialog" aria-labelledby="MSRi3hffUHN6F2TKDkFP-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="MSRi3hffUHN6F2TKDkFP-title">Solution</h4></div><div class="modal-body">

```r
dat <- profit %>% 
  group_by(`Product Line`) %>% 
  summarise(Profit = sum(Profit)) 
dat %>% slice_min(Profit)
#> # A tibble: 1 × 2
#>   `Product Line`       Profit
#>   <fct>                 <dbl>
#> 1 Third Party Products   2209
dat %>% slice_max(Profit)
#> # A tibble: 1 × 2
#>   `Product Line`  Profit
#>   <fct>            <dbl>
#> 1 Credit Products  31016
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#MSRi3hffUHN6F2TKDkFP">Solution</button>

<div class="modal fade bs-example-modal-lg" id="h78zyl1yltDGbLk4tlsw" tabindex="-1" role="dialog" aria-labelledby="h78zyl1yltDGbLk4tlsw-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="h78zyl1yltDGbLk4tlsw-title">Hint</h4></div><div class="modal-body">

```r
dat <- profit %>% 
  group_by(`Product Line`) %>% 
  summarise(Profit = sum(Profit)) 
dat %>% slice_min(___)
dat %>% ___
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#h78zyl1yltDGbLk4tlsw">Hint</button>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
f) Which product line is best and worst?
 



<div class="modal fade bs-example-modal-lg" id="KB97Tor4jyJia2RdnXs0" tabindex="-1" role="dialog" aria-labelledby="KB97Tor4jyJia2RdnXs0-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="KB97Tor4jyJia2RdnXs0-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Product Line`, Quarter) %>% 
  summarise(Profit = sum(Profit)) %>% 
  ggplot(aes(x = reorder(`Product Line`, Profit), y = Profit)) +
  geom_col() +
  facet_grid(cols = vars(Quarter)) +
  labs(title = "Total profit for each product line") +  
  xlab("Product Line") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

<img src="TFA_files/figure-html/unnamed-chunk-466-1.png" width="672" style="display: block; margin: auto;" />
<p>Some product lines have quite different earnings in different quarters.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#KB97Tor4jyJia2RdnXs0">Solution</button>

<div class="modal fade bs-example-modal-lg" id="RTnHaBoaGnbxB0NlZA5s" tabindex="-1" role="dialog" aria-labelledby="RTnHaBoaGnbxB0NlZA5s-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="RTnHaBoaGnbxB0NlZA5s-title">Hint</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Product Line`, ___) %>% 
  summarise(Profit = sum(Profit)) %>% 
  ggplot(aes(x = reorder(`Product Line`, Profit), y = Profit)) +
  geom_col() +
  facet_grid(cols = vars(___)) +
  labs(title = "Total profit for each product line") +  
  xlab("Product Line") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#RTnHaBoaGnbxB0NlZA5s">Hint</button>
  2) Make a barplot that shows the total profitability of the product lines in each quarter. Are there details we have missed in Question 1?




<div class="modal fade bs-example-modal-lg" id="9dRvb4WgUcTqGPnsXKZK" tabindex="-1" role="dialog" aria-labelledby="9dRvb4WgUcTqGPnsXKZK-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="9dRvb4WgUcTqGPnsXKZK-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  ggplot(aes(y = Profit, x = `Product Line`)) +
  geom_boxplot() +
  labs(title = "Profit for each product line") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

<img src="TFA_files/figure-html/unnamed-chunk-468-1.png" width="672" style="display: block; margin: auto;" />
<p>The profit varies more for three of the product lines.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#9dRvb4WgUcTqGPnsXKZK">Solution</button>

<div class="modal fade bs-example-modal-lg" id="9V28AKLrMwTrJKAcBXC6" tabindex="-1" role="dialog" aria-labelledby="9V28AKLrMwTrJKAcBXC6-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="9V28AKLrMwTrJKAcBXC6-title">Hint</h4></div><div class="modal-body">

```r
profit %>% 
  ggplot(aes(y = ___, x = ___)) +
  geom_boxplot() +
  labs(title = "Profit for each product line") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#9V28AKLrMwTrJKAcBXC6">Hint</button>
  3) Make a boxplot of profitability of the product lines. Any insight?




<div class="modal fade bs-example-modal-lg" id="KbgCP8ClTEnRAAyWWgmg" tabindex="-1" role="dialog" aria-labelledby="KbgCP8ClTEnRAAyWWgmg-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="KbgCP8ClTEnRAAyWWgmg-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Customer ID`) %>% 
  summarise(Profit = sum(Profit)) %>% 
  ggplot(aes(x = reorder(`Customer ID`, Profit), y = Profit)) +
  geom_col() +
  labs(title = "Total profit for each customer") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

<img src="TFA_files/figure-html/unnamed-chunk-470-1.png" width="672" style="display: block; margin: auto;" />
<p>Lowest and highest total profit is for PBI and WEM, respectively.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#KbgCP8ClTEnRAAyWWgmg">Solution</button>

<div class="modal fade bs-example-modal-lg" id="s8GtLvKeWYUWNbGefYJk" tabindex="-1" role="dialog" aria-labelledby="s8GtLvKeWYUWNbGefYJk-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="s8GtLvKeWYUWNbGefYJk-title">Hint</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(___) %>% 
  summarise(Profit = sum(___)) %>% 
  ggplot(aes(x = reorder(___, ___), y = Profit)) +
  geom_col() +
  labs(title = "Total profit for each customer") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#s8GtLvKeWYUWNbGefYJk">Hint</button>
  4) Make a barplot that shows the total profitability of the customers. Which customer is best and worst?




<div class="modal fade bs-example-modal-lg" id="qMRrPUV2OSYfgtfWJ18V" tabindex="-1" role="dialog" aria-labelledby="qMRrPUV2OSYfgtfWJ18V-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="qMRrPUV2OSYfgtfWJ18V-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Customer ID`) %>% 
  summarise(Profit = mean(Profit)) %>% 
  ggplot(aes(x = reorder(`Customer ID`, Profit), y = Profit)) +
  geom_col() +
  labs(title = "Mean profit for each customer") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

<img src="TFA_files/figure-html/unnamed-chunk-472-1.png" width="672" style="display: block; margin: auto;" />
<p>Since the number of transactions are not the same, the order of customers will not be the same.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#qMRrPUV2OSYfgtfWJ18V">Solution</button>

<div class="modal fade bs-example-modal-lg" id="V7FAH9QD4sDCJKlZAovF" tabindex="-1" role="dialog" aria-labelledby="V7FAH9QD4sDCJKlZAovF-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="V7FAH9QD4sDCJKlZAovF-title">Hint</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Customer ID`) %>% 
  summarise(Profit = ___) %>% 
  ggplot(aes(x = reorder(`Customer ID`, Profit), y = Profit)) +
  geom_col() +
  labs(title = "Mean profit for each customer") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#V7FAH9QD4sDCJKlZAovF">Hint</button>
  5) Make a barplot that shows the mean profitability of the customers. Which customer is best and worst? Compare against Question 4 and discuss.

  
  

<div class="modal fade bs-example-modal-lg" id="kCpIl7qoq02IK4h1pVlw" tabindex="-1" role="dialog" aria-labelledby="kCpIl7qoq02IK4h1pVlw-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="kCpIl7qoq02IK4h1pVlw-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Customer ID`) %>% 
  summarise(ctr = n(), `Total Profit` = sum(Profit)) %>% 
  ggplot(aes(x = reorder(`Customer ID`, `Total Profit`), y = ctr, fill = `Total Profit`)) +
  geom_col() +
  labs(title = "Number of transactions (rows) for each customer") + 
  xlab("Customer") + ylab("Transactions") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#kCpIl7qoq02IK4h1pVlw">Solution</button>

<div class="modal fade bs-example-modal-lg" id="XwJHyFnIhlG0QbRLWEH1" tabindex="-1" role="dialog" aria-labelledby="XwJHyFnIhlG0QbRLWEH1-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="XwJHyFnIhlG0QbRLWEH1-title">Hint</h4></div><div class="modal-body">

```r
profit %>% 
  group_by(`Customer ID`) %>% 
  summarise(ctr = ___, `Total Profit` = sum(___)) %>% 
  ggplot(aes(x = reorder(___, `Total Profit`), y = ctr, fill = ___)) +
  geom_col() +
  labs(title = "Number of transactions (rows) for each customer") + 
  xlab("Customer") + ylab("Transactions") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#XwJHyFnIhlG0QbRLWEH1">Hint</button>
  6) Make a plot illustrating number of transactions for each customer. Use total profit as fill atheistic. 

  
  

<div class="modal fade bs-example-modal-lg" id="WPy3dU0BdWtgVJO9NGwF" tabindex="-1" role="dialog" aria-labelledby="WPy3dU0BdWtgVJO9NGwF-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="WPy3dU0BdWtgVJO9NGwF-title">Solution</h4></div><div class="modal-body">

```r
profit %>% 
  ggplot(aes(y = Profit, x = `Customer ID`)) +
  geom_boxplot() +
  labs(title = "Profit for each customer") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

<img src="TFA_files/figure-html/unnamed-chunk-476-1.png" width="672" style="display: block; margin: auto;" />
</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#WPy3dU0BdWtgVJO9NGwF">Solution</button>

<div class="modal fade bs-example-modal-lg" id="j4MDsQJP9dltbdfvzGIu" tabindex="-1" role="dialog" aria-labelledby="j4MDsQJP9dltbdfvzGIu-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="j4MDsQJP9dltbdfvzGIu-title">Hint</h4></div><div class="modal-body">

```r
profit %>% 
  ggplot(aes(y = ___, x = ___)) +
  geom_boxplot() +
  labs(title = "Profit for each customer") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#j4MDsQJP9dltbdfvzGIu">Hint</button>
  7) Make a boxplot illustrating the profit for each customer. 

  
  




### Exercise (COVID-19) {#ex-covid19}

Use the *exercise R Markdown template* to solve this exercise (**File > New File > R Markdown...**, select **From template** and then **TFA Exercise**).

Countries around the world are responding to an outbreak of respiratory illness caused by a novel corona virus, COVID-19. The outbreak first started in Wuhan, China, but cases have been identified in a growing number of other locations internationally, including the United States. In this report we explore how the trajectory of the cumulative deaths in a number of countries.

The data come from the [**coronavirus** package](https://github.com/RamiKrispin/coronavirus), which pulls data from the Johns Hopkins University Center for Systems Science and Engineering (JHU CCSE) Corona virus repository. The corona virus package provides a tidy format dataset of the 2019 Novel Corona virus COVID-19 (2019-nCoV) epidemic. The package is available on GitHub [here](https://github.com/RamiKrispin/coronavirus) and is updated daily.

First load the following packages:


```r
library(tidyverse)
library(lubridate)   # package for handling dates
```

The data frame called `coronavirus` in the coronavirus package provides a daily summary of the Corona virus (COVID-19) cases by country. Each row in the data frame represents a country (or, where relevant, state/province). Note that the data provided in this package provides daily number of deaths, confirmed cases, and recovered cases. Since we just need the dataset we load it using `read_csv`:


```r
coronavirus <- read_csv(
  "https://raw.githubusercontent.com/RamiKrispin/coronavirus/master/csv/coronavirus.csv", 
  col_types = cols(
    date = col_date(format = ""),
    province = col_character(),
    country = col_character(),
    lat = col_double(),
    long = col_double(),
    type = col_character(),
    cases = col_double()
  )
)
```

We calculate the total number of cases per day, cumulative numbers and days since first record: 


```r
dat <- coronavirus %>%
  group_by(country, date, type) %>% 
  summarise(tot_cases = sum(cases)) %>%
  group_by(country, type) %>% 
  arrange(date) %>%
  mutate(cumulative_cases = cumsum(tot_cases)) %>%
  ungroup() %>%
  mutate(
    days_elapsed = as.numeric(date - min(date)),
    year = year(date)
  ) %>% print()
#> # A tibble: 554,613 × 7
#>    country     date       type      tot_cases cumulative_cases days_elapsed  year
#>    <chr>       <date>     <chr>         <dbl>            <dbl>        <dbl> <dbl>
#>  1 Afghanistan 2020-01-22 confirmed         0                0            0  2020
#>  2 Afghanistan 2020-01-22 death             0                0            0  2020
#>  3 Afghanistan 2020-01-22 recovery          0                0            0  2020
#>  4 Albania     2020-01-22 confirmed         0                0            0  2020
#>  5 Albania     2020-01-22 death             0                0            0  2020
#>  6 Albania     2020-01-22 recovery          0                0            0  2020
#>  7 Algeria     2020-01-22 confirmed         0                0            0  2020
#>  8 Algeria     2020-01-22 death             0                0            0  2020
#>  9 Algeria     2020-01-22 recovery          0                0            0  2020
#> 10 Andorra     2020-01-22 confirmed         0                0            0  2020
#> # … with 554,603 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```




<div class="modal fade bs-example-modal-lg" id="Niq7qe06QpKIuPZF8CWx" tabindex="-1" role="dialog" aria-labelledby="Niq7qe06QpKIuPZF8CWx-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Niq7qe06QpKIuPZF8CWx-title">Solution</h4></div><div class="modal-body">

```r
dat %>% 
  group_by(date, type) %>% 
  summarise(tot_cases = sum(tot_cases)) %>% print() %>% 
  ggplot(aes(x = date, y = tot_cases)) +
  geom_col() + 
  facet_grid(rows = vars(type), scales = "free") +
  labs(
    title = "Number of Covid 19 cases per day",
    y = "cases"
  )
#> # A tibble: 2,787 × 3
#> # Groups:   date [929]
#>    date       type      tot_cases
#>    <date>     <chr>         <dbl>
#>  1 2020-01-22 confirmed       557
#>  2 2020-01-22 death            17
#>  3 2020-01-22 recovery         30
#>  4 2020-01-23 confirmed       100
#>  5 2020-01-23 death             1
#>  6 2020-01-23 recovery          2
#>  7 2020-01-24 confirmed       287
#>  8 2020-01-24 death             8
#>  9 2020-01-24 recovery          7
#> 10 2020-01-25 confirmed       493
#> # … with 2,777 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```

<img src="TFA_files/figure-html/unnamed-chunk-481-1.png" width="672" style="display: block; margin: auto;" />
</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Niq7qe06QpKIuPZF8CWx">Solution</button>

<div class="modal fade bs-example-modal-lg" id="Qq4kGW2luk6wBnfPkPaJ" tabindex="-1" role="dialog" aria-labelledby="Qq4kGW2luk6wBnfPkPaJ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Qq4kGW2luk6wBnfPkPaJ-title">Hint 2</h4></div><div class="modal-body">

```r
dat %>% 
  group_by(date, type) %>% 
  summarise(tot_cases = sum(tot_cases)) %>% print() %>% 
  ggplot(aes(x = ___, y = ___)) +
  geom_col() + 
  facet_grid(rows = vars(___), scales = "___") +
  labs(
    title = "___",
    y = "___"
  )
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Qq4kGW2luk6wBnfPkPaJ">Hint 2</button>

<div class="modal fade bs-example-modal-lg" id="eMsPSte0eExRf6CwZPZ8" tabindex="-1" role="dialog" aria-labelledby="eMsPSte0eExRf6CwZPZ8-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="eMsPSte0eExRf6CwZPZ8-title">Hint 1</h4></div><div class="modal-body">

```r
dat %>% 
  group_by(date, ___) %>% 
  summarise(tot_cases = sum(___)) 
```


<p>Note you must aggegrate the numbers for the countries.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#eMsPSte0eExRf6CwZPZ8">Hint 1</button>
  1) Calculate and plot the number of confirmed, death and recovered cases per day given date using `facet_grid` and `geom_col`.
  

Consider the following set of countries:


```r
countries <- c(
  "China",
  "France",
  "Denmark",
  "US",
  "Italy"
)
```





<div class="modal fade bs-example-modal-lg" id="UBEogy8RUXSAiuHlv0VG" tabindex="-1" role="dialog" aria-labelledby="UBEogy8RUXSAiuHlv0VG-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="UBEogy8RUXSAiuHlv0VG-title">Solution</h4></div><div class="modal-body">

```r
dat %>% 
  filter(type == "death", country %in% countries) %>% 
  ggplot(aes(x = days_elapsed, 
             y = cumulative_cases, 
             color = country)) +
  geom_line() +
  theme(legend.position = "bottom") +
  labs(
    x = str_c("Days since ", min(dat$date)),
    y = "Cumulative number of deaths",
    title = "Cumulative deaths from COVID-19, selected countries"
  )
```

<img src="TFA_files/figure-html/unnamed-chunk-485-1.png" width="672" style="display: block; margin: auto;" />
</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#UBEogy8RUXSAiuHlv0VG">Solution</button>

<div class="modal fade bs-example-modal-lg" id="SPp8rOc7sdVdxnwfSwfL" tabindex="-1" role="dialog" aria-labelledby="SPp8rOc7sdVdxnwfSwfL-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="SPp8rOc7sdVdxnwfSwfL-title">Hint 2</h4></div><div class="modal-body">

```r
dat %>% 
  filter(type == "death", country %in% countries) %>% 
  ggplot(aes(x = ___, 
             y = ___, 
             color = ___)) +
  geom_line() +
  theme(legend.position = "bottom") +
  labs(
    x = str_c("Days since ", min(dat$date)),
    y = "___",
    title = "Cumulative deaths from COVID-19, selected countries"
  )
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#SPp8rOc7sdVdxnwfSwfL">Hint 2</button>

<div class="modal fade bs-example-modal-lg" id="L0RV3k9LNvdrPhCWtIIQ" tabindex="-1" role="dialog" aria-labelledby="L0RV3k9LNvdrPhCWtIIQ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="L0RV3k9LNvdrPhCWtIIQ-title">Hint 1</h4></div><div class="modal-body">

```r
dat %>% 
  filter(type == "___", country %in% ___) %>% 
```


<p>First you have to filter type and country</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#L0RV3k9LNvdrPhCWtIIQ">Hint 1</button>
2) Plot a lineplot of the cumulative number of deaths as a function of days elapsed for the selected countries. Use country as color aesthetic. 


Since the countries have different population sizes, we would like to calculate some numbers relative to the population size. First we need population sizes for each country. They are given in the dataset `world_pop` in the _tfa_ package:


```r
world_pop <- tfa::world_pop %>%
  filter(country %in% countries) %>% 
  print()
#> # A tibble: 1,505 × 3
#>    country  year       pop
#>    <chr>   <dbl>     <dbl>
#>  1 China    1800 321675013
#>  2 China    1801 324408862
#>  3 China    1802 327165946
#>  4 China    1803 329946461
#>  5 China    1804 332750607
#>  6 China    1805 335578586
#>  7 China    1806 338430598
#>  8 China    1807 341306850
#>  9 China    1808 344207546
#> 10 China    1809 347132894
#> # … with 1,495 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```


We can join the datasets using:


```r
dat <- dat %>% 
  filter(country %in% countries) %>% 
  left_join(world_pop) %>% 
  print()
#> # A tibble: 13,935 × 8
#>    country date       type      tot_cases cumulative_cases days_elapsed  year        pop
#>    <chr>   <date>     <chr>         <dbl>            <dbl>        <dbl> <dbl>      <dbl>
#>  1 China   2020-01-22 confirmed       548              548            0  2020 1424548266
#>  2 China   2020-01-22 death            17               17            0  2020 1424548266
#>  3 China   2020-01-22 recovery         28               28            0  2020 1424548266
#>  4 Denmark 2020-01-22 confirmed         0                0            0  2020    5796800
#>  5 Denmark 2020-01-22 death             0                0            0  2020    5796800
#>  6 Denmark 2020-01-22 recovery          0                0            0  2020    5796800
#>  7 France  2020-01-22 confirmed         0                0            0  2020   65721165
#>  8 France  2020-01-22 death             0                0            0  2020   65721165
#>  9 France  2020-01-22 recovery          0                0            0  2020   65721165
#> 10 Italy   2020-01-22 confirmed         0                0            0  2020   59132073
#> # … with 13,925 more rows
#> # ℹ Use `print(n = ...)` to see more rows
any(is.na(dat))  # check if any missing values
#> [1] FALSE
```




<div class="modal fade bs-example-modal-lg" id="sgRpFN7EgzphWBypyWkn" tabindex="-1" role="dialog" aria-labelledby="sgRpFN7EgzphWBypyWkn-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="sgRpFN7EgzphWBypyWkn-title">Solution</h4></div><div class="modal-body">

```r
dat <- dat %>% 
  mutate(tot_cases_pop = 100000 * tot_cases/pop)
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#sgRpFN7EgzphWBypyWkn">Solution</button>
3) Calculate `tot_cases_pop` as number of cases per 100000 inhabitants. That is, total cases divided by population and multiplied by 100000.




<div class="modal fade bs-example-modal-lg" id="VWhTIXaexGGFQQOZNNJc" tabindex="-1" role="dialog" aria-labelledby="VWhTIXaexGGFQQOZNNJc-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="VWhTIXaexGGFQQOZNNJc-title">Solution</h4></div><div class="modal-body">

```r
dat %>% 
  filter(date >= today() - days(21), type == "confirmed") %>% 
  ggplot(aes(x = date, y = tot_cases_pop, fill = country)) +
  geom_col(position = position_dodge2())
```

<img src="TFA_files/figure-html/unnamed-chunk-491-1.png" width="672" style="display: block; margin: auto;" />
</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#VWhTIXaexGGFQQOZNNJc">Solution</button>

<div class="modal fade bs-example-modal-lg" id="A854gynegLdO7mrPeZtO" tabindex="-1" role="dialog" aria-labelledby="A854gynegLdO7mrPeZtO-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="A854gynegLdO7mrPeZtO-title">Hint 2</h4></div><div class="modal-body">

```r
dat %>% 
  filter(date >= today() - days(21), type == ___) %>% 
  ggplot(aes(x = date, y = ___, fill = ___)) +
  geom_col(position = position_dodge2())
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#A854gynegLdO7mrPeZtO">Hint 2</button>

<div class="modal fade bs-example-modal-lg" id="OJ6jtY8uO8tRQPJ8nqBS" tabindex="-1" role="dialog" aria-labelledby="OJ6jtY8uO8tRQPJ8nqBS-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="OJ6jtY8uO8tRQPJ8nqBS-title">Hint 1</h4></div><div class="modal-body">

```r
# Use this to find date 21 days ago
today() - days(21)
#> [1] "2022-07-18"
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#OJ6jtY8uO8tRQPJ8nqBS">Hint 1</button>
4) Plot the number of confirmed cases per 100000 inhabitants for the last 21 days. Use country as fill aesthetic.




<div class="modal fade bs-example-modal-lg" id="F5lHV8Tq0zmFjS2bOzR0" tabindex="-1" role="dialog" aria-labelledby="F5lHV8Tq0zmFjS2bOzR0-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="F5lHV8Tq0zmFjS2bOzR0-title">Solution</h4></div><div class="modal-body">

```r
dat %>% 
  filter(date >= today() - days(14), country == "Denmark", type == "confirmed") %>% 
  ggplot(aes(x = date, y = tot_cases_pop)) +
  geom_col()
```

<img src="TFA_files/figure-html/unnamed-chunk-494-1.png" width="672" style="display: block; margin: auto;" />
</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#F5lHV8Tq0zmFjS2bOzR0">Solution</button>

<div class="modal fade bs-example-modal-lg" id="1I77SPGOYE2x9bwzan56" tabindex="-1" role="dialog" aria-labelledby="1I77SPGOYE2x9bwzan56-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="1I77SPGOYE2x9bwzan56-title">Hint</h4></div><div class="modal-body">

```r
dat %>% 
  filter(date >= ___, country == ___, type == ___) %>% 
  ggplot(aes(x = date, y = tot_cases_pop)) +
  geom_col()
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#1I77SPGOYE2x9bwzan56">Hint</button>
5) Plot the number of confirmed cases per 100000 inhabitants in Denmark for the last 14 days.



### Exercise (Lego and sales) {#ex-lego}

Use the *exercise R Markdown template* to solve this exercise (**File > New File > R Markdown...**, select **From template** and then **TFA Exercise**).

Consider (simulated) data of Lego sales in 2018 for a sample of customers who bought Legos in the U.S. The dataset is called `lego_sales`. You can find descriptions of each of the variables in the help file for the dataset, which you can access by running `?lego_sales` in your Console.

You need the _tidyverse_ package as usual and the *dsbox* package for the data.


```r
library(tidyverse)
library(dsbox)   # install using devtools::install_github("rstudio-education/dsbox")
```

Answer the following questions using a table with numbers and try to visualize it. For each question, state your answer in a sentence, e.g. "The first three common names of purchasers are ...".

1) What are the three most common first names of purchasers?

2) What are the three most common themes of Lego sets purchased?

3) Among the most common theme of Lego sets purchased, what is the most common subtheme?





<div class="modal fade bs-example-modal-lg" id="8DKbCH5drlbfkRCGQ62d" tabindex="-1" role="dialog" aria-labelledby="8DKbCH5drlbfkRCGQ62d-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="8DKbCH5drlbfkRCGQ62d-title">Hint</h4></div><div class="modal-body">

<p>Use the <code>case_when()</code> function.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#8DKbCH5drlbfkRCGQ62d">Hint</button>

4) Create a new variable called `age_group` and group the ages into the 
following categories: "18 and under", "19 - 25", "26 - 35", "36 - 50", "51 and over".




<div class="modal fade bs-example-modal-lg" id="XofTrmNzDyRJrhYEWkUT" tabindex="-1" role="dialog" aria-labelledby="XofTrmNzDyRJrhYEWkUT-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="XofTrmNzDyRJrhYEWkUT-title">Hint</h4></div><div class="modal-body">

<p>You may need to consider quantity of purchases.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#XofTrmNzDyRJrhYEWkUT">Hint</button>

5) Which age group has purchased the highest number of Lego sets. 




<div class="modal fade bs-example-modal-lg" id="VbUCVs4SrKaTlWywZ8Fz" tabindex="-1" role="dialog" aria-labelledby="VbUCVs4SrKaTlWywZ8Fz-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="VbUCVs4SrKaTlWywZ8Fz-title">Hint</h4></div><div class="modal-body">

<p><em>Hint:</em> You will need to consider quantity of purchases as well as price of Lego sets.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#VbUCVs4SrKaTlWywZ8Fz">Hint</button>

6) Which age group has spent the most money on Legos?

7) Come up with a question you want to answer using these data, and write it down. 
Then, create a data visualization that answers the question, and explain how 
your visualization answers the question.




<!--chapter:end:14_r-plot.Rmd-->

---
output: html_document
editor_options: 
  chunk_output_type: console
---


# (PART) Extra {-} 

# Fitting probability distributions {#mod-r-dist-fit}

Fitting distributions to data is a very common task in statistics and consists in choosing a probability distribution modelling the random variable, as well as finding parameter estimates for that distribution. This requires judgment and expertise and generally needs an iterative process of distribution choice, parameter estimation, and quality of fit assessment. In this module we will limit us to univariate data, i.e. univariate distributions such as normal, uniform, Poisson and exponential distributions. We will use  the [`fitdistrplus`](https://lbbe.univ-lyon1.fr/fr/fitdistrplus) package for fitting distributions.

We are all different and you may like different learning styles compared to others. In the learning path diagram, there may be links to alternative online content. Note this is an alternative to the standard learning path that you may use instead. The learning path may also have extra content, that is not a part of syllabus, you can have a look at. 


```{=html}
<div id="htmlwidget-5af3eef5a1de42af3083" style="width:100%;height:288px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-5af3eef5a1de42af3083">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"📖 Introduction\", URL = \"#sec-r-dist-fit-intro\", tooltip = \"Introduction\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"0,2!\"] \n  \"2\" [label = \"📖 Continuous data\", URL = \"#sec-r-dist-fit-cont\", tooltip = \"Continuous data\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"2,2!\"] \n  \"3\" [label = \"📖 Discrete data\", URL = \"#sec-r-dist-fit-discrete\", tooltip = \"Discrete data\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"4,2!\"] \n  \"4\" [label = \"📖 The Poisson process\", URL = \"#sec-dist-fit-pois\", tooltip = \"The Poisson process\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"rect\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"6,2!\"] \n  \"5\" [label = \"💻 Exercises\", URL = \"#ex-r-dist-fit\", tooltip = \"Exercises\", style = \"filled\", fixedsize = \"FALSE\", fontsize = \"11\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica-bold\", shape = \"egg\", margin = \"0.2\", width = \"0.5\", fillcolor = \"DarkSeaGreen4\", pos = \"8.5,2!\"] \n  \"6\" [label = \"\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"0.5\", fontname = \"Helvetica\", shape = \"rect\", height = \"1\", width = \"6\", fillcolor = \"#F0F8FF\", pos = \"2.4,0.21!\"] \n  \"7\" [label = \"Color:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"0.8\", fillcolor = \"#FFFFFE\", pos = \"-0.23,0.55!\"] \n  \"8\" [label = \"mandatory\", URL = \"\", tooltip = \"Mandatory syllabus.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkSeaGreen4\", pos = \"0,0.15!\"] \n  \"9\" [label = \"alternative\", URL = \"\", tooltip = \"Alternative syllabus if you prefer another learning style.\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"DarkOrange4\", pos = \"1,0.15!\"] \n  \"10\" [label = \"extra\", URL = \"\", tooltip = \"Extra learning if you are interested (not part of syllabus).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"0.8\", fillcolor = \"PeachPuff3\", pos = \"2,0.15!\"] \n  \"11\" [label = \"Shape:\", URL = \"\", tooltip = \" \", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"black\", penwidth = \"0\", fontname = \"Helvetica\", shape = \"none\", height = \"0\", width = \"1\", fillcolor = \"#FFFFFE\", pos = \"3.2,0.55!\"] \n  \"12\" [label = \"non-interactive\", URL = \"\", tooltip = \"Non-interactive learning content (e.g. reading).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"rect\", width = \"1\", fillcolor = \"Grey40\", pos = \"3.5,0.15!\"] \n  \"13\" [label = \"interactive\", URL = \"\", tooltip = \"Interactive learning content (tutorial, exercises etc.).\", style = \"filled\", fixedsize = \"true\", fontsize = \"9\", fontcolor = \"white\", penwidth = \"2\", fontname = \"Helvetica\", shape = \"egg\", width = \"1\", fillcolor = \"Grey40\", pos = \"4.75,0.15!\"] \n\"1\"->\"2\" [color = \"black\", arrowhead = \"vee\"] \n\"2\"->\"3\" [color = \"black\", arrowhead = \"vee\"] \n\"3\"->\"4\" [color = \"black\", arrowhead = \"vee\"] \n\"4\"->\"5\" [color = \"black\", arrowhead = \"vee\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
```

## Learning outcomes {#lo-r-dist-fit}

By the end of this module, you are expected to:

* Have knowledge about different univariate distributions. 
* Identify continuous and discrete data.
* Fit different distributions to data. 

The learning outcomes relate to the [overall learning goals](#lg-course) number 7 and 11-14 of the course.

<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->


## Introduction {#sec-r-dist-fit-intro}

Fitting distributions to data is a very common task in statistics and consists in choosing a probability distribution modelling the random variable, as well as finding parameter estimates for that distribution. This requires judgment and expertise and generally needs an iterative process of distribution choice, parameter estimation, and quality of fit assessment. In this module we will limit us to univariate data, i.e. univariate distributions such as a normal, uniform, Poisson and exponential distribution.

Consider a dataset $x = (x_1, \ldots, x_n)$ with $n$ observations which is assumed to be _sample_ observations of a random variable $X$. Our goal is to find a distribution that fit the data well and estimate the parameters of the distribution. For instance if the distribution is a normal distribution then the mean and variance should be estimated. 

Finding the distribution is an iterative process by considering distribution choice, parameter estimation, and quality of fit assessment repeatedly until you are satisfied. The first step is to decide if you data is should fit a discrete or continuous distribution. That is, should the random variable always take discrete values or could/are continuous values possible/okay? Note even though your sample only contain discrete values it is not necessarily samples from a discrete distribution. Consider for instance the dataset `groundbeef` which contains values of serving sizes in grams of ground beef patties consumed by children under 5 years old:


```r
library(fitdistrplus)
library(tidyverse)
data("groundbeef")   # activate the dataset
dat <- as_tibble(groundbeef)
str(dat)
#> tibble [254 × 1] (S3: tbl_df/tbl/data.frame)
#>  $ serving: num [1:254] 30 10 20 24 20 24 40 20 50 30 ...
```

Serving size in grams is only given using integers; however it is obvious that a continuous distribution should be fitted. We select the `serving` column so `dat` becomes a vector with the observations.


```r
dat <- dat$serving
```


## Fitting distributions to continuous data {#sec-r-dist-fit-cont}

Before fitting one or more distributions to a data set, it is generally necessary to choose good
candidates among a predefined set of distributions. This choice may be guided by the knowledge of
stochastic processes governing the modeled variable, or, in the absence of knowledge regarding the
underlying process, by the observation of its empirical distribution. We will use the
[`fitdistrplus`](https://lbbe.univ-lyon1.fr/fr/fitdistrplus) package for fitting distributions. Let
us continue with the `groundbeef` dataset.

First of all, it is common to start with plots of the empirical distribution function and the
histogram (or density plot), which can be obtained with the `plotdist` function which provides two
plots where the left-hand plot is by default the histogram on a density scale and the
right-hand plot the empirical cumulative distribution function (CDF).


```r
plotdist(dat, histo = TRUE, demp = TRUE)
```

<div class="figure" style="text-align: center">
<img src="TFA_files/figure-html/unnamed-chunk-504-1.png" alt="Empirical density and distribution." width="672" />
<p class="caption">(\#fig:unnamed-chunk-504)Empirical density and distribution.</p>
</div>

The empirical plots of the density and the CDF may give you a hit about the distribution of $X$. But
often additional descriptive statistics may help to choose candidates to describe a distribution
among a set of parametric distributions. Especially the skewness and kurtosis, linked to the third
and fourth moments, are useful for this purpose. A non-zero skewness reveals a lack of symmetry of
the empirical distribution, while the kurtosis value quantifies the weight of tails in comparison to
the normal distribution for which the kurtosis equals 3.

The skewness and kurtosis and their corresponding estimate are given by
  \begin{equation}
    \label{skewness}
    sk(X) = \frac{E[(X-E(X))^3]}{Var(X)^{\frac{3}{2}}}~,~
    \widehat{sk}=\frac{\sqrt{n(n-1)}}{n-2}\times\frac{m_{3}}{m_{2}^{\frac{3}{2}}},
  \end{equation}

  \begin{equation}
    \label{kurtosis}
    kr(X) = \frac{E[(X-E(X))^4]}{Var(X)^{2}}~,~
    \widehat{kr}=\frac{n-1}{(n-2)(n-3)}((n+1) \times \frac{m_{4}}{m_{2}^{2}}-3(n-1)) + 3,
  \end{equation}
where $m_{2}$, $m_{3}$, $m_{4}$ denote empirical moments defined by
$m_{k}=\frac{1}{n}\sum_{i=1}^n(x_{i}-\overline{x})^{k}$, with mean value $\overline{x}$.

The `descdist` function provides classical descriptive statistics (minimum, maximum, median, mean,
standard deviation), skewness and kurtosis. A skewness-kurtosis plot such as the one proposed by
@Cullen99 is provided by the `descdist` function for the empirical distribution On this plot, values
for common distributions are displayed in order to help the choice of distributions to fit to
data. For some distributions (normal, uniform, logistic, exponential), there is only one possible
value for the skewness and the kurtosis. Thus, the distribution is represented by a single point
on the plot. For other distributions, areas of possible values are represented, consisting of
lines (as for gamma and lognormal distributions), or areas (as for beta distribution).
Nevertheless, the user needs to know that skewness and kurtosis, like all higher moments, have a
very high variance. Hence the skewness-kurtosis plot should then be regarded as indicative only
and the properties of the random variable should be considered, notably its expected value and its
range, as a complement to the use of the `plotdist` and `descdist` functions.

Below is a call to the `descdist` function to describe the distribution of the serving size from the
`groundbeef` data set and to draw the corresponding skewness-kurtosis plot. Looking at the results
notice that the observed skewness is positive and the kurtosis is not far from 3. Hence the fit of
three common right-skewed distributions could be considered: Weibull, gamma and lognormal
distributions.


```r
descdist(dat)
#> summary statistics
#> ------
#> min:  10   max:  200 
#> median:  79 
#> mean:  73.6 
#> estimated sd:  35.9 
#> estimated skewness:  0.735 
#> estimated kurtosis:  3.55
```

<div class="figure" style="text-align: center">
<img src="TFA_files/figure-html/unnamed-chunk-505-1.png" alt="Skewness-kurtosis plot for a continuous variable (`groundbeef`)." width="672" />
<p class="caption">(\#fig:unnamed-chunk-505)Skewness-kurtosis plot for a continuous variable (`groundbeef`).</p>
</div>

Once one or more parametric distributions have been selected they are fitted to the data set using maximum likelihood. This is done using the `fitdist` function:


```r
fitW <- fitdist(dat, distr = "weibull")
fitG <- fitdist(dat, distr = "gamma")
fitL <- fitdist(dat, distr = "lnorm")
```

The function returns a list with information about the fit such as the parameter estimates, the loglikelihood, the Akaike and Bayesian information criteria (the so-called AIC and BIC). An overview can be seen using the `summary` function:


```r
summary(fitW)
#> Fitting of the distribution ' weibull ' by maximum likelihood 
#> Parameters : 
#>       estimate Std. Error
#> shape     2.19      0.105
#> scale    83.35      2.527
#> Loglikelihood:  -1255   AIC:  2514   BIC:  2522 
#> Correlation matrix:
#>       shape scale
#> shape 1.000 0.322
#> scale 0.322 1.000
summary(fitG)
#> Fitting of the distribution ' gamma ' by maximum likelihood 
#> Parameters : 
#>       estimate Std. Error
#> shape   4.0083    0.34134
#> rate    0.0544    0.00494
#> Loglikelihood:  -1254   AIC:  2511   BIC:  2518 
#> Correlation matrix:
#>       shape  rate
#> shape 1.000 0.938
#> rate  0.938 1.000
summary(fitL)
#> Fitting of the distribution ' lnorm ' by maximum likelihood 
#> Parameters : 
#>         estimate Std. Error
#> meanlog    4.169     0.0337
#> sdlog      0.537     0.0238
#> Loglikelihood:  -1261   AIC:  2527   BIC:  2534 
#> Correlation matrix:
#>         meanlog sdlog
#> meanlog       1     0
#> sdlog         0     1
```

The fit to the data can be plotted using four classical goodness-of-fit plots [@Cullen99]:

- a density plot representing the density function of the fitted distribution along with the
histogram of the empirical distribution,
- a CDF plot of both the empirical distribution and the fitted distribution,
- a Q-Q plot representing the empirical quantiles (y-axis) against the theoretical quantiles
(x-axis),
- a P-P plot representing the empirical distribution function evaluated at each data point (y-axis)
against the fitted distribution function (x-axis).


```r
par(mfrow = c(2, 2))  # 4 plots in one figure
pLegend <- c("Weibull", "lognormal", "gamma")
lst <- list(fitW, fitL, fitG)
denscomp(lst, legendtext = pLegend)
qqcomp(lst, legendtext = pLegend)
cdfcomp(lst, legendtext = pLegend)
ppcomp(lst, legendtext = pLegend)
```

<div class="figure" style="text-align: center">
<img src="TFA_files/figure-html/unnamed-chunk-508-1.png" alt="Four Goodness-of-fit plots for various distributions fitted to the serving size data." width="100%" />
<p class="caption">(\#fig:unnamed-chunk-508)Four Goodness-of-fit plots for various distributions fitted to the serving size data.</p>
</div>

The density plot and the CDF plot may be considered as the basic classical goodness-of-fit plots.
The two other plots are complementary and can be very informative in some cases. The Q-Q plot
emphasizes the lack-of-fit at the distribution tails while the P-P plot emphasizes the lack-of-fit
at the distribution center. In the present example, none of the three fitted distributions correctly
describes the center of the distribution, but the Weibull and gamma distributions could be preferred
for their better description of the right tail of the empirical distribution. Moreover, these
distributions also have the lowest AIC values.

Other methods can be used to fit distributions to the data instead of maximum likelihood. For details see @DelignetteMuller15.

### Example: breakdown times 

We consider a dataset that contains the recorded breakdown times of a machine part in days.   

```r
library(tfa)  # update to latest version using remotes::install_github("bss-osca/tfa/tfa-package", upgrade = FALSE) 
dat <- breakdown
plotdist(dat, histo = TRUE, demp = TRUE)
```

<img src="TFA_files/figure-html/unnamed-chunk-509-1.png" width="672" style="display: block; margin: auto;" />

Since breakdown times may be seen as a continuous variable we try to fit a continuous variable. First we try to find distribution candidates:


```r
descdist(dat)
#> summary statistics
#> ------
#> min:  91   max:  280 
#> median:  182 
#> mean:  183 
#> estimated sd:  30.7 
#> estimated skewness:  0.0503 
#> estimated kurtosis:  3.32
```

<img src="TFA_files/figure-html/unnamed-chunk-510-1.png" width="672" style="display: block; margin: auto;" />

The observation is close to the normal and lognormal values and we try to fit these two distributions:


```r
fitN <- fitdist(dat, distr = "norm")
fitL <- fitdist(dat, distr = "lnorm")
summary(fitN)
#> Fitting of the distribution ' norm ' by maximum likelihood 
#> Parameters : 
#>      estimate Std. Error
#> mean    183.2       1.99
#> sd       30.6       1.41
#> Loglikelihood:  -1142   AIC:  2288   BIC:  2295 
#> Correlation matrix:
#>      mean sd
#> mean    1  0
#> sd      0  1
summary(fitL)
#> Fitting of the distribution ' lnorm ' by maximum likelihood 
#> Parameters : 
#>         estimate Std. Error
#> meanlog    5.196    0.01130
#> sdlog      0.174    0.00799
#> Loglikelihood:  -1148   AIC:  2300   BIC:  2306 
#> Correlation matrix:
#>         meanlog sdlog
#> meanlog       1     0
#> sdlog         0     1
par(mfrow = c(2, 2))  # 4 plots in one figure
pLegend <- c("normal", "lognormal")
lst <- list(fitN, fitL)
denscomp(lst, legendtext = pLegend)
qqcomp(lst, legendtext = pLegend)
cdfcomp(lst, legendtext = pLegend)
ppcomp(lst, legendtext = pLegend)
```

<div class="figure" style="text-align: center">
<img src="TFA_files/figure-html/unnamed-chunk-511-1.png" alt="Four Goodness-of-fit plots for various distributions fitted to the breakdown data." width="100%" />
<p class="caption">(\#fig:unnamed-chunk-511)Four Goodness-of-fit plots for various distributions fitted to the breakdown data.</p>
</div>

Note it seems that the normal distribution has a better fit (AIC smallest). Also intuitively it makes sense that breakdown times are normal distributed around a mean value (however the probability of negative values should be low).  







## Fitting distributions to discrete data {#sec-r-dist-fit-discrete}

You may also need to fit discrete distributions such as:

- The Poisson distribution which is a discrete probability distribution that expresses the probability of a given number of events occurring in a fixed interval of time and/or space if these events occur with a known average rate and independently of the time since the last event. The Poisson distribution can be applied to systems with a large number of possible events, each of which is rare. How many such events will occur during a fixed time interval? Under the right circumstances, this is a random number following a Poisson distribution.

- The binomial distribution which is a probability distribution that is used to model the number of successes in a sequence of $n$ independent experiments with probability $p$ for success. The Bernoulli distribution is a special case of the Binomial distribution where $n=1$ (one experiment).

- The negative binomial distribution which is a discrete probability distribution that models the number of failures in a sequence of independent and identically distributed Bernoulli trials before a specified number of successes occurs.

- The geometric distribution which is a special case of the negative binomial distribution where the specified number of successes are one.

### Example: sales of lottery tickets

Consider data of the number of houses that must be visited before selling 20 lottery tickets (assuming only one is sold at a time). 


```r
dat <- lottery
plotdist(dat, discrete = TRUE)
```

<img src="TFA_files/figure-html/unnamed-chunk-512-1.png" width="672" style="display: block; margin: auto;" />

Since the number of houses that must be visited (trials) is unknown, a negative binomial distribution seems as a good choice (with 20 successes). The fit of a discrete distribution to discrete data requires the same procedure as for continuous data.


```r
fit <- fitdist(dat, distr = "nbinom", discrete = TRUE, fix.arg = list(size = 20))
summary(fit)
#> Fitting of the distribution ' nbinom ' by maximum likelihood 
#> Parameters : 
#>    estimate Std. Error
#> mu     37.2       1.38
#> Fixed parameters:
#>      value
#> size    20
#> Loglikelihood:  -200   AIC:  402   BIC:  404
par(mfrow = c(1, 2))  # 2 plots in one figure
pLegend <- c("negative binomial")
lst <- list(fit)
denscomp(lst, legendtext = pLegend)
cdfcomp(lst, legendtext = pLegend)
```

<div class="figure" style="text-align: center">
<img src="TFA_files/figure-html/unnamed-chunk-513-1.png" alt="Four Goodness-of-fit plots for various distributions fitted to the breakdown data." width="100%" />
<p class="caption">(\#fig:unnamed-chunk-513)Four Goodness-of-fit plots for various distributions fitted to the breakdown data.</p>
</div>

Note only the density and CDF is plotted for discrete data. Moreover, this is an example where some of the parameters of the negative binomial distribution are known in advance. The negative binomial distribution has two parameters (see `?pnbinom`): the specified number of successes to occur (`size` argument) and the probability of success in each trial (`prob` argument). Given the information about the dataset, `size` equals 20 and we want to to try finding the probability of success in each trial. You fix a parameter by using the `fix.arg` argument in `fitdist`. Note that the summary only outputs the mean estimate `mu` but `prob = size/(size+mu)`:


```r
prob <- 20/(20 + fit$estimate)
names(prob) <- NULL
prob
#> [1] 0.35
```

That is the probability of success when visiting each house is approx. 35% and e.g. the number of houses that must be visited before all lottery tickets are sold with 95% probability is:


```r
qnbinom(0.95, size = 20, prob)
#> [1] 55
```


## The Poisson process {#sec-dist-fit-pois}

A Poisson process models a series of discrete events. The average time between events is known, but the exact timing of events is random: the waiting time between events are exponential distributed. Since the exponential distribution is memoryless, the arrival time of an event is independent of what happend in the past (e.g. the arrival time of the last event). A Poisson process is often used in queueing theory to model random events, such as the arrival of customers at a store or phone calls arriving at a call center.

More formally a Poisson process is defined as process counting the total number of events $N(t)$ at time $t$ given the average arrival rate $\lambda$. The process satisfy that:

- $N(0)=0$;
- The waiting time between events is exponential distributed with rate $\lambda$;
- The number of arrivals in any interval of length $\tau$ is Poisson distributed with parameter $\tau\lambda$

The arrivals in a Poisson process with on average 4 arrivals per time unit ($\lambda=4$) may look like:

<img src="TFA_files/figure-html/poisson_process-1.png" width="672" style="display: block; margin: auto;" />

Let us consider the data set `demand_goods` containing demand for two different goods/products:


```r
library(tfa)  # update to latest version using remotes::install_github("bss-osca/tfa/tfa-package", upgrade = FALSE) 
demand_goods
#> # A tibble: 362 × 3
#>    date                demand product
#>    <dttm>               <dbl>   <dbl>
#>  1 2016-01-01 00:00:00      8       1
#>  2 2016-01-06 00:00:00     10       1
#>  3 2016-01-08 00:00:00     10       1
#>  4 2016-01-11 00:00:00      7       1
#>  5 2016-01-22 00:00:00      9       1
#>  6 2016-02-01 00:00:00      8       1
#>  7 2016-02-05 00:00:00      8       1
#>  8 2016-02-06 00:00:00      7       1
#>  9 2016-02-13 00:00:00      9       1
#> 10 2016-02-14 00:00:00      8       1
#> # … with 352 more rows
#> # ℹ Use `print(n = ...)` to see more rows
```

The arrival of demands and demand size may follow a compound Poisson process which differ from a Poisson process by allowing more than a demand of one given an arrival. That is, the inter arrival times should still follow an exponential distribution. Let us find the inter arrival times between each order and try to fit it: 


```r
library(tidyverse)
datDf <- demand_goods %>% 
  group_by(product) %>% 
  mutate(between = as.numeric(date - lag(date), units="days")) %>% 
  print()
#> # A tibble: 362 × 4
#> # Groups:   product [2]
#>    date                demand product between
#>    <dttm>               <dbl>   <dbl>   <dbl>
#>  1 2016-01-01 00:00:00      8       1      NA
#>  2 2016-01-06 00:00:00     10       1       5
#>  3 2016-01-08 00:00:00     10       1       2
#>  4 2016-01-11 00:00:00      7       1       3
#>  5 2016-01-22 00:00:00      9       1      11
#>  6 2016-02-01 00:00:00      8       1      10
#>  7 2016-02-05 00:00:00      8       1       4
#>  8 2016-02-06 00:00:00      7       1       1
#>  9 2016-02-13 00:00:00      9       1       7
#> 10 2016-02-14 00:00:00      8       1       1
#> # … with 352 more rows
#> # ℹ Use `print(n = ...)` to see more rows

dat <- datDf %>% 
  filter(product == 1, !is.na(between)) %>% 
  pull(between)
plotdist(dat, histo = TRUE, demp = TRUE)
descdist(dat)
#> summary statistics
#> ------
#> min:  0   max:  33 
#> median:  4 
#> mean:  5.08 
#> estimated sd:  4.72 
#> estimated skewness:  1.85 
#> estimated kurtosis:  8.86
```

<img src="TFA_files/figure-html/unnamed-chunk-517-1.png" width="672" style="display: block; margin: auto;" /><img src="TFA_files/figure-html/unnamed-chunk-517-2.png" width="672" style="display: block; margin: auto;" />

The observation is close to the exponential and lognormal values. However, a lognormal distribution cannot equal zero values:


```r
fitE1 <- fitdist(dat, distr = "exp")
summary(fitE1)
#> Fitting of the distribution ' exp ' by maximum likelihood 
#> Parameters : 
#>      estimate Std. Error
#> rate    0.197     0.0135
#> Loglikelihood:  -557   AIC:  1115   BIC:  1119
par(mfrow = c(2, 2))  # 4 plots in one figure
pLegend <- c("exp")
lst <- list(fitE1)
denscomp(lst, legendtext = pLegend)
qqcomp(lst, legendtext = pLegend)
cdfcomp(lst, legendtext = pLegend)
ppcomp(lst, legendtext = pLegend)
```

<div class="figure" style="text-align: center">
<img src="TFA_files/figure-html/unnamed-chunk-518-1.png" alt="Four Goodness-of-fit plots for various distributions fitted to the breakdown data." width="100%" />
<p class="caption">(\#fig:unnamed-chunk-518)Four Goodness-of-fit plots for various distributions fitted to the breakdown data.</p>
</div>

The fit seems okay. Note that the horizontal and vertical points in the Q-Q and P-P plot indicate that another scale on measuring the inter arrival times would have been better (such as hours or minutes). Using days may round the numbers to much.

Let us do the analysis for product 2:


```r
dat <- datDf %>% 
  filter(product == 2, !is.na(between)) %>% 
  pull(between)
plotdist(dat, histo = TRUE, demp = TRUE)
descdist(dat)
#> summary statistics
#> ------
#> min:  0   max:  41 
#> median:  5 
#> mean:  7.36 
#> estimated sd:  7.26 
#> estimated skewness:  2 
#> estimated kurtosis:  8.4
```

<img src="TFA_files/figure-html/unnamed-chunk-519-1.png" width="672" style="display: block; margin: auto;" /><img src="TFA_files/figure-html/unnamed-chunk-519-2.png" width="672" style="display: block; margin: auto;" />

The observation is close to the exponential values:


```r
fitE2 <- fitdist(dat, distr = "exp")
summary(fitE2)
#> Fitting of the distribution ' exp ' by maximum likelihood 
#> Parameters : 
#>      estimate Std. Error
#> rate    0.136     0.0112
#> Loglikelihood:  -444   AIC:  889   BIC:  892
par(mfrow = c(2, 2))  # 4 plots in one figure
pLegend <- c("exp")
lst <- list(fitE2)
denscomp(lst, legendtext = pLegend)
qqcomp(lst, legendtext = pLegend)
cdfcomp(lst, legendtext = pLegend)
ppcomp(lst, legendtext = pLegend)
```

<div class="figure" style="text-align: center">
<img src="TFA_files/figure-html/unnamed-chunk-520-1.png" alt="Four Goodness-of-fit plots for various distributions fitted to the breakdown data." width="100%" />
<p class="caption">(\#fig:unnamed-chunk-520)Four Goodness-of-fit plots for various distributions fitted to the breakdown data.</p>
</div>

Again the fit seems okay. 

To summarize the demand rate for product 1 is estimated to be 0.2 per day and for product 2 to be 0.14 per day.

Given a demand arrive the question is how much is the demand size? That is, we have to fit a distribution to the demand. Let us do the analysis for product 2:


```r
dat <- datDf %>% 
  filter(product == 2) %>% 
  pull(demand)
plotdist(dat, histo = TRUE, demp = TRUE, discrete = TRUE)
```

<img src="TFA_files/figure-html/unnamed-chunk-521-1.png" width="672" style="display: block; margin: auto;" />

Let us try to fit the negative binomial, Poisson and geometric distribution:


```r
fitN2 <- fitdist(dat, distr = "nbinom")
fitP2 <- fitdist(dat, distr = "pois")
fitG2 <- fitdist(dat, distr = "geom")
summary(fitN2)
#> Fitting of the distribution ' nbinom ' by maximum likelihood 
#> Parameters : 
#>      estimate Std. Error
#> size     3.83      0.939
#> mu       3.19      0.198
#> Loglikelihood:  -321   AIC:  645   BIC:  651 
#> Correlation matrix:
#>           size        mu
#> size  1.000000 -0.000436
#> mu   -0.000436  1.000000
summary(fitP2)
#> Fitting of the distribution ' pois ' by maximum likelihood 
#> Parameters : 
#>        estimate Std. Error
#> lambda     3.19      0.146
#> Loglikelihood:  -340   AIC:  683   BIC:  686
summary(fitG2)
#> Fitting of the distribution ' geom ' by maximum likelihood 
#> Parameters : 
#>      estimate Std. Error
#> prob    0.239     0.0171
#> Loglikelihood:  -343   AIC:  688   BIC:  691
par(mfrow = c(1, 2)) 
pLegend <- c("neg binomial", "Poisson", "geometric")
lst <- list(fitN2, fitP2, fitG2)
denscomp(lst, legendtext = pLegend)
cdfcomp(lst, legendtext = pLegend)
```

<div class="figure" style="text-align: center">
<img src="TFA_files/figure-html/unnamed-chunk-522-1.png" alt="Four Goodness-of-fit plots for various distributions fitted to the breakdown data." width="100%" />
<p class="caption">(\#fig:unnamed-chunk-522)Four Goodness-of-fit plots for various distributions fitted to the breakdown data.</p>
</div>

The negative binomial seems to give the best fit and may be a good candidate.


## Recap {#rc-r-dist-fit}

  * Fitting distributions to data is a very common task in statistics and consists in choosing a probability distribution modelling the random variable, as well as finding parameter estimates for that distribution. 
  * Fitting a univariate distribution requires judgment and expertise and generally needs an iterative process of distribution choice, parameter estimation, and quality of fit assessment. Steps may be:
    - Examine data a decide on discrete vs continuous distribution.
    - Find a set of candidate distributions.
    - Fit the distributions using statistical methods and consider various plots.
    - Decide on a distribution
  * The AIC value may give you an indication about the best model fit. 
  * Other methods can be used to fit distributions to the data instead of maximum likelihood. For details see @DelignetteMuller15.
  * This module have only considered uncensored data. See @DelignetteMuller15 on how to handle censored data. 
    
You may also have a look at the [slides for this module](https://bss-osca.github.io/tfa/slides/09-01_r-dist-fit-slides.html).


## Exercises {#ex-r-dist-fit}

Below you will find a set of exercises. Always have a look at the exercises before you meet in your study group and try to solve them yourself. Are you stuck, see the [help page](#help). Some of the solutions to each exercise can be seen by pressing the button at each question. Beware, you will not learn by giving up too early. Put some effort into finding a solution! 

[Link to the project on RStudio Cloud for this module][r-cloud-mod19]. 

### Exercise - Call center

Consider data from a call center: the Los Angeles 311 Call Center in 2014 from 8-17:


```r
library(tidyverse)
library(tfa)
library(skimr)
skim(calls)
```


<table style='width: auto;'
      class='table table-condensed'>
<caption>(\#tab:unnamed-chunk-523)Data summary</caption>
<tbody>
  <tr>
   <td style="text-align:left;"> Name </td>
   <td style="text-align:left;"> calls </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Number of rows </td>
   <td style="text-align:left;"> 855077 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Number of columns </td>
   <td style="text-align:left;"> 6 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> _______________________ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Column type frequency: </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> character </td>
   <td style="text-align:left;"> 3 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> difftime </td>
   <td style="text-align:left;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> numeric </td>
   <td style="text-align:left;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> POSIXct </td>
   <td style="text-align:left;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ________________________ </td>
   <td style="text-align:left;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Group variables </td>
   <td style="text-align:left;"> None </td>
  </tr>
</tbody>
</table>


**Variable type: character**

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> skim_variable </th>
   <th style="text-align:right;"> n_missing </th>
   <th style="text-align:right;"> complete_rate </th>
   <th style="text-align:right;"> min </th>
   <th style="text-align:right;"> max </th>
   <th style="text-align:right;"> empty </th>
   <th style="text-align:right;"> n_unique </th>
   <th style="text-align:right;"> whitespace </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> department </td>
   <td style="text-align:right;"> 79892 </td>
   <td style="text-align:right;"> 0.91 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 60 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> service </td>
   <td style="text-align:right;"> 79892 </td>
   <td style="text-align:right;"> 0.91 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 70 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1304 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> solved_how </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 30 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 17 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
</tbody>
</table>


**Variable type: difftime**

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> skim_variable </th>
   <th style="text-align:right;"> n_missing </th>
   <th style="text-align:right;"> complete_rate </th>
   <th style="text-align:left;"> min </th>
   <th style="text-align:left;"> max </th>
   <th style="text-align:left;"> median </th>
   <th style="text-align:right;"> n_unique </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> time </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> 28800 secs </td>
   <td style="text-align:left;"> 61200 secs </td>
   <td style="text-align:left;"> 12:00:10 </td>
   <td style="text-align:right;"> 31964 </td>
  </tr>
</tbody>
</table>


**Variable type: numeric**

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> skim_variable </th>
   <th style="text-align:right;"> n_missing </th>
   <th style="text-align:right;"> complete_rate </th>
   <th style="text-align:right;"> mean </th>
   <th style="text-align:right;"> sd </th>
   <th style="text-align:right;"> p0 </th>
   <th style="text-align:right;"> p25 </th>
   <th style="text-align:right;"> p50 </th>
   <th style="text-align:right;"> p75 </th>
   <th style="text-align:right;"> p100 </th>
   <th style="text-align:left;"> hist </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> zip </td>
   <td style="text-align:right;"> 19512 </td>
   <td style="text-align:right;"> 0.98 </td>
   <td style="text-align:right;"> 91653 </td>
   <td style="text-align:right;"> 5420 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 90029 </td>
   <td style="text-align:right;"> 90094 </td>
   <td style="text-align:right;"> 91403 </td>
   <td style="text-align:right;"> 99999 </td>
   <td style="text-align:left;"> ▁▁▁▁▇ </td>
  </tr>
</tbody>
</table>


**Variable type: POSIXct**

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> skim_variable </th>
   <th style="text-align:right;"> n_missing </th>
   <th style="text-align:right;"> complete_rate </th>
   <th style="text-align:left;"> min </th>
   <th style="text-align:left;"> max </th>
   <th style="text-align:left;"> median </th>
   <th style="text-align:right;"> n_unique </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> date </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:left;"> 2014-01-01 </td>
   <td style="text-align:left;"> 2014-12-31 </td>
   <td style="text-align:left;"> 2014-07-04 </td>
   <td style="text-align:right;"> 363 </td>
  </tr>
</tbody>
</table>

We first transform the dataset a bit:


```r
library(lubridate)
calls <- calls %>%
  group_by(date) %>% 
  arrange(date, time) %>% 
  mutate(
    arrival = row_number(),
    wday = wday(date, label = TRUE),
    hour = hour(time),
    between = time - lag(time)
  ) 
```


<div class="modal fade bs-example-modal-lg" id="cp0tWKBcres50CoJH8Qs" tabindex="-1" role="dialog" aria-labelledby="cp0tWKBcres50CoJH8Qs-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="cp0tWKBcres50CoJH8Qs-title">Solution</h4></div><div class="modal-body">

<p><code>arrival</code> = number of arrivals on the given day, <code>wday</code> = weekday, <code>hour</code> = hour considered, <code>between</code> = time between calls in secs (inter arrival times).</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#cp0tWKBcres50CoJH8Qs">Solution</button>
  (1) Explain the new columns.

The number of calls may follow a Poisson process with a fixed rate of calls per hour during the day. Let us try to plot the hourly rates:


```r
calls %>% 
  count(date, hour, wday) %>% 
  group_by(hour, wday) %>% 
  summarize(rate = mean(n)) %>% 
  ggplot(aes(x = hour, y = rate)) + 
  geom_line() + 
  facet_wrap(~wday) + 
  ylab("calls/hour")
```

<img src="TFA_files/figure-html/unnamed-chunk-526-1.png" width="672" style="display: block; margin: auto;" />


<div class="modal fade bs-example-modal-lg" id="oXknCHcEJAtm3cnTuR0l" tabindex="-1" role="dialog" aria-labelledby="oXknCHcEJAtm3cnTuR0l-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="oXknCHcEJAtm3cnTuR0l-title">Solution</h4></div><div class="modal-body">

<p>As can be seen the rate is not constaint over the day (we don&#39;t have a homogeneous Possion process). Moreover, in weekends the rate is much lower.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#oXknCHcEJAtm3cnTuR0l">Solution</button>
  (2) Is the rate constant during a day and is the rate the same for different weekdays (explain)?
  
Since the rate is not fixed we may have a non-homogeneous Poisson process where the rate change during the day. Hence let us try to consider an specific hour and test if the rate here can be considered as fixed (i.e. we have a Poisson process with a fixed rate when considering a specific hour) 


<div class="modal fade bs-example-modal-lg" id="jRMIXGOJk3pui8SHKARk" tabindex="-1" role="dialog" aria-labelledby="jRMIXGOJk3pui8SHKARk-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="jRMIXGOJk3pui8SHKARk-title">Solution</h4></div><div class="modal-body">

```r
library(fitdistrplus)
dat <- calls %>% 
  filter(
    wday == "Tue",
    hour == 10,
    !is.na(between)) %>% 
  pull(between) %>% 
  as.numeric() 
descdist(dat)
#> summary statistics
#> ------
#> min:  1   max:  98 
#> median:  6 
#> mean:  9.01 
#> estimated sd:  8.35 
#> estimated skewness:  1.95 
#> estimated kurtosis:  8.73
fit1 <- fitdist(dat, distr = "exp")
fit2 <- fitdist(dat, distr = "lnorm")
fit3 <- fitdist(dat, distr = "gamma")
summary(fit1)
#> Fitting of the distribution ' exp ' by maximum likelihood 
#> Parameters : 
#>      estimate Std. Error
#> rate    0.111    0.00077
#> Loglikelihood:  -66456   AIC:  132914   BIC:  132922
summary(fit2)
#> Fitting of the distribution ' lnorm ' by maximum likelihood 
#> Parameters : 
#>         estimate Std. Error
#> meanlog    1.779    0.00673
#> sdlog      0.971    0.00476
#> Loglikelihood:  -65826   AIC:  131657   BIC:  131673 
#> Correlation matrix:
#>           meanlog     sdlog
#> meanlog  1.00e+00 -1.17e-10
#> sdlog   -1.17e-10  1.00e+00
summary(fit3)
#> Fitting of the distribution ' gamma ' by maximum likelihood 
#> Parameters : 
#>       estimate Std. Error
#> shape    1.334    0.01180
#> rate     0.148    0.00158
#> Loglikelihood:  -65966   AIC:  131936   BIC:  131952 
#> Correlation matrix:
#>       shape  rate
#> shape 1.000 0.827
#> rate  0.827 1.000
par(mfrow = c(2, 2))  # 4 plots in one figure
pLegend <- c("exp", "lnorm", "gamma")
lst <- list(fit1, fit2, fit3)
denscomp(lst, legendtext = pLegend)
qqcomp(lst, legendtext = pLegend)
cdfcomp(lst, legendtext = pLegend)
ppcomp(lst, legendtext = pLegend)
```

<img src="TFA_files/figure-html/unnamed-chunk-528-1.png" width="672" style="display: block; margin: auto;" /><img src="TFA_files/figure-html/unnamed-chunk-528-2.png" width="672" style="display: block; margin: auto;" />
<p>For a Poisson process the inter arrival times should follow an exponential distribution. It seems to be a good fit here.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#jRMIXGOJk3pui8SHKARk">Solution</button>

<div class="modal fade bs-example-modal-lg" id="PdagCpiD9X4LbAeTqIlw" tabindex="-1" role="dialog" aria-labelledby="PdagCpiD9X4LbAeTqIlw-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="PdagCpiD9X4LbAeTqIlw-title">Hint</h4></div><div class="modal-body">

```r
library(fitdistrplus)
dat <- calls %>% 
  filter(
    wday == ___,
    hour == ___
    !is.na(between)) %>% 
  pull(between) %>% 
  as.numeric() %>% 
  print()
descdist(dat)
___ # try to fit the exp, lnorm and gamma
```


</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#PdagCpiD9X4LbAeTqIlw">Hint</button>
  (3) Consider Tuesdays from 10-11 and fit the inter arrival times (`between`). If the data follow a Poisson process then the distribution should be?




<div class="modal fade bs-example-modal-lg" id="aykyAm7F6kWmkronvWcB" tabindex="-1" role="dialog" aria-labelledby="aykyAm7F6kWmkronvWcB-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="aykyAm7F6kWmkronvWcB-title">Solution</h4></div><div class="modal-body">

```r
library(fitdistrplus)
dat <- calls %>% 
  filter(
    wday == "Tue",
    hour == 15,
    !is.na(between)) %>% 
  pull(between) %>% 
  as.numeric() 
descdist(dat)
#> summary statistics
#> ------
#> min:  1   max:  103 
#> median:  7 
#> mean:  9.99 
#> estimated sd:  9.41 
#> estimated skewness:  2.01 
#> estimated kurtosis:  9.13
fit12 <- fitdist(dat, distr = "exp")
fit22 <- fitdist(dat, distr = "lnorm")
fit32 <- fitdist(dat, distr = "gamma")
summary(fit12)
#> Fitting of the distribution ' exp ' by maximum likelihood 
#> Parameters : 
#>      estimate Std. Error
#> rate      0.1   0.000731
#> Loglikelihood:  -61883   AIC:  123768   BIC:  123776
summary(fit22)
#> Fitting of the distribution ' lnorm ' by maximum likelihood 
#> Parameters : 
#>         estimate Std. Error
#> meanlog    1.872    0.00719
#> sdlog      0.985    0.00509
#> Loglikelihood:  -61398   AIC:  122800   BIC:  122816 
#> Correlation matrix:
#>           meanlog     sdlog
#> meanlog  1.00e+00 -3.33e-11
#> sdlog   -3.33e-11  1.00e+00
summary(fit32)
#> Fitting of the distribution ' gamma ' by maximum likelihood 
#> Parameters : 
#>       estimate Std. Error
#> shape    1.305    0.01214
#> rate     0.131    0.00147
#> Loglikelihood:  -61501   AIC:  123007   BIC:  123022 
#> Correlation matrix:
#>       shape  rate
#> shape 1.000 0.824
#> rate  0.824 1.000
par(mfrow = c(2, 2))  # 4 plots in one figure
pLegend <- c("exp", "lnorm", "gamma")
lst <- list(fit12, fit22, fit32)
denscomp(lst, legendtext = pLegend)
qqcomp(lst, legendtext = pLegend)
cdfcomp(lst, legendtext = pLegend)
ppcomp(lst, legendtext = pLegend)
```

<img src="TFA_files/figure-html/unnamed-chunk-530-1.png" width="672" style="display: block; margin: auto;" /><img src="TFA_files/figure-html/unnamed-chunk-530-2.png" width="672" style="display: block; margin: auto;" />
</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#aykyAm7F6kWmkronvWcB">Solution</button>
  (4) Consider Tuesdays from 15-16 and fit the inter arrival times (`between`). 
  

<div class="modal fade bs-example-modal-lg" id="RrFpbATnNFFJ9NAxvSbQ" tabindex="-1" role="dialog" aria-labelledby="RrFpbATnNFFJ9NAxvSbQ-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="RrFpbATnNFFJ9NAxvSbQ-title">Solution</h4></div><div class="modal-body">

```r
fit1$estimate * 60 * 60 # 10-11
#> rate 
#>  400
fit12$estimate * 60 * 60 # 15-16
#> rate 
#>  360
```


<p>The rate is higher (40 calls more per hour) in period 10-11.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#RrFpbATnNFFJ9NAxvSbQ">Solution</button>

<div class="modal fade bs-example-modal-lg" id="Kf35Z6J2SbPjmWTlQiza" tabindex="-1" role="dialog" aria-labelledby="Kf35Z6J2SbPjmWTlQiza-title"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="Kf35Z6J2SbPjmWTlQiza-title">Hint</h4></div><div class="modal-body">

<p>You have to look at the estimates of the rate.</p>

</div><div class="modal-footer"><button class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><button class="btn btn-default btn-xs" style="float:right" data-toggle="modal" data-target="#Kf35Z6J2SbPjmWTlQiza">Hint</button>
  (5) What is the estimated arrival rate per hour Tuesday 12-13 and 15-16? Is the arrival rate the same?
  






















<!--chapter:end:15_r-dist-fit.Rmd-->

---
output: html_document
editor_options: 
  chunk_output_type: console
---


# Spatial data and maps {#mod-r-maps}

Spatial data, also known as geospatial data, is a term used to describe any data related to or containing information about a specific location on a surface (often a map). We will consider *distance matrix* calculations for finding the shortest distance/travel time between a set of origins and destinations, *geocoding* which is the process of converting an address to geographic coordinates (latitude, longitude) and *reverse geocoding* which is the opposite process of converting a location as described by geographic coordinates (latitude, longitude) to a human-readable address or place name. Finally, we consider how to display spatial data on a map.


## Learning outcomes {#lo-maps}

By the end of this module, you are expected to be able to:

* Calculate euclidean, manhattan, etc. distances.
* Calculate a distance matrix, i.e. shortest paths between places using the Google and Bing API.
* Geocode an address using the Google and Bing API.
* Add markers and routes (lines) on a map.


<!-- SOLO increasing: identify · memorise · name · do simple procedure · collect data · -->
<!-- enumerate · describe · interpret · formulate · list · paraphrase · combine · do -->
<!-- algorithms · compare · contrast · explain causes · analyse · relate · derive · -->
<!-- evaluate · apply · argue · theorise · generalise · hypothesise · solve · reflect -->


## Services for obtatining spatial data {#sec-map-api-key}

Often you need to connect to a service using an API for obtaining spatial data. The most common is Google and Bing (Microsoft) and to use the services you need an API key. Another service is also [Here](https://developer.here.com/).

If you use Google Maps you can obtain an API key [here](https://cloud.google.com/maps-platform/). Modest to light use is free; however, you need a valid credit card. Note you must enable the APIs you intend to use. Google in fact has several services for geo-related solutions. For example, the Maps Static API provides map images, while the Geocoding API provides geocoding and reverse geocoding services. You need to enable the APIs before you use them. You will only need to do that once, and then they will be ready for you to use. Enabling the APIs just means clicking a few radio buttons on the Google Maps Platform web interface.

We will be using the **ggmap** package for Google services. You can add the API key using:


```r
library(ggmap)
register_google(key = "[your key]", write = TRUE)
Sys.getenv("GGMAP_GOOGLE_API_KEY")
```

Note the key is stored in the environment object `GGMAP_GOOGLE_API_KEY`. Moreover, it is saved in the file `.Renviron` so that it is automatically reloaded when you restart R. 

If you use Bing Maps you can obtain an API key [here](https://www.bingmapsportal.com/). No credit card is needed. You can add the API key using:


```r
usethis::edit_r_environ()  # opens the .Renviron file
Sys.setenv(BING_MAPS_API_KEY=[your key]) # so you don't have to restart R
```

Add the line `BING_MAPS_API_KEY=[your key]` and save the file. 

Note your API keys is private and unique to you, so be careful not to share it online!


## Calculating distances

If you need to calculate euclidean, manhattan, etc. distances, you can use the `dist` R function:


```r
coord <- matrix(c(0,0, 0,1, 1,0, 1,1), ncol = 2, byrow = TRUE)
coord
#>      [,1] [,2]
#> [1,]    0    0
#> [2,]    0    1
#> [3,]    1    0
#> [4,]    1    1
dist(coord)
#>      1    2    3
#> 2 1.00          
#> 3 1.00 1.41     
#> 4 1.41 1.00 1.00
as.matrix(dist(coord))
#>      1    2    3    4
#> 1 0.00 1.00 1.00 1.41
#> 2 1.00 0.00 1.41 1.00
#> 3 1.00 1.41 0.00 1.00
#> 4 1.41 1.00 1.00 0.00
```

However, euclidean distances are often a poor approximation of shortest path lengths. 


### Using Google Maps

Remember to have [set your API key](#sec-map-api-key) and activate the *Distance Matrix API* service on the Google Cloud Platform. We consider the following places:


```r
library(ggmap)
library(tidyverse)
dat <- tibble::tribble(
      ~Id,              ~Shop,                                        ~Address,
       1L,    "Bilka Esbjerg",          "Stormgade 157, 6715 Esbjerg, Denmark",
       2L,    "Bilka Herning",              "Golfvej 5, 7400 Herning, Denmark",
       3L,   "Bilka Hillerød",     "Slotsarkaderne 26, 3400 Hillerød, Denmark",
       4L,   "Bilka Hjørring",  "A.F Heidemannsvej 20, 9800 Hjørring, Denmark",
       5L,  "Bilka Holstebro",         "Nyholmvej 20, 7500 Holstebro, Denmark",
      )
dat
#> # A tibble: 5 × 3
#>      Id Shop            Address                                     
#>   <int> <chr>           <chr>                                       
#> 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark        
#> 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark            
#> 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark   
#> 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark
#> 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark
```

To calculate a distance matrix we use the `mapdist` function:


```r
mapdist(from = "Stormgade 157, 6715 Esbjerg, Denmark", 
        to = "Golfvej 5, 7400 Herning, Denmark")
#> # A tibble: 1 × 9
#>   from                                 to                  m    km miles seconds minutes hours mode 
#>   <chr>                                <chr>           <int> <dbl> <dbl>   <int>   <dbl> <dbl> <chr>
#> 1 Stormgade 157, 6715 Esbjerg, Denmark Golfvej 5, 740… 87791  87.8  54.6    4353    72.6  1.21 driv…
```

Note Google returns results for the fastest path between the two points. Let us try to define a function which calculate all the distances:


```r
#' Calculate the distance matrix in long format.
#'
#' @param address A vector of addresses.
#' @param mode Driving, bicycling, walking, or transit.
#' @param symmetric Use symmetric distances (half the number of queries).
#' @return A data frame with the results
#' @note The API returns results for the fastest route.  
goo_calc_distances <- function(address, mode = "driving", symmetric = TRUE) {
   datDist <- expand_grid(id_from = 1:length(address), id_to = 1:length(address))
   datDist <- datDist %>% filter(id_from != id_to)
   if (symmetric) datDist <- datDist %>% filter(id_from < id_to)
   datDist <- datDist %>% mutate(from = address[id_from], to = address[id_to])
   res <- mapdist(from = datDist %>% pull(from), to = datDist %>% pull(to), mode = mode)
   return(left_join(datDist, res, by = c("from", "to")))
}
datDistGoo <- goo_calc_distances(dat$Address)
datDistGoo
#> # A tibble: 10 × 11
#>    id_from id_to from                           to         m    km miles seconds minutes hours mode 
#>      <int> <int> <chr>                          <chr>  <int> <dbl> <dbl>   <int>   <dbl> <dbl> <chr>
#>  1       1     2 Stormgade 157, 6715 Esbjerg, … Golf…  87791  87.8  54.6    4353    72.6 1.21  driv…
#>  2       1     3 Stormgade 157, 6715 Esbjerg, … Slot… 321854 322.  200.    11749   196.  3.26  driv…
#>  3       1     4 Stormgade 157, 6715 Esbjerg, … A.F … 322068 322.  200.    11241   187.  3.12  driv…
#>  4       1     5 Stormgade 157, 6715 Esbjerg, … Nyho… 103723 104.   64.5    5297    88.3 1.47  driv…
#>  5       2     3 Golfvej 5, 7400 Herning, Denm… Slot… 366484 366.  228.    17616   294.  4.89  driv…
#>  6       2     4 Golfvej 5, 7400 Herning, Denm… A.F … 374695 375.  233.    13695   228.  3.80  driv…
#>  7       2     5 Golfvej 5, 7400 Herning, Denm… Nyho… 333413 333.  207.    12124   202.  3.37  driv…
#>  8       3     4 Slotsarkaderne 26, 3400 Hille… A.F … 178198 178.  111.     7813   130.  2.17  driv…
#>  9       3     5 Slotsarkaderne 26, 3400 Hille… Nyho…  44030  44.0  27.4    1826    30.4 0.507 driv…
#> 10       4     5 A.F Heidemannsvej 20, 9800 Hj… Nyho… 181228 181.  113.     7795   130.  2.17  driv…
```

Note that only the calculated distances are returned. If you want to have the whole distance matrix we define function:


```r
#' Convert the data frame returned from calling a `___calc_distances` function to a distance matrix.
#'
#' @param dat The data frame returned from calling `___calc_distances`.
#' @param value_col The column containing the distances.
#' @return The distance matrix
as_dist_matrix <- function(dat, value_col) {
   lgt <- max(dat$id_from, dat$id_to)
   distanceMat<-matrix(NA, nrow=lgt, ncol = lgt)
   diag(distanceMat) <- 0
   map(1:nrow(dat), function(r) {
      distanceMat[dat$id_from[r], dat$id_to[r]] <<- dat[[value_col]][r]
   })
   idx <- which(is.na(distanceMat), arr.ind = TRUE)
   map(1:nrow(idx), function(r) {
      distanceMat[idx[r, "row"], idx[r, "col"]] <<- distanceMat[idx[r, "col"], idx[r, "row"]]
   })
   return(distanceMat)
}
as_dist_matrix(datDistGoo, "km")  # distances in km
#>       [,1]  [,2] [,3] [,4] [,5]
#> [1,]   0.0  87.8  322  322  104
#> [2,]  87.8   0.0  366  375  333
#> [3,] 321.9 366.5    0  178   44
#> [4,] 322.1 374.7  178    0  181
#> [5,] 103.7 333.4   44  181    0
as_dist_matrix(datDistGoo, "seconds")  # travel time in seconds 
#>       [,1]  [,2]  [,3]  [,4]  [,5]
#> [1,]     0  4353 11749 11241  5297
#> [2,]  4353     0 17616 13695 12124
#> [3,] 11749 17616     0  7813  1826
#> [4,] 11241 13695  7813     0  7795
#> [5,]  5297 12124  1826  7795     0
```


### Using Bing Maps

Remember to have [set your API key](#mod-map-api-key). We first define a `bing_mapdist` function:


```r
library(jsonlite)
#' Distance between two locations.
#'
#' @param from From address.
#' @param to To address.
#' @param mode Walking, driving or transit.
#' @param optimize Optimize either `distance` or `time`.
#' @return
bing_mapdist <- function(from, to, mode = "driving", optimize = "time") {
   if (is.data.frame(from)) {
     stopifnot(all(c("from", "to") %in% names(from)))
     from_to_df <- from %>% select("from", "to") %>% as_tibble()
   }
   else {
     from_to_df <- tibble(from = from, to = to)
   }
   dat <- map_dfr(1:nrow(from_to_df), function(r) {
      url <- 
         str_c("http://dev.virtualearth.net/REST/V1/Routes/", mode, "?wp.0=", from_to_df$from[r], "&wp.1=", from_to_df$to[r], 
               "&optimize=", optimize, "&ra=excludeItinerary&rpo=None&ig=false&du=km", 
               "&avoid=minimizeTolls&key=", Sys.getenv("BING_MAPS_API_KEY"))
      url <- URLencode(url)
      lst <- fromJSON(url)
      if (lst$statusCode != 200) return(tibble(km = NA, seconds = NA, mode = NA))
      df <- lst$resourceSets$resources[[1]]
      return(tibble(km = df$travelDistance, seconds = df$travelDuration, mode = df$travelMode))
   })
   return(bind_cols(from_to_df, dat))
}
bing_mapdist(from = "Stormgade 157, 6715 Esbjerg, Denmark", 
             to = "A.F Heidemannsvej 20, 9800 Hjørring, Denmark")
#> # A tibble: 1 × 5
#>   from                                 to                                           km seconds mode 
#>   <chr>                                <chr>                                     <dbl>   <int> <chr>
#> 1 Stormgade 157, 6715 Esbjerg, Denmark A.F Heidemannsvej 20, 9800 Hjørring, Den…  322.   10047 Driv…
bing_mapdist(from = "Stormgade 157, 6715 Esbjerg, Denmark", 
             to = "A.F Heidemannsvej 20, 9800 Hjørring, Denmark", 
             optimize = "distance")
#> # A tibble: 1 × 5
#>   from                                 to                                           km seconds mode 
#>   <chr>                                <chr>                                     <dbl>   <int> <chr>
#> 1 Stormgade 157, 6715 Esbjerg, Denmark A.F Heidemannsvej 20, 9800 Hjørring, Den…  257.   14157 Driv…
```

Note we here can get both the shortest and fastest path between two points. Next, we use the `bing_mapdist` function for calculating distances:


```r
#' Calculate the distance matrix in long format.
#'
#' @param address A vector of addresses.
#' @param symmetric Use symmetric distances (only half the number of queries).
#' @param ... Further parameters passed to `bing_mapdist`.
#' @return A data frame with the results
#' @note The API returns results for the fastest route.  
bing_calc_distances <- function(address, symmetric = TRUE, ...) {
   datDist <- expand_grid(id_from = 1:length(address), id_to = 1:length(address))
   datDist <- datDist %>% filter(id_from != id_to)
   if (symmetric) datDist <- datDist %>% filter(id_from < id_to)
   datDist <- datDist %>% mutate(from = address[id_from], to = address[id_to])
   res <- bing_mapdist(datDist %>% select(from, to), ...)
   return(bind_cols(datDist %>%  select(id_from, id_to), res))
}
datDistBing <- bing_calc_distances(dat$Address)
datDistBing
#> # A tibble: 10 × 7
#>    id_from id_to from                                         to                    km seconds mode 
#>      <int> <int> <chr>                                        <chr>              <dbl>   <int> <chr>
#>  1       1     2 Stormgade 157, 6715 Esbjerg, Denmark         Golfvej 5, 7400 H…  87.8    4684 Driv…
#>  2       1     3 Stormgade 157, 6715 Esbjerg, Denmark         Slotsarkaderne 26… 322.    10601 Driv…
#>  3       1     4 Stormgade 157, 6715 Esbjerg, Denmark         A.F Heidemannsvej… 322.     9973 Driv…
#>  4       1     5 Stormgade 157, 6715 Esbjerg, Denmark         Nyholmvej 20, 750… 123.     5883 Driv…
#>  5       2     3 Golfvej 5, 7400 Herning, Denmark             Slotsarkaderne 26… 334.    10750 Driv…
#>  6       2     4 Golfvej 5, 7400 Herning, Denmark             A.F Heidemannsvej… 187.     7967 Driv…
#>  7       2     5 Golfvej 5, 7400 Herning, Denmark             Nyholmvej 20, 750…  44.2    1749 Driv…
#>  8       3     4 Slotsarkaderne 26, 3400 Hillerød, Denmark    A.F Heidemannsvej… 397.    17257 Driv…
#>  9       3     5 Slotsarkaderne 26, 3400 Hillerød, Denmark    Nyholmvej 20, 750… 375.    12184 Driv…
#> 10       4     5 A.F Heidemannsvej 20, 9800 Hjørring, Denmark Nyholmvej 20, 750… 194.     8269 Driv…
```

Note in general results from the API services are based on a set of assumptions and hence the results from different services may not be the same. You may use the different services to check if the distances are correct, by checking the results from different services:


```r
# Difference in minutes
abs(as_dist_matrix(datDistGoo, "seconds") - as_dist_matrix(datDistBing, "seconds"))/60
#>       [,1]   [,2]  [,3]  [,4]   [,5]
#> [1,]  0.00   5.52  19.1  21.1   9.77
#> [2,]  5.52   0.00 114.4  95.5 172.92
#> [3,] 19.13 114.43   0.0 157.4 172.63
#> [4,] 21.13  95.47 157.4   0.0   7.90
#> [5,]  9.77 172.92 172.6   7.9   0.00
# Km from 1 to 3
mapdist(from = "Stormgade 157, 6715 Esbjerg, Denmark", 
        to = "Slotsarkaderne 26, 3400 Hillerød, Denmark")
#> # A tibble: 1 × 9
#>   from                                 to                  m    km miles seconds minutes hours mode 
#>   <chr>                                <chr>           <int> <dbl> <dbl>   <int>   <dbl> <dbl> <chr>
#> 1 Stormgade 157, 6715 Esbjerg, Denmark Slotsarkadern… 321854  322.  200.   11749    196.  3.26 driv…
bing_mapdist(from = "Stormgade 157, 6715 Esbjerg, Denmark", 
        to = "Slotsarkaderne 26, 3400 Hillerød, Denmark")
#> # A tibble: 1 × 5
#>   from                                 to                                           km seconds mode 
#>   <chr>                                <chr>                                     <dbl>   <int> <chr>
#> 1 Stormgade 157, 6715 Esbjerg, Denmark Slotsarkaderne 26, 3400 Hillerød, Denmark  322.   10601 Driv…
```


## Geocoding and reverse geocoding

### Using Google maps

Remember to enable the *Geocoding API*. To get the coordinates of an address we use the `geocode` function:


```r
geocode("Stormgade 157, 6715 Esbjerg, Denmark")
#> # A tibble: 1 × 2
#>     lon   lat
#>   <dbl> <dbl>
#> 1  8.46  55.5
```

We may use `mutate_geocode` to add the coordinates to a dataset:


```r
dat <- dat %>% 
  mutate_geocode(Address)
dat
#> # A tibble: 5 × 5
#>      Id Shop            Address                                        lon   lat
#>   <int> <chr>           <chr>                                        <dbl> <dbl>
#> 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark          8.46  55.5
#> 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark              9.00  56.1
#> 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark    12.3   55.9
#> 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark 10.0   57.4
#> 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark         8.62  56.4
```

To reverse geocode use the `revgeocode` function:


```r
revgeocode(c(dat$lon[1], dat$lat[1]))
#> [1] "Stormgade 157, 6715 Esbjerg Kommune, Denmark"
```

To apply it to the dataset use:


```r
dat <- dat %>% 
   mutate(AddressGeoGoo = 
             map_chr(1:n(), function(i) {
               revgeocode(c(lon = lon[i], lat = lat[i]))
             }))
dat
#> # A tibble: 5 × 6
#>      Id Shop            Address                                        lon   lat AddressGeoGoo      
#>   <int> <chr>           <chr>                                        <dbl> <dbl> <chr>              
#> 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark          8.46  55.5 Stormgade 157, 671…
#> 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark              9.00  56.1 Golfvej 5, 7400 He…
#> 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark    12.3   55.9 Slotsarkaderne 26,…
#> 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark 10.0   57.4 A F Heidemanns Vej…
#> 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark         8.62  56.4 Nyholmvej 20, 7500…
```


### Use Bing Maps

To get the coordinates of an address we define the `bing_geocode` function:


```r
#' Geocode addresses
#'
#' @param address Address(es) to geocode.
#' @return The coordinates as a data frame.
bing_geocode <- function(address) {
   dat <- map_dfr(address, function(s) {
      url <- str_c("http://dev.virtualearth.net/REST/v1/Locations?q=", 
                   s, "&key=", Sys.getenv("BING_MAPS_API_KEY"))
      url <- URLencode(url)
      lst <- fromJSON(url)
      if (lst$statusCode != 200) return(tibble(lon = NA, lat = NA))
      v <- lst$resourceSets$resources[[1]]$point$coordinates[[1]]
      if (is.null(v)) return(tibble(lon = NA, lat = NA))
      return(tibble(lon = v[2], lat = v[1]))
   })
   return(dat)
}
bing_geocode("A.F. Heidemannsvej 20, 9800 Hjørring, Denmark")
#> # A tibble: 1 × 2
#>     lon   lat
#>   <dbl> <dbl>
#> 1  10.0  57.4
bing_geocode(dat$Address)
#> # A tibble: 5 × 2
#>     lon   lat
#>   <dbl> <dbl>
#> 1  8.46  55.5
#> 2  9.00  56.1
#> 3 12.3   55.9
#> 4 10.0   57.4
#> 5  8.62  56.4
```

We may use `bing_mutate_geocode` to add the coordinates to a dataset:


```r
dat <- dat %>% select(-lat, -lon)
mutate_bing_geocode <- function (data, address, ...) {
    adr <- data[[deparse(substitute(Address))]]
    gcdf <- bing_geocode(adr)
    bind_cols(data, gcdf)
}

dat <- dat %>% 
  mutate_bing_geocode(Address)
dat
#> # A tibble: 5 × 6
#>      Id Shop            Address                                      AddressGeoGoo         lon   lat
#>   <int> <chr>           <chr>                                        <chr>               <dbl> <dbl>
#> 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark         Stormgade 157, 671…  8.46  55.5
#> 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark             Golfvej 5, 7400 He…  9.00  56.1
#> 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark    Slotsarkaderne 26,… 12.3   55.9
#> 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark A F Heidemanns Vej… 10.0   57.4
#> 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark        Nyholmvej 20, 7500…  8.62  56.4
```

To reverse geocode use the `bing_revgeocode` function:


```r
#' Reverse geocode coordinates
#'
#' @param coordinates A vector with two elements (lon, lat).
#' @return The address as a data frame.
bing_revgeocode <- function(coordinates) {
   url <- str_c("http://dev.virtualearth.net/REST/v1/Locations/", 
                coordinates[2], ",", coordinates[1],
                "?key=", Sys.getenv("BING_MAPS_API_KEY"))
   url <- URLencode(url)
   lst <- fromJSON(url)
   if (lst$statusCode != 200) return(NA)
   v <- lst$resourceSets$resources[[1]]$address$formattedAddress
   if (is.null(v)) return(NA)
   return(v)
}
bing_revgeocode(c(dat$lon[1], dat$lat[1]))
#> [1] "Stormgade 157, 6715 Esbjerg, Denmark"
```

To apply it to the dataset use:


```r
dat <- dat %>% 
   mutate(AddressGeoBing = 
             map_chr(1:n(), function(i) {
               bing_revgeocode(c(lon = lon[i], lat = lat[i]))
             }))
dat 
#> # A tibble: 5 × 7
#>      Id Shop            Address                                      AddressGe…¹   lon   lat Addre…²
#>   <int> <chr>           <chr>                                        <chr>       <dbl> <dbl> <chr>  
#> 1     1 Bilka Esbjerg   Stormgade 157, 6715 Esbjerg, Denmark         Stormgade …  8.46  55.5 Stormg…
#> 2     2 Bilka Herning   Golfvej 5, 7400 Herning, Denmark             Golfvej 5,…  9.00  56.1 Golfve…
#> 3     3 Bilka Hillerød  Slotsarkaderne 26, 3400 Hillerød, Denmark    Slotsarkad… 12.3   55.9 Slotsa…
#> 4     4 Bilka Hjørring  A.F Heidemannsvej 20, 9800 Hjørring, Denmark A F Heidem… 10.0   57.4 A.F. H…
#> 5     5 Bilka Holstebro Nyholmvej 20, 7500 Holstebro, Denmark        Nyholmvej …  8.62  56.4 Nyholm…
#> # … with abbreviated variable names ¹​AddressGeoGoo, ²​AddressGeoBing
```


## Adding markers and routes to a map

[Leaflet](http://leafletjs.com) is an open-source JavaScript library for interactive maps. It’s used by websites ranging from The New York Times and The Washington Post to GitHub and Flickr, as well as GIS specialists like OpenStreetMap, Mapbox, and CartoDB. The [leaflet](https://rstudio.github.io/leaflet/) package makes it easy to create Leaflet maps from R.

Note Leaflet is open-source and free so you do not need an API key for making maps. If you would like to use Google maps instead then have a look at the [googleway](http://symbolixau.github.io/googleway/) package instead. 

First let us create a map with two base layers


```r
library(leaflet)
library(htmlwidgets)
m <- leaflet() %>% 
   # Base maps
   addTiles(group = "Map") %>%
   addProviderTiles('Esri.WorldImagery', group = "Satelite") %>% 
   addProviderTiles("CartoDB.PositronOnlyLabels", group = "Map") %>% 
   # Center and zoom
   setView(10.2, 56.2,  zoom = 7) %>% 
   # Layer control
   addLayersControl(
    baseGroups = c("Map", "Satelite"),
    options = layersControlOptions(collapsed = TRUE)
   ) 
 m
```

```{=html}
<div id="htmlwidget-272296ca441265f240e0" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-272296ca441265f240e0">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]}],"setView":[[56.2,10.2],7,[]]},"evals":[],"jsHooks":[]}</script>
```

Next, let us add the places:


```r
dat <- tibble::tribble(
      ~Id,              ~Shop,                                        ~Address,
       1L,    "Bilka Esbjerg",          "Stormgade 157, 6715 Esbjerg, Denmark",
       2L,    "Bilka Herning",              "Golfvej 5, 7400 Herning, Denmark",
       3L,   "Bilka Hillerød",     "Slotsarkaderne 26, 3400 Hillerød, Denmark",
       4L,   "Bilka Hjørring",  "A.F Heidemannsvej 20, 9800 Hjørring, Denmark",
       5L,  "Bilka Holstebro",         "Nyholmvej 20, 7500 Holstebro, Denmark",
      )
dat <- dat %>% mutate_geocode(Address)
m <- m %>% 
   addMarkers(~lon, ~lat, popup = ~Address, label = ~str_c(Id, "  - ", Shop), data = dat)
m
```

```{=html}
<div id="htmlwidget-96bd4e00ccacba70bb8b" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-96bd4e00ccacba70bb8b">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.2977779,10.0034953,8.6222409],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.2977779]}},"evals":[],"jsHooks":[]}</script>
```

To add a line between a set of points use the `addPolylines` function:


```r
routeIds <- c(2, 5, 1, 2)
route <- dat[routeIds,] 
m %>% addPolylines(lng = ~lon, lat = ~lat, data = route, weight = 2, label = "Route 1")
```

```{=html}
<div id="htmlwidget-7b68150a33e268f98109" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-7b68150a33e268f98109">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.2977779,10.0034953,8.6222409],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,8.6222409,8.4559613,9.0047956],"lat":[56.1357775,56.3779116,55.5107577,56.1357775]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":2,"opacity":0.5,"fill":false,"fillColor":"#03F","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Route 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.2977779]}},"evals":[],"jsHooks":[]}</script>
```

A more advanced setup is to use the `addFlows` function from the [leaflet.minicharts](https://github.com/rte-antares-rpackage/leaflet.minicharts) package. First let us define some lines:


```r
datLines <- tibble(FromId = c(2, 5, 1, 2, 4, 3), ToId = c(5, 1, 2, 4, 3, 2))
datLines <- left_join(datLines, dat %>% select(-Shop, -Address), by = c("FromId" = "Id")) %>% 
   rename("FromLat" = "lat", "FromLon" = "lon") %>% 
   left_join(dat %>% select(-Shop, -Address), by = c("ToId" = "Id")) %>% 
   rename("ToLat" = "lat", "ToLon" = "lon")
datLines
#> # A tibble: 6 × 6
#>   FromId  ToId FromLon FromLat ToLon ToLat
#>    <dbl> <dbl>   <dbl>   <dbl> <dbl> <dbl>
#> 1      2     5    9.00    56.1  8.62  56.4
#> 2      5     1    8.62    56.4  8.46  55.5
#> 3      1     2    8.46    55.5  9.00  56.1
#> 4      2     4    9.00    56.1 10.0   57.4
#> 5      4     3   10.0     57.4 12.3   55.9
#> 6      3     2   12.3     55.9  9.00  56.1
```

Note we have a from/to pair in each row. We add the lines to the map:


```r
library(leaflet.minicharts)
m %>% addFlows(datLines$FromLon, datLines$FromLat, datLines$ToLon, datLines$ToLat,
               flow = 1, maxFlow = 20, opacity = 0.5, popup = popupArgs(noPopup = TRUE))
```

```{=html}
<div id="htmlwidget-6b58d1f69483c15f3952" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-6b58d1f69483c15f3952">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.2977779,10.0034953,8.6222409],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addFlows","args":[[{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (10.0034953,57.4440055) -> (12.2977779,55.9290561)","lat0":57.4440055,"lat1":55.9290561,"lng0":10.0034953,"lng1":12.2977779},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (12.2977779,55.9290561) -> (9.0047956,56.1357775)","lat0":55.9290561,"lat1":56.1357775,"lng0":12.2977779,"lng1":9.0047956},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (8.4559613,55.5107577) -> (9.0047956,56.1357775)","lat0":55.5107577,"lat1":56.1357775,"lng0":8.4559613,"lng1":9.0047956},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (8.6222409,56.3779116) -> (8.4559613,55.5107577)","lat0":56.3779116,"lat1":55.5107577,"lng0":8.6222409,"lng1":8.4559613},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (10.0034953,57.4440055)","lat0":56.1357775,"lat1":57.4440055,"lng0":9.0047956,"lng1":10.0034953},"timeSteps":1},{"dyn":{},"static":{"color":"blue","value":1,"maxValue":20,"minThickness":1,"maxThickness":20,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (8.6222409,56.3779116)","lat0":56.1357775,"lat1":56.3779116,"lng0":9.0047956,"lng1":8.6222409},"timeSteps":1}],["1"],null,{"showTitle":true,"showValues":true,"labels":[],"supValues":null,"supLabels":[],"html":null,"noPopup":true,"digits":null},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.2977779]}},"evals":[],"jsHooks":[]}</script>
```

Let us define a function for adding routes:


```r
add_route <- function(dat = NULL, route, solution = 1) {
   route_id = if_else(is.null(dat), 1, max(dat$RouteId) + 1)
   tmp <- tibble(From = route[1:(length(route)-1)], To = route[2:length(route)])
   tmp <- tmp %>% mutate(Sol = solution, RouteId = route_id)
   dat <- bind_rows(dat, tmp)
}

datLines <- add_route(route = c(2, 5, 1, 2)) %>% 
   add_route(route = c(2, 4, 3, 2)) %>% 
   add_route(route = c(2, 3, 1, 2), solution = 2) %>% 
   add_route(route = c(2, 5, 4, 2), solution = 2)
datLines <- left_join(datLines, dat %>% select(-Shop, -Address), by = c("From" = "Id")) %>% 
   rename("FromLat" = "lat", "FromLon" = "lon") %>% 
   left_join(dat %>% select(-Shop, -Address), by = c("To" = "Id")) %>% 
   rename("ToLat" = "lat", "ToLon" = "lon") %>% 
   mutate(group = str_c("Solution ", Sol))
datLines
#> # A tibble: 12 × 9
#>     From    To   Sol RouteId FromLon FromLat ToLon ToLat group     
#>    <dbl> <dbl> <dbl>   <dbl>   <dbl>   <dbl> <dbl> <dbl> <chr>     
#>  1     2     5     1       1    9.00    56.1  8.62  56.4 Solution 1
#>  2     5     1     1       1    8.62    56.4  8.46  55.5 Solution 1
#>  3     1     2     1       1    8.46    55.5  9.00  56.1 Solution 1
#>  4     2     4     1       2    9.00    56.1 10.0   57.4 Solution 1
#>  5     4     3     1       2   10.0     57.4 12.3   55.9 Solution 1
#>  6     3     2     1       2   12.3     55.9  9.00  56.1 Solution 1
#>  7     2     3     2       3    9.00    56.1 12.3   55.9 Solution 2
#>  8     3     1     2       3   12.3     55.9  8.46  55.5 Solution 2
#>  9     1     2     2       3    8.46    55.5  9.00  56.1 Solution 2
#> 10     2     5     2       4    9.00    56.1  8.62  56.4 Solution 2
#> 11     5     4     2       4    8.62    56.4 10.0   57.4 Solution 2
#> 12     4     2     2       4   10.0     57.4  9.00  56.1 Solution 2
```

A map with Solution 1:


```r
col_pal <- rainbow(max(datLines$RouteId))
datP <- datLines %>% filter(Sol == 1)
m %>% addFlows(datP$FromLon, datP$FromLat, datP$ToLon, datP$ToLat,
               flow = datP$RouteId, maxThickness = 2, color = col_pal[datP$RouteId],
               opacity = 0.5, popup = popupArgs(labels = "Route"))
```

```{=html}
<div id="htmlwidget-407fe790eb090fd934c3" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-407fe790eb090fd934c3">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.2977779,10.0034953,8.6222409],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addFlows","args":[[{"dyn":{"color":["#80FF00"],"value":[2]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (10.0034953,57.4440055) -> (12.2977779,55.9290561)","lat0":57.4440055,"lat1":55.9290561,"lng0":10.0034953,"lng1":12.2977779},"timeSteps":1},{"dyn":{"color":["#80FF00"],"value":[2]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (12.2977779,55.9290561) -> (9.0047956,56.1357775)","lat0":55.9290561,"lat1":56.1357775,"lng0":12.2977779,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#FF0000"],"value":[1]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.4559613,55.5107577) -> (9.0047956,56.1357775)","lat0":55.5107577,"lat1":56.1357775,"lng0":8.4559613,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#FF0000"],"value":[1]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.6222409,56.3779116) -> (8.4559613,55.5107577)","lat0":56.3779116,"lat1":55.5107577,"lng0":8.6222409,"lng1":8.4559613},"timeSteps":1},{"dyn":{"color":["#80FF00"],"value":[2]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (10.0034953,57.4440055)","lat0":56.1357775,"lat1":57.4440055,"lng0":9.0047956,"lng1":10.0034953},"timeSteps":1},{"dyn":{"color":["#FF0000"],"value":[1]},"static":{"maxValue":2,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (8.6222409,56.3779116)","lat0":56.1357775,"lat1":56.3779116,"lng0":9.0047956,"lng1":8.6222409},"timeSteps":1}],["1"],null,{"showTitle":true,"showValues":true,"labels":["Route"],"supValues":null,"supLabels":[],"html":null,"noPopup":false,"digits":null},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.2977779]}},"evals":[],"jsHooks":[]}</script>
```

A map with Solution 2:


```r
col_pal <- rainbow(max(datLines$RouteId))
datP <- datLines %>% filter(Sol == 2)
m %>% addFlows(datP$FromLon, datP$FromLat, datP$ToLon, datP$ToLat,
               flow = datP$RouteId, maxThickness = 2, color = col_pal[datP$RouteId],
               opacity = 0.5, popup = popupArgs(labels = "Route"))
```

```{=html}
<div id="htmlwidget-c43e838d4e59c04876a6" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-c43e838d4e59c04876a6">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.2977779,10.0034953,8.6222409],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addFlows","args":[[{"dyn":{"color":["#8000FF"],"value":[4]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (10.0034953,57.4440055) -> (9.0047956,56.1357775)","lat0":57.4440055,"lat1":56.1357775,"lng0":10.0034953,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#00FFFF"],"value":[3]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (12.2977779,55.9290561) -> (8.4559613,55.5107577)","lat0":55.9290561,"lat1":55.5107577,"lng0":12.2977779,"lng1":8.4559613},"timeSteps":1},{"dyn":{"color":["#00FFFF"],"value":[3]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.4559613,55.5107577) -> (9.0047956,56.1357775)","lat0":55.5107577,"lat1":56.1357775,"lng0":8.4559613,"lng1":9.0047956},"timeSteps":1},{"dyn":{"color":["#8000FF"],"value":[4]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (8.6222409,56.3779116) -> (10.0034953,57.4440055)","lat0":56.3779116,"lat1":57.4440055,"lng0":8.6222409,"lng1":10.0034953},"timeSteps":1},{"dyn":{"color":["#00FFFF"],"value":[3]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (12.2977779,55.9290561)","lat0":56.1357775,"lat1":55.9290561,"lng0":9.0047956,"lng1":12.2977779},"timeSteps":1},{"dyn":{"color":["#8000FF"],"value":[4]},"static":{"maxValue":4,"minThickness":1,"maxThickness":2,"opacity":0.5,"layerId":"_flow (9.0047956,56.1357775) -> (8.6222409,56.3779116)","lat0":56.1357775,"lat1":56.3779116,"lng0":9.0047956,"lng1":8.6222409},"timeSteps":1}],["1"],null,{"showTitle":true,"showValues":true,"labels":["Route"],"supValues":null,"supLabels":[],"html":null,"noPopup":false,"digits":null},null]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.2977779]}},"evals":[],"jsHooks":[]}</script>
```

An interactive map with both solutions:


```r
mm <- m
res <- map(1:nrow(datLines), function(i) {
   tmp <- tibble(lat = c(datLines$FromLat[i], datLines$ToLat[i]), lon = c(datLines$FromLon[i], datLines$ToLon[i]))
   mm <<- mm %>% addPolylines(lng = ~lon, lat = ~lat, 
                              color = col_pal[datLines$Sol[i]], group = datLines$group[i],
                              data = tmp, weight = 2, label = datLines$group[i])
   return(invisible(NULL))
})
mm <- mm %>% 
  # Layer control
  addLayersControl(
    baseGroups = c("Map", "Satelite"),
    overlayGroups = unique(datLines$group),
    options = layersControlOptions(collapsed = FALSE)
  ) %>% 
  hideGroup(unique(datLines$group)) %>% 
  showGroup("Solution 1")
mm
```

```{=html}
<div id="htmlwidget-d29707f608a20cbb2d8c" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-d29707f608a20cbb2d8c">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,"Map",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",null,"Satelite",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.PositronOnlyLabels",null,"Map",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addLayersControl","args":[["Map","Satelite"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addMarkers","args":[[55.5107577,56.1357775,55.9290561,57.4440055,56.3779116],[8.4559613,9.0047956,12.2977779,10.0034953,8.6222409],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Stormgade 157, 6715 Esbjerg, Denmark","Golfvej 5, 7400 Herning, Denmark","Slotsarkaderne 26, 3400 Hillerød, Denmark","A.F Heidemannsvej 20, 9800 Hjørring, Denmark","Nyholmvej 20, 7500 Holstebro, Denmark"],null,null,null,["1  - Bilka Esbjerg","2  - Bilka Herning","3  - Bilka Hillerød","4  - Bilka Hjørring","5  - Bilka Holstebro"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,8.6222409],"lat":[56.1357775,56.3779116]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.6222409,8.4559613],"lat":[56.3779116,55.5107577]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.4559613,9.0047956],"lat":[55.5107577,56.1357775]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,10.0034953],"lat":[56.1357775,57.4440055]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[10.0034953,12.2977779],"lat":[57.4440055,55.9290561]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[12.2977779,9.0047956],"lat":[55.9290561,56.1357775]}]]],null,"Solution 1",{"interactive":true,"className":"","stroke":true,"color":"#FF0000","weight":2,"opacity":0.5,"fill":false,"fillColor":"#FF0000","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,12.2977779],"lat":[56.1357775,55.9290561]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[12.2977779,8.4559613],"lat":[55.9290561,55.5107577]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.4559613,9.0047956],"lat":[55.5107577,56.1357775]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[9.0047956,8.6222409],"lat":[56.1357775,56.3779116]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[8.6222409,10.0034953],"lat":[56.3779116,57.4440055]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[10.0034953,9.0047956],"lat":[57.4440055,56.1357775]}]]],null,"Solution 2",{"interactive":true,"className":"","stroke":true,"color":"#80FF00","weight":2,"opacity":0.5,"fill":false,"fillColor":"#80FF00","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"Solution 2",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[["Map","Satelite"],["Solution 1","Solution 2"],{"collapsed":false,"autoZIndex":true,"position":"topright"}]},{"method":"hideGroup","args":[["Solution 1","Solution 2"]]},{"method":"showGroup","args":["Solution 1"]}],"setView":[[56.2,10.2],7,[]],"limits":{"lat":[55.5107577,57.4440055],"lng":[8.4559613,12.2977779]}},"evals":[],"jsHooks":[]}</script>
```

Note unfortunately arrows cannot be shown in this case.








<!--chapter:end:16_r-maps.Rmd-->

---
output: html_document
editor_options: 
  chunk_output_type: console
---




# (APPENDIX) Appendix {-} 

# Working in groups {#groups}

During the course you have been allocated into groups. You are expected to solve the exercises and write the project reports in these groups. Before you start, it is a good idea to agree on a set of group rules. First, agree on a [coding convention](#coding-convention). Most people in the R community use snake case but camel case is also okay. Next, setup rules on when to meet and how you will organize the work. For instance, it is a good idea that all try to solve some of the exercises before you meet and you then discuss the answers, problems etc. Finally, it is a good idea to have a common place for your code. You have different options:

1) Use a cloud storage services such as Dropbox, OneDrive or Google Drive.
2) Use a version control system such as Git together with [GitHub]. GitHub is a code sharing and publishing service and may be seen as a social networking site for programmers. 
3) If you use RStudio Cloud then one person in the group can create a shared workspace with projects: 
   - First create a new workspace named e.g. _Shared_. 
   - Press _Members_ and add the group members as moderators.
   - Now go back to _Projects_ in the _Tools for Analytics_ workspace and move one project to the shared workspace. Rename it to e.g. _Group Project_. 
   Members will now have access to this project where you can share code. NOTE you can not work collectively on a file simultaneously. That is, only one member can change a file at a time! Hence it is a good idea to have your own private project to work on and use this project as a place where you can share code. If you want to download a project to your laptop then press the export button. 

The benefit of a cloud storage service is that it is well known to you and easy to setup. Cons are that you cannot work on the same file simultaneously. The benefit of Git and GitHub is that it manages the evolution of a set of files – called a repository – in a sane, highly structured way. If you have no idea what I'm talking about, think of it as the "Track Changes" features from Microsoft Word on steroids. Here you can work on files simultaneously. Moreover, it can be used from within RStudio. Cons are that it is harder to setup and learn. For a detailed description see [Why Git? Why GitHub?][hg-why].

I recommend that you use Git and GitHub. However, if you find the learning curve to high just use a cloud storage service. The [Using Git together with GitHub](#using-git) section gives a tutorial on how to setup Git and GitHub. Skip it if you use a cloud storage service.

## Joint R project structure {-}

I suggest to have an R project with subfolders `joint`, `[student1 name]`, `[student2 name]`, ..., `[student5 name]`. Student folders contain files only a single student work on (good when you do some exercises before class). Folder `joint` contains joint work. That could for instance be a joint answer of an exercise (based on the work you did in the student folders) and a sub-folder with the project report.  


## Using Git together with GitHub {- #using-git}

<!-- Source: https://happygitwithr.com/big-picture.html -->

Git is a version control system. Git manages the evolution of a set of files – called a repository – in a sane, highly structured way. If you have no idea what I'm talking about, think of it as the "Track Changes" features from Microsoft Word on steroids. 

GitHub provide a home for your Git-based projects on the internet. If you have no idea what I'm talking about, think of it as DropBox but much, much better. It allows other people to see your stuff, sync up with you, and perhaps even make changes. Even for private solo projects, it's a good idea to push your work to a remote location for peace of mind.

To configure your computer go though the following steps:

### Register a free GitHub account {-}

Sign-up at [GitHub]. Some thoughts about your username:

  * Incorporate your actual name! People like to know who they're dealing with. Also makes your username easier for people to guess or remember.
  * Reuse your username from other contexts, e.g., Twitter or Slack. But, of course, someone with no GitHub activity will probably be squatting on that.
  * Pick a username you will be comfortable revealing to your future boss.
  * Shorter is better than longer.
  * Be as unique as possible in as few characters as possible. In some settings GitHub auto-completes or suggests usernames.
  * Make it timeless. Don't highlight your current university, employer, or place of residence, e.g. JennyFromTheBlock.
  * Avoid the use of upper vs. lower case to separate words. We highly recommend all lowercase. GitHub treats usernames in a case insensitive way, but using all lowercase is kinder to people doing downstream regular expression work with usernames, in various languages. A better strategy for word separation is to use a hyphen `-` or underscore `_`.


### Install Git {-}  

Find installation instructions below for your operating system.

#### Windows  {- #install-git-windows}

[Install Git from the web][git-install]. Windows prefers for Git to be installed below `C:/Program Files` and this appears to be the default. This implies, for example, that the Git executable on my Windows system is found at `C:/Program Files/Git/bin/git.exe`. Unless you have specific reasons to otherwise, follow this convention. If asked about "Adjusting your PATH environment", make sure to select "Git from the command line and also from 3rd-party software".

#### macOS {-}

**Option 1** (*highly recommended*): Install the Xcode command line tools (**not all of Xcode**), which includes Git.

Go to the shell and enter one of these commands to elicit an offer to install developer command line tools:

``` bash
git --version
git config
```

Accept the offer! Click on "Install".

Here's another way to request this installation, more directly:

``` bash
xcode-select --install
```

We just happen to find this Git-based trigger apropos.

Note also that, after upgrading macOS, you might need to re-do the above and/or re-agree to the Xcode license agreement. We have seen this cause the RStudio Git pane to disappear on a system where it was previously working. Use commands like those above to tickle Xcode into prompting you for what it needs, then restart RStudio.

**Option 2** (*recommended*): Install Git from here: <http://git-scm.com/downloads>.

  * This arguably sets you up the best for the future. It will certainly get you the latest version of Git of all approaches described here.
  * The GitHub home for the macOS installer is here: <https://github.com/timcharper/git_osx_installer>.
    - At that link, you can find more info if something goes wrong or you are working on an old version of macOS.

**Option 3** (*recommended*): If you anticipate getting heavily into scientific computing, you're going to be installing and updating lots of software. You should check out [Homebrew](http://brew.sh), "the missing package manager for OS X". Among many other things, it can install Git for you. Once you have Homebrew installed, do this in the shell:

```
brew install git
```


#### Linux {-}

Install Git via your distro's package manager.

Ubuntu or Debian Linux:

```sh
sudo apt-get install git
```

Fedora or RedHat Linux:

```sh
sudo yum install git
```

A comprehensive list for various Linux and Unix package managers: <https://git-scm.com/download/linux>


### Check your installation {-}

Quit and re-launch RStudio if there's __any doubt in your mind__ about whether you opened RStudio before or after installing Git. 

<!-- Open the shell. An easy way to get into a shell from RStudio is *Tools > Terminal* or *Tools > Shell*. First setup your credentials. In the shell write: -->

<!-- ``` bash -->
<!-- git config --global user.name 'Jane Doe' -->
<!-- git config --global user.email 'jane@example.com' -->
<!-- git config --global --list -->
<!-- ``` -->

<!-- substituting your name and **the email associated with your GitHub account**. -->

You can set your Git user name and email from within R using the [usethis package](https://usethis.r-lib.org):


```r
## install if needed (do this exactly once):
## install.packages("usethis")

library(usethis)
use_git_config(user.name = "Jane Doe", user.email = "jane@example.org")
```

What user name should you give to Git? This does not have to be your GitHub user name, although it can be. Another good option is your actual first name and last name. If you commit from different machines, sometimes people work that info into the user name. Your commits will be labelled with this user name, so make it informative to potential collaborators and future you.

What email should you give to Git? This __must__ be the email associated with your GitHub account.

These commands return nothing. You can check that Git understood what you typed by looking at the output of `git config --global --list` from a shell.  An easy way to get into a shell from RStudio is **Tools > Terminal* or *Tools > Shell**. If you have any problems go though Chapters 4-14 on the [Happy Git site][happy-git].

<!-- If you want RStudio to help with your Git and GitHub work, it must be able to find the Git executable. Let's check if RStudio can find the Git executable: -->

<!-- * Quit and re-launch RStudio if there's __any doubt in your mind__ about whether you opened RStudio before or after installing Git.  -->
<!-- * From RStudio, go to *Tools > Global Options > Git/SVN* and make sure that the box *Git executable* points to your Git executable. -->

<!-- On macOS and Linux, the path usually looks something like this: -->

<!-- ``` bash -->
<!-- /usr/bin/git -->
<!-- ``` -->

<!-- If you need to set this on macOS, it can sometimes be hard to navigate to the necessary directory, once you've clicked "Browse" and are working with a Finder-type window. The keyboard shortcut "command + shift + g" will summon "Go To Folder", where you will be able to type or paste any path you want. -->

<!-- On Windows, this path should look something like this: -->

<!-- ``` bash -->
<!-- C:/Program Files/Git/bin/git.exe -->
<!-- ``` -->

<!-- and here is a screenshot on Windows: -->

<!-- ![RStudio screenshot showing path to Git executable](img/windows-rstudio-git-executable-screenshot.png) -->


### Setup projects using Git and GitHub {-}

You have different options depending on how you start you project. I will only highlight the prefererd one.

#### New project, GitHub first {-}

Here we create a project with "GitHub first, then RStudio" sequence:

**Step 1**: Go to [GitHub] and make sure you are logged in. Click green "New repository" button. Or, if you are on your own profile page, click on "Repositories", then click the green "New" button.

- Repository name: `test` (or whatever you wish)  
- Public  
- YES Initialize this repository with a README

Click the big green button "Create repository."

Copy the HTTPS clone URL to your clipboard via the green "Clone or Download" button. 

**Step 2**: In RStudio, start a new Project:

  * **File > New Project > Version Control > Git**. In the "repository URL" paste the URL of your new GitHub repository. It will be something like this `https://github.com/[you-username]/test.git`.
  * Be intentional about where you create this Project.
  * Suggest you "Open in new session".
  * Click "Create Project" to create a new directory, which will be all of these things:
    - a directory or "folder" on your computer
    - a Git repository, linked to a remote GitHub repository
    - an RStudio Project
  * **In the absence of other constraints, I suggest that all of your R projects have exactly this set-up.**

This should download the `README.md` file that we created on GitHub in the previous step. Look in RStudio's file browser pane for the `README.md` file.

There's a big advantage to the "GitHub first, then RStudio" workflow: the remote GitHub repo is added as a remote for your local repo and your local `master` branch is now tracking `master` on GitHub. This is a technical but important point about Git. The practical implication is that you are now set up to push and pull. No need to fanny around setting up Git remotes and tracking branches on the command line.

**Step 3**: Make local changes, save, commit. 

**Do this every time you finish a valuable chunk of work, probably many times a day.**

From RStudio, modify the `README.md` file, e.g., by adding the line "This is a line from RStudio". Save your changes.

Commit these changes to your local repo. How?

  * Click the "Git" tab in upper right pane
  * Check "Staged" box for any files whose existence or modifications you want to commit.
    - To see more detail on what's changed in file since the last commit, click on "Diff" for a Git pop-up
  * If you're not already in the Git pop-up, click "Commit"
  * Type a message in "Commit message", such as "Commit from RStudio".
  * Click "Commit"

**Step 4**: Push your local changes to GitHub

**Do this a few times a day, but possibly less often than you commit.**

You have new work in your local Git repository, but the changes are not online yet.

This will seem counterintuitive, but first let's stop and pull from GitHub.

Why? Establish this habit for the future! If you make changes to the repo in the browser or from another machine or (one day) a collaborator has pushed, you will be happier if you pull those changes in before you attempt to push.
  
Click the blue "Pull" button in the "Git" tab in RStudio. I doubt anything will happen, i.e. you'll get the message "Already up-to-date." This is just to establish a habit.

Click the green "Push" button to send your local changes to GitHub. You should see some message along these lines.

``` bash
[master dc671f0] blah
 3 files changed, 22 insertions(+)
 create mode 100644 .gitignore
 create mode 100644 myrepo.Rproj
```

**Step 5**: Confirm the local change propagated to the GitHub remote

Go back to the browser. I assume we're still viewing your new GitHub repo.

Refresh.

You should see the new "This is a line from RStudio" in the README.

If you click on "commits," you should see one with the message "Commit from RStudio".

**Step 6**: Make a change on GitHub

Click on README.md in the file listing on GitHub.

In the upper right corner, click on the pencil for "Edit this file".

Add a line to this file, such as "Line added from GitHub."

Edit the commit message in "Commit changes" or accept the default.

Click the big green button "Commit changes."

**Step 7**: Pull from GitHub

Back in RStudio locally ...

Inspect your README.md. It should NOT have the line "Line added from GitHub". It should be as you left it. Verify that.

Click the blue Pull button.

Look at README.md again. You should now see the new line there.

**The end**

Now just repeat these operations when you do group work. Do work somewhere. Commit it. Push it or pull it depending on where you did it, but get local and remote "synced up". Repeat.

Note that in general (and especially in future when collaborating with other developers) you will usually need to pull changes from the remote (GitHub) before pushing the local changes you have made. For this reason, it's a good idea to try and get into the habit of pulling before you attempt to push.

If you have to type in your password over and over again, this can be avoided. Have a look at [Chapter 10][hg-credential-helper] of [Happy Git][happy-git].



#### Existing project, GitHub first {-}

See details in [Chapter 16][hg-exist-github-first] of [Happy Git][happy-git].


#### Existing project, GitHub last {-}

See details in [Chapter 17][hg-exist-github-last] of [Happy Git][happy-git].



# Annotate the course notes {#annotate}

I recommend using [hypothes.is] to annotate the online course notes. You can create both private and public annotations. Collaborative annotation helps people connect to each other and what they’re reading, even when they’re keeping their distance. You may also use public notes to help me indicate spell errors, unclear content etc. in the notes. 


# Getting help {#help}

We all get stuck sometimes and need some help. Below are some advises on how to help yourself and ask for help:
 
  * First try to understand the error message and solve the problem. You may try to debug your code by inserting break points in VBA or use `browser()` in your R code. See [Chapter 11][debug-in-r] in @wtf for further details.  
  * [Google is your friend](http://xkcd.com/627/). This is always the first step. Try searches like "vba range", "r dplyr filter", "r tidyverse", "r subset vector", etc.
  * Do you need help for a specific function in R then try `?[function-name]` such as `?geom_line`, `?mutate`, etc. Mostly, focus on the last section with examples. Moreover, some packages may have written vignettes try `browseVignettes(package = "package_name")` to check.
  * Have a look at **Help > Cheatsheets** in RStudio.
  * If you can't find an answer then it is time to ask on-line. I recommend asking a question at [stackoverflow](http://stackoverflow.com). To make your question effective, the idea is to make things as easy as possible for someone to answer. This stack overflow thread [How to make a great R reproducible example?](http://stackoverflow.com/questions/5963269/how-to-make-a-great-r-reproducible-example/5963610#5963610) give you some good hints. The process of providing a good minimal reproducible example (reprex) often causes you to answer your own question! See also [Stack Exchange's 'How to ask'](https://codereview.stackexchange.com/help/how-to-ask) and [How to make a reprex](https://www.tidyverse.org/help/) at tidyverse.
  * If you have a more course related question then ask it at our [course forum][course-help] and we will try to answer your question asap. Students are also welcome in helping each other.
  * You can also try to [annotate the online course notes](https://bss-osca.github.io/tfa/annotate.html) if something is unclear. I will try to answer asap.  
  * You can get help from our TAs at study cafés.
  
Note help using mail correspondence is not supported!


# Coding/naming convention {#coding-convention}

The main reason for using a consistent set of coding conventions is to standardize the structure and coding style of an application so that you and others can easily read and understand the code. Good coding conventions result in precise, readable, and unambiguous source code that is consistent with other language conventions and as intuitive as possible. 

Different ways of naming you variables exists. You are advised to adopt a naming convention; some use [snake case][wiki-snake-case] others use [camel case][wiki-camel-case]. The [Leszynski naming convention](https://en.wikipedia.org/wiki/Leszynski_naming_convention) define variables with a consistent prefix that makes it easy to identify its data type. It is common to use Leszynski convention within the VBA community. The R community use snake case but camel case is also okay. Some common prefixes used for the Leszynski naming convention are:

Type         Prefix     Example
-----      ----------   --------
Boolean      bln        blnFound
Currency	    cur	      curRevenue
Date (Time)	 dtm	      dtmStart
Double	    dbl     	dblTolerance
Integer      int        intQuantity
Long	       lng	      lngDistance
String       str        strFName
Variant      vnt        vntCheckSum
Array        ary        aryNumbers (optional)
User form    frm        frmProcess
Worksheet    wst        wstDistances
Workbook     wbk        wbkData

Many [other prefixes](https://msdn.microsoft.com/en-us/library/aa263493(v=vs.60).aspx) can be used also. 

Choose the naming convention you like best in your study group. But stick only to one of them. A few examples:

```
this_is_snake_case   # note you do not use capital letters here
thisIsCamelCase      # you start each word with a capital letter (except the first)
dblTolerance         # Lezynski convention naming a double (dbl) variable
strFullName              # Lezynski naming a string (str) variable
```

When defining variables and functions, it is in general good practice to use nouns for variables and verbs for functions.


## Commenting your code

It is always good practice to comment your code. Such that others can get a fast overview and understand your code easier. We will use [roxygen documentation](https://roxygen2.r-lib.org/) comments which are widely known. A few examples in VBA are

The top of a module file:

```
''' Module description.
'  Can be more than one line.
' @remarks Put your remarks on the module implementation here
' @author Lars Relund <junk@relund.dk>
' @date 2016-08-26
```

Before each `sub`, `function` etc. write:

```
'' Sub description
' @pre Precondition 
' @post Postcondition
' @param strA	Explanation of input parameter strA
' @param intB Explanation of input parameter intB
' @return Return value (if a function)
' @remarks Further remarks 
Public Function MyFunc(strA As String, intB As Integer) As Integer {
   ...
}
```

Further tags (i.e. keywords starting with @) can be seen [here](https://roxygen2.r-lib.org/articles/rd.html).

In R we use a 'hash' (#') to comment functions:


```r
#' Subtract two vectors
#'
#' @param x First vector.
#' @param y Vector to be subtracted.
#'
#' @return The difference.
#' @export
#'
#' @examples
#' subtract(x = c(5,5), y = c(2,3))
subtract <- function(x, y) {
  return(x-y)
}
```


# VBA specific topics {#apdx-vba}

## Debugging your code {#vba-debug}

You debug you code to find errors and correct bugs in your program. VBA has a built-in debugger that you may use to step though you code and check if the values in memory are correct. You start and use the debugger using the debugger buttons in the VBA editor, e.g. set the cursor in the top of a sub and press the **Step Into** button (<svg viewBox="0 0 448 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"></path></svg> F8, <svg viewBox="0 0 384 512" style="height:1em;position:relative;display:inline-block;top:.1em;" xmlns="http://www.w3.org/2000/svg">  <path d="M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 49.9-11.4 69.5-34.3z"></path></svg> ⇧⌘I). You can now repeatedly press the button to step though the code. 

In the **Locals** window you can see the values of the variables as you run you code. 
<!-- In the **Immediate** window you can add output using the [`Debug.Print`](https://www.automateexcel.com/vba/debug-print-immediate-window/) and test code.   -->

Finally, if you want to run the program until a specific line or code then insert a break-point by clicking the margin of that line in the VBA editor. Next, run you sub and the debugger will stop at that line. 

For more details you may have a look at Chapter 9 in @vba-book or the videos [Debug toolbar](https://youtu.be/AONXBZdx20Y), [Locals window](https://youtu.be/BC8py7Ce2rg) and [Breakpoints](https://youtu.be/k_1zrFdlZCU).																

## Error handling

See https://excelmacromastery.com/vba-error-handling/


## Course procedures {#vba-course-procedures}

The course have a set of *course procedures* that you may use 'as is' during the course and at the exam without any warranty. I will explicitly state if you are not allowed to use them. An overview is given in Table \@ref(tab:course-proc). All procedures within a topic start with the same suffix so you easy can find them using auto complete in the VBA editor (Ctrl + Space). On a mac you may have to disable the default shortcut (Ctrl + Space) for switching input sources. You can go to the *System Preferences -> Keyboard -> Shortcuts -> Input Sources* and disable it. For instance all procedures related to arrays start with suffix `Ary`. Similar the procedures are stored in module `ModAry`. The modules are stored in the template files for each teaching module (if used) and all course procedures can be found in as [text files](https://github.com/bss-osca/tfa/tree/master/vba/bas). If you want to use a procedure copy/import the whole module containing the procedure to the Excel file.

<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>(\#tab:course-proc)Course procedures. See the modules named ModRng, ModAry, ModWst, ModCol, and ModTm for further info.</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> procedure </th>
   <th style="text-align:left;"> type </th>
   <th style="text-align:left;"> desc </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> AryDim </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Array dimension </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AryEmpty </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Check if an array empty </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AryFromCSV </td>
   <td style="text-align:left;"> sub </td>
   <td style="text-align:left;"> Read a csv file to and array </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AryPaste </td>
   <td style="text-align:left;"> sub </td>
   <td style="text-align:left;"> Paste a 1D or 2D array to a sheet </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AryQuickSort </td>
   <td style="text-align:left;"> sub </td>
   <td style="text-align:left;"> Sort a 2-Dimensional array using a quicksort algorithm </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AryRead </td>
   <td style="text-align:left;"> sub </td>
   <td style="text-align:left;"> Read a range into a 2D array </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AryReadLong </td>
   <td style="text-align:left;"> sub </td>
   <td style="text-align:left;"> Read a range (long format) into an array (up to a 5D array is supported) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AryToSeq </td>
   <td style="text-align:left;"> sub </td>
   <td style="text-align:left;"> Set all array elements to a sequence </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AryToStr </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Convert an array to a string </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AryToVal </td>
   <td style="text-align:left;"> sub </td>
   <td style="text-align:left;"> Set all array elements to a specific value </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Col2Str </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Convert a collection to a string </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ColCopy </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Copy a collection </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngClear </td>
   <td style="text-align:left;"> sub </td>
   <td style="text-align:left;"> Clear a range </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngCurRegion </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Return the current region of a range </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngFormat </td>
   <td style="text-align:left;"> sub </td>
   <td style="text-align:left;"> Format a range </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngFromCSV </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Read a csv file and output it to cells </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetAddress </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Return the address of a range. </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetColLetter </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Convert column number to letter </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetCols </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Columns in range </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetCurRegionAddress </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Return the address of the current region of a range </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetCurRegionCols </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Columns in current region </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetCurRegionFirstCol </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> First column in current region </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetCurRegionFirstRow </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> First row in current region </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetCurRegionLastCol </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Last column in current region </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetCurRegionLastRow </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Last row in current region </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetCurRegionLowerLeft </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Return the lower left cell of the current region </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetCurRegionLowerRight </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Return the lower right cell of the current region </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetCurRegionRange </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Return the part of the current region starting with upper right cell in row and col </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetCurRegionRows </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Rows in current region </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetCurRegionUpperLeft </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Return the upper left cell of the current region </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetCurRegionUpperRight </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Return the upper right cell of the current region </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetFirstCol </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> First column in range </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetFirstRow </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> First row in range </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetLastCol </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Last column in range </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetLastRow </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Last row in range </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetLowerLeft </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Return the lower left cell of the range </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetLowerRight </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Return the lower right cell of the range </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetRange </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Return the part of the range starting with upper right cell in row and col </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetRows </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Rows in range </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetUpperLeft </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Return the upper left cell of the range </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngGetUpperRight </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Return the upper right cell of the range </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngJoin </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Join two ranges </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngPaste </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Paste a range on a sheet. </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngRemoveInterior </td>
   <td style="text-align:left;"> sub </td>
   <td style="text-align:left;"> Remove fill colors in cell range </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RngToCSV </td>
   <td style="text-align:left;"> sub </td>
   <td style="text-align:left;"> Write a range to a csv file </td>
  </tr>
  <tr>
   <td style="text-align:left;"> TmElapsed </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Time since timer has be started. </td>
  </tr>
  <tr>
   <td style="text-align:left;"> TmEx </td>
   <td style="text-align:left;"> sub </td>
   <td style="text-align:left;"> Example of using the timer procedures </td>
  </tr>
  <tr>
   <td style="text-align:left;"> TmRestoreAfterSpeedOptimize </td>
   <td style="text-align:left;"> sub </td>
   <td style="text-align:left;"> Restore properties for the Application object after have called ApplicationSpeedOptimize </td>
  </tr>
  <tr>
   <td style="text-align:left;"> TmSpeedOptimize </td>
   <td style="text-align:left;"> sub </td>
   <td style="text-align:left;"> Set some properties for the Application object to optimize excecution of vba </td>
  </tr>
  <tr>
   <td style="text-align:left;"> TmStart </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Start timer (unit seconds) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> WstClear </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Clear a worksheet if it exists </td>
  </tr>
  <tr>
   <td style="text-align:left;"> WstCreate </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Create a worksheet </td>
  </tr>
  <tr>
   <td style="text-align:left;"> WstDelete </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Delete a worksheet if it exists </td>
  </tr>
  <tr>
   <td style="text-align:left;"> WstExists </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Check if a worksheet exists </td>
  </tr>
  <tr>
   <td style="text-align:left;"> WstRename </td>
   <td style="text-align:left;"> function </td>
   <td style="text-align:left;"> Rename a worksheet if it exists and no sheet with the new name </td>
  </tr>
</tbody>
</table>








# Learning goals {#lg-course}
							
The purpose of this course is to give students a knowledge about IT tools for Analytics which requires the analyst to be qualified in handling tools beyond e.g. basic Excel. 							
After having participated in the course, the student must, in addition to achieving general academic skills, demonstrate:			
							
Knowledge of	

  1.	how a computer works at a basic level.						
  2.	basic programming such as variables, arrays, loops, functions and procedures. 						
  3.	what an algorithm is. 						
  4.	how to implement an algorithm based on a description. 						
  5.	different programming languages. 						
  6.	how to manage a code in a collaborative working environment.						
							
Skills to 		

  7.	handle data such as import, tidy, transform, visualize and export. 						
  8.	develop well-structured code. 						
  9.	perform testing and debugging. 						
  10.	implement/code selected algorithms. 						
  11.	apply analytical techniques on data.						
  12.	apply relevant methods, algorithms and techniques from this course in order to solve a specific problem.						
							
Competences to		

  13.	independently handle data given a problem. 						
  14.	independently analyze data given a relevant research question.						
  15.	compare different programming languages.						
  16.	compare different algorithms solving a problem and discuss their advantages and disadvantages.
  17.	interpret and discuss results based on a data analysis in relation to the relevant academic literature.						
  18.	communicate results from applied research in a scientific way, e.g. using literate programming.						


<!-- # Schedule {}  -->

<!-- The schedule for the course is given below. -->

<!-- ```{r, echo=FALSE, message=FALSE, cache=FALSE, eval=FALSE} -->
<!-- source("common.R") -->
<!-- library(googlesheets4) -->
<!-- sheets_deauth() -->
<!-- sheet <- read_sheet("https://docs.google.com/spreadsheets/d/1-fSG3KWip0Vm5Uwf9T6vUMuH0ReBhpITHT3rl896vwc/edit?usp=sharing", -->
<!--            sheet = "Schedule") -->
<!-- knitr::kable(sheet) -->
<!-- ``` -->

<!-- <p><iframe width="1300" height="600" frameborder="0" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRka2NKE77BvtIoJc1GW-Dr_oABzQdQhMC94KpPjW7DpSTnepN9RV3m6w1ILKe3YoQwUj0C6JAe3K1T/pubhtml?gid=1591856300&amp;single=true&amp;widget=true&amp;headers=false"></iframe></p> -->


# Business Analytics {#ba}

Business Analytics (BA) refers to the scientific process of transforming data into insight for making better decisions in business. BA can both be seen as the complete decision making process for solving a business problem or as a set of methodologies that enable the creation of business value. As a process it can be characterized by descriptive, predictive, and prescriptive model building using "big" data sources.

Descriptive Analytics: A set of technologies and processes that use data to understand and analyze business performance. Descriptive analytics are the most commonly used and most well understood type of analytics. Descriptive analytics categorizes, characterizes, consolidates, and classifies data. Examples are standard reporting and dashboards (KPIs, what happened or is happening now?) and ad-hoc reporting (how many/often?). Descriptive analytics often serves as a first step in the successful application of predictive or prescriptive analytics.

Predictive Analytics: The use of data and statistical techniques to make predictions about future outputs/outcomes, identify patterns or opportunities for business performance. Examples of techniques are data mining (what data is correlated with other data?), pattern recognition and alerts (when should I take action to correct/adjust a spare part?), Monte-Carlo simulation (what could happen?), neural networks (which customer group are best?) and forecasting (what if these trends continue?).

Prescriptive Analytics: The use of optimization and other decision modelling techniques using the results of descriptive and predictive analytics to suggest decision options with the goal of improving business performance. Prescriptive analytics attempt to quantify the effect of future decisions in order to advise on possible outcomes before the decisions are actually made. Prescriptive analytics predicts not only what will happen, but also why it will happen and provides recommendations regarding actions that will take advantage of the predictions. Prescriptive analytics are relatively complex to administer, and most companies are not yet using it in their daily course of business. However, when implemented correctly, it can have a huge impact on business performance and how businesses make decisions. Examples on prescriptive analytics are optimization in production planning and scheduling, inventory management, the supply chain and transportation planning. 

Companies who use BA focus on fact-based management to drive decision making and treats data and information as a strategic asset that is shared within the company. This enterprise approach generates a companywide respect for applying descriptive, predictive and prescriptive analytics in areas such as supply chain, marketing and human resources. 

Related areas: In the past Business Intelligence traditionally focuses on querying, reporting, online analytical processing, i.e. descriptive analytics. However, a more modern definition of Business Intelligence is the union of descriptive and predictive analytics. Operations Research or Management Science deals with the application of advanced analytical methods to help make better decisions and can hence be seen as prescriptive analytics. However, traditionally it has been taking a more theoretical approach and focusing on problem-driven research while BA takes a more data-driven approach. Logistics is a cross-functional area focusing on the effective and efficient flows of goods and services, and the related flows of information and cash. Supply Chain Management adds a process-oriented and cross-company perspective. Both can be seen as prescriptive analytics with a more problem-driven research focus. Advanced Analytics is often used as a classification of both predictive and prescriptive analytics. Data science is an interdisciplinary field about scientific methods, processes, and systems to extract knowledge or insights from data in various forms, either structured or unstructured and can be seen as Business analytics applied to a wider range of data. 

Resources
http://analytics-magazine.org/the-analytics-journey/ 
https://en.wikipedia.org/wiki/Business_analytics 
http://connect.informs.org/analytics/home 
https://www.or-exchange.org/questions/5645/informs-analytics-definition 
https://en.wikipedia.org/wiki/Prescriptive_analytics
https://en.wikipedia.org/wiki/Predictive_analytics 

<!-- Business Analytics (BA) refers to the scientific process of transforming data into insight for making better decisions in business. BA can both be seen as the complete decision making process for solving a business problem and the creation of business value by integration of concepts, methods and data. As a process, it can be characterized by descriptive, predictive, and prescriptive model building using "big" data sources. For further details, see http://analytics-magazine.org/the-analytics-journey/. -->

<!-- Operations Research and Management Science deal with the application of advanced analytical methods in order to make better decisions. Hence, they are closely related to prescriptive analytics. Companies that use BA focus on fact-based management to drive decision making and treats data and information as a strategic asset that is shared within the company. To a larger extent than before, data may be available for validation purposes. -->


# Colophon {}

These notes were written in [bookdown](http://bookdown.org/) inside [RStudio](http://www.rstudio.com/ide/). 
<!-- The website [stat545.com](https://stat545.com) is hosted with [Netlify](https://www.netlify.com), and automatically updated after every commit by [Travis-CI](https://travis-ci.org). The complete source is available from [GitHub](https://github.com/rstudio-education/stat545). -->

This version of the book was built with:


```
#> Finding R package dependencies ... [22/29] [23/29] [24/29] [25/29] [26/29] [27/29] [28/29] [29/29] Done!
#>  setting  value
#>  version  R version 4.2.1 (2022-06-23)
#>  os       macOS Big Sur ... 10.16
#>  system   x86_64, darwin17.0
#>  ui       X11
#>  language (EN)
#>  collate  en_US.UTF-8
#>  ctype    en_US.UTF-8
#>  tz       Europe/Copenhagen
#>  date     2022-08-08
#>  pandoc   2.18 @ /Applications/RStudio.app/Contents/MacOS/quarto/bin/tools/ (via rmarkdown)
```

Along with these packages:


```{=html}
<div id="htmlwidget-fbb5cb7903c52ce81004" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-fbb5cb7903c52ce81004">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["askpass","assertthat","babynames","backports","base64enc","bit","bit64","bitops","blob","bookdown","brew","brio","broom","bslib","bsplus","cachem","callr","cellranger","checkmate","class","cli","clipr","codetools","colorspace","commonmark","conflicted","cpp11","crayon","credentials","crosstalk","curl","data.table","DBI","dbplyr","desc","devtools","DiagrammeR","dials","DiceDesign","diffobj","digest","downlit","downloader","dplyr","dsbox","dslabs","DT","dtplyr","ellipsis","evaluate","fansi","farver","fastmap","fitdistrplus","fivethirtyeight","fontawesome","forcats","foreach","fs","furrr","future","future.apply","gapminder","gargle","generics","gert","ggmap","ggplot2","gh","gitcreds","globals","glue","googledrive","googlesheets4","gower","GPfit","gradethis","gridExtra","gtable","hardhat","haven","here","highr","hms","htmltools","htmlwidgets","httpuv","httr","icons","ids","igraph","infer","influenceR","ini","ipred","isoband","iterators","jpeg","jquerylib","jsonlite","kableExtra","KernSmooth","knitr","labeling","later","lattice","lava","lazyeval","leaflet","leaflet.minicharts","leaflet.providers","learnr","lhs","lifecycle","listenv","lubridate","magrittr","markdown","MASS","Matrix","memoise","mgcv","mime","miniUI","modeldata","modelr","munsell","nlme","nnet","numDeriv","openssl","openxlsx","palmerpenguins","parallelly","parsnip","patchwork","pillar","pkgbuild","pkgconfig","pkgdown","pkgload","plyr","png","praise","prettyunits","processx","prodlim","profvis","progress","progressr","promises","ps","purrr","R6","ragg","rappdirs","raster","rcmdcheck","RColorBrewer","Rcpp","readr","readxl","recipes","rematch","rematch2","remotes","renv","repr","reprex","RgoogleMaps","rjson","rlang","rmarkdown","robotstxt","roxygen2","rpart","rprojroot","rsample","rstudioapi","rversions","rvest","sass","scales","selectr","sessioninfo","shiny","skimr","slider","sourcetools","sp","spiderbar","SQUAREM","stringi","stringr","survival","svglite","sys","systemfonts","terra","testthat","textshaping","tfa","tibble","tidymodels","tidyr","tidyselect","tidyverse","timeDate","tinytex","tune","tzdb","urlchecker","usethis","utf8","uuid","vctrs","viridis","viridisLite","visNetwork","vroom","waldo","warp","webshot","whisker","withr","workflows","workflowsets","xfun","xml2","xopen","xtable","yaml","yardstick","zip"],[null,"0.2.1","1.0.1","1.4.1","0.1-3","4.0.4","4.0.5","1.0-7",null,"0.27",null,null,"1.0.0","0.4.0","0.1.3","1.0.6","3.7.1","1.1.0",null,null,"3.3.0",null,"0.2-18","2.0-3",null,"1.1.0",null,"1.5.1",null,"1.2.0","4.3.2",null,"1.1.3","2.2.1",null,"2.4.4","1.0.9",null,null,null,"0.6.29",null,null,"1.0.9","0.1.1","0.7.4","0.23",null,"0.3.2","0.15","1.0.3","2.1.1","1.1.0","1.1-8",null,null,"0.5.1",null,"1.5.2",null,null,null,"0.3.0","1.2.0","0.1.3",null,"3.0.0","3.3.6",null,null,null,"1.6.2","2.0.0","1.0.0",null,null,null,null,"0.3.0",null,"2.5.0","1.0.1","0.9","1.1.1","0.5.3","1.5.4","1.6.5","1.4.3","0.2.0",null,"1.3.4",null,null,null,null,null,null,"0.1-9","0.1.4","1.8.0","1.3.4",null,"1.39","0.4.2","1.3.0","0.20-45",null,null,"2.1.1","0.6.2","1.9.0",null,null,"1.0.1",null,"1.8.0","2.0.3","1.1","7.3-58.1","1.4-1","2.0.1","1.8-40","0.12","0.1.1.1",null,"0.1.8","0.5.0","3.1-158",null,null,null,"4.2.5",null,null,null,"1.1.1","1.8.0","1.3.1","2.0.3",null,"1.3.0","1.8.7","0.1-7",null,"1.1.1","3.7.0",null,"0.3.7",null,null,"1.2.0.1","1.7.1","0.3.4","2.5.1",null,"0.3.3",null,null,"1.1-3","1.0.9","2.1.2","1.4.0",null,"1.0.1",null,"2.4.2","0.15.5","1.1.4","2.0.1","1.4.5.3","0.2.21","1.0.4","2.14",null,null,null,"2.0.3",null,"0.13",null,"1.0.2","0.4.2","1.2.0",null,"1.2.2","1.7.2","2.1.4",null,null,"1.5-0",null,null,"1.7.8","1.4.0","3.3-1","2.1.0",null,"1.0.4",null,null,null,"0.5.4","3.1.8",null,"1.2.0","1.1.2","1.3.2",null,null,null,"0.3.0","1.0.1","2.1.6","1.2.2",null,"0.4.1",null,"0.4.0","2.1.0","1.5.7",null,null,"0.5.3",null,"2.5.0",null,null,"0.31","1.3.3",null,"1.8-4","2.3.5",null,"2.2.0"],["2019-01-13","2019-03-21","2021-04-12","2021-12-13","2015-07-28","2020-08-04","2020-08-30","2021-04-24","2022-04-10","2022-06-14","2022-02-04","2021-11-30","2022-07-01","2022-07-16","2021-10-05","2021-08-19","2022-07-13","2016-07-27","2022-04-21","2022-01-16","2022-04-25","2022-02-22","2020-11-04","2022-02-21","2022-03-09","2021-11-26","2021-11-30","2022-03-26","2021-11-29","2021-11-04","2021-06-23","2021-09-27","2022-06-18","2022-06-27","2022-03-06","2022-07-20","2022-03-05","2022-06-14","2021-02-13","2021-10-05","2021-12-01","2022-07-05","2015-07-09","2022-04-28","2022-07-04","2021-04-30","2022-05-10","2022-01-19","2021-04-29","2022-02-18","2022-03-24","2022-07-06","2021-01-25","2022-03-10","2021-10-07","2022-07-20","2021-01-27","2022-02-02","2021-12-08","2022-05-04","2022-07-22","2022-04-25","2017-10-31","2021-07-02","2022-07-05","2022-08-07","2019-02-05","2022-05-03","2021-04-30","2020-12-04","2022-08-05","2022-02-24","2021-07-08","2021-07-21","2022-02-03","2019-02-08","2022-07-22","2017-09-09","2019-03-25","2022-06-30","2022-04-15","2020-12-13","2021-04-16","2021-09-26","2022-07-18","2021-09-08","2022-01-05","2022-05-04","2022-07-04","2017-05-31","2022-07-19","2022-06-10","2021-09-25","2018-05-20","2022-06-02","2021-07-13","2022-02-05","2021-07-24","2021-04-26","2022-02-22","2021-02-20","2021-05-03","2022-04-26","2020-10-20","2021-08-18","2021-09-22","2021-09-02","2019-03-15","2022-03-23","2021-05-11","2019-11-09","2022-07-22","2022-03-22","2021-09-24","2019-12-05","2021-10-07","2022-03-30","2019-08-07","2022-08-03","2022-03-23","2021-11-26","2022-03-29","2021-09-28","2018-05-18","2022-07-01","2020-05-19","2018-06-12","2022-06-15","2022-01-16","2019-06-06","2022-05-24","2021-12-14","2020-07-23","2022-07-21","2022-06-16","2020-12-17","2022-07-18","2021-12-20","2019-09-22","2022-07-16","2022-06-27","2022-03-24","2013-12-03","2015-08-11","2020-01-24","2022-07-07","2019-11-17","2020-11-02","2019-05-16","2022-06-03","2021-02-11","2022-06-18","2020-04-17","2021-08-19","2022-02-21","2021-01-31","2022-06-27","2021-09-27","2022-04-03","2022-07-08","2022-01-30","2022-03-28","2022-07-07","2016-04-21","2020-05-01","2021-11-30","2022-05-26","2022-01-04","2021-08-05","2020-02-12","2022-01-09","2022-07-12","2022-04-25","2020-09-03","2022-07-18","2022-01-24","2022-04-02","2022-08-08","2020-11-12","2021-05-31","2021-10-16","2022-07-16","2022-04-13","2019-11-20","2021-12-06","2022-07-19","2022-04-15","2021-07-01","2018-04-25","2022-06-05","2021-05-16","2021-01-13","2022-07-11","2019-02-10","2022-03-03","2022-02-03","2020-07-23","2022-02-11","2022-08-07","2022-04-26","2021-10-13","2022-08-08","2022-07-22","2022-07-13","2022-02-01","2022-02-21","2022-07-18","2022-07-19","2022-06-15","2022-07-07","2022-03-28","2021-11-30","2022-05-25","2021-07-24","2022-04-19","2022-04-13","2021-10-13","2021-04-13","2021-09-29","2021-11-30","2022-03-16","2020-10-21","2022-04-14","2019-08-28","2022-03-03","2022-07-05","2022-07-12","2022-05-10","2021-11-30","2018-09-17","2019-04-21","2022-02-21","2022-06-06","2021-05-31"],["CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.1)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.1)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.1)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","Github (rstudio-education/dsbox@ff0c198cc005dd0ef7bf60daec142c8c583e756a)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.1)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.1)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","Github (rstudio/gradethis@b42f81d027b8074d8e2924e70ddb7376efc19144)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","Github (mitchelloharawild/icons@6e4dc378ac86c1d4f4ea167f408bed07b3df14fb)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.1)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.1)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","Github (rstudio/learnr@16e856386e78e4a1bcf11627b340e15f323d2e63)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.1)","CRAN (R 4.2.0)","CRAN (R 4.2.1)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.1)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.1)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.1)","CRAN (R 4.2.0)","CRAN (R 4.2.1)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.1)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","https://rspatial.r-universe.dev (R 4.2.1)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","Github (bss-osca/tfa-package@7ad56e4c42110c27f8fcb27fe50a1f316741f1ff)","CRAN (R 4.2.1)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)","CRAN (R 4.2.0)"]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>package<\/th>\n      <th>loadedversion<\/th>\n      <th>date<\/th>\n      <th>source<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":234,"autoWidth":true,"bInfo":false,"paging":false,"columnDefs":[],"order":[],"orderClasses":false,"orderCellsTop":true,"lengthMenu":[10,25,50,100,234]}},"evals":[],"jsHooks":[]}</script>
```





[BSS]: https://bss.au.dk/en/

[course-help]: https://github.com/bss-osca/tfa/issues
[cran]: https://cloud.r-project.org
[cheatsheet-readr]: https://rawgit.com/rstudio/cheatsheets/master/data-import.pdf
[course-welcome-to-the-tidyverse]: https://github.com/rstudio-education/welcome-to-the-tidyverse

[DataCamp]: https://www.datacamp.com/
[datacamp-signup]: https://www.datacamp.com/groups/shared_links/cbaee6c73e7d78549a9e32a900793b2d5491ace1824efc1760a6729735948215
[datacamp-r-intro]: https://learn.datacamp.com/courses/free-introduction-to-r
[datacamp-r-rmarkdown]: https://campus.datacamp.com/courses/reporting-with-rmarkdown
[datacamp-r-communicating]: https://learn.datacamp.com/courses/communicating-with-data-in-the-tidyverse
[datacamp-r-communicating-chap3]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/introduction-to-rmarkdown
[datacamp-r-communicating-chap4]: https://campus.datacamp.com/courses/communicating-with-data-in-the-tidyverse/customizing-your-rmarkdown-report
[datacamp-r-intermediate]: https://learn.datacamp.com/courses/intermediate-r
[datacamp-r-intermediate-chap1]: https://campus.datacamp.com/courses/intermediate-r/chapter-1-conditionals-and-control-flow
[datacamp-r-intermediate-chap2]: https://campus.datacamp.com/courses/intermediate-r/chapter-2-loops
[datacamp-r-intermediate-chap3]: https://campus.datacamp.com/courses/intermediate-r/chapter-3-functions
[datacamp-r-intermediate-chap4]: https://campus.datacamp.com/courses/intermediate-r/chapter-4-the-apply-family
[datacamp-r-functions]: https://learn.datacamp.com/courses/introduction-to-writing-functions-in-r
[datacamp-r-tidyverse]: https://learn.datacamp.com/courses/introduction-to-the-tidyverse
[datacamp-r-strings]: https://learn.datacamp.com/courses/string-manipulation-with-stringr-in-r
[datacamp-r-dplyr]: https://learn.datacamp.com/courses/data-manipulation-with-dplyr
[datacamp-r-dplyr-bakeoff]: https://learn.datacamp.com/courses/working-with-data-in-the-tidyverse
[datacamp-r-ggplot2-intro]: https://learn.datacamp.com/courses/introduction-to-data-visualization-with-ggplot2
[datacamp-r-ggplot2-intermediate]: https://learn.datacamp.com/courses/intermediate-data-visualization-with-ggplot2
[dplyr-cran]: https://CRAN.R-project.org/package=dplyr
[debug-in-r]: https://rstats.wtf/debugging-r-code.html

[excel-vs-r]: https://www.jessesadler.com/post/excel-vs-r/

[google-form]: https://forms.gle/s39GeDGV9AzAXUo18
[google-grupper]: https://docs.google.com/spreadsheets/d/1DHxthd5AQywAU4Crb3hM9rnog2GqGQYZ2o175SQgn_0/edit?usp=sharing
[GitHub]: https://github.com/
[git-install]: https://git-scm.com/downloads
[github-actions]: https://github.com/features/actions
[github-pages]: https://pages.github.com/

[happy-git]: https://happygitwithr.com
[hg-install-git]: https://happygitwithr.com/install-git.html
[hg-why]: https://happygitwithr.com/big-picture.html#big-picture
[hg-github-reg]: https://happygitwithr.com/github-acct.html#github-acct
[hg-git-install]: https://happygitwithr.com/install-git.html#install-git
[hg-exist-github-first]: https://happygitwithr.com/existing-github-first.html
[hg-exist-github-last]: https://happygitwithr.com/existing-github-last.html
[hg-credential-helper]: https://happygitwithr.com/credential-caching.html
[hypothes.is]: https://web.hypothes.is/

[osca-programme]: https://kandidat.au.dk/en/operationsandsupplychainanalytics/

[Peergrade]: https://peergrade.io
[peergrade-signup]: https://app.peergrade.io/join
[point-and-click]: https://en.wikipedia.org/wiki/Point_and_click
[pkg-bookdown]: https://bookdown.org/yihui/bookdown/
[pkg-openxlsx]: https://ycphs.github.io/openxlsx/index.html
[pkg-ropensci-writexl]: https://docs.ropensci.org/writexl/
[pkg-jsonlite]: https://cran.r-project.org/web/packages/jsonlite/index.html

[R]: https://www.r-project.org
[RStudio]: https://rstudio.com
[rstudio-cloud]: https://rstudio.cloud/spaces/176810/join?access_code=LSGnG2EXTuzSyeYaNXJE77vP33DZUoeMbC0xhfCz
[r-cloud-mod12]: https://rstudio.cloud/spaces/176810/project/2963819
[r-cloud-mod13]: https://rstudio.cloud/spaces/176810/project/3020139
[r-cloud-mod14]: https://rstudio.cloud/spaces/176810/project/3020322
[r-cloud-mod15]: https://rstudio.cloud/spaces/176810/project/3020509
[r-cloud-mod16]: https://rstudio.cloud/spaces/176810/project/3026754
[r-cloud-mod17]: https://rstudio.cloud/spaces/176810/project/3034015
[r-cloud-mod18]: https://rstudio.cloud/spaces/176810/project/3130795
[r-cloud-mod19]: https://rstudio.cloud/spaces/176810/project/3266132
[rstudio-download]: https://rstudio.com/products/rstudio/download/#download
[rstudio-customizing]: https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio
[rstudio-key-shortcuts]: https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts
[rstudio-workbench]: https://www.rstudio.com/wp-content/uploads/2014/04/rstudio-workbench.png
[r-markdown]: https://rmarkdown.rstudio.com/
[ropensci-writexl]: https://docs.ropensci.org/writexl/
[r4ds-pipes]: https://r4ds.had.co.nz/pipes.html
[r4ds-factors]: https://r4ds.had.co.nz/factors.html
[r4ds-strings]: https://r4ds.had.co.nz/strings.html
[r4ds-iteration]: https://r4ds.had.co.nz/iteration.html

[stat-545]: https://stat545.com
[stat-545-functions-part1]: https://stat545.com/functions-part1.html
[stat-545-functions-part2]: https://stat545.com/functions-part2.html
[stat-545-functions-part3]: https://stat545.com/functions-part3.html
[slides-welcome]: https://bss-osca.github.io/tfa/slides/00-tfa_welcome.html
[slides-m1-3]: https://bss-osca.github.io/tfa/slides/01-welcome_r_part.html
[slides-m4-5]: https://bss-osca.github.io/tfa/slides/02-programming.html
[slides-m6-8]: https://bss-osca.github.io/tfa/slides/03-transform.html
[slides-m9]: https://bss-osca.github.io/tfa/slides/04-plot.html
[slides-m83]: https://bss-osca.github.io/tfa/slides/05-joins.html

[tidyverse-main-page]: https://www.tidyverse.org
[tidyverse-packages]: https://www.tidyverse.org/packages/
[tidyverse-core]: https://www.tidyverse.org/packages/#core-tidyverse
[tidyverse-ggplot2]: https://ggplot2.tidyverse.org/
[tidyverse-dplyr]: https://dplyr.tidyverse.org/
[tidyverse-tidyr]: https://tidyr.tidyverse.org/
[tidyverse-readr]: https://readr.tidyverse.org/
[tidyverse-purrr]: https://purrr.tidyverse.org/
[tidyverse-tibble]: https://tibble.tidyverse.org/
[tidyverse-stringr]: https://stringr.tidyverse.org/
[tidyverse-forcats]: https://forcats.tidyverse.org/
[tidyverse-readxl]: https://readxl.tidyverse.org
[tidyverse-googlesheets4]: https://googlesheets4.tidyverse.org/index.html
[tutorial-markdown]: https://commonmark.org/help/tutorial/

[Udemy]: https://www.udemy.com/

[vba-yt-course1]: https://www.youtube.com/playlist?list=PLpOAvcoMay5S_hb2D7iKznLqJ8QG_pde0
[vba-course1-hello]: https://youtu.be/f42OniDWaIo

[vba-yt-course2]: https://www.youtube.com/playlist?list=PL3A6U40JUYCi4njVx59-vaUxYkG0yRO4m
[vba-course2-devel-tab]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-editor]: https://youtu.be/awEOUaw9q58
[vba-course2-devel-project]: https://youtu.be/fp6PTbU7bXo
[vba-course2-devel-properties]: https://youtu.be/ks2QYKAd9Xw
[vba-course2-devel-hello]: https://youtu.be/EQ6tDWBc8G4

[video-install]: https://vimeo.com/415501284
[video-rstudio-intro]: https://vimeo.com/416391353
[video-packages]: https://vimeo.com/416743698
[video-projects]: https://vimeo.com/319318233
[video-r-intro-p1]: https://www.youtube.com/watch?v=vGY5i_J2c-c
[video-r-intro-p2]: https://www.youtube.com/watch?v=w8_XdYI3reU
[video-r-intro-p3]: https://www.youtube.com/watch?v=NuY6jY4qE7I
[video-subsetting]: https://www.youtube.com/watch?v=hWbgqzsQJF0&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10&t=0s
[video-datatypes]: https://www.youtube.com/watch?v=5AQM-yUX9zg&list=PLjTlxb-wKvXPqyY3FZDO8GqIaWuEDy-Od&index=10
[video-control-structures]: https://www.youtube.com/watch?v=s_h9ruNwI_0
[video-conditional-loops]: https://www.youtube.com/watch?v=2evtsnPaoDg
[video-functions]: https://www.youtube.com/watch?v=ffPeac3BigM
[video-tibble-vs-df]: https://www.youtube.com/watch?v=EBk6PnvE1R4
[video-dplyr]: https://www.youtube.com/watch?v=aywFompr1F4

[wiki-snake-case]: https://en.wikipedia.org/wiki/Snake_case
[wiki-camel-case]: https://en.wikipedia.org/wiki/Camel_case
[wiki-interpreted]: https://en.wikipedia.org/wiki/Interpreted_language
[wiki-literate-programming]: https://en.wikipedia.org/wiki/Literate_programming
[wiki-csv]: https://en.wikipedia.org/wiki/Comma-separated_values
[wiki-json]: https://en.wikipedia.org/wiki/JSON

<!--chapter:end:99_apdx.Rmd-->


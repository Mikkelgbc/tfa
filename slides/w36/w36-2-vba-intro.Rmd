---
title: "An introduction to VBA"
author: "Lars Relund Nielsen"
output:
  xaringan::moon_reader:
    css: "./libs/slides.css"
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightLines: true
      highlightStyle: solarized-light
      countIncrementalSlides: false
editor_options: 
  chunk_output_type: console
---

```{r, child = "../setup.Rmd", echo=FALSE}
```

```{r include=FALSE}
# use xaringan::inf_mr(cast_from = "..") to preview
```






<!-- - Always try to use parentheses when you call subs and functions, e.g. `dtmTime = Now` will give the same result as `dtmTime = Now()` (it is not always possible when you call subs with no input). -->
<!-- - Indent you code using the default standard -->
<!-- - Specify return type of functions  -->
<!-- - Make procedures private whenever possible -->
<!-- - Always use `Option Explicit` (can be se under Tools-Options: "Require variable declaration" in the VBA editor) -->


## What is VBA

- A programming language intended to control and automate Microsoft Office applications (we use Excel).
- VBA (Visual Basic for Applications) is an implementation of BASIC developed by Microsoft. 
- A [compiled language](https://en.wikipedia.org/wiki/Compiled_language#:~:text=A%20compiled%20language%20is%20a,%2Druntime%20translation%20takes%20place). That is, code need to be compiled first before running it. 
- You can only run VBA using the desktop version of Excel (not the web version).
- With VBA you can extend Excel and automate tasks by coding different algorithms that for instance can be run by pressing a button. 


---

## Setting up Excel for VBA

.midi[
For running VBA code the **Developer** tab needs to be visible in Excel. This can be done by check marking the **Developer** tab under the 'Ribbon and Toolbar' options in Excel. You find it by choosing **Excel -> Preferences -> Ribbon and toolbar** (`r icons::fontawesome$brands$apple`) or right click a tab and choose **Customize ribbon ...** (`r icons::fontawesome$brands$windows`).

In the **Developer** tab you open the VBA editor by pressing the **Visual basic** button (`r icons::fontawesome$brands$windows` Alt + F11, `r icons::fontawesome$brands$apple` ⌥ + F11).

A few useful shortcuts:

- Toggle VBA editor and Excel (`r icons::fontawesome$brands$windows` Alt + F11, `r icons::fontawesome$brands$apple` ⌘⇧´).
- Run current procedure or continues execution after pausing (F5).
- Terminate a procedure and reset all variables to their default values (Shift + F5).
- Open the Object Browser (F2).
- Auto complete code (Ctrl + Space).
- Switch between subs/functions (Ctrl + Up/Down).
- Use the debugger (F8).
- Run Debugger to this line (Ctrl + F8).
]
<!-- - How to avoid the enable macros dialog? If you have your Excel macro files in a trusted location you can add this location as trusted under `Options > Trust Center > Trust Center Settings > Trusted locations`. -->
<!-- - How to avoid the "Be careful! Parts of your document may include personal information that can't be removed by the Document Inspector"? Go to `Options > Trust Center > Trust Center Settings > Privacy Options` and un-check the check box that says "Remove personal information from file properties on save". -->

---

## Let us try it out

An __algorithm__ is a finite sequence of well-defined instructions to solve a specific problem or to perform a computation. Let us try to program this algorithm written in pseudocode:

.instructions[
**Precondition**: A list of student names and a 2-dim array `pref` with group preferences. Entry `pref(i,j)` equals one if student `i` like to be in group with student `j` and zero otherwise.

**Postcondition**: A set of groups with 3-6 persons.

- Step 1: Put students that want to be together in a group if between 3 to 6 students.
- Step 2: Create two student groups if more than 6 students want to be together.
- Step 3: Consider the remaining students and create a group by adding students that want to be together until the group size is 4. 
- Step 4: If two students left then add the students to the last group else create a new group.
- Step 5: Return the student names of each group.
]

---

## Say Hello World

---

## Procedures

You will deal with two kinds of procedures

Sub (they can work as a “macro” in Excel)
Function (they can work like Excel functions)

---

## Basic building blocks in programming

variables, input/output, decisions/cond statements, loops, procedures (functions and subs)


---

## Variables

---

## Input/output




```{r copy to docs, include=FALSE}
file.copy(list.files(pattern = ".html"), "../../docs/slides/", overwrite = T)
file.copy("../slides.css", "./libs/", overwrite = T)
file.copy("libs", "../../docs/slides/", recursive = T)
file.copy("img", "../../docs/slides/", recursive = T)
```
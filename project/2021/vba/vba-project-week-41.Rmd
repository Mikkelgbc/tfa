---
title: "Seat reservation"
description: |
  VBA project - An analysis of seat reservation strategies
date: "`r Sys.Date()`"
#repository_url: [A url to your source code(dropbox, onedrive, github etc)]
#preview: https://rstudio.github.io/distill/images/javascript-d3-preview.png
# creative_commons: CC BY-NC
bibliography: litt.bib
output:
  distill::distill_article:
    toc: true
    toc_depth: 3
    toc_float: true
editor_options: 
  chunk_output_type: inline
---

```{r, include=FALSE}
if (interactive()) setwd(dirname(rstudioapi::getActiveDocumentContext()$path)) # set working dir to current file location
knitr::opts_chunk$set(
  # cache = TRUE, autodep = TRUE,  # use this option so compile the document faster (you may comment it out at the final report)
  echo = TRUE, 
  layout="l-page", fig.width = 12
  )
# use xaringan::inf_mr() for instant preview
```

<!-- Some css for the comments (delete) -->
```{css, echo=FALSE}
.comment {
  color: #F1948A;
  border-color: black;
  border-style: dashed;
  border-width: thin;
  padding: 10px;
}
```

This assignment considers a seat reservation problem. Consider a train with $I$ seats that is traveling between a start station $1$ and an end station $S$ with $S-2$ stations in between. All seats must be reserved and requests for seat reservations arrive on-line. For ease we assume that a request $r$ is for a single seat between a start station $s_1(r)$ and the end station $s_2(r)$. A decision must be made immediately after the arrival of the request to either accept the request or reject it. If the request is accepted, the reservation must be assigned to a seat and this decision cannot be changed subsequently. That is, there is no knowledge about future requests. The train company want to find a strategy that accept as many requests as possible. Consider the following requests arriving for a train with 3 seats and 14 stations:

| Request | From | To |
| ------- | ---- | -- |
| 1       | 1    | 3  |
| 2       | 7    | 9  |
| 3       | 2    | 5  |
| 4       | 9    | 13 |
| 5       | 2    | 6  |
| 6       | 11   | 14 |
| 7       | 10   | 13 |
| 8       | 8    | 9  |
| 9       | 7    | 11 |

A possible assignment of requests to seats is given in Figure \@ref(fig:greedy).

```{r greedy, echo = FALSE, layout="l-body-outset", fig.cap="Assignment of requests (Greedy strategy)."} 
knitr::include_graphics("./graphic/greedy.png") 
```   

Observe that the reservation number is assigned to a slot where slot $s$ is from station $s$ to $s+1$. That is, for each seat there is $S-1$ slots. 

Given a request $r$ consider strategies:

- **Greedy**: Scan seats from 1 to $I$. If seat $i$ is available from $s_1(r)$ to $s_2(r)$ then accept the request and assign the reservation to seat $i$. Otherwise reject the request.
- **Minimize Slots (MinSlots)**: For each seat $i$ available from $s_1(r)$ to $s_2(r)$ calculate the total free slots before and after stations $s_1$ to $s_2$. Assign the request to a seat where it leaves as little total free slots as possible. Otherwise reject the request.
- **Maximize Slots (MaxSlots)**: For each seat $i$ available from $s_1(r)$ to $s_2(r)$ calculate the total free slots before and after stations $s_1$ to $s_2$. Assign the request to a seat where it leaves most total free slots as possible. Otherwise reject the request.

The result of a strategy Greedy is given in Figure \@ref(fig:greedy) and for MinSlots in Figure \@ref(fig:min-slots). Note that by using the MinSlots strategy all requests are accepted. 

```{r min-slots, echo = FALSE, layout="l-body-outset", fig.cap="Assignment of requests (MinSlots strategy)."} 
knitr::include_graphics("./graphic/min-slot.png") 
```

Two statistics are used to measure the quality of a strategy applied to the dataset with $R$ requests are:

- Accepted requests in percent.
- Used slots in percent $$\frac{\sum_r L_r(s_2(r)-s_1(r))}{I(S-1)}.$$ Where $L_r = 1$ if request $r$ is accepted and 0 otherwise. That is, slots used divided with total number of slots.

For further references about the seat reservation problem see @Boyar99 and @Boyar04. This [note](https://www.djoef-forlag.dk/publications/vba/backgroundinfo/SeatReservationProblem.pdf) also gives some background info.

A template file is given which should be used as a starting point for this exercise. The file already contains skeletons for some of the procedures and some procedures that you may use to help you. You may also use procedures in e.g. [vba-useful-procedures.xlsm](https://github.com/bss-osca/tfa/blob/master/vba/vba-useful-procedures.xlsm). Implement ALL your code in module `ModSeatRes`. You task is to create a program with the following features/tasks:

### Data handling

  (1) Modify procedure `CopyDataSheet` that asks for a number $d$ and copies the data in worksheet _Data-$d$_ to the _Run strategy_ worksheet. Add a button to the _Run strategy_ worksheet that calls the procedure. 
  (2) Modify procedure `ReadData` that reads the data from a worksheet (e.g. _Run strategy_)  and store it in two integers and an array. Hint: the procedure `RngCopyInt` in module `ModRange` may be useful here.
  (3) Consider the procedure `GenerateData` that generate a dataset and create a procedure `BtnGenerateData` that use `GenerateData` and add the dataset to worksheet _Run strategy_. Test the button that runs it in worksheet _Run strategy_.

### Algorithm implementation

  (4) Modify procedures `Greedy`, `MinSlots` and `MaxSlots` that use the strategies above given e.g. the data stored by calling `ReadData`.
  (5) Modify procedure `PrintSolution` that prints the solution found to a worksheet and range. The output should be similar to the output given in the _Example_ worksheet. 
  (6) Modify procedures `BtnGreedy`, `BtnMinSlots` and `BtnMaxSlots` that use the strategies on the data given in the _Run strategy_ worksheet and print out the solution. Test the corresponding buttons in the _Run strategy_ worksheet that calls the procedures. 
  (7) Test the buttons in worksheet _Run strategy_ to see if you can add data, run strategies and print solutions. See worksheet _Ex - Run strategy_ for an example.
  
### Simuation

  (8) Modify procedure `Simulate` that calculate the strategies for 100 datasets, print out the results and calculate statistics. The output should be in the worksheet _Simulation_. See worksheet _Ex - Simulation_ for an example. Which strategy seems to be the best/worse?
  
### Parameter analysis 

  (9) Modify procedure `Seats` which does a parameter variation on the number of seats. Apply the following approach: 
      - Use the dataset in worksheet _Data-1_.
      - Use the `MinSlots` strategy.
      - Find solutions when there are 1 to 150 seats available.
      - Store the results in worksheet _Seats_ (see worksheet _Ex - Seats_ for an example). 
      - Make a plot of the results (you may use the macro recorder to get some code).
      How do the two statistics develop as the number of seats increase?
  
  
Comments to the features/tasks can the added in the _Main_ worksheet.